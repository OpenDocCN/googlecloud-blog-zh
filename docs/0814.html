<html>
<head>
<title>Modern Frontend CI/CD Architecture — The Missing Guide (Part. 1): The CI.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现代前端CI/CD架构—缺失的指南(部分。1):CI。</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/modern-frontend-ci-cd-architecture-the-missing-guide-part-1-8444001fadc?source=collection_archive---------0-----------------------#2018-11-15">https://medium.com/google-cloud/modern-frontend-ci-cd-architecture-the-missing-guide-part-1-8444001fadc?source=collection_archive---------0-----------------------#2018-11-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/31034175952138947c3e14f771c262a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jDOTKaVUU7cBGibSlGRdzA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">TL；dr:前端CI/CD架构流水线的完整图。</figcaption></figure><p id="3905" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">当构建涉及大型团队和<a class="ae js" href="https://nvie.com/posts/a-successful-git-branching-model/" rel="noopener ugc nofollow" target="_blank">“git flow”分支</a>模型(或类似的工作流)的现代前端Web应用程序时，能够在合并它们之前预览由特定拉请求引入的更改是一项巨大的资产，可以很好地提高生产率。为此，您需要建立一个完整的CI/CD —一个持续集成和持续部署—管道。</p><p id="136c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在本帖中，我们将解决这一挑战，并使用以下工具建立一个完整的CI/CD:</p><ol class=""><li id="634e" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">GitHub作为我们的主要源代码库；</li><li id="bdab" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">Google Cloud Build作为我们的CI渠道；</li><li id="8608" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">Kubernetes是我们的CD渠道。</li></ol></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><p id="971f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们将这篇文章分成三篇独立的子文章:</p><ol class=""><li id="095b" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">第一部分将致力于建立CI渠道；</li><li id="df2f" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated"><a class="ae js" rel="noopener" href="/@wassimchegham/modern-frontend-ci-cd-architecture-the-missing-guide-part-2-d51875bd0e65">第二部分将解决CD管道</a>；</li><li id="aa9e" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated"><a class="ae js" rel="noopener" href="/@wassimchegham/modern-frontend-ci-cd-architecture-the-missing-guide-part-3-9a6be231d14">第三部分将为我们的CI/CD渠道增加一些额外功能</a>；</li></ol><h1 id="801f" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">GCP设置</h1><p id="73f8" class="pw-post-body-paragraph iu iv hi iw b ix lm iz ja jb ln jd je jf lo jh ji jj lp jl jm jn lq jp jq jr hb bi translated">首先，<a class="ae js" href="https://console.cloud.google.com/projectcreate" rel="noopener ugc nofollow" target="_blank">在GCP创建一个新项目</a>(或者使用一个已有的项目)。我们将使用<a class="ae js" href="https://xlayers.app" rel="noopener ugc nofollow" target="_blank"> xLayers.app </a>作为我们的示例项目。</p><p id="b9bc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后，您需要启用<a class="ae js" href="https://console.cloud.google.com/apis/library/container.googleapis.com" rel="noopener ugc nofollow" target="_blank"> Kubernetes引擎API </a>和<a class="ae js" href="https://console.cloud.google.com/apis/library/cloudbuild.googleapis.com" rel="noopener ugc nofollow" target="_blank">云构建API </a>:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/3b2c373c1cd182b74f741b4f4a381876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q1NJ6wQVPAm4jNu931HbMg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">云构建API</figcaption></figure><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/d5c7db5a74b298ccd7e42059491d715a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d-sRW2kX3QjmNJpV0_zFUQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Kubernetes引擎API</figcaption></figure><p id="ac0c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">还要确保编辑类似于<strong class="iw hj">PROJECT_ID@cloudbuild.gserviceaccount.com、</strong>的云构建服务帐户，然后添加<strong class="iw hj"> Kubernetes引擎管理</strong>角色，以便您可以从云构建步骤运行<code class="du lx ly lz ma b">kubectl</code>命令:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/0d8005f29a9e6ab541f439173814ac57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nwPqorpDZGzMkAz3-aKmfQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">编辑<a class="ae js" href="mailto:PROJECT_ID@cloudbuild.gserviceaccount.com" rel="noopener ugc nofollow" target="_blank">PROJECT_ID@cloudbuild.gserviceaccount.com</a>服务账户</figcaption></figure><p id="c7a7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里是需要添加的<strong class="iw hj"> Kubernetes引擎管理员</strong>角色:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/e424eaa3b087b8e9f973083bcfeb722f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*vx7EggtCij_k8rdAYR1HJA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">添加<strong class="bd kq"> Kubernetes引擎管理员</strong>角色</figcaption></figure><p id="134b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这应该是GCP的部分。让我们来配置GitHub项目。</p></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h1 id="a01f" class="ko kp hi bd kq kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll bi translated">GitHub设置</h1><p id="fffe" class="pw-post-body-paragraph iu iv hi iw b ix lm iz ja jb ln jd je jf lo jh ji jj lp jl jm jn lq jp jq jr hb bi translated">接下来，创建你的GitHub项目或者使用一个现有的项目，并添加<a class="ae js" href="https://github.com/marketplace/google-cloud-build" rel="noopener ugc nofollow" target="_blank"> Google Cloud Build GitHub应用</a>:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/90b6cc203b66c1cbcc2e769953c82040.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G2QvKGnOSTjmM6NN26No0g.png"/></div></div></figure><p id="3068" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">就是这样！您的GitHub项目现在使用Google Cloud Build作为CI管道。现在让我们为我们项目配置CI管道。</p></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h1 id="d1cc" class="ko kp hi bd kq kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll bi translated">Google Cloud构建为我们的CI渠道</h1><p id="523f" class="pw-post-body-paragraph iu iv hi iw b ix lm iz ja jb ln jd je jf lo jh ji jj lp jl jm jn lq jp jq jr hb bi translated">为了使用云构建CI构建和测试我们的代码，我们将在GitHub项目的根目录下创建一个cloudbuild.yaml配置文件，包含以下步骤:</p><figure class="ls lt lu lv fd ij"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="bbfa" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">该文件描述了云构建将在GitHub上每个打开的PR上运行的所有构建步骤。它将(按顺序):</p><ol class=""><li id="9caa" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">使用<code class="du lx ly lz ma b">npm install</code>命令安装NPM依赖项；</li><li id="81de" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">使用<code class="du lx ly lz ma b">npm run test:ci</code>命令测试项目；</li><li id="0bdd" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">使用<code class="du lx ly lz ma b">npm run build -- --output-path dist/html</code>命令构建项目。</li></ol><blockquote class="ml mm mn"><p id="7bd6" class="iu iv mo iw b ix iy iz ja jb jc jd je mp jg jh ji mq jk jl jm mr jo jp jq jr hb bi translated">您可以根据需要添加其他步骤。</p></blockquote><p id="117f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">除了测试和构建我们的项目之外，我们还将动态构建和推送两个新的容器，我们将在CD部分使用它们(阅读下一部分):</p><ol class=""><li id="881d" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">用当前提交SHA ( <a class="ae js" href="https://cloud.google.com/cloud-build/docs/configuring-builds/substitute-variable-values" rel="noopener ugc nofollow" target="_blank"> $SHORT_SHA </a>)标记的第一容器；</li><li id="b2dd" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">用标签<code class="du lx ly lz ma b">latest</code>标记的第二个容器，它将总是指向由我们的CI构建的“最新”工件。</li></ol><p id="9a66" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这些容器是使用这个最小化的<em class="mo"> Dockerfile </em>构建的，可以在我们项目的根目录下找到:</p><figure class="ls lt lu lv fd ij"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="a2cc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们基本上运行一个简单的nginx服务器，它将为我们的应用程序提供内容。此外，我们给它一个定制的<em class="mo"> nginx.conf </em>文件(见下文),并将输出构建复制到nginx默认的html根目录(在容器中):</p><figure class="ls lt lu lv fd ij"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="5403" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这样，我们就有了一个测试、构建和存储每次执行的快照的工作CI:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ms"><img src="../Images/1b05e8fb00f42706403d0ef7917a63b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_0tJzgA12pbG1gjlYed_YQ.png"/></div></div></figure><p id="cd8a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">CI部分到此为止！以下是我们迄今为止所取得的成就…</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/8f13cb82fd915eb29d1d830301aec972.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PihDi6JXL3kgNNISdrGAiA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">持续集成管道。</figcaption></figure></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h1 id="f3e2" class="ko kp hi bd kq kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh mh lj lk ll bi translated">要阅读更多关于CD管道的内容，请阅读本文的第2部分。</h1></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><p id="ffac" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="mo">关注</em><a class="ae js" href="https://twitter.com/manekinekko" rel="noopener ugc nofollow" target="_blank"><em class="mo">@ manekinekko</em></a><em class="mo">了解更多关于Web和云技术的更新。</em></p></div></div>    
</body>
</html>