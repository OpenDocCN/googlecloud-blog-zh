<html>
<head>
<title>Google Cloud Platform: redirecting HTTP traffic to HTTPS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云平台:将HTTP流量重定向到HTTPS</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-cloud-platform-redirecting-http-traffic-to-https-f63c1d7dbc6d?source=collection_archive---------0-----------------------#2018-05-01">https://medium.com/google-cloud/google-cloud-platform-redirecting-http-traffic-to-https-f63c1d7dbc6d?source=collection_archive---------0-----------------------#2018-05-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="67c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们正在将我们在Kubernetes上的所有项目转移到使用GCE(谷歌计算引擎)ingress而不是Nginx ingress，以便与整个谷歌云生态系统更紧密地集成。</p><p id="026c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但不幸的是，目前不可能将HTTP流量直接重定向到HTTPS😦。是的，你没听错。这个看似基本的功能并不直接受支持。</p><p id="6c5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们阅读Github上的文档(<a class="ae jd" href="https://github.com/kubernetes/ingress-gce" rel="noopener ugc nofollow" target="_blank">https://github.com/kubernetes/ingress-gce</a>)。</p><p id="f352" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要将流量从“80”重定向到“443 ”,您需要检查GCE L7插入的“x-forwarded-proto”报头，因为入口不支持重定向规则。在Nginx中，这很简单，只需在配置中添加以下几行:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="cc01" class="jn jo hi jj b fi jp jq l jr js"># Replace '_' with your hostname.</span><span id="007f" class="jn jo hi jj b fi jt jq l jr js">server_name _;</span><span id="bd7f" class="jn jo hi jj b fi jt jq l jr js">if ($http_x_forwarded_proto = "http") {</span><span id="8fed" class="jn jo hi jj b fi jt jq l jr js">return 301 https://$host$request_uri;</span><span id="42b3" class="jn jo hi jj b fi jt jq l jr js">}</span></pre><p id="d5b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可悲的是，我们需要手动完成这项工作，但幸运的是，我们仍然有Nginx来拯救我们。</p></div></div>    
</body>
</html>