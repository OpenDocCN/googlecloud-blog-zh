<html>
<head>
<title>Ethereum → Helm → Kubernetes Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太坊→头盔→库伯内特发动机</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/ethereum-helm-kubernetes-engine-25a9552f8e3d?source=collection_archive---------1-----------------------#2018-06-21">https://medium.com/google-cloud/ethereum-helm-kubernetes-engine-25a9552f8e3d?source=collection_archive---------1-----------------------#2018-06-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="6362" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">谷歌云平台上的区块链平台</h2></div><p id="15c6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我最近写了一种自行开发的方法，将以太坊的“<a class="ae jt" href="https://github.com/ethereum/go-ethereum" rel="noopener ugc nofollow" target="_blank"> Go以太坊</a>”(又名“geth”)双向部署到谷歌云平台:</p><p id="1a7d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae jt" rel="noopener" href="/google-cloud/ethereum-on-google-cloud-platform-8f10c82493ca">https://medium . com/Google-cloud/ether eum-on-Google-cloud-platform-8 F10 c 82493 ca</a></p><p id="33e9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我昨晚在微软的开发者博客上读到“<a class="ae jt" href="https://www.microsoft.com/developerblog/2018/02/09/using-helm-deploy-blockchain-kubernetes/" rel="noopener ugc nofollow" target="_blank">使用Helm将【以太坊】部署到Kubernetes </a>”。</p><p id="8154" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Kubernetes(和Helm)的一个好处是，如果一个图表适用于Azure Kubernetes服务，那么它应该适用于任何Kubernetes集群，包括Kubernetes引擎。<strong class="iz hj">提示</strong>:确实如此。</p><p id="026c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，如果您想在Kubernetes引擎上部署一个私有以太网，只需看看stable(！)以太坊图:</p><p id="ac68" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae jt" href="https://github.com/kubernetes/charts/tree/master/stable/ethereum" rel="noopener ugc nofollow" target="_blank">https://github . com/kubernetes/charts/tree/master/stable/ether eum</a></p><h2 id="fd78" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">设置</h2><p id="3013" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">如果你有一个现有的Google云平台项目，安装了Kubernetes引擎集群和Helm，请直接跳到前面。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="8fbf" class="ju jv hi kz b fi ld le l lf lg">PROJECT=[[YOUR-PROJECT]]<br/>REGION=[[YOUR-REGION]]<br/>BILLING=[[YOUR-BILLING]]<br/>CLUSTER=ethr-$(date '+%y%m%d')<br/>LATEST=1.10.4-gke.2</span><span id="ae1b" class="ju jv hi kz b fi lh le l lf lg">HELM_PATH=[[PATH/TO/HELM]]<br/>PATH=$PATH:${HELM_PATH}/linux-amd64</span><span id="2a29" class="ju jv hi kz b fi lh le l lf lg">gcloud projects create ${PROJECT}<br/>gcloud billing projects link $PROJECT --account=$BILLING<br/>gcloud services enable container.googleapis.com --project=$PROJECT</span><span id="c30a" class="ju jv hi kz b fi lh le l lf lg">gcloud beta container clusters create $CLUSTER \<br/>--username="" \<br/>--cluster-version=${LATEST} \<br/>--machine-type=custom-2-8192 \<br/>--image-type=COS \<br/>--num-nodes=1 \<br/>--enable-autorepair \<br/>--enable-autoscaling \<br/>--enable-autoupgrade \<br/>--enable-stackdriver-kubernetes \<br/>--min-nodes=1 \<br/>--max-nodes=2 \<br/>--region=${REGION} \<br/>--project=${PROJECT} \<br/>--preemptible \<br/>--scopes="<a class="ae jt" href="https://www.googleapis.com/auth/cloud-platform" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/cloud-platform</a>"</span><span id="7307" class="ju jv hi kz b fi lh le l lf lg">kubectl create serviceaccount tiller \<br/>--namespace=kube-system &amp;&amp; \<br/>kubectl create clusterrolebinding tiller \<br/>--clusterrole cluster-admin \<br/>--serviceaccount=kube-system:tiller &amp;&amp; \<br/>helm init --service-account=tiller</span></pre><h2 id="269c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">以太坊</h2><p id="9a84" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">遵循以太坊图表作者提供的说明:</p><p id="b23e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae jt" href="https://github.com/kubernetes/charts/tree/master/stable/ethereum" rel="noopener ugc nofollow" target="_blank">https://github . com/kubernetes/charts/tree/master/stable/ether eum</a></p><p id="a7da" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你需要一个钱包，说明书会解释如何在需要时创建一个。我唯一的建议是将命令包装在<code class="du li lj lk kz b">virtualenv</code>中:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="1686" class="ju jv hi kz b fi ld le l lf lg">virtualenv -p python3 py3env<br/>source py3env/bin/activate<br/>pip3 install -r requirements.txt<br/>python3 ethereum-wallet-generator.py</span><span id="89a0" class="ju jv hi kz b fi lh le l lf lg">python3 ethereum-wallet-generator.py</span></pre><p id="5a27" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将生成如下形式的内容:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="5b99" class="ju jv hi kz b fi ld le l lf lg">Private key: ee1eab2e...<br/>Public key:  e1a37deb...<br/>Address:     0xC8375d...</span></pre><p id="0fda" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">记下这些值，因为它们代表你的钱包。</p><h2 id="e6a4" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">以太坊图表安装</h2><p id="1caf" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">现在，您已经准备好将图表部署到Kubernetes引擎:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="ef1c" class="ju jv hi kz b fi ld le l lf lg">SECRET=[[YOUR-SECRET]]<br/>helm install \<br/>stable/ethereum \<br/>--set geth.account.address=0xC8375d... \<br/>--set geth.account.privateKey=e1a37deb... \<br/>--set geth.account.secret=${SECRET}</span></pre><blockquote class="ll lm ln"><p id="05cf" class="ix iy lo iz b ja jb ij jc jd je im jf lp jh ji jj lq jl jm jn lr jp jq jr js hb bi translated">生成一个秘密。出于测试目的，可能使用<a class="ae jt" href="https://passwordsgenerator.net/" rel="noopener ugc nofollow" target="_blank">安全密码生成器</a>。</p></blockquote><p id="0626" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当Helm部署完成时，它将为后续步骤提供指导:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="7c8b" class="ju jv hi kz b fi ld le l lf lg">NOTES:</span><span id="8f6e" class="ju jv hi kz b fi lh le l lf lg">1. View the EthStats dashboard at:<br/>    export SERVICE_IP=$(kubectl get svc --namespace default wondering-guppy-ethereum-ethstats -o jsonpath='{.status.loadBalancer.ingress[0].ip}')<br/>    echo <a class="ae jt" href="http://$SERVICE_IP" rel="noopener ugc nofollow" target="_blank">http://$SERVICE_IP</a></span><span id="ff40" class="ju jv hi kz b fi lh le l lf lg">NOTE: It may take a few minutes for the LoadBalancer IP to be available.<br/>          You can watch the status of by running 'kubectl get svc -w wondering-guppy-ethereum-ethstats-service'</span><span id="e435" class="ju jv hi kz b fi lh le l lf lg">2. Connect to Geth transaction nodes (through RPC or WS) at the following IP:<br/>    export POD_NAME=$(kubectl get pods --namespace default -l "app=wondering-guppy-ethereum-geth-tx,release=wondering-guppy" -o jsonpath="{.items[0].metadata.name}")<br/>    kubectl port-forward $POD_NAME 8545:8545 8546:8546</span></pre><h2 id="6add" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">库伯内特发动机</h2><p id="cedf" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">您应该看到部署到集群的几个资源。</p><p id="d34f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">应该有4个部署:</p><figure class="ku kv kw kx fd lt er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es ls"><img src="../Images/098de41c18b436d21da71fae8eff2f26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W4NQCyKX5zI6UWuZPYLf3A.png"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx translated">Kubernetes发动机控制台</figcaption></figure><p id="accb" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">和3项服务:</p><figure class="ku kv kw kx fd lt er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es ls"><img src="../Images/4efa676e170b106b31843a9a75ad1f75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lMVqRc6utlpROux0WUnL-Q.png"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx translated">Kubernetes发动机控制台</figcaption></figure><p id="f634" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">并且，您可以确认已经创建了一个网络负载平衡器:</p><figure class="ku kv kw kx fd lt er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es me"><img src="../Images/607d7f3d32c87db39bc64f31c0ba6443.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RCOlTfsBM6unLzII3RMkvg.png"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx translated">云控制台:网络服务</figcaption></figure><h2 id="12e3" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">网络负载平衡器</h2><p id="64aa" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">舵图为以太坊部署提供了一个网络负载平衡器。您可以通过浏览<code class="du li lj lk kz b">${SERVICE_IP}</code>来访问EthStats仪表板(参考部署图表时提供的“注释”):</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="eb89" class="ju jv hi kz b fi ld le l lf lg">export SERVICE_IP=$(\<br/>  kubectl get services \<br/>  --namespace=default wondering-guppy-ethereum-ethstats \<br/>  --output=jsonpath='{.status.loadBalancer.ingress[0].ip}') &amp;&amp; \<br/>echo ${SERVICE_IP}</span></pre><p id="d490" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">并且:</p><figure class="ku kv kw kx fd lt er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es mf"><img src="../Images/89050a26fcf7026aba97967f136789e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J-t6wveplBU8xedkRoDt7w.png"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx translated">EthStats</figcaption></figure><h2 id="7e35" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">HTTP/S负载平衡器</h2><p id="6289" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">在Google云平台上，可以(最好)为这个基于HTTP的服务使用HTTP/S负载平衡器。为此，您可以更改现有部署或克隆以太坊图表报告，并进行以下更改。</p><p id="03fa" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过将图表的<code class="du li lj lk kz b">values.yaml</code>的第18行中的<code class="du li lj lk kz b">type: LoadBalancer</code>更改为<code class="du li lj lk kz b">type: NodePort</code>来移除网络负载平衡器。您可以将此应用于正在运行的部署或更改模板文件。</p><p id="5607" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后使用以下命令对此节点端口应用入口:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="301d" class="ju jv hi kz b fi ld le l lf lg">apiVersion: extensions/v1beta1<br/>kind: Ingress<br/>metadata:<br/>  name: ethstats<br/>spec:<br/>  backend:<br/>      serviceName: [[HELM-RELEASE]]-ethereum-ethstats<br/>      servicePort: 80</span></pre><blockquote class="ll lm ln"><p id="0f1c" class="ix iy lo iz b ja jb ij jc jd je im jf lp jh ji jj lq jl jm jn lr jp jq jr js hb bi translated"><strong class="iz hj"> NB </strong>您需要将<code class="du li lj lk kz b">[[HELM-RELEASE]]</code>替换为您的以太坊部署的发布名称。</p></blockquote><p id="6b5b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您手动这样做，您可以看到发布名称。我的是“好奇-孔雀鱼”。你的将会不同。</p><p id="9cd3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果通过更改模板来实现这一点，可以使用以下模板:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="2433" class="ju jv hi kz b fi ld le l lf lg">apiVersion: extensions/v1beta1<br/>kind: Ingress<br/>metadata:<br/>  name: {{ template "ethereum.fullname" . }}-ethstats<br/>spec:<br/>  backend:<br/>      serviceName: {{ template "ethereum.fullname" . }}-ethstats<br/>      servicePort: 80</span></pre><p id="f304" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将导致配置HTTP/S负载平衡器:</p><figure class="ku kv kw kx fd lt er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es mg"><img src="../Images/fc0678dccb60016bde43da53e8ce2ece.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dM3TiRx8VedcLdii_vPVkg.png"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx translated">云控制台:网络服务</figcaption></figure><p id="c0d2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">与前面的命令类似，您可以:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="a0bf" class="ju jv hi kz b fi ld le l lf lg">INGRESS_IP=${<br/>  kubectl get ingress \<br/>  --output=jsonpath="{.items[0].status.loadBalancer.ingress[0].ip}") &amp;&amp; echo ${INGRESS_IP}</span></pre><p id="e4dd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后浏览<code class="du li lj lk kz b">${INGRESS_IP}</code>。</p><h2 id="ade0" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">结论</h2><p id="4da6" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">这个故事的主要目的是向你展示，如果它融合了，它也会融合在谷歌云平台上。我们经常被开发者问X是否运行在谷歌云平台上。问题真的是“如何在谷歌云平台上运行X？”</p><p id="b7cc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这种情况下，我们能够利用Kubernetes的<em class="lo">事实上的</em>容器编排标准和Helm的配套“包管理器”。给定一个舵图，舵图应该在Kubernetes引擎上工作。</p><p id="a709" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">仅此而已！</p></div></div>    
</body>
</html>