<html>
<head>
<title>Quick Tip: Simpler GKE authentication from Cloud Build</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快速提示:通过云构建实现更简单的GKE认证</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/quick-tip-simpler-gke-authentication-from-cloud-build-be418274d36c?source=collection_archive---------0-----------------------#2019-03-15">https://medium.com/google-cloud/quick-tip-simpler-gke-authentication-from-cloud-build-be418274d36c?source=collection_archive---------0-----------------------#2019-03-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="feac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">TL；DR: </strong>使用全局环境变量来指定您想要使用的GKE集群。</p><p id="35bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谷歌<a class="ae jd" href="https://cloud.google.com/cloud-build/" rel="noopener ugc nofollow" target="_blank">云构建</a>是一个托管CI/CD解决方案，可用于实现低成本、零维护的持续交付给谷歌<a class="ae jd" href="https://cloud.google.com/kubernetes-engine/" rel="noopener ugc nofollow" target="_blank"> Kubernetes引擎</a> (GKE)。很容易配置云构建来构建一个(或三个)容器，并将其部署到GKE。当然，部署需要对GKE集群进行身份验证。在这篇文章中，我们将学习一种简单的认证方法。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/6882a14a4c8c4045b4610251dd1478fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*agyjoo9JQwhG6PMY2mHheQ@2x.png"/></div></div></figure><p id="a40b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(我们将跳过真正困难的<em class="jq">步骤:<a class="ae jd" href="https://github.com/kelseyhightower/kubernetes-the-hard-way/blob/master/docs/05-kubernetes-configuration-files.md" rel="noopener ugc nofollow" target="_blank">手动创建客户端配置</a>。因为我们在使用GKE，我们可以让云来做所有那些证书密钥交换的事情。)</em></p><h1 id="fbdd" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">通过痛苦的经历</h1><p id="0cb2" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">如果我们从一台本地机器连接到GKE，我们可能会将kubectl授权给集群，然后运行我们的kubectl命令。<em class="jq">(为了便于说明，我们将部署一个常用的NGINX容器。您可能想要构建自己的、更有趣的容器，并部署它们。)</em></p><p id="4967" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这一两步过程可以在云构建中模拟:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ku kv l"/></div></figure><p id="3d39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">…好吧，这并不是真的<em class="jq">那么</em>难。但是我们可以做得更好！</p><h1 id="cb8e" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">简单的方法</h1><p id="7898" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">由于我们在Google Cloud的环境中使用kubectl，它可以<strong class="ih hj">自动连接到一个GKE集群</strong>，只要我们告诉它我们想要哪个集群(并且假设Cloud Build已经被授权访问……我们不能随便搞乱任何人的集群！).我们将使用几个环境变量来指定集群:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ku kv l"/></div></figure><p id="7e6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经取消了一个步骤！这使得我们的构建运行得更快。🎉</p><h1 id="7351" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">更简单的方法</h1><p id="4efb" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">有时，我们需要在一次构建中对集群执行多个操作。在每一步中都传递相同的环境变量是很乏味的。让我们通过在云构建中使用<strong class="ih hj">全局环境变量</strong>来消除冗余:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ku kv l"/></div></figure><p id="7341" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，嘘！这是一个<em class="jq">秘密功能！</em>不要告诉任何人！</p><p id="4c23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实际上，这并不是一个秘密:只是全局环境变量是新的，它们还没有被记录。继续谈论他们。享受一整天的kubectling！</p></div></div>    
</body>
</html>