<html>
<head>
<title>Deploy your Node Red Environment onto Kubernetes Clusters using Google Cloud Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Google云平台将您的Node Red环境部署到Kubernetes集群上</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/deploy-your-node-red-environment-onto-kubernetes-clusters-using-google-cloud-platform-2e4775c2e79f?source=collection_archive---------0-----------------------#2017-12-21">https://medium.com/google-cloud/deploy-your-node-red-environment-onto-kubernetes-clusters-using-google-cloud-platform-2e4775c2e79f?source=collection_archive---------0-----------------------#2017-12-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="969c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Node Red提供了快速编写代码和快速部署代码的能力。使用Node Red时出现主要问题是可伸缩性。在这个故事中，我将讲述如何在Google云平台上的Kubernetes集群上部署您的Node Red代码。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/1d5eb76610387a2c27fecbed15402e20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gvTnFoP2v3qE0tDE3y_vRA.png"/></div></div></figure><p id="c746" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本教程中，我们将创建一个节点红色Docker映像，然后将该映像上传到Docker Hub或Google云平台容器注册表。然后，我们将创建一个Kubernetes环境，提取我们构建的新图像，启动Docker容器，并创建多个pod来扩展我们的Node Red应用程序。</p><ul class=""><li id="7f3c" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">确保你已经安装了Docker</li><li id="27fa" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">设置您的Google云平台帐户</li><li id="071d" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">跟随谷歌云平台Mac OS快速入门:<a class="ae kd" href="https://cloud.google.com/sdk/docs/quickstart-mac-os-x" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/sdk/docs/quickstart-mac-os-x</a></li><li id="7850" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">只需跟进gcloud init</li></ul><ol class=""><li id="2977" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ke jv jw jx bi translated">运行命令</li></ol><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="f864" class="kk kl hi kg b fi km kn l ko kp">docker run -it -p 1880:1880 --name mynodered nodered/node-red-docker</span></pre><p id="eff3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于该命令的更多信息，请访问https://hub.docker.com/r/nodered/node-red-docker/<a class="ae kd" href="https://hub.docker.com/r/nodered/node-red-docker/" rel="noopener ugc nofollow" target="_blank"/></p><p id="6c01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.如果您打开localhost :1880，您将处于节点红色控制台中。如果你想安装其他节点，你可以运行</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="0f41" class="kk kl hi kg b fi km kn l ko kp">docker exec -it mynodered /bin/bash</span></pre><p id="218a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.现在你在你的容器中运行命令行，你现在可以运行npm安装你想要运行的包。</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="238b" class="kk kl hi kg b fi km kn l ko kp">npm install node-red-node-watson</span></pre><p id="5a7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，一旦你安装了所有你想使用的包，运行命令，这将重新启动容器</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="9c6d" class="kk kl hi kg b fi km kn l ko kp">docker stop mynodered<br/>docker start mynodered</span></pre><p id="c6b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.一旦您建立了您的流，运行命令</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="8230" class="kk kl hi kg b fi km kn l ko kp">//This command will create a new image from the container <br/>docker commit mynodered custom-image-name</span></pre><p id="9bf3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.您可以运行您的新映像，以确保通过命令对新映像进行了更改</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="0177" class="kk kl hi kg b fi km kn l ko kp">docker run -d --restart=always -p 1880:1880 customer-image-name:version</span></pre><p id="1653" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.一旦你对docker图像满意了，你就想把你的图像放入一个注册表，要么是docker.hub，要么是google云平台注册表</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="dabe" class="kk kl hi kg b fi km kn l ko kp">//Google Container Registry Push Image <br/><a class="ae kd" href="https://cloud.google.com/container-registry/docs/pushing-and-pulling" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/container-registry/docs/pushing-and-pulling</a></span><span id="52f3" class="kk kl hi kg b fi kq kn l ko kp">docker tag customer-image-name gcr.io/[project-id]/customer-image-name</span><span id="74ad" class="kk kl hi kg b fi kq kn l ko kp">gcloud docker -- push gcr.io/[project-id]/customer-image-name</span><span id="31ed" class="kk kl hi kg b fi kq kn l ko kp">//Docker Hub Push Image <a class="ae kd" href="https://docs.docker.com/datacenter/dtr/2.4/guides/user/manage-images/pull-and-push-images/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/datacenter/dtr/2.4/guides/user/manage-images/pull-and-push-images/</a></span><span id="2400" class="kk kl hi kg b fi kq kn l ko kp">docker tag [image id] your-hub-user-name/customer-image-name<br/>docker push your-hub-user-name/customer-image-name</span></pre><p id="a9fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.去你的谷歌云平台，选择一个项目。</p><p id="2ba5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8.接下来，转到Kubernetes引擎，单击“create cluster”并填写所需信息，即名称、描述、区域、大小，然后单击“create”。</p><p id="4de9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">9.创建集群后，单击文本下面的Connect and copy:“通过运行以下命令配置<a class="ae kd" href="http://kubernetes.io/docs/user-guide/kubectl-overview/" rel="noopener ugc nofollow" target="_blank"> kubectl </a>命令行访问”。接下来打开Google Cloud Shell并粘贴命令。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kr"><img src="../Images/42cc3bd83ea6d58025dccc028ea4a537.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v2ML_73mGN_wCMLXL160zw.png"/></div></div></figure><p id="c826" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">10.现在，您已连接到您的群集，现在我们希望提取我们的映像，并开始将我们的映像作为容器运行。</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="4638" class="kk kl hi kg b fi km kn l ko kp">//Google Cloud Platform Pull Image from Registry <br/>kubectl run customName --replicas=4 --image=<a class="ae kd" href="http://gcr.io/twiliochatbot-77dac/ai_now_chatbot" rel="noopener ugc nofollow" target="_blank">gcr.io/</a>[project-id]<a class="ae kd" href="http://gcr.io/twiliochatbot-77dac/ai_now_chatbot" rel="noopener ugc nofollow" target="_blank">/</a>custom-image-name --port=1880</span><span id="5097" class="kk kl hi kg b fi kq kn l ko kp">//Docker Hub Pull Image from Registry <br/>kubectl run customName --replicas=4 --image=your-hub-user-name/customer-image-name --port=1880</span><span id="d219" class="kk kl hi kg b fi kq kn l ko kp">--replicas 4<br/>//this command will created the numbers of pods you want, in this case your are creating 4 pods </span><span id="c62b" class="kk kl hi kg b fi kq kn l ko kp">--image=<a class="ae kd" href="http://gcr.io/twiliochatbot-77dac/ai_now_chatbot" rel="noopener ugc nofollow" target="_blank">gcr.io/</a>[project-id]<a class="ae kd" href="http://gcr.io/twiliochatbot-77dac/ai_now_chatbot" rel="noopener ugc nofollow" target="_blank">/</a>custom-image-name <br/>//This command is referring to which image you want to pull </span><span id="bf8c" class="kk kl hi kg b fi kq kn l ko kp">--port=1880 <br/>//This command refers to which port your want your docker container to run on, in this case port 1880</span></pre><p id="2169" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">11.接下来，我们希望公开我们的应用程序，所以运行命令</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="c683" class="kk kl hi kg b fi km kn l ko kp">kubectl expose deployment/projectName --type="LoadBalancer"</span></pre><p id="f4ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">12.现在docker容器运行在集群上并对外公开。要查看正在运行的IP地址，请运行命令</p><pre class="je jf jg jh fd kf kg kh ki aw kj bi"><span id="1407" class="kk kl hi kg b fi km kn l ko kp">kubectl get services</span></pre><p id="0b6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以通过:EXTERNAL-IP:1880登录到Node-Red实例。如果您想要更新Node-Red，您需要更新您的映像，然后让您的集群指向新映像。</p></div></div>    
</body>
</html>