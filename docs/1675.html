<html>
<head>
<title>Setting up Google Cloud Identity for Multinational Companies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为跨国公司设置Google云身份</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/setting-up-google-cloud-identity-for-multinational-companies-4afcbb18dee1?source=collection_archive---------4-----------------------#2020-11-19">https://medium.com/google-cloud/setting-up-google-cloud-identity-for-multinational-companies-4afcbb18dee1?source=collection_archive---------4-----------------------#2020-11-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="534b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Google Cloud中加入企业的第一步是设置Cloud Identity或Google Workspace来集中管理Google Cloud。</p><p id="43a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该流程在<a class="ae jd" href="https://cloud.google.com/docs/enterprise/onboarding-checklist#checklist-title" rel="noopener ugc nofollow" target="_blank">企业入职清单</a>中有很好的解释，在<a class="ae jd" href="https://cloud.google.com/architecture/identity" rel="noopener ugc nofollow" target="_blank">云身份架构网站</a>中有最佳实践和参考架构。</p><p id="1c8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为跨国公司设置云身份可能会更加棘手，因为这些公司可能有集中的服务，如电子邮件服务，但另一方面，他们的运营公司(OpCos)可能有足够的自主权来管理自己的Google云组织。</p><h1 id="92c3" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">概观</h1><p id="19f6" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">让我们假设有一家名为“Example LLC”的跨国公司，在巴西、英国、德国和西班牙有四家子公司(或称OpCos)。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es kh"><img src="../Images/fa8e832d5d6cb438cf6cd653394b435d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*IViw3P6whvzPEShptIXQCw.png"/></div></figure><p id="3130" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“Example”拥有一组共享服务，包括其所有员工的全球身份和电子邮件服务(<user> @example.com)，由微软Azure AD的全球实例提供。在Azure AD和Cloud Identity之间建立用户联盟的指南可在<a class="ae jd" href="https://cloud.google.com/architecture/identity/federating-gcp-with-azure-ad-configuring-provisioning-and-single-sign-on" rel="noopener ugc nofollow" target="_blank">此处</a>获得。</user></p><p id="8508" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一方面，不同的OpCo在技术和运营方面拥有完全的自主权，因此他们决定管理自己的Google云组织。</p><h1 id="2889" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">问题</h1><p id="2dde" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">组织资源是Google云资源层次结构中的根节点，也是项目的层次结构超级节点。一旦设置了Google Workspace或Cloud Identity，组织资源就可用，因此必须验证公司的域。该域在谷歌云认证过程中用于识别用户属于哪个组织，因此<strong class="ih hj">一个域只能属于谷歌云组织</strong>的唯一云身份。</p><p id="0e49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总结:</p><ul class=""><li id="5bf6" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">来自不同OpCos的所有用户在其电子邮件地址(<user> @example.com)中共享相同的域</user></li><li id="06f1" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">每个OpCo都需要有自己的Google Cloud组织(及其相关的域)</li><li id="d03a" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">example.com域只能与唯一的云身份实例相关联。</li></ul><p id="1611" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">来自不同OpCos的@example.com用户如何访问他们对应的Google Cloud组织？</p><h1 id="c998" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">解决方案</h1><p id="708a" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">此用例的解决方案包括设置不同的云身份实例:</p><ul class=""><li id="8211" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">1个与example.com域相关联的全局云身份实例(CI Global ),包含属于不同OpCos的所有用户。这个CI将负责用户身份验证，并将与Azure AD集成，用于用户联合和单点登录。</li><li id="4aea" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">n x个云身份实例(CI OpCo)与每个OpCos域/Google云组织相关联。这些CI实例不包含用户，但是可以包含本地组(例如gcp-net-admins@example.de)。管理OpCo组织中托管的资源的授权由Cloud IAM执行，将权限分配给CI全局中可用的用户身份。</li></ul><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ld"><img src="../Images/4196defd84ad4d2e71c7376b5ad3e19c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SCYpgJLwJjQkYOx3CHduUw.png"/></div></div></figure><p id="f64e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果用户在两个不同的组织中拥有权限并访问Google Cloud Console，则可以在Google Cloud Console中选择正确的组织</p><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es li"><img src="../Images/f205de256c48f60ffab6099c0a7b832f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*z4_bY7APWf4hm0ajjKSgig.png"/></div></figure><h1 id="f356" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">限制允许的身份域</h1><p id="0acd" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">为了限制允许在每个OpCo组织的IAM策略中使用的身份集，有必要设置iam.allowedPolicyMemberDomains组织策略[1]。</p><p id="f5e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">iam.allowedPolicyMemberDomain定义可以添加到云iam策略的成员集。允许/拒绝列表必须指定一个或多个云身份或Google Workspaces客户id。</p><p id="52f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以使用Google Cloud控制台或以下gCloud命令设置组织策略:</p><pre class="ki kj kk kl fd lj lk ll lm aw ln bi"><span id="7858" class="lo jf hi lk b fi lp lq l lr ls">gcloud alpha resource-manager org-policies allow \<br/>--organization 'ORGANIZATION_ID_example_opco' \<br/> iam.allowedPolicyMemberDomains 'CUSTOMER_ID_example.com' \<br/> 'DOMAIN_ID_example_opco'</span></pre><p id="d52b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以使用以下gCloud命令获取域ID:</p><pre class="ki kj kk kl fd lj lk ll lm aw ln bi"><span id="684d" class="lo jf hi lk b fi lp lq l lr ls">gcloud organizations list</span></pre><p id="7054" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该命令将返回显示名称、ID(组织ID)和目录客户ID。Google Workspace客户ID是DIRECTORY_CUSTOMER_ID。</p><h1 id="cac5" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">考虑和限制</h1><ul class=""><li id="a600" class="kp kq hi ih b ii kc im kd iq lt iu lu iy lv jc ku kv kw kx bi translated">域限制共享(allowedPolicyMemberDomain)可能会干扰某些Google云服务，您可能需要为某些Google云服务提供例外。[2]</li><li id="4bd5" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">外部团体不得成为组织所有项目的所有者。你可以让<a class="ae jd" href="mailto:group@telefonica.es" rel="noopener ugc nofollow" target="_blank"> group@example.es </a>做项目负责人，让【group@example.com】的<a class="ae jd" href="mailto:group@telefonica.com" rel="noopener ugc nofollow" target="_blank">做</a><a class="ae jd" href="mailto:group@telefonica.es" rel="noopener ugc nofollow" target="_blank"> group@example.es </a>的成员，或者让<a class="ae jd" href="mailto:group@telefonica.com" rel="noopener ugc nofollow" target="_blank">group@example.com</a>做项目编辑。[3]</li><li id="8b37" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated"><a class="ae jd" href="https://cloud.google.com/context-aware-access/docs/securing-console-and-apis" rel="noopener ugc nofollow" target="_blank">上下文感知访问</a>:不属于您组织的任何人，即使您已将他们添加到应受上下文感知访问限制约束的用户组中，也不受访问约束。[4]</li></ul></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><p id="2e37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[1]<a class="ae jd" href="https://cloud.google.com/resource-manager/docs/organization-policy/restricting-domains" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/resource-manager/docs/organization-policy/restricting-domains</a></p><p id="672d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[2]<a class="ae jd" href="https://cloud.google.com/resource-manager/docs/organization-policy/restricting-domains#known_issues" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/resource-manager/docs/organization-policy/restricting-domains # known _ issues</a></p><p id="3b71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[3]<a class="ae jd" href="https://cloud.google.com/iam/docs/faq#can_i_use_google_groups_with" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/iam/docs/FAQ # can _ I _ use _ Google _ groups _ with</a></p><p id="ea64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[4]<a class="ae jd" href="https://cloud.google.com/context-aware-access/docs/securing-console-and-apis#frequently_asked_questions" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/context-aware-access/docs/securing-console-and-API</a></p></div></div>    
</body>
</html>