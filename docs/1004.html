<html>
<head>
<title>SAS/COM: An architect’s guide to system design</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SAS/COM:系统设计架构师指南</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/sas-com-an-architects-guide-to-system-design-9830e3623964?source=collection_archive---------1-----------------------#2019-05-20">https://medium.com/google-cloud/sas-com-an-architects-guide-to-system-design-9830e3623964?source=collection_archive---------1-----------------------#2019-05-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7e90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我花了很多时间思考不同的架构设计，不久前我开发了一套设计原则，简称SAS/COM。是<em class="jd">可扩展性</em>、<em class="jd">可用性</em>、<em class="jd">安全性</em>、<em class="jd">成本</em>、<em class="jd">运营</em>和<em class="jd">维护</em>的缩写。我认为任何架构在设计时都必须考虑这些原则。在这篇文章中，我将描述为什么这些标准都很重要。由于我的大部分生产时间都在使用Google Cloud，所以我将分享一些与该产品集相关的例子。</p><h1 id="6f45" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><strong class="ak">可扩展性</strong></h1><p id="9f87" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">理解用户流量的数量、速度和多样性有助于你理解问题的严重性。这是一个开始设计的简单地方。</p><p id="37b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">了解每秒查询次数(qps)、延迟要求、使用模式的可变性、请求的大小和地理来源，都有助于了解如何构建应用和基础架构。最重要的是，了解这些要求如何随时间变化，对于设计一个随着流量的增加而持续工作的系统也是至关重要的。这些要求会影响平台的选择、缓存要求、存储技术以及如何设计整体应用架构。</p><p id="dab8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，如果您有高度可变的流量，那么像App Engine这样可以根据流量自动伸缩的PaaS产品是一个很好的考虑。事实上，更深入地说，您可能希望利用App Engine中的预热功能来提供最快的扩展能力以满足需求。对于低延迟应用程序，您会希望在浏览器和应用程序上缓存信息，并利用CDN等CDN来存储静态内容。为了存储应用程序状态，您需要选择一个低延迟的数据库来存储应用程序。你还可以考虑将应用程序分为前端和后端，并使用微服务或RPC来构建服务。GCP微服务的计算选项从谷歌Kubernetes引擎到应用引擎，甚至是云功能。对于拥有全球用户群的应用程序，您会希望考虑将您的前端尽可能靠近用户，以减少延迟，同时确保前端/后端服务通信是健壮的。谷歌云全球负载均衡器提供了一种简单的方法来有效地路由用户流量。</p><h1 id="4268" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><strong class="ak">可用性</strong></h1><p id="74e0" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">为什么可用性很重要？这很重要，因为您需要设计您的系统来提供正确的可用性。网站可靠性工程师(SREs)在他们的<a class="ae kh" href="https://landing.google.com/sre/books/" rel="noopener ugc nofollow" target="_blank">书</a>和<a class="ae kh" href="https://cloud.google.com/blog/products/cre" rel="noopener ugc nofollow" target="_blank">博客系列</a>中有很多关于设计具有适当可用性水平的可伸缩系统的内容，如果你还没有读过，值得一读。了解可用性要求可以让您设计一个具有适当正常运行时间的系统，而不是更多。增加正常运行时间的成本可能很高，因此，了解业务的可用性要求非常重要。高流量的全球网站或服务与您的内部分析渠道相比，具有非常不同的可用性要求。两者都很重要，但公共网站/服务可能比您的内部分析渠道有更高的可用性要求。</p><p id="3f9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你开发一个应用程序时，通过定义一个<a class="ae kh" href="https://landing.google.com/sre/sre-book/chapters/service-level-objectives/" rel="noopener ugc nofollow" target="_blank">服务水平目标</a> (SLO)来正式捕获可用性需求是一个非常好的主意，即使你与用户或客户没有正式的服务水平协议(SLA)。SLO通过要求使用具有特定可用性或性能特征的存储来帮助推动应用程序的设计。这也有助于确定监控应用程序的计划，一旦应用程序开始运行，这将是非常重要的。</p><p id="0476" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">云服务提供商，包括Google Cloud，为他们的服务提供SLA。在云基础设施之上构建应用意味着您需要考虑底层云基础设施SLA。</p><p id="e5b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于高可用性系统，您需要选择通过提供冗余来提供高可用性的计算、存储和网络服务设计。例如，您会希望包括Google Cloud的全球负载平衡器、多区域云存储和冗余云互连等功能，用于任何云到本地的通信。这些计算、存储和网络选项都提供冗余。使用负载平衡器意味着您可以将流量负载分散到GKE集群上的一组实例或一组服务中。对云存储或云数据存储使用多区域选项意味着您的内容会自动复制到多个位置，从而提供更高的可用性保证。通过设置两个到本地的云互连，可以在云到本地的通信通道中构建冗余。所有这些设计选择都是由可用性需求驱动的。</p><h1 id="6c77" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><strong class="ak">安全</strong></h1><p id="66b3" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">无论系统部署在哪里，安全性和隐私都是任何系统设计的关键组成部分。根据您组织的政策、合规性或法规要求，您可能有非常具体的要求。请记住，安全性是一个非常宽泛的术语，可以包括非常宽泛的要求，如“所有数据在静态和传输时都必须使用您控制的密钥进行加密”，也可以包括非常具体的要求，如“所有TLS连接都必须使用TLS _ RSA _ WITH _ AES _ 256 _ CBC _ SHA SSL v3密码”。或者，您可能制定了策略来控制PII数据在应用程序中的使用方式。您的组织也可能有一个团队来认证云服务的使用，这可能是应用程序设计的一个重要考虑因素。总的来说，安全性和隐私是广泛的话题，也是你在应用程序设计时需要考虑的深层技术问题。</p><p id="5bb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，一个常见的设计要求是Kubernetes集群或计算引擎VM实例不应通过公共IP公开。在Google Cloud中，这个策略是通过<a class="ae kh" href="https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints" rel="noopener ugc nofollow" target="_blank">组织策略约束</a>实现的。另一个常见要求是连接到具有私有IP空间的本地网络。在使用VPC服务控制的Google Cloud中，私有Google Access和Cloud Interconnect一起允许您在使用Google Cloud服务的同时继续使用私有IP空间。与数据存储区域服务相关的要求也可能会影响您选择构建应用程序的方式。举个例子，谷歌云中的许多服务都是<a class="ae kh" href="https://cloud.google.com/docs/geography-and-regions#regions_and_zones" rel="noopener ugc nofollow" target="_blank">区域服务</a>，这让你可以明确应用程序在哪里运行和存储数据。其他应用可能需要合规认证，包括BAA涵盖的服务。例如，在Google Cloud中，你可以在设计应用程序时从<a class="ae kh" href="https://cloud.google.com/security/compliance/hipaa-compliance/" rel="noopener ugc nofollow" target="_blank"> BAA覆盖的服务</a>的广泛列表中进行选择。了解这些以及所有与安全相关的要求可以极大地影响您的基础设施和应用的设计。</p><h1 id="ce6d" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><strong class="ak">成本</strong></h1><p id="c50d" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">设计的效率会对应用程序的开发和成本产生重大影响。低效的设计可能包括低效的数据库调用、不必要的服务调用和非最优的缓存，其中的每一个都可能导致额外的成本。由于大多数云存储服务是按使用量计费的，所以你使用的服务越多，你支付的费用就越多。这无疑可以为随时间扩展和缩减的工作负载提供优势，尽管这也会使总体成本在您构建应用程序之前更难估计。</p><p id="7a7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要考虑的一些重要事项是不同存储选项之间的成本差异、跨区域的出口成本和计算成本。其他要考虑的事项是单个组件的每次操作成本，如负载平衡器成本、存储操作和日志记录量。事实上，成本是无服务器技术越来越受欢迎的原因之一。</p><p id="25cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，如果您部署了一个微服务应用程序，该应用程序跨Google Cloud区域进行服务调用，您将会产生出口流量费用。根据当前和预计的未来容量，选择存储类别也会对成本产生巨大影响。例如，美国多区域coldline存储设备的价格为0.007美元/GB，而美国多区域标准存储设备的价格为0.026美元(截至今天的当前价格<a class="ae kh" href="https://cloud.google.com/storage/pricing" rel="noopener ugc nofollow" target="_blank">此处</a>)。这是3倍的成本差异，而且随着存储规模的增长，这种差异会很快变得重要。最后一个例子是，选择一个实例或GKE集群的成本与使用无服务器选项(如Cloud Run)来处理可伸缩的工作负载的成本不同。考虑成本是系统设计的重要组成部分。</p><h1 id="331b" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><strong class="ak">作战</strong></h1><p id="4a38" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">可观察性是应用程序设计的关键考虑因素。这个领域专注于运行应用程序，这通常是由DevOps团队完成的，或者如该功能在谷歌所知，由<a class="ae kh" href="https://landing.google.com/sre/" rel="noopener ugc nofollow" target="_blank">站点可靠性工程</a> (SRE)团队完成。在设计阶段考虑重要的指标，如服务水平指标(sli)和应用的服务水平目标(SLO ),可以帮助您在设计中包含所需的工具。SRE /DevOps团队将对如何监控您的应用程序以及仪表板级别对于识别和解决错误的意义非常感兴趣。</p><p id="8a0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，Stackdriver Monitoring为Google云服务提供了基础设施和应用级的监控。在Stackdriver中，您可以使用提供的GCP基础设施指标或编写自己的自定义指标来跟踪应用的服务水平指标。事实上，对于App Engine和支持Istio的应用程序，Stackdriver的服务监控会自动跟踪您的sli，并根据您定义的SLO进行报告。Stackdriver警报和控制面板为您的应用提供了有关特定指标的详细信息。</p><p id="8289" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于调试和故障排除，考虑日志策略和应用程序性能管理(APM)工具的使用非常重要。APM工具的使用通常需要一些代码级别的工具，并且应该被视为软件开发生命周期的一部分。</p><p id="7797" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，Stackdriver的APM工具包括Profiler、Debugger和Trace，并与OpenCensus集成在一起。每个都为SRE或开发团队提供了有用的信息，供他们在排除故障或分析应用程序性能时使用。</p><h1 id="0cb0" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><strong class="ak">维护</strong></h1><p id="0fd8" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">应用程序的设计会对部署时间/成本产生非常重大的影响。开发一个满足当前需求的设计，可以根据不同的流量负载进行扩展，并且在未来出现新需求时易于修改，使应用程序随着时间的推移更易于维护。</p><p id="80b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，如果您将Bigtable用于您的应用程序存储，那么仔细设计密钥将意味着应用程序符合当前要求，将随着更高的流量而扩展，并且随着应用程序要求的不断发展而易于更改。</p><p id="eed7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">帮助保持开发速度同时减少部署时间/成本的一个常见方法是使用CI/CD工具。使用CI/CD工具意味着开发团队可以设计他们的测试和应用程序来使用标准流程，这也使得应用程序更易于维护，因为更改更易于部署。以更快的速度、更少的错误和更少的人力时间将代码投入生产，可以提高开发人员的工作效率并降低成本。</p><p id="b9e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，您可以使用<a class="ae kh" href="https://cloud.google.com/solutions/jenkins-on-kubernetes-engine" rel="noopener ugc nofollow" target="_blank"> Jenkins和Google Kubernetes引擎</a>建立一个CI/CD管道。有许多不同的方法来设置管道，但最终结果应该是提供一种自动的方法来构建、测试和部署您的代码。从设计的角度来看，重要的是要考虑通过CI/CD管道发布代码，并开发自动化测试来利用自动化。</p><h1 id="91ac" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><strong class="ak">结论</strong></h1><p id="784d" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">根据<em class="jd">可伸缩性</em>、<em class="jd">可用性</em>、<em class="jd">安全性</em>、<em class="jd">成本</em>、<em class="jd">运营</em>和<em class="jd">维护</em>的规则来评估需求，有助于设计可适当伸缩、满足用户SLO、保护敏感数据、优化成本、配备良好并利用部署自动化的系统。</p></div></div>    
</body>
</html>