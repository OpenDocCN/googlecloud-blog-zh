<html>
<head>
<title>Marketing Mix Modelling with Robyn on Vertex AI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Robyn在Vertex AI上的营销组合建模</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/marketing-mix-modelling-with-robyn-on-vertex-ai-9dab591cbf49?source=collection_archive---------0-----------------------#2022-09-07">https://medium.com/google-cloud/marketing-mix-modelling-with-robyn-on-vertex-ai-9dab591cbf49?source=collection_archive---------0-----------------------#2022-09-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="39b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数字营销格局正在经历一场结构性转变。Cookieless将扰乱我们如何衡量和理解数字广告投资的有效性。这就是为什么越来越多的营销人员和分析师转向统计建模，这不需要用户级的跟踪。一个流行的例子是<strong class="ih hj">营销组合建模(</strong> MMM)。</p><p id="b84d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">MMM是一种技术，允许营销人员衡量其营销和广告活动的影响，并确定<strong class="ih hj">各种渠道如何为其目标</strong>(如销售收入)做出贡献。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/1b4e0a6c656d5e3ea128b4f19a8b312e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5psjLxV-VNF-JsZ_.jpg"/></div></div></figure><p id="7cee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Robyn(【https://facebookexperimental.github.io/Robyn/】)是可以帮助MMM分析的开源库之一。Robyn是一个R库，本文的目标之一是展示<strong class="ih hj">如何在Vertex AI上使用Robyn运行MMM分析:Google的机器学习平台可作为Google Cloud上的一项服务。</strong></p><p id="a5de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Robyn的安装过程被很好地记录了下来，但是考虑到这个库还处于实验阶段，你会很容易地找到一些帖子和评论，这些帖子和评论都是人们在这里遇到问题时的抱怨。为了帮助您完成这一步，<strong class="ih hj">我们还将展示如何构建Dockerfile定义，该定义考虑了运行基于Robyn的R脚本所需的所有依赖关系</strong>。我们将使用docker文件实例化<strong class="ih hj"> Vertex AI Workbench </strong>用于笔记本的交互实验，然后在Vertex AI无服务器ML基础设施上调度自动化MMM作业。</p><h1 id="19ed" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">你为什么应该关心营销组合建模？</h1><p id="a611" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">MMM是一种成熟的方法，在数字时代之前，媒体公司已经对其进行了几十年的验证测试。对广告支出影响的简单思考可以是一个简单的线性模型，例如，销售额=权重1 *渠道1 +权重2 *渠道2 +基数。</p><p id="f437" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但现实比这更复杂。有一个渠道饱和(收益递减)效应，这是一个渠道特有的。渠道在推动客户行动的快慢方面有所不同(也称为adstock)。最后，你想要的结果是你的营销预算在渠道间的优化分配。</p><p id="d0f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有这些方面都是MMM技术的核心部分。在本文中，我们将向您展示Robyn如何处理这些机制，以及您如何在没有或只有极少统计建模背景知识的情况下，在GCP上运行和自动化该过程。</p><h1 id="9cef" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">为什么要在Vertex AI上运行MMM分析？</h1><p id="c29c" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">当谈到机器学习时，谷歌被视为黄金标准，拥有世界一流的研究团队，如谷歌大脑、谷歌研究和深度思维，通过谷歌搜索、谷歌翻译和TensorFlow、Kubeflow、Kaggle、Colabs、TPUs、Kubeflow、BERT、T5、ImageNet、Parti、LaMDA、PaLM等多种贡献，仅举几例。</p><p id="7844" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">鉴于上述所有情况——谷歌的机器学习平台Vertex AI，作为谷歌云上的一项服务，似乎至少值得一试。</p><p id="7b42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有一点让Vertex AI不同于其他类似的平台:它是完全无服务器的——你可以通过GPU和TPU等各种加速器访问谷歌的ML基础设施，无需管理服务器、虚拟机、Kubernetes集群，也无需安装和升级任何软件。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kt"><img src="../Images/cac7a9e6dad110a1c175f39d9317981a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*vIW5Rzn8ArIzDr88"/></div></figure><p id="0cdb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">来源:<a class="ae jp" href="https://cloud.google.com/blog/topics/developers-practitioners/new-ml-learning-path-vertex-ai" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/blog/topics/developers-从业者/new-ml-learning-path-vertex-ai</a></p><p id="10a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第二个值得一提的是，Vertex AI是一个端到端的MLOps平台。这是什么意思？这意味着它是一个单一的地方，您可以在这里管理功能，标记训练样本，使用您最喜欢的ML框架和语言(Python，R)运行训练，执行自动化超参数调整，实现和执行MLOps管道，在模型注册表中注册您的模型，运行无服务器批量预测作业，将您的模型部署为REST端点，并支持模型监控和预测的可解释性。</p><p id="c4a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后一点是，Vertex AI将允许你建立完全定制的模型，但也将让你访问许多由谷歌设计的最先进的架构，并作为AutoML培训提供。在我们的下一篇文章中，我们将展示如何使用Vertex AI AutoML功能构建MMM管道，<strong class="ih hj">,但在本文中，我们将展示Vertex AI也可以与任何第三方库一起工作。</strong></p><h1 id="073d" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">建立实验环境</h1><p id="5d5c" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">Vertex AI Workbench允许您使用Jupyter笔记本运行交互式分析。它有几个预构建的Docker映像，打包了用于不同Jupyter环境的必要库，如针对NVIDIA GPUs优化的Python 3、TensorFlow(包括TensorFlow Enterprise)、PyTorch、R等。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ku"><img src="../Images/c403ca7f4fb6c9874c9540c2e9fd4c81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/0*DARhoUJOz6nD-ysZ"/></div></figure><p id="5237" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尽管Robyn没有预构建的映像，但是没有什么可以阻止我们通过扩展R的现有映像并添加Robyn及其依赖项来构建自定义映像。这正是我们的计划:</p><ul class=""><li id="d86c" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated">首先，我们必须从为本文准备的Dockerfile定义构建一个定制的容器映像。</li><li id="137a" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">接下来，我们将前往顶点人工智能和顶点人工智能笔记本的新实例。我们将从自定义容器映像实例化该实例，这样我们就可以在交互式环境中运行MMM实验。</li><li id="c465" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">现在，我们有了运行一些MMM实验和学习Robyn基础知识所需的一切。我们实验的最终目标应该是一个可以自动执行的工作脚本，以计算新的预算分配建议。</li><li id="273c" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">一旦我们对我们的脚本感到满意——我们将能够使用相同的容器映像定期运行我们的MMM脚本，作为利用Vertex AI无服务器ML基础设施的Vertex AI自定义训练作业。</li></ul><h1 id="6086" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">步骤1:从Dockerfile构建一个容器映像</h1><p id="cd59" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">下面是一个order文件，它是我们多次反复试验的结果，我们保证拥有安装Robyn库所需的所有依赖项。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="08a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Google Cloud上构建容器映像的最佳方式是使用Cloud Build。然而，开始使用Vertex AI并不需要所有DevOps实践都到位；因此，我们将使用云壳，这是所有谷歌云控制台用户都可以使用的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ll"><img src="../Images/6cf567b5305c2f8d35364ab1b84abf61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CFk0sbQoAoB7gDR-9WHcnw.png"/></div></div></figure><p id="6b15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以通过执行以下命令从我们的git存储库中获取docker file(Cloud Shell已经安装了一个Git客户端):</p><blockquote class="lm ln lo"><p id="45f7" class="if ig lp ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">git克隆<a class="ae jp" href="https://gist.github.com/a63416348809d36b46c185fd728d8f6e.git" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/a 63416348809d 36 b 46 c 185 FD 728d 8 F6 e . git</a></p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lt"><img src="../Images/fc415e0f5847283d73bc2419ed3f4393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4P0GcreFdPUzqsKklIMwow.png"/></div></div></figure><p id="7a1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置代表您的GCP项目ID的PROJECT_ID变量:</p><blockquote class="lm ln lo"><p id="9a86" class="if ig lp ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">export PROJECT_ID=$(gcloud配置获取值项目)</p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lu"><img src="../Images/fab4509e177c44f1c3ddb4d6038964bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qe8PsfzGcTKhK08ID3cDMQ.png"/></div></div></figure><p id="d73f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列出可用文件夹。应该只有一个子文件夹。当你进入它时，你应该看到一个名为Dockerfile的文件。现在您需要运行docker build命令。我们将我们的docker容器映像命名为<em class="lp"> rrobyn，</em>，标签是<em class="lp">最新的(构建将花费30分钟，但您只需要做一次)</em>:</p><blockquote class="lm ln lo"><p id="b169" class="if ig lp ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">docker<strong class="ih hj">build</strong>-t " gcr . io/$ { PROJECT _ ID }/rro byn:latest "。</p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lv"><img src="../Images/365d8d986797faf3b017cc7880f6c4c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FBdmA6Vi-RDiZjW4D8wkTw.png"/></div></div></figure><p id="eed5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">构建过程完成后，将新创建的映像推送到GCP容器注册表:</p><blockquote class="lm ln lo"><p id="294d" class="if ig lp ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">码头工人<strong class="ih hj">推</strong>gcr.io/${PROJECT_ID}/rrobyn:latest</p></blockquote><h1 id="9168" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">步骤2:从自定义docker图像启动顶点AI笔记本</h1><p id="697c" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">进入谷歌云控制台，使用搜索栏查找Vertex AI服务。点击左侧<strong class="ih hj">工作台</strong>，然后点击<strong class="ih hj"> [+新笔记本】</strong>按钮。您将看到一个预定义笔记本电脑环境类型的列表。在本文中，我们将从自定义映像设置笔记本环境；因此，选择<strong class="ih hj">【自定义…】</strong>选项。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/b461c11a5f93f5ec42e21d9aed27504e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LVV1weFcEiYX2sgK"/></div></div></figure><p id="97ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将被要求输入笔记本名称、地区和区域。Google Cloud将使用这些详细信息在请求的地理位置创建相应的计算资源。您还可以在这里指定我们希望使用自定义图像:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lx"><img src="../Images/101284ad517ad3963b712da094107e41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*x5GS_s2pfSvgSNbS"/></div></div></figure><p id="845b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，让我们指定我们的容器图像:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/a041ee6a74bc2a85545581e53bbc4bd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j9IhUqAONFq4E2hl8oQZsA.png"/></div></div></figure><p id="d26b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">单击Create，您应该会在列表中看到一个新的Vertex AI笔记本实例(您可能需要等待几分钟来准备好您的实例):</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lz"><img src="../Images/acc3ef27d154bdafa3eadb73395511f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nl-vvm2RePFUqdk6h9jTRA.png"/></div></div></figure><p id="fb5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<strong class="ih hj">【打开JupyterLab】</strong>按钮，将打开一个新的JupyterLab标签页。<strong class="ih hj">选择R内核:</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ma"><img src="../Images/24c484f92564fb182232fed87b1dc234.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ugVHX6uMqMLAsBluruk9w.png"/></div></div></figure><p id="30e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导入Robyn库并打印其版本，以验证所有工作符合预期。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mb"><img src="../Images/b200a1db66f67ec7b2791c5cf48c8660.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d3eF9mI_M88WibtJ-tjwiw.png"/></div></div></figure><h1 id="bee4" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">第三步:用罗宾做实验</h1><p id="c402" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">Robyn库让您从MMM的统计建模中概念化许多细节。</p><p id="23c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们仔细看看和Robyn一起做MMM时需要的关键步骤。我们希望它能帮助你更好地掌握如何使用这个库的一些基础知识。</p><p id="35f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">典型流程如下图所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mc"><img src="../Images/6b54b4478259c3061e719b3ac7115c16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*chjCWxAAh_rO3Gci5ZwJMg.png"/></div></div></figure><p id="d0b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关键步骤是:</p><ol class=""><li id="2b99" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc md lb lc ld bi translated">数据导入</li><li id="a8e2" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc md lb lc ld bi translated">超参数调谐</li><li id="0bae" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc md lb lc ld bi translated">罗宾造型</li><li id="0b12" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc md lb lc ld bi translated">建模输出解释</li><li id="1b6a" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc md lb lc ld bi translated">预算分配</li></ol><p id="11bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将按照官方文档中的<a class="ae jp" href="https://github.com/facebookexperimental/Robyn/blob/main/demo/demo.R" rel="noopener ugc nofollow" target="_blank">演示脚本</a>来完成这些步骤。</p><h2 id="3e7d" class="me jr hi bd js mf mg mh jw mi mj mk ka iq ml mm ke iu mn mo ki iy mp mq km mr bi translated">数据导入</h2><p id="75d8" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">Robyn库附带了一个演示数据集。当然，在你的实验中，你会使用你的数据，但是如果你正在寻找一些其他来源的模拟数据，那么你可以看看谷歌的<a class="ae jp" href="https://github.com/google/amss" rel="noopener ugc nofollow" target="_blank">聚合营销系统模拟器(AMSS) </a>。</p><p id="4c75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要导入内置Robyn演示数据集，请运行以下说明:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="976f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图显示了该数据集中的几个样本记录:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/b6a3f88bb6e27c6aa5b2174b86f366ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*svQwPKPrDm6p1Tmu"/></div></div></figure><p id="f286" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们仔细看看这个数据集，并从我们的输入数据中了解Robyn所需的格式。</p><p id="90b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第1列—日期:</strong>日期格式必须为年-月-日。取决于数据粒度(周、月等)。)值表示周期的第一天。</p><p id="3320" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第2列—收入:</strong>在这里，我们可以选择您想要优化投资的任何内容，例如销售收入或转换次数</p><p id="4dee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第3–8列—要关联的渠道和非渠道数据:</strong>这些数据或者是已花费的(即电视_S)、印象(即facebook_I)、点击(即search_click_P)、上下文(即竞争对手_销售_B、事件)或者是有机的(即时事通讯)。把你认为可能影响你收入的媒体组合的所有方面，有机的和上下文。</p><p id="d6ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后将您的输入数据映射到<strong class="ih hj"> robyn_inputs </strong>字段:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lj lk l"/></div></figure><h2 id="7bfe" class="me jr hi bd js mf mg mh jw mi mj mk ka iq ml mm ke iu mn mo ki iy mp mq km mr bi translated">为变量转换选择超参数</h2><p id="7bdf" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">Robyn将对媒体支出数据的两个特征进行建模:</p><ol class=""><li id="0d01" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc md lb lc ld bi translated">Adstock(遗留效应)</li><li id="15db" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc md lb lc ld bi translated">收益递减(饱和效应)</li></ol><p id="0ef4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">广告背后的想法是反映广告不会立即带来效果，通常需要一段时间，这就是所谓的<strong class="ih hj">延续效应</strong>。事实上，在观看电视广告和去零售店购买产品之间有一段时间。Robyn给了我们两种方法可供选择:几何方法和更灵活的Weibull方法。如果你想了解更多这些方法，请查看<a class="ae jp" href="https://facebookexperimental.github.io/Robyn/docs/features#variable-transformations" rel="noopener ugc nofollow" target="_blank">文档</a>。在我们的例子中，我们将使用几何变换。</p><p id="a655" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">收益递减，另一方面，</strong><strong class="ih hj"/>说明了一个事实，即我们在特定渠道上投资多少钱和投资将产生多少额外销售收入之间不存在简单的线性依赖关系。在一定程度上，这一渠道将会饱和，额外的资金在这里不会有太大的变化。在这里使用一些数字:假设将投资预算从10万美元增加到15万美元，会给我们带来5万美元的额外销售额，但从15万美元增加到20万美元只会带来3万美元的额外销售额。这些数字只是一个例子，但你明白了。这是一种媒体通道饱和的效果，Robyn使用SCurve变换来模拟这种效果。</p><p id="dd93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Adstock和递减转换模型需要配置参数(theta代表adstock，alpha和gamma代表递减收益)。您无法猜测哪个参数值最适合您的历史数据。幸运的是，这是通过超参数调整自动完成的。Robyn使用Nevergrad优化库来寻找最佳匹配。在这个阶段你能做的是提供边界，定义<a class="ae jp" href="https://facebookresearch.github.io/nevergrad/" rel="noopener ugc nofollow" target="_blank"> Nevergrad </a>应该寻找的搜索空间。<a class="ae jp" href="https://facebookexperimental.github.io/Robyn/docs/features/" rel="noopener ugc nofollow" target="_blank">有关如何解释参数的更多信息，请参见官方文档。</a></p><p id="d6aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">显示完整的参数列表:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="72ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是一个示例，说明如何定义与我们演示数据集中每个单独字段相对应的参数边界:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lj lk l"/></div></figure><h2 id="e19f" class="me jr hi bd js mf mg mh jw mi mj mk ka iq ml mm ke iu mn mo ki iy mp mq km mr bi translated">运行模型</h2><p id="23c5" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">在此阶段，我们已经具备了运行Robyn MMM建模所需的所有条件:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="652a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这一步会生成数千个模型。有些人会比其他人更好。通过帕累托前沿(红线)上的NRMSE(归一化均方根误差:模型误差的度量)和分解RSSD(距离平方和的分解平方根:给定模型有多不现实的度量)的维度来检查哪一个更好。帕累托前沿是多目标优化中相当流行的一个概念。它允许设计者将注意力限制在一组<strong class="ih hj">有效的</strong>选择上，并在这组选择中进行权衡，而不是考虑每个参数的全部范围。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/9229374e0a423cf2240cc95699cde1d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*07NxvhWD10gMJVfJ"/></div></div></figure><p id="f75c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Robyn将从<strong class="ih hj"> Pareto前沿</strong>中选择几个不同的模型，并为每个模型生成一份专门的报告。</p><p id="f8aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是手动检查这几个选定的模型。<strong class="ih hj">为什么手动而不是自动化？</strong>手动审核是必不可少的，因为你想根据你的商业知识/直觉来验证结果。毕竟这些只是模型。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mt"><img src="../Images/5f2970d007f909d2eec62f063d1d10a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XOOGgUXMztdcKOrL"/></div></div></figure><p id="87c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Robyn将尽可能提供帮助，并制作一份内容丰富的报告，用商业术语描述所选模型(“模型一页”):</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/edaa39e9d5488e759c18671897830d3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EbueZnQkWoDZjqij"/></div></div></figure><h2 id="4879" class="me jr hi bd js mf mg mh jw mi mj mk ka iq ml mm ke iu mn mo ki iy mp mq km mr bi translated">理解和解释结果</h2><p id="2c38" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">因此，你面前有一份Robyn制作的报告，你想知道这些漂亮的图表如何帮助你决定如何投资，以优化销售收入或转化率。让我们看看更好地理解这些图表会有什么帮助。让我们假设我们的投资预算应该用于优化销售收入。下面是由生成的图表解释的概念列表:</p><ul class=""><li id="7ce6" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated"><strong class="ih hj">归因:</strong>有多少销售额归因于特定的渠道</li><li id="fb3d" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">实际与预测:</strong>模型在预测实际销售额方面有多好</li><li id="a08f" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">支出份额与影响份额(渠道的总投资回报率):</strong>您在渠道上花费了多少预算，有多少支出归因于您的销售。在这里，您可以了解渠道的投资回报率，以及您是否在无效渠道上超支。</li><li id="243e" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">反应曲线(收益递减):</strong>了解哪些渠道有产生更多销售的空间</li><li id="0422" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">拟合与残差:</strong>了解我们是否遗漏了模型中的任何关键变化</li><li id="b7c9" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj"> Adstock: </strong>了解给定渠道的投资对该渠道销售额的影响时间。这还将显示哪些通道往往转换得更快(数字通道通常转换得更快也就不足为奇了)。</li></ul><p id="1181" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该研究这些度量标准，并使用您的领域知识来拒绝一些被提议的不现实的模型。特别要注意收益递减，因为这里的错误会对预算分配产生很大影响。在这个回顾步骤的最后，你应该对你想继续使用哪个模型有信心。</p><h2 id="c594" class="me jr hi bd js mf mg mh jw mi mj mk ka iq ml mm ke iu mn mo ki iy mp mq km mr bi translated">预算分配器</h2><p id="41dc" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">最后一步是用选定的模型回答下面的问题“我的广告费应该花在哪里”？这就是罗宾的预算分配器派上用场的地方。</p><p id="bcb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Robyn采用您的最佳模型，在付费广告渠道中生成最佳预算分配。为了生成建议，它使用基于梯度的非线性求解器。</p><p id="e771" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建预算分配建议的示例代码:</p><p id="75bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在这里使用了"<strong class="ih hj"> max_historical_response </strong>"场景，它为与上一个周期相同的预算规模创建了一个优化的媒体组合:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="f120" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Robyn使我们能够在为我们计算分配建议时设置一些约束条件，这些约束条件应该由求解器(优化器)使用。在我们的例子中，我们使用了以下约束:</p><ul class=""><li id="eb2f" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated"><strong class="ih hj"> channel_constr_low = 0.7 </strong>，它指示优化器我们不希望每个通道的花费少于历史花费的70%。</li><li id="bf92" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj"> channel_constr_up = c(1.2，1.5，1.5，1.5，1.5) </strong> —指示优化器每个通道的最大支出增长。该顺序与表示我们的通道的输入参数的顺序一致。因此，在本例中，与该频道的历史支出相比,“tv_S”的最大预算被限制为120%,而其他付费媒体的最高预算为150%。</li></ul><p id="2fab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预算分配器生成可视化报告(如下)和表格CSV文件，其中包含新的优化媒体渠道支出组合。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/ec7f5a947caffa53160144897be89557.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uMUDpEaWuLTl6Psq"/></div></div></figure><p id="11e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">生成的图形表示以下内容:</p><ol class=""><li id="c263" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc md lb lc ld bi translated"><strong class="ih hj">初始预算分配与优化预算分配</strong> —显示优化支出占<em class="lp">总</em>媒体预算的百分比。</li><li id="1341" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc md lb lc ld bi translated"><strong class="ih hj">初始与优化平均响应</strong> —预测每个渠道将推动多少销售(转化)。</li><li id="eba7" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc md lb lc ld bi translated"><strong class="ih hj">响应曲线</strong> —优化支出(三角点)如何定位在每个渠道的饱和度曲线上。</li></ol><h1 id="fe71" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">步骤4:自动化MMM分析</h1><p id="08a9" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">Vertex AI笔记本非常适合实验，但一旦我们的入围模型脚本和使用该模型为下一阶段的预算分配生成建议的脚本准备就绪，我们希望定期运行它。然而，我们不想手动启动Vertex AI Notebook实例，然后在每次需要新建议时打开我们的脚本并执行其所有代码单元。</p><p id="166d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">相反，我们希望安排该脚本的执行，并要求Google Cloud为我们运行它，例如，每周一下午5点，这样当我们在周二早上开始喝第一杯咖啡时，我们就可以在电子邮件中收到新的报告。</p><p id="45f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要两个组件:</p><ul class=""><li id="4ef4" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated">调度器，它将触发我们的脚本在一个重复的时间表上执行</li><li id="a09a" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">我们可以在其上执行脚本的计算机</li></ul><p id="0b23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">调度将由GCP调度程序处理:一个完全管理的企业级cron作业调度程序，它作为一个单一的玻璃面板，允许您从一个地方管理您所有的自动化任务。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mu"><img src="../Images/a24c09565b1a159403d529de32933de6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/0*RMUQoFT6aThOUvOT"/></div></figure><p id="b975" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Vertex AI将处理计算，但这次我们不会使用Vertex AI笔记本。相反，我们将利用它的无服务器培训功能。无服务器意味着我们不关心底层基础设施——我们将<strong class="ih hj">委托</strong>执行:这里有我们的脚本；嘿顶点人工智能-执行它。</p><p id="b655" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了与Vertex AI通信，我们将使用它的python SDK。因此，我们需要几行代码来与Vertex AI通信，并指示它我们要执行什么:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="9e94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第9–12行将启动与Vertex AI的新会话(建立通信上下文)。</p><p id="78b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第16行是我们设置一个本地变量的地方，这个变量表示我们之前为Robyn构建的自定义docker图像的URL。</p><p id="f634" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第18–22行是我们指示Vertex AI我们想要在它的基础设施上执行什么的地方(这里，我们的脚本被命名为mmmAnalysis。r)。</p><p id="2e7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Vertex AI将需要知道我们认为这项工作可能需要多少计算能力。我们需要为这些工作者提供一些工作者和一种类型的VM实例。(分别是第25行和第26行)。</p><p id="ed40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第28行是我们发送作业并期望Vertex AI开始执行它的地方。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mv"><img src="../Images/377adafc8961ef8b3b317d8c5d050f96.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/0*yzXGBGg0v9dbPm7x"/></div></figure><p id="76b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这段代码也需要一些计算。然而，在这种情况下，我们可以使用Cloud Functions，这是一个用于这种单一用途功能的无服务器执行环境。</p><h1 id="9b1d" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">总结:</h1><p id="d9c3" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">在这篇文章中，我们展示了如何使用谷歌的机器学习平台Vertex AI来实验Robyn库进行营销组合建模。首先，我们共享了一个定制的Docker文件，其中包含了成功使用Robyn所需的所有依赖项。然后我们用Vertex AI Workbench编译的Docker图像建立了一个交互环境来运行一些实验，并了解媒体渠道和其他变量如何影响我们的销售收入。我们还能够通过Vertex AI定制训练作业自动化大部分过程，在Vertex AI无服务器ML基础设施上运行我们的脚本。自动化的结果是媒体预算分配器，它可以定期运行以生成下一周期的预算分配建议。</p><p id="d536" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你的下一步是激活产生的见解和建议。自动化在这方面也有帮助，但是您可能还希望在最后一步中进行更多的控制，并且将人放在循环中。在这种情况下，您可能希望使用产生的见解和建议，并将它们放在Google的Data Studio或Looker的交互式仪表盘上，然后非技术决策者可以在您公司的媒体战略决策会议上使用它们。</p><blockquote class="lm ln lo"><p id="aa3c" class="if ig lp ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="hi">本文由</em> </strong> <a class="ae jp" href="https://www.linkedin.com/in/lukasz-olejniczak-1a75a613/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="hi">卢卡兹</em> </strong> </a> <strong class="ih hj"> <em class="hi">和</em> </strong> <a class="ae jp" href="https://www.linkedin.com/in/stanis%C5%82aw-magierski-1258507/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="hi">斯坦尼斯劳</em> </strong> </a> <strong class="ih hj"> <em class="hi">合著。所表达的观点是作者的观点，不一定反映谷歌的观点。</em> </strong></p></blockquote><p id="a175" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你喜欢这篇文章，请为它鼓掌。更多google云端数据科学、数据工程、AI/ML关注我<a class="ae jp" href="https://www.linkedin.com/in/lukasz-olejniczak-1a75a613/" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj"><em class="lp">LinkedIn</em></strong></a><strong class="ih hj"><em class="lp">。</em> </strong></p></div></div>    
</body>
</html>