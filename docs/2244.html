<html>
<head>
<title>Move Large Files from GCS bucket using Cloud Function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用云功能从GCS存储桶移动大文件</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/move-large-files-from-gcs-bucket-using-cloud-function-232852b10a4c?source=collection_archive---------0-----------------------#2022-07-03">https://medium.com/google-cloud/move-large-files-from-gcs-bucket-using-cloud-function-232852b10a4c?source=collection_archive---------0-----------------------#2022-07-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/695bedd59bc473e0931c820118204e06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sBRZ3zbEgqdHnrQggyvNpg.png"/></div></div></figure><p id="a7a3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">简介</strong></p><p id="f7ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Cloud Functions是一个<strong class="is hj">轻量级、无服务器、</strong>计算解决方案，开发人员可以创建单一用途的独立功能来响应云事件，而无需管理服务器或运行时环境。</p><p id="832d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我们将利用云功能服务来检测和移动GCS bucket中的大文件。</p><p id="eafa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">要求</strong> -</p><p id="331d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用户将文件上传到GCS存储桶(bkt-src-001)，需要将所有大于1MB的文件移动到另一个存储桶(bkt-dst-001)。</p><p id="afe3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">实现</strong></p><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/695bedd59bc473e0931c820118204e06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sBRZ3zbEgqdHnrQggyvNpg.png"/></div></div></figure><ol class=""><li id="e182" class="js jt hi is b it iu ix iy jb ju jf jv jj jw jn jx jy jz ka bi translated">使用创建文件上的云存储事件创建云函数。</li><li id="59b4" class="js jt hi is b it kb ix kc jb kd jf ke jj kf jn jx jy jz ka bi translated">云函数包含检查文件大小是否大于1MB的代码，然后移动到bucket bkt-dst-001。</li><li id="41f9" class="js jt hi is b it kb ix kc jb kd jf ke jj kf jn jx jy jz ka bi translated">每当用户上传文件到源桶(bkt-src-001)时，它将触发云功能并检查文件大小。</li><li id="258d" class="js jt hi is b it kb ix kc jb kd jf ke jj kf jn jx jy jz ka bi translated">如果文件大小大于1MB，它将移动到目标存储桶(bkt-dst-001)。</li><li id="f488" class="js jt hi is b it kb ix kc jb kd jf ke jj kf jn jx jy jz ka bi translated">如果文件大小为&lt; 1MB it will exit with message.</li></ol><p id="bba2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤1 </strong>创建两个存储桶作为源存储桶和目的存储桶。bkt-src-001 &amp; bkt-dst-001</p><p id="9fe1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤2 </strong>创建云函数</p><p id="7bce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从云控制台&gt;创建函数导航到云函数</p><p id="bc66" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">填写所需的详细信息，如名称、地区等，并选择触发为云存储，如下所示。</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div class="er es kg"><img src="../Images/8c4b387909596ac8c97d04486ddd3e64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*xVz1gMFENe_xm3nLXh_3wg.png"/></div></figure><p id="7eca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">选择运行时为Python 3.7</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div class="er es kh"><img src="../Images/86e3e1f2eafb19cda0c67b451793b2e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*u-JahPjjp5B8kmMTMa3pEw.png"/></div></figure><p id="a1d6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<strong class="is hj"> main.py </strong>中编写登录代码，在<strong class="is hj"> requirements.txt </strong>中编写依赖项(必需的包)</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ki"><img src="../Images/c51e401c5cb7677ff12e12ba6acc7d04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pLfUUoCrTlARKLU9IkcA2w.png"/></div></div><figcaption class="kj kk et er es kl km bd b be z dx translated">main.py</figcaption></figure><figure class="jo jp jq jr fd ij er es paragraph-image"><div class="er es kn"><img src="../Images/d9d3947d5d70591a38b1980d7743e299.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*PIRTDLdDdMNHk-pSr24gZw.png"/></div><figcaption class="kj kk et er es kl km bd b be z dx translated">requirements.txt</figcaption></figure><p id="1b13" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">部署您的云功能。</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/d893804163f9faf598b1d59e06dcc72e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FK6XqPEiKazGXZR3wY4Nqg.png"/></div></div><figcaption class="kj kk et er es kl km bd b be z dx translated">功能现在处于活动状态</figcaption></figure><p id="ed68" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在上传存储桶(bkt-src-001)中的文件以验证您的功能。</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/3ed9ac91d6274f6f6cd129f8f3e4c04b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RAqDSbaxnnYKzG7eDVTOuw.png"/></div></div><figcaption class="kj kk et er es kl km bd b be z dx translated">日志</figcaption></figure><p id="bef2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">视频演示，请参考下面的视频</p><figure class="jo jp jq jr fd ij"><div class="bz dy l di"><div class="kq kr l"/></div></figure></div></div>    
</body>
</html>