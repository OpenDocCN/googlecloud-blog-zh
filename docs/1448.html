<html>
<head>
<title>Deploying Hugo Websites at Warp Speed with a Cloud Build and Firebase Pipeline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过云构建和Firebase管道以极快的速度部署Hugo网站</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/deploying-hugo-websites-at-warp-speed-with-a-cloud-build-and-firebase-pipeline-12b53dbc1d31?source=collection_archive---------1-----------------------#2020-05-29">https://medium.com/google-cloud/deploying-hugo-websites-at-warp-speed-with-a-cloud-build-and-firebase-pipeline-12b53dbc1d31?source=collection_archive---------1-----------------------#2020-05-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div class="er es hg"><img src="../Images/8e9704dcbd8293c58c5e64437c1cfe72.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*mDgcY_QqoDTKrarFTgeFYg.png"/></div></figure><div class=""/><p id="9149" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">像Hugo这样的静态网络平台已经变得流行起来，因为它们能够制作不需要网络服务器的网站。使用静态web平台，不需要修补操作系统，也不需要维护web服务器软件。然而，存在各种操作复杂性。您可能希望对您的帖子进行版本控制，在内容交付网络(“CDN”)上托管您的网站，并提供SSL证书。</p><p id="0965" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您可以通过使用持续集成/持续部署管道来解决这些流程问题。这些管道使开发人员能够通过自动化整个部署过程来快速创新。网站发布平台将使内容作者能够提交新内容，新内容又会启动管道，管道又会执行所有发布任务。</p><p id="5b50" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在本文中，我将向您展示如何利用Google Cloud来创建一个管道，用于部署基于静态站点构建器Hugo的网站。你创建你的网页内容，通过Hugo运行它，Hugo反过来生成网页。我们将使用以下谷歌云服务:</p><ul class=""><li id="39d3" class="jk jl hp io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">云资源存储库将保存内容。该服务提供了私有的Git兼容存储库，当提交到分支时，可以触发云构建管道。如果您愿意，也可以使用GitHub。</li><li id="38c1" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">Firebase将托管该网站。Firebase是一个应用程序框架，提供内容交付网络(CDN)和SSL证书。</li><li id="5cf3" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">云构建将用于创建管道。管道由步骤组成，每个步骤都在一个容器中运行，以产生构建工件。</li></ul><h1 id="f080" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">假设和前提条件</h1><p id="9ffd" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">以下是我对未来的假设。</p><ul class=""><li id="0e8f" class="jk jl hp io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">您可以通过适当的权限访问Google Cloud帐户。</li><li id="1611" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">你熟悉谷歌云的核心概念，如项目和计费账户。</li><li id="b1d5" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">你对云控制台和云外壳的使用已经驾轻就熟了。</li><li id="8c57" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">您了解与Git相关的概念，如克隆和提交代码。</li></ul><h1 id="7da3" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">先来一张图</h1><p id="d66d" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">我想从我们将要建造的东西的图片开始。</p><figure class="lc ld le lf fd hk er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lb"><img src="../Images/b23bb3014b50f545623552e917b90395.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nBIrDf-mkAcpl1ln0P0LBg.png"/></div></div></figure><p id="f399" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">目标是能够提交代码并让它触发管道，管道将依次部署网站。我们的旅程将分为两部分。首先，我们将在本地构建站点，并手动将其部署到Firebase，这样我们就可以了解整个过程。其次，我们将通过使用云构建来构建管道，从而实现流程的自动化。</p><h1 id="b08d" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">手动部署</h1><p id="504a" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">我们将手动构建网站，看看端到端流程会发生什么。我们还将执行一些一次性的任务来启动和运行Firebase，并查看站点的外观。</p><h1 id="6694" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">定义参数</h1><p id="9c2a" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">您需要选择一些将在本文后面使用的值。当您看到文章中的值名称时，请替换您的选择。</p><figure class="lc ld le lf fd hk er es paragraph-image"><div class="er es lk"><img src="../Images/0ba3881ba2dbc6c01c6b684fcf9e206d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*uf918vT0CUA_ivL0A8NvMw.jpeg"/></div></figure><h1 id="85ef" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">创建一个Firebase项目</h1><p id="c4fa" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">让我们从创建一个Firebase项目开始。这将依次建立一个底层的Google Cloud项目，并将其配置为使用Firebase。然后，我们需要设置计费并启用一些API。</p><ol class=""><li id="26e6" class="jk jl hp io b ip iq it iu ix jm jb jn jf jo jj ll jq jr js bi translated">在新的浏览器标签中打开<a class="ae lm" href="https://console.firebase.google.com" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>。</li><li id="9f2b" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">点按“添加项目”或“创建项目”</li><li id="2c48" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">为项目输入“[项目名称]”。如果您希望值为“[PROJECT_ID]”，请编辑建议的项目ID。点击“继续”。</li><li id="01b5" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">在“谷歌分析”页面，禁用谷歌分析，因为这是一个演示。点按“创建项目”</li><li id="e204" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">在新的浏览器标签中打开<a class="ae lm" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云控制台</a>。</li><li id="1361" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">将Firebase项目链接到一个记帐帐户。如果您没有权限执行此操作，请与您组织的管理员合作为您执行此操作。没有付费帐户，您将无法进入下一部分。</li><li id="29f1" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">在“API和服务”菜单中，启用以下API:</li></ol><ul class=""><li id="6100" class="jk jl hp io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">云构建</li><li id="1b02" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">云资源存储库</li></ul><h1 id="8540" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">创建存储库</h1><p id="9d89" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">现在我们有了一个项目，我们需要创建一个存储库，并将其克隆到云Shell中，为将来的提交做准备。</p><p id="d1e7" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">打开云Shell，确保默认项目ID设置为Firebase项目的ID。进入下面。</p><pre class="lc ld le lf fd ln lo lp lq aw lr bi"><span id="d9d9" class="ls jz hp lo b fi lt lu l lv lw">cd ~</span><span id="d8f8" class="ls jz hp lo b fi lx lu l lv lw">gcloud source repos create [REPOSITORY_NAME]</span><span id="23b2" class="ls jz hp lo b fi lx lu l lv lw">gcloud source repos clone [REPOSITORY_NAME]</span></pre><p id="d6b8" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们现在已经克隆了存储库。现在，您应该会在主目录下看到一个同名的目录。</p><h1 id="fda3" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">在本地安装Hugo</h1><p id="d043" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">我们现在将在云壳环境中安装Hugo，这样我们就可以在本地构建网站。</p><ol class=""><li id="dda9" class="jk jl hp io b ip iq it iu ix jm jb jn jf jo jj ll jq jr js bi translated">打开云Shell，确保默认项目ID设置为Firebase项目的ID。</li><li id="cda8" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">从Linux档案的<a class="ae lm" href="https://github.com/gohugoio/hugo/releases/download/v0.69.2/hugo_0.69.2_Linux-64bit.tar.gz" rel="noopener ugc nofollow" target="_blank">版本0.69.2安装Hugo可执行文件。将Hugo可执行文件放在云Shell主目录之外的一个目录中，比如~/bin，并将~/bin添加到您的路径中。</a></li><li id="b5b1" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">在下面输入命令。</li></ol><pre class="lc ld le lf fd ln lo lp lq aw lr bi"><span id="bf83" class="ls jz hp lo b fi lt lu l lv lw">cd ~</span><span id="04d3" class="ls jz hp lo b fi lx lu l lv lw">hugo new site [REPOSITORY_NAME] --force</span></pre><p id="80e9" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">hugo命令将在与克隆的存储库相关联的目录中生成站点支架。</p><p id="961a" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这将在存储库中构建站点的框架。通常hugo命令会创建目录。- force选项将在已经存在的存储库目录中创建站点。</p><h1 id="4d55" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">安装雨果主题</h1><p id="1ff7" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">雨果没有一个默认的主题，所以我们现在将安装阿南刻主题。以下是执行此操作的说明。</p><ol class=""><li id="6fc5" class="jk jl hp io b ip iq it iu ix jm jb jn jf jo jj ll jq jr js bi translated">在临时目录下下载文件<a class="ae lm" href="https://github.com/budparr/gohugo-theme-ananke/archive/master.zip" rel="noopener ugc nofollow" target="_blank">https://github . com/bud parr/go Hugo-theme-an anke/archive/master . zip</a>。</li><li id="15ca" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">提取目录“gohugo-theme-ananke-master”，重命名为“ananke”。</li><li id="1b73" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">将“ananke”目录移到~/[REPOSITORY_NAME]/themes目录下。</li><li id="4cc6" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">使用以下命令将主题添加到Hugo配置文件中:</li></ol><pre class="lc ld le lf fd ln lo lp lq aw lr bi"><span id="30c0" class="ls jz hp lo b fi lt lu l lv lw">echo "theme = “ananke"' &gt;&gt; ~/[REPOSITORY_NAME]/config.toml</span></pre><h1 id="265b" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">预览网站</h1><p id="c0ec" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">您现在可以预览站点了。打开云壳，输入下面的命令。</p><pre class="lc ld le lf fd ln lo lp lq aw lr bi"><span id="1d20" class="ls jz hp lo b fi lt lu l lv lw"><br/>cd ~/[REPOSITORY_NAME]</span><span id="601e" class="ls jz hp lo b fi lx lu l lv lw">hugo server -D --port 8080</span></pre><p id="7ba6" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在使用云壳的Web预览功能查看站点。</p><figure class="lc ld le lf fd hk er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ly"><img src="../Images/458dfddc89cc52120953ab778cf83d0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FIdc0QpOTuwwkKIm"/></div></div></figure><h1 id="6893" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">将现场部署到Firebase</h1><p id="b91f" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">既然我们已经在本地查看了该网站，我们将对Firebase执行一次性部署以验证配置。</p><ol class=""><li id="609c" class="jk jl hp io b ip iq it iu ix jm jb jn jf jo jj ll jq jr js bi translated">如果您之前关闭了云壳，请将其打开。</li><li id="dd89" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">CD ~/[存储库名称]</li><li id="a650" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">你将被要求访问一个谷歌登录网址。<em class="lz">不要点击URL，而是将URL复制并粘贴到您的浏览器中。</em>将得到的授权码粘贴到提示中。</li><li id="b8b9" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">firebase init <br/>使用箭头键和空格键选择主机。当询问项目选项时，选择“使用现有项目”，然后选择[项目名称]。对于公共目录，选择默认值“public”。要配置为单页应用程序，请选择默认值“N”。</li><li id="e97d" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">firebase deploy <br/>应用程序部署完成后，您将会收到一个托管URL。点击它，你会看到由Firebase CDN(内容交付网络)提供服务的同一个网站。如果您收到一般的“欢迎”消息，请等待几分钟，让CDN初始化并刷新浏览器窗口。保存此主机URL以备后用。</li></ol><h1 id="2a5d" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">让我们自动化吧！</h1><p id="8c0b" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">既然我们已经配置了项目并了解了端到端部署流程，我们将通过创建云构建管道来自动化该流程。</p><h1 id="d07e" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">配置版本</h1><p id="a743" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">云构建使用存储库根目录中名为<a class="ae lm" href="https://cloud.google.com/cloud-build/docs/configuring-builds/create-basic-configuration" rel="noopener ugc nofollow" target="_blank"> cloudbuild.yaml </a>的文件来执行构建。</p><ol class=""><li id="f77b" class="jk jl hp io b ip iq it iu ix jm jb jn jf jo jj ll jq jr js bi translated">如果云壳尚未打开，请将其打开。</li><li id="c89c" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">CD ~/[存储库名称]</li><li id="a32c" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">使用您最喜欢的文本编辑器创建包含以下文本的cloudbuild.yaml文件。请注意，Hugo下载URL所在的行实际上与前面的破折号在同一行，firebase deploy命令出现在下面两行，但实际上是一行。另外，请记住，在YAML语法中，间距确实很重要。</li></ol><pre class="lc ld le lf fd ln lo lp lq aw lr bi"><span id="b7ac" class="ls jz hp lo b fi lt lu l lv lw">steps:<br/>- name: 'gcr.io/cloud-builders/wget'<br/>  args:<br/>  - '--quiet'<br/>  - '-O'<br/>  - 'firebase'<br/>  - '<a class="ae lm" href="https://firebase.tools/bin/linux/latest'" rel="noopener ugc nofollow" target="_blank">https://firebase.tools/bin/linux/latest'</a><br/> <br/>- name: 'gcr.io/cloud-builders/wget'<br/>  args:<br/>  - '--quiet'<br/>  - '-O'<br/>  - 'hugo.tar.gz'<br/>  - '<a class="ae lm" href="https://github.com/gohugoio/hugo/releases/download/v${_HUGO_VERSION}/'hugo_extended_${_HUGO_VERSION}_Linux-64bit.tar.gz" rel="noopener ugc nofollow" target="_blank">https://github.com/gohugoio/hugo/releases/download/v${_HUGO_VERSION}/'hugo_extended_${_HUGO_VERSION}_Linux-64bit.tar.gz</a><br/>  waitFor: ['-']<br/> <br/>- name: 'ubuntu:18.04'<br/>  args:<br/>  - 'bash'<br/>  - '-c'<br/>  - |<br/>    mv hugo.tar.gz /tmp<br/>    tar -C /tmp -xzf /tmp/hugo.tar.gz<br/>    mv firebase /tmp<br/>    chmod 755 /tmp/firebase<br/>    /tmp/hugo<br/>    /tmp/firebase deploy --project ${_FIREBASE_PROJECT_NAME} --non-interactive --only hosting -m "Build ${BUILD_ID}"<br/> <br/>substitutions:<br/>  _HUGO_VERSION: 0.69.2</span></pre><p id="7a08" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">关于这个文件的一些观察。</p><ol class=""><li id="90d8" class="jk jl hp io b ip iq it iu ix jm jb jn jf jo jj ll jq jr js bi translated">该文件中有三个命名的步骤，每个步骤都由一个容器映像执行。前两步使用Google支持的构建器执行wget命令来下载Hugo和Firebase工具。这两个步骤并行进行。使用wget构建器比手动安装wget更快。</li><li id="9118" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">第三步使用一个标准的Ubuntu容器来安装Hugo和Firebase，然后构建并部署站点。您还可以创建包含Hugo和Firebase的构建器容器。我选择这种方法有两个原因。第一，能够更改Hugo的版本很有用。第二，我想获得具有最新功能的最新版本的Firebase。</li><li id="c60a" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">该文件还使用了两个定制的<a class="ae lm" href="https://cloud.google.com/cloud-build/docs/configuring-builds/substitute-variable-values" rel="noopener ugc nofollow" target="_blank">替代变量</a> (_HUGO_VERSION和_FIREBASE_PROJECT_NAME)，以允许该模板在不同的环境中使用。</li><li id="cb17" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">Hugo和Firebase二进制文件被创建并安装在一个临时目录中，这样它们就不会被意外地部署到网站上。</li></ol><h1 id="f70b" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">执行初始提交</h1><p id="d897" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">现在我们已经创建了站点中的所有文件，让我们将站点提交回云资源存储库。在此之前，我们需要创建一个. gitignore文件来防止提交额外的文件。打开一个云外壳，输入下面的命令。</p><pre class="lc ld le lf fd ln lo lp lq aw lr bi"><span id="bdb9" class="ls jz hp lo b fi lt lu l lv lw">cd ~/[REPOSITORY_NAME]</span><span id="e022" class="ls jz hp lo b fi lx lu l lv lw">echo "public" &gt;&gt; .gitignore</span><span id="8e22" class="ls jz hp lo b fi lx lu l lv lw">echo "resources" &gt;&gt; .gitignore</span><span id="38b9" class="ls jz hp lo b fi lx lu l lv lw">git config --global user.mail "[GIT_NAME]"</span><span id="45e4" class="ls jz hp lo b fi lx lu l lv lw">git config --global user.email "[GIT_EMAIL]"</span><span id="feca" class="ls jz hp lo b fi lx lu l lv lw">git add .</span><span id="af56" class="ls jz hp lo b fi lx lu l lv lw">git commit -m "Add app to Cloud Source Repositories"</span><span id="f820" class="ls jz hp lo b fi lx lu l lv lw">git push -u origin master</span></pre><h1 id="17ea" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">创建云构建触发器</h1><p id="8fc6" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">为了在变更提交到存储库时启动云构建，我们需要定义一个云构建触发器。按照这些<a class="ae lm" href="https://cloud.google.com/cloud-build/docs/automating-builds/create-manage-triggers" rel="noopener ugc nofollow" target="_blank">步骤</a>创建触发器，进行以下更改:</p><ol class=""><li id="5d6a" class="jk jl hp io b ip iq it iu ix jm jb jn jf jo jj ll jq jr js bi translated">为触发器选择一个名称，如“提交到主分支”。</li><li id="54ab" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">对于事件，选择“Push to a branch”，选择我们之前创建的云源存储库，选择“master”作为分支。</li><li id="50bf" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">对于构建配置文件类型，接受cloudbuild.yaml的默认位置。</li><li id="bda5" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">添加替代变量_FIREBASE_PROJECT_NAME，并将其设置为“[项目名称]”的值(不带引号)。</li></ol><h1 id="21cf" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">更新云构建服务帐户</h1><p id="4d82" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">云构建服务帐户需要拥有使用Firebase部署网站的权限。</p><ol class=""><li id="b6da" class="jk jl hp io b ip iq it iu ix jm jb jn jf jo jj ll jq jr js bi translated">转到云控制台的IAM部分。</li><li id="fdd3" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">找到包含“cloudbuild.gserviceaccount.com”的条目，并将角色“Firebase Hosting Admin”添加到其中。请注意，这个角色是Firebase产品组的一部分。</li></ol><h1 id="162b" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">测试管道</h1><p id="6f18" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">既然已经创建了管道，现在可以对站点进行更改并提交它，看看更改是否会传播。</p><ol class=""><li id="e5b2" class="jk jl hp io b ip iq it iu ix jm jb jn jf jo jj ll jq jr js bi translated">如果云壳尚未打开，请将其打开。</li><li id="4e13" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">CD ~/[存储库名称]</li><li id="7196" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">编辑config.toml文件，将标题改为不同的名称，如“我的新Hugo网站”,并保存更改后的文件。</li><li id="e50c" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">git添加。</li><li id="dc5d" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">git commit -m“更新的网站磁贴”</li><li id="a1e6" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">git push -u原始主机</li><li id="b15b" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">转到云构建控制台并检查构建历史。您应该看到一个成功的部署，如果没有，请查阅构建日志来确定问题。浏览到您之前收到的托管URL。如果没有，可以转到Firebase控制台，检查项目以找到域名。CDN更新可能需要几分钟时间。</li><li id="30d3" class="jk jl hp io b ip jt it ju ix jv jb jw jf jx jj ll jq jr js bi translated">构建成功完成后，查看构建详细信息。总构建时间为25秒。</li></ol><figure class="lc ld le lf fd hk er es paragraph-image"><div class="er es ma"><img src="../Images/38abc76e08d0693703b5450cf59fc718.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/0*vpVDERL9mOX7LTnb"/></div></figure><h1 id="17ed" class="jy jz hp bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">总结一下</h1><p id="af0e" class="pw-post-body-paragraph im in hp io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">Cloud Build可以编排一个管道，将Hugo网站快速部署到Firebase，Firebase提供CDN和SSL证书。云构建允许您定制流程以适应您的需求。较短的部署时间允许您快速创新，并且不费吹灰之力就能测试您的网站版本。更多信息请参考<a class="ae lm" href="https://cloud.google.com/cloud-build/docs" rel="noopener ugc nofollow" target="_blank">云构建</a>和<a class="ae lm" href="https://firebase.google.com/docs" rel="noopener ugc nofollow" target="_blank"> Firebase </a>文档。</p></div></div>    
</body>
</html>