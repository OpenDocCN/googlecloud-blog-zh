<html>
<head>
<title>Docker with Cloud SDK &amp; Environment Variables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有云SDK和环境变量的Docker</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/docker-with-cloud-sdk-environment-variables-adf1310bd5cc?source=collection_archive---------1-----------------------#2020-07-08">https://medium.com/google-cloud/docker-with-cloud-sdk-environment-variables-adf1310bd5cc?source=collection_archive---------1-----------------------#2020-07-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/0df02d94977f4bfef3a8c2d6c2aace5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*1rbZuK6CayCKc9deIylEqg.png"/></div></figure><p id="ec72" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">又见面了。我正在分享我最近在Docker工作时学到的一些东西。要点是如何传入环境变量，在Docker中设置Google Cloud SDK，开启调试。</p><p id="7d75" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因为我以前没有写过关于Docker的文章，所以我提供了Docker的一个简要概述，以给出我的指针的背景和基础。我建议做更多的挖掘，以了解其他地方的更多信息，特别是考虑到有许多其他资源，如这个<a class="ae jk" href="https://docs.docker.com/get-started/overview/" rel="noopener ugc nofollow" target="_blank"> Docker概述</a>。</p><h1 id="0955" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">什么是Docker</h1><p id="0422" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">这是一种在隔离环境中构建和部署软件和应用程序的方式。您可以将构建和运行软件及其所有依赖项的代码打包到一个容器中，该容器实际上可以在任何有能力的计算环境或服务器上运行。它基本上创建了一个计算泡泡来构建和运行你的代码。</p><p id="0469" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">需要了解一些关键概念</p><h2 id="40b3" class="ko jm hi bd jn kp kq kr jr ks kt ku jv ix kv kw jz jb kx ky kd jf kz la kh lb bi translated">Dockerfile文件</h2><p id="1c44" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">Dockerfile <strong class="io hj"> </strong>文件保存了如何创建一个可以在Docker平台上运行的容器的指令。它打包应用程序，指令驱动它运行的服务器配置。</p><h2 id="9ada" class="ko jm hi bd jn kp kq kr jr ks kt ku jv ix kv kw jz jb kx ky kd jf kz la kh lb bi translated">Docker图像</h2><p id="999d" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">Docker文件是您用来构建Docker映像的基础。Docker映像是不可变的指令集，您可以运行它来创建Docker容器，您的软件将最终在该容器中运行和部署。</p><p id="d46a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Docker file = &gt; Docker image = &gt; Docker Container = &gt;独立的代码运行</p><p id="e919" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用此命令构建Docker映像。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="b5da" class="ko jm hi lh b fi ll lm l ln lo">docker build -t [<em class="lp">REGISTRY &amp;/OR IMAGE NAME</em>] .</span></pre><p id="7fb8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您可以在本地创建图像或将其发布到注册表。如果是本地的，就给它一个名字，如果是注册表的，就包括注册表路径和映像的名字。例如，如果我在本地构建它，那么我会用类似于<strong class="io hj"> <em class="lp"> my-docker-image </em> </strong>的东西替换IMAGE，但是如果我发布到注册表，那么我会用类似于<strong class="io hj"><em class="lp">gcr.io/myprojectid/my-docker-image</em></strong>的东西替换它</p><p id="55e1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用“.”也就是说使用当前目录来构建映像。你可以改变。如果文件位于其他位置，则指向一个路径。Dockerfile需要在那个目录中，以及它运行时将加载到容器中的任何文件。</p><h2 id="f334" class="ko jm hi bd jn kp kq kr jr ks kt ku jv ix kv kw jz jb kx ky kd jf kz la kh lb bi translated">Docker注册表</h2><p id="bfdc" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">Docker注册表是您可以存储Docker图像的地方，尤其是当您想要公开共享它们时。您可以使用几个注册表来存储图像，它们可以是公共的，也可以是私有的。几个例子包括<a class="ae jk" href="https://hub.docker.com/search/?type=edition&amp;offering=community" rel="noopener ugc nofollow" target="_blank"> Docker Hub </a>和<a class="ae jk" href="https://cloud.google.com/container-registry" rel="noopener ugc nofollow" target="_blank"> Google容器注册表</a> (gcr.io)。</p><p id="febc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用此命令将图像上传到注册表。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="dfde" class="ko jm hi lh b fi ll lm l ln lo">docker push [<em class="lp">REGISTRY &amp; IMAGE NAME</em>]</span></pre><p id="cd8c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当开始使用Docker时，我发现的常见指导是重用已经构建的图像，以避免重新创建轮子，可以说，在不同的公共注册表中有很多可供选择的图像。</p><h2 id="8226" class="ko jm hi bd jn kp kq kr jr ks kt ku jv ix kv kw jz jb kx ky kd jf kz la kh lb bi translated">码头集装箱</h2><p id="3a2c" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">这是您使用映像启动容器并运行代码的最终目的地。注意，它必须在安装了Docker平台的服务器上运行。</p><p id="3f12" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用此命令运行Docker映像并创建一个容器。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="49e2" class="ko jm hi lh b fi ll lm l ln lo">docker run [<em class="lp">REGISTRY &amp;/OR IMAGE NAME</em>]</span></pre><h1 id="7701" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">添加环境变量</h1><p id="da23" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">当我创建一个容器时，我想传入我的环境变量来增加安全性，并给这些变量一些灵活性。这一步介绍了如何做到这一点。</p><p id="3e2e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在docker文件中为每个变量添加这样一行。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="a070" class="ko jm hi lh b fi ll lm l ln lo">ENV <em class="lp">[ENV VAR CONTAINER NAME] [ENV VAR NAME PASSED IN]</em></span></pre><p id="db10" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="lp">环境变量容器名称</em>是将在Docker容器中使用的环境变量名称，而中传递的<em class="lp">环境变量名称是您传递并分配给该变量的内容。</em></p><p id="5d5c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">特定变量名的示例。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="bf2c" class="ko jm hi lh b fi ll lm l ln lo">ENV PROJECTID $PROJECT_ID</span></pre><p id="7ae1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">运行Docker映像时，将环境变量传递到Docker映像中，如下所示。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="02c0" class="ko jm hi lh b fi ll lm l ln lo">docker run -p 8080:8080 -e PROJECT_ID<em class="lp">=[PROJECT ID] </em>[<em class="lp">IMAGE</em>]</span></pre><p id="da1f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">其中<em class="lp">项目ID </em>是本地bash环境变量的实际值，而<em class="lp"> IMAGE </em>是Docker映像名称和/或您在构建它时给出的注册表路径和名称。</p><h1 id="0f2c" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">安装谷歌云SDK</h1><p id="3dc4" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">将以下指令添加到docker文件中，以安装Google Cloud SDK。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="50c1" class="ko jm hi lh b fi ll lm l ln lo">RUN curl -sSL https://sdk.cloud.google.com | bash</span></pre><p id="f4d2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我发现这一个衬垫作为<a class="ae jk" href="https://stackoverflow.com/questions/28372328/how-to-install-the-google-cloud-sdk-in-a-docker-image" rel="noopener ugc nofollow" target="_blank">堆栈溢出答案</a>。它将确保在您构建Docker映像和运行Docker容器时安装Google Cloud SDK。</p><p id="3937" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">有关SDK映像的更多信息，尤其是那些已经存在的映像，请查看<a class="ae jk" href="https://cloud.google.com/sdk/docs/downloads-docker" rel="noopener ugc nofollow" target="_blank">安装云SDK Docker映像</a>。</p><h1 id="0e5b" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">Docker调试</h1><p id="9dd0" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">我在使用Docker容器时遇到的最大挑战是，当代码失败并且没有像我预期的那样工作时，如何深入了解问题所在。</p><p id="6ccb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">运行Docker时应用-D来打开调试模式。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="cdb6" class="ko jm hi lh b fi ll lm l ln lo">docker -D run [<em class="lp">REGISTRY &amp;/OR IMAGE NAME</em>]</span></pre><p id="43dc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用debug可以在我的终端中记录结果，并允许我获得消息，帮助我查明容器中的问题。因此，当您刚开始使用容器时，一定要使用它。</p><h1 id="3d67" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">包裹</h1><p id="8e1a" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">这篇文章的主要目的是分享我从使用Docker容器中学到的一些东西。主要内容包括如何导入环境变量、如何安装Google Cloud SDK以及如何调试。为了帮助提供这些指针的上下文，我给出了Docker是什么的概述。</p><p id="95ae" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这无疑使我更容易根据需要使用图像在不同的服务器上运行代码。有许多类型设置的图像可以帮助您快速启动和运行服务器。如果你不想花太多时间配置服务器，找到一个Docker镜像来使用或创建一个是值得的。</p></div></div>    
</body>
</html>