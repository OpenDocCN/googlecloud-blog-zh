<html>
<head>
<title>Google Cloud: DML Operation limits in GCP Cloud spanner(mutations)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云:GCP云扳手中的DML操作限制(突变)</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-cloud-dml-operation-limits-in-gcp-cloud-spanner-mutations-95fce3db442?source=collection_archive---------5-----------------------#2022-11-21">https://medium.com/google-cloud/google-cloud-dml-operation-limits-in-gcp-cloud-spanner-mutations-95fce3db442?source=collection_archive---------5-----------------------#2022-11-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="e236" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">Cloud Spanner是一种全面管理的任务关键型关系数据库服务，可在全球范围内提供事务一致性、自动同步复制以实现高可用性。</h1><p id="cf71" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">作为在GCP上开发和构建Cloud Spanner应用程序之前必须了解的一部分，理解Spanner中DML操作的局限性是一个先决条件，这样我们就不会在开发的后期阶段遇到问题。</p><p id="4bb3" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">检查下述限制的要点是DML操作中允许的20K突变数。现在，在插入、更新和删除操作的情况下，这些突变被不同地计数。下面举例说明不同类型的突变计数。</p><h1 id="1a9e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">在云扳手中插入、更新和删除数据的限制:</h1><ul class=""><li id="da16" class="kg kh hi jf b jg jh jk jl jo ki js kj jw kk ka kl km kn ko bi translated"><em class="kp">提交大小(包括索引和更改流):100 MB </em></li><li id="0b72" class="kg kh hi jf b jg kq jk kr jo ks js kt jw ku ka kl km kn ko bi translated"><em class="kp">每个会话的并发读取数:100 </em></li><li id="79d1" class="kg kh hi jf b jg kq jk kr jo ks js kt jw ku ka kl km kn ko bi translated"><em class="kp">每次提交的突变数(包括索引):</em> <strong class="jf hj"> <em class="kp"> 20，000 </em> </strong></li><li id="dc53" class="kg kh hi jf b jg kq jk kr jo ks js kt jw ku ka kl km kn ko bi translated"><em class="kp">每个数据库的并发分区DML语句:20，000条</em></li></ul><h1 id="0571" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated"><strong class="ak">插入DML示例:</strong></h1><ul class=""><li id="c8c6" class="kg kh hi jf b jg jh jk jl jo ki js kj jw kk ka kl km kn ko bi translated"><strong class="jf hj">插入突变是每列1个。如果一行中有10列，那么每插入一行就会有10个突变。每次操作允许的总突变数为20000。</strong></li></ul><p id="10a4" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在下面的例子中，有6列，所以每行的总突变数是6。</p><p id="5c16" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">表中允许的插入总数是20000/6=3333行。</p><p id="3780" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">以下是DML操作的一些测试截图:</p><p id="4c0b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">尝试插入百万条记录，查询失败，因为突变超过(1百万* 6 = 6百万):</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/d619e939fa6319648eb3c17d371b5fdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7OnmH-wwhDs04A9c"/></div></div></figure><p id="9952" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">尝试插入3334条记录，查询失败，因为突变超过(3334 * 6= 20004):</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/fe071a58519506a90e6c7b222100cab3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-JYACxVkg53IqI_9"/></div></div></figure><p id="5c9e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">尝试插入3333条记录，查询成功，因为突变少于20K (3333 * 6= 19，998):</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/b326231cbaf762584fe3c4cd257768c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3xURR9tb0N-nRREU"/></div></div></figure><h1 id="e974" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated"><strong class="ak">更新DML示例:</strong></h1><ul class=""><li id="d531" class="kg kh hi jf b jg jh jk jl jo ki js kj jw kk ka kl km kn ko bi translated"><strong class="jf hj">更新突变是更新的列数+一行中的索引数。例如，如果在具有2个索引的行中有一个列更新，则每行有3个突变。</strong></li></ul><p id="5bb3" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">尝试更新1M行，查询失败，因为突变数为100万(超过20K):</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/2664e8b8f33afaeb76924266336e6676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NgLAoBL7rZCHtG5U"/></div></div></figure><p id="9faf" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">尝试更新10001行中的1列，查询失败，因为突变数为(10001*2=200002)。这里，每行的总突变数为2(我们添加了一列，更新了一列)。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/1ee819446f330e396be38a143b3f7166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*W5zDP1pPwVNg7JzD"/></div></div></figure><p id="14e7" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">尝试更新10000行中的1列，查询成功，因为每行2个突变乘以10K正好得到20K:</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lh"><img src="../Images/a821fb1b82b51d9773805adfc8f07ec8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mN0VyVEFCZ68X1GB"/></div></div></figure><h1 id="acef" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated"><strong class="ak">删除DML示例:</strong></h1><ul class=""><li id="d23c" class="kg kh hi jf b jg jh jk jl jo ki js kj jw kk ka kl km kn ko bi translated"><strong class="jf hj">删除突变是每行删除1个，与索引无关。</strong></li></ul><p id="57ef" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">删除200001行:</p><p id="7e06" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">以下查询失败，因为我们尝试对200001行(200001个突变)执行单一操作。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/17a839b35662afae1b510356c3909d54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QjErtb2oACI4DnJs"/></div></div></figure><p id="848b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">下面的查询成功了，因为我们尝试在一次操作中准确删除20K行(20K个突变)。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es li"><img src="../Images/0a66371068c7a02c60f1a034e7ba222f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VNhwTnwQYkIJBlLP"/></div></div></figure><p id="eb07" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">重要提示:处理这些限制的一种方法是调度查询以批量执行20K突变的操作。我们还必须记住，包括索引和更改流在内的提交大小小于100 MB。</strong></p></div></div>    
</body>
</html>