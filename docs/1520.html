<html>
<head>
<title>Streaming Data Generator Dataflow Flex Template on GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GCP上的流数据生成器数据流灵活模板</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/streaming-data-generator-978846c5c807?source=collection_archive---------0-----------------------#2020-07-16">https://medium.com/google-cloud/streaming-data-generator-978846c5c807?source=collection_archive---------0-----------------------#2020-07-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="37bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们很高兴地宣布推出新的Dataflow Flex模板<strong class="ih hj">流数据生成器</strong>，它支持根据目的地以各种格式(JSON/AVRO/PARQUET)将大量JSON消息连续写入Google Cloud Pub/Sub Topic或BigQuery或云存储。在这篇博文中，我们将简要讨论模板的需求和用法。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/619a4285cd8078eb75fb9c6b9289b2ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*V2jvGCJ4vheQWqCw_LzldA.png"/></div></figure><h1 id="1024" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated"><strong class="ak"> Flex模板</strong></h1><p id="4f44" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">在深入了解流数据生成器模板功能的详细信息之前，让我先从较高的层面介绍一下模板:</p><p id="8e08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ko" href="https://cloud.google.com/dataflow/docs/guides/templates/overview" rel="noopener ugc nofollow" target="_blank">模板</a>的主要目标是以可重用工件的形式打包数据流管道，并支持通过各种渠道(UI / CLI / REST API)启动，以便通过提供所需的管道参数，这些模板可以被各个团队利用。在模板的第一个版本(称为<a class="ae ko" href="https://cloud.google.com/dataflow/docs/guides/templates/creating-templates" rel="noopener ugc nofollow" target="_blank">传统模板</a>)中，管道在GCS上进行，可以从控制台、gcloud命令或其他服务(如云调度程序/功能等)启动。</p><p id="6c7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而传统模板有一定的局限性:<br/> 1 .缺乏对动态DAGS的支持<br/> 2。大量I/O不支持运行时参数</p><p id="dcce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ko" href="https://cloud.google.com/dataflow/docs/guides/templates/using-flex-templates" rel="noopener ugc nofollow" target="_blank"> Flex模板</a>克服了这些限制。Flex模板以docker图像的形式打包数据流管道代码和应用程序依赖项，并将图像存放在Google容器注册表(GCR)中。Flex template launcher服务使用提供的参数启动管道，其方式类似于用户在开发期间启动管道。</p><h1 id="2972" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated"><strong class="ak">什么是流数据生成器？</strong></h1><p id="8c79" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">流数据生成器模板可用于根据用户提供的模式，以指定的速率(每秒消息数)向Google Cloud发布/订阅主题或BigQuery或云存储发布虚假的JSON消息。<a class="ae ko" href="https://github.com/vincentrussell/json-data-generator" rel="noopener ugc nofollow" target="_blank">流水线使用的JSON数据生成器</a> <strong class="ih hj"> </strong>库支持各种faker函数与schema字段关联。管道支持配置参数来控制每秒发布的消息数量(即QPS)和所需的资源(通过自动缩放)</p><p id="09ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一些可能的用例是:</p><ol class=""><li id="c98a" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">模拟向发布/订阅主题发布大规模实时事件，以测量和确定处理发布事件所需的消费者数量和规模。</li><li id="721b" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">向BigQuery表或云存储桶生成合成数据，以评估性能基准或用作概念证明。</li></ol><p id="aa7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就您可以生成的事件类型而言，可能性是无穷无尽的。</p><h1 id="3680" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated"><strong class="ak">如何经营管道？</strong></h1><p id="b52f" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">可以从云控制台或通过gcloud命令启动管道。</p><p id="24dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从<code class="du ld le lf lg b">cloud console</code>启动:</p><ol class=""><li id="ef56" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">进入云控制台的<a class="ae ko" href="https://console.cloud.google.com/dataflow/jobs" rel="noopener ugc nofollow" target="_blank">数据流页面</a></li><li id="eb34" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ku kv kw kx bi translated">点击<strong class="ih hj">从模板</strong>创建作业。</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lh"><img src="../Images/3da4d6ec43b37bb8a07a4c03a74455b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/0*GFt5JIKXZ1mUH7k4"/></div></figure><p id="fdf0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.从<strong class="ih hj">数据流模板</strong>下拉菜单中选择流数据生成器</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es li"><img src="../Images/6a6c7731ac3897fdf4530752f2aae456.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*TSj9QDWd1y44kLr69XBL2g.png"/></div></div></figure><p id="0e59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.输入作业名称</p><p id="a5d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.输入所需的参数，如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ln"><img src="../Images/26046109a91d26b10972b77950aa11d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*0auM8QNndw1x7SrqQyL9TQ.png"/></div></figure><p id="6ae1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.根据接收器类型、输出编码、autoScalingAlgorithm和maxNumWorkers等输入其他参数，如接收器详细信息</p><p id="ee68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.单击运行作业</p><p id="9903" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要使用<code class="du ld le lf lg b">gcloud</code>启动管道将消息发布到云发布/订阅，请使用以下命令:</p><pre class="je jf jg jh fd lo lg lp lq aw lr bi"><span id="f542" class="ls jm hi lg b fi lt lu l lv lw">gcloud beta dataflow flex-template run ${JOB_NAME} \<br/> —-project=${YOUR_PROJECT_ID} \<br/> —-region=${REGION_NAME} \<br/> —-template-file-gcs-location=gs://dataflow-templates/latest/flex/Streaming_Data_Generator \<br/> —-parameters \<br/>schemaLocation=${SCHEMA_LOCATION}\<br/>qps=${QPS},\<br/>topic=${PUBSUB_TOPIC}</span></pre><h1 id="90c0" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">参考</h1><ul class=""><li id="8487" class="kp kq hi ih b ii kj im kk iq lx iu ly iy lz jc ma kv kw kx bi translated">代码可在<a class="ae ko" href="https://github.com/GoogleCloudPlatform/DataflowTemplates/tree/master/v2/streaming-data-generator" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得</li><li id="4da3" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ma kv kw kx bi translated">关于文件，请参考<a class="ae ko" href="https://cloud.google.com/dataflow/docs/guides/templates/provided-utilities#streamingdatagenerator" rel="noopener ugc nofollow" target="_blank">数据流文件</a></li><li id="4b10" class="kp kq hi ih b ii ky im kz iq la iu lb iy lc jc ma kv kw kx bi translated">各种<a class="ae ko" href="https://cloud.google.com/dataflow/docs/guides/templates/provided-batch" rel="noopener ugc nofollow" target="_blank">批次</a>和<a class="ae ko" href="https://cloud.google.com/dataflow/docs/guides/templates/provided-streaming" rel="noopener ugc nofollow" target="_blank">流</a>模板的云数据流文档。</li></ul></div></div>    
</body>
</html>