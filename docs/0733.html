<html>
<head>
<title>Cloud Build is not just for Containers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云构建不仅仅针对容器</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/cloud-build-is-not-just-for-containers-bc1ecc075b5?source=collection_archive---------1-----------------------#2018-08-20">https://medium.com/google-cloud/cloud-build-is-not-just-for-containers-bc1ecc075b5?source=collection_archive---------1-----------------------#2018-08-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="1246" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">Stackoverflow离题</h2></div><p id="1005" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Stackoverflow上有一个<a class="ae jt" href="https://stackoverflow.com/questions/51901930" rel="noopener ugc nofollow" target="_blank">问题</a>是关于Cloud Build是否可以用来编译Java，而不将结果发布为容器映像。</p><p id="7661" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个问题吸引了我，因为…云构建不仅仅是针对容器的。这里如何…</p><p id="2bf2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">两种方式；-)先用javac再用Maven (mvn)。</p><h2 id="b1ab" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">设置</h2><p id="1bbf" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">我用的是谷歌云资源仓库，但是如果你愿意，你也可以用GitHub或者Bitbucket。这是在本地构建了类和jar之后的回购树。这是为了向您提供一个可视化的帮助，让您了解云构建容器上正在发生的事情:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="c10a" class="ju jv hi kz b fi ld le l lf lg">.<br/>├── cloudbuild.yaml<br/>├── pom.xml<br/>├── src<br/>│   └── main<br/>│       └── java<br/>│           └── example<br/>│               └── HelloHenry.java<br/>└── target<br/>    ├── classes<br/>    │   └── example<br/>    │       └── HelloHenry.class<br/>    ├── generated-sources<br/>    │   └── annotations<br/>    ├── hellohenry-0.1.jar<br/>    ├── maven-archiver<br/>    │   └── pom.properties<br/>    └── maven-status<br/>        └── maven-compiler-plugin<br/>            └── compile<br/>                └── default-compile<br/>                    ├── createdFiles.lst<br/>                    └── inputFiles.lst</span></pre><blockquote class="lh li lj"><p id="521c" class="ix iy lk iz b ja jb ij jc jd je im jf ll jh ji jj lm jl jm jn ln jp jq jr js hb bi translated"><strong class="iz hj"> NB </strong>琐碎的<code class="du lo lp lq kz b">HelloHenry.java</code>出处在帖子最后，供参考。创建它只是为了有东西可以编译。</p></blockquote><p id="822a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您需要创建您在上面的触发器中引用的Google云存储桶，并将托管工件:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="6b7f" class="ju jv hi kz b fi ld le l lf lg">PROJECT=[[YOUR-PROJECT]]<br/>REGION=[[YOUR-REGION]]<br/>BUCKET=[[YOUR-BUCKET]]</span><span id="46e0" class="ju jv hi kz b fi lr le l lf lg">gsutil mb \<br/>-c regional \<br/>-l ${REGION} \<br/>-p ${PROJECT} \<br/>gs://${BUCKET}</span></pre><h2 id="0f19" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">javac</h2><p id="1905" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">cloudbuild.yaml:</p><figure class="ku kv kw kx fd ls"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="386b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是云构建触发器:</p><figure class="ku kv kw kx fd ls er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es lv"><img src="../Images/d12c30254702e8e06061e1d72b9f1e17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bxmf5tqk4CvyNcuGKnw63w.png"/></div></div></figure><blockquote class="lh li lj"><p id="a2a6" class="ix iy lk iz b ja jb ij jc jd je im jf ll jh ji jj lm jl jm jn ln jp jq jr js hb bi translated"><strong class="iz hj"> NB </strong>这个触发器定义了三个自定义变量替换:<code class="du lo lp lq kz b">${_JAVA}</code>指的是源文件(Java)；<code class="du lo lp lq kz b">${_BUCKET}</code>指的是<code class="du lo lp lq kz b">[[YOUR-BUCKET]]</code>的值，也是<code class="du lo lp lq kz b">${_CLASS}</code>文件将要上传的地方。</p></blockquote><p id="d76a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以下是构建细节:</p><figure class="ku kv kw kx fd ls er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mc"><img src="../Images/8a9b509327cd568fcb68f4bf2309fa8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uahQxFT0EqMQ5E1ZQAiauQ.png"/></div></div></figure><p id="d230" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">云存储桶的浏览见末尾。</p><h2 id="1ffd" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">专家</h2><p id="8b05" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">cloudbuild.yaml:</p><figure class="ku kv kw kx fd ls"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="9cce" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是构建触发器。它由Google Cloud Source Repository触发并使用其中的资源。它寻找一个<code class="du lo lp lq kz b">cloudbuild.yaml</code>文件来控制构建。</p><figure class="ku kv kw kx fd ls er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es md"><img src="../Images/073485beaa857adc378d387be36529fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X1NKVTnSFPl-SK3nrhvSCw.png"/></div></div></figure><blockquote class="lh li lj"><p id="10ae" class="ix iy lk iz b ja jb ij jc jd je im jf ll jh ji jj lm jl jm jn ln jp jq jr js hb bi translated"><strong class="iz hj"> NB </strong>这个触发器定义了两个用户定义的替换变量:<code class="du lo lp lq kz b">_BUCKET </code>你应该用<code class="du lo lp lq kz b">[[YOUR-BUCKET]]</code>和<code class="du lo lp lq kz b">_TARGET</code>的值来替换它们，比如说，这是你的Maven包进程将要创建的jar的名字，你想要把它复制到云存储中。</p></blockquote><p id="b7a8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是构建输出:</p><figure class="ku kv kw kx fd ls er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es me"><img src="../Images/7608d04ab159f29beb35eeb54d1746c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RbVmJtRHd8v47RwkYnvvTQ.png"/></div></div></figure><h2 id="2075" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">成功！</h2><p id="60ba" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">这是在我运行了<code class="du lo lp lq kz b">javac</code>和<code class="du lo lp lq kz b">mvn</code>构建之后的bucket内容列表:</p><figure class="ku kv kw kx fd ls er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mf"><img src="../Images/9b58c9840d4138046e009bf62f8b0111.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6WMGMTCcgPbIJsZBI9WafA.png"/></div></div></figure><p id="455a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如您所看到的，每个构建都创建了一个工件-*。json文件。对于<code class="du lo lp lq kz b">javac</code>构建，HelloHenry.class被上传。对于<code class="du lo lp lq kz b">mvn</code>版本，<code class="du lo lp lq kz b">hellohenry-0.1jar</code>已上传。</p><h2 id="24f0" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">结论</h2><p id="e043" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">这是一个可以理解的假设，但是云构建不限于构建docker映像。它甚至不限于构建docker映像或在云存储上存储文件。实际上，它是一个通用的管道工具。它只是使用docker容器来定义它的处理步骤。这是一个很好的工具！</p><p id="bbe5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是Java源代码:</p><figure class="ku kv kw kx fd ls"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="bceb" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">仅此而已！</p></div></div>    
</body>
</html>