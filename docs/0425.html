<html>
<head>
<title>Deploy ‘fabcar’ on Hyperledger Fabric</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Hyperledger结构上部署“fabcar”</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/deploy-fabcar-on-hyperledger-fabric-93c082c31b7a?source=collection_archive---------1-----------------------#2017-11-04">https://medium.com/google-cloud/deploy-fabcar-on-hyperledger-fabric-93c082c31b7a?source=collection_archive---------1-----------------------#2017-11-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="ad3a" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">区块链历险记</h2></div><p id="6e7a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将在11月花时间提高我对区块链技术的了解(并为11月的<a class="ae jt" href="https://mobro.co/dazwilkin" rel="noopener ugc nofollow" target="_blank">日</a>留胡子)。我从舒适区开始，将Hyperledger Fabric部署到谷歌云平台(GCP)虚拟机，并通过“fabcar”<a class="ae jt" href="http://hyperledger-fabric.readthedocs.io/en/latest/write_first_app.html" rel="noopener ugc nofollow" target="_blank">示例</a>应用程序进行旋转。</p><p id="3888" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">部署fabcar和运行fabcar非常简单，所以这篇文章主要是作为一篇基础文章，如果你想在GCP上运行fabcar，你可能会感兴趣。</p><h2 id="a185" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">超分类帐结构</h2><p id="930c" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">我在GCP的Ubuntu 16.04虚拟机上运行一切。如果你没有GCP帐户，你可以在这里免费开始使用<a class="ae jt" href="https://cloud.google.com/getting-started/" rel="noopener ugc nofollow" target="_blank"/>。我假设您使用安装了Google的Cloud SDK的Linux机器来创建VM:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="61ce" class="ju jv hi kz b fi ld le l lf lg">BILLING=[[YOUR-BILLING-ID]]<br/>PROJECT=[[YOUR-PROJECT-ID]]<br/>ZONE=[[YOUR-PREFERRED-ZONE]] // us-west1-c</span><span id="16ce" class="ju jv hi kz b fi lh le l lf lg">INSTANCE=hyperledger-fabric-01</span><span id="a9a6" class="ju jv hi kz b fi lh le l lf lg">gcloud alpha projects create $PROJECT</span><span id="c2e6" class="ju jv hi kz b fi lh le l lf lg">gcloud alpha billing projects link $PROJECT --account-id=$BILLING</span><span id="ee9f" class="ju jv hi kz b fi lh le l lf lg">gcloud services enable compute.googleapis.com --project=$PROJECT</span><span id="b612" class="ju jv hi kz b fi lh le l lf lg">gcloud compute instances create ${INSTANCE} \<br/>--project=${PROJECT} \<br/>--zone=${ZONE} \<br/>--machine-type=custom-2-8192 \<br/>--image=ubuntu-1604-xenial-v20171011 \<br/>--image-project=ubuntu-os-cloud \<br/>--boot-disk-size=50 \<br/>--boot-disk-type=pd-standard \<br/>--boot-disk-device-name=${INSTANCE}</span><span id="b732" class="ju jv hi kz b fi lh le l lf lg">gcloud compute ssh ${INSTANCE} \<br/>--zone=${ZONE} \<br/>--project=${PROJECT}</span></pre><p id="0a17" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从“hyperledger-fabric-01”上的ssh会话中，我们需要安装多个先决条件组件。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="13dc" class="ju jv hi kz b fi ld le l lf lg"><a class="ae jt" href="https://hyperledger-fabric.readthedocs.io/en/release/prereqs.html" rel="noopener ugc nofollow" target="_blank">https://hyperledger-fabric.readthedocs.io/en/release/prereqs.html</a></span></pre><p id="bd15" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">开始了。</p><p id="54c2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> Docker-CE </strong></p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="3490" class="ju jv hi kz b fi ld le l lf lg">sudo apt-get update</span><span id="89dc" class="ju jv hi kz b fi lh le l lf lg">sudo apt-get install \<br/>    linux-image-extra-$(uname -r) \<br/>    linux-image-extra-virtual</span><span id="1bdf" class="ju jv hi kz b fi lh le l lf lg">sudo apt-get update</span><span id="aa37" class="ju jv hi kz b fi lh le l lf lg">sudo apt-get install \<br/>    apt-transport-https \<br/>    ca-certificates \<br/>    curl \<br/>    software-properties-common</span><span id="5247" class="ju jv hi kz b fi lh le l lf lg">curl -fsSL <a class="ae jt" href="https://download.docker.com/linux/ubuntu/gpg" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/ubuntu/gpg</a> | sudo apt-key add -</span><span id="0696" class="ju jv hi kz b fi lh le l lf lg">sudo add-apt-repository \<br/>   "deb [arch=amd64] <a class="ae jt" href="https://download.docker.com/linux/ubuntu" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/ubuntu</a> \<br/>   $(lsb_release -cs) \<br/>   stable"</span><span id="fea4" class="ju jv hi kz b fi lh le l lf lg">sudo apt-get update<br/>sudo apt-get install docker-ce<br/>sudo usermod -aG docker $USER<br/>sudo systemctl enable docker</span><span id="7938" class="ju jv hi kz b fi lh le l lf lg">docker --version</span></pre><p id="58a7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> docker-compose </strong></p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="6563" class="ju jv hi kz b fi ld le l lf lg">sudo curl -L <a class="ae jt" href="https://github.com/docker/compose/releases/download/1.16.1/docker-compose-`uname" rel="noopener ugc nofollow" target="_blank">https://github.com/docker/compose/releases/download/1.16.1/docker-compose-`uname</a> -s`-`uname -m` -o /usr/local/bin/docker-compose</span><span id="a369" class="ju jv hi kz b fi lh le l lf lg">sudo chmod +x /usr/local/bin/docker-compose</span><span id="a15a" class="ju jv hi kz b fi lh le l lf lg">docker-compose --version</span></pre><p id="e74a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">戈朗</strong></p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="7d78" class="ju jv hi kz b fi ld le l lf lg">VERSION=1.9.1<br/>OS=linux<br/>ARCH=amd64<br/>sudo curl \<br/>--location <a class="ae jt" href="https://golang.org/dl/go$VERSION.$OS-$ARCH.tar.gz" rel="noopener ugc nofollow" target="_blank">https://golang.org/dl/go$VERSION.$OS-$ARCH.tar.gz</a> \<br/>--output go$VERSION.$OS-$ARCH.tar.gz</span><span id="c29f" class="ju jv hi kz b fi lh le l lf lg">sudo tar -C /usr/local -xzf go$VERSION.$OS-$ARCH.tar.gz</span><span id="50fc" class="ju jv hi kz b fi lh le l lf lg">export PATH=$PATH:/usr/local/go/bin</span><span id="8afa" class="ju jv hi kz b fi lh le l lf lg">go version</span></pre><p id="c18f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> Node.js </strong></p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="1bc1" class="ju jv hi kz b fi ld le l lf lg">curl -sL <a class="ae jt" href="https://deb.nodesource.com/setup_6.x" rel="noopener ugc nofollow" target="_blank">https://deb.nodesource.com/setup_6.x</a> | sudo -E bash -<br/>sudo apt-get install -y nodejs</span><span id="506a" class="ju jv hi kz b fi lh le l lf lg">nodejs --version<br/>v6.11.5</span><span id="3e98" class="ju jv hi kz b fi lh le l lf lg">npm --version<br/>3.10.10</span></pre><p id="2939" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">降级Python(在Ubuntu上)</strong></p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="2ae5" class="ju jv hi kz b fi ld le l lf lg">sudo apt-get install python</span><span id="fe07" class="ju jv hi kz b fi lh le l lf lg">python --version<br/>Python 2.7.12</span></pre><h2 id="022c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">面料样品:fabcar</h2><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="cb5b" class="ju jv hi kz b fi ld le l lf lg">git clone https://github.com/hyperledger/fabric-samples.git</span><span id="ae21" class="ju jv hi kz b fi lh le l lf lg">cd fabric-samples/fabcar</span></pre><p id="bac5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">技巧:Hyperledger在dockerhub上托管结构容器。因为这些是为各种运行时架构构建的，所以没有单一的“最新”容器。诀窍是识别和下载容器的最新版本，它们在方便的锁步中被版本化，然后用“最新”标记它们。以下是Linux X86_64的脚本:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="96e4" class="ju jv hi kz b fi ld le l lf lg">TAG=x86_64-1.0.3<br/>for IMAGE in orderer couchdb peer ca tools<br/>do<br/>  docker pull hyperledger/fabric-${IMAGE}:${TAG} &amp;&amp; \<br/>  docker tag hyperledger/fabric-${IMAGE}:${TAG} hyperledger/fabric-${IMAGE}:latest<br/>done</span></pre><p id="7c6c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">完成后:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="1917" class="ju jv hi kz b fi ld le l lf lg">docker images \<br/>--format="{{ .Tag }}\t{{ .Repository }}" \<br/>| grep hyperledger \<br/>| sort</span><span id="d85e" class="ju jv hi kz b fi lh le l lf lg">latest  hyperledger/fabric-ca<br/>latest  hyperledger/fabric-couchdb<br/>latest  hyperledger/fabric-orderer<br/>latest  hyperledger/fabric-peer<br/>latest  hyperledger/fabric-tools</span><span id="bbc1" class="ju jv hi kz b fi lh le l lf lg">x86_64-1.0.3    hyperledger/fabric-ca<br/>x86_64-1.0.3    hyperledger/fabric-ccenv<br/>x86_64-1.0.3    hyperledger/fabric-couchdb<br/>x86_64-1.0.3    hyperledger/fabric-orderer<br/>x86_64-1.0.3    hyperledger/fabric-peer<br/>x86_64-1.0.3    hyperledger/fabric-tools</span></pre><p id="2555" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后运行以下命令来运行结构测试集群:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="9865" class="ju jv hi kz b fi ld le l lf lg">./startFabric.sh</span></pre><p id="22bf" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您应该会看到一串日志结束于:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="0621" class="ju jv hi kz b fi ld le l lf lg">2017-11-04 00:03:42.880 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 00a Chaincode invoke successful. result: status:200 <br/>2017-11-04 00:03:42.880 UTC [main] main -&gt; INFO 00b Exiting.....</span><span id="6718" class="ju jv hi kz b fi lh le l lf lg">Total execution time : 33 secs ...</span></pre><p id="1692" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">而且，您应该能够:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="6bd9" class="ju jv hi kz b fi ld le l lf lg">docker ps --format="{{ .ID }}\t{{ .Names }}"</span><span id="5b30" class="ju jv hi kz b fi lh le l lf lg">bdcad9115060    dev-peer0.org1.example.com-fabcar-1.0<br/>e3a219fd5c50    cli<br/>160318483edd    peer0.org1.example.com<br/>5caa3f261c05    couchdb<br/>f1b93255fa5d    ca.example.com<br/>385d784e0581    orderer.example.com</span></pre><p id="9135" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">好吧！还有一个先决条件步骤:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="b934" class="ju jv hi kz b fi ld le l lf lg">sudo apt-get install build-essential</span><span id="4303" class="ju jv hi kz b fi lh le l lf lg">npm install</span></pre><p id="f70f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您应该能够:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="69b6" class="ju jv hi kz b fi ld le l lf lg">node query.js</span><span id="3000" class="ju jv hi kz b fi lh le l lf lg">Create a client and set the wallet location<br/>Set wallet path, and associate user  PeerAdmin  with application<br/>Check user is enrolled, and set a query URL in the network<br/>Make query<br/>Assigning transaction_id:  2b7d262eca16c68523fe61331f08114110f6c6b4d6f1d4725063fcb00d8da4d7<br/>returned from query<br/>Query result count =  1<br/>Response is  [<br/>{"Key":"CAR0", "Record":{"colour":"blue","make":"Toyota","model":"Prius","owner":"Tomoko"}},{"Key":"CAR1", "Record":{"colour":"red","make":"Ford","model":"Mustang","owner":"Brad"}},{"Key":"CAR2", "Record":{"colour":"green","make":"Hyundai","model":"Tucson","owner":"Jin Soo"}},<br/>{"Key":"CAR3", "Record":{"colour":"yellow","make":"Volkswagen","model":"Passat","owner":"Max"}},{"Key":"CAR4", "Record":{"colour":"black","make":"Tesla","model":"S","owner":"Adriana"}},{"Key":"CAR5", "Record":{"colour":"purple","make":"Peugeot","model":"205","owner":"Michel"}},{"Key":"CAR6", "Record":{"colour":"white","make":"Chery","model":"S22L","owner":"Aarav"}},{"Key":"CAR7", "Record":{"colour":"violet","make":"Fiat","model":"Punto","owner":"Pari"}},{"Key":"CAR8", "Record":{"colour":"indigo","make":"Tata","model":"Nano","owner":"Valeria"}},{"Key":"CAR9", "Record":{"colour":"brown","make":"Holden","model":"Barina","owner":"Shotaro"}}<br/>]</span></pre><p id="3db2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我不会在这里重复织物教程，而是:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="1e82" class="ju jv hi kz b fi ld le l lf lg"><a class="ae jt" href="https://hyperledger-fabric.readthedocs.io/en/latest/write_first_app.html" rel="noopener ugc nofollow" target="_blank">https://hyperledger-fabric.readthedocs.io/en/latest/write_first_app.html</a></span></pre><h2 id="f937" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">结论</h2><p id="06e6" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">先不说先决条件，让Fabric测试集群运行并使用“fabcar”样本是很简单的。Fabric是用Golang编写的，支持Golang和Java for contracts，在本例中，还支持Node.js作为客户端。</p><h2 id="1b9a" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">拆毁</h2><p id="fff9" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">要关闭结构群集，请执行以下操作:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="7dc3" class="ju jv hi kz b fi ld le l lf lg">cd ../basic-network<br/>docker-compose --file ./docker-compose.yml down</span><span id="9293" class="ju jv hi kz b fi lh le l lf lg">Stopping cli                    ... done<br/>Stopping peer0.org1.example.com ... done<br/>Stopping orderer.example.com    ... done<br/>Stopping couchdb                ... done<br/>Stopping ca.example.com         ... done<br/>Removing cli                    ... done<br/>Removing peer0.org1.example.com ... done<br/>Removing orderer.example.com    ... done<br/>Removing couchdb                ... done<br/>Removing ca.example.com         ... done<br/>Removing network net_basic</span></pre><p id="c895" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以从所有ssh会话中“退出”。</p><p id="8906" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您应该会返回到您的主机会话。就是你运行gcloud命令的那个。您可以停止hyperledger-fabric-01虚拟机:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="c97c" class="ju jv hi kz b fi ld le l lf lg">gcloud compute instances stop ${INSTANCE} \<br/>--zone=${ZONE} \<br/>--project=${PROJECT}</span></pre><p id="9af1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">或者(永久)删除它:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="6dc5" class="ju jv hi kz b fi ld le l lf lg">gcloud compute instances delete $(INSTANCE} \<br/>--zone=${ZONE} \<br/>--project=${PROJECT}<br/>--quiet</span></pre><p id="60a7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">或者干脆删除整个GCP项目:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="9342" class="ju jv hi kz b fi ld le l lf lg">gcloud alpha projects delete ${PROJECT} --quiet</span></pre><p id="3336" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就是这样！</p></div></div>    
</body>
</html>