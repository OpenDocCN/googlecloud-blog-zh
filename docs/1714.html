<html>
<head>
<title>GCP IAM roles explained</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GCP IAM角色解释</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/gcp-iam-roles-explained-af84955346e7?source=collection_archive---------0-----------------------#2020-12-16">https://medium.com/google-cloud/gcp-iam-roles-explained-af84955346e7?source=collection_archive---------0-----------------------#2020-12-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="f63e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">何时使用基本角色、预定义角色和自定义角色</h1><h1 id="c72d" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">介绍</h1><p id="fa19" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这是我参与的每一个客户项目都会出现的一个话题:在GCP，我的角色是什么？我们应该如何去做？在我作为Google Cloud Professional Services的一部分的工作中，我必须编写一些文档，详细解释每种类型对于各种用例的优缺点，并为每个客户特定的用例提出建议。</p><p id="edb7" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这促使我创建了这个帖子，让任何人都可以轻松地决定他们在GCP的IAM角色策略。首先，我将提供一些关于IAM如何在GCP工作的更多背景，如果你习惯于其他云提供商，或者不熟悉GCP，这可能是有用的。然后，我将描述每个IAM角色类型，以帮助您最终为自己的组织做出决策。</p><p id="fd6f" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">作为一般规则，我们建议使用预定义的角色来限制复杂性。在某些情况下，让客户自己管理自定义角色可能是有意义的，但是考虑到与之相关的额外开销，应该仔细考虑这个决定。</p><h1 id="dea9" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">IAM绑定</h1><p id="a732" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在Cloud IAM中，身份(即用户、组和服务帐户)可以通过 <a class="ae kg" href="https://cloud.google.com/iam/docs/policies?hl=en" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj"> IAM策略</strong> </a>获得对资源API的<strong class="jf hj">访问。在这些策略中，您可以定义一个或多个<a class="ae kg" href="https://cloud.google.com/iam/docs/policies?hl=en#multiple-bindings" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj">绑定</strong> </a> <strong class="jf hj">，其中的成员被授予一个</strong> <a class="ae kg" href="https://cloud.google.com/iam/docs/understanding-roles?hl=en#role_types" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj"> IAM角色</strong> </a>。这将绑定的成员与在该策略级别(组织、文件夹或项目)</strong> <strong class="jf hj">和更低(如果有)</strong>授予该角色<strong class="jf hj">的所有权限相关联。</strong></p><p id="dc56" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">重要的是要明白<a class="ae kg" href="https://cloud.google.com/iam/docs/viewing-grantable-roles?hl=en" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj">角色只能在特定级别</strong> </a>授予。例如，文件夹查看者角色在项目级别没有意义，因为其权限访问的资源不在项目级别。您通常会在项目或资源级别(例如云存储空间)授予IAM角色，但是您也可以在文件夹或组织级别授予IAM角色。</p><p id="2e63" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">角色由“权限”组成。这些权限通常可以被认为是对特定Google Cloud API调用的访问控制。例如，storage.buckets.list权限只允许访问列出存储桶的API调用。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/b1cd5408d87cf5785b835b3e01b8a062.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Aq9PPlnriYCmSFsuUj1SFw.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">给定项目可用的IAM角色示例</figcaption></figure><p id="0984" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">最后，一定要注意可能会影响您的部署策略的<a class="ae kg" href="https://cloud.google.com/iam/quotas" rel="noopener ugc nofollow" target="_blank"> IAM限制和配额</a>(例如，绑定中的最大成员或组数量)。</p><h1 id="463a" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">基本角色</h1><p id="4e81" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><a class="ae kg" href="https://cloud.google.com/iam/docs/understanding-roles#basic" rel="noopener ugc nofollow" target="_blank">基本角色</a>(以前称为原始角色)是在云IAM出现之前的遗留角色。他们是项目中最强大的角色，拥有成千上万的权限，由Google代表您进行管理。</p><p id="3482" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这意味着，随着新产品或新功能的发布，它们包含的权限将自动为您更新。</p><p id="52f5" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">一般来说，只有<strong class="jf hj">使用基本角色在沙盒环境中测试</strong>、<strong class="jf hj">——而不是在包含任何真实数据的生产环境中测试</strong>。这将限制您在凭据受损的情况下，合法用户或外部参与者未经授权访问敏感数据的风险。</p><h1 id="e17f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">预定义角色</h1><p id="8bd0" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><a class="ae kg" href="https://cloud.google.com/iam/docs/understanding-roles?hl=en#predefined_roles" rel="noopener ugc nofollow" target="_blank">预定义角色</a>是Google代表客户为每个GCP服务维护的一组IAM角色。这意味着产品团队审查了给定产品(或一组产品)的所有可用权限，并定义了大多数工作职能通常所需的最小权限集。例如，<a class="ae kg" href="https://cloud.google.com/iam/docs/understanding-roles?hl=en#bigquery-roles" rel="noopener ugc nofollow" target="_blank">大查询角色</a> (admin、dataOwner、jobUser等。)来确保不同的工作职能可以在没有获得过多权限的情况下运行，遵循职责分离和最低权限实践。</p><p id="7ffb" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">创建这些角色的想法是为了<strong class="jf hj">减轻从客户那里选择合适的权限</strong>(从数千个权限中)来使用GCP服务的负担，并提供一组自以为是的权限供最终用户选择。这些预定义的角色也由Google管理，这意味着每当在GCP有新的权限可用时(比如说新的功能或产品)，这些权限将由Google自动<strong class="jf hj">添加到相应的预定义角色</strong>中。</p><h1 id="f464" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">几句告诫的话</h1><p id="f01e" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">有<a class="ae kg" href="https://cloud.google.com/iam/docs/understanding-roles#resource-manager-roles" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj">特殊的预定义角色</strong> </a> <strong class="jf hj">可以让你设置不同级别的IAM权限</strong>(organization Admin，folderIAMAdmin，projectIAM Admin)。授予这些角色时，请注意，您是在授予将任何角色分配给任何用户或某人的能力，包括基本角色。</p><p id="4d98" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">最后，一些角色包含允许您<a class="ae kg" href="https://cloud.google.com/iam/docs/impersonating-service-accounts" rel="noopener ugc nofollow" target="_blank">模拟服务帐户</a>的权限。提醒一下，服务帐户是应该由非人类实体使用的身份，例如机器人帐户，但在某些情况下，模拟服务帐户对排除故障很有用。</p><p id="7893" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">因此，您需要小心分配包含"<a class="ae kg" href="https://cloud.google.com/iam/docs/service-accounts-actas" rel="noopener ugc nofollow" target="_blank">iam . service accounts . actas</a>"权限的角色，因为它允许用户将服务帐户附加到虚拟机。这可能允许他们通过简单地登录到机器并使用附加服务帐户来提升权限。另外<strong class="jf hj">要小心那些让您获得服务帐户</strong>的短期或长期凭证的角色，例如包含“iam.serviceAccounts.signJWT”权限的角色，该权限是roles/iam . serviceaccountokencreator角色的一部分(查看<a class="ae kg" href="https://cloud.google.com/iam/docs/permissions-reference" rel="noopener ugc nofollow" target="_blank">权限参考</a>页面以了解更多信息)。授予这些权限将<strong class="jf hj">服务帐户的所有权限授予您的最终用户</strong>，以及<strong class="jf hj">代表它进行API调用的能力</strong>，这使得在您的组织中实施不可否认安全原则变得更加困难。</p><h1 id="67e9" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">限制</h1><p id="927a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">一些预览版产品可能还没有预定义的角色(这种情况很少见)，在这种情况下，仅有的两个选项是使用原始角色(除非必要，否则不推荐)或自定义角色(如果可能)。</p><h1 id="ec94" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">自定义角色</h1><p id="7ba9" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><a class="ae kg" href="https://cloud.google.com/iam/docs/understanding-custom-roles?hl=en" rel="noopener ugc nofollow" target="_blank">自定义角色</a>类似于预定义角色，但由用户直接创建和管理。通常，您可以在组织或项目级别创建自定义角色，方法是选择它应该拥有的权限列表。</p><h1 id="3bce" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">限制</h1><p id="9f3a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">自定义角色有一些已知的限制。最重要的一点是<a class="ae kg" href="https://cloud.google.com/iam/docs/custom-roles-permissions-support" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj">并非所有权限在任何给定时间都受支持</strong></a>——这意味着在某些情况下，自定义角色对您的工作职能不可用。</p><p id="03fe" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">自定义角色要考虑的其他限制:</p><ul class=""><li id="b0a2" class="kx ky hi jf b jg kb jk kc jo kz js la jw lb ka lc ld le lf bi translated">限制和配额:在您的组织和每个项目中，您可以创建最大数量的客户角色(每个节点300个)。<a class="ae kg" href="https://cloud.google.com/iam/quotas" rel="noopener ugc nofollow" target="_blank">自定义角色存在其他限制</a>(如名称或描述大小等。)，但一般来说影响较小。</li><li id="68b4" class="kx ky hi jf b jg lg jk lh jo li js lj jw lk ka lc ld le lf bi translated">不能在文件夹级别(只能在组织或项目级别)创建自定义角色。</li><li id="2e08" class="kx ky hi jf b jg lg jk lh jo li js lj jw lk ka lc ld le lf bi translated">一些权限—通常在开发中(alpha/preview) —可能不会显示在UI中，这可能会导致自定义角色和创建它们的预定义角色之间的行为变化。</li></ul><h1 id="18c3" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">摘要</h1><p id="ddb1" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">建议监控您的身份(用户和服务帐户)实际使用了哪些权限，并删除在合理的时间段内(例如90-120天)从未使用过的权限，除非您的使用情形需要这样做(例如，不经常访问您的资源)。见<a class="ae kg" href="https://cloud.google.com/iam/docs/recommender-overview" rel="noopener ugc nofollow" target="_blank">我的推荐人</a>让这在GCP变得简单。</p><h1 id="a8c1" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">摘要</h1><p id="0b05" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hj">基本角色</strong></p><p id="efca" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">优点:</p><ul class=""><li id="5b92" class="kx ky hi jf b jg kb jk kc jo kz js la jw lb ka lc ld le lf bi translated">试图学习GCP时易于使用</li><li id="f6f9" class="kx ky hi jf b jg lg jk lh jo li js lj jw lk ka lc ld le lf bi translated">有助于快速排除低级环境中的故障</li><li id="7340" class="kx ky hi jf b jg lg jk lh jo li js lj jw lk ka lc ld le lf bi translated">由Google管理(自动更新权限)</li></ul><p id="6039" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">缺点:</p><ul class=""><li id="545f" class="kx ky hi jf b jg kb jk kc jo kz js la jw lb ka lc ld le lf bi translated">由Google管理(自动更新权限)</li><li id="9919" class="kx ky hi jf b jg lg jk lh jo li js lj jw lk ka lc ld le lf bi translated">太强大:如果使用这些，很难确保职责分离。</li><li id="4cf5" class="kx ky hi jf b jg lg jk lh jo li js lj jw lk ka lc ld le lf bi translated">如果攻击者获得了具有这些角色的身份，爆炸半径会很大。</li></ul><p id="e50d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">预定义角色</strong></p><p id="f91c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">优点:</p><ul class=""><li id="b028" class="kx ky hi jf b jg kb jk kc jo kz js la jw lb ka lc ld le lf bi translated">运营开销更少，尤其是在大规模运营时</li><li id="21a0" class="kx ky hi jf b jg lg jk lh jo li js lj jw lk ka lc ld le lf bi translated">由Google管理(自动更新权限)</li><li id="fe49" class="kx ky hi jf b jg lg jk lh jo li js lj jw lk ka lc ld le lf bi translated">比基本角色更有针对性:分配给用户更安全</li></ul><p id="d686" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">缺点:</p><ul class=""><li id="b75d" class="kx ky hi jf b jg kb jk kc jo kz js la jw lb ka lc ld le lf bi translated">由Google管理(自动更新权限)</li><li id="b922" class="kx ky hi jf b jg lg jk lh jo li js lj jw lk ka lc ld le lf bi translated">通常会导致比所需更多的权限。随着时间的推移，可以使用IAM推荐程序来解决这个问题，或者只针对特定的使用情形切换到自定义角色。</li></ul><p id="d531" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">自定义角色</strong></p><p id="9c76" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">优点:</p><ul class=""><li id="abef" class="kx ky hi jf b jg kb jk kc jo kz js la jw lb ka lc ld le lf bi translated">通常是更有针对性的角色(整体权限集更小)，这有助于职责分离安全原则的实施。</li></ul><p id="917e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">缺点:</p><ul class=""><li id="760b" class="kx ky hi jf b jg kb jk kc jo kz js la jw lb ka lc ld le lf bi translated">更多的运营开销—尤其是在大规模的情况下</li><li id="f79c" class="kx ky hi jf b jg lg jk lh jo li js lj jw lk ka lc ld le lf bi translated"><a class="ae kg" href="https://cloud.google.com/iam/docs/custom-roles-permissions-support" rel="noopener ugc nofollow" target="_blank">有些权限不能在自定义角色中使用</a></li><li id="8a7e" class="kx ky hi jf b jg lg jk lh jo li js lj jw lk ka lc ld le lf bi translated">一些预定义的角色不能完全复制(参见上面的不可见权限)</li><li id="3bbc" class="kx ky hi jf b jg lg jk lh jo li js lj jw lk ka lc ld le lf bi translated"><a class="ae kg" href="https://cloud.google.com/iam/docs/understanding-custom-roles#basic_concepts" rel="noopener ugc nofollow" target="_blank">不能在文件夹级别</a>创建</li><li id="0e49" class="kx ky hi jf b jg lg jk lh jo li js lj jw lk ka lc ld le lf bi translated"><a class="ae kg" href="https://cloud.google.com/iam/quotas" rel="noopener ugc nofollow" target="_blank">限制</a>组织级别(300)和每个项目(300)中允许的自定义角色的数量</li></ul></div></div>    
</body>
</html>