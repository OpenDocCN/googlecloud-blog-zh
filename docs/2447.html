<html>
<head>
<title>Migrating data from one Databases into another(Via JDBC) using Dataproc Serverless</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Dataproc无服务器将数据从一个数据库迁移到另一个数据库(通过JDBC)</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/migrating-data-from-one-databases-into-another-via-jdbc-using-dataproc-serverless-c5336c409b18?source=collection_archive---------1-----------------------#2022-10-22">https://medium.com/google-cloud/migrating-data-from-one-databases-into-another-via-jdbc-using-dataproc-serverless-c5336c409b18?source=collection_archive---------1-----------------------#2022-10-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/0fba58781aac53164b52d0bd26c94d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*o8mrbq_TpoWjyG8h.png"/></div></div></figure><p id="6a9e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在运行Spark作业的同时管理服务器始终是一项挑战。对Spark作业使用完全托管的按需服务器是当今时代的需要。它帮助开发人员专注于核心应用程序逻辑，而不是花时间管理框架。Dataproc Serverless就是Google云平台提供的一个这样的产品。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es jo"><img src="../Images/247d2867dfdcbf21748b1f4fd63c6d91.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/0*J-qYbY7w2yFO3w9h.jpeg"/></div></figure><p id="60a2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">大多数事务数据仍然驻留在关系数据库服务器上，可以通过使用JDBC驱动程序来连接。MySQL、PostgreSQL和SQL Server主要用于此目的。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es jt"><img src="../Images/d94b9dd221588d92285db80f34477595.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/0*ztw7Eyc0Lm8UeL1v.png"/></div></figure><p id="7ebf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当今世界正在转向基于云的存储服务来存储数据。它引发了谷歌云存储桶的使用。</p><p id="b5d8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇文章是关于通过Dataproc无服务器将数据从一个JDBC数据库转移到另一个数据库。</p><h1 id="566c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">主要优势</h1><ol class=""><li id="1ef8" class="ks kt hi is b it ku ix kv jb kw jf kx jj ky jn kz la lb lc bi translated">使用<strong class="is hj"> Dataproc无服务器</strong>运行Spark批处理工作负载，无需管理Spark框架。批量大小也可以在该模板中配置。</li><li id="74d4" class="ks kt hi is b it ld ix le jb lf jf lg jj lh jn kz la lb lc bi translated"><a class="ae li" href="https://github.com/GoogleCloudPlatform/dataproc-templates/tree/main/python/dataproc_templates/jdbc#1-jdbc-to-jdbc" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> JDBCTOJDBC </strong> </a>模板是开源的，配置驱动的，随时可以使用。执行代码只需要JDBC和GCS证书。</li></ol><h1 id="5ee3" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">使用</h1><ol class=""><li id="8f66" class="ks kt hi is b it ku ix kv jb kw jf kx jj ky jn kz la lb lc bi translated">如果你要使用“默认的”由GCP生成的VPC网络，请确保你已经启用了私有谷歌访问子网。您仍然需要启用如下的私人访问。</li></ol><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es lj"><img src="../Images/3f1f6eda59d2aa2da7e1c09c35a9c04c.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/0*pJ7dpwgnGDwFRTlK.png"/></div></figure><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="5ead" class="lp jv hi ll b fi lq lr l ls lt">gcloud compute networks subnets update default --region=us-central1 --enable-private-ip-google-access</span></pre><p id="756a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.为jar文件创建一个GCS存储桶和暂存位置。</p><p id="7804" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.在预装了<a class="ae li" href="https://cloud.google.com/shell/docs/how-cloud-shell-works" rel="noopener ugc nofollow" target="_blank">各种工具</a>的云壳中克隆git repo。或者使用任何预装python和Git的机器。</p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="d703" class="lp jv hi ll b fi lq lr l ls lt">git clone <a class="ae li" href="https://github.com/GoogleCloudPlatform/dataproc-templates.git" rel="noopener ugc nofollow" target="_blank">https://github.com/GoogleCloudPlatform/dataproc-templates.git</a><br/>cd dataproc-templates/python</span></pre><p id="a691" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.获取身份验证凭据(以提交作业)。</p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="38d7" class="lp jv hi ll b fi lq lr l ls lt">gcloud auth application-default login</span></pre><p id="6d8e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.先决条件</p><p id="254d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">所需的JAR文件</strong></p><p id="a337" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些模板要求JDBC jar文件在Dataproc集群中可用。用户必须下载所需的jar文件，并将其存放在GCS Bucket中，以便在代码执行期间可以引用它。</p><p id="1bf0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下载JDBC jar文件的wget命令如下</p><ul class=""><li id="0713" class="ks kt hi is b it iu ix iy jb lu jf lv jj lw jn lx la lb lc bi translated">关系型数据库</li></ul><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="1ca3" class="lp jv hi ll b fi lq lr l ls lt">wget <a class="ae li" href="http://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.30.tar.gz" rel="noopener ugc nofollow" target="_blank">http://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.30.tar.gz</a></span></pre><ul class=""><li id="33f9" class="ks kt hi is b it iu ix iy jb lu jf lv jj lw jn lx la lb lc bi translated">一种数据库系统</li></ul><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="1908" class="lp jv hi ll b fi lq lr l ls lt">wget <a class="ae li" href="https://jdbc.postgresql.org/download/postgresql-42.2.6.jar" rel="noopener ugc nofollow" target="_blank">https://jdbc.postgresql.org/download/postgresql-42.2.6.jar</a></span></pre><ul class=""><li id="ffab" class="ks kt hi is b it iu ix iy jb lu jf lv jj lw jn lx la lb lc bi translated">Microsoft SQL Server</li></ul><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="83ea" class="lp jv hi ll b fi lq lr l ls lt">wget <a class="ae li" href="https://repo1.maven.org/maven2/com/microsoft/sqlserver/mssql-jdbc/6.4.0.jre8/mssql-jdbc-6.4.0.jre8.jar" rel="noopener ugc nofollow" target="_blank">https://repo1.maven.org/maven2/com/microsoft/sqlserver/mssql-jdbc/6.4.0.jre8/mssql-jdbc-6.4.0.jre8.jar</a></span></pre><p id="f7a0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下载完jar文件后，请将文件上传到GCS Bucket中，并导出下面的变量</p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="ed95" class="lp jv hi ll b fi lq lr l ls lt">export JARS=&lt;gcs-bucket-location-containing-jar-file&gt;</span></pre><h2 id="1058" class="lp jv hi bd jw ly lz ma ka mb mc md ke jb me mf ki jf mg mh km jj mi mj kq mk bi translated">JDBC URL语法</h2><ul class=""><li id="62c0" class="ks kt hi is b it ku ix kv jb kw jf kx jj ky jn lx la lb lc bi translated">关系型数据库</li></ul><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="a30c" class="lp jv hi ll b fi lq lr l ls lt">jdbc:mysql://&lt;hostname&gt;:&lt;port&gt;/&lt;dbname&gt;?user=&lt;username&gt;&amp;password=&lt;password&gt;</span></pre><ul class=""><li id="bdde" class="ks kt hi is b it iu ix iy jb lu jf lv jj lw jn lx la lb lc bi translated">一种数据库系统</li></ul><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="6170" class="lp jv hi ll b fi lq lr l ls lt">jdbc:postgresql://&lt;hostname&gt;:&lt;port&gt;/&lt;dbname&gt;?user=&lt;username&gt;&amp;password=&lt;password&gt;</span></pre><ul class=""><li id="ccbb" class="ks kt hi is b it iu ix iy jb lu jf lv jj lw jn lx la lb lc bi translated">Microsoft SQL Server</li></ul><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="8bae" class="lp jv hi ll b fi lq lr l ls lt">jdbc:sqlserver://&lt;hostname&gt;:&lt;port&gt;;databaseName=&lt;dbname&gt;;user=&lt;username&gt;;password=&lt;password&gt;</span></pre><p id="59b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">其他重要属性</strong></p><p id="ad07" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">驱动程序类</strong></p><p id="8412" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">1.关系型数据库</p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="688d" class="lp jv hi ll b fi lq lr l ls lt">jdbctojdbc.input.driver="com.mysql.cj.jdbc.Driver"</span></pre><p id="923a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.一种数据库系统</p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="8458" class="lp jv hi ll b fi lq lr l ls lt">jdbctojdbc.input.driver="org.postgresql.Driver"<br/>jdbctojdbc.input.driver="org.postgresql.Driver"</span></pre><p id="9492" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.Microsoft SQL Server</p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="85e5" class="lp jv hi ll b fi lq lr l ls lt">jdbctojdbc.input.driver="com.microsoft.sqlserver.jdbc.SQLServerDriver"<br/>jdbctojdbc.input.driver="com.microsoft.sqlserver.jdbc.SQLServerDriver"</span></pre><ul class=""><li id="447e" class="ks kt hi is b it iu ix iy jb lu jf lv jj lw jn lx la lb lc bi translated">您可以指定源表名，也可以用双引号将SQL查询括起来。例子，</li></ul><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="e30e" class="lp jv hi ll b fi lq lr l ls lt">jdbctojdbc.input.table="employees"<br/>jdbctojdbc.input.table="(select * from employees where dept_id&gt;10) as employees"</span></pre><ul class=""><li id="6b90" class="ks kt hi is b it iu ix iy jb lu jf lv jj lw jn lx la lb lc bi translated">partitionColumn、lowerBound、upperBound和numPartitions必须一起使用。如果指定了一个，则需要指定所有。</li><li id="27f8" class="ks kt hi is b it ld ix le jb lf jf lg jj lh jn lx la lb lc bi translated">附加执行细节<a class="ae li" href="https://spark.apache.org/docs/latest/sql-data-sources-jdbc.html" rel="noopener ugc nofollow" target="_blank">参考spark jdbc文档</a></li></ul><p id="07b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">6.使用</p><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="daf1" class="lp jv hi ll b fi lq lr l ls lt">$ python main.py --template JDBCTOJDBC --help<br/><br/>usage: main.py --template JDBCTOJDBC \<br/>    --jdbctojdbc.input.url JDBCTOJDBC.INPUT.URL \<br/>    --jdbctojdbc.input.driver JDBCTOJDBC.INPUT.DRIVER \<br/>    --jdbctojdbc.input.table JDBCTOJDBC.INPUT.TABLE \<br/>    --jdbctojdbc.output.url JDBCTOJDBC.OUTPUT.URL \<br/>    --jdbctojdbc.output.driver JDBCTOJDBC.OUTPUT.DRIVER \<br/>    --jdbctojdbc.output.table JDBCTOJDBC.OUTPUT.TABLE \<br/><br/>optional arguments:<br/>    -h, --help            show this help message and exit<br/>    --jdbctojdbc.input.partitioncolumn JDBCTOJDBC.INPUT.PARTITIONCOLUMN \<br/>    --jdbctojdbc.input.lowerbound JDBCTOJDBC.INPUT.LOWERBOUND \<br/>    --jdbctojdbc.input.upperbound JDBCTOJDBC.INPUT.UPPERBOUND \<br/>    --jdbctojdbc.numpartitions JDBCTOJDBC.NUMPARTITIONS \<br/>    --jdbctojdbc.output.create_table.option JDBCTOJDBC.OUTPUT.CREATE_TABLE.OPTION \<br/>    --jdbctojdbc.output.mode {overwrite,append,ignore,errorifexists} \<br/>    --jdbctojdbc.output.batch.size JDBCTOJDBC.OUTPUT.BATCH.SIZE \</span></pre><p id="6b0d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">论据</strong></p><ul class=""><li id="8ff9" class="ks kt hi is b it iu ix iy jb lu jf lv jj lw jn lx la lb lc bi translated"><code class="du ml mm mn ll b">jdbctojdbc.input.url</code> : JDBC输入网址</li><li id="ae83" class="ks kt hi is b it ld ix le jb lf jf lg jj lh jn lx la lb lc bi translated"><code class="du ml mm mn ll b">jdbctojdbc.input.driver</code> : JDBC输入司机姓名</li><li id="484f" class="ks kt hi is b it ld ix le jb lf jf lg jj lh jn lx la lb lc bi translated"><code class="du ml mm mn ll b">jdbctojdbc.input.table</code> : JDBC输入表格名称</li><li id="576a" class="ks kt hi is b it ld ix le jb lf jf lg jj lh jn lx la lb lc bi translated"><code class="du ml mm mn ll b">jdbctojdbc.output.url</code> : JDBC输出url</li><li id="65af" class="ks kt hi is b it ld ix le jb lf jf lg jj lh jn lx la lb lc bi translated"><code class="du ml mm mn ll b">jdbctojdbc.output.driver</code> : JDBC输出驱动名称</li><li id="8b5f" class="ks kt hi is b it ld ix le jb lf jf lg jj lh jn lx la lb lc bi translated"><code class="du ml mm mn ll b">jdbctojdbc.output.table</code> : JDBC输出表名</li><li id="7a10" class="ks kt hi is b it ld ix le jb lf jf lg jj lh jn lx la lb lc bi translated"><code class="du ml mm mn ll b">jdbctojdbc.input.partitioncolumn</code>(可选):JDBC输入表分区的列名</li><li id="e6e6" class="ks kt hi is b it ld ix le jb lf jf lg jj lh jn lx la lb lc bi translated"><code class="du ml mm mn ll b">jdbctojdbc.input.lowerbound</code>(可选):JDBC输入表分区列的下限，用来决定分区步距</li><li id="8211" class="ks kt hi is b it ld ix le jb lf jf lg jj lh jn lx la lb lc bi translated"><code class="du ml mm mn ll b">jdbctojdbc.input.upperbound</code>(可选):JDBC输入表分区列的上界，用来决定分区步距</li><li id="2447" class="ks kt hi is b it ld ix le jb lf jf lg jj lh jn lx la lb lc bi translated"><code class="du ml mm mn ll b">jdbctojdbc.numpartitions</code>(可选):表读写中可用于并行的最大分区数。相同的值将用于输入和输出jdbc连接。默认设置为10</li><li id="2dbc" class="ks kt hi is b it ld ix le jb lf jf lg jj lh jn lx la lb lc bi translated"><code class="du ml mm mn ll b">jdbctojdbc.output.create_table.option</code>(可选):该选项允许在创建输出表时设置特定于数据库的表和分区选项</li><li id="3fd3" class="ks kt hi is b it ld ix le jb lf jf lg jj lh jn lx la lb lc bi translated"><code class="du ml mm mn ll b">jdbctojdbc.output.mode</code>(可选):输出写入模式(追加、覆盖、忽略、错误存在之一)(默认为追加)</li><li id="561d" class="ks kt hi is b it ld ix le jb lf jf lg jj lh jn lx la lb lc bi translated"><code class="du ml mm mn ll b">jdbctojdbc.output.batch.size</code>(可选):JDBC输出批量。默认设置为1000</li></ul><h2 id="6117" class="lp jv hi bd jw ly lz ma ka mb mc md ke jb me mf ki jf mg mh km jj mi mj kq mk bi translated">注意:</h2><p id="86bd" class="pw-post-body-paragraph iq ir hi is b it ku iv iw ix kv iz ja jb mo jd je jf mp jh ji jj mq jl jm jn hb bi translated">您可以使用below属性指定目标表属性，如分区列。当目标表不存在或者当写模式=覆盖并且您需要将目标表创建为分区表时，这很有用。</p><ul class=""><li id="a7cd" class="ks kt hi is b it iu ix iy jb lu jf lv jj lw jn lx la lb lc bi translated">关系型数据库</li></ul><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="1f83" class="lp jv hi ll b fi lq lr l ls lt">jdbctojdbc.output.create_table.option="PARTITION BY RANGE(id)  (PARTITION p0 VALUES LESS THAN (5),PARTITION p1 VALUES LESS THAN (10),PARTITION p2 VALUES LESS THAN (15),PARTITION p3 VALUES LESS THAN MAXVALUE)"</span></pre><ul class=""><li id="2f96" class="ks kt hi is b it iu ix iy jb lu jf lv jj lw jn lx la lb lc bi translated">一种数据库系统</li></ul><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="9679" class="lp jv hi ll b fi lq lr l ls lt">jdbctojdbc.output.create_table.option="PARTITION BY RANGE(id);CREATE TABLE po0 PARTITION OF &lt;table_name&gt; FOR VALUES FROM (MINVALUE) TO (5);CREATE TABLE po1 PARTITION OF &lt;table_name&gt; FOR VALUES FROM (5) TO (10);CREATE TABLE po2 PARTITION OF &lt;table_name&gt; FOR VALUES FROM (10) TO (15);CREATE TABLE po3 PARTITION OF &lt;table_name&gt; FOR VALUES FROM (15) TO (MAXVALUE);"<!-- -->jdbctojdbc.output.create_table.option="PARTITION BY RANGE(id);CREATE TABLE po0 PARTITION OF &lt;table_name&gt; FOR VALUES FROM (MINVALUE) TO (5);CREATE TABLE po1 PARTITION OF &lt;table_name&gt; FOR VALUES FROM (5) TO (10);CREATE TABLE po2 PARTITION OF &lt;table_name&gt; FOR VALUES FROM (10) TO (15);CREATE TABLE po3 PARTITION OF &lt;table_name&gt; FOR VALUES FROM (15) TO (MAXVALUE);"</span></pre><h2 id="4d5d" class="lp jv hi bd jw ly lz ma ka mb mc md ke jb me mf ki jf mg mh km jj mi mj kq mk bi translated">一般执行:</h2><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="a1c5" class="lp jv hi ll b fi lq lr l ls lt">export GCP_PROJECT=&lt;gcp-project-id&gt; <br/>export REGION=&lt;region&gt;  <br/>export GCS_STAGING_LOCATION=&lt;gcs staging location&gt; <br/>export SUBNET=&lt;subnet&gt;   <br/>export JARS="&lt;gcs_path_to_jdbc_jar_files&gt;/mysql-connector-java-8.0.29.jar,&lt;gcs_path_to_jdbc_jar_files&gt;/postgresql-42.2.6.jar,&lt;gcs_path_to_jdbc_jar_files&gt;/mssql-jdbc-6.4.0.jre8.jar"<br/><br/>./bin/start.sh \<br/>-- --template=JDBCTOJDBC \<br/>--jdbctojdbc.input.url="jdbc:mysql://&lt;hostname&gt;:&lt;port&gt;/&lt;dbname&gt;?user=&lt;username&gt;&amp;password=&lt;password&gt;" \<br/>--jdbctojdbc.input.driver=&lt;jdbc-driver-class-name&gt; \<br/>--jdbctojdbc.input.table=&lt;input table name or subquery with where clause filter&gt; \<br/>--jdbctojdbc.input.partitioncolumn=&lt;optional-partition-column-name&gt; \<br/>--jdbctojdbc.input.lowerbound=&lt;optional-partition-start-value&gt;  \<br/>--jdbctojdbc.input.upperbound=&lt;optional-partition-end-value&gt;  \<br/>--jdbctojdbc.numpartitions=&lt;optional-partition-number&gt; \<br/>--jdbctojdbc.output.url="jdbc:mysql://&lt;hostname&gt;:&lt;port&gt;/&lt;dbname&gt;?user=&lt;username&gt;&amp;password=&lt;password&gt;" \<br/>--jdbctojdbc.output.driver=&lt;jdbc-driver-class-name&gt; \<br/>--jdbctojdbc.output.table=&lt;output-table-name&gt; \<br/>--jdbctojdbc.output.create_table.option=&lt;optional-output-table-properties&gt; \<br/>--jdbctojdbc.output.mode=&lt;optional-write-mode&gt; \<br/>--jdbctojdbc.output.batch.size=&lt;optional-batch-size&gt;</span></pre><h2 id="a080" class="lp jv hi bd jw ly lz ma ka mb mc md ke jb me mf ki jf mg mh km jj mi mj kq mk bi translated">示例执行:</h2><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="141b" class="lp jv hi ll b fi lq lr l ls lt">export GCP_PROJECT=my-gcp-proj<br/>export REGION=us-central1 <br/>export GCS_STAGING_LOCATION=gs://my-gcp-proj/staging<br/>export SUBNET=projects/my-gcp-proj/regions/us-central1/subnetworks/default   <br/>export JARS="gs://my-gcp-proj/jars/mysql-connector-java-8.0.29.jar,gs://my-gcp-proj/jars/postgresql-42.2.6.jar,gs://my-gcp-proj/jars/mssql-jdbc-6.4.0.jre8.jar"</span></pre><ul class=""><li id="c8b8" class="ks kt hi is b it iu ix iy jb lu jf lv jj lw jn lx la lb lc bi translated">MySQL到MySQL</li></ul><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="d67c" class="lp jv hi ll b fi lq lr l ls lt">./bin/start.sh \<br/>-- --template=JDBCTOJDBC \<br/>--jdbctojdbc.input.url="jdbc:mysql://1.1.1.1:3306/mydb?user=root&amp;password=password123" \<br/>--jdbctojdbc.input.driver="com.mysql.cj.jdbc.Driver" \<br/>--jdbctojdbc.input.table="(select * from employees where id &lt;10) as employees" \<br/>--jdbctojdbc.input.partitioncolumn=id \<br/>--jdbctojdbc.input.lowerbound="1" \<br/>--jdbctojdbc.input.upperbound="10" \<br/>--jdbctojdbc.numpartitions="4" \<br/>--jdbctojdbc.output.url="jdbc:mysql://1.1.1.1:3306/mydb?user=root&amp;password=password123" \<br/>--jdbctojdbc.output.driver="com.mysql.cj.jdbc.Driver" \<br/>--jdbctojdbc.output.table="employees_out" \<br/>--jdbctojdbc.output.create_table.option="PARTITION BY RANGE(id)  (PARTITION p0 VALUES LESS THAN (5),PARTITION p1 VALUES LESS THAN (10),PARTITION p2 VALUES LESS THAN (15),PARTITION p3 VALUES LESS THAN MAXVALUE)" \<br/>--jdbctojdbc.output.mode="overwrite" \<br/>--jdbctojdbc.output.batch.size="1000"</span></pre><ul class=""><li id="7190" class="ks kt hi is b it iu ix iy jb lu jf lv jj lw jn lx la lb lc bi translated">PostgreSQL到PostgreSQL</li></ul><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="1ba0" class="lp jv hi ll b fi lq lr l ls lt">./bin/start.sh \<br/>-- --template=JDBCTOJDBC \<br/>--jdbctojdbc.input.url="jdbc:postgresql://1.1.1.1:5432/postgres?user=postgres&amp;password=password123" \<br/>--jdbctojdbc.input.driver="org.postgresql.Driver" \<br/>--jdbctojdbc.input.table="(select * from employees) as employees" \<br/>--jdbctojdbc.input.partitioncolumn=id \<br/>--jdbctojdbc.input.lowerbound="11" \<br/>--jdbctojdbc.input.upperbound="20" \<br/>--jdbctojdbc.numpartitions="4" \<br/>--jdbctojdbc.output.url="jdbc:postgresql://1.1.1.1:5432/postgres?user=postgres&amp;password=password123" \<br/>--jdbctojdbc.output.driver="org.postgresql.Driver" \<br/>--jdbctojdbc.output.table="employees_out" \<br/>--jdbctojdbc.output.create_table.option="PARTITION BY RANGE(id);CREATE TABLE po0 PARTITION OF employees_out FOR VALUES FROM (MINVALUE) TO (5);CREATE TABLE po1 PARTITION OF employees_out FOR VALUES FROM (5) TO (10);CREATE TABLE po2 PARTITION OF employees_out FOR VALUES FROM (10) TO (15);CREATE TABLE po3 PARTITION OF employees_out FOR VALUES FROM (15) TO (MAXVALUE);" \<br/>--jdbctojdbc.output.mode="overwrite" \<br/>--jdbctojdbc.output.batch.size="1000"</span></pre><ul class=""><li id="562f" class="ks kt hi is b it iu ix iy jb lu jf lv jj lw jn lx la lb lc bi translated">Microsoft SQL Server到Microsoft SQL Server</li></ul><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="0ef6" class="lp jv hi ll b fi lq lr l ls lt">./bin/start.sh \<br/>-- --template=JDBCTOJDBC \<br/>--jdbctojdbc.input.url="jdbc:sqlserver://1.1.1.1:1433;databaseName=mydb;user=sqlserver;password=password123" \<br/>--jdbctojdbc.input.driver="com.microsoft.sqlserver.jdbc.SQLServerDriver" \<br/>--jdbctojdbc.input.table="employees" \<br/>--jdbctojdbc.input.partitioncolumn=id \<br/>--jdbctojdbc.input.lowerbound="11" \<br/>--jdbctojdbc.input.upperbound="20" \<br/>--jdbctojdbc.numpartitions="4" \<br/>--jdbctojdbc.output.url="jdbc:sqlserver://1.1.1.1:1433;databaseName=mydb;user=sqlserver;password=password123" \<br/>--jdbctojdbc.output.driver="com.microsoft.sqlserver.jdbc.SQLServerDriver" \<br/>--jdbctojdbc.output.table="employees_out" \<br/>--jdbctojdbc.output.mode="overwrite" \<br/>--jdbctojdbc.output.batch.size="1000"</span></pre><ul class=""><li id="b176" class="ks kt hi is b it iu ix iy jb lu jf lv jj lw jn lx la lb lc bi translated">MySQL到PostgreSQL</li></ul><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="affc" class="lp jv hi ll b fi lq lr l ls lt">./bin/start.sh \<br/>-- --template=JDBCTOJDBC \<br/>--jdbctojdbc.input.url="jdbc:mysql://1.1.1.1:3306/mydb?user=root&amp;password=password123" \<br/>--jdbctojdbc.input.driver="com.mysql.cj.jdbc.Driver" \<br/>--jdbctojdbc.input.table="employees" \<br/>--jdbctojdbc.input.partitioncolumn=id \<br/>--jdbctojdbc.input.lowerbound="11" \<br/>--jdbctojdbc.input.upperbound="20" \<br/>--jdbctojdbc.numpartitions="4" \<br/>--jdbctojdbc.output.url="jdbc:postgresql://1.1.1.1:5432/postgres?user=postgres&amp;password=password123" \<br/>--jdbctojdbc.output.driver="org.postgresql.Driver" \<br/>--jdbctojdbc.output.table="employees_out" \<br/>--jdbctojdbc.output.mode="overwrite" \<br/>--jdbctojdbc.output.batch.size="1000"</span></pre><ul class=""><li id="6b87" class="ks kt hi is b it iu ix iy jb lu jf lv jj lw jn lx la lb lc bi translated">MySQL到Microsoft SQL Server</li></ul><pre class="jp jq jr js fd lk ll lm ln aw lo bi"><span id="ab35" class="lp jv hi ll b fi lq lr l ls lt">./bin/start.sh \<br/>-- --template=JDBCTOJDBC \<br/>--jdbctojdbc.input.url="jdbc:mysql://1.1.1.1:3306/mydb?user=root&amp;password=password123" \<br/>--jdbctojdbc.input.driver="com.mysql.cj.jdbc.Driver" \<br/>--jdbctojdbc.input.table="employees" \<br/>--jdbctojdbc.input.partitioncolumn=id \<br/>--jdbctojdbc.input.lowerbound="11" \<br/>--jdbctojdbc.input.upperbound="20" \<br/>--jdbctojdbc.numpartitions="4" \<br/>--jdbctojdbc.output.url="jdbc:sqlserver://1.1.1.1:1433;databaseName=mydb;user=sqlserver;password=password123" \<br/>--jdbctojdbc.output.driver="com.microsoft.sqlserver.jdbc.SQLServerDriver" \<br/>--jdbctojdbc.output.table="employees_out" \<br/>--jdbctojdbc.output.mode="overwrite" \<br/>--jdbctojdbc.output.batch.size="1000"</span></pre><p id="04c3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意</strong>:如果尚未启用，它会要求您启用Dataproc Api。</p><h1 id="fa36" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">设置附加火花属性</h1><p id="c1b4" class="pw-post-body-paragraph iq ir hi is b it ku iv iw ix kv iz ja jb mo jd je jf mp jh ji jj mq jl jm jn hb bi translated">如果您需要<a class="ae li" href="https://cloud.google.com/dataproc-serverless/docs/concepts/properties" rel="noopener ugc nofollow" target="_blank">指定Dataproc无服务器支持的spark属性</a>，如调整驱动程序、内核、执行器等的数量。</p><p id="d263" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以编辑start.sh文件中的<a class="ae li" href="https://github.com/GoogleCloudPlatform/dataproc-templates/blob/main/python/bin/start.sh" rel="noopener ugc nofollow" target="_blank"> OPT_PROPERTIES </a>值。</p><p id="0638" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">参考文献</strong></p><ul class=""><li id="aeb7" class="ks kt hi is b it iu ix iy jb lu jf lv jj lw jn lx la lb lc bi translated"><a class="ae li" href="https://cloud.google.com/dataproc-serverless/docs/overview" rel="noopener ugc nofollow" target="_blank"> Dataproc无服务</a></li><li id="0fcc" class="ks kt hi is b it ld ix le jb lf jf lg jj lh jn lx la lb lc bi translated"><a class="ae li" href="https://github.com/GoogleCloudPlatform/dataproc-templates" rel="noopener ugc nofollow" target="_blank"> Dataproc模板库</a></li></ul></div></div>    
</body>
</html>