<html>
<head>
<title>Node 12 Functions on Cloud Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">节点12在云上运行</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/node-12-functions-on-cloud-run-d891dd93c7c8?source=collection_archive---------0-----------------------#2019-08-07">https://medium.com/google-cloud/node-12-functions-on-cloud-run-d891dd93c7c8?source=collection_archive---------0-----------------------#2019-08-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="496c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">⚡+☁️+👟!</p><p id="cc89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我们将学习如何使用函数框架和云运行来部署Node 12应用程序。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/1f045042bd009d50b280ce6ba12a2fa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hvtsKxY8j785qh8YBM_C7g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">云运行+节点</figcaption></figure><p id="de96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这么说吧。</p><ul class=""><li id="faf5" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">你知道Node Foundation发布了尖端的<a class="ae kc" rel="noopener" href="/@nodejs/introducing-node-js-12-76c41a1b3f3f"> Node 12 </a>。</li><li id="6d24" class="jt ju hi ih b ii kd im ke iq kf iu kg iy kh jc jy jz ka kb bi translated">它包括一些很酷的新特性，比如更高性能的异步/等待、更快的HTTP解析和私有字段。它仍在开发中，但您希望将其用于您的服务。</li><li id="20e3" class="jt ju hi ih b ii kd im ke iq kf iu kg iy kh jc jy jz ka kb bi translated">但是Google Cloud Functions还不支持Node 12。😢</li></ul><p id="2832" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以whatchagunnado？</p><ul class=""><li id="e735" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated"><em class="ki">关于它的博客？</em></li></ul><p id="57f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">…也许吧</p><ul class=""><li id="d433" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">或者使用云运行💨👟</li></ul><p id="05db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来学习如何做到这一点！</p><h1 id="f233" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">将节点12功能部署到云运行</h1><p id="59ed" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">Node是基于Chrome的V8引擎构建的JavaScript运行时。</p><p id="c40b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">cloud Run(<a class="ae kc" href="http://cloud.run" rel="noopener ugc nofollow" target="_blank">http://cloud . Run</a>)是一个托管的无服务器计算平台，它将基础设施管理抽象化，因此您可以专注于构建出色的应用程序。</p><p id="30d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总之，您可以在几分钟内基于Google Cloud构建可扩展的服务。</p><h2 id="6eab" class="lm kk hi bd kl ln lo lp kp lq lr ls kt iq lt lu kx iu lv lw lb iy lx ly lf lz bi translated">首先，安装节点12</h2><p id="1909" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated"><a class="ae kc" href="http://github.com/tj" rel="noopener ugc nofollow" target="_blank"> TJ </a>有一个非常简单的节点模块，名为<code class="du ma mb mc md b">n </code>，用于管理节点版本(即在10和12之间切换)。安装名为<code class="du ma mb mc md b">n</code>的全局CLI:</p><pre class="je jf jg jh fd me md mf mg aw mh bi"><span id="323b" class="lm kk hi md b fi mi mj l mk ml">sudo npm i n -g</span></pre><p id="b348" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后将您的节点版本切换到节点12:</p><pre class="je jf jg jh fd me md mf mg aw mh bi"><span id="1d20" class="lm kk hi md b fi mi mj l mk ml">sudo n 12</span></pre><p id="425b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">验证您的节点版本</p><pre class="je jf jg jh fd me md mf mg aw mh bi"><span id="ec91" class="lm kk hi md b fi mi mj l mk ml">node -v # v12.7.0</span></pre><h2 id="e685" class="lm kk hi bd kl ln lo lp kp lq lr ls kt iq lt lu kx iu lv lw lb iy lx ly lf lz bi translated">创建节点12函数</h2><p id="a9e4" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">创建一个新的<code class="du ma mb mc md b">package.json</code>:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mm mn l"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">很难比这更简单了！</figcaption></figure><p id="0107" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<code class="du ma mb mc md b">greeter.js</code>中创建一个使用节点12私有字段的类:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mm mn l"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">#私有字段</figcaption></figure><p id="8296" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建一个<code class="du ma mb mc md b">index.js</code>文件:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mm mn l"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">私有字段不可访问！</figcaption></figure><h2 id="c1cc" class="lm kk hi bd kl ln lo lp kp lq lr ls kt iq lt lu kx iu lv lw lb iy lx ly lf lz bi translated">在本地测试功能框架</h2><p id="63ca" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">您需要在本地测试您的服务，以确保您的代码能够正常工作。</p><ul class=""><li id="1317" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated"><code class="du ma mb mc md b">npm i</code>安装<a class="ae kc" href="https://github.com/GoogleCloudPlatform/functions-framework-nodejs" rel="noopener ugc nofollow" target="_blank">功能框架</a>。</li><li id="0254" class="jt ju hi ih b ii kd im ke iq kf iu kg iy kh jc jy jz ka kb bi translated"><code class="du ma mb mc md b">npm start</code>启动框架</li><li id="306a" class="jt ju hi ih b ii kd im ke iq kf iu kg iy kh jc jy jz ka kb bi translated">转到<code class="du ma mb mc md b"><a class="ae kc" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/</a></code>查看本地的服务器响应。</li></ul><p id="0048" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以我们让事情在本地进行。但是我们如何将它部署到Google Cloud上呢？请继续阅读！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mo"><img src="../Images/543f8901efb64b99b91b55c4f3597b60.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*TjeojMm79LhZAByW.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">接下来，我们将使用云构建+云运行</figcaption></figure><h2 id="7112" class="lm kk hi bd kl ln lo lp kp lq lr ls kt iq lt lu kx iu lv lw lb iy lx ly lf lz bi translated">创建Dockerfile文件</h2><blockquote class="mp mq mr"><p id="2bfd" class="if ig ki ih b ii ij ik il im in io ip ms ir is it mt iv iw ix mu iz ja jb jc hb bi translated">好的。我实话实说。如果你6个月前问我码头工人是什么，我会咕哝一些关于箱子、集装箱船和蓝鲸的事情。但是…</p></blockquote><p id="5164" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Docker真的没什么好怕的。它是一个开发和运行应用程序的开放平台。要运行一个应用程序，您需要为Docker创建一些指令来设置您的环境。</p><p id="72f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建一个名为<code class="du ma mb mc md b">Dockerfile</code>(无文件扩展名)的文件，如下所示:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mm mn l"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">节点应用程序的基本docker文件</figcaption></figure><p id="daa0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们会告诉Docker，使用Node 12，复制我们上面定义的<code class="du ma mb mc md b">package.json</code>，安装，复制我们的文件，然后启动我们的服务器！</p><h2 id="ff2b" class="lm kk hi bd kl ln lo lp kp lq lr ls kt iq lt lu kx iu lv lw lb iy lx ly lf lz bi translated">部署到云运行</h2><p id="a1f6" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">要部署到Google的云运行，请遵循以下3个步骤:</p><p id="0119" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1️⃣设置<code class="du ma mb mc md b">gcloud</code></p><pre class="je jf jg jh fd me md mf mg aw mh bi"><span id="0265" class="lm kk hi md b fi mi mj l mk ml"># Install gcloud beta services<br/>gcloud components install beta</span><span id="694d" class="lm kk hi md b fi mv mj l mk ml"># Set env var "GCP_PROJECT" to our project name<br/>GCP_PROJECT=$(gcloud config list --format 'value(core.project)' 2&gt;/dev/null)</span><span id="0eda" class="lm kk hi md b fi mv mj l mk ml"># Set our Cloud Run region (so we aren't prompted)<br/>gcloud config set run/region us-central1</span></pre><p id="9e0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2️⃣上传你的代码并构建容器</p><pre class="je jf jg jh fd me md mf mg aw mh bi"><span id="cff7" class="lm kk hi md b fi mi mj l mk ml"># Build and upload your image in Google Container Registry<br/>gcloud builds submit --tag gcr.io/$GCP_PROJECT/helloworld</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mw"><img src="../Images/2ba2336be9dc3f8292508820ac429271.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tiDyAbIVhyR-IoAhyGRqxw.gif"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">注意Dockerfile文件中的每个命令都会被执行(大约30秒)</figcaption></figure><p id="3f9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3️⃣部署到云运行</p><pre class="je jf jg jh fd me md mf mg aw mh bi"><span id="3a7a" class="lm kk hi md b fi mi mj l mk ml"># Deploy your container to Cloud Run<br/>gcloud beta run deploy --image gcr.io/$GCP_PROJECT/helloworld --platform managed</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mx"><img src="../Images/37951a36c1123dbe6dc586eabf4c23ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9W8iFR2eIVcw2uami_fv9A.gif"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">将我们的容器部署到云上运行(大约17秒)</figcaption></figure><p id="83f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将会看到一个如下所示的URL:</p><pre class="je jf jg jh fd me md mf mg aw mh bi"><span id="ed14" class="lm kk hi md b fi mi mj l mk ml"><a class="ae kc" href="https://helloworld-q7vieseilq-uc.a.run.app/" rel="noopener ugc nofollow" target="_blank">https://helloworld-q7vieseilq-uc.a.run.app</a></span></pre></div><div class="ab cl my mz gp na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="hb hc hd he hf"><p id="44ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">恭喜你。您将功能框架部署到了云运行。</p><h1 id="444c" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">后续步骤</h1><p id="9978" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">感谢阅读！看看这些相关的帖子:</p><ul class=""><li id="052f" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated"><a class="ae kc" href="https://cloud.google.com/run/docs/quickstarts/build-and-deploy" rel="noopener ugc nofollow" target="_blank">云运行快速入门</a></li><li id="3421" class="jt ju hi ih b ii kd im ke iq kf iu kg iy kh jc jy jz ka kb bi translated"><a class="ae kc" rel="noopener" href="/google-cloud/debugging-node-google-cloud-functions-locally-in-vs-code-e6b912eb3f84">用VS代码调试节点功能</a></li><li id="3b56" class="jt ju hi ih b ii kd im ke iq kf iu kg iy kh jc jy jz ka kb bi translated"><a class="ae kc" rel="noopener" href="/google-cloud/simplifying-continuous-deployment-to-cloud-run-with-cloud-build-including-custom-domain-setup-ssl-22d23bed5cd6">通过云运行设置连续部署</a></li></ul></div></div>    
</body>
</html>