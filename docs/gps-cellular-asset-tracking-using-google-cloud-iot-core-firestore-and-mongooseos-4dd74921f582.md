# ä½¿ç”¨è°·æ­Œäº‘ç‰©è”ç½‘æ ¸å¿ƒã€Firestore å’Œ MongooseOS è¿›è¡Œ GPS/èœ‚çªèµ„äº§è·Ÿè¸ª

> åŽŸæ–‡ï¼š<https://medium.com/google-cloud/gps-cellular-asset-tracking-using-google-cloud-iot-core-firestore-and-mongooseos-4dd74921f582?source=collection_archive---------0----------------------->

![](img/5737ac7a4b336b2cb60baa4f4eb7381b.png)

## ä½¿ç”¨ GPS è·Ÿè¸ªå™¨éšæ—¶éšåœ°è·Ÿè¸ªæ‚¨çš„è´§ç‰©ï¼Œé€šè¿‡ç§»åŠ¨ç½‘ç»œå°†ä½ç½®æ•°æ®å‘é€åˆ°ä»¤äººæ•¬ç•çš„äº‘å’Œæ— æœåŠ¡å™¨æž¶æž„ã€‚

å½“ä»Šç‰©æµè¡Œä¸šé¢ä¸´çš„æœ€å¤§é—®é¢˜ä¹‹ä¸€æ˜¯èµ„äº§å’Œè½¦è¾†çš„è·Ÿè¸ªã€‚æˆ‘ä»¬æœ‰å¾ˆå¤šæ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒGPS å’Œèœ‚çªæŠ€æœ¯å·²ç»å­˜åœ¨å¾ˆé•¿æ—¶é—´äº†ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è¶³ä»¥å‡ ä¹Žå®žæ—¶åœ°è·Ÿè¸ªè½¦è¾†ã€‚æˆ‘ä»¬çš„é¡¹ç›®å°†ä½¿ç”¨è¿™ä¸¤ç§æŠ€æœ¯æ¥å®žçŽ°è¿™ä¸€ç›®æ ‡ã€‚åœ¨æœ¬æ•™ç¨‹ç»“æŸæ—¶ï¼Œè¯·æŸ¥çœ‹æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„å¤–è§‚:

![](img/6bd16edbf0a35e50a4d10d6213547f72.png)

æˆ‘ä»¬å‡ºè‰²çš„ç½‘ç»œåº”ç”¨ç¨‹åºæ¥è·Ÿè¸ªæˆ‘ä»¬çš„èµ„äº§ã€‚

> æ‚¨å¯ä»¥åœ¨[https://asset-tracker-iot.firebaseapp.com/](https://asset-tracker-iot.firebaseapp.com/)è®¿é—®ç½‘ç»œåº”ç”¨

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿è¡Œ **MongooseOS** çš„ **ESP32** å¾®æŽ§åˆ¶å™¨æž„å»ºä¸€ä¸ªèµ„äº§è·Ÿè¸ªå™¨ï¼Œå®ƒä½¿ç”¨ MQTT åè®®é€šè¿‡ç§»åŠ¨ç½‘ç»œé€šè¿‡**äº‘ç‰©è”ç½‘æ ¸å¿ƒ**å®‰å…¨åœ°å‘é€æ•°æ®ï¼Œä½¿ç”¨ **Firebase äº‘å‡½æ•°**ä»¥åŸºäºŽäº‹ä»¶çš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œåœ¨ **Firestore ä¸­ä¿å­˜æ•°æ®å’Œå½“å‰è®¾å¤‡çŠ¶æ€ã€‚**ç„¶åŽå¯ä»¥é€šè¿‡æ‰˜ç®¡åœ¨ **Firebase Hosting** ä¸Šçš„**æ¸è¿›å¼ç½‘ç»œåº”ç”¨**è®¿é—®æ•°æ®ï¼Œç”šè‡³å¯ä»¥è¿œç¨‹é…ç½®è®¾å¤‡ï¼Œå±•ç¤ºäº‘ç‰©è”ç½‘æ ¸å¿ƒåŒå‘é€šä¿¡ã€‚

å¦‚æžœä½ å¯¹è®¸å¤šæœ¯è¯­æ„Ÿåˆ°å›°æƒ‘ï¼Œæˆ‘å»ºè®®ä½ é˜…è¯»æˆ‘å†™çš„å¦ä¸€ç¯‡å…³äºŽåœ¨ç‰©è”ç½‘é¡¹ç›®ä¸­ä½¿ç”¨è°·æ­Œäº‘çš„æ–‡ç« ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†æ›´è¯¦ç»†åœ°è§£é‡Šè¿™äº›äº§å“ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å°†æ›´ç®€æ´åœ°ä»‹ç»ä¸€ä¸‹ Google ä¸Šçš„é¡¹ç›®é…ç½®ã€‚

[](/google-cloud/build-a-weather-station-using-google-cloud-iot-core-and-mongooseos-7a78b69822c5) [## ä½¿ç”¨è°·æ­Œäº‘ç‰©è”ç½‘æ ¸å¿ƒå’Œ MongooseOS æž„å»ºæ°”è±¡ç«™

### åˆ©ç”¨æ‰˜ç®¡çš„æ— æœåŠ¡å™¨æž¶æž„æ”¶é›†å¤§é‡æ•°æ®ï¼Œè¿™æ ·æ‚¨å°±ä¸ä¼šåœ¨â€¦

medium.com](/google-cloud/build-a-weather-station-using-google-cloud-iot-core-and-mongooseos-7a78b69822c5) 

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä¸“æ³¨äºŽå»ºç«‹ä¸€ä¸ªç«¯åˆ°ç«¯çš„æž¶æž„ï¼Œä»¥å®‰å…¨çš„æ–¹å¼å¤„ç†æ¥è‡ªä¼ æ„Ÿå™¨çš„ä½ç½®æ•°æ®ï¼Œå­˜å‚¨æ•°æ®ï¼Œåœ¨åœ°å›¾ä¸Šå®žæ—¶æ˜¾ç¤ºæˆ‘ä»¬çš„è½¦é˜Ÿã€‚æˆ‘ä»¬çš„æž¶æž„å°†ä¼šæ˜¯è¿™æ ·çš„:

![](img/0b4e0a5319eb198249889d1c6672f865.png)

æˆ‘ä»¬çš„é¡¹ç›®æž¶æž„

# æˆ‘ä»¬å°†å­¦åˆ°ä»€ä¹ˆ

åšä¸€ä¸ªä¾èµ–ç§»åŠ¨ç½‘ç»œå¹¶è€ƒè™‘åˆ°å®‰å…¨æ€§çš„é¡¹ç›®å¹¶ä¸å®¹æ˜“ã€‚æˆ‘å°†å±•ç¤ºä½¿ç”¨ **MongooseOS** åŠå…¶å‡ºè‰²çš„ **PPPoS** åº“æ¥å®žçŽ°è¿™ä¸€ç‚¹æ˜¯å¤šä¹ˆå®¹æ˜“ï¼Œè¯¥åº“é€šè¿‡ GPRS/èœ‚çªä¸²è¡Œæ¨¡å—æŠ½è±¡ç½‘ç»œï¼Œä½¿æˆ‘ä»¬æ›´å®¹æ˜“æž„å»ºä¾èµ–äºŽè¿™ç§é€šä¿¡çš„äº§å“ã€‚

ä½¿ç”¨ MQTT å‘é€æ•°æ®çš„å®‰å…¨é€šé“å°†ç”±äº‘ç‰©è”ç½‘æ ¸å¿ƒå¤„ç†ã€‚æ‰€æœ‰æ”¶åˆ°çš„æ•°æ®éƒ½å°†å­˜å‚¨åœ¨ Firestore æ•°æ®åº“ä¸­ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬å°†è¦å­¦ä¹ çš„å†…å®¹çš„æ€»ç»“:

*   å¿«é€Ÿå›žé¡¾å¦‚ä½•åˆ›å»ºä¸€ä¸ª**è°·æ­Œäº‘ç‰©è”ç½‘**é¡¹ç›®ã€‚
*   ä½¿ç”¨å¸¦æœ‰ä¸²è¡Œ GPRS æ¨¡å—çš„ **MongooseOS** ã€‚
*   è°·æ­Œæœ€æ–°çš„ **Firestore** æ˜¯ä»€ä¹ˆï¼Ÿ
*   å°†æ•°æ®ä»Žè®¾å¤‡å‘é€åˆ°äº‘ç«¯ï¼Œå¹¶ä½¿ç”¨ **Firestore** è¿›è¡Œå­˜å‚¨ã€‚
*   ä½¿ç”¨äº‘ç‰©è”ç½‘æ ¸å¿ƒ API å°†æ•°æ®ä»Žäº‘å‘é€åˆ°è®¾å¤‡ã€‚

## åˆ›å»ºé¡¹ç›®å’ŒæœåŠ¡

è¦ä½¿ç”¨`gcloud`å‘½ä»¤è¡Œå·¥å…·ï¼Œ[æŒ‰ç…§è¿™é‡Œçš„è¯´æ˜Žä¸‹è½½å¹¶å®‰è£…å®ƒ](https://cloud.google.com/sdk/downloads)ã€‚

 [## å®‰è£… Cloud SDK | Cloud SDK æ–‡æ¡£| Google äº‘å¹³å°

### ç¼–è¾‘æè¿°

cloud.google.com](https://cloud.google.com/sdk/downloads) 

å®‰è£… SDK åŽï¼Œæ‚¨åº”è¯¥å®‰è£…æµ‹è¯•ç‰ˆå·¥å…·æ¥è®¿é—®äº‘ç‰©è”ç½‘æ ¸å¿ƒå‘½ä»¤ã€‚æ­¤å¤–ï¼Œåœ¨æ­¤ä¹‹åŽï¼Œæ‚¨åº”è¯¥éªŒè¯å¹¶åˆ›å»ºä¸€ä¸ªåœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨çš„é¡¹ç›®ï¼Œå°†æ‚¨çš„ _PROJECT_NAME æ›¿æ¢ä¸ºæ‚¨å¸Œæœ›ç”¨äºŽæ­¤é¡¹ç›®çš„åç§°:

```
# Install beta components:
**gcloud components install beta** # Authenticate with Google Cloud:
**gcloud auth login** # Create cloud project â€” choose your unique project name:
**gcloud projects create YOUR_PROJECT_NAME** # Set current project **gcloud config set project YOUR_PROJECT_NAME**
```

åˆ›å»ºäº‘ç‰©è”ç½‘æ³¨å†Œè¡¨ï¼Œè®¾å¤‡å°†åœ¨å…¶ä¸­æ³¨å†Œä»¥å‘é€æ•°æ®ã€‚

```
# Add permissions for IoT Core **gcloud projects add-iam-policy-binding YOUR_PROJECT_NAME --member=serviceAccount:cloud-iot@system.gserviceaccount.com --role=roles/pubsub.publisher** # Create PubSub topic for device data:
**gcloud beta pubsub topics create telemetry-topic** # Create PubSub subscription for device data:
**gcloud beta pubsub subscriptions create --topic telemetry-topic telemetry-subscription** # Create device registry:
**gcloud beta iot registries create asset-tracker-registry --region us-central1 --event-pubsub-topic=telemetry-topic**
```

å¦‚æžœæ‚¨è®¿é—®è°·æ­Œäº‘æŽ§åˆ¶å°ï¼Œæ‚¨å¯ä»¥éªŒè¯ä¸€åˆ‡éƒ½å·²åˆ›å»ºå’Œé…ç½®ã€‚

![](img/ee782ecbb8413dc979e11e9c36a4603e.png)

å·²åˆ›å»ºå¹¶ä¸Žå‘å¸ƒè®¢é˜…ä¸»é¢˜ç›¸å…³è”çš„æ³¨å†Œè¡¨

# å®‰è£…ç¡¬ä»¶

åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•è®¾ç½®èµ„äº§è¿½è¸ªå™¨ã€æ‰€éœ€çš„æ‰€æœ‰æ¨¡å—ä»¥åŠå¦‚ä½•ç”¨æˆ‘ä»¬çš„ä»£ç å¯¹ç”µè·¯æ¿è¿›è¡Œç¼–ç¨‹ã€‚

## æˆåˆ†

æˆ‘ä»¬é¡¹ç›®çš„æ ¸å¿ƒå°†æ˜¯ä¸€ä¸ª ESP32 WiFi å¾®æŽ§åˆ¶å™¨ï¼Œå®ƒæœ‰è®¸å¤šé£Žæ ¼ï¼Œæ®æˆ‘æ‰€çŸ¥ï¼Œä»»ä½•æ¨¡åž‹éƒ½å¯ä»¥å·¥ä½œã€‚

![](img/6799bd76d7504d9503cde6adaeb7c709.png)

çŒ«é¼¬æ“ä½œç³»ç»Ÿå’Œè°·æ­Œç‰©è”ç½‘æ ¸å¿ƒåŒ…ï¼Œå¸¦ Adafruit Feather huzzah 32â€”[https://www.adafruit.com/product/3606](https://www.adafruit.com/product/3606)

ä»¥ä¸‹æ˜¯é¡¹ç›®ç»„ä»¶åˆ—è¡¨:

*   ä»»ä½• ESP32 æ¿(æˆ‘ç”¨çš„æ˜¯ Lolin32)ã€‚
*   NEO 6M uBlox GPS æ¨¡å—ã€‚
*   Sim800L GSM æ¨¡å—ã€‚
*   å‘å…‰äºŒæžç®¡çš„ 220 æ¬§å§†ç”µé˜»ã€‚
*   è“è‰²å’Œç»¿è‰² LED æ˜¾ç¤ºè®¾å¤‡çŠ¶æ€ã€‚
*   ç”¨äºŽ MOSFET è§¦å‘å™¨çš„ 1k å’Œ 10k æ¬§å§†ç”µé˜»ã€‚
*   IRF540N MOSFET(ä¸è¦å°è¯•ä½¿ç”¨ TIP120 ç­‰å»‰ä»· MOSFETï¼Œå› ä¸ºå®ƒæ— æ³•æ»¡è¶³ GSM æ¨¡å—çš„ç”µæµéœ€æ±‚)
*   1n4007 é™åŽ‹äºŒæžç®¡ï¼Œç”¨äºŽä¸º GSM æ¨¡å—ä¾›ç”µã€‚
*   é’ˆç»‡å¥—è¡«
*   åŽŸåž‹çš„æ€§èƒ½æ¿(å¯é€‰)

æˆ‘ä»¬çš„ç¤ºæ„å›¾å¦‚ä¸‹:

![](img/2b5e15e97a9058d5cbcf760a0c7abf20.png)

é¡¹ç›®ç¤ºæ„å›¾

æ€»çš„æ¥è¯´ï¼ŒåŽŸç†å›¾éžå¸¸ç®€å•ã€‚ä¹Ÿè®¸å”¯ä¸€å¥‡æ€ªçš„éƒ¨åˆ†æ˜¯ GSM æ¨¡å—è¿žæŽ¥ã€‚æˆ‘æ”¾äº†ä¸€ä¸ª MOSFET æ¥å¼€å…³æ¨¡å—ï¼Œå› ä¸ºå®ƒæ¶ˆè€—å¾ˆå¤šèƒ½é‡ã€‚è¿™æ ·ï¼Œæˆ‘å°±å¯ä»¥ä½¿ç”¨æ›´å°‘çš„èƒ½æºï¼Œå¹¶ä¸”åœ¨ä¸å‘é€æ•°æ®æ—¶è®©è®¾å¤‡è¿›å…¥ç¡çœ çŠ¶æ€ã€‚å¦ä¸€ä¸ªç»†èŠ‚æ˜¯ä½¿ç”¨äºŒæžç®¡æ¥é™ä½Žç”¨ 4.2v ç»™ GSM æ¨¡å—ä¾›ç”µçš„ç”µåŽ‹ï¼Œå› ä¸ºç”¨ 3.3v æˆ– 5v ç»™å®ƒä¾›ç”µè¢«æ¨¡å—åˆ†åˆ«è®¤ä¸ºæ˜¯æ¬ åŽ‹å’Œè¿‡åŽ‹ã€‚

![](img/9c475b87d98b05a8987fa3e769ae590f.png)

è¿™æ˜¯åœ¨ perfboard ä¸Šç»„è£…çš„é¡¹ç›®ã€‚

## å¯¹ç¡¬ä»¶è¿›è¡Œç¼–ç¨‹å¹¶ä¸Žæˆ‘ä»¬çš„é¡¹ç›®ç›¸å…³è”

ä¸ºäº†ç»™ç”µè·¯æ¿ç¼–ç¨‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ MongooseOSã€‚å®ƒæœ‰ä¸€ä¸ªåä¸º *mos* çš„å·¥å…·ï¼Œå¯ä»¥åœ¨æ”¯æŒçš„ä¸»æ¿ä¸Šè½»æ¾ç¼–ç¨‹ã€é…ç½®å’Œé…ç½®ã€‚è¦ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬éœ€è¦ä»Žå®˜æ–¹ç½‘ç«™ä¸‹è½½å¹¶å®‰è£…å®ƒã€‚éµå¾ª[https://mongoose-os.com/docs/quickstart/setup.html](https://mongoose-os.com/docs/quickstart/setup.html)ä¸Šçš„å®‰è£…è¯´æ˜Žã€‚

[](https://mongoose-os.com/docs/quickstart/setup.html) [## Mongoose æ“ä½œç³»ç»Ÿæ–‡æ¡£

### Mongoose æ“ä½œç³»ç»Ÿæ–‡æ¡£å’Œç”¨æˆ·æŒ‡å—

mongoose-os.com](https://mongoose-os.com/docs/quickstart/setup.html) 

å®‰è£…å¥½å·¥å…·åŽï¼Œåœ¨è¿™é‡Œé“¾æŽ¥çš„ [Github ä»“åº“ä¸Šä¸‹è½½é¡¹ç›®ä»£ç ](https://github.com/alvarowolfx/asset-tracker-gcp-mongoose-os)ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥åœ¨è®¾å¤‡ä¸Šæž„å»ºå’Œéƒ¨ç½²å®ƒäº†ã€‚

[](https://github.com/alvarowolfx/asset-tracker-gcp-mongoose-os) [## alvarowolfx/èµ„äº§è·Ÿè¸ªç³»ç»Ÿ-GCP-mongose-OS

### èµ„äº§è¿½è¸ª-GCP-mongose-OS-ðŸš§[WIP]ä½¿ç”¨è¿è¡Œ MongooseOS + GPS å’Œ GPRS æ¨¡å—çš„ ESP32 åˆ¶ä½œçš„èµ„äº§è¿½è¸ªå™¨â€¦

github.com](https://github.com/alvarowolfx/asset-tracker-gcp-mongoose-os) 

å­˜å‚¨åº“ç”± **3 ä¸ªå­é¡¹ç›®**ç»„æˆ:

*   **å›ºä»¶**:è¿è¡Œåœ¨å¾®æŽ§åˆ¶å™¨ä¸Šçš„ MongooseOS é¡¹ç›®ï¼Œå®ƒæ”¶é›†ä½ç½®æ•°æ®ï¼Œå¹¶ä½¿ç”¨èœ‚çªç½‘ç»œé€šè¿‡äº‘ç‰©è”ç½‘æ ¸å¿ƒå‘é€ã€‚
*   **åŠŸèƒ½**:å°†éƒ¨ç½²åˆ° **Firebase** ä¸Šçš„äº‘åŠŸèƒ½ã€‚è¿™é‡Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°å¯¹ PubSub ä¸Šçš„æ–°æ•°æ®åšå‡ºååº”ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨ **Firestore** ä¸Šã€‚è¿˜æœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ª HTTP ç«¯ç‚¹ï¼Œç”¨äºŽå°†æ•°æ®ä»Žäº‘å‘é€åˆ°è®¾å¤‡ï¼Œå¹¶é…ç½®æ›´æ–°é—´éš”ã€‚å®ƒå°†ç”±æˆ‘ä»¬çš„ WebApp ä½¿ç”¨ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥é…ç½®æˆ‘ä»¬è®¾å¤‡çš„æ›´æ–°é—´éš”ã€‚
*   **public** :ç”¨ React æž„å»ºçš„ WebAppï¼Œå°†éƒ¨ç½²åœ¨ Firebase ä¸»æœºä¸Šï¼Œå®ƒå‚è€ƒæˆ‘ä»¬çš„æ•°æ®åº“ï¼Œåœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºæˆ‘ä»¬çš„è®¾å¤‡ï¼Œå¹¶ä¸Žå®ƒä»¬è¿›è¡Œäº¤äº’ã€‚è¯¥é¡¹ç›®æ˜¯ä½¿ç”¨`create-react-app`åˆ›å»ºçš„ã€‚

æˆ‘å°†åœ¨æŽ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­è¯¦ç»†ä»‹ç»æ¯ä¸ªé¡¹ç›®ã€‚

## å›ºä»¶é¡¹ç›®

ä»¥ä¸‹æ˜¯å¯¹**å›ºä»¶**é¡¹ç›®çš„ä¸€äº›æè¿°:

*   **fs/init.js** :è¿™é‡Œæ˜¯æˆ‘ä»¬çš„ Javascript ä»£ç ï¼Œå®ƒåŒ…å«äº†åœ¨å¯é…ç½®çš„æ—¶é—´é—´éš”å†…æ”¶é›†æ•°æ®å¹¶é€šè¿‡ MQTT å‘é€çš„æ‰€æœ‰é€»è¾‘ã€‚
*   **mos.yml** :æˆ‘ä»¬çš„é¡¹ç›®é…ç½®ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å£°æ˜Žæˆ‘ä»¬çš„é¡¹ç›®ä¾èµ–é¡¹ï¼Œè¿™é‡Œæ˜¯ GCPã€PPPoSã€GPS å’Œ mJS åº“ï¼Œæœ€åŽä¸€ä¸ªå¢žåŠ äº†å¯¹ Javascript embedded çš„æ”¯æŒã€‚è¿™é‡Œæˆ‘ä»¬å£°æ˜Žäº†ä¸€ä¸ªåä¸º **app.update_intervalï¼Œ**çš„é…ç½®å˜é‡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ”¹å˜è¿™ä¸ªé…ç½®æ¥æ”¹å˜æ›´æ–°é—´éš”ï¼Œè¿™ä¸ªé…ç½®ä¹Ÿå¯ä»¥é€šè¿‡ *mos* å·¥å…·æˆ–ä»£ç æ¥æ”¹å˜ã€‚æˆ‘è¿˜é€šè¿‡ **wifi.sta.enable** é…ç½®å…³é—­äº† WiFi ä»¥å‡å°‘å¾®æŽ§åˆ¶å™¨ä¸Šçš„åŠŸè€—ã€‚

*   åœ¨ **mos.yml** æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° PPoS å’Œ GPS çš„é…ç½®ã€‚æ‚¨å¿…é¡»å°†å…¶æ›´æ”¹ä¸ºæ‚¨çš„ SIM å¡ç½‘ç»œ APN é…ç½®æ‰èƒ½ä½¿å…¶å·¥ä½œã€‚æ ¹æ®æ‚¨çš„ ESP32 åž‹å·ï¼Œæ‚¨è¿˜å¯ä»¥æ›´æ”¹é¡¹ç›®ä½¿ç”¨çš„ UART ç«¯å£ã€‚

çŽ°åœ¨çœ‹ä¸€ä¸‹è®¾å¤‡ä»£ç ï¼Œå®ƒçš„å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½æœ‰ä¸€ç‚¹æ³¨é‡Šã€‚åŸºæœ¬ä¸Šï¼Œè®¾å¤‡æµç¨‹å¦‚ä¸‹:

*   å°è¯•è¿žæŽ¥åˆ° MQTT æœåŠ¡å™¨å¹¶æ‰“å¼€/å…³é—­ GSM Ledã€‚
*   å°è¯•èŽ·å–ä¸€äº› GPS æ•°æ®ï¼Œç„¶åŽæ‰“å¼€/å…³é—­ GPS Ledã€‚
*   å¦‚æžœä¸€åˆ‡æ­£å¸¸ï¼Œå®ƒä¼šé€šè¿‡ MQTT å‘å¸ƒæ•°æ®ã€‚
*   å‘å¸ƒåŽï¼Œè®¾å¤‡ä¼šåœ¨ä¸€æ®µæ—¶é—´åŽå…³é—­ GSM æ¨¡å—(ä»¥ä¾¿æœ‰æ—¶é—´å‘å¸ƒæ¶ˆæ¯)ï¼Œç„¶åŽè¿›å…¥æ·±åº¦ç¡çœ æ¨¡å¼ã€‚
*   ä»Žæ·±åº¦ç¡çœ ä¸­é†’æ¥åŽï¼Œè®¾å¤‡ä¼šè‡ªåŠ¨å¤ä½å¹¶é‡æ–°å¼€å§‹ã€‚
*   å¦‚æžœè®¾å¤‡å‘å¸ƒæ•°æ®çš„æ—¶é—´å¤ªé•¿ï¼Œå®ƒä¹Ÿä¼šè¿›å…¥æ·±åº¦ç¡çœ æ¨¡å¼ä»¥èŠ‚çœç”µæ± ã€‚

è¦å¯¹ç¡¬ä»¶è¿›è¡Œç¼–ç¨‹ï¼Œè¯·è¿›å…¥**å›ºä»¶**æ–‡ä»¶å¤¹å¹¶è¿è¡Œä»¥ä¸‹æŒ‡ä»¤æ¥åˆ·æ–°å›ºä»¶ã€é…ç½® WiFi å¹¶åœ¨äº‘ç‰©è”ç½‘æ ¸å¿ƒä¸Šé…ç½®è®¾å¤‡:

*   æ ¹æ®é€‰æ‹©çš„ç¡¬ä»¶è¿è¡Œ`mos build --arch esp32`ã€‚è¿™ä¸ªå‘½ä»¤æž„å»ºæˆ‘ä»¬ç¡¬ä»¶çš„å›ºä»¶ã€‚
*   åœ¨é€šè¿‡ USB è¿žæŽ¥ç¡¬ä»¶çš„æƒ…å†µä¸‹è¿è¡Œ`mos flash`æ¥åˆ·æ–°å›ºä»¶ã€‚
*   è¿è¡Œä»¥ä¸‹å‘½ä»¤åœ¨äº‘ IoT ä»£ç ä¸Šæ³¨å†Œæ­¤è®¾å¤‡ã€‚è¯¥å‘½ä»¤ç”Ÿæˆç”¨äºŽé€šä¿¡çš„å…¬é’¥å’Œç§é’¥ï¼Œå°†ç§é’¥æ”¾åœ¨è®¾å¤‡ä¸Šï¼Œå°†å…¬é’¥å‘é€åˆ°äº‘ç‰©è”ç½‘æ ¸å¿ƒå¹¶æ³¨å†Œè®¾å¤‡ï¼Œä»Ž ESP èŽ·å–è®¾å¤‡ Idã€‚è°¢è°¢è’™å¤äººâ¤.

```
mos gcp-iot-setup --gcp-project **YOUR_PROJECT_NAME** --gcp-region us-central1 --gcp-registry **YOUR_REGISTRY**
```

å°±æ˜¯è¿™æ ·ï¼Œä½ çš„è®¾å¤‡å°†å¼€å§‹æ”¶é›†ä½ç½®æ•°æ®ï¼Œè¿žæŽ¥åˆ°èœ‚çªç½‘ç»œï¼Œå¹¶å°†æ•°æ®å‘é€åˆ°äº‘ç‰©è”ç½‘æ ¸å¿ƒã€‚ä½ å¯ä»¥ä½¿ç”¨`mos console`å·¥å…·çœ‹åˆ°è®¾å¤‡ä¸Šå‘ç”Ÿäº†ä»€ä¹ˆã€‚ä½ ä¼šçœ‹åˆ°å®ƒè¯•å›¾è¿žæŽ¥åˆ°èœ‚çªç½‘ç»œå’Œ mqtt.googleapis.comã€‚ä¸‹é¢æ˜¯æ¥è‡ª`mos console`çš„ä¸€äº›è¾“å‡ºï¼Œæˆ‘çœç•¥äº†ä¸€äº›åžƒåœ¾æ¶ˆæ¯:

```
$ mos console
Using port /dev/cu.SLAB_USBtoUART
[Jan 17 11:18:00.762] mgos_net_on_change_c PPP: connecting
[Jan 17 11:18:00.772] == Net event: 1 CONNECTING 
[Jan 17 11:18:00.811] mgos_pppos_uart_disp Starting PPP, user 'tim'
[Jan 17 11:18:00.818] mgos_net_on_change_c PPP: connected
[Jan 17 11:18:00.827] == Net event: 2 CONNECTED 
[Jan 17 11:18:00.833] mongoose_poll        New heap free LWM: 218968
[Jan 17 11:18:01.559] mgos_net_on_change_c PPP: ready, IP 179.11.108.69, GW 192.168.254.254, DNS 189.40.198.80
[Jan 17 11:18:01.572] == Net event: 3 GOT_IP 
[Jan 17 11:18:01.579] mgos_mqtt_global_con MQTT connecting to mqtt.googleapis.com:8883
[Jan 17 11:18:01.827] $GGA: fix quality: 0
[Jan 17 11:18:01.832] $GSV: sattelites in view: 3
[Jan 17 11:18:02.498] mgos_sntp_query      SNTP query to pool.ntp.org
[Jan 17 11:18:09.730] mongoose_poll        New heap free LWM: 206328
[Jan 17 11:18:09.810] mgos_mqtt_ev         MQTT TCP connect ok (0)
[Jan 17 11:18:10.834] mgos_sntp_ev         SNTP reply from 200.160.7.186: time 1516198687.979016, local 27.250466, delta 1516198660.728550
[Jan 17 11:18:24.767] mgos_mqtt_ev         MQTT CONNACK 0
[Jan 17 11:18:24.774] MQTT CONNECTED 
[Jan 17 11:18:24.782] do_subscribe         Subscribing to '/devices/esp32_3884A4/config'
[Jan 17 11:18:26.182] Got config update: {"update_interval":120}
[Jan 17 11:18:26.291] save_cfg             Saved to conf9.json
[Jan 17 11:18:26.312] Setting timer with  120  seconds interval 
[Jan 17 11:18:29.304] Published 
[Jan 17 11:18:29.307] Sleeping 
[Jan 17 11:18:37.316] Turning off all devices
```

æˆ‘å»ºè®®å¸¦ç€è®¾å¤‡åŽ»æ•£æ­¥ï¼Œä»¥ç”Ÿæˆæ•°æ®ï¼Œæœ‰æ—¶æˆ‘åœ¨å®¶é‡Œè¿žæŽ¥ GPS å’Œ GPRS æ—¶ä¹Ÿä¼šé‡åˆ°é—®é¢˜ã€‚è¦æŸ¥çœ‹ PubSub ä¸Šçš„æ•°æ®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`gcloud`å‘½ä»¤æ¥æŸ¥è¯¢æˆ‘ä»¬åˆ›å»ºçš„è®¢é˜…:

```
$ gcloud beta pubsub subscriptions pull --auto-ack telemetry-subscription
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                               DATA                                                               â”‚   MESSAGE_ID   â”‚                ATTRIBUTES               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {"latlon":{"sp":"0.197133","lon":"-56.082420","lat":"-15.581032"},"temp":53.333333,"free_ram":214.191406,"total_ram":287.621094} â”‚ 22138603640541 â”‚ deviceId=esp32_3884A4                   â”‚
â”‚                                                                                                                                  â”‚                â”‚ deviceNumId=2569363294223005            â”‚
â”‚                                                                                                                                  â”‚                â”‚ deviceRegistryId=asset-tracker-registry â”‚
â”‚                                                                                                                                  â”‚                â”‚ deviceRegistryLocation=us-central1      â”‚
â”‚                                                                                                                                  â”‚                â”‚ projectId=asset-tracker-iot             â”‚
â”‚                                                                                                                                  â”‚                â”‚ subFolder=                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å¦‚æžœä½ çœ‹åˆ°æŽ§åˆ¶å°ä¸Šçš„æ•°æ®ï¼Œä½ å¯ä»¥å¼€å§‹åº†ç¥ï¼Œæˆ‘ä»¬èµ°åœ¨æ­£ç¡®çš„é“è·¯ä¸ŠðŸŽ‰ðŸ†ã€‚

## å…·æœ‰ Firebase äº‘åŠŸèƒ½çš„äº‘ Firestore æ•°æ®åº“å’ŒåŽç«¯

![](img/1a6cd53aa2920dfbe7118f34b0630077.png)

**äº‘ Firestore** å°±åƒæ˜¯ **Google Datastore** å’Œ **Firebase å®žæ—¶æ•°æ®åº“**çš„åˆå¹¶ï¼Œå…·æœ‰ä¸€äº›åŠŸèƒ½ï¼Œå¦‚æ–‡æ¡£å’Œé›†åˆå®šä¹‰ã€å®žæ—¶æ•°æ®åŒæ­¥ã€æ•°æ®å¤åˆ¶å’Œå¤šç§è¯­è¨€çš„ SDKã€‚å¯¹æˆ‘æ¥è¯´ï¼Œæœ€ä»¤äººå…´å¥‹çš„æ¶ˆæ¯ä¹‹ä¸€æ˜¯ï¼Œæ‰€æœ‰ Firebase äº§å“éƒ½åŒæ ·æ˜“äºŽä½¿ç”¨ï¼Œä¸Ž Firebase æ•°æ®åº“ç›¸æ¯”ï¼Œæˆ‘ä»¬çŽ°åœ¨å¯¹é«˜çº§æŸ¥è¯¢å’Œæ•°æ®å»ºæ¨¡çš„æ”¯æŒæ›´å¥½äº†ã€‚

å¯¹äºŽè¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘é€‰æ‹© Firestore æ˜¯å› ä¸ºå®ƒæœ‰ä»¥ä¸‹ç‰¹ç‚¹:

*   åœ¨åä¸º`devices`çš„**é›†åˆ**ä¸­ç»´æŠ¤è®¾å¤‡çŠ¶æ€ï¼Œåœ¨åä¸º`location_logs`çš„**å­é›†åˆ**ä¸­ç»´æŠ¤æ¯ä¸ªè®¾å¤‡å‘é€çš„æ‰€æœ‰ä½ç½®æ•°æ®ã€‚æ¯ä¸ªé›†åˆå¯ä»¥åŒ…å«å¤§é‡å…·æœ‰çµæ´»æ¨¡å¼çš„æ–‡æ¡£ï¼Œè¿™æ · Firestore ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ›´å¥½åœ°ç»„ç»‡æˆ‘ä»¬çš„æ•°æ®å’Œæ›´å¼ºå¤§çš„æŸ¥è¯¢åŠŸèƒ½ï¼Œä»Žè€Œæ›´å¥½åœ°æ‰©å±•ã€‚
*   æˆ‘ä»¬å¯ä»¥è®©å®¢æˆ·ç«¯ä¸Šçš„**å®žæ—¶æ›´æ–°**ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨æ•°æ®åˆ°è¾¾çš„é‚£ä¸€åˆ»çœ‹åˆ°æœ€æ–°çš„æ•°æ®ã€‚
*   æˆ‘ä»¬ä¸éœ€è¦ç»´æŠ¤æˆ–æ‰©å±•æˆ‘ä»¬çš„æ•°æ®åº“:Cloud Firestore å¯ä»¥æ ¹æ®æ‚¨çš„æ•°æ®è¿›è¡Œæ‰©å±•ï¼Œå¹¶ä¸”æ‹¥æœ‰å¼€å§‹å¼€å‘æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ SDKã€‚**ç‰›é€¼çš„æ— æœåŠ¡å™¨å¼€å‘**ã€‚

è¿™ä¸ªé¡¹ç›®ä½¿ç”¨ Firebase Cloud å‡½æ•°æ¥å¤„ç†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéœ€è¦çš„æ‰€æœ‰è‡ªå®šä¹‰è§„åˆ™å’ŒåŽç«¯æœåŠ¡ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œä½†æœ‰äº›è®¾ç½®å¯ä»¥åœ¨é¡¹ç›®ä¸­æ›´æ”¹:

*   **REGION** å’Œ **REGISTRY** :æ‚¨éœ€è¦ä½¿ç”¨è¿™äº›å˜é‡æ›´æ”¹æ‚¨çš„é¡¹ç›®åŒºåŸŸå’Œæ‚¨çš„äº‘ç‰©è”ç½‘æ ¸å¿ƒæ³¨å†Œè¡¨çš„åç§°ã€‚
*   æŽ§åˆ¶æˆ‘ä»¬æ˜¯å¦è®¤ä¸ºæ–°çš„ä½ç½®æ•°æ®æ˜¯è®¾å¤‡çš„ç›¸å½“å¤§çš„ç§»åŠ¨ï¼Œå¦‚æžœæˆ‘è®¤ä¸ºæˆ‘çš„è®¾å¤‡åœ¨ç›¸åŒçš„åœ°æ–¹ã€‚æˆ‘çš„é»˜è®¤è®¾ç½®æ˜¯è€ƒè™‘ 50 ç±³ã€‚

ä¸‹é¢æ˜¯åœ¨äº‘ä¸Šè¿è¡Œçš„å“åº”æˆ‘ä»¬çš„äº‹ä»¶çš„æ¯ä¸ªå‡½æ•°çš„ä¸€äº›ç»†èŠ‚:

*   **exports . updatedeviceconfig:**æˆ‘ä»¬çš„ webapp ç”¨æ¥æ›´æ”¹è®¾å¤‡é…ç½®çš„ HTTP ç«¯ç‚¹ã€‚è¯¥å‡½æ•°æŽ¥æ”¶ä¸€ä¸ª deviceId å’Œä¸€ä¸ª updateIntervalï¼Œç„¶åŽè°ƒç”¨äº‘ç‰©è”ç½‘æ ¸å¿ƒçš„æ–¹æ³• modifyCloudToDeviceConfig æ–¹æ³•æ›´æ–°è®¾å¤‡é…ç½®ã€‚æˆ‘ä»¬ç›´æŽ¥ä½¿ç”¨äº† Google APIsï¼Œç›´åˆ°ä»Šå¤©æˆ‘ä»¬è¿˜æ²¡æœ‰ä¸€ä¸ªå®˜æ–¹çš„äº‘ç‰©è”ç½‘æ ¸å¿ƒåº“(è§ **getCloudIoTClient** å‡½æ•°)ã€‚æ­¤å¤–ï¼Œå½“å‘è®¾å¤‡å‘é€æ–°çš„æ›´æ–°é…ç½®æ—¶ï¼Œæ•°æ®å¿…é¡»æ˜¯ Base64 æ ¼å¼ï¼Œä½†æ˜¯è®¾å¤‡æŽ¥æ”¶çš„æ•°æ®å·²ç»ä»¥ JSON æ ¼å¼è§£æžã€‚
*   **exports . receive telemetry:**è¿™ä¸ªå‡½æ•°å¯¹åˆ°è¾¾äº‘ç‰©è”ç½‘æ ¸å¿ƒé…ç½®çš„ PubSub ä¸»é¢˜çš„æ¯ä¸ªæ•°æ®åšå‡ºååº”ã€‚è¯¥å‡½æ•°å®Œæˆå¤§éƒ¨åˆ†ç¹é‡çš„å·¥ä½œï¼Œå®ƒç»´æŠ¤ Firestore ä¸Šçš„è®¾å¤‡æœ€æ–°æ•°æ®ï¼Œå¹¶æŸ¥çœ‹æ˜¯å¦æœ‰æ˜¾è‘—çš„ç§»åŠ¨æ¥å°†æ–°æ•°æ®æ’å…¥ location_logs å­é›†åˆã€‚
*   è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ï¼Œåœ¨è¿™é‡Œæˆ‘ç»´æŠ¤äº†ä¸€ä¸ªç´¢å¼•ï¼Œè®°å½•äº†æ¯å°è®¾å¤‡æ¯å¤©å­˜å‚¨äº†å¤šå°‘ä½ç½®ç‚¹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“åœ¨ UI ä¸Šæ˜¾ç¤ºå“ªäº›æ—¥æœŸï¼Œè€Œä¸å¿…å¯¹ä½ç½®æ—¥å¿—è¿›è¡Œå¤§é‡çš„æŸ¥è¯¢ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ NoSQL æ•°æ®åº“æ—¶ï¼Œæœ‰æ—¶æˆ‘ä»¬ä¼šæœ‰è¿™äº›**çš„æŠ˜è¡·**æ¥èŽ·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚

ä¸ºäº†éƒ¨ç½²æˆ‘ä»¬çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ *Firebase å‘½ä»¤è¡Œå·¥å…·ï¼Œ*å®ƒéœ€è¦ Nodeã€‚js å’Œ npm [ã€](https://www.npmjs.org/)å¯ä»¥æŒ‰ç…§[https://Nodejs.org/.](https://nodejs.org/)å®‰è£… node ä¸Šçš„è¯´æ˜Žå®‰è£…ï¼ŒJS ä¹Ÿä¼šå®‰è£… npmã€‚å®‰è£…èŠ‚ç‚¹å’Œ NPM åŽï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… Firebase CLIã€‚

```
npm install -g firebase-tools
```

çŽ°åœ¨ï¼Œè¦ç”¨æˆ‘ä»¬çš„é¡¹ç›®é…ç½® firebase å¹¶éƒ¨ç½²åŠŸèƒ½ï¼Œåœ¨é¡¹ç›®æ ¹æ–‡ä»¶å¤¹ä¸­ï¼Œéµå¾ªä¸Šé¢çš„è¯´æ˜Ž:

*   è¿è¡Œ`firebase login`å‘ Google è®¤è¯å¹¶è®¾ç½®å‘½ä»¤è¡Œå·¥å…·
*   è¿è¡Œ`firebase init`å°†æœ¬åœ°é¡¹ç›®ä¸Žæ‚¨çš„ Firebase é¡¹ç›®å…³è”èµ·æ¥ã€‚
*   ç”¨`cd function && npm install.`å‘½ä»¤å®‰è£…äº‘å‡½æ•°ä¾èµ–é¡¹
*   æœ€åŽè¿è¡Œ`firebase deploy --only functions`åªéƒ¨ç½²æˆ‘ä»¬çš„åŠŸèƒ½ï¼Œå› ä¸ºæˆ‘ä»¬çš„ webapp é¦–å…ˆéœ€è¦æž„å»ºï¼Œç„¶åŽæ‰èƒ½éƒ¨ç½²ã€‚

ä½¿ç”¨å·²éƒ¨ç½²çš„åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥å­˜å‚¨æˆ‘ä»¬æŽ¥æ”¶åˆ°çš„ç”±è®¾å¤‡å‘é€çš„ä½ç½®æ•°æ®ï¼Œå¹¶æ‰§è¡Œæˆ‘ä»¬å…³äºŽå¦‚ä½•å­˜å‚¨å®ƒçš„è‡ªå®šä¹‰è§„åˆ™ã€‚æ‚¨å¯ä»¥åœ¨ Firebase æŽ§åˆ¶å°ä¸ŠæŸ¥çœ‹å’Œç›‘æŽ§æ‰€æœ‰éƒ¨ç½²çš„èµ„æºã€‚

![](img/c86ccfeb25504e7f3051bd3a324dbd5b.png)

æ‚¨å¯ä»¥çœ‹åˆ°åœ¨ Firebase ä¸Šè¿è¡Œçš„å‡½æ•°çš„æ‰§è¡Œå’Œæ—¥å¿—ã€‚

çŽ°åœ¨æ˜¯æ—¶å€™éƒ¨ç½²æˆ‘ä»¬çš„ WebApp äº†ã€‚

## ç”¨ React åˆ¶ä½œçš„ WebApp é¡¹ç›®

å¯¹äºŽé¡¹ç›®çš„è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä¸ä¼šè¿›å…¥å¤ªå¤šçš„ç»†èŠ‚ï¼Œå› ä¸ºè¿™ä¸æ˜¯è¿™ç¯‡æ–‡ç« çš„ä¸»é¢˜ï¼Œä½†æˆ‘ä¼šå¼ºè°ƒä¸€äº›è®¿é—®äº‘ Firestore çš„æ–¹æ³•ã€‚

![](img/6bd16edbf0a35e50a4d10d6213547f72.png)

æˆ‘ä»¬å‡ºè‰²çš„ç½‘ç»œåº”ç”¨ç¨‹åºæ¥è·Ÿè¸ªæˆ‘ä»¬çš„èµ„äº§ã€‚

ä»¥ä¸‹æ˜¯ WebApp çš„ä¸€äº›æœ€é‡è¦çš„åŠŸèƒ½ï¼Œå®ƒè®¿é—® Firestore ä¸Šçš„æ•°æ®ï¼Œå¹¶è°ƒç”¨æˆ‘ä»¬çš„ç«¯ç‚¹æ¥æ›´æ–°è®¾å¤‡é…ç½®:

![](img/a71e7ffc7f7fa0bdde0f204749dfbc2a.png)

æ›´æ–°è®¾å¤‡é…ç½®ã€‚

å¯¹äºŽè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªåä¸º create-react-app çš„éžå¸¸æ£’çš„å·¥å…·ï¼Œå®ƒé…ç½®äº†ä¸€ä¸ªéžå¸¸å¥½çš„é¡¹ç›®ç»“æž„å’Œå·¥å…·æ¥ä½¿ç”¨çŽ°ä»£ Javascriptï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨ reactã€‚ä¸çŸ¥é“çš„ï¼ŒæŽ¨èåŽ»ä»–ä»¬çš„[å®˜æ–¹åšå®¢](https://reactjs.org/blog/2016/07/22/create-apps-with-no-configuration.html)çœ‹çœ‹ã€‚

[](https://reactjs.org/blog/2016/07/22/create-apps-with-no-configuration.html) [## æ— éœ€é…ç½®å³å¯åˆ›å»ºåº”ç”¨- React åšå®¢

### Create React App æ˜¯å®˜æ–¹æ”¯æŒçš„åˆ›å»ºå•é¡µ React åº”ç”¨ç¨‹åºçš„æ–°æ–¹æ³•ã€‚å®ƒæä¾›äº†ä¸€ä¸ªçŽ°ä»£å»ºç­‘â€¦

reactjs.org](https://reactjs.org/blog/2016/07/22/create-apps-with-no-configuration.html) 

åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®‰è£…äº† NPMï¼Œæ‰€ä»¥çŽ°åœ¨æˆ‘ä»¬åªéœ€å®‰è£…æ‰€æœ‰é¡¹ç›®ä¾èµ–é¡¹å¹¶å°†å…¶æž„å»ºåˆ°ç”Ÿäº§çŽ¯å¢ƒä¸­ã€‚ä¸‹é¢æ˜¯ä¸€äº›ç”¨`create-react-app`é…ç½®çš„å‘½ä»¤:

*   åœ¨é¡¹ç›®ä¸»æ–‡ä»¶å¤¹ä¸Šè¿è¡Œ`npm install`ï¼Œæ‰€æœ‰çš„ä¾èµ–é¡¹éƒ½å°†è¢«å®‰è£…ã€‚
*   è¦è¿è¡Œæœ¬åœ°æœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥è¿è¡Œ`npm start`å‘½ä»¤ã€‚è¿™å°†å¯åŠ¨ä¸€ä¸ªå®žæ—¶é‡æ–°åŠ è½½æœåŠ¡å™¨ï¼Œå¹¶åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­æ˜¾ç¤ºä¸€äº› lint é”™è¯¯ã€‚çœŸç‰›é€¼ã€‚
*   è¦æž„å»ºæˆ‘ä»¬çš„é¡¹ç›®ï¼Œæ‚¨å¯ä»¥è¿è¡Œ`npm run build`å‘½ä»¤ã€‚è¿™å°†ä¸ºç”Ÿäº§å‡†å¤‡æˆ‘ä»¬çš„ä»£ç å’Œèµ„äº§ï¼Œå¹¶å°†å®ƒä»¬å…¨éƒ¨æ”¾åœ¨`build`æ–‡ä»¶å¤¹ä¸­ã€‚

åœ¨æž„å»ºäº†æˆ‘ä»¬çš„é¡¹ç›®ä¹‹åŽï¼Œæˆ‘ä»¬çŽ°åœ¨å¯ä»¥è¿è¡Œ`firebase deploy`å¹¶åœ¨ Firebase åŸºç¡€è®¾æ–½ä¸Šéƒ¨ç½²æˆ‘ä»¬çš„æ‰€æœ‰é¡¹ç›®ã€‚

![](img/44797083fb7594c7537799989bc7ddd4.png)

å…¨éƒ¨éƒ¨ç½²å®Œæ¯•å¹¶å¼€å§‹è¿è¡Œã€‚

å¦‚æžœä¸€åˆ‡éƒ½è®¾ç½®æ­£ç¡®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æœ‰äº†å¦ä¸€ä¸ªç«¯åˆ°ç«¯çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒæ˜¯ä½¿ç”¨è®¸å¤šä»¤äººæ•¬ç•çš„å·¥å…·ç”šè‡³æ›´å¥½çš„å·¥å…·åˆ›å»ºçš„:ä¸éœ€è¦æŽ¥è§¦ä¸€ä¸ªé«˜çº§çš„ã€ä»¤äººåŽŒçƒ¦çš„æœåŠ¡å™¨è®¾ç½®ã€‚

## è¿›ä¸€æ­¥é˜…è¯»

è¿™å°±æ˜¯è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªéžå¸¸é…·çš„èµ„äº§è·Ÿè¸ªå™¨åŽŸåž‹ï¼Œå®ƒä½¿ç”¨äº†è°·æ­Œäº‘å’Œä¸€äº›ç‰©è”ç½‘å·¥å…·çš„è®¸å¤šæ–°åŠŸèƒ½ã€‚å¸Œæœ›ä½ ä»¬å–œæ¬¢è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘å°†ç»§ç»­ä½¿ç”¨è¿™äº›å·¥å…·æŽ¢ç´¢æ›´å¤šçš„é¡¹ç›®ã€‚

è¿™ä¸ªé¡¹ç›®çš„ä»£ç å¯ä»¥åœ¨æˆ‘çš„ Github ä¸Šæ‰¾åˆ°ï¼Œä¸€äº›æœ‰è¶£çš„é“¾æŽ¥åœ¨ä¸‹é¢çš„éƒ¨åˆ†ï¼Œç¨åŽé˜…è¯»:

[](https://github.com/alvarowolfx/asset-tracker-gcp-mongoose-os) [## alvarowolfx/èµ„äº§è·Ÿè¸ªç³»ç»Ÿ-GCP-mongose-OS

### èµ„äº§è¿½è¸ª-GCP-mongose-OS-ðŸš§ä½¿ç”¨è¿è¡Œ MongooseOS + GPS å’Œ GPRS æ¨¡å—çš„ ESP32 åˆ¶ä½œçš„èµ„äº§è¿½è¸ªå™¨â€¦

github.com](https://github.com/alvarowolfx/asset-tracker-gcp-mongoose-os) 

*   [https://github.com/mongoose-os-libs/pppos](https://github.com/mongoose-os-libs/pppos)
*   [https://Cloud platform . Google blog . com/2017/09/announcing-Cloud-IoT-Core-public-beta . html](https://cloudplatform.googleblog.com/2017/09/announcing-Cloud-IoT-Core-public-beta.html)
*   [http://mongoose-os.com/gcp](http://mongoose-os.com/gcp)
*   [https://cloud.google.com/iot/docs/quickstart](https://cloud.google.com/iot/docs/quickstart)
*   [https://mongose-OS . com/docs/libraries/cloud _ integrations/GCP . html](https://mongoose-os.com/docs/libraries/cloud_integrations/gcp.html)
*   [https://github . com/alvarowolfx/asset-tracker-GCP-mongose-OS](http://github.com/alvarowolfx/asset-tracker-gcp-mongoose-os)

> ä½ å–œæ¬¢è¿™ä¸ªå¸–å­å—ï¼Ÿæ‰€ä»¥ä¸è¦å¿˜äº†è®©ä½ çš„æ‹æ‰‹ç»§ç»­ðŸ‘ä¸‹é¢ï¼ŒæŽ¨èä¸€ä¸‹ï¼Œåˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚
> 
> ä½ ç”¨è¿™ä¸ªæ•™ç¨‹åšäº†ä»€ä¹ˆå¥½äº‹å—ï¼Ÿæ˜¾ç¤ºåœ¨ä¸‹é¢çš„è¯„è®ºéƒ¨åˆ†ã€‚
> 
> å¦‚æžœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·åœ¨è¯„è®ºä¸­ç•™è¨€ï¼Œæˆ‘ä¼šå°½åŠ›å¸®åŠ©ä½ ã€‚