<html>
<head>
<title>BigQuery best practice IoT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">BigQuery最佳实践物联网</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/bigquery-best-practice-for-iot-7cafc243df7f?source=collection_archive---------1-----------------------#2019-04-01">https://medium.com/google-cloud/bigquery-best-practice-for-iot-7cafc243df7f?source=collection_archive---------1-----------------------#2019-04-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="1f42" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">谷歌云物联网数据科学最佳实践。</h2></div><p id="77ed" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是将“数据科学就绪数据”导入Google BigQuery的一些要点。</p><p id="686d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">这主要适用于预测性维护等工业应用，但在这里也有一些有趣的家用例子。</em></p><h1 id="76be" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">工程要求:</h1><ol class=""><li id="7418" class="km kn hi iz b ja ko jd kp jg kq jk kr jo ks js kt ku kv kw bi translated">每个传感器都有自己的微秒时间戳(UNIX)。</li><li id="312f" class="km kn hi iz b ja kx jd ky jg kz jk la jo lb js kt ku kv kw bi translated">该设备(拥有多个传感器)也有自己的时间戳。</li><li id="fccd" class="km kn hi iz b ja kx jd ky jg kz jk la jo lb js kt ku kv kw bi translated">当设备数据包到达时，服务器会对其进行标记。</li><li id="c7eb" class="km kn hi iz b ja kx jd ky jg kz jk la jo lb js kt ku kv kw bi translated">上述所有3项的原子钟参考(设备在启动时获取)</li></ol><h2 id="0143" class="lc jv hi bd jw ld le lf ka lg lh li ke jg lj lk kg jk ll lm ki jo ln lo kk lp bi translated">让数据科学家抓狂的BigQuery错误:</h2><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es lq"><img src="../Images/4b5570ccd7ad0ec8339f7bf9ac68f4f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*djxKQFbvpTTeMitIXLjoAA.png"/></div></div><figcaption class="mc md et er es me mf bd b be z dx translated">BigQuery条目错误</figcaption></figure><p id="64b2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">设备时间增加正常</p><p id="5251" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">服务器时间跟在OK后面</p><p id="dc3f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">灯光值变化很快(蓝色圆圈)正常</p><p id="4ea5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是传感器ts(红色圆圈)保持不变</p><h1 id="384c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">问题</h1><p id="2d69" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg mg ji jj jk mh jm jn jo mi jq jr js hb bi translated">实时处理跨越11个传感器的并发微秒时间戳(同步到原子钟)在Linux中是<a class="ae mj" href="https://www.theregister.co.uk/2019/04/17/kernel_bypassing_by_quobye_tensorflow_plugin_for_faster_machine_learning_file_access/" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj"> <em class="jt">无望的</em> </strong> </a>但在RTOS (C /汇编语言)中可以做到。我们使用了商用直升机的一个版本，在该版本中，同步输入至关重要，该版本在ARM M4上运行，带有FPU和Crypto:</p><figure class="lr ls lt lu fd lv er es paragraph-image"><div class="er es mk"><img src="../Images/b28c30da8411e68b14092d91a75b7d2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*AO5KwchXS_0IBvsq3TGRIg.jpeg"/></div><figcaption class="mc md et er es me mf bd b be z dx translated">实时部分独立于IP Linux部分</figcaption></figure><h2 id="fcc7" class="lc jv hi bd jw ld le lf ka lg lh li ke jg lj lk kg jk ll lm ki jo ln lo kk lp bi translated"><strong class="ak"> <em class="ml">这个为什么重要？</em>T13】</strong></h2><p id="709a" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg mg ji jj jk mh jm jn jo mi jq jr js hb bi translated">如果我们不在物联网资源层面<em class="jt">做出努力</em>与云紧密合作，那么进入谷歌PubSub = &gt;谷歌数据流的数据将是垃圾。</p><p id="a6ab" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">每个传感器事件的时间戳需要精确，并且彼此同步，否则数据科学家会非常沮丧。</p><p id="0ba6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">想象一下，你正在驾驶一辆汽车，却在关注10秒钟前的交通动态。你会开车吗？以毫秒计的实时数据和接近实时的分析对于任何被称为“重要”或“紧急”的事情都是至关重要的。</em></p><p id="7ada" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">股票价格、航空、军事情报、能源供应网、医院——但是将来会在网上出现的任何资产呢？</p><p id="374d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">考虑这个价值链中的第一个客户是<strong class="iz hj">数据科学家。</strong>只有他们能告诉产品负责人这些数据可能会带来什么。</p><h1 id="6285" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">使用谷歌数据实验室的例子</h1><figure class="lr ls lt lu fd lv er es paragraph-image"><div class="er es mm"><img src="../Images/fd498516a421db3b83c3e90ebf627b35.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*QiCHfdDexuKDzvMUmj3VZA.jpeg"/></div></figure><p id="85fc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">蓝色显示的噪声分贝水平<em class="jt">(数字整流音频——只有振幅，没有频率；所以没有讲话)</em>与穿红色衣服的人的热成像很好地相关联。我们可以推断这个人还活着，并且在那个地方做着类似烹饪的事情，而不需要拍摄他们或者偷听他们的声音。</p><figure class="lr ls lt lu fd lv er es paragraph-image"><div class="er es mn"><img src="../Images/47d1fc577ec6bae6bd4fc1d3ffbb2311.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*aw7Vff0RbXOd9NVMVRAwRw.jpeg"/></div></figure><p id="a237" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">房间中现在有两个传感器，传感器流不能很好地关联</p><p id="a3b5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">两个数据集中都有大约200万个JSON读数，并有精确的时间戳。 <a class="ae mj" rel="noopener" href="/google-cloud/how-much-does-iot-on-google-cloud-cost-at-scale-58d7227b1bba"> <em class="jt">谷歌云物联网系统的成本约为每板每年4欧元。</em> </a></p><h1 id="c6ec" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">在浴室呆了多久？</h1><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mo"><img src="../Images/603adffe615384657dd1eb04fe76b05d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LdujXHDEQ228SzaM3-5OXg.png"/></div></div><figcaption class="mc md et er es me mf bd b be z dx translated">一个人在浴室呆了多长时间可以通过精确叠加带有时间戳的热传感器数据点来确定——人的体温留下的印象越强烈，时间越长——类似于长时间曝光的望远镜观察遥远的星星</figcaption></figure><h1 id="ff1c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">厕所里发生了什么？</h1><p id="5287" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg mg ji jj jk mh jm jn jo mi jq jr js hb bi translated">在一个小房间里，CO2随着呼吸开始增加，然后大量排放有机气体，然后抽风机将所有气体去除到一个低得多的水平——所有这些都在7分钟内完成。</p><p id="5438" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个序列然后创建了一个机器学习标签“某人今天成功地去了厕所”——这个<em class="jt">(原谅背景中的瘪四和屁股头窃笑)</em>实际上是医生和老年患者之间的四大问题之一。机器学习功能可以保护个人隐私。</p><div class="lr ls lt lu fd ab cb"><figure class="mp lv mq mr ms mt mu paragraph-image"><img src="../Images/1c8d502fb245efa248ef2fbdd849454e.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*apRIdaUohEQDCKMq0NRCVQ.jpeg"/></figure><figure class="mp lv mv mr ms mt mu paragraph-image"><img src="../Images/de4e345aaa1df929d692445bbb6b6fc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*myyeuNF_hkJHAMbSRWnXvA.png"/><figcaption class="mc md et er es me mf bd b be z dx mw di mx my translated">机器学习马桶的动作(超过7分钟的气体组合结合人坐着的热成像(插值算法)。</figcaption></figure></div><figure class="lr ls lt lu fd lv er es paragraph-image"><div class="er es mz"><img src="../Images/07ca56536a13629503bcb7cdabc49049.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*LWp516N6sbGfFxkBk0uQ2g.jpeg"/></div></figure><p id="20ac" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在同一个厕所位置的振动“峰值”与进入房间(灯打开和关闭)相关联，这使ML标签变硬。如果没有时间戳，它将只是一堆信息。  <em class="jt"> </em>相反我们对一个复杂的人类动作的实时性有95%的把握。这对于人工智能来说是足够清楚的“理解”。</p><p id="976b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于睡觉、吃饭、客厅活动也可以这样做，随着时间的推移，这些活动会产生股价，就像一个人的生活图表一样(有大量有用的<a class="ae mj" href="https://towardsdatascience.com/predicting-stock-prices-with-echo-state-networks-f910809d23d4" rel="noopener" target="_blank">金融分析软件</a>可以重新用于准确的医疗保健趋势)。</p><p id="a2a1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">两天后我会有什么感觉？</p><p id="c4bc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">想象一下，问一个问题“我妈妈怎么样？”看到她很好，实时地，对未来有预测性的医学洞察力。</p><p id="dec6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">她什么都没穿，没有摄像机和麦克风。这种洞察力对关心的亲属有多大价值？或者可能是一个服务试图同时管理一个城市的几十万个病人<strong class="iz hj"/>？</p><p id="1054" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以低成本获得实时数据是一回事。</p><p id="e03f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">另一个问题是对(数据)进行足够快的分析处理<strong class="iz hj">，同时还要实时处理</strong>，在不到100毫秒的延迟内产生大规模结果。</p><p id="8755" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是在生产中<a class="ae mj" rel="noopener" href="/@nickord/eon-blockchain-patent-ep3512228-6b403ad0b1dd">的样子</a>。</p><h1 id="6683" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">工厂环境:</h1><p id="8d6e" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg mg ji jj jk mh jm jn jo mi jq jr js hb bi translated">一周中每天的温度、压力、湿度和有机气体。有机气体<em class="jt"> </em>中的强异常值表示排放/清洁事件。</p><p id="7d64" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">为了证明安全性和环境合规性，BigQuery消息可以在源位置使用</em> <a class="ae mj" rel="noopener" href="/google-cloud/how-much-does-iot-on-google-cloud-cost-at-scale-58d7227b1bba"> <em class="jt">板载加密</em> </a> <em class="jt">轻松进行身份验证和哈希处理。</em></p><div class="lr ls lt lu fd ab cb"><figure class="mp lv na mr ms mt mu paragraph-image"><img src="../Images/f2758026b0d70070472fa44f45697305.png" data-original-src="https://miro.medium.com/v2/resize:fit:436/format:webp/1*h0mUE7zBH2ZZpBIs2YSszw.jpeg"/></figure><figure class="mp lv nb mr ms mt mu paragraph-image"><img src="../Images/4d941dc2c49053bfb3ef2ad7357eb639.png" data-original-src="https://miro.medium.com/v2/resize:fit:404/format:webp/1*3HWOyffwdyDDJR8SGiBAyw.jpeg"/><figcaption class="mc md et er es me mf bd b be z dx nc di nd my translated">由于天气变化，温度与压力之间的关系更易变</figcaption></figure></div><div class="ab cb"><figure class="mp lv ne mr ms mt mu paragraph-image"><img src="../Images/f6a4c515a6383d6704feba5be3fcc15a.png" data-original-src="https://miro.medium.com/v2/resize:fit:434/format:webp/1*1ScMikPdKza2suIgWk0jBw.jpeg"/></figure><figure class="mp lv nf mr ms mt mu paragraph-image"><img src="../Images/0425ccdfd3e6c054f0ea538956ce2dcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:422/format:webp/1*vYWhf1hjnC1owIrGBojt1w.jpeg"/><figcaption class="mc md et er es me mf bd b be z dx ng di nh my translated">湿度与有机气体(有来自机器清洗液的异常峰值)</figcaption></figure></div><h1 id="3a17" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">大型办公室:</h1><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es ni"><img src="../Images/5d51035f04d0c49bdfe093a3629afdb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xgni7kkIG4t0oOg8nqVNTA.jpeg"/></div></div><figcaption class="mc md et er es me mf bd b be z dx translated">在办公室工作超过12小时。在1750 ppm时，大脑功能显著下降。一些办公室每隔100米就有4组传感器，我们发现即使在窗户打开后，一氧化碳云也往往沉重地悬挂在角落里。要让氧气回到400ppm的一氧化碳基准水平，就要在角落里循环空气。</figcaption></figure><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es nj"><img src="../Images/e5ed740d3ae89b95e1459e84044d83a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8sNij_o9o9Mp-cQn0gCz_Q.jpeg"/></div></div><figcaption class="mc md et er es me mf bd b be z dx translated">同一个办公室，光线从一扇关着的窗户射进来。日出在中午达到顶峰，直到它绕过墙壁。关闭的窗户解释了二氧化碳的增加。椅子等物体移动(加速度计Z轴)。人们在13:00后参加封闭的办公室会议，表明分贝的降低与振动的减少相关。</figcaption></figure><p id="133e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有关所用GCP物联网架构的信息，请查看谷歌云上的<a class="ae mj" rel="noopener" href="/google-cloud/how-much-does-iot-on-google-cloud-cost-at-scale-58d7227b1bba">物联网规模</a></p><p id="8f12" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">这项工作导致了一批 </strong> <a class="ae mj" rel="noopener" href="/@nickord/eon-blockchain-patent-ep3512228-6b403ad0b1dd"> <strong class="iz hj"> <em class="jt">专利申请</em> </strong> </a></p><h1 id="8bf8" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">关键:</h1><blockquote class="nk nl nm"><p id="4d84" class="ix iy jt iz b ja jb ij jc jd je im jf nn jh ji jj no jl jm jn np jp jq jr js hb bi translated"><em class="hi"> 93E3 BEBC C164 D766 </em></p><p id="27e1" class="ix iy jt iz b ja jb ij jc jd je im jf nn jh ji jj no jl jm jn np jp jq jr js hb bi translated"><em class="hi">公开可审计身份</em> <a class="ae mj" href="https://gist.github.com/NickOrd/ceded6c6c1ada6802f43f5e184341252" rel="noopener ugc nofollow" target="_blank"> <em class="hi">此处</em> </a></p></blockquote></div></div>    
</body>
</html>