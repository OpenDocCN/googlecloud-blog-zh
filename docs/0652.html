<html>
<head>
<title>Multi-Tenant Google Cloud Platform B2B SaaS Applications How-to</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多租户谷歌云平台B2B SaaS应用指南</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/multi-tenant-google-cloud-platform-saas-applications-how-to-fbd16c8a9766?source=collection_archive---------2-----------------------#2018-06-18">https://medium.com/google-cloud/multi-tenant-google-cloud-platform-saas-applications-how-to-fbd16c8a9766?source=collection_archive---------2-----------------------#2018-06-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="3586" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">认证和授权</h2></div><h1 id="30ed" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">概观</h1><p id="536a" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">本文解决了在<a class="ae kl" href="https://medium.com/p/f40cd9ae72a0/edit" rel="noopener">概念文章</a>中描述的认证和授权挑战。</p><p id="e929" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">身份验证和授权本质上都与身份紧密相关。</p><p id="41a2" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">谷歌云平台中有许多身份机制，所有这些机制都可以<a class="ae kl" href="https://cloud.google.com/iam/docs/overview#concepts_related_identity" rel="noopener ugc nofollow" target="_blank">作为授权策略的委托人</a>:</p><ul class=""><li id="7a9e" class="kr ks hi jr b js km jv kn jy kt kc ku kg kv kk kw kx ky kz bi translated">云身份代表用户身份，也可用于身份验证。</li><li id="e271" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated">Google Groups代表用户身份的分组。谷歌群组有几种类型；我们将关注<a class="ae kl" href="https://support.google.com/a/answer/33329" rel="noopener ugc nofollow" target="_blank">管理控制台组</a>。</li><li id="7a2b" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated"><a class="ae kl" href="https://cloud.google.com/iam/docs/understanding-service-accounts" rel="noopener ugc nofollow" target="_blank">服务账户</a>主要用于代表应用程序，通常通过基于OAuth的认证。</li><li id="22ab" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated">谷歌域名；我们将在<a class="ae kl" href="https://medium.com/p/3fc48162ef39/edit" rel="noopener"> How to: Isolation </a>一文中更深入地讨论这些问题。</li><li id="27fb" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated"><a class="ae kl" href="https://cloud.google.com/storage/docs/access-control/signed-urls" rel="noopener ugc nofollow" target="_blank">签名URL</a>是授权Google云存储上传和下载的有时间限制的令牌。</li></ul></div><div class="ab cl lf lg gp lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hb hc hd he hf"><h1 id="40db" class="ix iy hi bd iz ja lm jc jd je ln jg jh io lo ip jj ir lp is jl iu lq iv jn jo bi translated"><strong class="ak">认证</strong></h1><h2 id="9e7a" class="lr iy hi bd iz ls lt lu jd lv lw lx jh jy ly lz jj kc ma mb jl kg mc md jn me bi translated">云身份</h2><p id="c951" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">如前所述，云身份是主要的用户认证机制。身份可以通过SAML和OpenID Connect 进行联合<a class="ae kl" href="https://cloud.google.com/identity/solutions/enable-sso" rel="noopener ugc nofollow" target="_blank">；这意味着您的客户可以直接与谷歌云平台联合他们的用户，或者如果他们已经与您建立了联合关系，您可以代表他们联合您客户的用户，例如通过</a><a class="ae kl" href="https://msdn.microsoft.com/en-us/library/bb897402.aspx" rel="noopener ugc nofollow" target="_blank"> AD FS </a>。</p><p id="b0f6" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">Google Cloud SAML服务提供商支持单个SAML IDP，因此要支持多个客户租户，您需要采取以下方法之一:</p><ul class=""><li id="90ab" class="kr ks hi jr b js km jv kn jy kt kc ku kg kv kk kw kx ky kz bi translated">使用SAML代理，如<a class="ae kl" href="https://docs.apigee.com/api-platform/system-administration/enabling-saml-authentication-edge" rel="noopener ugc nofollow" target="_blank"> Apigee </a>或<a class="ae kl" href="https://auth0.com/docs/protocols/saml/saml-configuration" rel="noopener ugc nofollow" target="_blank"> Auth0 </a>。</li><li id="2db1" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated">如果您要为客户提供最终用户管理功能，请为每个客户分配一个域或子域(请参阅隔离文章了解更多相关信息)。</li></ul><p id="93a8" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">注意，谷歌云联盟不支持动态SAML(即。认证时身份的创建)；必须使用以下受支持的机制之一提前调配用户的云身份:</p><ul class=""><li id="8625" class="kr ks hi jr b js km jv kn jy kt kc ku kg kv kk kw kx ky kz bi translated">身份管理解决方案，如<a class="ae kl" href="https://docs.oracle.com/cd/E22999_01/doc.111/e18798.pdf" rel="noopener ugc nofollow" target="_blank"> Oracle Identity Manager </a>、<a class="ae kl" href="https://docs.pingidentity.com/bundle/googleAppsConn31_sm_quickConnect/page/googleAppsConn_c_pingFederateGoogleAppsConnector.html" rel="noopener ugc nofollow" target="_blank">ping federal</a>或<a class="ae kl" href="https://saml-doc.okta.com/Provisioning_Docs/G_Suite_Provisioning.html" rel="noopener ugc nofollow" target="_blank"> Okta </a>(忽略遗留的Google Apps和G Suite品牌；这些也适用于云身份)。</li><li id="5824" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated"><a class="ae kl" href="https://support.google.com/a/answer/106368" rel="noopener ugc nofollow" target="_blank">谷歌云目录同步</a> (GCDS)。</li><li id="d792" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated"><a class="ae kl" href="https://developers.google.com/admin-sdk/directory/" rel="noopener ugc nofollow" target="_blank"> Admin SDK目录API </a>(忽略遗留G Suite品牌；这也适用于云身份)。</li><li id="b1de" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated"><a class="ae kl" href="https://support.google.com/a/answer/40057?hl=en" rel="noopener ugc nofollow" target="_blank">电子表格上传</a>(忽略传统G套件品牌；这也适用于云身份)。对于试用你的服务的客户来说，这是一个很好的匹配。</li></ul><p id="f615" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">在某些情况下，您可能希望为客户的用户提供自助式用户资源调配门户。以下Python代码片段演示了如何针对此用例利用<a class="ae kl" href="https://developers.google.com/admin-sdk/directory/" rel="noopener ugc nofollow" target="_blank">管理SDK目录API </a>:</p><pre class="mf mg mh mi fd mj mk ml mm aw mn bi"><span id="3957" class="lr iy hi mk b fi mo mp l mq mr"># List users on the domain</span><span id="3b2e" class="lr iy hi mk b fi ms mp l mq mr">from googleapiclient import discovery<br/>from google.oauth2 import service_account</span><span id="1715" class="lr iy hi mk b fi ms mp l mq mr">SCOPES = ("<a class="ae kl" href="https://www.googleapis.com/auth/admin.directory.group" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/admin.directory.group</a>","<a class="ae kl" href="https://www.googleapis.com/auth/admin.directory.user" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/admin.directory.user</a>")<br/>SUBJECT = '[SERVICE_USER@DOMAIN]'</span><span id="d01c" class="lr iy hi mk b fi ms mp l mq mr">target_key_file = '[YOUR_KEY_FILE.JSON]'<br/>credentials = service_account.Credentials.from_service_account_file(target_key_file)<br/>scoped_credentials = credentials.with_scopes(SCOPES)<br/>delegated_credentials = scoped_credentials.with_subject(SUBJECT)</span><span id="78db" class="lr iy hi mk b fi ms mp l mq mr">admin_client = discovery.build('admin', 'directory_v1', credentials=delegated_credentials)<br/>req = admin_client.users().list(domain='[CUSTOMER_DOMAIN]')<br/>resp = req.execute()<br/>users = resp['users']</span><span id="4bd8" class="lr iy hi mk b fi ms mp l mq mr">print users</span></pre><p id="2560" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">有关更全面的实现，请参见<a class="ae kl" href="https://github.com/demoforwork/public/tree/master/SelfServiceProvisioning" rel="noopener ugc nofollow" target="_blank">这个示例应用</a>。</p><h2 id="6e5e" class="lr iy hi bd iz ls lt lu jd lv lw lx jh jy ly lz jj kc ma mb jl kg mc md jn me bi translated">Google登录</h2><p id="1d4f" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">对于那些不适合使用基于单点登录的解决方案的客户来说，<a class="ae kl" href="https://developers.google.com/identity/sign-in/web/sign-in" rel="noopener ugc nofollow" target="_blank"> Google Sign-In </a>提供了一种简单的方式来为您的SaaS应用程序利用Google的认证基础设施。它提供了以下<a class="ae kl" href="https://support.google.com/a/answer/139399?hl=en" rel="noopener ugc nofollow" target="_blank">密码控制</a>:</p><ul class=""><li id="ac9a" class="kr ks hi jr b js km jv kn jy kt kc ku kg kv kk kw kx ky kz bi translated">长度和强度加强</li><li id="dfb5" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated">轮换执行</li><li id="9a1e" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated">重复使用预防</li></ul><p id="e0e0" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">它还通过<a class="ae kl" href="https://support.google.com/a/answer/2548882?hl=en" rel="noopener ugc nofollow" target="_blank"> 2FA实施</a>和基于API的<a class="ae kl" href="https://developers.google.com/admin-sdk/directory/v1/reference/users/update" rel="noopener ugc nofollow" target="_blank">密码重置</a>提供强大的网络钓鱼保护(下面是示例Python片段)</p><pre class="mf mg mh mi fd mj mk ml mm aw mn bi"><span id="1489" class="lr iy hi mk b fi mo mp l mq mr"># Reset password</span><span id="4513" class="lr iy hi mk b fi ms mp l mq mr">from googleapiclient import discovery<br/>from google.oauth2 import service_account</span><span id="8357" class="lr iy hi mk b fi ms mp l mq mr">domain = '[YOUR_DOMAIN]'<br/>delegated_admin = '[YOUR_SERVICE_ADMIN]' # id only (ie. without <a class="ae kl" href="http://twitter.com/domain" rel="noopener ugc nofollow" target="_blank">@domain</a>)<br/>key_file = '[SERVICE_ACCOUNT_JSON_KEY_FILE]'<br/>user = ''.join(['YOUR_USER','@',domain])<br/>password = 'NEW_PASSWORD'</span><span id="70e3" class="lr iy hi mk b fi ms mp l mq mr">scope = ("<a class="ae kl" href="https://www.googleapis.com/auth/admin.directory.user" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/admin.directory.user</a>",)<br/>subject = ''.join([delegated_admin,'@',domain]);<br/>delegated_credentials = service_account.Credentials.from_service_account_file(key_file, scopes=scope, subject=subject)</span><span id="e3b0" class="lr iy hi mk b fi ms mp l mq mr">authorized_service = discovery.build('admin', 'directory_v1', credentials=delegated_credentials)<br/>req = authorized_service.users().update(userKey=user,body={"password":password, "changePasswordAtNextLogin":True})<br/>resp = req.execute()</span><span id="6ecc" class="lr iy hi mk b fi ms mp l mq mr">print resp</span></pre><h2 id="dac6" class="lr iy hi bd iz ls lt lu jd lv lw lx jh jy ly lz jj kc ma mb jl kg mc md jn me bi translated">服务帐户</h2><p id="7710" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><a class="ae kl" href="https://cloud.google.com/iam/docs/understanding-service-accounts" rel="noopener ugc nofollow" target="_blank">服务账户</a>主要用于表示应用程序；这为通过<a class="ae kl" href="https://oauth.net/2/" rel="noopener ugc nofollow" target="_blank"> OAuth </a>授权您的客户提供了一个自然的机制。</p><p id="dc66" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">典型的模式是您或您的客户发布一个服务帐户，另一方作为委托人授权。这有几个优点:</p><ul class=""><li id="64fb" class="kr ks hi jr b js km jv kn jy kt kc ku kg kv kk kw kx ky kz bi translated">如果您的客户发布服务帐户，他们可以完全负责管理对该帐户的访问，因此作为SaaS提供商，您不需要向您的客户提供最终用户管理或联合功能。</li><li id="be0b" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated">它支持对合资企业的授权，在合资企业中，数据访问a)受时间限制，b)受商业实体限制，而不是受用户限制。</li><li id="8129" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated">谷歌云平台日志和审计将反映服务账户，简化计费和收费。</li></ul><p id="8765" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">这种模式也有一些限制:</p><ul class=""><li id="ded3" class="kr ks hi jr b js km jv kn jy kt kc ku kg kv kk kw kx ky kz bi translated">它没有提供对终端用户进行身份验证的机制</li><li id="2ce7" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated">服务帐户必须按照所需的授权、计费和收费级别进行授权和管理，这可能会导致服务帐户激增以及随之而来的生命周期管理挑战。可以通过<a class="ae kl" href="https://cloud.google.com/iam/docs/service-accounts#the_service_account_token_creator_role" rel="noopener ugc nofollow" target="_blank">服务帐户令牌创建者角色</a>来缓解这种激增，该角色允许模拟服务帐户来创建OAuth2访问令牌并签署blobs或jwt。您可以利用这一功能使用户能够根据需要制造令牌，或者将客户服务帐户映射到您的应用程序服务帐户。</li></ul><p id="efb8" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">当然，服务帐户也是您自己的SaaS微服务应用程序的服务间通信的组成部分(参见<a class="ae kl" href="https://cloud.google.com/appengine/docs/standard/python/microservices-on-app-engine" rel="noopener ugc nofollow" target="_blank">本文</a>中的示例应用程序引擎实现)。</p></div><div class="ab cl lf lg gp lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hb hc hd he hf"><h1 id="750e" class="ix iy hi bd iz ja lm jc jd je ln jg jh io lo ip jj ir lp is jl iu lq iv jn jo bi translated"><strong class="ak">授权</strong></h1><p id="72cd" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">关键的授权挑战之一是将客户的用户策略映射到您的GCP应用程序用户策略。</p><p id="cb32" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">这里有几种方法:您选择哪一个将在很大程度上取决于用例。</p><ul class=""><li id="3be9" class="kr ks hi jr b js km jv kn jy kt kc ku kg kv kk kw kx ky kz bi translated">SAML声称:您的客户完全负责管理哪些用户被允许访问哪些服务和数据；您可以将这些映射到<a class="ae kl" href="https://support.google.com/a/answer/33329" rel="noopener ugc nofollow" target="_blank">管理控制台组</a>(见下文)或服务帐户，以利用Cloud IAM对这些的本机支持。</li><li id="82a1" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated"><a class="ae kl" href="https://support.google.com/a/answer/33329" rel="noopener ugc nofollow" target="_blank">管理控制台组</a>或服务帐户:您提供一个管理控制台，您的客户通过它来定义用户授权。</li></ul><h2 id="0f52" class="lr iy hi bd iz ls lt lu jd lv lw lx jh jy ly lz jj kc ma mb jl kg mc md jn me bi translated">SAML索赔</h2><p id="ae8a" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">谷歌云平台IAM不直接支持SAML声明，所以你需要在你的应用程序或SAML代理中解释声明，比如<a class="ae kl" href="https://docs.apigee.com/api-platform/system-administration/enabling-saml-authentication-edge" rel="noopener ugc nofollow" target="_blank"> Apigee </a>或<a class="ae kl" href="https://auth0.com/docs/protocols/saml/saml-configuration" rel="noopener ugc nofollow" target="_blank"> Auth0 </a>。</p><figure class="mf mg mh mi fd mu er es paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="er es mt"><img src="../Images/38d43dba9fbcdff56e91ea8509154612.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3_bHeA_abuu4wBlc7G6lIA.png"/></div></div><figcaption class="nb nc et er es nd ne bd b be z dx translated">Google帐户的第三方SAML授权流</figcaption></figure><p id="ae23" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">Apigee支持许多<a class="ae kl" href="https://docs.apigee.com/api-platform/reference/policies/reference-overview-policy" rel="noopener ugc nofollow" target="_blank">现成的安全策略</a>的策略注入，以及脚本定制策略(例如，在其SAML断言中具有customer=MySecureCustomer属性的用户可以使用？customer=MySecureCustomer参数)</p><p id="6c29" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated"><a class="ae kl" href="https://github.com/salrashid123/googlapps-sso" rel="noopener ugc nofollow" target="_blank">这个SAML IDP/服务提供者示例</a>提供解码的响应信息，是一个很好的测试平台。</p><h2 id="96fd" class="lr iy hi bd iz ls lt lu jd lv lw lx jh jy ly lz jj kc ma mb jl kg mc md jn me bi translated">管理控制台组</h2><p id="d9fc" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><a class="ae kl" href="https://support.google.com/a/answer/33329" rel="noopener ugc nofollow" target="_blank">管理控制台组</a>由云身份域管理员(而不是任意终端用户)管理，并且可以通过<a class="ae kl" href="https://developers.google.com/admin-sdk/directory/v1/guides/manage-groups" rel="noopener ugc nofollow" target="_blank"> API </a>进行调配和配置(忽略传统的G Suite品牌；这也适用于云身份)。</p><p id="0242" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">有两种方法可以利用组进行授权</p><ul class=""><li id="b59f" class="kr ks hi jr b js km jv kn jy kt kc ku kg kv kk kw kx ky kz bi translated">授予谷歌集团云平台IAM角色。</li><li id="4715" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated">您的应用程序可以利用<a class="ae kl" href="https://developers.google.com/admin-sdk/directory/v1/reference/groups" rel="noopener ugc nofollow" target="_blank"> Admin SDK Groups API </a>(忽略遗留的G Suite品牌；这也适用于云身份)来发现哪些用户是组的成员，成员属于哪些组，以及嵌套组层次结构中组的直接父组(将<a class="ae kl" href="https://developers.google.com/admin-sdk/directory/v1/reference/groups/list" rel="noopener ugc nofollow" target="_blank">用户键</a>设置为您希望找到其父组的用户或组)。</li></ul><p id="a49c" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">请注意，您的应用程序只能看到属于其域的管理控制台组，除非通过域范围的委托明确授予了额外的权限(有关这方面的更多信息，请参见隔离文章)；即。您的应用程序通常无法在主域中的用户所属的另一个域中找到父组。</p><h2 id="78fd" class="lr iy hi bd iz ls lt lu jd lv lw lx jh jy ly lz jj kc ma mb jl kg mc md jn me bi translated">用户模拟</h2><p id="12af" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">您可以将服务帐户与云身份结合起来，使服务帐户能够代表域中的用户，即。通过<a class="ae kl" href="https://developers.google.com/admin-sdk/directory/v1/guides/delegation" rel="noopener ugc nofollow" target="_blank">域范围的授权</a>来模拟用户(忽略遗留的G套件品牌；这也适用于云身份API)。这对于解决几个用例非常有帮助:</p><ul class=""><li id="f81a" class="kr ks hi jr b js km jv kn jy kt kc ku kg kv kk kw kx ky kz bi translated">您的应用程序创建的资产(如GCS对象)需要向客户的最终用户授予ACL。您可以通过IAM APIs手动管理它，但是用户模拟会自动处理它。</li><li id="5196" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated">您的应用程序需要根据客户的用户的身份向他们公开适当的资产。手动管理将需要您在应用程序中构建一个ACL层；用户模拟使它自动发生。</li></ul><p id="7d13" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">参见<a class="ae kl" rel="noopener" href="/@fargyle/impersonating-users-with-google-cloud-platform-service-accounts-ba762db09092">本文</a>以了解更多关于这种方法及其局限性的信息，以及代码示例。</p></div><div class="ab cl lf lg gp lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hb hc hd he hf"><h1 id="b2c3" class="ix iy hi bd iz ja lm jc jd je ln jg jh io lo ip jj ir lp is jl iu lq iv jn jo bi translated">下一步是什么</h1><p id="c8ad" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">在<a class="ae kl" href="https://developers.google.com/apis-explorer/#p/" rel="noopener ugc nofollow" target="_blank"> API浏览器</a>中试用API。</p><p id="efee" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">部署一个<a class="ae kl" href="https://github.com/demoforwork/public/tree/master/SelfServiceProvisioning" rel="noopener ugc nofollow" target="_blank">自助式用户配置门户</a>。</p><p id="3aa6" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">配置一个<a class="ae kl" href="https://github.com/salrashid123/googlapps-sso" rel="noopener ugc nofollow" target="_blank">SAML IDP/服务提供者示例</a>。</p><p id="3eb0" class="pw-post-body-paragraph jp jq hi jr b js km ij ju jv kn im jx jy ko ka kb kc kp ke kf kg kq ki kj kk hb bi translated">阅读以下指南，了解如何实施:</p><ul class=""><li id="d5d9" class="kr ks hi jr b js km jv kn jy kt kc ku kg kv kk kw kx ky kz bi translated"><a class="ae kl" rel="noopener" href="/@fargyle/multi-tenant-google-cloud-platform-saas-applications-how-to-3fc48162ef39">多租户B2B SaaS隔离</a>。</li><li id="a8bb" class="kr ks hi jr b js la jv lb jy lc kc ld kg le kk kw kx ky kz bi translated"><a class="ae kl" rel="noopener" href="/@fargyle/impersonating-users-with-google-cloud-platform-service-accounts-ba762db09092">用户冒充</a>。</li></ul></div><div class="ab cl lf lg gp lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hb hc hd he hf"><h1 id="dfb9" class="ix iy hi bd iz ja lm jc jd je ln jg jh io lo ip jj ir lp is jl iu lq iv jn jo bi translated">承认</h1><p id="c8f5" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">非常感谢Mike McDonald作为多租户身份验证的顾问和倡导者。</p></div></div>    
</body>
</html>