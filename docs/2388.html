<html>
<head>
<title>Automate Terraform documentation like a pro!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">像专家一样自动化Terraform文档！</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/automate-terraform-documentation-like-a-pro-ed3e19998808?source=collection_archive---------0-----------------------#2022-09-28">https://medium.com/google-cloud/automate-terraform-documentation-like-a-pro-ed3e19998808?source=collection_archive---------0-----------------------#2022-09-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bc03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">读者您好👋🏽</strong></p><p id="8469" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个博客是关于逃避编写和更新terraform文档的频繁更改！让我们通过将terraform文档自动化到我们的开发周期中来学习，这样代码和相关文档总是同步的！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/1dc01f33cbc9b5d977a7565413824236.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OOODDxDnfG-2yVBxMBgw8Q.png"/></div></div></figure><h1 id="8821" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">介绍</h1><p id="874a" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">在这篇博客中，我们将使用一个名为terraform-docs(<a class="ae ks" href="https://terraform-docs.io/" rel="noopener ugc nofollow" target="_blank">https://terraform-docs.io/</a>)的开源工具来自动化文档，并学习如何与CI pipeline或git预提交钩子集成。</p><p id="d988" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kt ku kv kw b">terraform-docs</code>是一个命令行工具，用于围绕terraform模块自动生成文档。该工具支持多种输出格式，包括markdown表和asciidoc表。</p><p id="e4bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">模块README.md的输出示例:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kx"><img src="../Images/5a0139194e34d0a41431e66df5a8f2fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EBd4eWbZ0yrC7uM8Vtvljw.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">markdown表格格式的README.md</figcaption></figure><h1 id="1e38" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">为什么需要？</h1><p id="126f" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">随着terraform模块的开发，重要的方面是这些模块在不同团队和terraform开发者之间的使用。因此，文档在理解模块的结构以及在不同用例中的不同使用方式方面起着重要的作用。</p><p id="8270" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于sprints中添加了新的特性，并且多人在处理不同的特性，更新文档变得很麻烦。如果某个工具可以为每一个新的代码变更准备至少核心部分的文档，那会怎么样？<code class="du kt ku kv kw b">terraform-docs</code>来了</p><h1 id="6488" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">从哪里开始？</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lc"><img src="../Images/c6f8e1bd224b4f63171f1d680aca92d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bv-EAcn42xqBMPw1jh6q0Q.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated"><a class="ae ks" href="https://github.com/terraform-docs/terraform-docs/" rel="noopener ugc nofollow" target="_blank">https://github.com/terraform-docs/terraform-docs/</a></figcaption></figure><ol class=""><li id="eee9" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated">安装<code class="du kt ku kv kw b">terraform-docs</code>或从<a class="ae ks" href="https://github.com/terraform-docs/terraform-docs/" rel="noopener ugc nofollow" target="_blank"><em class="lm">terraform-docs</em></a>github repo下载。</li></ol><pre class="je jf jg jh fd ln kw lo lp aw lq bi"><span id="ab37" class="lr jq hi kw b fi ls lt l lu lv"><em class="lm"># go1.17+</em><br/>go install github.com/terraform-docs/terraform-docs@v0.16.0</span></pre><p id="dc9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在此检查其他安装方法<a class="ae ks" href="https://terraform-docs.io/user-guide/installation/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="79b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.配置一个名为<code class="du kt ku kv kw b">.terraform-docs.yml</code>的默认配置文件，该文件可用于所有README.md生成。添加以下内容进行更好的定制:</p><pre class="je jf jg jh fd ln kw lo lp aw lq bi"><span id="51ed" class="lr jq hi kw b fi ls lt l lu lv">formatter: "markdown table" # this is required</span><span id="f8df" class="lr jq hi kw b fi lw lt l lu lv">version: "0.16"</span><span id="5821" class="lr jq hi kw b fi lw lt l lu lv">header-from: main.tf<br/>footer-from: ""</span><span id="0a94" class="lr jq hi kw b fi lw lt l lu lv">recursive:<br/>  enabled: false<br/>  path: ""</span><span id="6dce" class="lr jq hi kw b fi lw lt l lu lv">sections:<br/>  hide: []<br/>  show: []</span><span id="6836" class="lr jq hi kw b fi lw lt l lu lv">  hide-all: false # deprecated in v0.13.0, removed in v0.15.0<br/>  show-all: true  # deprecated in v0.13.0, removed in v0.15.0</span><span id="a88d" class="lr jq hi kw b fi lw lt l lu lv">content: |-<br/>  {{ .Requirements }}</span><span id="ba23" class="lr jq hi kw b fi lw lt l lu lv">  ## Usage<br/>  Basic usage of this module is as follows:</span><span id="dc73" class="lr jq hi kw b fi lw lt l lu lv">```hcl<br/>  module "example" {<br/>    {{"\t"}} source  = "&lt;module-path&gt;"</span><span id="f171" class="lr jq hi kw b fi lw lt l lu lv">{{- if .Module.RequiredInputs }}<br/>    {{"\n\t"}} # Required variables<br/>    {{- range .Module.RequiredInputs }}<br/>    {{"\t"}} {{ .Name }}  = {{ .GetValue }}<br/>    {{- end }}<br/>    {{- end }}</span><span id="5cdd" class="lr jq hi kw b fi lw lt l lu lv">{{- if .Module.OptionalInputs }}<br/>    {{"\n\t"}} # Optional variables<br/>    {{- range .Module.OptionalInputs }}<br/>    {{"\t"}} {{ .Name }}  = {{ .GetValue | printf "%s" }}<br/>    {{- end }}<br/>    {{- end }}<br/>  }<br/>  ```</span><span id="f5ba" class="lr jq hi kw b fi lw lt l lu lv">{{ .Resources }}</span><span id="800b" class="lr jq hi kw b fi lw lt l lu lv">{{ .Inputs }}</span><span id="47d3" class="lr jq hi kw b fi lw lt l lu lv">{{ .Outputs }}</span><span id="abaf" class="lr jq hi kw b fi lw lt l lu lv">output:<br/>  file: README.md<br/>  mode: inject<br/>  template: |-<br/>      &lt;!-- BEGIN_AUTOMATED_TF_DOCS_BLOCK --&gt;<br/>      {{ .Content }}<br/>      &lt;!-- END_AUTOMATED_TF_DOCS_BLOCK --&gt;</span><span id="381c" class="lr jq hi kw b fi lw lt l lu lv">output-values:<br/>  enabled: false<br/>  from: ""</span><span id="3453" class="lr jq hi kw b fi lw lt l lu lv">sort:<br/>  enabled: true<br/>  by: name</span><span id="6fc0" class="lr jq hi kw b fi lw lt l lu lv">settings:<br/>  anchor: true<br/>  color: true<br/>  default: true<br/>  description: true<br/>  escape: true<br/>  hide-empty: false<br/>  html: true<br/>  indent: 2<br/>  lockfile: true<br/>  read-comments: true<br/>  required: true<br/>  sensitive: true<br/>  type: true</span></pre><p id="11fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.在这一步中，我们将在TF代码库中设置/配置README.md:</p><ul class=""><li id="74a2" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc lx lj lk ll bi translated">在terraform模块中创建一个<code class="du kt ku kv kw b">README.md</code>，并提供一些关于模块的介绍性细节。请参考下面的README.md</li></ul><pre class="je jf jg jh fd ln kw lo lp aw lq bi"><span id="2025" class="lr jq hi kw b fi ls lt l lu lv"># TF code base</span><span id="1cb7" class="lr jq hi kw b fi lw lt l lu lv">## Introduction<br/>This is sample readme for terraform module</span></pre><ul class=""><li id="b021" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc lx lj lk ll bi translated">在您希望自动生成terraform模块不同部分的位置添加注释块。如果需要，我们可以保留一个不会被改变的页脚信息。</li></ul><pre class="je jf jg jh fd ln kw lo lp aw lq bi"><span id="ed95" class="lr jq hi kw b fi ls lt l lu lv"># TF code base</span><span id="8026" class="lr jq hi kw b fi lw lt l lu lv">## Introduction<br/>This is sample readme for terraform module</span><span id="12f6" class="lr jq hi kw b fi lw lt l lu lv">&lt;!-- BEGIN_AUTOMATED_TF_DOCS_BLOCK --&gt;<br/>&lt;!-- END_AUTOMATED_TF_DOCS_BLOCK --&gt;</span><span id="5786" class="lr jq hi kw b fi lw lt l lu lv">## Footer<br/>Contributor Names</span></pre><p id="aaa8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.现在我们已经准备好自动生成文档了！</p><pre class="je jf jg jh fd ln kw lo lp aw lq bi"><span id="eade" class="lr jq hi kw b fi ls lt l lu lv">terraform-docs -c .terraform-docs.yml ./tf-code/</span></pre><p id="28b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">执行后，观察给定tf代码目录中更新的README.md文件</p><p id="7783" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.最终的README.md看起来如何:</p><pre class="je jf jg jh fd ln kw lo lp aw lq bi"><span id="07db" class="lr jq hi kw b fi ls lt l lu lv"># TF code base</span><span id="08f5" class="lr jq hi kw b fi lw lt l lu lv">## Introduction<br/>This is sample readme for terraform module</span><span id="a440" class="lr jq hi kw b fi lw lt l lu lv">&lt;!-- BEGIN_AUTOMATED_TF_DOCS_BLOCK --&gt;<br/>## Requirements</span><span id="69ef" class="lr jq hi kw b fi lw lt l lu lv">| Name | Version |<br/>|------|---------|<br/>| &lt;a name="requirement_terraform"&gt;&lt;/a&gt; [terraform](#requirement\_terraform) | &gt;= 1.0.0 |</span><span id="0c99" class="lr jq hi kw b fi lw lt l lu lv">## Usage<br/>Basic usage of this module is as follows:</span><span id="5dd0" class="lr jq hi kw b fi lw lt l lu lv">```hcl<br/>module "example" {<br/>  source  = "&lt;module-path&gt;"</span><span id="d21f" class="lr jq hi kw b fi lw lt l lu lv"># Required variables<br/>  vsphere_password  = <br/>  vsphere_server  = <br/>  vsphere_user  = <br/>  vsphere_vm_config  = <br/>}<br/>```</span><span id="6708" class="lr jq hi kw b fi lw lt l lu lv">## Providers</span><span id="2b75" class="lr jq hi kw b fi lw lt l lu lv">No providers.</span><span id="f694" class="lr jq hi kw b fi lw lt l lu lv">## Resources</span><span id="dfcd" class="lr jq hi kw b fi lw lt l lu lv">No resources.</span><span id="2fc4" class="lr jq hi kw b fi lw lt l lu lv">## Inputs</span><span id="5043" class="lr jq hi kw b fi lw lt l lu lv">| Name | Description | Type | Default | Required |<br/>|------|-------------|------|---------|:--------:|<br/>| &lt;a name="input_vsphere_password"&gt;&lt;/a&gt; [vsphere\_password](#input\_vsphere\_password) | The password for the vCenter admin user | `string` | n/a | yes |<br/>| &lt;a name="input_vsphere_server"&gt;&lt;/a&gt; [vsphere\_server](#input\_vsphere\_server) | The FQDN of the vSphere vCenter server | `string` | n/a | yes |<br/>| &lt;a name="input_vsphere_user"&gt;&lt;/a&gt; [vsphere\_user](#input\_vsphere\_user) | The username used to connect to the vCenter server. Must be an admin user | `string` | n/a | yes |<br/>| &lt;a name="input_vsphere_vm_config"&gt;&lt;/a&gt; [vsphere\_vm\_config](#input\_vsphere\_vm\_config) | All Vsphere VM Configs | &lt;pre&gt;list(object({&lt;br&gt;    name          = string,&lt;br&gt;    datacenter    = string,&lt;br&gt;    cluster       = string,&lt;br&gt;    datastore     = string,&lt;br&gt;    resource_pool = string,&lt;br&gt;    folder        = string,&lt;br&gt;    guest_os_type = string,&lt;br&gt;    num_cpu       = number,&lt;br&gt;    num_memory    = number,&lt;br&gt;    network       = string,&lt;br&gt;    network       = string,&lt;br&gt;    # TODO: P2: gleichda according to the tfvars example and the module this is a defined object.&lt;br&gt;    # Should be reflected accordingly&lt;br&gt;    disks         = any&lt;br&gt;  }))&lt;/pre&gt; | n/a | yes |</span><span id="d422" class="lr jq hi kw b fi lw lt l lu lv">## Outputs</span><span id="6644" class="lr jq hi kw b fi lw lt l lu lv">| Name | Description |<br/>|------|-------------|<br/>| &lt;a name="output_vsphere_virtual_machine"&gt;&lt;/a&gt; [vsphere\_virtual\_machine](#output\_vsphere\_virtual\_machine) | Vsphere VM |</span><span id="b7c8" class="lr jq hi kw b fi lw lt l lu lv">&lt;!-- END_AUTOMATED_TF_DOCS_BLOCK --&gt;</span><span id="669e" class="lr jq hi kw b fi lw lt l lu lv">## Footer<br/>Contributor Names</span></pre><p id="7d74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它在github上的样子！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/b763c6436e2bad5d15a737530e2ca388.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kqQy4qnvTV1tg5vrmvP0Fg.png"/></div></div></figure></div><div class="ab cl lz ma gp mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hb hc hd he hf"><h1 id="9069" class="jp jq hi bd jr js mg ju jv jw mh jy jz ka mi kc kd ke mj kg kh ki mk kk kl km bi translated">其他有用的功能</h1><ul class=""><li id="9971" class="ld le hi ih b ii kn im ko iq ml iu mm iy mn jc lx lj lk ll bi translated">如果terraform代码库有多个模块，在这种情况下，我们可以利用<code class="du kt ku kv kw b">recursive</code>选项，该选项允许配置在一次执行中生成多个README.md。点击查看更多详情<a class="ae ks" href="https://terraform-docs.io/user-guide/configuration/recursive/" rel="noopener ugc nofollow" target="_blank">。</a></li></ul><pre class="je jf jg jh fd ln kw lo lp aw lq bi"><span id="30ff" class="lr jq hi kw b fi ls lt l lu lv"># file: .terraform-docs.yml<br/>recursive:<br/>  enabled: true<br/>  path: submodules-folder</span></pre><ul class=""><li id="0228" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc lx lj lk ll bi translated">如果文档中有自定义要求，可以通过更新<code class="du kt ku kv kw b">content</code>部分来实现。查看下面的示例配置。点击查看更多详情<a class="ae ks" href="https://terraform-docs.io/user-guide/configuration/content/" rel="noopener ugc nofollow" target="_blank">。</a></li></ul><pre class="je jf jg jh fd ln kw lo lp aw lq bi"><span id="62a1" class="lr jq hi kw b fi ls lt l lu lv"># file: .terraform-docs.yml<br/>content: |-<br/>  {{ .Requirements }}</span><span id="632a" class="lr jq hi kw b fi lw lt l lu lv">## Usage<br/>  Basic usage of this module is as follows:</span><span id="0b2f" class="lr jq hi kw b fi lw lt l lu lv">  Some more information can go here.</span><span id="ab07" class="lr jq hi kw b fi lw lt l lu lv">```hcl<br/>  module "example" {<br/>    {{"\t"}} source  = "&lt;module-path&gt;"</span><span id="6f94" class="lr jq hi kw b fi lw lt l lu lv">{{- if .Module.RequiredInputs }}<br/>    {{"\n\t"}} # Required variables<br/>    {{- range .Module.RequiredInputs }}<br/>    {{"\t"}} {{ .Name }}  = {{ .GetValue }}<br/>    {{- end }}<br/>    {{- end }}</span><span id="c7f9" class="lr jq hi kw b fi lw lt l lu lv">{{- if .Module.OptionalInputs }}<br/>    {{"\n\t"}} # Optional variables<br/>    {{- range .Module.OptionalInputs }}<br/>    {{"\t"}} {{ .Name }}  = {{ .GetValue | printf "%s" }}<br/>    {{- end }}<br/>    {{- end }}<br/>  }<br/>  ```</span><span id="2cfb" class="lr jq hi kw b fi lw lt l lu lv">{{ .Resources }}</span><span id="2c53" class="lr jq hi kw b fi lw lt l lu lv">include any relative files<br/><br/>{{ include "relative/path/to/file.tf" }}</span><span id="83be" class="lr jq hi kw b fi lw lt l lu lv">{{ .Inputs }}</span><span id="5c0a" class="lr jq hi kw b fi lw lt l lu lv">{{ .Outputs }}</span></pre></div><div class="ab cl lz ma gp mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hb hc hd he hf"><h1 id="a380" class="jp jq hi bd jr js mg ju jv jw mh jy jz ka mi kc kd ke mj kg kh ki mk kk kl km bi translated">GCP云构建服务中的集成</h1><p id="ad20" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">设置一个云构建工作流，在你的github repo或GCP云资源仓库上触发<code class="du kt ku kv kw b">terraform-docs</code>的执行。</p><p id="aded" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这可以通过两个步骤轻松实现:</p><p id="2c35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第1步:</strong>GCP云资源仓库不需要这一步。github需要它作为源代码库。在基于GCP的云构建中创建一个github触发器，这样每次提交或更改源github时，工作流都会被触发。</p><pre class="je jf jg jh fd ln kw lo lp aw lq bi"><span id="75aa" class="lr jq hi kw b fi ls lt l lu lv">gcloud beta builds triggers create github \<br/>    --repo-name=REPO_NAME \<br/>    --repo-owner=REPO_OWNER \<br/>    --branch-pattern=BRANCH_PATTERN \ # or --tag-pattern=TAG_PATTERN<br/>    --build-config=BUILD_CONFIG_FILE \<br/>    --include-logs-with-status</span></pre><p id="7f1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:触发器有不同的自定义选项，包括PR触发器、基于提交的触发器、手动触发器等。这也可以通过控制台来完成。点击了解更多关于github触发器<a class="ae ks" href="https://cloud.google.com/build/docs/automating-builds/github/build-repos-from-github" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="0529" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤2 </strong>:在你的存储库结构的根目录下编写你的cloudbuild.yaml，并添加步骤生成<code class="du kt ku kv kw b">terraform-docs</code>。请查看下面的示例cloudbuild.yaml。</p><pre class="je jf jg jh fd ln kw lo lp aw lq bi"><span id="bbfd" class="lr jq hi kw b fi ls lt l lu lv">...</span><span id="5fdf" class="lr jq hi kw b fi lw lt l lu lv">steps:<br/># Pull the terraform-docs image from container registry.<br/>- name: 'quay.io/terraform-docs/terraform-docs'<br/>  args: [<br/>    '-c', '.terraform-docs.yml',<br/>    './modules'<br/>  ]</span><span id="3722" class="lr jq hi kw b fi lw lt l lu lv">...</span></pre><p id="aaea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:在cloudbuild GCP服务中有很多很棒的特性，这里我们只是介绍了这些特性的基本用法。更多详细信息，请参见此处的<a class="ae ks" href="https://cloud.google.com/build/docs/overview" rel="noopener ugc nofollow" target="_blank"/>。</p></div><div class="ab cl lz ma gp mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hb hc hd he hf"><h1 id="2522" class="jp jq hi bd jr js mg ju jv jw mh jy jz ka mi kc kd ke mj kg kh ki mk kk kl km bi translated">集成到Github操作中</h1><p id="df45" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">在github中设置一个工作流来运行<code class="du kt ku kv kw b">terraform-docs</code>，并将文档变更推回PR(拉式请求)。</p><p id="9ace" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在github中创建一个文件，<code class="du kt ku kv kw b">.github/workflows/documentation.yaml</code>给定内容:</p><pre class="je jf jg jh fd ln kw lo lp aw lq bi"><span id="96bd" class="lr jq hi kw b fi ls lt l lu lv">name: Generate terraform-docs<br/>on:<br/>  - pull_request<br/><br/>jobs:<br/>  docs:<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>    - uses: actions/checkout@v3<br/>      with:<br/>        ref: ${{ github.event.pull_request.head.ref }}<br/><br/>    - name: Render terraform docs and push changes back to PR<br/>      uses: terraform-docs/gh-actions@main<br/>      with:<br/>        working-dir: .<br/>        output-file: README.md<br/>        output-method: inject<br/>        git-push: "true"</span></pre><p id="ea96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查看更多关于<a class="ae ks" href="https://github.com/terraform-docs/gh-actions" rel="noopener ugc nofollow" target="_blank"> terraform-docs GitHub动作</a>及其配置的信息。</p></div><div class="ab cl lz ma gp mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hb hc hd he hf"><h1 id="51f0" class="jp jq hi bd jr js mg ju jv jw mh jy jz ka mi kc kd ke mj kg kh ki mk kk kl km bi translated">预提交挂钩中的集成</h1><p id="da05" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">强制开发者在提交给回购之前运行<code class="du kt ku kv kw b">terraform-docs</code>，那么你的朋友就是预提交钩子(【https://pre-commit.com/】<a class="ae ks" href="https://pre-commit.com/" rel="noopener ugc nofollow" target="_blank"/>)。该实用程序允许配置一组在继续提交之前需要执行的规则/操作。</p><ol class=""><li id="8c0d" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated">在repo的根目录下创建一个包含给定内容的文件<code class="du kt ku kv kw b">.pre-commit-config.yaml</code>:</li></ol><pre class="je jf jg jh fd ln kw lo lp aw lq bi"><span id="1ba8" class="lr jq hi kw b fi ls lt l lu lv">repos:<br/>  - repo: https://github.com/terraform-docs/terraform-docs<br/>    rev: "v0.12.0"             <br/>    hooks:<br/>      - id: terraform-docs<br/>        args: ["terraform", "-c", "<!-- -->.terraform.yml", ".<!-- -->"] </span></pre><p id="82e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.安装预提交并激活挂钩。</p><pre class="je jf jg jh fd ln kw lo lp aw lq bi"><span id="9e2c" class="lr jq hi kw b fi ls lt l lu lv">## Install<br/>pip install pre-commit</span><span id="af93" class="lr jq hi kw b fi lw lt l lu lv">## Activate the hooks<br/>pre-commit install</span><span id="1741" class="lr jq hi kw b fi lw lt l lu lv">## if already exists<br/>pre-commit autoupdate</span></pre><p id="2552" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.继续执行任何地形变化，并尝试<code class="du kt ku kv kw b">git commit</code>。这样我们就可以在README.md中看到提交前的钩子执行和更新。</p><p id="9a04" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.我们也可以使用<code class="du kt ku kv kw b">run</code>选项手动触发预提交挂钩。</p><pre class="je jf jg jh fd ln kw lo lp aw lq bi"><span id="8a89" class="lr jq hi kw b fi ls lt l lu lv">pre-commit run <!-- -->terraform-docs</span></pre><p id="631e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击此处查看更多<a class="ae ks" href="https://pre-commit.com/" rel="noopener ugc nofollow" target="_blank">预提交详情。</a></p></div><div class="ab cl lz ma gp mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hb hc hd he hf"><p id="ec49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您阅读这篇围绕<em class="lm"> terraform-docs </em>的博客。有什么反馈就告诉我！</p><p id="15f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">别忘了鼓掌并在Medium上关注:-) &amp;也在Linkedin<a class="ae ks" href="https://www.linkedin.com/in/umeshkumhar" rel="noopener ugc nofollow" target="_blank">上联系我。</a></p></div></div>    
</body>
</html>