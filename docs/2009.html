<html>
<head>
<title>Serverless performance comparison: Does the language matter?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器性能比较:语言重要吗？</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/serverless-performance-comparison-does-the-language-matter-c72a7191c799?source=collection_archive---------0-----------------------#2021-11-22">https://medium.com/google-cloud/serverless-performance-comparison-does-the-language-matter-c72a7191c799?source=collection_archive---------0-----------------------#2021-11-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1909045e05f986f97ad32c637ce96d9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U0GqZroeRt7tbYz8EpUzIA.png"/></div></div></figure><p id="f333" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于<a class="ae jo" rel="noopener" href="/google-cloud/cloud-run-and-cloud-functions-does-the-region-change-the-performances-b967e5cee0cc">云运行、云函数</a>和<a class="ae jo" rel="noopener" href="/google-cloud/bigquery-tell-me-your-region-i-will-tell-you-your-speed-41dcf42b8cc"> BigQuery </a>的不同区域之间的无服务器比较<strong class="is hj">是执行选择</strong>的第一维度。但是云开发者也需要选择和使用语言来实现他们的应用。有<strong class="is hj">很多选择</strong>，一些产品限制了可能性，但是<strong class="is hj">所有开发者都有他们的偏好和观点。</strong> <br/> <em class="jp">几个月前我就开始了这个比较，在比较了结果之后，</em> <strong class="is hj"> <em class="jp">我从来没有想过写这篇文章来避免一场无用的语言战争</em> </strong> <em class="jp">。然而，在与Henrique Joaquim讨论了我以前关于无服务器计算性能的文章对他的论文的有用性之后，我选择完成并发布它来帮助他的论文。</em></p><blockquote class="js"><p id="ab26" class="jt ju hi bd jv jw jx jy jz ka kb jn dx translated">所以，如果产品和地区很重要，语言也很重要吗？</p></blockquote><h1 id="2327" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">测试协议</h1><p id="abb8" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">我选择比较大多数产品支持的4种最流行的语言:</p><ul class=""><li id="423d" class="lf lg hi is b it iu ix iy jb lh jf li jj lj jn lk ll lm ln bi translated">NodeJS</li><li id="c508" class="lf lg hi is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln bi translated">Python 3</li><li id="eafc" class="lf lg hi is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln bi translated">Java 语言(一种计算机语言，尤用于创建网站)</li><li id="73e9" class="lf lg hi is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln bi translated">戈朗</li></ul><p id="a337" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当然，<strong class="is hj">我并不擅长所有这些</strong>，我将测试限制在斐波那契算法上(在递归模式下)。<br/>我还选择了<strong class="is hj">在云功能和云运行上比较性能。</strong></p></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><p id="9e10" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">协议很简单:</p><ul class=""><li id="efe8" class="lf lg hi is b it iu ix iy jb lh jf li jj lj jn lk ll lm ln bi translated"><strong class="is hj">在同一个区域部署</strong>云运行和云功能服务(在我的例子中为<code class="du ma mb mc md b">us-central1</code>),并使用相同的2Gb内存/1个vCPU</li><li id="c482" class="lf lg hi is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln bi translated">运行虚拟查询<strong class="is hj">以避免冷启动</strong></li><li id="22a9" class="lf lg hi is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln bi translated">连续运行<strong class="is hj"> 3次，相同的斐波纳契复杂度(在我的例子中是43)</strong></li><li id="3ad8" class="lf lg hi is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln bi translated">收集和<strong class="is hj">编译结果</strong></li></ul><p id="a0cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jp">要在您这边重现测试，您可以简单地遵循</em> <code class="du ma mb mc md b"><a class="ae jo" href="https://github.com/guillaumeblaquiere/cloudrun-cloudfunction-compare/blob/master/README.md" rel="noopener ugc nofollow" target="_blank"><em class="jp">README.md</em></a></code> <em class="jp">文件，它解释了如何部署、运行测试和清理您的环境。</em></p><h1 id="3124" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn me kp kq kr mf kt ku kv mg kx ky kz bi translated">测试结果</h1><p id="ca2d" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">经过2次性能测试，我得到了这些结果<em class="jp">(原始数据在</em> <code class="du ma mb mc md b"><a class="ae jo" href="https://github.com/guillaumeblaquiere/cloudrun-cloudfunction-compare/blob/master/results.csv" rel="noopener ugc nofollow" target="_blank"><em class="jp">result.csv</em></a></code> <a class="ae jo" href="https://github.com/guillaumeblaquiere/cloudrun-cloudfunction-compare/blob/master/results.csv" rel="noopener ugc nofollow" target="_blank"> <em class="jp">文件</em> </a> <em class="jp"> ) </em></p><figure class="mi mj mk ml fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/459c962e709067f05f2f454dd82d3dea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FKxUR2NoQMTC3efvS-0XSg.png"/></div></div></figure><p id="6204" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以观察到<strong class="is hj"> 2个意想不到的事情</strong></p><ul class=""><li id="bcd0" class="lf lg hi is b it iu ix iy jb lh jf li jj lj jn lk ll lm ln bi translated">云运行总是比云函数略快(如预期)。<strong class="is hj">然而在Java中却不是这样。</strong> <br/> <em class="jp">我怀疑有些</em> <strong class="is hj"> <em class="jp"> JVM标志默认添加</em> </strong> <em class="jp">在云函数容器创建期间(由Google Cloud和Buildpacks自动生成)那个</em> <strong class="is hj"> <em class="jp">我还没有添加到</em> </strong> <code class="du ma mb mc md b"><strong class="is hj"><em class="jp">Procfile</em></strong><em class="jp">.</em></code></li><li id="f6e7" class="lf lg hi is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln bi translated"><strong class="is hj"> NodeJS结果从简单到双精度</strong>不等。云功能1倍快2倍慢，云运行2倍快1倍慢。我运行了几次测试，总是得到这个结果。 <strong class="is hj"> <em class="jp">我无法解释，</em> </strong> <em class="jp">尤其是因为Nodejs是我在4种语言中较弱的一种。</em> <strong class="is hj"> <em class="jp">请建议！</em>T41】</strong></li></ul></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><p id="5679" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">除了这两件意想不到的事情，我们可以<strong class="is hj">毫不惊讶地得出结论，编译语言</strong> (Golang，Java) <strong class="is hj">比解释语言</strong> (Python，NodeJS)更快。</p><p id="964e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而<strong class="is hj">性能差异对我来说是意想不到的</strong>:</p><figure class="mi mj mk ml fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/57d6f18968af1aa7437981d95b61e85a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7Go0K6EeCPZo5ZX6UCs4cQ.png"/></div></div></figure><p id="a7b1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jp">我保留了NodeJS的2个值，不知道哪个最现实</em></p><ul class=""><li id="462a" class="lf lg hi is b it iu ix iy jb lh jf li jj lj jn lk ll lm ln bi translated">一开始就没想到<strong class="is hj"> Java！</strong></li><li id="9100" class="lf lg hi is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln bi translated">没想到<strong class="is hj"> Python比Java </strong>慢100倍！！！</li></ul><h1 id="dd36" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn me kp kq kr mf kt ku kv mg kx ky kz bi translated">其他比较输入</h1><p id="b062" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">处理性能<strong class="is hj">并不是我们可以在语言之间进行比较的唯一点</strong>。由于<strong class="is hj">只关注云运行</strong>，我们可以比较:</p><ul class=""><li id="0378" class="lf lg hi is b it iu ix iy jb lh jf li jj lj jn lk ll lm ln bi translated">容器尺寸</li><li id="3e8c" class="lf lg hi is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln bi translated">内存占用</li><li id="b74f" class="lf lg hi is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln bi translated">冷启动持续时间</li></ul><h2 id="4a0a" class="mn kd hi bd ke mo mp mq ki mr ms mt km jb mu mv kq jf mw mx ku jj my mz ky na bi translated">集装箱尺寸比较</h2><p id="fef0" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">容器<strong class="is hj">大小不影响云运行服务启动</strong>，但影响<strong class="is hj">部署时间</strong>。其他容器编排服务也是如此，比如Kubernetes和GKE。</p><p id="43d8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它对成本也有影响，因为存储更大的图像需要更多的空间，因此成本更高！</p><figure class="mi mj mk ml fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nb"><img src="../Images/ef5a257f6d59ba3493c7605f8783f521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xGX9_0nCRV15Z_X5GnyuLA.png"/></div></div></figure><p id="b1f4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">自动构建的容器<strong class="is hj">保持一个100Mb </strong>的大小，除了Java需要<strong class="is hj">整个(和重)JVM </strong>。</p><p id="b1b4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jp">这里我比较了由云运行自动创建的默认容器和没有定制优化的默认容器。您可以通过定制</em>  <em class="jp">来轻松地</em> <strong class="is hj"> <em class="jp">缩小(或增大)容器的大小，例如使用</em> <code class="du ma mb mc md b"><em class="jp">Dockerfile</em></code> <em class="jp">创建。</em></strong></p></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><p id="ef31" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以得到Cloud Run自动构建的容器镜像，在工件注册表-&gt;在<code class="du ma mb mc md b">cloud-run-source-deploy</code>目录下</p><figure class="mi mj mk ml fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nc"><img src="../Images/154152b388a98519220507afcf42b2a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1RwoY38S3X0g_WrS0VExaA.png"/></div></div></figure><p id="020e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">选择您想要的图像并查看其大小。</p></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h2 id="09d9" class="mn kd hi bd ke mo mp mq ki mr ms mt km jb mu mv kq jf mw mx ku jj my mz ky na bi translated">内存占用比较</h2><p id="3425" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated"><strong class="is hj">内存对于大型应用来说至关重要</strong>。在这里，它只是一个非常基本的小应用程序，几乎没有依赖关系。<br/>然而，<strong class="is hj">服务的内存占用越大，它就越贵</strong>。</p><figure class="mi mj mk ml fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nd"><img src="../Images/6465cb75bd6173ae4dcc2c897e9ea4c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yuZFRoTdL3QUUG654TVlDg.png"/></div></div></figure><p id="124a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jp">我采用了95%的云运行指标图</em></p><p id="ae06" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有了他的高效编译，<strong class="is hj">围棋很轻</strong>。<br/> <strong class="is hj">在内存使用上口碑很差的Java</strong>，在不使用库或框架的情况下，也没那么差。<br/> NodeJS和Python <strong class="is hj">都没那么差。</strong></p><h2 id="b0ba" class="mn kd hi bd ke mo mp mq ki mr ms mt km jb mu mv kq jf mw mx ku jj my mz ky na bi translated">冷启动持续时间比较</h2><p id="7f31" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">大多数情况下，冷启动<strong class="is hj">对于实际工作负载</strong>来说并不重要，但有时却很重要！如果<strong class="is hj">服务太慢，无法启动一个新的实例</strong>，需要提供额外的功能，如<a class="ae jo" href="https://cloud.google.com/run/docs/configuring/min-instances" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">最小实例</strong> </a> <strong class="is hj">来解决；当然，<strong class="is hj">对服务成本</strong>也不是没有影响。<br/> <em class="jp">我已经在云上运行</em>  <em class="jp">进行了一次</em> <a class="ae jo" rel="noopener" href="/google-cloud/java-frameworks-performances-on-cloud-run-eb243fd84a5c"> <em class="jp"> Java冷启动比较，尤其是有框架和无框架的比较。这里的测试没有框架。</em></a></strong></p><figure class="mi mj mk ml fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ne"><img src="../Images/3d8609acf625e78cb5c461a2188d7b60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zr50Ecz3-MMR-Bpa2iQLUw.png"/></div></div></figure><figure class="mi mj mk ml fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nf"><img src="../Images/d6b8d5a022443356837c77c25dadca89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mPNvIjx1-s4aFxPh7popPw.png"/></div></div></figure><p id="dbfe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jp">结果已经从云日志中获得，这是部署后的第一个请求。我部署了3次，每次都通过Fibonacci(1)计算得到了前1个请求。</em></p><p id="da33" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">围棋最快</strong>，而<strong class="is hj"> NodeJS也有很棒的表现</strong>。<br/>不出意外，<strong class="is hj"> Java在1.5s以上，</strong> <br/>但是<strong class="is hj">的惊喜来自Python </strong>。也许是<code class="du ma mb mc md b">gunicorn</code>库导致了这种延迟。<strong class="is hj"> <em class="jp">请建议！</em> </strong></p><h1 id="94e1" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn me kp kq kr mf kt ku kv mg kx ky kz bi translated">最后的比较</h1><p id="2995" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">最后，如果我们得到所有的排名(<strong class="is hj">没有任何优先考虑</strong>)，我们就有了那个结果</p><figure class="mi mj mk ml fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ng"><img src="../Images/0df6c7f8a6eb1687d3063bb2651f5347.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QUEl-8zkjJj1uZFutS3wOg.png"/></div></div></figure><p id="8737" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Go是一种在云中开发的现代语言</strong>，对于云和我们可以看到它<strong class="is hj">非常适合无服务器环境</strong>和<strong class="is hj">微服务架构。</strong> <br/> <strong class="is hj"> Java和NodeJS </strong>各有优缺点，<strong class="is hj">有待认真考虑。</strong> <br/> <strong class="is hj"> Python是我最大的惊喜</strong>，在排名中垫底。</p><blockquote class="js"><p id="1e03" class="jt ju hi bd jv jw jx jy jz ka kb jn dx translated">考虑到Python在世界范围内的吸引力和它糟糕的性能，我想知道计算效率、节能和全球变暖…</p></blockquote><p id="81cb" class="pw-post-body-paragraph iq ir hi is b it nh iv iw ix ni iz ja jb nj jd je jf nk jh ji jj nl jl jm jn hb bi translated">然而，<strong class="is hj">我无法解释这个Python糟糕的排名</strong>，我将很高兴<strong class="is hj">从Python专家</strong>那里了解更多，也许会更新这篇文章并进行一些修复。</p></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><p id="c1a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">无论如何，我认为在选择开发语言时，除了这些结果之外，考虑其他几个方面也很重要:</p><ul class=""><li id="9070" class="lf lg hi is b it iu ix iy jb lh jf li jj lj jn lk ll lm ln bi translated"><strong class="is hj">开发者的知识</strong>、<strong class="is hj">技能和偏好</strong></li><li id="4c8c" class="lf lg hi is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln bi translated"><strong class="is hj">开发人员可用性</strong>和<strong class="is hj">雇佣</strong>新资源/人才来发展开发团队的能力</li><li id="9861" class="lf lg hi is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln bi translated"><strong class="is hj">库</strong>到期和<strong class="is hj">文档</strong></li><li id="846e" class="lf lg hi is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln bi translated"><strong class="is hj">开发循环</strong>的效率和可靠性</li></ul><p id="5617" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一种尺寸并不适合所有人，这取决于你的背景。因此，<strong class="is hj">明智地选择</strong>，牢记这一点！</p></div></div>    
</body>
</html>