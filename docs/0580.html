<html>
<head>
<title>Helm on GKE cluster — quick hands-on guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GKE集群掌舵——快速实践指南</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/helm-on-gke-cluster-quick-hands-on-guide-ecffad94b0?source=collection_archive---------0-----------------------#2018-04-22">https://medium.com/google-cloud/helm-on-gke-cluster-quick-hands-on-guide-ecffad94b0?source=collection_archive---------0-----------------------#2018-04-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/a557fb43361f18fbdb32a80fb0f2bb04.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*V0ontpKlJ8k5y51t4wY3Ng.png"/></div></figure><p id="8b00" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个快速指南有助于让helm在Google Kubernetes引擎(GKE)集群上运行。本文假设读者:</p><ul class=""><li id="a8bf" class="jk jl hi io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">事先了解<a class="ae jt" href="https://github.com/kubernetes/helm" rel="noopener ugc nofollow" target="_blank"> helm </a>、<a class="ae jt" href="https://github.com/kubernetes/kubernetes" rel="noopener ugc nofollow" target="_blank"> kubernetes </a>和<a class="ae jt" href="http://console.cloud.google.com/kubernetes/" rel="noopener ugc nofollow" target="_blank"> gke </a>。</li><li id="e33d" class="jk jl hi io b ip ju it jv ix jw jb jx jf jy jj jp jq jr js bi translated">有一个本地安装的<code class="du jz ka kb kc b">kubectl</code>和<code class="du jz ka kb kc b">helm</code>以及一个至少有3个节点(包括主节点)的GKE集群。</li><li id="399e" class="jk jl hi io b ip ju it jv ix jw jb jx jf jy jj jp jq jr js bi translated">这是用以下版本测试的:</li></ul><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><h2 id="4146" class="kj kk hi bd kl km kn ko kp kq kr ks kt ix ku kv kw jb kx ky kz jf la lb lc ld bi translated">为helm创建服务帐户</h2><p id="6d47" class="pw-post-body-paragraph im in hi io b ip le ir is it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj hb bi translated">首先创建一个服务帐户，并将群集管理角色附加到它。这使得tiler pod能够与kubernetes api进行通信。你应该这样做是有原因的。这可以用<code class="du jz ka kb kc b">kubectl apply -f &lt;file&gt;</code>来完成</p><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es lj"><img src="../Images/9480aa86a1181329ca190312423cbc89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*ktydaGNwuAOw3reF7D5e6A.png"/></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">为helm和clusterrolebinding创建服务帐户</figcaption></figure><h2 id="f862" class="kj kk hi bd kl km kn ko kp kq kr ks kt ix ku kv kw jb kx ky kz jf la lb lc ld bi translated">提升创建ClusterRoleBindings的权限(如有必要)</h2><p id="f6bd" class="pw-post-body-paragraph im in hi io b ip le ir is it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj hb bi translated">如果上述命令成功，请跳过本节。有时候，你会在GKE犯一些被禁止的错误。解决这个问题的一个更简单的方法是以特权用户的身份执行ClusterRoleBinding。</p><ul class=""><li id="bef5" class="jk jl hi io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">使用<code class="du jz ka kb kc b">gcloud describe</code>获取您的管理员密码</li></ul><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es lo"><img src="../Images/ebdd567b8746744c7f0ecedea55cb466.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*cVof4ll82hsoYlTv3Bc54g.png"/></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">带描述的管理员密码</figcaption></figure><ul class=""><li id="1f56" class="jk jl hi io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">使用这些凭证并创建上一节中的服务帐户和集群角色绑定。一种方法是修改您的<code class="du jz ka kb kc b">$HOME/.kube/config</code>来添加一个新的用户条目，并将其提供给您的上下文，然后在初始化<code class="du jz ka kb kc b">helm</code>后恢复。</li></ul><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es lp"><img src="../Images/b50fd74958794c9e8cb2c4df6b3b0529.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*8NEaw5nWhksqjiOBbEOAxA.png"/></div></figure><ul class=""><li id="2d31" class="jk jl hi io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">如果你碰巧提升了特权，你就不再需要它了。</li></ul><h2 id="5e22" class="kj kk hi bd kl km kn ko kp kq kr ks kt ix ku kv kw jb kx ky kz jf la lb lc ld bi translated">初始化舵</h2><p id="1b6b" class="pw-post-body-paragraph im in hi io b ip le ir is it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj hb bi translated">现在运行<code class="du jz ka kb kc b">helm init</code>传递服务帐户。</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/b283b3b846802e653a9e7ee174aae1f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*Ck0ZXSGrRRWuVxK66pkkCQ.png"/></div></figure><h2 id="66dc" class="kj kk hi bd kl km kn ko kp kq kr ks kt ix ku kv kw jb kx ky kz jf la lb lc ld bi translated">验证舵</h2><p id="abd1" class="pw-post-body-paragraph im in hi io b ip le ir is it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj hb bi translated">首先，在<code class="du jz ka kb kc b">kube-system</code>名称空间中应该至少有一个名为<code class="du jz ka kb kc b">tiller-deploy</code>的部署和服务。</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es lr"><img src="../Images/02e3255c026da1a8b9149cbc0d3e0150.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*F592l75zGsjvhoXr2IlWBQ.png"/></div></figure><p id="8b71" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">创建一个<code class="du jz ka kb kc b">samplechart</code>并以名称<code class="du jz ka kb kc b">helm-test</code>安装它。这将安装一个简单的nginx pod。将服务类型设置为<code class="du jz ka kb kc b">LoadBalancer</code>。</p><figure class="kd ke kf kg fd ij er es paragraph-image"><div class="er es ls"><img src="../Images/11ab876b468e4c472671c4f9e3bbf50a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*HNC7ViTAM7sUP5kwDhPS1A.png"/></div></figure><p id="a4ae" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这就对了。</p><h2 id="a9ea" class="kj kk hi bd kl km kn ko kp kq kr ks kt ix ku kv kw jb kx ky kz jf la lb lc ld bi translated">常见错误</h2><figure class="kd ke kf kg fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><h1 id="1ef4" class="lt kk hi bd kl lu lv lw kp lx ly lz kt ma mb mc kw md me mf kz mg mh mi lc mj bi translated">参考</h1><ol class=""><li id="79b1" class="jk jl hi io b ip le it lf ix mk jb ml jf mm jj mn jq jr js bi translated">helm为什么需要服务账户—<a class="ae jt" href="http://jayunit100.blogspot.fi/2017/07/helm-on.html" rel="noopener ugc nofollow" target="_blank">http://jayunit100.blogspot.fi/2017/07/helm-on.html</a></li><li id="8661" class="jk jl hi io b ip ju it jv ix jw jb jx jf jy jj mn jq jr js bi translated">更多关于赫尔姆—<a class="ae jt" href="https://docs.helm.sh/" rel="noopener ugc nofollow" target="_blank">https://docs.helm.sh/</a></li><li id="9c28" class="jk jl hi io b ip ju it jv ix jw jb jx jf jy jj mn jq jr js bi translated">Kubernetes docs — <a class="ae jt" href="http://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> http://kubernetes.io/ </a></li><li id="7ca5" class="jk jl hi io b ip ju it jv ix jw jb jx jf jy jj mn jq jr js bi translated">Google kubernetes 引擎 (GKE) — <a class="ae jt" href="https://console.cloud.google.com/kubernetes/" rel="noopener ugc nofollow" target="_blank"> https://console.cloud.google.com/kubernetes/ </a></li></ol></div></div>    
</body>
</html>