<html>
<head>
<title>Jupyter+Keras+ Nvidia Docker with GPU on Google Cloud in an instant</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jupyter+Keras+ Nvidia Docker搭配GPU瞬间上谷歌云</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/jupyter-keras-nvidia-docker-with-gpu-on-google-cloud-in-an-instant-35ac7f413a92?source=collection_archive---------0-----------------------#2017-09-12">https://medium.com/google-cloud/jupyter-keras-nvidia-docker-with-gpu-on-google-cloud-in-an-instant-35ac7f413a92?source=collection_archive---------0-----------------------#2017-09-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bb6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为一名机器学习工程师，自己制造环境来尝试机器学习任务真的很重要。我认为，像AWS和GCP这样的公共云服务越方便，这种能力就越重要。</p><p id="6940" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天我想描述一下我做的一个套件，用jupyter notebook，keras，Nvidia docker用GPU在google cloud上瞬间做了一个环境。</p><h2 id="8f7e" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">动机</h2><p id="11a2" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">我想要一个用jupyter和GPU构建深度学习模型的环境。有几个候选人。那样最好。不幸的是，我们还不能用带<code class="du kd ke kf kg b">docker-machine</code>的GPU创建GCP实例。我等着看这个问题。谷歌数据实验室也将是一个伟大的候选人。但不知道它和jupyter笔记本完全兼容。但是，两者都不足以满足我的要求。</p><h2 id="89fd" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">GitHub知识库</h2><p id="d72d" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">作为我研究用GPU构建GCP的结果，我决定自己做一个。当然可以瞬间使用。</p><ul class=""><li id="134e" class="ki kj hi ih b ii ij im in iq kk iu kl iy km jc kn ko kp kq bi translated"><a class="ae kh" href="https://github.com/yu-iskw/google-cloud-deep-learning-kit" rel="noopener ugc nofollow" target="_blank">https://github.com/yu-iskw/google-cloud-deep-learning-kit</a></li></ul><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kr"><img src="../Images/37f9ee92bd1decb59f882808015d3a1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QeBFmvj5ZVv3eAr4OxI3zg.png"/></div></div></figure><h2 id="a8ae" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">特征</h2><ul class=""><li id="fbdd" class="ki kj hi ih b ii jy im jz iq ld iu le iy lf jc kn ko kp kq bi translated">用nvidia docker在GCP上做一个GPU实例</li><li id="7203" class="ki kj hi ih b ii lg im lh iq li iu lj iy lk jc kn ko kp kq bi translated">在GPU实例中将jupyter作为docker容器运行</li><li id="7e3d" class="ki kj hi ih b ii lg im lh iq li iu lj iy lk jc kn ko kp kq bi translated">设置一个SSH隧道来从web浏览器访问jupyter</li><li id="e072" class="ki kj hi ih b ii lg im lh iq li iu lj iy lk jc kn ko kp kq bi translated">通过pip将python库安装到容器中(可选)</li><li id="ccec" class="ki kj hi ih b ii lg im lh iq li iu lj iy lk jc kn ko kp kq bi translated">将文件从本地计算机上传到实例</li><li id="65b6" class="ki kj hi ih b ii lg im lh iq li iu lj iy lk jc kn ko kp kq bi translated">将文件从实例下载到本地计算机</li><li id="ae58" class="ki kj hi ih b ii lg im lh iq li iu lj iy lk jc kn ko kp kq bi translated">删除实例</li></ul><h2 id="9dc5" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">用nvidia docker在GCP上做一个GPU实例</h2><p id="9f8b" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated"><code class="du kd ke kf kg b">make create-instance</code>允许我们用nvidia docker在GPU上做一个GPU实例，运行一个启动脚本。在执行该命令之前，我建议您编辑<code class="du kd ke kf kg b">Makefile</code>，将<code class="du kd ke kf kg b">INSTANCE_NAME</code>设置为您的实例名，将<code class="du kd ke kf kg b">GCP_PROJECT_ID</code>设置为您的GCP项目ID。您也可以在创建实例时设置它们。创建一个实例大约需要5分钟。</p><pre class="ks kt ku kv fd ll kg lm ln aw lo bi"><span id="e75e" class="jd je hi kg b fi lp lq l lr ls">make create-instance \<br/>  INSTANCE_NAME="test-gpu-instance" \<br/>  GCP_PROJECT_ID=xxx-xxx-xxx<!-- --> </span></pre><p id="b66e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的YAML文件是用jupyter、keras等等为docker容器创建一个anaconda环境。你不需要自己安装它们，因为docker镜像已经包含了它们。</p><ul class=""><li id="847c" class="ki kj hi ih b ii ij im in iq kk iu kl iy km jc kn ko kp kq bi translated"><a class="ae kh" href="https://github.com/yu-iskw/google-cloud-deep-learning-kit/blob/master/docker/environment-gpu.yml" rel="noopener ugc nofollow" target="_blank">https://github . com/Yu-iskw/Google-cloud-deep-learning-kit/blob/master/docker/environment-GPU . yml</a></li></ul><h2 id="27e9" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">在GPU实例中将jupyter作为docker容器运行</h2><p id="20f0" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">创建实例后，必须用<code class="du kd ke kf kg b">make run-jupyter</code>运行jupyter notebook。</p><pre class="ks kt ku kv fd ll kg lm ln aw lo bi"><span id="197d" class="jd je hi kg b fi lp lq l lr ls">make run-jupyter \<br/>  INSTANCE_NAME="test-gpu-instance" \<br/>  GCP_PROJECT_ID=xxx-xxx-xxx<!-- --> </span></pre><h2 id="3e92" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">设置一个SSH隧道来从web浏览器访问jupyter</h2><p id="b136" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">为了访问您启动的jupyter，您必须有一个SSH隧道。当你得到它时，你可以通过本地机器上的网络浏览器访问<code class="du kd ke kf kg b">http://localhost:18888</code>。当没有用<code class="du kd ke kf kg b">make ssh-tunnel</code>设置任何值时，端口是默认值。<code class="du kd ke kf kg b">JUPYTER_PORT</code>默认为<code class="du kd ke kf kg b">18888</code>。</p><pre class="ks kt ku kv fd ll kg lm ln aw lo bi"><span id="d52c" class="jd je hi kg b fi lp lq l lr ls">make ssh-tunnel \<br/>  INSTANCE_NAME="test-gpu-instance" \<br/>  GCP_PROJECT_ID=xxx-xxx-xxx \<br/>  JUPYTER_PORT=18888</span></pre><h2 id="b7ca" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">通过pip将python库安装到容器中</h2><p id="5e47" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">如果你想在jupyter正在运行的docker容器中安装额外的python库，首先将它们添加到<code class="du kd ke kf kg b">requirements.txt</code>，然后执行<code class="du kd ke kf kg b">make pip-install</code>。</p><pre class="ks kt ku kv fd ll kg lm ln aw lo bi"><span id="1f54" class="jd je hi kg b fi lp lq l lr ls">make run-jupyter \<br/>  INSTANCE_NAME="test-gpu-instance" \<br/>  GCP_PROJECT_ID=xxx-xxx-xxx</span></pre><h2 id="4632" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">将文件从本地计算机上传到实例</h2><p id="f767" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">如果你想上传你的文件，包括笔记本和数据，<code class="du kd ke kf kg b">make upload-files</code>允许我们这样做，设置<code class="du kd ke kf kg b">FROM</code>到你的路径。这些文件将被上传到GCP的<code class="du kd ke kf kg b">/src</code>下。目录由<code class="du kd ke kf kg b">/src</code>安装在docker容器中。</p><pre class="ks kt ku kv fd ll kg lm ln aw lo bi"><span id="f468" class="jd je hi kg b fi lp lq l lr ls">make upload-files \<br/>  INSTANCE_NAME="test-gpu-instance" \<br/>  GCP_PROJECT_ID=xxx-xxx-xxx \<br/>  FROM=/path/to/your/files</span></pre><h2 id="69d5" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">将文件从实例下载到本地计算机</h2><p id="f03f" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">当您在docker容器中保存<code class="du kd ke kf kg b">/src/outputs</code>下的模型时，您可以使用<code class="du kd ke kf kg b">make download-outputs</code>下载它们。您必须将<code class="du kd ke kf kg b">TO</code>设置为您想要下载的路径。</p><pre class="ks kt ku kv fd ll kg lm ln aw lo bi"><span id="4f52" class="jd je hi kg b fi lp lq l lr ls">make download-outputs \<br/>  INSTANCE_NAME="test-gpu-instance" \<br/>  GCP_PROJECT_ID=xxx-xxx-xxx \<br/>  TO=/path/to/your/destination</span></pre><h2 id="0534" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">删除实例</h2><p id="ea29" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">完成模型制作后，请不要忘记删除实例。</p><pre class="ks kt ku kv fd ll kg lm ln aw lo bi"><span id="e698" class="jd je hi kg b fi lp lq l lr ls">make delete-instance \<br/>  INSTANCE_NAME="test-gpu-instance" \<br/>  GCP_PROJECT_ID=xxx-xxx-xxx</span></pre><h2 id="3dc9" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">结论</h2><p id="0ae7" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">我用GPU、jupyter、keras等工具制作了一个GCP实例的工具包。希望对你的机器学习生活有所帮助。</p></div></div>    
</body>
</html>