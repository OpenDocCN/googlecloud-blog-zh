# Verba volant，scripta manent。试用 Dialogflow Messenger 和 BigQuery

> 原文：<https://medium.com/google-cloud/verba-volant-scripta-manent-experimenting-with-dialogflow-messanger-and-bigquery-18f6e5c031c1?source=collection_archive---------1----------------------->

我的印象是，语音代理比聊天机器人拥有更大的影响力，就像几年前机器人给移动应用蒙上阴影一样，在那之前，移动应用给网络应用蒙上阴影。说到趋势，如果说短信盖过了电话，那么语音信息已经超过了短信。在 2018 年 12 月发表在《卫报》上的一篇精彩的[文章](https://www.theguardian.com/technology/2018/dec/02/five-reasons-why-voice-messaging-is-the-next-big-thing)中，克里斯·斯托克-沃克认为语音消息是下一个重要的沟通形式。在新冠肺炎疫情[期间，WhatsApp 每天进行超过 150 亿分钟的语音和视频通话。](https://blog.whatsapp.com/group-video-and-voice-calls-now-support-8-participants/?lang=en)

> 永远为听者着想。至少在实时电话中，对方有可能会打断你和人力资源部的蒂芙尼最近的争吵。如果你是在做一段录音独白，就不可能喋喋不休，所以要简明扼要。或者更好的是，问问你自己是否有必要说出来。没有人喜欢耐着性子听完五分钟的莎士比亚式独白。([T5【克里斯·斯托克-沃克】T6](https://www.theguardian.com/profile/chris-stokel-walker))

在这篇文章中，我想分析在对话界面的环境中，语音和文本的利弊，为什么文本通常是与虚拟代理沟通的更好渠道。然后，我们将探索一个简单的[聊天机器人](https://20220321t113831-dot-diaologflow-cx-playground.uc.r.appspot.com/)，它将数据写入 BigQuery 表中，我们将了解如何使用 Dialogflow Messenger 通过可定制的聊天对话将数据嵌入到 App Engine 中运行的网页中。

![](img/6748fdf5b3836795f00f7705164810ce.png)

不管是虚拟的还是人，都要考虑听者。它们被称为即时消息是有原因的:-)

# 让我们从头开始:语音 vs 文字

为什么语音信息变得如此流行？我猜是因为他们不知何故介于电话和短信之间。它们允许像打电话一样的快速交流，但是它们没有电话那么“打扰”。有些人认为打电话是一种侵犯——迫使人们在没有准备好的时候和你说话。轶事证据表明，我们已经变得害怕拿起电话。我们不断地相互联系，但是书面交流允许我们以自己选择的速度参与对话。语音信息允许异步交流(与电话相反),但它们没有短信那么客观和“无菌”。语音交流给人一种真正丰富的情感和更高的联系感，你可以通过你的语气更好地理解事情，而不是依赖表情符号。

> 你在短信方面遇到过多少次麻烦？

简而言之，语音信息提供了两个世界的最佳选择。它像短信一样是异步的，但比基于文本的交流更加情绪化和自发。如果你发送了语音信息，你仍然可以继续使用你的手机，或者做其他事情(你曾经在开车的时候录过语音信息吗？；-)).尽管如此，接收语音信息可能不如发送语音信息方便:通常情况下(尤其是当我们和其他人在一个房间时)，我们无法听到音频，除非我们使用耳机。如果你的屏幕上弹出一条短信，你可以很快判断它是否紧急。如果你仅有的线索是一张模糊的声波图，你不知道这条信息是需要你马上注意，还是可以等到你有空的时候。思考语音相对于文本的缺点，我们不应该忘记坐在或站在或走在我们附近的人对我们的聊天不感兴趣，我们应该注意环境，在更合适的时候使用基于文本的交流。最后，正如图片标题中提到的，总是考虑到听众，尊重他们的时间。语音信息往往比文本信息更冗长，原因很简单，因为说话比在小键盘上打字花费的时间更少。

# 聊天机器人 vs 语音机器人:无法解决的困境

真的是无法解决的困境吗？我觉得不是。为什么？因为答案往往在我们需要实现的用例中。不要为您想要使用的技术寻找用例——选择正确的技术来解决真实的用例。我见过铺天盖地、混乱不堪的移动应用程序，它们本应该是易于导航的网络应用程序和机器人对话界面，而不是漂亮、可视化的移动应用程序。恐怕语音机器人和聊天机器人也有类似的趋势。前者越来越受欢迎，公司正在投入大量资金将传统的交互式语音响应系统迁移到对话式联络中心。

让我们深入了解这两种对话界面的优势。

## 什么时候应该考虑语音机器人？

有了语音机器人，你只需对着它说话就可以和人工智能交流。语音机器人是所有人口统计和年龄组的人的理想选择。易用性使得即使那些不是特别懂技术的人也能很容易地使用这个机器人，并且仍然有很好的体验。语音机器人的工作方式就像通过电话与人交谈，就像在电话上拨号一样。与聊天机器人不同，语音机器人不需要消息平台，也不需要与公司网站或移动应用程序集成。从客户体验的角度来看，这就像拿起电话，拨一个号码并与人工代理交谈一样简单。声音可以成为取悦顾客的策略。当人们听到一个声音时，他们会立即对说话者的性别、年龄、社会地位、情绪状态、出生地以及性格特征(如热情、自信、聪明等)做出假设。人们也不由自主地用虚拟助手来做这件事。在为他们的虚拟代理人创造一个“角色”时，公司可以雇佣专业的配音演员，并通过试音来选择最佳的声音。为什么？因为录制的声音比合成的声音更自然、更有表现力、更人性化。它可以传达幽默、讽刺、信任，并最终将虚拟助理变成对话伙伴。最后，但肯定不是最不重要的，语音是视障或盲人的辅助技术。一般来说，当人们的手或眼睛被占用时，或者当他们在移动时，声音可以帮助他们。当我们提着购物袋或开车或忙着做饭时，在这些或类似的情况下，我们都会经历某种障碍，声音就成了最好的沟通渠道。

## 什么时候应该考虑聊天机器人？

语音是一种强大的方法，但它并不总是每个用例的正确选择。例如，它可以很好地完成查找餐馆营业时间的任务，但浏览晚餐菜单时感觉很笨拙。当与用户的交互很简短，只有很少的来回对话时，语音是正确的方法。另一方面，聊天机器人非常适合处理复杂的聊天流程。它是非线性用户旅程的理想选择，聊天机器人会显示许多不需要记住的选项。聊天机器人通过用户友好的界面简化了复杂的用例。回到前面的例子，航班搜索的结果可以在聊天对话中显示为一个项目列表，零售聊天机器人可以通过图像转盘向用户显示最后的黑色礼服库存。FAQ 机器人通常为用户提供电话号码、电子邮件地址、URL，最终用户可能需要浏览网站才能完成任务。在这种情况下，他们可能需要回顾聊天机器人和语音机器人发送的消息，因为其短暂的特性(正如这篇博客的标题所示)根本无法做到这一点。避免很长的回复，如果你无法控制(例如，FAQ 机器人提供大量信息)，那么选择聊天机器人。此外，聊天机器人支持定制的丰富信息响应类型，如按钮、折叠面板、建议芯片、视听媒体，如图片、视频、gif 等。这些功能的结合可以使体验更丰富，更具吸引力，相反，语音机器人仅限于基于音频的媒体。为了确定语音机器人是否是你的用例的正确策略，考虑一下你的用户是否会对谈论或输入某些话题感到舒服。口语对话最好在私人空间或熟悉的共享空间进行。书面对话最适合个人设备。

总而言之，这个问题没有放之四海而皆准的答案。如果你想知道聊天机器人和语音机器人哪个更好，这取决于什么对你的客户最有效，以及你打算解决的问题类型。找到业务最佳点的一个好方法是找到业务目标和用户目标之间的重叠部分。其他考虑因素包括参与程度、要传输的信息量、可以使用的媒体类型以及用户的旅程是线性还是非线性的。我的建议是回顾下面的陈述,首先确定对话设计是否是你的特征的正确策略。如果您正在检查它们中的大多数，那么 dialog 可能是一个很好的选择。如果对话是正确的选择，那么请仔细考虑语音是否能为您的用例增加价值。

# 幻想曲:Dialogflow Messenger 和 BigQuery 的实验

现在打开这个[页面](https://20220321t113831-dot-diaologflow-cx-playground.uc.r.appspot.com/)，点击右下角的蓝色聊天图标，试试吧！

在深入技术细节之前，让我后退一步，给你一些背景知识。前一段时间，Ivan 和我需要收集一些数据来训练一个 ML 模型，以预测帮助台问题的解决时间，而不是使用 GitHub 上现有的数据集。顺便帮你自己一个忙，读一读 Ivan 写的这篇伟大的[文章](/google-cloud/boost-up-a-helpdesk-chatbot-with-dialogflow-cx-tfx-and-vertex-ai-4999c26eef13)来了解整个想法。

我认为产生随机数据的一个好方法是通过聊天机器人，它向用户提供一组问题，并将答案写入一个 BigQuery 表中，该表具有与帮助台问题数据集相同的模式。我还必须选择一个让人们与之互动的渠道。渠道意味着允许你的用户与机器人互动的平台，这在很大程度上取决于他们是谁以及他们的需求。尝试回答如下问题:

*   谁是我的用户？
*   他们的需求是什么？
*   他们今天是如何完成这些任务的？
*   他们用什么词和短语来谈论这些任务？
*   什么情况或环境触发了这些任务？

虽然为最频繁的用户进行优化很重要，但不要以牺牲其他用户的体验为代价。一个设计良好的产品是包容的，普遍可及的。为不同人群设计意味着利用*包容性设计*或*通用设计策略*。你最终选择的渠道应该尽可能的全面。

回到我的小聊天机器人，我决定使用 Dialogflow Messenger，并将其嵌入到 App Engine 中托管的简单页面中。Dialogflow CX 支持许多内置的基于文本的集成，并通过 Dialogflow 控制台(如 Facebook Messenger)进行配置。Dialogflow Messenger 集成为您的代理提供了一个可定制的聊天对话框，可以嵌入到您的网站中。如果你玩过“Fantagent ”,你会注意到聊天对话框是作为一个出现在屏幕右下角的对话窗口来实现的。

![](img/4927837813450425b5ddf44f947bc346.png)

给它聊一聊！

您可以自定义聊天对话框显示和行为的各个方面。HTML 元素有很多属性，比如聊天标题和当聊天对话框打开时触发的第一个初始意图(比如上面显示的问候消息)。

![](img/2591164674f833e7316caa5c9b657847.png)

HTML 元素`<script>`和`<df-messenger>`应该在页面的`<body>`元素中

如果你真的走到了对话的最后，你会看到一个小部件显示所有可能的类别，并让用户选择一个。

![](img/dc412a84f8143313a47a3f374d53c3f2.png)

列表响应类型是一张卡片，用户可以从中选择多个选项。

这个小部件是一个[列表响应类型](https://cloud.google.com/dialogflow/cx/docs/concept/integration/dialogflow-messenger#list_response_type)，一个用户可以从中选择多个选项的卡片。当创建[履行](https://cloud.google.com/dialogflow/cx/docs/concept/fulfillment)时，你可以创建**文本响应**和**自定义有效载荷**。文本响应用于基本的代理响应，自定义有效负载用于丰富的响应。自定义有效负载可以从 webhook 返回(作为 webhook 响应的一部分)用于动态响应，也可以在通过控制台设计代理时在页面的实现部分进行配置。请参见下面的自定义有效负载代码。当用户点击列表中的一个选项时，一个[自定义事件](https://cloud.google.com/dialogflow/cx/docs/concept/handler#event)被触发，这允许我识别用户的选择。

```
{
  "richContent": [
    [
      {
        "type": "list",
        "event": {
          "languageCode": "",
          "parameters": {},
          "name": "Authentication"
        },
        "subtitle": "If you can't login or you're having issues signing in",
        "title": "Authentication"
      },
      {
        "type": "divider"
      },
      {
        "type": "list",
        "title": "Billing",
        "event": {
          "name": "Billing",
          "parameters": {},
          "languageCode": ""
        },
        "subtitle": "If you have a billing enquiry"
      },
      {
        "type": "list",
        "title": "Performance",
        "event": {
          "parameters": {},
          "languageCode": "",
          "name": "Performance"
        },
        "subtitle": "If you've seen a degradation of performance"
      },
      {
        "type": "list",
        "subtitle": "For any technical issues",
        "title": "Technical",
        "event": {
          "languageCode": "",
          "name": "Technical",
          "parameters": {}
        }
      }
    ]
  ]
}
```

一旦收集了所有的值，就会对云函数进行 webhook 调用，通过 [Google BigQuery Node.js 客户端 API](https://cloud.google.com/nodejs/docs/reference/bigquery/latest) 将记录写入 BigQuery 表。我强烈建议您查看 Node.js 的这个伟大的 Google BigQuery 客户端[库](https://github.com/googleapis/nodejs-bigquery),其中包含许多示例，包括 insertRowsAsStream()函数，我使用该函数将从 bot 传递到 Cloud 函数的数据写入专用的 BigQuery 表。

![](img/eb52c5aa420e6afdcb1bb65b51d15c0b.png)

# 结论

对话设计是一种强大的方法，但它并不适合所有的用例。在你确定对话界面是合适的之后，仔细考虑参与的渠道。良好的对话设计流程始于收集需求。收集对话体验的需求不仅仅是定义特性和功能，尽管这是主要的结果。从清晰、充分研究的需求开始是避免在设计和/或开发完成后需要重大变更的最佳方式。

谢谢你从头到尾阅读，直到我的下一篇文章！