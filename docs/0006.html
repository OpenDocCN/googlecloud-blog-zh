<html>
<head>
<title>How to move a VM instance between projects on Google Cloud Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Google云平台上的项目间移动虚拟机实例</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-move-a-vm-instance-between-projects-on-google-cloud-platform-39d1690c73a?source=collection_archive---------1-----------------------#2015-05-20">https://medium.com/google-cloud/how-to-move-a-vm-instance-between-projects-on-google-cloud-platform-39d1690c73a?source=collection_archive---------1-----------------------#2015-05-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4a8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">目前还没有一个命令行命令可以在Google云平台项目之间移动Linux VM实例，但是我已经创建了一个易于遵循的分步指南，您可以使用。(注意:本指南不包括Windows。)</p><h2 id="da47" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">所需步骤的快速总结</h2><ul class=""><li id="9fa1" class="jy jz hi ih b ii ka im kb iq kc iu kd iy ke jc kf kg kh ki bi translated">通过取消选择“删除实例时删除引导磁盘”并终止虚拟机，将引导磁盘与要移动的虚拟机分离</li><li id="67f4" class="jy jz hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">从分离的引导磁盘创建映像</li><li id="d955" class="jy jz hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">将图像上传到Google云存储，并与新项目共享</li><li id="20e9" class="jy jz hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">基于您上传到Google云存储的图像，在新项目下创建一个自定义图像</li><li id="4997" class="jy jz hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">基于自定义映像在新项目下创建一个新的虚拟机实例</li></ul></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h2 id="20e2" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">在项目间移动虚拟机的详细步骤</h2><p id="259a" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated"><strong class="ih hj">取消选择启动盘删除(重要！)</strong>并终止您想要移动的虚拟机(我建议在终止前正常关闭)</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ky"><img src="../Images/c994edf49f2970659d407326f2e74343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OCupCo4W1X--D3ofpvbofg.png"/></div></div></figure><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es lk"><img src="../Images/71e057ae8122f60eca76db3889113845.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*qLOKr8ep5uIjKg8E527DaA.png"/></div></figure><p id="3d9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在与终止的虚拟机中的磁盘相同的区域中创建一个临时磁盘。使其足够大，以适合您的虚拟机映像(使用至少两倍于您的虚拟机的永久磁盘大小——越大意味着越快)</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ll"><img src="../Images/8d54ac72c233d43bd72c56a86b2409e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AS_0r6maTh3XHqiq5AzW2A.png"/></div></div></figure><p id="89fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在旧项目下创建一个对Google云存储具有完全访问权限的VM实例。使用临时和终止的虚拟机磁盘所在的同一区域。暂时不要连接临时和终止的虚拟机磁盘。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es lm"><img src="../Images/d357b75b991269f42390e1431516760b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bURrw4cvjkYyGIIOyry6xA.png"/></div></div></figure><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ln"><img src="../Images/31fe234864d1b7e1ab8acbc58c5966f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*--3ruSGil41jMPpb57j2Ow.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">选择对存储的完全访问权限</figcaption></figure><p id="10c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将临时磁盘和磁盘从终止的虚拟机连接到我们刚刚为映像准备创建的正在运行的虚拟机。这将在引导后连接磁盘，并避免引导复杂化。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ls"><img src="../Images/3b00e6444525857609ec4715fd1c14dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YBS-Wd2TGKxg07YHmmI8Ng.png"/></div></div></figure><p id="d8c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SSH进入准备虚拟机，格式化并装载临时磁盘</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es lt"><img src="../Images/fb8fc9c5110cfe5bc4ef791c5a3400ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sHmXV161rTmx8BEzlltwYg.png"/></div></div></figure><pre class="kz la lb lc fd lu lv lw lx aw ly bi"><span id="700e" class="jd je hi lv b fi lz ma l mb mc">$ /usr/share/google/safe_format_and_mount -m "mkfs.ext4 -F" /dev/sdb /mnt/temp<br/>$ cd /mnt/temp</span></pre><p id="33a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<a class="ae md" href="https://github.com/GoogleCloudPlatform/compute-image-packages" rel="noopener ugc nofollow" target="_blank"> <em class="me"> gcimagebundle </em> </a>从您终止的虚拟机创建引导磁盘的压缩映像。一旦完成，就用<em class="me"> gsutil将它上传到Google云存储的一个桶中。</em>跳到下一步，了解如何在Google云存储中为上传创建存储桶。</p><pre class="kz la lb lc fd lu lv lw lx aw ly bi"><span id="7e72" class="jd je hi lv b fi lz ma l mb mc">$ cd /mnt/temp<br/>$ sudo gcimagebundle -d /dev/sdc -r /mnt/old-vm-disk -o /mnt/temp/ --log_file=/mnt/temp/image-create.log<br/>&gt; Created tar.gz file at /mnt/temp/62a70588477be42caf45c5c5c58a7e59a8aa410e.image.tar.gz<br/>$ gsutil cp 62a70588477be42caf45c5c5c58a7e59a8aa410e.image.tar.gz gs://vm-transfer<br/>&gt; Uploading   ...588477be42caf45c5c5c58a7e59a8aa410e.image.tar.gz: 235.73 MiB/235.73 MiB</span></pre><p id="5621" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当<em class="me"> gcimagebundle </em>运行时，在运行预备虚拟机的旧项目中创建一个Google云存储桶</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es mf"><img src="../Images/d251115fe176dd1e4dac99029b43ac0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yya0zuGfIhMN3eEPWQJ_Iw.png"/></div></div></figure><p id="d3e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过将您的电子邮件添加到对象权限，使您可以在新项目中访问Google云存储对象</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es mg"><img src="../Images/54bd4105765fb4412a8ae4c24ec6ead8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2oiEXCcj9DoaLj_N_EA8Qg.png"/></div></div></figure><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es mh"><img src="../Images/0a5afd808e5e6316ccd6e62342024736.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cDqO3_5fmWYknRhgeTHyIw.png"/></div></div></figure><p id="56bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在您的新项目中从Google云存储对象创建一个自定义图像</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es mi"><img src="../Images/9ad5bfc19136e3e1a6bee79ea226148d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ATZUNhn2NWSCr_vG9WCpIw.png"/></div></div></figure><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es lm"><img src="../Images/9fa3d7d758ac2c8cfb4cbf897b487b7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l1azedT5luaO9jNDXzNxjg.png"/></div></div></figure><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es mj"><img src="../Images/6ea62c956f689307d24dfda502d3ae22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SMdkEyviGLjNzt8Xavo84A.png"/></div></div></figure><p id="9111" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从您的自定义映像创建一个虚拟机实例，瞧！☺</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es mh"><img src="../Images/5086cbea59c843e6fba5f61c4792e8ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ong7eVmzdvjok8IiXkQnUg.png"/></div></div></figure><p id="fec5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后但同样重要的是，清理所有你不再需要的资源。一旦您确认您的虚拟机迁移成功，您就可以删除临时磁盘、已终止虚拟机中的磁盘、准备虚拟机以及旧项目中Google云存储中的存储桶。</p><p id="ce2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇博文使用了来自<a class="ae md" href="https://cloud.google.com/compute/docs/images#export_an_image_to_google_cloud_storage" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/compute/docs/images # export _ an _ image _ to _ Google _ cloud _ storage</a>的信息</p></div></div>    
</body>
</html>