<html>
<head>
<title>From Zero to Hero: End-to-end automated Analytics workload using Cloud Functions — Data Fusion — BigQuery and Data Studio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从零到英雄:使用云功能的端到端自动化分析工作负载—数据融合— BigQuery和Data Studio</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/from-zero-to-hero-end-to-end-automated-analytics-workload-using-cloud-functions-data-fusion-28670e5e7c74?source=collection_archive---------1-----------------------#2021-07-27">https://medium.com/google-cloud/from-zero-to-hero-end-to-end-automated-analytics-workload-using-cloud-functions-data-fusion-28670e5e7c74?source=collection_archive---------1-----------------------#2021-07-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/5713659369558b6b240956174db54d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lpZF065YsqoBdGTF"/></div></div></figure><h1 id="925e" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">总结:</h1><p id="64dc" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在本文中，我们将演示如何使用谷歌云平台运行自动化的端到端数据加载、转换和可视化流程。在本练习的最后，每次新的数据文件上传到Google云存储桶时，云数据融合管道的执行将通过云函数自动触发，然后该数据管道将对数据执行一些转换，并将结果加载到BigQuery表中，该表提供了一个报告，其中包含在Data Studio中创建的一些可视化结果。</p><h1 id="45c7" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">简介:</h1><p id="2f26" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">对于希望开始利用数据和分析工作负载，通过云快速实现业务价值，而无需进行大规模数据库/数据仓库迁移(这很容易从几周至几个月不等)的企业来说，一个非常常见的使用案例是快速设置自动化数据转换管道，并将其接收到数据分析仓库，从中生成一些简单且经济高效的新报告和/或可视化。</p><p id="3b16" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">本文提供了一个详细的解决方案，利用谷歌云平台进行数据存储、处理和分析。</p><h1 id="7854" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">用于解决方案的GCP服务:</h1><ul class=""><li id="0fb7" class="kr ks hi jq b jr js jv jw jz kt kd ku kh kv kl kw kx ky kz bi translated">谷歌云存储。</li><li id="9058" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">谷歌云功能。</li><li id="c146" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">谷歌云数据融合。</li><li id="c727" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">谷歌BigQuery。</li><li id="ee33" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">谷歌数据工作室。</li></ul><h1 id="9261" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">我们将在本练习中实施的解决方案的描述:</h1><p id="37b0" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我们的想法是在Data Studio中创建一个非常简单的报告，该报告来自之前在BigQuery中创建和加载的一个表。源数据驻留在单个累积CSV文件中，在加载到BigQuery之前需要进行一些转换，因此Data Fusion中的数据转换管道处理文件上所需的转换，并通过首先截断BigQuery表来将结果吸收到BigQuery表中(尽管在Data Fusion管道中更改了一个标志，您可以将其修改为在big query表中追加数据，而不是每次运行都截断该表)。源文件会不断更新，并以按需方式每天多次上传到Google云存储，我们不知道新文件何时到达，但我们知道我们需要用新数据来刷新报告，因此我们使用云功能在新CSV文件上传到云存储桶时触发数据融合管道。通过这种方式，只需将新的数据文件上传到Google云存储桶，就可以触发数据摄取、转换、加载和可视化的整个过程。</p><h1 id="0248" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">主要步骤:</h1><ol class=""><li id="1c04" class="kr ks hi jq b jr js jv jw jz kt kd ku kh kv kl lf kx ky kz bi translated">创建我们将使用的存储桶，并准备用于创建转换管道的源CSV文件。</li><li id="7248" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl lf kx ky kz bi translated">在BigQuery中创建数据集和表，用于存储CSV文件中的数据。</li><li id="1425" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl lf kx ky kz bi translated">创建数据融合实例，并为它将使用的服务帐户分配适当的角色。</li><li id="9cef" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl lf kx ky kz bi translated">在数据融合实例中，创建数据管道来处理新的CSV文件，并将它们接收到BigQuery表中。</li><li id="f43f" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl lf kx ky kz bi translated">创建云函数，当新文件上传到定义的存储桶时将触发该云函数，并将新添加的文件传递到数据融合管道进行处理并摄取到BigQuery。</li><li id="c77a" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl lf kx ky kz bi translated">在Data Studio中创建一个简单的报表，并在BigQuery中显示一些数据。</li></ol><h1 id="db9e" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">先决条件:</h1><ul class=""><li id="db8a" class="kr ks hi jq b jr js jv jw jz kt kd ku kh kv kl kw kx ky kz bi translated">一个GCP项目，具有关联的开单帐户，并且至少有一个用户对该项目具有项目编辑职责。在本练习中，我们创建了一个名为“simplecsvbqload”的项目。</li><li id="5f8b" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">启用项目所需的API:</li><li id="c493" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">云构建</li><li id="510e" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">云函数</li><li id="a5df" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">云数据融合</li></ul></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><h1 id="7dcc" class="iq ir hi bd is it ln iv iw ix lo iz ja jb lp jd je jf lq jh ji jj lr jl jm jn bi translated">步骤:</h1><h1 id="9bdd" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">1.创建将用于数据处理的存储桶:</h1><p id="9d81" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">使用云外壳，在云存储中创建以下存储桶。您可以随意命名它们，它们只需要是唯一的，您将需要在以后的步骤<strong class="jq hj">中提供这些名称(记住用您自己的存储桶名称替换括号[]中的存储桶名称):</strong></p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="aadd" class="mb ir hi lx b fi mc md l me mf">gsutil mb gs://<strong class="lx hj">[YOUR_DATA_SOURCE_BUCKET]</strong></span></pre><p id="7210" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">要上传到GCP的原始CSV源文件的存储桶(上传到该存储桶的文件将触发数据转换和数据加载过程，在编写云函数时将使用该存储桶作为函数的触发事件)。</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="d8ab" class="mb ir hi lx b fi mc md l me mf">gsutil mb gs://<strong class="lx hj">[YOUR_CDAP_TEMP_BUCKET]</strong></span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/cd46a9b5094c1e45981fcabf1acbdc7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E3k0yTLf0r25eyze"/></div></div></figure><p id="b6cf" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">将数据插入BigQuery时，数据融合管道将用作临时存储的暂存桶。</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="f888" class="mb ir hi lx b fi mc md l me mf">gsutil mb gs://<strong class="lx hj">[YOUR_CDAP_ERRORS_BUCKET]</strong></span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es mh"><img src="../Images/c1dd59201bec1b5109d80662f0187b1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/0*SjX9Y1GR2hQ2HK6b"/></div></figure><p id="904e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">将保存云数据融合管道中数据处理期间任何错误的输出的存储桶。</p><p id="342e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">最后，我们将上传一个包含数据子集的示例CSV文件，以便在稍后使用数据融合构建数据管道时，更容易使用Wrangler导出数据结构和模式。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/53d3e50e359c4482fce039858fc2f87c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*NG0Kisl7Cs6k4DB42x06XQ.png"/></div></div></figure><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="caab" class="mb ir hi lx b fi mc md l me mf">gsutil cp SampleFile.csv gs://<strong class="lx hj">[YOUR_DATA_SOURCE_BUCKET]</strong></span></pre><p id="be0f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">正如在上面的数据预览中所看到的，将提供给流程的源文件具有以下模式:</p><ul class=""><li id="1b09" class="kr ks hi jq b jr km jv kn jz mj kd mk kh ml kl kw kx ky kz bi translated">id:龙</li><li id="02fa" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">状态代码:长型</li><li id="e859" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">发票编号:Long</li><li id="786c" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">item_category:字符串</li><li id="2e94" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">频道:字符串</li><li id="bae5" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">订单日期:日期时间</li><li id="4d38" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">交付日期:日期时间</li><li id="e159" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">金额:浮动</li></ul><p id="4cb9" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在将数据插入BigQuery之前，需要进行一些更改，数据集中的日期列采用了<strong class="jq hj"> dd-MM-yyyy H:mm </strong>的格式，需要解析为<strong class="jq hj"> yyyy-MM-dd hh:mm </strong>以便BigQuery正确插入它们，此外，在float列中，小数分隔符是逗号而不是点，我们还需要替换它，以便能够在BigQuery中以float数据类型插入数字。我们将在稍后的数据融合管道中执行所有这些转换。</p></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><h1 id="ae09" class="iq ir hi bd is it ln iv iw ix lo iz ja jb lp jd je jf lq jh ji jj lr jl jm jn bi translated">2.在BigQuery中创建数据集和表:</h1><p id="6f7d" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">如前一节所述，我们将使用模式作为在BigQuery中创建保存数据的表的输入。</p><p id="a263" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">导航到BigQuery服务，在您的项目中创建一个新的数据集，为了简单起见，我将其命名为<strong class="jq hj"> dataset1 : </strong></p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/cdad0796f1f68b8a3ca04673d083cc67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A_FuvNPpAcryeiDH"/></div></div></figure><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es mn"><img src="../Images/e7b9f520784c0e8e25969e23eda4800e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/0*kuYstVViX2mHagKM"/></div></figure><p id="3498" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">然后，在新创建的数据集中，我只创建了一个简单的空表，并将其命名为<strong class="jq hj"> table1 </strong>，其列名与源CSV文件相同，并包含相应的数据类型。所以看起来是这样的:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f003ec76ad5bc521bf875a1e32e197fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cGrMiMpEN7AuFA_0"/></div></div></figure></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><h1 id="ef3b" class="iq ir hi bd is it ln iv iw ix lo iz ja jb lp jd je jf lq jh ji jj lr jl jm jn bi translated">3.创建数据融合实例:</h1><p id="7591" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">如果您尚未启用云数据融合API，请启用它:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/15d063792fdc7628296e5ae287a51d3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5pbT_ZyiF50gEir8"/></div></div></figure><p id="1cf3" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">启用API后，导航到左侧菜单中的数据融合，然后单击创建实例:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/b779e9e7f17428ef70da9756137d1a47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ko-TCUIvu6Pfrz3q"/></div></div></figure><p id="bf25" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">用你喜欢的任何名字命名你的实例，我把它命名为<strong class="jq hj"> cdf-test-instance </strong>。</p><p id="d1c0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">数据融合利用云Dataproc作为其底层大数据处理引擎，这意味着当执行数据管道时，数据融合会产生一个短暂的Dataproc集群来为您执行数据处理，并将管道处理作为spark作业提交给Dataproc集群，一旦作业执行完毕，数据融合会为您删除Dataproc集群。确保向Data Fusion使用的服务帐户授予适当的权限，以生成云Dataproc集群，它将提示您对其进行授权，当授权完成时，单击授予权限按钮<strong class="jq hj">(还要记住部署Data Fusion实例的地区，需要与创建BigQuery数据集的地区相匹配)</strong>:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es mq"><img src="../Images/c16cdbd40bd83aa77e0dcd619cdd7b40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/0*5VLmYxbDoYfDepZm"/></div></figure><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es mr"><img src="../Images/3e729d8709e63696e3294fb7e3656f21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/0*L8MZPtAUZQkPvZlT"/></div></figure><p id="dae0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">单击CREATE按钮，创建实例将需要几分钟时间。</p><p id="aedf" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">创建数据融合实例后，复制数据融合正在使用的服务帐户，并通过导航到IAM并单击+ADD按钮授予其<strong class="jq hj">“云数据融合API服务代理”</strong>角色，将该角色分配给数据融合服务帐户后，数据融合可以访问来自/去往云存储、BigQuery和Dataproc等其他服务的数据:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ms"><img src="../Images/666da06112c71528951cbd2e7dac7f90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*piOLXgCxHM5IaZIM"/></div></div></figure><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es mt"><img src="../Images/470a5c805595920d4f1667a6ce8fe151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*glCI8CyAjDfZlEkp"/></div></figure><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es mu"><img src="../Images/a4ee8eba3a3b195899feda4834a5dd35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/0*jXNO1ADCRGBlKMwt"/></div></figure><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/523f4208fe738fd27736817836463987.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IEuLFEcTDoUvlpol"/></div></div></figure><p id="c2c4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">既然创建了实例，并且我们确保了Data Fusion使用的服务帐户具有所需的权限，我们就可以创建数据转换管道了，该管道将接受CSV源文件，对其执行一些转换，并将数据加载到我们之前创建的BigQuery中的表中。</p></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><h1 id="0ace" class="iq ir hi bd is it ln iv iw ix lo iz ja jb lp jd je jf lq jh ji jj lr jl jm jn bi translated">4.在数据融合中创建数据管道</h1><p id="fcd8" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在数据融合部分，您将看到数据融合实例，单击<strong class="jq hj">视图实例</strong>链接以访问数据融合UI:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mv"><img src="../Images/dac18d050abd322108dad7beec6f307a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*t2x8kCWOnSCrhq5x"/></div></div></figure><p id="e91c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">数据融合用户界面将在浏览器的另一个选项卡中打开:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mw"><img src="../Images/69fb3018790682dc2418b5c75cee2348.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MlpFoCoQTpQQijsY"/></div></div></figure><p id="32ee" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果您不熟悉数据融合，可以单击“开始浏览”按钮来了解并熟悉它。出于本练习的目的，我们现在跳过它，单击<strong class="jq hj">不，谢谢</strong>按钮。</p><p id="789d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">为了清晰起见，我们将从头开始设计管道，因此单击<strong class="jq hj">集成</strong>卡下的工作室链接</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/3ef3a26040e72f661da446c8261da9bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*d85LI5ZqzBeobcFu"/></div></div></figure><p id="8740" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">您将被重定向到studio页面，首先，在屏幕顶部中间给管道取一个有意义的名称<strong class="jq hj">(稍后您将需要在云函数python脚本中引用管道名称，当云函数引用它来开始执行时):</strong></p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/ac476418bf249161389fe02d47938970.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rwdexQ1sAujnDjzW"/></div></div></figure><p id="a4f2" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">接下来，我们将读取示例CSV文件，我们将整个文件传递到下一阶段，并在接下来的步骤中解析CSV。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mz"><img src="../Images/1ac0b2417cf0327979616783f4424a23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-tcfHhQZktVT0snI"/></div></div></figure><p id="ee06" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">将鼠标悬停在绿色GCS框上，当您单击左侧菜单上的GCS图标时，该框被添加到画布中。将出现一个“属性”按钮，单击此按钮。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es na"><img src="../Images/48d111ca1e7c796923afa6c4d5489735.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MbAQOhj6Du2VzRx6"/></div></div></figure><p id="4a48" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在GCS源组件的属性页中，将“Path”属性设置为:GS://[YOUR _ DATA _ SOURCE _ BUCKET]/<strong class="jq hj">$ { FileName }</strong></p><p id="67ff" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">其中＄{ FileName }充当将在执行时传递给管道的运行时参数变量(我们稍后将把该变量定义为管道元数据的一部分)。</p><p id="0086" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在右侧的<strong class="jq hj">输出模式</strong>部分，删除<strong class="jq hj">偏移量</strong>字段，这样它就不会被传递到管道的下一步，只有文本的<strong class="jq hj">正文</strong>会被传递到我们将在管道的下一步中设置的数据牧马人组件。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nb"><img src="../Images/8f057ffb86dae0513f670ef370010983.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/0*y3dbb_BHq8xIInyc"/></div></figure><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8fbce9dd3364f4849575abbe6244751c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gGm4tUYwce_bhXT3"/></div></div></figure><p id="c9a8" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">接下来，我们将向画布添加一个牧马人操作，我们将在其中执行步骤1中提到的转换和解析。为此，向左展开变换菜单，并单击牧马人工具。它将被添加到画布上，如下图的蓝框所示:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nc"><img src="../Images/92f989dbf594102724305bc04deec2b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Fa_AS7gkbCtH848w"/></div></div></figure><p id="fead" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，我们需要将CSV文件读取的输出连接到wrangler，如下所示。然后，将鼠标悬停在牧马人上，点击出现的属性按钮，访问牧马人属性:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nd"><img src="../Images/6de284fefe4dec3cfe77a06844aac57f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k0M75KksxNUowJrC"/></div></div></figure><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/5c9e83c0bf39b42ea628f4d58da467ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WURoM6WCG_3B59Zi"/></div></div></figure><p id="ab21" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在这里，您可以将您喜欢的任何名称添加到标签中，现在，我们将保留所有内容的默认设置，但是我们会将错误处理行为从默认的“跳过错误”更改为“发送到错误端口”,以便我们可以在管道执行期间将错误重定向到GCS中的一个文件，供以后进一步处理。我们可以使用jexl语法(<a class="ae ne" href="https://commons.apache.org/proper/commons-jexl/reference/syntax.html" rel="noopener ugc nofollow" target="_blank">https://commons . Apache . org/proper/commons-JEXL/reference/syntax . html</a>)通过指令直接编写转换的方法，但是为了简单起见，并且为了利用数据融合UI，我们将使用wrangler工具来完成，我们在wrangler中所做的任何事情稍后都将被转换为JEXL指令并显示在此处的recipe下。点击指令部分下方的<strong class="jq hj">争论</strong>按钮。</p><p id="b5dc" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，将SampleFile.csv文件上传到步骤1中创建的源数据存储桶将派上用场，在打开的GCS浏览器中，导航到[YOUR_DATA_SOURCE_BUCKET]并选择您在步骤1中上传的文件。通过向牧马人提供数据文件的样本，我们允许牧马人直观地推断数据结构并执行数据牧马人任务。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nf"><img src="../Images/6795fe8ca3ee46f543fde90719732b68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/0*4hmZrN_I5AG_4J8Q"/></div></figure><p id="536b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">文件内容将显示在左侧，将从wrangler中输出的列显示在右侧部分。到目前为止，wrangler将文件中的每一行都作为名为“body”的单个字段读取，并按原样输出。我们现在开始转换:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es ng"><img src="../Images/32cc364b28e57d321f3e701ce37f0cd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/0*cwpHbKi2_wdWZV55"/></div></figure><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nh"><img src="../Images/9a606c4fe3aaf5b84ba7a77d52e41acf.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/0*AqtP5Out8Cu9-fRj"/></div><figcaption class="ni nj et er es nk nl bd b be z dx translated">牧马人的默认输出</figcaption></figure><p id="3213" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">首先，我们将让wrangler将文件解析为分号分隔的CSV文件。单击列名<strong class="jq hj"> (body) </strong>左侧向下的小箭头，选择parse→ CSV选项。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nm"><img src="../Images/41b44d8ab8d9a750cc58e103c5942ad5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/0*Dx2s4kYWqdoDCGod"/></div></figure><p id="5bd9" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">因为CSV文件中的列用分号(；)，我们在弹出的窗口中选择自定义分隔符并在那里插入分号，我们还<strong class="jq hj">检查标志以将第一行视为标题</strong>，然后单击<strong class="jq hj">应用:</strong></p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nn"><img src="../Images/42fcc5c1ac79cdb8d4681d2202360993.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IGujuIl2oj21Wohk"/></div></div></figure><p id="49c4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，wrangler已经分离了文件中的所有输入字段，并为每个字段创建了一个列，如右侧的输出列列表所示，它将正文输入作为一个单独的列，但我们不需要它，因此我们将删除它，方法是像以前一样选择它，然后选择“删除列”选项:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es no"><img src="../Images/37eb463ae9acb3670fb259febd864652.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J0fpSqzJJt-jD8ceknbdsA.png"/></div></div></figure><p id="72eb" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们现在可以开始解析和转换将数据接收到BigQuery表中。</p><p id="b21e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">默认情况下，由于这是一个CSV文件，数据融合将所有输入视为字符串，我们需要更改它以正确插入数据。我们将使用列上箭头菜单中的Change Data Type选项，将数据类型设置为与我们在步骤2中定义BigQuery表中的列的方式相兼容的类型。</p><p id="24b3" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">首先，按照同样的过程，我们将把字段<strong class="jq hj"> id、状态代码</strong>和<strong class="jq hj">发票编号</strong>的数据类型更改为<strong class="jq hj"> Long </strong>，这样它们就可以插入到BigQuery表中:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es np"><img src="../Images/9fa4feb95f7b854af62749d9b8b39ab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Cxv3NpRMU_P1hpyz"/></div></div></figure><p id="3d07" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">接下来，在将数据类型更改为float之前，我们将在<strong class="jq hj"> amount </strong>字段中用点替换逗号，以便它可以作为float值轻松地插入到BigQuery中，并且逗号不会被误解为千位分隔符(这是由于在非英语国家中，点被用作千位分隔符而不是逗号，逗号被用作小数分隔符)。为此，我们将使用<strong class="jq hj">查找和替换</strong>功能，在旧值字段中填入逗号，在新值字段中填入圆点，然后点击<strong class="jq hj">全部替换</strong>按钮:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nq"><img src="../Images/6a78bfc78ede8f5020d73a99ceb98bb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/0*sbGG2ycZtKSJW82M"/></div></div></figure><p id="ba8f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们现在可以将字段的数据类型改为float。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nq"><img src="../Images/138de5421f2b82399fce496046724e36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/0*3mNFO2nvloKxAkLQ"/></div></figure><p id="df7b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，我们将解析<strong class="jq hj"> order_date </strong>字段，以便可以将它作为Datetime类型正确地插入到BigQuery中。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nr"><img src="../Images/99f49b13d69c1de1666a6e2d37b008ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/0*ulhiz_v7bEjWJUdj"/></div></figure><p id="783d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如前所述，我们将不得不使用自定义格式，因为输入日期的格式是dd-MM-yyyy H:mm，所以选择“自定义格式”选项，在文本字段中提供格式，然后单击<strong class="jq hj">应用</strong>。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es ns"><img src="../Images/200abca76bda96dbbf2e9b0de670606d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*jVJmXJkMgPV6d1GE"/></div></figure><p id="3cee" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">接下来，我们将使用“Send to error”函数过滤掉<strong class="jq hj">金额</strong>为0的行，这些行将被发送到错误文件中，在那里它们可以被进一步检查，并在以后需要时被重新处理(因为我们之前已经将该字段的数据类型更改为float，wrangler自动将输入值从0替换为0.0，因此我们需要相应地将过滤器设置为0.0)。</p><p id="b7d9" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在<strong class="jq hj">金额</strong>栏中选择<strong class="jq hj">发送到错误</strong>转换，将条件设置为“<strong class="jq hj">值为”</strong>，并将值设置为0.0，然后点击<strong class="jq hj">应用:</strong></p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nr"><img src="../Images/2ba2725e0f54299a572d061f49f1164b.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/0*EQCKsDErmaFmfDEA"/></div></figure><p id="b6fe" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">源数据在字段<strong class="jq hj"> delivery_date </strong>中有一些空值，我们还会将这些记录发送到错误端口，以便稍后可以查看。</p><p id="4d6c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在<strong class="jq hj"> delivery_date </strong>列中选择<strong class="jq hj"> Send to error </strong>转换，将条件设置为“<strong class="jq hj">value is empty”</strong>，点击<strong class="jq hj"> Apply: </strong></p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nr"><img src="../Images/dce37463d236d1ab7e7659b542ce85ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/0*x0LJKVEuAk9olCDz"/></div></figure><p id="2d8e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">最后，我们将字段<strong class="jq hj"> delivery_date </strong>解析为datetime，其过程与我们解析<strong class="jq hj"> order_date </strong>字段的过程相同:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nt"><img src="../Images/9892f124b6c038680e6e38446f4d5fa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/0*JMdFKf6Nnrv4yK8_"/></div></figure><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nu"><img src="../Images/c0a70bdd7719f080927223fc1620c770.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/0*9n3ggTaFS1ikJ4R6"/></div></figure><p id="4085" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，我们已经制定了所有转换的方法，在wrangler屏幕的右侧，我们可以看到转换步骤的摘要，如果您愿意，也可以删除这些步骤:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nv"><img src="../Images/877776b88cabb7c67cd5160558e5e829.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/0*LYR75S-RAJkaygfT"/></div></figure><p id="dc49" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">最后，单击右上角的应用按钮，您将返回到牧马人属性页面，在这里您将看到JEXL语法的配方，您还将在右侧看到来自管道中牧马人步骤的输出字段:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nw"><img src="../Images/c9041391b3b9c8df69c8b9305c49bb36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*du3vSurggRVnOFeM"/></div></div></figure><p id="9cdc" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，您可以单击Validate按钮来验证一切正常，准备就绪后，单击按钮旁边的X返回到管道设计画布。</p><p id="ed7e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在我们将处理错误，在画布中，我们将展开左侧菜单中的“错误处理程序和警报”部分，并单击“错误收集器”:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/63e6f6783a22ff1aecb8042bf34dba21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6nKUphTAPQD5s_VQ"/></div></div></figure><p id="35a6" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">然后，我们将从Wrangler中的错误端口拖放一个箭头到错误收集器，以指示和收集来自Wrangler的输出错误，我们不会在Error Collector属性中执行任何进一步的配置。相反，我们将展开左侧菜单中的Sink部分，并单击“GCS”向画布添加一个GCS Writer，我们将向其中写入从ErrorCollector收集的错误的输出:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nx"><img src="../Images/f89ab1bb6724bb08d5288c0bc1828f49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AiIssgSoe3Lzelk9"/></div></div></figure><p id="6d1d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">将箭头从ErrorCollector拖动到GCS编写器，然后将鼠标悬停在新添加的GCS编写器上以访问其属性。这里我们将把<strong class="jq hj">标签</strong>设置为“GCS-WriteErrors”，把<strong class="jq hj">路径</strong>字段设置为在步骤1中创建的<strong class="jq hj"> gs://【你的_ CDAP _ Errors _ BUCKET】</strong>，把<strong class="jq hj">格式</strong>设置为CSV，把<strong class="jq hj">写头</strong>标志设置为True，最后我们将把<strong class="jq hj">输出文件前缀</strong>设置为“ERRORS”。这将向您定义的路径写入一个CSV文件，并在管道执行过程中，针对wrangler产生的每个错误添加一个新行:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ny"><img src="../Images/572bc909c94656913455f0b7cb99e197.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IjOypAGEWka1b-84wNjuJw.png"/></div></div></figure><p id="0f9e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">既然我们已经正确地处理了错误，我们将添加管道中的最后一步，将wrangler的输出接收到BigQuery表中。在左侧菜单的同一个sink部分，单击BigQuery图标，将箭头从wrangler的输出拖到这个新图标上:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nz"><img src="../Images/841024ccc7e73795b01e91b604bbd572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XvV8Cf7xKj9--uUR"/></div></div></figure><p id="f906" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在管道应该是这样的，将鼠标悬停在画布中的BigQuery图标上，并访问其属性来设置管道的最后一部分:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es oa"><img src="../Images/e92e4507db1ab6befe1a2032d5c232e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ofvsg5VlyP_Qj097"/></div></div></figure><p id="45a1" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在BigQuery接收器属性中，我们将设置几个值:</p><p id="1299" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们将把<strong class="jq hj">数据集</strong>和<strong class="jq hj">表</strong>设置为我们在步骤2中在BigQuery中创建的数据集和表。我们将临时存储桶名称设置为<strong class="jq hj">GS://[你的_ TEMP _临时存储桶] </strong></p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ob"><img src="../Images/aac2de2511f725637b83e170f4027f05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3bz2xPbxSBNV1f-f"/></div></div></figure><p id="876e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们还将启用<strong class="jq hj"> Truncate Table </strong>标志，这样每次管道运行时，表都会被截断:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ob"><img src="../Images/23dbe4d27c681a20a1cc8c27749b717f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qpnvigWP5fTw9V--"/></div></div></figure><p id="c810" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在管道已经完成，您可以通过点击画布顶部的<strong class="jq hj">预览</strong>按钮，手动设置我们设置的文件名作为为管道定义的运行时参数(在管道从云功能部署和执行后， 这个运行时参数将用上传到<strong class="jq hj">GS://[YOUR _ DATA _ SOURCE _ BUCKET]</strong>的实际文件名填充，它将在运行时传递给管道)，现在我们将提供与在步骤1中上传到BUCKET的文件名相同的文件名，以便进行这次模拟运行，并单击<strong class="jq hj"> Run </strong>:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es oc"><img src="../Images/86bb56eda927090cfae64696d2e6617a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ElDna88orc40VEex"/></div></div></figure><p id="f45d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">管道的预览将运行大约一分钟，但是不会执行任何实际的执行，不会产生任何Dataproc集群，也不会将任何记录写入BigQuery表:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es od"><img src="../Images/baa2ebec4c9e0637ce525380424e133e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-841PU0Rnbiu7oH1"/></div></div></figure><p id="f408" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">一旦预览运行完成，您就可以预览在每个步骤中哪些数据到达了输入端，以及在每个步骤的处理之后输出了哪些数据。您可以点击每个管道步骤上的<strong class="jq hj">“预览数据”</strong>链接。</p><p id="f6de" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">一旦您查看了预览并对管道的行为感到满意，就该部署它了。为此，返回画布，再次单击预览按钮禁用预览模式，然后单击部署按钮。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es oe"><img src="../Images/cfbc2cbfe98d01d9bac1f6977a13889f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*U2SuSYXBL8DDXo3a"/></div></div></figure><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es of"><img src="../Images/f3579325b9855b6ec39f95ef518a734d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gsxg4K6Ikcvr3ya_"/></div></div></figure><p id="e214" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">几秒钟后，管道将被部署并准备好执行:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d60afd5f96733f687909305bdf4c6769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZvEZqGT38_aIng08"/></div></div></figure></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><h1 id="3db5" class="iq ir hi bd is it ln iv iw ix lo iz ja jb lp jd je jf lq jh ji jj lr jl jm jn bi translated">5.创建云函数，该函数将在新文件上传到数据源存储桶时触发管道的执行。</h1><p id="bab8" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">现在，将转换数据并将其加载到BigQuery的数据融合管道已经部署好并准备好执行，我们将设置云函数，每当有新文件上传到数据源GCS bucket时，该函数就会被触发。该函数的目的是将新上传的文件传递到数据融合管道并开始执行。</p><p id="31b5" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">为此，我们需要首先启用云构建API，如果您还没有这样做，请启用它:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es og"><img src="../Images/d3944616d56e844574f0416418d646ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rWp6X8JL21COo3W7"/></div></div></figure><p id="a1e5" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">然后，导航到云功能:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es oh"><img src="../Images/efca0271cb3d2775652dfce5a20cece8.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/0*jtExzdWPQa8oeCXW"/></div></figure><p id="2adc" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">一旦你在那里，点击创建函数:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es oi"><img src="../Images/f3762c57af960238f2caa7d61e52d42f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xc3Z7e-MTdT-3Owh"/></div></div></figure><p id="b76f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">设置基本功能配置和触发行为:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es oj"><img src="../Images/089133b091217c8625fb7b7cfbb3746c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*0UI297Y5dxLKY1Lo"/></div></figure><p id="94bb" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">给新函数起一个有意义的名字，设置触发器类型为<strong class="jq hj">云存储</strong>，事件类型为<strong class="jq hj">完成/创建</strong>，桶为<strong class="jq hj">【YOUR _ DATA _ SOURCE _ Bucket】，</strong>然后<strong class="jq hj"> </strong>点击<strong class="jq hj">保存</strong>按钮。</p><p id="c9a6" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">然后点击<strong class="jq hj">下方的下一个</strong>按钮。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es ok"><img src="../Images/3c2743c1b55dd12c311e1e5334b1aad8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/0*n_4qniEmHKAKF825"/></div></figure><p id="cdbe" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">注意:</strong>如果您尚未启用云构建API，系统会提示您启用(如下图中红色横幅所示，提示您启用)。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f8a1fca29cb530ce2cc7c3f5a0591031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aRhrF45A4VRSf98d"/></div></div><figcaption class="ni nj et er es nk nl bd b be z dx translated">红色横幅表示尚未启用云构建API。</figcaption></figure><p id="d6f7" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在云函数向导的代码部分，您会在左侧看到自动为您创建的文件模板列表，根据您将用于创建函数的运行时和语言，这些模板是必需的。因为我们将使用Python 3.9运行时创建函数，所以创建了两个文件:<strong class="jq hj"> main.py </strong>和<strong class="jq hj"> requirements.txt </strong></p><p id="af4a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">requirements.txt文件包含Python函数本身引用的Python库及其版本的列表，因此该函数需要这些库才能工作。main.py文件包含函数被触发时执行的实际Python代码。</p><p id="e764" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">首先，我们将编辑<strong class="jq hj"> requirements.txt </strong>文件，在那里我们将列出云功能所需的Python库，在这种情况下，在运行时默认情况下唯一没有捆绑的库以及我们将在<strong class="jq hj"> main.py </strong>文件中使用的库是requests库(我们将在脚本中使用它来发送HTTP POST请求Data Fusion REST API，以启动我们之前使用Data Fusion创建的数据管道，并从元数据服务器检索访问令牌):</p><p id="c53a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在<strong class="jq hj">运行时</strong>下拉菜单中选择<strong class="jq hj"> Python 3.9 </strong>，然后点击下面的requirements.txt文件，将下面一行添加到requirements.txt文件中:</p><p id="250f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">请求&gt; =2.25.1 </strong></p><p id="652b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">所以看起来是这样的:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ol"><img src="../Images/1aaaf8f861e457e1534eaee340ace1c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xm-RHCBWgzrj4fxj"/></div></div></figure><p id="90ad" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">然后，我们编辑main.py文件并编写python脚本，每当有新文件上传到我们之前指定的存储桶时，该脚本就会运行:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es om"><img src="../Images/626c9011e71965eeb80649da0bccdd53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fJ5U0c7IiQ81Ahq5"/></div></div></figure><p id="68e1" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">Python脚本:</p><p id="5eab" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">记得用数据融合实例的端点替换您的CDAP实例端点和管道名称常量中的值。您可以通过在云shell中运行以下命令来找出您的实例的端点:</strong></p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="3515" class="mb ir hi lx b fi mc md l me mf">gcloud beta data-fusion instances describe \<br/> - location=${LOCATION} \<br/> - format="value(apiEndpoint)" \<br/> ${INSTANCE_ID}</span></pre><p id="7d73" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">示例:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es on"><img src="../Images/5f4ce110c795853fba3a5e6387aacf55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hBx2JkPH5JRZ9OjW"/></div></div></figure><blockquote class="oo"><p id="0049" class="op oq hi bd or os ot ou ov ow ox kl dx translated">你可以在GitHub <a class="ae ne" href="https://github.com/davavillerga/gcp-functions-bq/blob/main/cloud_function/main.py" rel="noopener ugc nofollow" target="_blank">的main.py文件中找到代码:</a></p></blockquote><div class="oy oz pa pb pc pd"><a href="https://github.com/davavillerga/gcp-functions-bq/blob/main/cloud_function/main.py" rel="noopener  ugc nofollow" target="_blank"><div class="pe ab dw"><div class="pf ab pg cl cj ph"><h2 class="bd hj fi z dy pi ea eb pj ed ef hh bi translated">GCP-functions-bq/main . py at main davavillerga/GCP-functions-bq</h2><div class="pk l"><h3 class="bd b fi z dy pi ea eb pj ed ef dx translated">通过在GitHub上创建一个帐户，为davavillerga/gcp-functions-bq开发做出贡献。</h3></div><div class="pl l"><p class="bd b fp z dy pi ea eb pj ed ef dx translated">github.com</p></div></div><div class="pm l"><div class="pn l po pp pq pm pr io pd"/></div></div></a></div><figure class="ls lt lu lv fd ij"><div class="bz dy l di"><div class="ps pt l"/></div><figcaption class="ni nj et er es nk nl bd b be z dx translated">触发数据融合管道执行的云函数的main.py代码</figcaption></figure><p id="7d4d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">最后，点击<strong class="jq hj">部署</strong>，该功能应该需要几分钟部署。完成后，您应该会看到它作为正确部署的函数列在已部署的函数下，如下所示:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es pu"><img src="../Images/4e5a94ff027cf2ce8e23db76d3eb9b22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xros4LSVjXRxBZIV"/></div></div></figure><p id="55ee" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">为了测试到目前为止一切都按预期运行，我们将简单地上传一个CSV文件到<strong class="jq hj">GS://【YOUR _ DATA _ SOURCE _ BUCKET】</strong>不管您如何命名该文件，只要数据和标题与我们开始上传的示例文件相同。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es pv"><img src="../Images/1a8aa3d9107b1e97622e9fab57e6ed13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iBKy6GRITjXdHlyn"/></div></div></figure><p id="dcff" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">您可以通过检查您的函数中的函数日志来确认云函数已运行:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es pw"><img src="../Images/3251086879c5bbb15bfbf7521898a28a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c4H9NGTSiU-xK_FE"/></div></div></figure><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es px"><img src="../Images/57729c79b5036141a8d7846234a65d19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wTAfa8uXWHcNdkLV"/></div></div></figure><p id="f9cc" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">您还可以确认数据融合管道是由数据融合实例UI中的函数启动的:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/941adf2b46f89be450f54ee43965d8a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GMtSJqPT3SRYemr6"/></div></div></figure><p id="40ae" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">状态将从<strong class="jq hj">部署</strong>，变为<strong class="jq hj">供应</strong>，然后变为<strong class="jq hj">运行</strong>。</p><p id="e497" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在Dataproc Clusters页面中，您将看到数据融合产生了一个短暂的集群，只要管道在运行，该集群就将保持活动状态，当管道运行结束时，它将被销毁:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es py"><img src="../Images/d988dd680ccf6bb956d7b84160f0646a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SECZDVwEBISUo5Vr"/></div></div></figure><p id="1236" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">大约5到6分钟后，管道执行将完成，状态将变为<strong class="jq hj">成功</strong>，您将在数据融合中看到从每一步到下一步传递了多少条记录。通过点击顶部的<strong class="jq hj">运行时参数</strong>，您还可以看到云函数作为文件名参数传递给管道的值:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9855c9aeb09b23306ee6848e1c6d32f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*B5UNiu2z2GdLlbw-"/></div></div></figure><p id="1818" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">最后，在BigQuery中，您可以检查BigQuery表中加载的记录:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es pz"><img src="../Images/5bdd1b034a37a2bdb10318c944105970.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RcOpJiWR3kFNO-2f"/></div></div></figure></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><h1 id="e1ed" class="iq ir hi bd is it ln iv iw ix lo iz ja jb lp jd je jf lq jh ji jj lr jl jm jn bi translated">6.在Data Studio中创建一个简单的报表，并在BigQuery中显示一些数据。</h1><p id="1502" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">既然我们已经在BigQuery中有了一些数据，我们将很快在Data Studio中创建一个简单的报告。在同一个BigQuery表资源管理器中，使用右侧的导出菜单导出表，开始在Data Studio中浏览数据:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/83211d9192c01524ae8d328f8106ce4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VyouSxEUChH4cQhJ"/></div></div></figure><p id="e2f4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">Data Studio UI将在一个单独的选项卡中打开，并预加载了表数据:</p><p id="2754" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们刚刚添加了3个非常简单的可视化效果，一个是列<strong class="jq hj">金额</strong>的总和，一个是按<strong class="jq hj">项目_类别</strong>显示记录百分比分布的环形图，一个是按<strong class="jq hj">订单_日期</strong>显示<strong class="jq hj">金额</strong>的时间序列图，因为输入数据在<strong class="jq hj">订单_日期</strong>列中只有2天的数据，这个图看起来很奇怪，我们将添加一个包含更多记录的新文件来查看差异。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es qa"><img src="../Images/47bb5e0eab2eb064ed8d17bb54d63f13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s7OWDaGh67Dabaxv"/></div></div></figure><p id="f175" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们使用<strong class="jq hj">保存</strong>按钮保存数据探索，点击<strong class="jq hj">共享</strong>下拉菜单，选择<strong class="jq hj">创建报告和共享</strong>保存报告，并从探索模式进入报告模式。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es qb"><img src="../Images/b924be5d1cfaae83a9fd3cde48bc9414.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/0*ITvmoX7AXXDHHxlK"/></div></figure><p id="bbfa" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">确认弹出窗口中显示的提示，让DataStudio从BigQuery访问数据。现在，从这里开始，我们可以继续向报告添加页面、可视化效果和图表，对报告进行格式化并应用一些漂亮的样式，使其看起来漂亮整洁，并准备以多种不同的方式共享它，甚至安排发送电子邮件来共享它。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/bc3cf1fc2b41df6910c9fe08a2fd421d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l2j0wLKq9eXzVAtr"/></div></div></figure><p id="f047" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们将文件<strong class="jq hj"> UpdateFile.csv </strong>(包含更多数据)上传到数据源桶，并等待数据更新过程完成，一旦完成，我们可以轻松地在Data Studio中刷新报告，以发送另一个最新报告:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es qc"><img src="../Images/605b5fdb393814fbd3ba7f7800c0474f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Rnh5d5dkSR7kzgTG"/></div></div></figure><p id="88b6" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">数据被刷新，您可以发送另一个更新的报告:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es qd"><img src="../Images/2369115bc6840eff900f675787036a6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*niMOif82-nXYqeoU"/></div></div></figure><p id="a45a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">就是这样！！现在，您已经有了一个全功能的自动化初始ETL +分析工作负载。你现在所要做的就是不断地将数据输入GCS，只要你需要，你就可以让Data Studio发送包含最新数据的预定报告。</p><p id="4cc0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">尽情享受吧！</p></div></div>    
</body>
</html>