<html>
<head>
<title>Google Cloud Storage Signed URLs In Apps Script</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">应用程序脚本中的Google云存储签名URL</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-cloud-storage-signed-urls-in-apps-script-161b74a9c5e7?source=collection_archive---------2-----------------------#2018-08-09">https://medium.com/google-cloud/google-cloud-storage-signed-urls-in-apps-script-161b74a9c5e7?source=collection_archive---------2-----------------------#2018-08-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="3586" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">简单、安全的图标</h2></div><p id="ff9a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Apps Script的两个关键挑战是存储非G套件数据，以及扩展Apps Script以利用更广泛的Google生态系统；先进的谷歌服务有助于解决后一个挑战。</p><p id="8d4c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">其中一个最重要的地方是在你的<a class="ae jt" href="https://developers.google.com/apps-script/guides/html/" rel="noopener ugc nofollow" target="_blank"> HTMLService UI </a>中显示图像:一旦你超越了简单的UI，你会想要以图标的形式为你的用户提供图形提示。</p><p id="90cf" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae jt" href="https://cloud.google.com/storage/" rel="noopener ugc nofollow" target="_blank">谷歌云存储</a> (GCS)是存储这些的天然场所，你可以简单地从你的HTMLService引用对象的URL只要对象是公共的。然而，让你从图标供应商(或你自己开发的)那里购买的图标库免费可用可能比你想提供的更像是一种公共服务，更不用说潜在的许可问题了。</p><p id="4aaf" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以将GCS对象设为私有，只授予您域中的用户访问权限……只要您没有提供公开可用的<a class="ae jt" href="https://developers.google.com/apps-script/add-ons/" rel="noopener ugc nofollow" target="_blank"> G Suite附加组件</a>，在这种情况下，您不知道您的用户是谁。这就是<a class="ae jt" href="https://cloud.google.com/storage/docs/access-control/signed-urls" rel="noopener ugc nofollow" target="_blank"> GCS签名URL</a>的用武之地。</p><p id="0199" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">GCS签名的URL允许用户在有限的时间内读取、写入或删除该资源。但是，GCS没有应用程序脚本高级服务；GCS文档提供了一个<a class="ae jt" href="https://cloud.google.com/storage/docs/access-control/create-signed-urls-program" rel="noopener ugc nofollow" target="_blank">详细的方法</a>来滚动你自己的签名URL，但是像所有的编码一样，有很多机会误入歧途。这就是下面这个函数的用处。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="jz ka l"/></div></figure><h1 id="9751" class="kb kc hi bd kd ke kf kg kh ki kj kk kl io km ip kn ir ko is kp iu kq iv kr ks bi translated">使用</h1><p id="ec08" class="pw-post-body-paragraph ix iy hi iz b ja kt ij jc jd ku im jf jg kv ji jj jk kw jm jn jo kx jq jr js hb bi translated">在您的附加项目的<a class="ae jt" href="https://cloud.google.com/console/iam-admin/serviceaccounts" rel="noopener ugc nofollow" target="_blank"> GCloud控制台</a>中创建一个服务帐户凭证并下载它。</p><p id="46c6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将<a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify" rel="noopener ugc nofollow" target="_blank">字符串化的</a>凭证存储在您的附加组件的<a class="ae jt" href="https://developers.google.com/apps-script/guides/properties" rel="noopener ugc nofollow" target="_blank">脚本属性</a>中。</p><ul class=""><li id="06af" class="ky kz hi iz b ja jb jd je jg la jk lb jo lc js ld le lf lg bi translated">您没有将凭据存储在附加代码中，是吗？提示:在附加组件中编写一个脚本属性集包装函数，并从外部工具调用这个函数作为库方法来存储凭证…这允许您使用外部工具，而不用担心凭证在您的附加组件代码中持续存在，因为它经历了所有版本。</li></ul><p id="b995" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以安全的方式从您的计算机中删除下载的凭据，例如</p><pre class="ju jv jw jx fd lh li lj lk aw ll bi"><span id="711e" class="lm kc hi li b fi ln lo l lp lq">$ shred -u ~/Downloads/&lt;KEY_FILE&gt;</span></pre><p id="cc25" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">向服务帐户授予对您的对象或存储桶的reader权限。</p><p id="291d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在您的HTMLService模板中，用scriptlet替换硬编码的图像引用，例如。</p><pre class="ju jv jw jx fd lh li lj lk aw ll bi"><span id="208c" class="lm kc hi li b fi ln lo l lp lq">&lt;img src='&lt;?= GCSImg ?&gt;' alt="Signed URL Image"/&gt;</span></pre><p id="a425" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在创建HTMLService的函数中</p><ul class=""><li id="ebc2" class="ky kz hi iz b ja jb jd je jg la jk lb jo lc js ld le lf lg bi translated">从附加组件的脚本属性中获取凭证，<a class="ae jt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse" rel="noopener ugc nofollow" target="_blank">将其转换回JSON对象</a></li><li id="612d" class="ky kz hi iz b ja lr jd ls jg lt jk lu jo lv js ld le lf lg bi translated">使用适当的参数调用getSignedURL_ function，并为签名的URL设置一个模板变量，例如。</li></ul><pre class="ju jv jw jx fd lh li lj lk aw ll bi"><span id="aed9" class="lm kc hi li b fi ln lo l lp lq">template.GCSImg = getSignedURL_(GCSSignedURLCredential, GCSObjectURL,...);</span></pre></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><h1 id="7791" class="kb kc hi bd kd ke md kg kh ki me kk kl io mf ip kn ir mg is kp iu mh iv kr ks bi translated">下一步是什么</h1><p id="c8ad" class="pw-post-body-paragraph ix iy hi iz b ja kt ij jc jd ku im jf jg kv ji jj jk kw jm jn jo kx jq jr js hb bi translated">阅读以下内容，了解本文中描述的解决方案组件的更多信息:</p><ul class=""><li id="e5d3" class="ky kz hi iz b ja jb jd je jg la jk lb jo lc js ld le lf lg bi translated"><a class="ae jt" href="https://developers.google.com/apps-script/reference/" rel="noopener ugc nofollow" target="_blank"> Apps脚本高级谷歌服务</a>。</li><li id="c741" class="ky kz hi iz b ja lr jd ls jg lt jk lu jo lv js ld le lf lg bi translated"><a class="ae jt" href="https://developers.google.com/apps-script/guides/html/" rel="noopener ugc nofollow" target="_blank"> Apps脚本HTMLService UI </a>。</li><li id="3655" class="ky kz hi iz b ja lr jd ls jg lt jk lu jo lv js ld le lf lg bi translated"><a class="ae jt" href="https://cloud.google.com/storage/docs/access-control/signed-urls" rel="noopener ugc nofollow" target="_blank">谷歌云存储(GCS)签名网址</a>。</li></ul><p id="3eb0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">阅读以下指南，了解谷歌云平台在以下领域的能力。</p><ul class=""><li id="5323" class="ky kz hi iz b ja jb jd je jg la jk lb jo lc js ld le lf lg bi translated"><a class="ae jt" rel="noopener" href="/google-cloud/gcs-signed-url-with-customer-supplied-encryption-key-c89740f31855"> GCS使用客户提供的加密密钥签署的URL</a>。</li></ul></div></div>    
</body>
</html>