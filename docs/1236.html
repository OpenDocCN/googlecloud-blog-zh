<html>
<head>
<title>Playing with Python Kubernetes API: Running Tasks in Jobs Generated by a Pod in Google Kubernetes Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Python Kubernetes API:åœ¨ç”±Google Kuberneteså¼•æ“ä¸­çš„Podç”Ÿæˆçš„ä½œä¸šä¸­è¿è¡Œä»»åŠ¡</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/google-cloud/playing-with-python-kubernetes-api-running-tasks-in-jobs-generated-by-a-pod-in-google-kubernetes-b5048696dfa8?source=collection_archive---------1-----------------------#2019-12-29">https://medium.com/google-cloud/playing-with-python-kubernetes-api-running-tasks-in-jobs-generated-by-a-pod-in-google-kubernetes-b5048696dfa8?source=collection_archive---------1-----------------------#2019-12-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5524" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨æŸäº›ç”¨ä¾‹ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªä½œä¸šè¿›è¡Œä¸€æ¬¡æ€§æŸ¥è¯¢ï¼Œç„¶åä¸ºäº†ä¼˜åŒ–åº”ç”¨ç¨‹åºè€Œä¿å­˜åœ¨ä¸€äº›ç¼“å­˜ä¸­ã€‚<br/>å½“æˆ‘è¯•å›¾åˆ©ç”¨Kubernetes APIæ¥æ‰§è¡Œè¿™ä¸ªä»»åŠ¡æ—¶ï¼Œæˆ‘å°±æ˜¯è¿™ä¹ˆæƒ³çš„ã€‚</p><blockquote class="jd je jf"><p id="3902" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">é‚£ä¹ˆä¸ºä»€ä¹ˆæ˜¯Pythonå‘¢ï¼Ÿå› ä¸ºæˆ‘çš„è¿™ä¸ªé¡¹ç›®ä¸åˆ†ææœ‰å…³ï¼Œå¦‚æœæˆ‘ä½¿ç”¨Pythonå®é™…ä¸Šæ›´åˆé€‚ï¼Œå› ä¸ºå®ƒå·²ç»ä¸ºæˆ‘æä¾›äº†è®¸å¤šç»Ÿè®¡åº“ï¼Œå¦‚Pandaså’ŒScipyï¼Œå¹¶ä¸”å®ƒè¿˜ä¸ºæˆ‘å¯èƒ½éœ€è¦èƒ½å¤Ÿä¸å…¶ä»–ç»„ä»¶äº¤äº’çš„å…¶ä»–åº“å»ºç«‹äº†åº“ã€‚</p></blockquote><p id="7704" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨ç›´æ¥è¿›å…¥ä¸»é¢˜ä¹‹å‰ï¼Œæˆ‘æƒ³ç®€å•è§£é‡Šä¸€ä¸‹Kubernetes APIæœåŠ¡å™¨ã€Kubernetesè®¤è¯æ–¹æ³•ã€Kubernetesæˆæƒå’ŒKuberneteså®¢æˆ·ç«¯ã€‚</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><p id="1d64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">ä»‹ç»APIæœåŠ¡å™¨</strong></p><blockquote class="jd je jf"><p id="6727" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">ä¸­å¤®ç®¡ç†å®ä½“å’Œå”¯ä¸€å¯ä»¥ç›´æ¥è®¿é—®etcdçš„ç»„ä»¶ï¼Œä½œä¸ºHTTPä¸Šçš„RESTful APIå®ç°ï¼Œæ‰€æœ‰å…¶ä»–ç»„ä»¶é€šè¿‡å®ƒè¿›è¡Œäº¤äº’â€¦</p></blockquote><p id="8cdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Kubernetes APIåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªHTTP APIï¼ŒJSONæ˜¯å®ƒçš„ä¸»è¦åºåˆ—åŒ–æ¨¡å¼ã€‚å®ƒè¿˜æ”¯æŒåè®®ç¼“å†²åŒº(ä¸»è¦ç”¨äºé›†ç¾¤å†…éƒ¨é€šä¿¡)ã€‚å‡ºäºå¯æ‰©å±•æ€§çš„åŸå› ï¼ŒKubernetesæ”¯æŒä¸åŒAPIè·¯å¾„ä¸‹çš„å¤šä¸ªAPIç‰ˆæœ¬ã€‚ç°åœ¨çœ‹çœ‹HTTP APIç©ºé—´æ˜¯å¦‚ä½•æ„é€ çš„ã€‚åœ¨é¡¶å±‚ï¼Œæˆ‘ä»¬åŒºåˆ†æ ¸å¿ƒç»„(<code class="du js jt ju jv b">/api/v1</code>)ã€å‘½åç»„(<code class="du js jt ju jv b">/apis/$NAME/$VERSION</code>)å’Œå…¨ç³»ç»Ÿå®ä½“(å¦‚<code class="du js jt ju jv b">/metrics</code>)ã€‚æ³¨æ„ç‰ˆæœ¬å¯ä»¥æ˜¯<code class="du js jt ju jv b">v1alpha1</code>(é»˜è®¤ç¦ç”¨)ã€<code class="du js jt ju jv b">v2beta3</code>(é»˜è®¤å¯ç”¨)å’Œ<code class="du js jt ju jv b">v1</code>ã€‚</p><p id="e14a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸€èˆ¬æ¥è¯´ï¼ŒKubernetes APIæ”¯æŒé€šè¿‡æ ‡å‡†çš„HTTPåŠ¨è¯<code class="du js jt ju jv b">POST</code>ã€<code class="du js jt ju jv b">PUT</code>ã€<code class="du js jt ju jv b">DELETE</code>å’Œ<code class="du js jt ju jv b">GET</code>åœ¨ç»™å®šè·¯å¾„ä¸Šè¿›è¡Œåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤å’Œæ£€ç´¢æ“ä½œï¼Œå¹¶å°†JSONä½œä¸ºé»˜è®¤è´Ÿè½½ã€‚</p><p id="d069" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">APIç»„ã€ç‰ˆæœ¬å’Œèµ„æº(GVR)å”¯ä¸€åœ°å®šä¹‰äº†HTTPè·¯å¾„:</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es jw"><img src="../Images/25358962c925d987435ea219f7a5635c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8WOFozY18oqNVvJ22qvaTA.png"/></div></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">ä½œä¸šHTTPè·¯å¾„çš„å¤–è§‚ã€‚</figcaption></figure><p id="5fef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">é¦–å…ˆï¼Œå½“HTTPè¯·æ±‚å‘½ä¸­Kubernetes APIæ—¶ï¼Œé¦–å…ˆåº”ç”¨çš„æ˜¯è¯·æ±‚å°†ç”±åœ¨<code class="du js jt ju jv b">DefaultBuildHandlerChain()</code> ( <a class="ae jr" href="https://github.com/kubernetes/apiserver/blob/master/pkg/server/config.go" rel="noopener ugc nofollow" target="_blank"> config.go </a>)ä¸­æ³¨å†Œçš„è¿‡æ»¤å™¨é“¾å¤„ç†ã€‚è¿™æœŸé—´ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿåœ¨é«˜å±‚æ¬¡ä¸Šï¼Œè¿‡æ»¤å™¨æˆ–è€…ä¼ é€’ç›¸åº”çš„ä¿¡æ¯å¹¶å°†å…¶é™„åŠ åˆ°<code class="du js jt ju jv b">ctx.RequestInfo</code>ï¼Œæ¯”å¦‚ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼Œæˆ–è€…è¿”å›é€‚å½“çš„HTTPå“åº”ä»£ç ã€‚ç°åœ¨æˆ‘ä»¬å°†è¯•ç€æ›´æ·±å…¥åœ°çœ‹çœ‹<code class="du js jt ju jv b">DefaultBuildHandlerChain()</code>å†…éƒ¨è®¾ç½®çš„è¿‡æ»¤å™¨:</p><ul class=""><li id="5399" class="km kn hi ih b ii ij im in iq ko iu kp iy kq jc kr ks kt ku bi translated"><code class="du js jt ju jv b">WithRequestInfo()</code>å¦‚<a class="ae jr" href="https://github.com/kubernetes/apiserver/blob/master/pkg/endpoints/filters/requestinfo.go" rel="noopener ugc nofollow" target="_blank"> requestinfo.goä¸­æ‰€å®šä¹‰</a>å°†ä¸€ä¸ª<code class="du js jt ju jv b"><a class="ae jr" href="https://github.com/kubernetes/apiserver/blob/585f7eed30ae80d4b946d4b7c849dd47febdc498/pkg/endpoints/request/requestinfo.go#L117" rel="noopener ugc nofollow" target="_blank">RequestInfo</a></code>é™„åŠ åˆ°ä¸Šä¸‹æ–‡ä¸­</li><li id="2e72" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated"><code class="du js jt ju jv b">WithMaxInFlightLimit()</code>å¦‚<a class="ae jr" href="https://github.com/kubernetes/apiserver/blob/master/pkg/server/filters/maxinflight.go" rel="noopener ugc nofollow" target="_blank">ä¸­æ‰€å®šä¹‰ï¼Œmaxinflight.go </a>é™åˆ¶é£è¡Œä¸­è¯·æ±‚çš„æ•°é‡</li><li id="9c6d" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated"><code class="du js jt ju jv b">WithTimeoutForNonLongRunningRequests()</code>å¦‚<a class="ae jr" href="https://github.com/kubernetes/apiserver/blob/master/pkg/server/filters/timeout.go" rel="noopener ugc nofollow" target="_blank"> timeout.go </a>ä¸­æ‰€å®šä¹‰ï¼Œä¸å¤§å¤šæ•°<code class="du js jt ju jv b">GET</code>ã€<code class="du js jt ju jv b">PUT</code>ã€<code class="du js jt ju jv b">POST</code>ã€<code class="du js jt ju jv b">DELETE</code>è¯·æ±‚ä¸€æ ·ï¼Œéé•¿æ—¶é—´è¿è¡Œçš„è¯·æ±‚è¶…æ—¶ï¼Œè¿™ä¸é•¿æ—¶é—´è¿è¡Œçš„è¯·æ±‚(å¦‚è§‚å¯Ÿå™¨å’Œä»£ç†è¯·æ±‚)ç›¸å</li><li id="a624" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated"><code class="du js jt ju jv b">WithPanicRecovery()</code>å¦‚<a class="ae jr" href="https://github.com/kubernetes/apiserver/blob/master/pkg/server/filters/wrap.go" rel="noopener ugc nofollow" target="_blank"> wrap.goä¸­æ‰€å®šä¹‰</a>åŒ…è£…ä¸€ä¸ªå¤„ç†ç¨‹åºæ¥æ¢å¤å’Œè®°å½•æ­»æœº</li><li id="0843" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated"><a class="ae jr" href="https://github.com/kubernetes/apiserver/blob/master/pkg/server/filters/cors.go" rel="noopener ugc nofollow" target="_blank">ä¸­å®šä¹‰çš„<code class="du js jt ju jv b">WithCORS()</code>cors . go</a>æä¾›äº†ä¸€ä¸ªCORSå®ç°ï¼›CORSä»£è¡¨è·¨æºèµ„æºå…±äº«ï¼Œå®ƒæ˜¯ä¸€ç§æœºåˆ¶ï¼Œå…è®¸åµŒå…¥åœ¨HTMLé¡µé¢ä¸­çš„JavaScriptå‘ä¸åŒäºJavaScriptèµ·æºçš„åŸŸå‘å‡ºXMLHttpRequestsã€‚</li><li id="02af" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated"><code class="du js jt ju jv b">WithAuthentication()</code>å¦‚<a class="ae jr" href="https://github.com/kubernetes/apiserver/blob/master/pkg/endpoints/filters/authentication.go" rel="noopener ugc nofollow" target="_blank">ä¸­æ‰€å®šä¹‰çš„ï¼Œauthentication.go </a>å°è¯•å°†ç»™å®šè¯·æ±‚è®¤è¯ä¸ºç”¨æˆ·ï¼Œå¹¶å°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨æä¾›çš„ä¸Šä¸‹æ–‡ä¸­ã€‚æˆåŠŸæ—¶ï¼Œä»è¯·æ±‚ä¸­åˆ é™¤<code class="du js jt ju jv b">Authorization</code> HTTPå¤´ã€‚</li><li id="a45f" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated"><code class="du js jt ju jv b">WithAudit()</code>å¦‚<a class="ae jr" href="https://github.com/kubernetes/apiserver/blob/master/pkg/endpoints/filters/audit.go" rel="noopener ugc nofollow" target="_blank"> audit.go </a>ä¸­æ‰€å®šä¹‰ï¼Œç”¨æ‰€æœ‰ä¼ å…¥è¯·æ±‚çš„å®¡è®¡æ—¥å¿—ä¿¡æ¯æ¥ä¿®é¥°å¤„ç†ç¨‹åºã€‚å®¡è®¡æ—¥å¿—æ¡ç›®åŒ…å«è¯¸å¦‚è¯·æ±‚çš„æºIPã€è°ƒç”¨æ“ä½œçš„ç”¨æˆ·å’Œè¯·æ±‚çš„åç§°ç©ºé—´ç­‰ä¿¡æ¯ã€‚</li><li id="e8fe" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated"><code class="du js jt ju jv b">WithImpersonation()</code>å¦‚<a class="ae jr" href="https://github.com/kubernetes/apiserver/blob/master/pkg/endpoints/filters/impersonation.go" rel="noopener ugc nofollow" target="_blank"> impersonation.goä¸­å®šä¹‰çš„é‚£æ ·</a>é€šè¿‡æ£€æŸ¥è¯•å›¾æ”¹å˜ç”¨æˆ·çš„è¯·æ±‚æ¥å¤„ç†ç”¨æˆ·æ¨¡æ‹Ÿ(ç±»ä¼¼äºsudo)ã€‚</li><li id="e43f" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated"><code class="du js jt ju jv b">WithAuthorization()</code>åœ¨<a class="ae jr" href="https://github.com/kubernetes/apiserver/blob/master/pkg/endpoints/filters/authorization.go" rel="noopener ugc nofollow" target="_blank"> authorization.go </a>ä¸­å®šä¹‰ï¼Œå°†æ‰€æœ‰æˆæƒçš„è¯·æ±‚ä¼ é€’ç»™å¤šè·¯å¤ç”¨å™¨ï¼Œå¤šè·¯å¤ç”¨å™¨å°†è¯·æ±‚å‘é€ç»™æ­£ç¡®çš„å¤„ç†å™¨ï¼Œå¦åˆ™è¿”å›ç¦æ­¢é”™è¯¯ã€‚</li></ul></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><p id="b50a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Kubernetesè®¤è¯</strong></p><p id="ec78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨Kubernetesä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§ç”¨æˆ·å®šä¹‰:</p><ul class=""><li id="bcdc" class="km kn hi ih b ii ij im in iq ko iu kp iy kq jc kr ks kt ku bi translated">ç”±Kubernetesç®¡ç†çš„æœåŠ¡å¸æˆ·ï¼Œé€šå¸¸ç”±Kubernetes APIç®¡ç†ï¼Œç»‘å®šåˆ°ç‰¹å®šçš„åç§°ç©ºé—´ï¼Œç”±APIæœåŠ¡å™¨è‡ªåŠ¨åˆ›å»ºæˆ–é€šè¿‡APIè°ƒç”¨æ‰‹åŠ¨åˆ›å»º(å…¶å‡­è¯ä¿å­˜ä¸ºå®‰è£…åˆ°podsçš„<code class="du js jt ju jv b">Secrets</code>,ä»è€Œå…è®¸é›†ç¾¤å†…è¿›ç¨‹ä¸Kubernetes APIå¯¹è¯)ï¼›</li><li id="52b9" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">æ™®é€šç”¨æˆ·ï¼Œé€šå¸¸ç”±å¤–éƒ¨ç‹¬ç«‹æœåŠ¡ç®¡ç†ã€‚</li></ul><p id="6e5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Kubernetesä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦ã€ä¸è®°åä»¤ç‰Œã€è®¤è¯ä»£ç†æˆ–HTTP basic authæ¥é€šè¿‡è®¤è¯æ’ä»¶è®¤è¯APIè¯·æ±‚ã€‚å½“å‘APIæœåŠ¡å™¨å‘å‡ºHTTPè¯·æ±‚æ—¶ï¼Œæ’ä»¶è¯•å›¾å°†ä»¥ä¸‹å±æ€§ä¸åœ¨<code class="du js jt ju jv b"><a class="ae jr" href="https://github.com/kubernetes/apiserver/blob/585f7eed30ae80d4b946d4b7c849dd47febdc498/pkg/authentication/group/authenticated_group_adder.go#L39" rel="noopener ugc nofollow" target="_blank">AuhenticateRequest(req *http.Request)</a></code>ä¸­å®šä¹‰çš„è¯·æ±‚ç›¸å…³è”ã€‚æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨<a class="ae jr" href="https://kubernetes.io/docs/reference/access-authn-authz/authentication/" rel="noopener ugc nofollow" target="_blank">è®¤è¯</a>ä¸­é˜…è¯»ã€‚æˆ‘ä»¬çš„ä¸€ä¸ªè®¤è¯ç­–ç•¥æ˜¯ä½¿ç”¨X509å®¢æˆ·ç«¯è¯ä¹¦ã€‚è¿™ä¹Ÿæ˜¯ç†è§£GKEè®¤è¯è¿‡ç¨‹çš„å‰æã€‚</p><p id="f64a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GKEæœ‰è‡ªå·±çš„æ§åˆ¶å¹³é¢ã€‚åœ¨GKEé›†ç¾¤ä¸­ï¼Œæ§åˆ¶å¹³é¢ç»„ä»¶è¿è¡Œåœ¨Googleæ‹¥æœ‰çš„GCEå®ä¾‹ä¸Šï¼Œåœ¨ä¸€ä¸ªå•ç‹¬çš„Googleç®¡ç†çš„é¡¹ç›®ä¸­ã€‚æ¯ä¸ªå®ä¾‹åªä¸ºä¸€ä¸ªå®¢æˆ·è¿è¡Œè¿™äº›ç»„ä»¶ã€‚æ¯ä¸ªé›†ç¾¤éƒ½æœ‰è‡ªå·±çš„<a class="ae jr" href="https://kubernetes.io/docs/tasks/tls/managing-tls-in-a-cluster" rel="noopener ugc nofollow" target="_blank">æ ¹è®¤è¯æœºæ„(CA) </a>ã€‚å†…éƒ¨æœåŠ¡ç®¡ç†æ­¤CAçš„æ ¹å¯†é’¥ã€‚æ¯ä¸ªé›†ç¾¤ä¹Ÿæœ‰è‡ªå·±çš„etcd CAã€‚etcd CAçš„æ ¹å¯†é’¥è¢«åˆ†å‘åˆ°è¿è¡ŒKubernetes APIæœåŠ¡å™¨çš„è™šæ‹Ÿæœºçš„å…ƒæ•°æ®ä¸­ã€‚èŠ‚ç‚¹å’ŒKubernetes APIæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å—TLSä¿æŠ¤ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a class="ae jr" href="https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-trust" rel="noopener ugc nofollow" target="_blank">é›†ç¾¤ä¿¡ä»»</a>ã€‚</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><p id="8faa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Kubernetesæˆæƒ</strong></p><p id="86a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Kubernetesä½¿ç”¨APIæœåŠ¡å™¨æˆæƒAPIè¯·æ±‚ã€‚å®ƒæ ¹æ®æ‰€æœ‰ç­–ç•¥è¯„ä¼°æ‰€æœ‰è¯·æ±‚å±æ€§ï¼Œå¹¶å…è®¸æˆ–æ‹’ç»è¯·æ±‚ã€‚APIè¯·æ±‚çš„æ‰€æœ‰éƒ¨åˆ†éƒ½å¿…é¡»è¢«æŸä¸ªç­–ç•¥å…è®¸æ‰èƒ½ç»§ç»­ã€‚è¿™ç§æˆæƒçš„åŠŸèƒ½ä¸€èˆ¬åœ¨<a class="ae jr" href="https://github.com/kubernetes/apiserver/blob/585f7eed30ae80d4b946d4b7c849dd47febdc498/pkg/endpoints/filters/authorization.go#L45" rel="noopener ugc nofollow" target="_blank">é‚£é‡Œ</a>ä¸­æåˆ°ã€‚æœ‰å‡ ç§<a class="ae jr" href="https://kubernetes.io/docs/reference/access-authn-authz/authorization/" rel="noopener ugc nofollow" target="_blank">æˆæƒæ¨¡å¼</a>ï¼Œå…¶ä¸­ä¸€ä¸ªä¾‹å­æ˜¯RBACï¼Œæˆ–åŸºäºè§’è‰²çš„è®¤è¯æ¨¡å¼ã€‚<code class="du js jt ju jv b">kubectl</code>æä¾›äº†ä¸€ç§ä½¿ç”¨<code class="du js jt ju jv b">auth can-i</code>å‘½ä»¤éªŒè¯ç‰¹å®šAPIæˆæƒå±‚çš„æœºåˆ¶ã€‚</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><p id="2050" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">æ”¯æŒçš„Kuberneteså®¢æˆ·ç«¯</strong></p><p id="a45e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœ‰è®¸å¤šç”±å®˜æ–¹æ”¯æŒæˆ–ç”±ç¤¾åŒºç»´æŠ¤çš„å—æ”¯æŒå®¢æˆ·ç«¯ï¼Œåˆ—è¡¨å¯ä»¥åœ¨<a class="ae jr" href="https://kubernetes.io/docs/reference/using-api/client-libraries/" rel="noopener ugc nofollow" target="_blank">é‚£é‡Œ</a>çœ‹åˆ°ã€‚</p><p id="af62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å®¢æˆ·ç«¯åº“é€šå¸¸ä¼šä¸ºæ‚¨å¤„ç†ä¸€äº›å¸¸è§çš„ä»»åŠ¡ï¼Œä¾‹å¦‚èº«ä»½éªŒè¯ã€‚å¤§å¤šæ•°å®¢æˆ·ç«¯åº“å¯ä»¥å‘ç°å¹¶ä½¿ç”¨KubernetesæœåŠ¡å¸æˆ·æ¥éªŒè¯APIå®¢æˆ·ç«¯æ˜¯å¦åœ¨Kubernetesé›†ç¾¤ä¸­è¿è¡Œï¼Œæˆ–è€…å¯ä»¥ç†è§£<a class="ae jr" href="https://kubernetes.io/docs/tasks/access-application-cluster/authenticate-across-clusters-kubeconfig/" rel="noopener ugc nofollow" target="_blank"> kubeconfigæ–‡ä»¶</a>æ ¼å¼æ¥è¯»å–å‡­è¯ä»¥åŠAPIæœåŠ¡å™¨åœ°å€ã€‚</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><p id="5770" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">ä½¿ç”¨Kubernetes Pythonå®¢æˆ·ç«¯</strong></p><pre class="jx jy jz ka fd la jv lb lc aw ld bi"><span id="0f1c" class="le lf hi jv b fi lg lh l li lj">import os<br/>from kubernetes import client, config, utils<br/>from kubernetes.client.rest import ApiException</span><span id="233e" class="le lf hi jv b fi lk lh l li lj">class Constants(obj):<br/>    NAMESPACE = 'example'</span><span id="f80b" class="le lf hi jv b fi lk lh l li lj">class KubernetesApiClient(obj):<br/>    def __init__(self):<br/>        # load <br/>        try:<br/>            config.load_incluster_config()<br/>        except:<br/>            config.load_kube_config()</span><span id="ee0f" class="le lf hi jv b fi lk lh l li lj">self.configuration = client.Configuration()</span><span id="1d45" class="le lf hi jv b fi lk lh l li lj">def create_batch_api_client(self):<br/>        return client.BatchV1Api(client.ApiClient(self.configuration))</span><span id="9658" class="le lf hi jv b fi lk lh l li lj">def create_job_object(self, job_name, container_image, args):<br/>        volume_name = "" # volume inside of which you put your service account<br/>        google_app_credentials_path = os.environ.get('GOOGLE_APPLICATION_CREDENTIALS')<br/>        volume_mount = client.V1VolumeMount(<br/>            mount_path='/'.join(google_app_credentials_path.split('/')[:-1]),<br/>            name=volume_name<br/>        )</span><span id="160e" class="le lf hi jv b fi lk lh l li lj">env = client.V1EnvVar(<br/>            name='GOOGLE_APPLICATION_CREDENTIALS',<br/>            value=google_app_credentials_path<br/>        )</span><span id="77b9" class="le lf hi jv b fi lk lh l li lj">container = client.V1Container(<br/>            name=job_name,<br/>            image=container_image,<br/>            args=args,<br/>            volume_mounts=[volume_mount],<br/>            env=[env],<br/>            image_pull_policy="Always")</span><span id="85e6" class="le lf hi jv b fi lk lh l li lj">volume = client.V1Volume(<br/>            name=volume_name,<br/>            secret=client.V1SecretVolumeSource(secret_name='&lt;secret-where-you-put-the-service-account&gt;')<br/>        )</span><span id="1a3c" class="le lf hi jv b fi lk lh l li lj">template = client.V1PodTemplateSpec(<br/>            metadata=client.V1ObjectMeta(labels={"app": "sample"}),<br/>            spec=client.V1PodSpec(restart_policy="Never", <br/>                                  containers=[container],<br/>                                  volumes=[volume]))</span><span id="d073" class="le lf hi jv b fi lk lh l li lj">spec = client.V1JobSpec(<br/>            template=template,<br/>            backoff_limit=3,<br/>            ttl_seconds_after_finished=60)</span><span id="f25a" class="le lf hi jv b fi lk lh l li lj">job = client.V1Job(<br/>            api_version="batch/v1",<br/>            kind="Job",<br/>            metadata=client.V1ObjectMeta(name=job_name),<br/>            spec=spec)</span><span id="4e91" class="le lf hi jv b fi lk lh l li lj">return job</span></pre><p id="ceeb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç„¶åä½ å¯ä»¥è°ƒç”¨ä½ çš„ç¨‹åº:</p><pre class="jx jy jz ka fd la jv lb lc aw ld bi"><span id="58e8" class="le lf hi jv b fi lg lh l li lj">api_client = KubernetesApiClient()</span><span id="1454" class="le lf hi jv b fi lk lh l li lj">job_api_client = api_client.create_batch_api_client()</span><span id="247f" class="le lf hi jv b fi lk lh l li lj">job = api_client.create_job_object(job_name, container_image, args)</span><span id="4ec8" class="le lf hi jv b fi lk lh l li lj"><em class="jg">try</em>: <br/>    api_response = job_api_client.create_namespaced_job(<br/>        namespace=Constants.NAMESPACE,<br/>        body=job)<br/>    <em class="jg">print</em>(str(api_response.status))<br/><em class="jg">except </em>ApiException <em class="jg">as </em>e:<br/>    <em class="jg">print</em>(e) # Handle the exception.</span></pre><p id="9e3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨å°†è¯¥åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°é›†ç¾¤ä¸­ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨ä½¿ç”¨çš„æœåŠ¡å¸æˆ·å·²ç»èƒ½å¤Ÿè®¿é—®æ‚¨å°†åœ¨å…¶ä¸­éƒ¨ç½²Kubernetesä½œä¸šçš„åç§°ç©ºé—´ï¼Œå°¤å…¶æ˜¯åœ¨æ‚¨ä½¿ç”¨RBACçš„æƒ…å†µä¸‹ã€‚</p><blockquote class="jd je jf"><p id="e444" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">æˆ‘ä»¬å¸Œæœ›ä½ èƒ½æ´¾ä¸Šç”¨åœºã€‚ğŸ‘‹</p></blockquote></div></div>    
</body>
</html>