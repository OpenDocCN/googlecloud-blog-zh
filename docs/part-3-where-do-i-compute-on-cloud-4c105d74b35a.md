# 通过 GCP 学习云计算—第 3 部分:我在哪里进行云计算？

> 原文：<https://medium.com/google-cloud/part-3-where-do-i-compute-on-cloud-4c105d74b35a?source=collection_archive---------4----------------------->

> “每个从哈佛出来的孩子，每个从学校出来的孩子现在都认为自己可以成为下一个马克·扎克伯格，有了云计算这样的新技术，他实际上有机会。”–脸书董事会成员马克·安德森

现在我们已经了解了[什么是](/@abhinavbhatiaoncloud/cloud-demystified-507c60d3f849)云以及它的[服务模型](/@abhinavbhatiaoncloud/cloud-models-simplified-98fa1c2880aa)，我们还讨论了数字应用的层次(还记得吗？)我们脑海中出现的下一个问题可能是我该如何开始。我希望在这篇博客中解决的第一个问题是，我在哪里计算我的数据？在这里，我将使用谷歌云平台来描述各种选项，以便您可以从一开始就动手操作。

## 一些免责声明

在这个博客系列中讨论的所有观点都是我自己的，决不能归因于来自我现在或曾经是其中一部分的公司。这些是我学到的东西，我试图用尽可能简单的方式表达出来。我明白过度简化有时会导致另一种可能不真实的版本。我会尽最大努力不要过于简单化，但我唯一的要求是对所有这些持保留态度。从尽可能多的来源进行验证。

如果您想了解更多关于 GCP 自由层选项的信息，请将此链接[加入书签。](https://cloud.google.com/free/?utm_source=google&utm_medium=cpc&utm_campaign=japac-IN-all-en-dr-bkws-all-all-trial-e-dr-1009882&utm_content=text-ad-none-none-DEV_c-CRE_498644236031-ADGP_Hybrid%20%7C%20BKWS%20-%20EXA%20%7C%20Txt%20~%20GCP%20~%20Trial%20_%20Free%20Tier-KWID_43700060832181398-aud-970366092687%3Akwd-310728589823&userloc_9061657-network_g&utm_term=KW_gcp%20free%20tier&gclid=Cj0KCQiA7oyNBhDiARIsADtGRZYBNwXy9bADtmVtt5JBvZQqXcVkhoTCDUMCkNYk-L4cKilbQ3U6HYQaAltCEALw_wcB&gclsrc=aw.ds)

> 基本上，新客户可以获得 300 美元的免费积分，以全面探索和评估谷歌云平台。在你选择升级之前，不会向你收费。在写这篇文章的时候，免费层是 90 天。
> 
> 免费体验热门产品，包括计算引擎和云存储，[每月限额](https://cloud.google.com/free/docs/gcp-free-tier)。这些免费服务不会过期。

您需要一张信用卡才能使用免费等级帐户。这个来自[谷歌云技术](https://www.youtube.com/channel/UCJS9pqu9BzkAMNTmzNMNhvg)的[视频](https://www.youtube.com/watch?v=P2ADJdk5mYo)总结了如何使用它，可能会回答你所有的问题。

第二种尝试的方式是 [qwiklabs](https://www.qwiklabs.com/) ，在那里你可以得到各种实验室和任务的导游，你可以很容易地使用它来获得一个实验室的定时访问，在那里你可以很容易地通过实验室学习 GCP。

跳回到这次讨论的主题 ***我在哪里计算？，*** 我们心中的主要想法和问题是我在哪里运行我的应用程序。GCP 给出了一些选择，而如何在这些选择中做出选择正是我们将在这篇博客中探讨的。

1.  [](https://cloud.google.com/compute)****【虚拟机】:**谷歌计算引擎(GCE)本质上是一个 ***虚拟机*** ，供您运行操作系统、中间件、运行时和应用程序及其数据。当您需要大量**控制(**您想要决定什么操作系统、什么特定补丁、什么安全更新、系统需要强化到什么程度、控制我必须给我的应用程序多少资源， 使用配置管理工具或自行设置正确的资源配置)并且您同意自行完成许多工作，以实现**最少管理(**分配资源、选择实例类型、选择操作系统、创建网络、设置防火墙规则、WAF 规则、自行扩展资源或使用云提供的结构，如实例组、监控、分配存储、执行备份)选项。 这并不是说你故意想通过选择一个最少管理的选项来增加你的工作量。你本质上是在寻求更多的控制，你预见到**控制**的好处会超过自己做大部分工作的坏处。你仍然可以从谷歌云获得工具来帮助你监控([云操作](https://cloud.google.com/products/operations))或备份( [PD 快照](https://cloud.google.com/compute/docs/disks/create-snapshots)或 [Actifio](https://www.actifio.com/solutions/saas/actifio-go-for-google-cloud/) )，但是正如我们在之前的博客中所讨论的，配置和管理这些工具并支付费用是你的责任。球在你的球场上。**

**注意:您也可以使用[Google VMware Engine](https://cloud.google.com/vmware-engine)(GVE)创建虚拟机，在这里，只需点击一个按钮，即可提供一个基于 VMware 的软件定义的数据中心(具有计算、存储和网络虚拟化功能)。通常，如果您已经是 VMware 的内部客户，并且希望在与其他谷歌云服务集成的同时，在谷歌云上获得同样的体验，您会选择 GVE。**

*   **通常，当您运行 COTS ***(商用现货)*** 应用程序/ISV(独立软件供应商)应用程序时，您会使用虚拟机，并且他们只认证虚拟机在特定版本(主版本和次版本)的操作系统上运行。基本上，你很乐意运行应用程序，因为它是虚拟机来拯救你。**
*   **如果您正在从另一个云/内部和 ***迁移您的应用程序，您不知道谁编写了您的代码(如果您必须更改您的应用程序)*** 。您不想花时间重新构建容器(稍后会详细介绍)，并且您想选择最安全的选项，VM 是您的最佳选择。**

**![](img/361dd450976fab73b584e824d265903f.png)****![](img/4845c0ad1dfa85ea135cba922588e456.png)**

**创建虚拟机之前要选择的一些计算引擎选项**

**在了解 GKE 之前，让我们先暂停一下，了解一下集装箱。对于虚拟机，我们知道使用虚拟机管理程序我们创建了一个虚拟版本的 CPU、RAM(本质上是一个服务器),我们在其上运行自己的操作系统和堆栈的其余部分。但本质上，虚拟机有助于以虚拟形式创建数据中心的一部分，以便易于管理和部署。但是，在虚拟机之上，我们仍然必须为每台虚拟机安装我们的操作系统、中间件、运行时、应用程序及其数据，如果有 1000 台虚拟机，我们必须为全部 1000 台虚拟机安装，如果有更新/补丁和安全更新，我们必须自己管理。当然，正如我之前所说的，有一些工具(配置管理)可以帮助简化这项工作，但是对于一大组虚拟机来说，这样做可能会变得太复杂太快。**

**容器可以帮助我们，我们将应用程序及其库、中间件、执行命令(例如 node server.js)以及二进制文件所在的工作目录打包到一个容器映像中。基本上，这个想法是将所有东西都包含在这个映像中，这样它就可以移植到任何地方，在任何地方运行。**

**为了理解容器的下一部分，我必须简化操作系统。请仔细阅读操作系统的技术定义，但本质上*操作系统只不过是在硬件和您的应用程序/用户之间运行的一堆软件(指令)，有助于将指令从高级(从用户/应用程序(如 java/c++)翻译成低级(字节码)*。**

**使用容器，您将这个操作系统分成多个容器，本质上是进行操作系统虚拟化。操作系统软件(指令束)存储在*内存*中，这是一个存储区。 ***内核*** 是那些操作系统软件中的主要软件，它们本质上执行许多低级任务，驻留在内存的**内核空间**中。所有其他程序，包括我们自己的应用程序，都存在于用户空间中。 ***所有容器共享同一个内核空间，但每个容器都有自己的用户空间*****

**![](img/e8ace5c34420fc0c8154222cea2799ea.png)**

****虚拟机 vs 容器****

**容器化不是一个与进行硬件虚拟化的虚拟机管理程序竞争的概念。它与虚拟机密切配合。因此，虽然您可以(这也是一个有争议的问题)在裸机服务器上直接运行容器，而您没有安装或管理额外的虚拟机管理程序层，但通常许多容器的部署都是在虚拟机上进行的，这样您可以两全其美( ***虚拟机在维护和管理方面的优势，以及容器在可移植性和灵活性方面的优势*** )。一个著名的容器运行时叫做 Docker。还有许多其他的，像 [runc](https://www.docker.com/blog/runc/) 、 [containerd](https://containerd.io/) 、[基于 windows 的容器](https://docs.microsoft.com/en-us/virtualization/windowscontainers/about/)(是的，这不是 linux 独有的概念，甚至 Windows 现在也有容器了)。为了在一个更加生产就绪的系统中运行容器，在该系统中，您使用一组机器(称为集群)来运行容器，您还需要一个层来协调各种任务并为您完成这些任务，您可以在其中创建对象(或构造)来管理您的部署、网络、安全性、高可用性以及许多其他管理和应用程序功能。一个著名的编排层叫做 ***Kubernetes*** 。还有其他的像 [**docker swarm**](https://docs.docker.com/engine/swarm/) 和 [**Apache Mesos**](http://mesos.apache.org/) 。**

***PS:容器和容器编排本身就是一个全新的话题。这个博客系列的目标是以一种简化的方式解释云。可能在未来的一些帖子中，我会详细介绍这些概念。***

**2. [**谷歌 Kubernetes 引擎**](https://cloud.google.com/kubernetes-engine)**【GKE】【容器引擎】:**因此，如果您的应用程序是容器化的，谷歌 Kubernetes 引擎是最好的容器编排引擎之一，其中谷歌云管理整个控制平面操作，您可以管理和处理工作节点。同样，对于 GKE，许多**控制**仍然由您掌握，但本质上这些控制都适用于您想要创建的集群，即扩展、网络和安全结构。因此，在 GCE 模型中，您考虑的是单个虚拟机的所有结构，并利用其他工具将相同的结构应用到其他虚拟机，而在 GKE，您考虑的是整个集群。**

**这里有一个著名的[牛 vs 宠物](http://cloudscaling.com/blog/cloud-computing/the-history-of-pets-vs-cattle/)的类比，作为一个最佳实践，它总是被建议像有编号的牛一样使用您的服务器，您将它们作为一个整体来管理，如果一个坏了，您用新的来替换它，但是其余的 999 个在此期间仍然在执行工作。Kubernetes 就是那个帮助你以那种方式对待你的服务器的牧羊人。在这种模式下，您创建虚拟机并在其上安装组件，然后手动或使用工具对接下来的 999 台机器重复执行此操作，您将服务器视为宠物，如果其中一台出现故障，您将竭尽全力将其恢复正常。这不是现代推荐的计算使用方式。即使当您使用 GCE 时，也应该使用其他结构，如实例组，在这些结构中，您可以一起配置一组虚拟机，并进行滚动更新、回滚，但所有这些以及更多内容也可以在 *kubernetes* 架构中获得。**

**所以基本上你会选择谷歌 Kubernetes 引擎**

*   **您有一个**容器化的应用程序**或者如果您想迁移到这种新的现代架构中，您可以花一些精力来容器化您现有的基于虚拟机的应用程序。**
*   **您希望从**整体架构转移到基于微服务的架构**。微服务不仅仅是基于容器的架构。这更像是一种设计模式，将应用程序分解成更小的微服务(*想想电子商务应用程序微服务，如结账、退货、购买、上传产品等*)，这样就可以轻松地淘汰和替换、部署和管理。容器是微服务的最佳部署模型之一(但也有人将虚拟机用于微服务)**
*   **如果你要从另一个云/内部迁移你的应用，你会选择 GKE 如果
    -如果你想**更新**你的应用，因为当前的应用不是你想要的，你必须做得更好。
    -通常对于**无状态工作负载来说** s kubernetes 或容器是最好的选择。你当然可以在容器上托管有状态的工作负载(比如数据库),但是有很多事情围绕着数据库的管理。Kubernetes 在某种程度上(像操作符/有状态集)有助于实现这些，但是复杂性也随之而来，它变成了一个权衡利弊的游戏。**

**![](img/b00f03c961a2011aab434443bf4f1928.png)**

**GCP 上 Kubernetes 星团的一些控制**

**3.[**App Engine**](https://cloud.google.com/appengine)**/**[**Cloud Run**](https://cloud.google.com/run)[**server less**]:第三种方式，你可以使用 Cloud 在 **serverless** 栈中托管或迁移你的应用。无服务器仅仅意味着您在任何时候都不会管理这些服务器，(*您可能会在一些无服务器部署中看到它们，例如，有一个选项可以获得对应用引擎实例的 SSH 访问，但您永远不会处理它们*。我先讨论一下 App Engine。App Engine 是来自 Google Cloud 的 PaaS 服务，您只需要提供您的代码，App Engine 会处理其余的工作，包括为您提供托管环境、操作系统和运行时环境。 **App 引擎**有两种口味**标配**和 **Flex** 。[尽管 App Engine flex 在 docker 容器中运行您的代码，但即使在不使用应用程序时，也至少有 1 个实例，建议用于*“接收稳定流量、经历定期流量波动或满足逐渐扩大和缩小的参数的应用程序。”*](https://cloud.google.com/appengine/docs/the-appengine-environments)**

**[**云运行**](https://cloud.google.com/run) 基于开源的 [Knative](https://knative.dev/docs/) stack 提供以无服务器方式运行容器。App Engine Flex 和 Cloud Run 之间的区别在于，Cloud Run 可以缩减至零，而且在计费模式方面还有其他区别，Cloud Run 提供了更精细的定价。但这并不是说一个比另一个好。您的参数可能会有所不同，建议您尝试这两种不同的服务，自己找出哪一种适合您的用例。您可以在这里看到并检查差异[。](https://cloud.google.com/hosting-options#footnote-4)**

**还有另一个选项叫做 Anthos 的 [**云运行，您可以通过**](https://cloud.google.com/anthos/run) **[Anthos](https://cloud.google.com/anthos) 订阅在您的 GKE 环境中运行基于 [Knative](https://knative.dev/docs/) 的云运行。您可以将 Pods(一个 kubernetes 构造)缩小到零，但是由于节点不会缩小，所以即使您的应用程序没有接收到任何流量，您也必须付费。它不支持后台进程，但如果除了其他应用程序之外，它还运行在您自己的 GKE 集群上，那么您可以获得很多控制，其中一些在此处**突出显示[(如选择您的计算、内存和自动扩展要求)。](https://cloud.google.com/anthos/run/docs/choosing-a-platform#comparison_table)**

********

**![](img/89ff00808735842ced5227abe30fc527.png)**

**因此，总结来说，您应该为以下用例选择一种无服务器的方式来托管您的应用程序:**

*   **你有一个熟练的团队。主要标准是你的团队有多大或者有多熟练。如果你认为你的团队应该把他们的时间花在其他增值活动上，比如尽可能写最高效的代码，而不是管理服务器，那么无服务器是你最好的朋友。您仍然需要 devops 或(cloudops 团队)来确保代码在无服务器基础架构上顺利部署，但与管理虚拟机、存储、备份等的团队相比，这可能是一个小团队。无服务器团队的技能组合会稍有不同，因此在雇佣资源之前请记住这一点。**
*   **归根结底，IT 部门的大多数决策都是基于一个问题“我是否符合我的 IT 预算？”。预算是根据公司的总体发展方向制定的，重要的是不要超出预算。无服务器比托管在虚拟机上更便宜吗？简而言之，这要视情况而定。如果您的 web 应用程序规模缩小到零(例如在夜间)，没有后台处理，请求数量也不是很大，那么云运行将是最佳选择，但如果请求数量变得太大，则需要后台处理，并且您希望始终保持最小数量的实例，云运行可能比 GCE 昂贵，但您必须看到与雇用您的完整 devops 团队相比，这有多昂贵。我故意没有给出请求数量的确切数字，因为建议对在虚拟机上运行 web 应用程序与在云上运行(或其他无服务器选项)进行测试比较，以获得特定于您的用例的正确成本比较。可能有其他场景，其中一个可能比另一个更好，但是通过自己测试来获得正确的比较总是最好的主意。**

**![](img/29f3f141db8500125818b8bfe38979ad.png)**

**云运行的一些选项**

**![](img/46db0e267d9722f667e090c45b115fd6.png)**

**App Engine 仪表盘一览**

**4.**云功能/云运行 Eventarc【事件驱动无服务器】**:一个应用并不是一个整天为用户服务的单一大块。它由不同的模块组成，每个模块都有不同的功能和用途。例如，在一个简单的 web 应用程序中将. doc 文件转换为。只有当有人上传文件时，应用程序的文档处理模块才会开始工作。类似地，在电子商务应用程序中，像我这样的人花费大部分时间来寻找最佳交易，并在大量研究后才下订单，所以只有当有人点击购买按钮时，订单处理才会出现。关键是应用程序的许多组件都是事件驱动的。当那发生的时候做这个。在传统的单一世界中，您可能会全天候运行虚拟机，因为您无法预测用户何时点击购买或何时上传文档。在处理微服务的现代世界中，您可以选择使用事件驱动的框架。**

**在这一点上，GCP 有两个选择。云函数，你只需要写代码来响应一个触发器。另一个选项是 Cloud Run，其中可以定义 Eventarc 触发器，并且需要提供相应的容器映像，它将运行以响应触发器。在回应任何服务之前，一定要查看一下限制页面，看看你的应用程序是否没有影响到任何服务。你可以在这里找到云函数[配额和限制](https://cloud.google.com/functions/quotas)和云运行事件弧[。这个阶段的一个重要区别是时间限制。此时，云功能只能支持 9 分钟的处理时间，而云运行可以支持 60 分钟。](https://cloud.google.com/run/quotas#quotas_and_rate_limits)**

**![](img/58f22b778669799a16be57d17b9b3967.png)**

**云函数的一些选项**

**![](img/4d3e2773fb5ba4c37f2381a5f0f2bee6.png)**

**查看云运行的 Eventarc 触发器**

**总之，在以下情况下，您可以使用事件驱动的无服务器框架**

*   **您的应用程序依赖于外部触发器工作。**
*   **您有一个基于微服务的架构，因为只有这样，您才能将这些事件驱动的无服务器框架用于一些依赖外部触发器的微服务。**

**因此，在决定在哪里运行计算时，这些是您必须考虑的各种选项。下图是我们讨论过的所有选项的最佳总结(原文可以在[这里](https://cloud.google.com/hosting-options#footnote-4)找到)。**

**![](img/dbfeb9129df8761b0a9b44e684d96b4a.png)**

**因此，希望在这篇博客之前，您能够了解云计算选项。与计算相关的一个重要部分是存储，这是我们接下来将在[第 4 部分中学习的内容:我将数据存储在云的什么位置？](https://medium.com/p/f672b1a3bbb2/edit?source=your_stories_page----------------------------------------)**

**点击此处查看其他部分:**

**— [**通过 GCP 学习云—第一部分:什么是云？**)](/@abhinavbhatiaoncloud/part-1-what-is-cloud-507c60d3f849?source=your_stories_page----------------------------------------)**

**— [**通过 GCP 学习云—第二部分:我如何使用云？**](/@abhinavbhatiaoncloud/part-2-how-can-i-consume-cloud-98fa1c2880aa?source=your_stories_page----------------------------------------) 在这里，我将首先讨论软件应用程序的各个层，然后了解不同的服务模型，在这些服务模型中，这些层由云供应商捆绑销售，并采用共同责任模型。(IaaS、PaaS、SaaS、FaaS、XaaS)**

**— [**通过 GCP 学习云计算——第三部分:我在哪里进行云计算？**](/@abhinavbhatiaoncloud/part-3-where-do-i-compute-on-cloud-4c105d74b35a?source=your_stories_page----------------------------------------) (本博客)**

**— [**通过 GCP 学习云计算——第 4 部分:我在哪里存储我的云数据？**](/@abhinavbhatiaoncloud/part-4-where-do-i-store-my-data-on-cloud-f672b1a3bbb2?source=your_stories_page----------------------------------------) 在这里，我将尝试回答一个非常相关的问题，即如何选择合适的存储单元来保存您的数据。(OLTP vs OLAP，ETL vs ELT，SQL vs NoSQL，文件 vs 块存储，什么是 NewSQL？)**

**— [**通过 GCP 学习云—第 5 部分:如何连接到我的云？**](/@abhinavbhatiaoncloud/part-5-how-do-i-connect-to-my-cloud-53279e1e9e5e?source=your_stories_page----------------------------------------) 在这里，我将讨论一些云上可用的重要网络和安全结构。(负载平衡器、DNS、CDN、WAF、VPC)**