<html>
<head>
<title>Convert NORMALIZE (Teradata) to Bigquery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将NORMALIZE (Teradata)转换为Bigquery</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/convert-normalize-teradata-to-bigquery-76deb6af9a40?source=collection_archive---------1-----------------------#2022-11-11">https://medium.com/google-cloud/convert-normalize-teradata-to-bigquery-76deb6af9a40?source=collection_archive---------1-----------------------#2022-11-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="2dc0" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">介绍</h1><p id="3dec" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">NORMALIZE是ANSI SQL标准的Teradata扩展。当SQL表中包含一个具有period数据类型的列时，NORMALIZE会合并该列中相交或重叠的值，以形成一个合并多个单独的period值的PERIOD。</p><p id="bb20" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">要使用NORMALIZE，SQL选择列表中至少有一列必须是Teradata的时态周期数据类型。</p><p id="252d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">Bigquery目前不支持表中的周期数据类型。相反，我们需要将一个Teradata周期数据字段分成两部分:例如start_date和end_date</p><h1 id="b57a" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">先决条件</h1><ol class=""><li id="85cd" class="kg kh hi jf b jg jh jk jl jo ki js kj jw kk ka kl km kn ko bi translated">Teradata数据仓库及其SQL语法的基础知识</li><li id="fec9" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka kl km kn ko bi translated">对Bigquery及其SQL语法有很好的理解</li></ol><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/8f9d0800a20f31d8f147c272feaac68a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iJiNFGQVSO12IedkL709lA.png"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">Teradata SQL到Bigquery SQL</figcaption></figure><h1 id="1a04" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">转换逻辑</h1><h2 id="f606" class="lk ig hi bd ih ll lm ln il lo lp lq ip jo lr ls it js lt lu ix jw lv lw jb lx bi translated">示例场景:</h2><p id="2710" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">假设在下面的例子中，我们将对employee_id进行规范化。此处，期间列分为两部分(开始日期和结束日期)</p><p id="579a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">样本数据如下所示</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ly"><img src="../Images/b212afa60cbc7bb6784ef89130c067ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8vAYYFLAWXZHmBmf"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">员工详情表</figcaption></figure><h2 id="30e6" class="lk ig hi bd ih ll lm ln il lo lp lq ip jo lr ls it js lt lu ix jw lv lw jb lx bi translated">Teradata SQL:</h2><blockquote class="lz ma mb"><p id="cdde" class="jd je mc jf b jg kb ji jj jk kc jm jn md kd jq jr me ke ju jv mf kf jy jz ka hb bi translated"><em class="hi">从poc_aa_cs中选择符合或重叠emp_id，duration <br/>时归一化。normalize _ Emp _ Details<br/>ORDER BY 1，2；</em></p></blockquote><h2 id="9afd" class="lk ig hi bd ih ll lm ln il lo lp lq ip jo lr ls it js lt lu ix jw lv lw jb lx bi translated"><strong class="ak">输出:</strong></h2><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es mg"><img src="../Images/5348eb66e4514d3a8ce46e261fd2bafb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jN0jYmfiZq5vVxVm_cGP2Q.png"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">标准化输出</figcaption></figure><h2 id="6740" class="lk ig hi bd ih ll lm ln il lo lp lq ip jo lr ls it js lt lu ix jw lv lw jb lx bi translated"><strong class="ak">大查询SQL: </strong></h2><blockquote class="lz ma mb"><p id="b914" class="jd je mc jf b jg kb ji jj jk kc jm jn md kd jq jr me ke ju jv mf kf jy jz ka hb bi translated">从<br/>中选择S2.emp_id，MIN(S2.start_date)作为new_start_date，MAX(S2.end_date)作为new_end_date <br/>(选择S1。*，SUM(group start flag)OVER(PARTITION BY EMP _ id ORDER BY start_date ROWS UNBOUNDED precending)As GroupID<br/>FROM(SELECT EMP _ id，start_date，end_date，(当start _ date&lt;= LAG(max _ end_date)OVER(PARTITION BY EMP _ id ORDER BY start _ date，END _ date)tha EN 0 ELSE 1 END)As group start flag<br/>FROM(SELECT EMP _ id，start _ date，END _ date，max(END _ date)OVER(PARTITION BY EMP _ id ORDER BY startnormalize _ Emp _ details `))S1<br/>)S2<br/>按S2.emp_id分组，S2。GroupID <br/> ORDER BY 1，2；</p></blockquote><h2 id="cdb8" class="lk ig hi bd ih ll lm ln il lo lp lq ip jo lr ls it js lt lu ix jw lv lw jb lx bi translated">翻译解释:</h2><ul class=""><li id="330d" class="kg kh hi jf b jg jh jk jl jo ki js kj jw kk ka mh km kn ko bi translated">此LAG函数返回分区中当前行之上(之前)给定偏移量的行的值。</li><li id="c78b" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka mh km kn ko bi translated">您可以使用LAG函数，通过确定某个期间是否与前一个期间重合(如果是，则为0；如果不是，则为1)，来确定开始新期间的每一行</li><li id="3a01" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka mh km kn ko bi translated">当这个标志累加起来时，它提供了一个组标识符，可以在外部Group By子句中使用该标识符来获得所需的结果。</li><li id="4cd6" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka mh km kn ko bi translated">S1的产量如下</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es mi"><img src="../Images/d7f08a78dd40bfc66914df2eff2fe12b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DdddHGiX70f11AVA"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">S1的产量</figcaption></figure><ul class=""><li id="e95d" class="kg kh hi jf b jg kb jk kc jo mj js mk jw ml ka mh km kn ko bi translated">S2的产量如下</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es mm"><img src="../Images/6ef0212b19dc0bb730ae0dbc3ef0afff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0PBaKLuzaPKWfTax"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">S2的产量</figcaption></figure><p id="7a85" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">经过这些更改后，Bigquery SQL将生成与Teradata相同的输出。</p></div></div>    
</body>
</html>