<html>
<head>
<title>YouTube API + Cloud Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">YouTube API +云运行</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/youtube-api-cloud-run-41109db98584?source=collection_archive---------0-----------------------#2019-11-20">https://medium.com/google-cloud/youtube-api-cloud-run-41109db98584?source=collection_archive---------0-----------------------#2019-11-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ec58db09a84ce80a6d8ae104922f754b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GkteFyRmSfoO2I5HMav0fg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">哥伦比亚<a class="ae iu" href="https://goo.gl/maps/BhJ9poh4r2m6aaa19" rel="noopener ugc nofollow" target="_blank">麦德林现代艺术博物馆</a>的云跑贴纸。YouTube + Python标志。</figcaption></figure><p id="6c8e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">YouTube提供了一个免费、简单、强大的API，用于以编程方式查询和与YouTube交互。在本文中，我们将讨论如何构建一个无服务器的应用程序来返回随机的猫视频🐱使用<strong class="ix hj">云运行</strong>和<strong class="ix hj"> YouTube API </strong>中的<strong class="ix hj"> Python </strong>。</p><h2 id="b0a0" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">我们将分三步构建我们的web应用程序:</h2><ol class=""><li id="b1a0" class="ko kp hi ix b iy kq jc kr jg ks jk kt jo ku js kv kw kx ky bi translated">启用YouTube API并创建API密钥。</li><li id="86c8" class="ko kp hi ix b iy kz jc la jg lb jk lc jo ld js kv kw kx ky bi translated">用Python 3写一个Flask应用。</li><li id="a7f3" class="ko kp hi ix b iy kz jc la jg lb jk lc jo ld js kv kw kx ky bi translated">将服务部署到云运行。</li></ol><h1 id="8640" class="le ju hi bd jv lf lg lh jz li lj lk kd ll lm ln kg lo lp lq kj lr ls lt km lu bi translated">设置YouTube API</h1><p id="483c" class="pw-post-body-paragraph iv iw hi ix b iy kq ja jb jc kr je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">YouTube为查询视频、查看视频分析和直播等任务提供了各种API。</p><p id="9bf8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">YouTube<a class="ae iu" href="https://developers.google.com/youtube/v3" rel="noopener ugc nofollow" target="_blank">DataAPI</a>(v3)让我们可以像在搜索栏中一样轻松地查询YouTube的视频数据库。API密钥可用于身份验证。</p><h2 id="0cb3" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">启用YouTube数据API v3</h2><p id="adf8" class="pw-post-body-paragraph iv iw hi ix b iy kq ja jb jc kr je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">启用YouTube数据API (v3):</p><ol class=""><li id="c364" class="ko kp hi ix b iy iz jc jd jg lz jk ma jo mb js kv kw kx ky bi translated">去console.cloud.google.com/flows/enableapi?apid = YouTube . Google APIs . com。</li><li id="80c7" class="ko kp hi ix b iy kz jc la jg lb jk lc jo ld js kv kw kx ky bi translated">选择您的项目并按下<code class="du mc md me mf b">Continue</code>。</li></ol><h2 id="b05a" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">下载API密钥</h2><ol class=""><li id="0993" class="ko kp hi ix b iy kq jc kr jg ks jk kt jo ku js kv kw kx ky bi translated">去console.cloud.google.com/apis/credentials。</li><li id="be7f" class="ko kp hi ix b iy kz jc la jg lb jk lc jo ld js kv kw kx ky bi translated">点击<code class="du mc md me mf b">Create Credentials</code>，然后点击<code class="du mc md me mf b">API key</code>。</li><li id="dfe1" class="ko kp hi ix b iy kz jc la jg lb jk lc jo ld js kv kw kx ky bi translated">复制这把钥匙。你以后会需要它的。</li></ol><h1 id="9f0b" class="le ju hi bd jv lf lg lh jz li lj lk kd ll lm ln kg lo lp lq kj lr ls lt km lu bi translated">安装Python依赖项</h1><p id="4550" class="pw-post-body-paragraph iv iw hi ix b iy kq ja jb jc kr je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated"><em class="ly">确保使用虚拟环境</em><code class="du mc md me mf b"><em class="ly">venv</em></code><em class="ly"/><code class="du mc md me mf b">source env/bin/activate</code>。</p><p id="02f1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个演示中，我们将创建一个简单的Python web服务器。用<code class="du mc md me mf b">pip</code>安装Flask、Google API客户端和Google Auth helper:</p><pre class="mg mh mi mj fd mk mf ml mm aw mn bi"><span id="faa5" class="jt ju hi mf b fi mo mp l mq mr">pip install --upgrade flask google-api-python-client google-auth-httplib2</span></pre><h1 id="2397" class="le ju hi bd jv lf lg lh jz li lj lk kd ll lm ln kg lo lp lq kj lr ls lt km lu bi translated">编写一个Python Web服务器程序</h1><p id="bba2" class="pw-post-body-paragraph iv iw hi ix b iy kq ja jb jc kr je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">创建一个向YouTube数据API (v3)发出请求的Flask应用程序:</p><figure class="mg mh mi mj fd ij"><div class="bz dy l di"><div class="ms mt l"/></div></figure><h1 id="49b5" class="le ju hi bd jv lf lg lh jz li lj lk kd ll lm ln kg lo lp lq kj lr ls lt km lu bi translated">本地运行Flask应用程序</h1><p id="4d89" class="pw-post-body-paragraph iv iw hi ix b iy kq ja jb jc kr je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">我们将使用Flask CLI在本地测试我们的web服务器:</p><pre class="mg mh mi mj fd mk mf ml mm aw mn bi"><span id="ce69" class="jt ju hi mf b fi mo mp l mq mr">export FLASK_APP=app.py<br/>export KEY=AIzaSyCA-fe_wGJpUthisQgisl25fakeXqUNzk # Your API key<br/>flask run</span></pre><blockquote class="mu mv mw"><p id="d6fa" class="iv iw ly ix b iy iz ja jb jc jd je jf mx jh ji jj my jl jm jn mz jp jq jr js hb bi translated">用之前创建的API键替换<code class="du mc md me mf b">KEY</code>的值。</p></blockquote><figure class="mg mh mi mj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es na"><img src="../Images/827c647b5dcdb237f80187a184c16ed1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A-8G85jTmUHx_f4oWGoYAA.png"/></div></div></figure><p id="01c1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">加载终端打印出来的URL，如<code class="du mc md me mf b"><a class="ae iu" href="http://127.0.0.1:5000/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:5000/</a></code>。</p><p id="2170" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以使用查询参数<code class="du mc md me mf b">q</code>来搜索除默认查询<code class="du mc md me mf b">cats</code>之外的不同视频。</p><p id="ad14" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">左边是来自我们的API的示例响应</p><p id="cfd5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="ly">注意:</em>我使用<a class="ae iu" href="https://chrome.google.com/webstore/detail/json-formatter/bcjindcccaagfpapjjmafapmmgkkhgoa?hl=en" rel="noopener ugc nofollow" target="_blank">这个扩展</a>来创建带有可点击链接的漂亮JSON。</p><h1 id="1bfc" class="le ju hi bd jv lf lg lh jz li lj lk kd ll lm ln kg lo lp lq kj lr ls lt km lu bi translated">将服务部署到云运行</h1><p id="c35c" class="pw-post-body-paragraph iv iw hi ix b iy kq ja jb jc kr je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">为了部署到Google Cloud Run，我们需要确保我们的本地环境与使用Cloud Run的环境相同。为此，让我们创建一个<code class="du mc md me mf b">.env</code>文件来存储我们的API密钥:</p><pre class="mg mh mi mj fd mk mf ml mm aw mn bi"><span id="d564" class="jt ju hi mf b fi mo mp l mq mr">KEY=AIzaSyCA-fe_wGJpUthisQgisl25fakeXqUNzk # Your API key</span></pre><p id="4a54" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们还需要一个<code class="du mc md me mf b">Dockerfile</code>。<code class="du mc md me mf b">Dockerfile</code>声明我们需要一个包含Python 3.7、我们的应用程序文件和我们的包的容器:</p><figure class="mg mh mi mj fd ij"><div class="bz dy l di"><div class="ms mt l"/></div></figure><p id="a9c5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">运行这个shell脚本来构建您的容器并部署到云运行:</p><figure class="mg mh mi mj fd ij"><div class="bz dy l di"><div class="ms mt l"/></div></figure><blockquote class="nb"><p id="d188" class="nc nd hi bd ne nf ng nh ni nj nk js dx translated">太棒了。</p></blockquote><p id="a2cb" class="pw-post-body-paragraph iv iw hi ix b iy nl ja jb jc nm je jf jg nn ji jj jk no jm jn jo np jq jr js hb bi translated">您刚刚在Cloud Run上部署了一个使用YouTube API的Flask应用程序！</p><figure class="mg mh mi mj fd ij er es paragraph-image"><div class="er es nq"><img src="../Images/3cf55e6e87c7cd96306d0a02d750ec67.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/0*HsdSXccq2EkzHdye.gif"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">太棒了。</figcaption></figure><h1 id="f44e" class="le ju hi bd jv lf lg lh jz li lj lk kd ll lm ln kg lo lp lq kj lr ls lt km lu bi translated">后续步骤</h1><p id="2448" class="pw-post-body-paragraph iv iw hi ix b iy kq ja jb jc kr je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">感谢阅读！如果你对这篇博客感兴趣，这里有一些相关的学习资源:</p><ul class=""><li id="3fa0" class="ko kp hi ix b iy iz jc jd jg lz jk ma jo mb js nr kw kx ky bi translated">🎥<a class="ae iu" href="https://developers.google.com/youtube/v3/getting-started" rel="noopener ugc nofollow" target="_blank">文档:YouTube数据API </a></li><li id="4c2f" class="ko kp hi ix b iy kz jc la jg lb jk lc jo ld js nr kw kx ky bi translated">⬢ <a class="ae iu" rel="noopener" href="/google-cloud/node-12-functions-on-cloud-run-d891dd93c7c8">博客发布:在云上部署节点12功能</a></li></ul></div></div>    
</body>
</html>