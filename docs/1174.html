<html>
<head>
<title>Managing SQL Server instances in Cloud SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在云SQL中管理SQL Server实例</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/managing-sql-server-instances-in-cloud-sql-ecee1e48aa4e?source=collection_archive---------2-----------------------#2019-10-21">https://medium.com/google-cloud/managing-sql-server-instances-in-cloud-sql-ecee1e48aa4e?source=collection_archive---------2-----------------------#2019-10-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/5d2642586e0af2de4b1944a8630d95ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yVlO3bm5zeqcFGfHmQ6tAg.png"/></div></div></figure><p id="bbec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">SQL Server现已在云SQL上推出<a class="ae jo" href="https://cloud.google.com/blog/products/databases/leave-no-database-behind-with-cloud-sql-for-sql-server" rel="noopener ugc nofollow" target="_blank">公测版</a>，让您可以轻松地将SQL Server工作负载迁移到Google Cloud。云SQL是一种完全托管的数据库服务，可处理自动备份、安全补丁、高可用性和更新，为内部托管提供了一种成本更低、复杂性更低的替代方案。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jp"><img src="../Images/d348ae6970229c8ad908e8a68289099c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lyAClMMiAHJBaWiNSdvgEw.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated"><strong class="bd jy">云SQL为MySQL、PostgreSQL和SQL Server提供数据库引擎</strong></figcaption></figure><p id="b85d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有许多数据库工具<a class="ae jo" href="https://en.wikipedia.org/wiki/Comparison_of_database_tools" rel="noopener ugc nofollow" target="_blank">可以与云SQL中的SQL Server实例一起使用。例如,</a><a class="ae jo" href="https://cloud.google.com/sql/docs/sqlserver/quickstart" rel="noopener ugc nofollow" target="_blank">云SQL for SQL Server的快速入门</a>带您了解如何创建一个实例并从<a class="ae jo" href="https://docs.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank">SQL Server Management Studio</a>(SSMS)连接到它，这是一个用于管理SQL Server数据库的Windows应用程序。</p><p id="8702" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我们将看看如何在云SQL中将四个流行的数据库工具连接到您的SQL Server实例。无论您喜欢使用哪种工具来运行T-SQL查询和执行常见的数据库管理任务，您都可以将它们与云SQL一起使用。</p><h1 id="8fe8" class="jz ka hi bd jy kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">云SQL代理</h1><p id="587b" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated"><a class="ae jo" href="https://cloud.google.com/sql/docs/mysql/sql-proxy" rel="noopener ugc nofollow" target="_blank">云SQL代理</a>是连接到云SQL实例的推荐方式，因为它提供了改进的安全性和认证管理。代理的TLS加密连接比内置SSL更安全，它使用IAM身份验证和<a class="ae jo" href="https://cloud.google.com/sql/docs/mysql/sql-proxy#invocation" rel="noopener ugc nofollow" target="_blank">选项来提供凭证</a>以支持各种开发和部署场景。该代理适用于客户端应用程序，例如本地安装的数据库管理工具，而使用代理进行本地测试的<a class="ae jo" href="https://cloud.google.com/sql/docs/sqlserver/quickstart-proxy-test" rel="noopener ugc nofollow" target="_blank">快速入门</a>概述了如何安装和配置它以用于SQL Server实例。</p><p id="d333" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">代理运行在本地机器上，通过安全的加密连接管理进出云SQL的流量。数据库工具等应用程序可以在<code class="du lb lc ld le b">127.0.0.1</code>本地连接到代理。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lf"><img src="../Images/e99623a61444753453e08e0102ccf775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ITGq0h1hNem7Tpx_gVR9UQ.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated"><strong class="bd jy">使用云SQL代理将数据库工具连接到SQL Server实例</strong></figcaption></figure><p id="ba75" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">云SQL代理需要凭证来认证到云SQL的连接，在<a class="ae jo" href="https://cloud.google.com/sql/docs/mysql/sql-proxy#invocation" rel="noopener ugc nofollow" target="_blank">云SQL代理文档</a>中有几个选项。使用本地数据库工具时，最简单的认证方式是使用来自经过认证的云SDK客户端的<a class="ae jo" href="https://cloud.google.com/sql/docs/mysql/sql-proxy#gcloud" rel="noopener ugc nofollow" target="_blank">凭证，因此我们将使用这种方法。安装</a><a class="ae jo" href="https://cloud.google.com/sdk/" rel="noopener ugc nofollow" target="_blank"> Cloud SDK </a>并运行<code class="du lb lc ld le b">gcloud auth login</code>命令，您将准备好与代理连接，而无需授权IP地址或配置SSL连接。</p><p id="28fa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您启动代理时，使用<code class="du lb lc ld le b">-instances</code>参数为您的云SQL实例指定实例连接名称。要找到您的实例的连接名称，请单击<a class="ae jo" href="https://console.cloud.google.com/sql/instances" rel="noopener ugc nofollow" target="_blank">云SQL实例列表</a>中的实例，然后查看Overview选项卡下的内容。当您在代理命令行上使用该连接名称时，您需要添加端口1433(SQL Server连接的默认端口)，因此代理命令行如下所示:</p><pre class="jq jr js jt fd lg le lh li aw lj bi"><span id="85ac" class="lk ka hi le b fi ll lm l ln lo">cloud_sql_proxy.exe -instances=&lt;connection-name&gt;=tcp:<strong class="le hj">1433</strong></span></pre><p id="2741" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您还可以使用代理连接到多个云SQL实例。在这种情况下，您需要为每个实例分配不同的TCP端口。例如，下面是连接到两个云SQL实例的语法，第一个在端口1433上，第二个在端口1434上:</p><pre class="jq jr js jt fd lg le lh li aw lj bi"><span id="c479" class="lk ka hi le b fi ll lm l ln lo">cloud_sql_proxy.exe -instances=&lt;connection-name1&gt;=tcp:<strong class="le hj">1433</strong>,&lt;connection-name2&gt;=tcp:<strong class="le hj">1434</strong></span></pre><p id="96b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">大多数面向SQL Server的数据库工具默认使用端口1433，因此您需要显式指定端口1434来将本地客户端连接到该示例中的第二个实例。</p><p id="eda0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您从命令行调用代理时，您可能会发现让它在单独的终端会话中运行很有用，这样您就可以在当前会话中继续工作。在Linux或Mac OS上，您可以简单地在Bash命令的末尾添加一个<code class="du lb lc ld le b">&amp;</code>,在一个单独的子shell中启动代理。在Windows PowerShell中，使用以下语法在单独的进程中启动代理:</p><pre class="jq jr js jt fd lg le lh li aw lj bi"><span id="9b19" class="lk ka hi le b fi ll lm l ln lo">Start-Process -filepath “cloud_sql_proxy.exe” -ArgumentList “-instances=&lt;connection-name&gt;=tcp:1433”</span></pre><p id="71ed" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在代理运行之后，您看到“准备好新连接”消息，您已经准备好使用本地数据库工具连接到云SQL，或者从本地运行的您自己的代码连接。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/524ae734e5579c036ada9deed45f8d69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0qJ2rre5naUazCH0iYKFvQ.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated"><strong class="bd jy">云SQL代理，监听127.0.0.1:1433的新连接</strong></figcaption></figure><h1 id="ced7" class="jz ka hi bd jy kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">Azure数据工作室</h1><p id="6f9b" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated"><a class="ae jo" href="https://cloud.google.com/sql/docs/sqlserver/quickstart" rel="noopener ugc nofollow" target="_blank"> SQL Server quickstart </a>讲述了如何连接SSMS，这是在Windows上工作的SQL Server数据库管理员的普遍选择。<a class="ae jo" href="https://docs.microsoft.com/en-us/sql/azure-data-studio/download?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank"> Azure Data Studio (ADS) </a>是微软的另一个管理SQL Server数据库的工具，它适用于Windows、macOS和Linux。如果你不确定使用哪个工具，微软有一个SSMS和ADS的功能对比，可能会有帮助。注意，SSMS是基于Visual Studio的，而ADS是基于轻量级的VS代码编辑器的，所以ADS比SSMS加载得更快，对于习惯于使用VS代码的开发人员来说会更熟悉。</p><p id="e329" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要试用它，从<a class="ae jo" href="https://docs.microsoft.com/en-us/sql/azure-data-studio/download?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank">下载页面</a>安装Azure Data Studio。确保云SQL代理正在运行(如前所述)，然后在ADS中连接到<code class="du lb lc ld le b">127.0.0.1</code>作为服务器，并使用SQL登录作为身份验证类型。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/38dc7776cde225069b66109b705717ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*FyUV54Dofx2J9v6x73glxA.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated"><strong class="bd jy">从Azure Data Studio连接到云SQL代理</strong></figcaption></figure><p id="e26e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">连接后，您可以编写和运行T-SQL查询，并使用ADS的所有其他功能。例如，如果您想了解T-SQL的MATCH子句如何与图形数据库一起工作，您可以从<a class="ae jo" href="https://docs.microsoft.com/en-us/sql/relational-databases/graphs/sql-graph-sample?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank">文档页面</a>复制T-SQL脚本，并将其粘贴到ADS中并运行它。以下是输出结果:</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/3cb2b21ca976ce1cd271e17091cf3581.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P4kfUcgkTgpD_JC_UVKc3Q.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated"><strong class="bd jy">在Azure Data Studio中运行的图形数据库模式匹配示例与云SQL中的SQL Server实例进行比较</strong></figcaption></figure><h1 id="5c27" class="jz ka hi bd jy kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">VS代码的mssql扩展</h1><p id="c44b" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">如果您正在使用VS代码，<a class="ae jo" href="https://marketplace.visualstudio.com/items?itemName=ms-mssql.mssql" rel="noopener ugc nofollow" target="_blank"> mssql扩展</a>提供了代码完成、大型代码片段库和其他工具，使得编写和运行T-SQL脚本变得容易。</p><p id="2557" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要使用mssql从VS代码进行连接，请按照下列步骤操作:</p><ol class=""><li id="0fe2" class="ls lt hi is b it iu ix iy jb lu jf lv jj lw jn lx ly lz ma bi translated">安装<a class="ae jo" href="https://marketplace.visualstudio.com/items?itemName=ms-mssql.mssql" rel="noopener ugc nofollow" target="_blank"> mssql </a>扩展</li><li id="8cdf" class="ls lt hi is b it mb ix mc jb md jf me jj mf jn lx ly lz ma bi translated">创建一个脚本作为一个<code class="du lb lc ld le b">.sql</code>文件。这个脚本中有什么并不重要，但是为了连接到数据库，脚本文件需要有焦点。</li><li id="46bb" class="ls lt hi is b it mb ix mc jb md jf me jj mf jn lx ly lz ma bi translated">安装扩展后首次创建脚本文件时，将会打开一个终端窗口来初始化SQL tools服务。让这运行到完成。</li><li id="4ab2" class="ls lt hi is b it mb ix mc jb md jf me jj mf jn lx ly lz ma bi translated">转到命令面板(Ctrl-Shift-P)并键入<code class="du lb lc ld le b">sqlcon</code>，然后选择<code class="du lb lc ld le b">MS SQL: Connect</code>，系统会提示您创建一个连接。使用<code class="du lb lc ld le b">127.0.0.1</code>作为服务器名，选择SQL Login作为身份验证类型，并输入您的用户名和密码。</li><li id="7a8d" class="ls lt hi is b it mb ix mc jb md jf me jj mf jn lx ly lz ma bi translated">为连接命名后，它将连接到您的数据库。</li></ol><p id="11d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦连接上，您就可以在编辑脚本时使用Ctrl-Shift-E来运行脚本。脚本输出将显示在脚本右侧的面板中。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/a4b85dd8e9e8574314e16b4ac528a45a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o6ZAo5mjuzpurDJp8o9F8Q.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated"><strong class="bd jy">运行在云SQL实例上的脚本示例，来自VS代码，带有mssql扩展</strong></figcaption></figure><p id="fc2c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有关使用mssql扩展的详细信息，请参阅<a class="ae jo" href="https://docs.microsoft.com/en-us/sql/linux/sql-server-linux-develop-use-vscode?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank">使用Visual Studio代码创建和运行Transact-SQL脚本</a>。</p><h1 id="72e1" class="jz ka hi bd jy kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">mssql-cli实用程序</h1><p id="e069" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">用于SQL Server的mssql-cli命令行查询工具是一个跨平台的cli，用于针对SQL Server实例运行T-SQL命令和脚本。有关如何在Linux、Windows或Mac OS上安装的信息，请参见<a class="ae jo" href="https://github.com/dbcli/mssql-cli/blob/master/doc/installation_guide.md" rel="noopener ugc nofollow" target="_blank">安装指南</a>。</p><p id="0cb8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装mssql-cli后，使用以下语法连接到本地云sql代理:</p><pre class="jq jr js jt fd lg le lh li aw lj bi"><span id="4047" class="lk ka hi le b fi ll lm l ln lo">mssql-cli -U &lt;username&gt; -S “127.0.0.1,1433”</span></pre><p id="84af" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，mssql-cli使用逗号来分隔主机地址和端口，而其他一些工具使用冒号。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/975816828f82abc1a14d8b4626bb3ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6SlYZTxu39E0Fllp5D4Onw.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated"><strong class="bd jy"> mssql-cli提供语法高亮、T-SQL智能感知和多行编辑模式</strong></figcaption></figure><h1 id="ba4b" class="jz ka hi bd jy kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">入门指南</h1><p id="a77c" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">云SQL很容易上手，SQL Server的测试版现已公开，任何人都可以试用。您可以在<a class="ae jo" href="https://cloud.google.com/sql/docs/sqlserver/" rel="noopener ugc nofollow" target="_blank"> Cloud SQL for SQL Server文档</a>中找到快速入门、操作指南、API文档和其他资源。如果你是谷歌云平台(GCP)的新手，<a class="ae jo" href="https://cloud.google.com/free-trial/" rel="noopener ugc nofollow" target="_blank">注册</a>并获得300美元的信用，你可以使用云SQL和其他GCP服务。</p><p id="7aeb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以使用云SQL代理来连接您喜欢的数据库管理工具，如上所述，因此您可以使用您已经知道的工具来管理云SQL实例。有关于使用云SQL的问题吗？请在下面的评论中告诉我们，或者查看<a class="ae jo" href="https://cloud.google.com/sql/docs/sqlserver/getting-support" rel="noopener ugc nofollow" target="_blank">支持页面</a>了解其他支持选项。如果您将参加在西雅图举行的SQL Server PASS峰会，请务必在Cloud SQL展台停下来与团队见面，并观看Cloud SQL的实际应用！</p></div></div>    
</body>
</html>