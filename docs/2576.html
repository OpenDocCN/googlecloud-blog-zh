<html>
<head>
<title>Update strategies for MIG running behind Cloud Load Balancer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云负载均衡器后运行MIG的更新策略</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/update-strategies-for-mig-running-behind-cloud-load-balancer-90a3898b5cb3?source=collection_archive---------6-----------------------#2022-11-30">https://medium.com/google-cloud/update-strategies-for-mig-running-behind-cloud-load-balancer-90a3898b5cb3?source=collection_archive---------6-----------------------#2022-11-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4187" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文描述了在云负载均衡器后面运行的MIG中更新实例模板版本的不同策略。</p><p id="a0c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">计算引擎根据实例模板中指定的配置在MIG中维护虚拟机。</p><p id="54b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设您有一个新版本的实例模板，并且希望将这个新版本的实例模板用于MIG中的所有虚拟机，本文档描述了三种不同的策略来升级MIG中的虚拟机。</p><ul class=""><li id="d6df" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">滚动更新</li><li id="b445" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">金丝雀更新</li><li id="ecb7" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">蓝色/绿色更新</li></ul><h2 id="fd81" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">滚动更新</h2><p id="7a18" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">基本滚动更新是逐渐应用于MIG中所有实例的更新，直到所有实例都更新到最新的预期配置。滚动更新会自动跳过已经处于最新配置中的实例。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kr"><img src="../Images/f4545d6cfe5f1e8ed53834e6c5cf3897.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O71BEqYY3bSdtwKA"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">滚动更新</figcaption></figure><p id="4d19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lh" href="https://cloud.google.com/compute/docs/instance-groups/rolling-out-updates-to-managed-instance-groups#starting_a_basic_rolling_update" rel="noopener ugc nofollow" target="_blank">在MIG中自动应用虚拟机配置更新|计算引擎文档|谷歌云</a></p><h2 id="1012" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">金丝雀更新</h2><p id="03fc" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">canary更新是应用于组中实例子集的更新。使用canary update，您可以在随机的实例子集上测试新功能或升级，而不是对所有实例进行潜在的破坏性更新。如果更新进展不顺利，您只需要回滚实例的子集，将对用户的干扰降到最低。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kr"><img src="../Images/030e465e7400e8502cbb79c2c3f02026.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bi41dSRV3VH-I64N"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">金丝雀更新</figcaption></figure><p id="f1dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lh" href="https://cloud.google.com/compute/docs/instance-groups/rolling-out-updates-to-managed-instance-groups#canary_updates" rel="noopener ugc nofollow" target="_blank">在MIG中自动应用虚拟机配置更新|计算引擎文档|谷歌云</a></p><h2 id="9bb8" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated"><strong class="ak">蓝/绿更新</strong></h2><p id="968c" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">蓝/绿更新是一种更新，其中新版本的MIG使用最新的启动模板，MIG中的实例数量与现有MIG的容量相等。</p><p id="b62b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为这是一个蓝/绿更新，所以您不是更新MIG中的实例，而是在负载平衡器后面更改整个MIG。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kr"><img src="../Images/4b2417d41904ac82ec6597126f5e95aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1lh3eQKSLPVYcVgM"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">蓝色/绿色</figcaption></figure><p id="5fc9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用蓝/绿更新来更新MIG的步骤:</p><ul class=""><li id="15d7" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">最初创建一个负载平衡器</li><li id="b535" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">制造一架米格飞机(蓝色)</li><li id="bfde" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">给蓝色米格战机发送100%的流量。</li></ul><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es li"><img src="../Images/66a6b05724c9d36c654b44473bb8e407.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1CnJjMvrinrTH5529lfaSg.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">蓝色米格</figcaption></figure><ul class=""><li id="ce9f" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">使用新的实例模板旋转新的MIG(绿色)。</li><li id="389e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">最初更新负载平衡器的后端配置，以向该MIG发送0%的流量。</li></ul><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lj"><img src="../Images/c887dbc161337c319ebb85018ceddd01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8fxZ1iBJDWd639vKi2n39w.png"/></div></div></figure><ul class=""><li id="fc9c" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">MIG稳定后，更新负载平衡器的后端，将100%的流量发送给绿色MIG，并删除蓝色MIG。</li></ul><blockquote class="lk ll lm"><p id="2faa" class="if ig ln ih b ii ij ik il im in io ip lo ir is it lp iv iw ix lq iz ja jb jc hb bi translated">在滚动/淡黄色更新中，MIG中的虚拟机更新到新的实例模板版本，而在蓝色/绿色中，整个MIG更新到新的实例模板版本并连接到负载平衡器。</p></blockquote></div></div>    
</body>
</html>