<html>
<head>
<title>Big Data, BigQuery and a story of bikes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">大数据、大查询和自行车的故事</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/big-data-bigquery-and-a-story-of-bikes-6745e410d1bc?source=collection_archive---------2-----------------------#2017-03-07">https://medium.com/google-cloud/big-data-bigquery-and-a-story-of-bikes-6745e410d1bc?source=collection_archive---------2-----------------------#2017-03-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ddae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“大数据”作为一个流行语是不可避免的。每天收集的数据量如此惊人，几乎让人无法理解。截至2015年，每天<a class="ae jd" href="https://www-01.ibm.com/software/data/bigdata/what-is-big-data.html" rel="noopener ugc nofollow" target="_blank">都会产生250万TB的新数据</a>。应用范围从简单的消费者分析到科学研究和公共政策的预测模型。大数据对日常生活的影响是不可否认的，尽管通常是隐藏的。</p><p id="777b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于一个不经意的观察者来说，大数据经常感觉像一个无法接近的庞然大物，所以当我第一次读到谷歌的BigQuery工具集时，我立刻就感兴趣了。我参加了谷歌开发者代言人<a class="ae jd" href="https://twitter.com/srobtweets?lang=en" rel="noopener ugc nofollow" target="_blank">莎拉·罗宾逊</a>在DevFestMN 2017上的演讲，演讲内容是通过她对纽约市<a class="ae jd" href="https://cloud.google.com/blog/big-data/2016/12/analyzing-nyc-biking-data-with-google-bigquery" rel="noopener ugc nofollow" target="_blank">花旗自行车项目</a>的分析来展示BigQuery的实际应用。她在演讲结束时粗略地看了一下Nice Ride MN bike项目，这启发了我尝试使用BigQuery并深入大数据世界。</p><p id="1a5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自2010年该项目启动以来，Nice Ride MN一直在收集数据，并在他们的网站上公开这些数据。我绝不是SQL专家，所以我很高兴将数据导入BigQuery只需要一点试错，这让我在大约一个小时的时间内运行了基本的查询。</p><p id="c60e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，让我们来问一个最基本的问题:骑行的感觉有多好？</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="741d" class="jn jo hi jj b fi jp jq l jr js">SELECT<br/>  COUNT(*) as total_trips<br/>FROM<br/>  [mn_nice_ride.trips_2010],<br/>  [mn_nice_ride.trips_2011],<br/>  [mn_nice_ride.trips_2012],<br/>  [mn_nice_ride.trips_2013],<br/>  [mn_nice_ride.trips_2014],<br/>  [mn_nice_ride.trips_2015],<br/>  [mn_nice_ride.trips_2016]<br/>WHERE<br/>  duration != 0;</span></pre><p id="c5a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这产生了令人印象深刻的结果2，223，719:</p><figure class="je jf jg jh fd ju er es paragraph-image"><div class="er es jt"><img src="../Images/ce50c29a9f9555d8200c5c6cee89fead.png" data-original-src="https://miro.medium.com/v2/resize:fit:234/format:webp/1*J2SZLyPsKbqu99az3mSXmQ.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">2010年至2016年MN尼斯之旅的总行程</figcaption></figure><p id="52d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以下一个显而易见的问题是，乘客数量每年是如何增长的？</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="748e" class="jn jo hi jj b fi jp jq l jr js">SELECT<br/>  2016 AS year,<br/>  COUNT(*) AS number_of_trips<br/>FROM<br/>  `mn_nice_ride.trips_2016`<br/>WHERE<br/>  duration != 0 UNION ALL….[REST OF YEARS]</span></pre><figure class="je jf jg jh fd ju er es paragraph-image"><div class="er es kb"><img src="../Images/288b252649c7779b5bc8e0f5fa8e0f97.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*usIdG_7wnFV0rB_-oguNFA.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">2010-2016年MN尼斯之旅每年的总旅行次数</figcaption></figure><p id="eeb7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述细分显示，除了2015年至2016年乘客量下降这一奇怪情况外，年复一年的增长相当稳定。那么，我们如何进一步分析这些数据，以更好地了解导致经济下滑的原因呢？原来，每个旅行记录中的另一个数据点是旅行是由订户(会员)还是非订户(临时)进行的。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="8229" class="jn jo hi jj b fi jp jq l jr js">SELECT<br/>  account_type AS account,<br/>  COUNT(*) AS num_trips,<br/>FROM<br/>  [mn_nice_ride.trips_2010]<br/>WHERE<br/>  duration != 0<br/>GROUP BY<br/>  account;</span></pre><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es kc"><img src="../Images/6983cea78a9478dcb1bd879b34c2cad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EFgxVUiq2lDK2HW4ETgEIg.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">2010年至2016年按会员类型划分的MN Nice Ride每年的旅行次数</figcaption></figure><p id="40d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个查询产生了非常有趣的结果。事实上，从2015年到2016年，用户出行的年同比增长(16%)仍在继续，但原因性出行的数量出现了相当严重的下降(-37%)。</p><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es kh"><img src="../Images/b5de9ce34237fa6150d46ae460db8650.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3zcYGik_ZmJAcYMBJiEh8Q.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">我做了一个图表</figcaption></figure><p id="2099" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们更好地了解了乘坐舒适的顾客的哪一个子集导致了乘客量的下降——在正式确定衰退的假设之前，还有什么可以获得更多信息的吗？</p><p id="c199" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来看看2015年和2016年非用户选择的热门路线:</p><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es ki"><img src="../Images/b8ab32a6aa04c9ef1427cd6d75125eac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SktqUQPy4RDdhocGj76zhg.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">2015年非订户的10大旅行</figcaption></figure><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es kj"><img src="../Images/f379bfff20644593dc80276b48c22fbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y5ldNRpSMdz289ZG0Zstfg.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">2016年非订户的10大旅行</figcaption></figure><p id="98b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从数据中可以立即看出，非订户倾向于以游客身份使用这项服务，非常受欢迎的路线是明尼阿波利斯的环湖链。我们看到，从2015年到2016年，这些目的地的旅行数量明显下降。减少的最明显的原因，或者更简单地说，最符合逻辑的原因是，2016年在高峰时段出现了更多不理想的骑行天气，休闲用户可能会租一辆自行车环游湖泊——但我们如何确定呢？这是一个重要的问题，因为它对Nice Ride金库的底线有着巨大的影响，因为这些受欢迎的非会员旅行的每一次都占总收入的约8美元。</p><p id="3679" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用来自NOAA的数据子集(从MSP机场测量)，我开始运行查询来查看可能不利于悠闲骑自行车的各种天气条件。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="b600" class="jn jo hi jj b fi jp jq l jr js">SELECT<br/>  COUNT(*) AS hot_and_humid,<br/>  year<br/>FROM<br/>  [mn_nice_ride.weather_2016],<br/>  [mn_nice_ride.weather_2015],<br/>  [mn_nice_ride.weather_2014]<br/>WHERE<br/>  mo &gt; 3<br/>  AND mo &lt; 11<br/>  AND dewp &gt; 65<br/>  AND max &gt; 90<br/>GROUP BY<br/>  year;</span></pre><figure class="je jf jg jh fd ju er es paragraph-image"><div class="er es kk"><img src="../Images/7eb088d30fae5611e15248d49ccfb73e.png" data-original-src="https://miro.medium.com/v2/resize:fit:388/format:webp/1*mNfQpKLBeY1jn8Y2y-mKCQ.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">2014年至2016年炎热潮湿的日子</figcaption></figure><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="55ec" class="jn jo hi jj b fi jp jq l jr js">SELECT<br/>  COUNT(*) AS hot_and_humid,<br/>  year<br/>FROM<br/>  [mn_nice_ride.weather_2016],<br/>  [mn_nice_ride.weather_2015],<br/>  [mn_nice_ride.weather_2014]<br/>WHERE<br/>  mo &gt; 3<br/>  AND mo &lt; 11<br/>  AND rain_drizzle = 1<br/>GROUP BY<br/>  year;</span></pre><figure class="je jf jg jh fd ju er es paragraph-image"><div class="er es kl"><img src="../Images/38d21d59fb9bd74b9d855fff05a370a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:260/format:webp/1*VplNXKZAwqlQSTV4t5y2uQ.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">2014年至2016年的降雨天数</figcaption></figure><p id="4bb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，从2015年到2016年，不舒服的高温日和降水日都有所增加。这些额外的信息给了我们另一个途径来探索天气条件是如何影响临时乘车的。我随机抽取了2016年一个炎热的周六和2016年一个凉爽的周六，并查询了两个周六的乘车次数:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="d5f2" class="jn jo hi jj b fi jp jq l jr js">SELECT<br/>  COUNT(*) AS casual_trips_hot_day<br/>FROM<br/>  [mn_nice_ride.trips_2016]<br/>WHERE<br/>  start_date LIKE "7/23/2016%"<br/>  AND account_type = "Casual";</span></pre><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es km"><img src="../Images/5f8dee948c184f95ba164080204d258b.png" data-original-src="https://miro.medium.com/v2/resize:fit:374/format:webp/1*J04HSTshTl82QE8o4aFqwA.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">2016年7月23日临时用户的出行次数</figcaption></figure><figure class="je jf jg jh fd ju er es paragraph-image"><div class="er es kn"><img src="../Images/048b187a45c2b373861113539d4f1556.png" data-original-src="https://miro.medium.com/v2/resize:fit:390/format:webp/1*bRPhdPyizPyIYknJjQsWmw.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">2016年7月2日临时用户的出行次数</figcaption></figure><p id="fbb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">毫不奇怪，在凉爽舒适的日子里，休闲骑手的数量轻而易举地超过了在炎热的日子里的数量。我有点惊讶，大热天的客流量如此之高，但我使用的数据相当不完整，没有给出天气与客流量的全貌——只是一个基本趋势。</p><p id="d828" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然我可以对目前作为BigQuery公共数据集加载的NOAA天气数据运行额外的查询，但我认为更有用的指标是查询每小时的温度读数，以更准确地了解天气状况如何真正影响乘客数量。</p><p id="6fb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">已经回答了一些基本问题，但是记录和分析这些数据有什么商业用途呢？创建乘客量与天气模型可以允许Nice Ride提供激励以增加热天的旅行次数，或者提供专注于周末使用的不同会员计划以增加订阅会员，或者甚至利用实时数据来创建奖金系统以减少车站重新平衡可能是潜在的可能应用。</p><p id="c639" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我完成了让自己熟悉BigQuery的目标，同时学习了更多关于Nice Ride MN程序所面临的复杂性和挑战。谷歌提供的平台对于更先进的数据集来说似乎足够强大，我认为他们在大数据民主化方面做了令人难以置信的工作。希望更多的记者和爱好者能够利用这一强大的工具，更好地分析当今世界面临的复杂问题，努力将“大数据”转化为“有意义的数据”。</p></div></div>    
</body>
</html>