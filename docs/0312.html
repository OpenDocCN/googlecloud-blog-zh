<html>
<head>
<title>Sentiment Analysis of Comments on LHL’s Facebook Page</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">LHL脸书页面评论的情感分析</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/sentiment-analysis-of-comments-on-lhls-facebook-page-9db8b3a60eb3?source=collection_archive---------0-----------------------#2017-06-14">https://medium.com/google-cloud/sentiment-analysis-of-comments-on-lhls-facebook-page-9db8b3a60eb3?source=collection_archive---------0-----------------------#2017-06-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="70e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">学习如何使用<a class="ae jd" href="https://developers.facebook.com/docs/graph-api" rel="noopener ugc nofollow" target="_blank">脸书图形API </a>和<a class="ae jd" href="https://cloud.google.com/natural-language/" rel="noopener ugc nofollow" target="_blank">谷歌云自然语言API </a></p><h2 id="b5b5" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">更新2018年8月21日</h2><p id="dca6" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">脸书最近在今年7月实施了更多的API限制，这意味着下面概述的获取个人访问令牌的方法不再有效:</p><div class="ke kf ez fb kg kh"><a href="https://newsroom.fb.com/news/2018/07/a-platform-update/" rel="noopener  ugc nofollow" target="_blank"><div class="ki ab dw"><div class="kj ab kk cl cj kl"><h2 class="bd hj fi z dy km ea eb kn ed ef hh bi translated">平台更新</h2><div class="ko l"><h3 class="bd b fi z dy km ea eb kn ed ef dx translated">今天，我想解释一下我们为了更好地保护人们的信息而实施的附加API限制:</h3></div><div class="kp l"><p class="bd b fp z dy km ea eb kn ed ef dx translated">newsroom.fb.com</p></div></div></div></a></div><blockquote class="kq kr ks"><p id="a565" class="if ig kt ih b ii ij ik il im in io ip ku ir is it kv iv iw ix kw iz ja jb jc hb bi translated">今天，开发人员可以使用我们的<strong class="ih hj"> Graph API Explorer应用程序运行测试查询。</strong>今天，7月2日，我们将弃用这款应用，开发者需要使用他们自己的应用访问令牌在<a class="ae jd" href="https://developers.facebook.com/docs/graph-api/explorer" rel="noopener ugc nofollow" target="_blank"> Graph API Explorer </a>上进行测试查询。</p></blockquote><p id="fa1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从现在开始，为了能够下载评论，您需要有一个活动的脸书应用程序来获取访问令牌。</p><p id="a5b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">原帖在下面。</p></div><div class="ab cl kx ky gp kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="hb hc hd he hf"><h1 id="ddef" class="le jf hi bd jg lf lg lh jk li lj lk jo ll lm ln jr lo lp lq ju lr ls lt jx lu bi translated">爆炸性新闻</h1><p id="71e9" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">这是新加坡一个多事的早晨。</p><div class="ke kf ez fb kg kh"><a href="http://www.asiaone.com/singapore/lee-wei-ling-lee-hsien-yang-issue-statement-say-they-have-lost-confidence-pm-lee-hsien" rel="noopener  ugc nofollow" target="_blank"><div class="ki ab dw"><div class="kj ab kk cl cj kl"><h2 class="bd hj fi z dy km ea eb kn ed ef hh bi translated">李凌薇，李显扬发表声明说他们已经对总理李显龙失去信心…</h2><div class="ko l"><h3 class="bd b fi z dy km ea eb kn ed ef dx translated">总理李显龙的兄弟姐妹，李凌薇博士和李显扬发表声明星期三(6月14日)…</h3></div><div class="kp l"><p class="bd b fp z dy km ea eb kn ed ef dx translated">www.asiaone.com</p></div></div><div class="lv l"><div class="lw l lx ly lz lv ma mb kh"/></div></div></a></div><div class="ke kf ez fb kg kh"><a href="http://mothership.sg/2017/06/lee-hsien-yang-wants-to-leave-singapore-publishes-open-letter-with-sister-to-criticize-pm/" rel="noopener  ugc nofollow" target="_blank"><div class="ki ab dw"><div class="kj ab kk cl cj kl"><h2 class="bd hj fi z dy km ea eb kn ed ef hh bi translated">李显扬想离开新加坡，与姐姐发表公开信批评总理李</h2><div class="ko l"><h3 class="bd b fi z dy km ea eb kn ed ef dx translated">拜拜。6月14日，新加坡人一觉醒来，发现自己被最近迅速发展的家庭戏剧所困扰…</h3></div><div class="kp l"><p class="bd b fp z dy km ea eb kn ed ef dx translated">母舰. sg</p></div></div><div class="lv l"><div class="mc l lx ly lz lv ma mb kh"/></div></div></a></div><div class="ke kf ez fb kg kh"><a href="http://www.straitstimes.com/singapore/lee-wei-ling-lee-hsien-yang-issue-statement-on-pm-lee-hsien-loong" rel="noopener  ugc nofollow" target="_blank"><div class="ki ab dw"><div class="kj ab kk cl cj kl"><h2 class="bd hj fi z dy km ea eb kn ed ef hh bi translated">李凌薇，李显扬发表声明说他们已经对他们的兄弟总理失去了信心…</h2><div class="ko l"><h3 class="bd b fi z dy km ea eb kn ed ef dx translated">新加坡——李凌薇博士和李显扬先生周三(6月14日)发表了一份六页的公开声明，称他们…</h3></div><div class="kp l"><p class="bd b fp z dy km ea eb kn ed ef dx translated">www.straitstimes.com</p></div></div><div class="lv l"><div class="md l lx ly lz lv ma mb kh"/></div></div></a></div><h1 id="8910" class="le jf hi bd jg lf me lh jk li mf lk jo ll mg ln jr lo mh lq ju lr mi lt jx lu bi translated">但是人们怎么想呢？</h1><figure class="mk ml mm mn fd mo er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es mj"><img src="../Images/7bdc72ea61aaa16ce814643ac5707c0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uSgfV1cVnWvV91jgpfR_SQ.jpeg"/></div></div><figcaption class="mu mv et er es mw mx bd b be z dx translated">新加坡总理李显龙</figcaption></figure><p id="59c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们根据脸书的评论来衡量一下公众对这些声明的反应。为此，我们将使用:</p><ul class=""><li id="14fe" class="my mz hi ih b ii ij im in iq na iu nb iy nc jc nd ne nf ng bi translated"><strong class="ih hj"> Python 3 </strong></li><li id="aa0e" class="my mz hi ih b ii nh im ni iq nj iu nk iy nl jc nd ne nf ng bi translated"><strong class="ih hj">脸书图形API </strong>从脸书下载评论</li><li id="625e" class="my mz hi ih b ii nh im ni iq nj iu nk iy nl jc nd ne nf ng bi translated">用于执行情感分析的<strong class="ih hj">谷歌云自然语言API </strong></li></ul><p id="6ea2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们将使用脸书图形API从脸书邮报下载评论。在这篇博客文章中，我们将使用LHL脸书页面上的这篇文章来回应他兄弟姐妹的声明:<a class="ae jd" href="https://www.facebook.com/leehsienloong/posts/1505690826160285" rel="noopener ugc nofollow" target="_blank">https://www . Facebook . com/leehsienloong/posts/1505690826160285</a>。</p><p id="38f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用的方法可以很容易地适用于脸书公共页面上的任何帖子，例如<a class="ae jd" href="https://www.facebook.com/LeeHsienYangSGP/posts/1897892393784194" rel="noopener ugc nofollow" target="_blank">李显扬的原始帖子</a>。</p><p id="bd26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们将使用谷歌云自然语言API将这些帖子上的评论分为正面、中立或负面，并计算这些帖子中每一个帖子上正面、中立和负面评论的比例。</p><h2 id="5928" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">重要说明</h2><p id="213a" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">脸书绝不是客观观点的来源，我们会发现这些帖子的评论极有可能包含某种程度的偏见。也有适度的可能，进一步降低了我们发现的客观性。这篇博文应该被视为纯粹的使用脸书图形API和谷歌云自然语言API的练习，而不是对新加坡的政治局势下任何结论。</p><h1 id="8ace" class="le jf hi bd jg lf me lh jk li mf lk jo ll mg ln jr lo mh lq ju lr mi lt jx lu bi translated">入门指南</h1><h2 id="5a66" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">设置Python 3</h2><p id="0036" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">下载和安装Python 3不在这篇博文的讨论范围之内。你可以在这里查阅Python文档<a class="ae jd" href="https://docs.python.org/3/using/index.html" rel="noopener ugc nofollow" target="_blank">。但是为了检查您的Python版本，请打开Python提示符并检查其输出。您应该会看到类似如下的内容:</a></p><pre class="mk ml mm mn fd nm nn no np aw nq bi"><span id="8d6c" class="je jf hi nn b fi nr ns l nt nu">Python 3.6.0 (v3.6.0:41df79263a11, Dec 23 2016, 08:06:12) [MSC v.1900 64 bit (AMD64)] on win32<br/>Type "help", "copyright", "credits" or "license" for more information.<br/>&gt;&gt;&gt;</span></pre><p id="49f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你看到<code class="du nv nw nx nn b">Python 3.x.x</code>，你就可以走了。如果你看到<code class="du nv nw nx nn b">Python 2.x.x</code>并且你运行的是Linux/MacOS，你可以尝试用<code class="du nv nw nx nn b">python3</code>代替<code class="du nv nw nx nn b">python</code>。否则，您将需要安装Python 3(或者自行将代码转换为Python 2)。</p><p id="0d40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还将使用<code class="du nv nw nx nn b">requests</code>和<code class="du nv nw nx nn b">google-cloud-language</code>库进行HTTP请求和情感分析。要安装这些程序，请运行:</p><pre class="mk ml mm mn fd nm nn no np aw nq bi"><span id="8e0f" class="je jf hi nn b fi nr ns l nt nu"># if you are using the python3 command, you may need to use pip3 here as well<br/>pip install --upgrade requests google-cloud-language</span></pre><p id="0155" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(更新2018–01–05)本帖已更新使用Google Cloud Python库v0.26.1及更新版本。如果您遇到类似于<code class="du nv nw nx nn b">AttributeError: module 'google.cloud.language' has no attribute 'LanguageServiceClient'</code>的错误，那么您可以尝试重新运行上面的命令来更新您的包。</p><h2 id="3f7f" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated"><strong class="ak">获取脸书图形API访问令牌</strong></h2><p id="326f" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">您将需要一个脸书帐户来访问图形API。我们可以在https://developers.facebook.com/tools/explorer/<a class="ae jd" href="https://developers.facebook.com/tools/explorer/" rel="noopener ugc nofollow" target="_blank">用脸书图形API浏览器得到这个。</a></p><figure class="mk ml mm mn fd mo er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es ny"><img src="../Images/71712cc6eec384e4fa9546b06f21980c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qD6yf62v7HUDCdVTz8yHKQ.png"/></div></div><figcaption class="mu mv et er es mw mx bd b be z dx translated">图形API浏览器</figcaption></figure><p id="4d1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击右上角的“获取令牌”，然后点击“获取用户访问令牌”。您将看到一个选择权限的大对话框。尽管没有必要检查任何东西，因为LHL的脸书页面是公开的。点击右下角的“获取访问令牌”，您的访问令牌将被填入访问令牌字段。暂时把这个放在这里。</p><h2 id="7d01" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">创建谷歌云平台项目</h2><p id="0be0" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">与AWS不同，Google云平台上的资源是按项目分组的。进入<a class="ae jd" href="https://cloud.google.com/natural-language/docs/getting-started" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/natural-language/docs/getting-started</a>，按照步骤1-6设置项目。您可能还需要安装Google Cloud SDK才能使用<code class="du nv nw nx nn b">gcloud</code>。</p><h1 id="74a1" class="le jf hi bd jg lf me lh jk li mf lk jo ll mg ln jr lo mh lq ju lr mi lt jx lu bi translated">下载脸书评论</h1><p id="875c" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">我们的目标是下载LHL在脸书页面上回复他兄弟姐妹的帖子的所有评论:</p><p id="637a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://www.facebook.com/leehsienloong/posts/1505690826160285" rel="noopener ugc nofollow" target="_blank">https://www . Facebook . com/leehsienloong/posts/1505690826160285</a></p><p id="c039" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将通过遍历脸书图形API来实现这一点。</p><h2 id="9527" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">脸书图形API的工作原理</h2><p id="a893" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">图形API将脸书数据显示为图形，由连接的实体组成。这些实体可以是脸书上的任何东西，比如一个脸书用户，一个页面，甚至一条评论。实体的完整列表可以在<a class="ae jd" href="https://developers.facebook.com/docs/graph-api/reference" rel="noopener ugc nofollow" target="_blank">图形API参考</a>中找到。</p><p id="ac20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实体由顶点链接，顶点是实体的属性。例如，一个帖子实体链接到许多评论实体，代表该帖子上的每个评论。</p><p id="ba9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要找到与LHL的帖子相对应的帖子实体，并检查与之相关的所有评论实体。为简单起见，post实体由一个ID引用，该ID由发布帖子的用户或页面的ID以及帖子本身的ID组成，可以在帖子URL中找到。</p><p id="44de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要通过Graph API Explorer获得LHL的页面ID，我们只需在查询框中输入他的页面用户名:</p><figure class="mk ml mm mn fd mo er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es nz"><img src="../Images/9739571b67657a23d41c5912321eae00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g8_BgE2NjKEYPf2dPq9u4A.png"/></div></div><figcaption class="mu mv et er es mw mx bd b be z dx translated">LHL的脸书页面ID</figcaption></figure><p id="d5a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们得到他的页面ID后，我们可以找到他的帖子:</p><figure class="mk ml mm mn fd mo er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es oa"><img src="../Images/dabe4e3ee71bf6cc87831de51cfbef87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xUvOQuGDppNqtF9CEyMDGA.png"/></div></div></figure><p id="75a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只需将<code class="du nv nw nx nn b">/comments</code>添加到帖子ID，我们就可以获得帖子上的所有评论:</p><figure class="mk ml mm mn fd mo er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es ob"><img src="../Images/42f362505b0694d3be4c874adcb1b4ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZhctqvvQz-xOfpDhMcPOTw.png"/></div></div></figure><p id="ce34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，我们不想使用Graph API Explorer来手动保存所有注释，所以我们将使用Python脚本来代替(更新于2018年1月15日):</p><pre class="mk ml mm mn fd nm nn no np aw nq bi"><span id="59a8" class="je jf hi nn b fi nr ns l nt nu">import requests<br/>import signal<br/>import sys<br/><br/>graph_api_version = 'v2.9'<br/>access_token = 'YOUR_FACEBOOK_ACCESS_TOKEN_HERE'<br/><br/># LHL's Facebook user id<br/>user_id = '125845680811480'<br/><br/># the id of LHL's response post at https://www.facebook.com/leehsienloong/posts/1505690826160285<br/>post_id = '1505690826160285'<br/><br/># the graph API endpoint for comments on LHL's post<br/>url = 'https://graph.facebook.com/{}/{}_{}/comments'.format(graph_api_version, user_id, post_id)<br/><br/>comments = []<br/><br/># set limit to 0 to try to download all comments<br/>limit = 200<br/><br/><br/>def write_comments_to_file(filename):<br/>    print()<br/><br/>    if len(comments) == 0:<br/>        print('No comments to write.')<br/>        return<br/><br/>    with open(filename, 'w', encoding='utf-8') as f:<br/>        for comment in comments:<br/>            f.write(comment + '\n')<br/><br/>    print('Wrote {} comments to {}'.format(len(comments), filename))<br/><br/><br/># register a signal handler so that we can exit early<br/>def signal_handler(signal, frame):<br/>    print('KeyboardInterrupt')<br/>    write_comments_to_file('comments.txt')<br/>    sys.exit(0)<br/><br/><br/>signal.signal(signal.SIGINT, signal_handler)<br/><br/>r = requests.get(url, params={'access_token': access_token})<br/>while True:<br/>    data = r.json()<br/><br/>    # catch errors returned by the Graph API<br/>    if 'error' in data:<br/>        raise Exception(data['error']['message'])<br/><br/>    # append the text of each comment into the comments list<br/>    for comment in data['data']:<br/>        # remove line breaks in each comment<br/>        text = comment['message'].replace('\n', ' ')<br/>        comments.append(text)<br/><br/>    print('Got {} comments, total: {}'.format(len(data['data']), len(comments)))<br/><br/>    # check if we have enough comments<br/>    if 0 &lt; limit &lt;= len(comments):<br/>        break<br/><br/>    # check if there are more comments<br/>    if 'paging' in data and 'next' in data['paging']:<br/>        r = requests.get(data['paging']['next'])<br/>    else:<br/>        break<br/><br/># save the comments to a file<br/>write_comments_to_file('comments.txt')</span></pre><p id="4742" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，这个脚本将在下载200条评论后停止。你可以调整脚本里面的<code class="du nv nw nx nn b">limit</code>变量来下载更多，或者设置为0来尝试下载所有东西。也可以用Ctrl-C中断下载，保存到目前为止下载的所有评论。</p><p id="5284" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个脚本可以工作，因为我们可以通过直接访问Graph API URL从Graph API Explorer获得相同的输出。这个脚本做了几件事:</p><ol class=""><li id="9f45" class="my mz hi ih b ii ij im in iq na iu nb iy nc jc oc ne nf ng bi translated">发出一个HTTP请求来获取对LHL帖子的评论</li><li id="1aab" class="my mz hi ih b ii nh im ni iq nj iu nk iy nl jc oc ne nf ng bi translated">将帖子上的评论文本保存到Python列表中</li><li id="949b" class="my mz hi ih b ii nh im ni iq nj iu nk iy nl jc oc ne nf ng bi translated">检查是否有更多的注释(使用请求中返回的分页光标，有关分页的更多信息，请参考<a class="ae jd" href="https://developers.facebook.com/docs/graph-api/using-graph-api" rel="noopener ugc nofollow" target="_blank">https://developers . Facebook . com/docs/graph-API/using-graph-API</a>)。</li><li id="b7ef" class="my mz hi ih b ii nh im ni iq nj iu nk iy nl jc oc ne nf ng bi translated">把我们得到的评论保存到一个文件里。</li></ol><h1 id="0d2e" class="le jf hi bd jg lf me lh jk li mf lk jo ll mg ln jr lo mh lq ju lr mi lt jx lu bi translated">分析评论情绪</h1><p id="4a04" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">现在我们有了一个想要分析的评论列表，我们可以使用谷歌云自然语言来获得每个评论的情感。云自然语言API做了很多事情，但在这篇博客文章中，我们将只使用情感分析功能，它将检查一个文本块，并确定主要的情感是积极的、消极的还是中性的。</p><p id="9d34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在上一节中生成的<code class="du nv nw nx nn b">comments.txt</code>文件包含LHL《脸书邮报》上每条评论的文本，每行一条(这就是为什么我们从每条评论中删除了换行符)。现在我们将浏览这个列表，确定每个评论的情绪是积极、消极还是中性，并计算每个情绪的总体比例(更新于2018–01–05):</p><pre class="mk ml mm mn fd nm nn no np aw nq bi"><span id="a07b" class="je jf hi nn b fi nr ns l nt nu">import signal<br/>import sys<br/><br/>from google.cloud import language<br/>from google.api_core.exceptions import InvalidArgument<br/><br/># create a Google Cloud Natural Languague API Python client<br/>client = language.LanguageServiceClient()<br/><br/><br/># a function which takes a block of text and returns its sentiment and magnitude<br/>def detect_sentiment(text):<br/>    """Detects sentiment in the text."""<br/><br/>    document = language.types.Document(<br/>        content=text,<br/>        type=language.enums.Document.Type.PLAIN_TEXT)<br/><br/>    sentiment = client.analyze_sentiment(document).document_sentiment<br/><br/>    return sentiment.score, sentiment.magnitude<br/><br/><br/># keep track of count of total comments and comments with each sentiment<br/>count = 0<br/>positive_count = 0<br/>neutral_count = 0<br/>negative_count = 0<br/><br/><br/>def print_summary():<br/>    print()<br/>    print('Total comments analysed: {}'.format(count))<br/>    print('Positive : {} ({:.2%})'.format(positive_count, positive_count / count))<br/>    print('Negative : {} ({:.2%})'.format(negative_count, negative_count / count))<br/>    print('Neutral  : {} ({:.2%})'.format(neutral_count, neutral_count / count))<br/><br/><br/># register a signal handler so that we can exit early<br/>def signal_handler(signal, frame):<br/>    print('KeyboardInterrupt')<br/>    print_summary()<br/>    sys.exit(0)<br/><br/><br/>signal.signal(signal.SIGINT, signal_handler)<br/><br/># read our comments.txt file<br/>with open('comments.txt', encoding='utf-8') as f:<br/>    for line in f:<br/>        # use a try-except block since we occasionally get language not supported errors<br/>        try:<br/>            score, mag = detect_sentiment(line)<br/>        except InvalidArgument as e:<br/>            # skip the comment if we get an error<br/>            print('Skipped 1 comment: ', e.message)<br/>            continue<br/><br/>        # increment the total count<br/>        count += 1<br/><br/>        # depending on whether the sentiment is positve, negative or neutral, increment the corresponding count<br/>        if score &gt; 0:<br/>            positive_count += 1<br/>        elif score &lt; 0:<br/>            negative_count += 1<br/>        else:<br/>            neutral_count += 1<br/><br/>        # calculate the proportion of comments with each sentiment<br/>        positive_proportion = positive_count / count<br/>        neutral_proportion = neutral_count / count<br/>        negative_proportion = negative_count / count<br/><br/>        print(<br/>            'Count: {}, Positive: {:.3f}, Neutral: {:.3f}, Negative: {:.3f}'.format(<br/>                count, positive_proportion, neutral_proportion, negative_proportion))<br/><br/>print_summary()</span></pre><p id="8bf2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以按Ctrl-C来中途中止分析，并查看到目前为止的结果。运行这个脚本，我们将得到如下输出:</p><pre class="mk ml mm mn fd nm nn no np aw nq bi"><span id="56cb" class="je jf hi nn b fi nr ns l nt nu">...<br/>Count: 379, Positive: 0.657, Neutral: 0.190, Negative: 0.153<br/>Count: 380, Positive: 0.655, Neutral: 0.192, Negative: 0.153<br/>Count: 381, Positive: 0.656, Neutral: 0.192, Negative: 0.152<br/>Count: 382, Positive: 0.657, Neutral: 0.191, Negative: 0.152<br/>Count: 383, Positive: 0.658, Neutral: 0.191, Negative: 0.151<br/>Count: 384, Positive: 0.659, Neutral: 0.190, Negative: 0.151<br/>...</span></pre><p id="9396" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后:</p><pre class="mk ml mm mn fd nm nn no np aw nq bi"><span id="7516" class="je jf hi nn b fi nr ns l nt nu">Total comments analysed: 781<br/>Positive : 530 (67.86%)<br/>Negative : 109 (13.96%)<br/>Neutral  : 142 (18.18%)</span></pre><h1 id="e219" class="le jf hi bd jg lf me lh jk li mf lk jo ll mg ln jr lo mh lq ju lr mi lt jx lu bi translated">结论</h1><p id="32d3" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">根据我们对LHL《脸书邮报》的情感分析，我们看到近70%的评论是正面的。虽然这可能被解释为公众对我们的项目经理的强烈支持，但我们也需要考虑到脸书页面的访问者可能会偏向该页面的事实，以及评论适度的可能性。</p><h2 id="be38" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">潜在的改进</h2><p id="b72c" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">在测试我的脚本时，我不得不多次运行情感分析脚本，每次都不必要地请求相同的评论。考虑到脸书帖子的动态性质，可以修改代码来按ID缓存评论，并且只分析新评论的情绪。这一点尤其重要，因为谷歌云自然语言API每月只有5k API调用的免费配额。</p><h2 id="41ec" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">源代码</h2><p id="c6f5" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">以上例子的源代码可以在<a class="ae jd" href="https://gist.github.com/yi-jiayu/b94d9df77007d8a6683f3df0990da0f6" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/yi-Jiayu/b 94d 9 df 77007 D8 a 6683 F3 df 0990 da 0 f 6</a>找到。</p><h1 id="d629" class="le jf hi bd jg lf me lh jk li mf lk jo ll mg ln jr lo mh lq ju lr mi lt jx lu bi translated">结尾注释</h1><p id="480c" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">这也是我的第一篇博文，我希望这是对脸书图形应用编程接口和谷歌云平台的介绍。如果你是新加坡人，并且乘坐公共汽车，一定要看看我的电报机器人，<a class="ae jd" href="https://t.me/BusEtaBot" rel="noopener ugc nofollow" target="_blank"> @BusEtaBot </a>获取公共汽车信息！</p><h2 id="7092" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">承认</h2><p id="f71a" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">黄俊凯<br/>爱德蒙<br/>T2【李芸婵</p><h2 id="3cf2" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">修订历史</h2><p id="8a5f" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">2018–01–15:更新了用于分析情绪的代码以使用谷歌云Python库v 0 . 26 . 1(<a class="ae jd" href="https://cloud.google.com/natural-language/docs/python-client-migration" rel="noopener ugc nofollow" target="_blank">https://Cloud . Google . com/natural-language/docs/Python-client-migration</a>)</p></div></div>    
</body>
</html>