<html>
<head>
<title>A to Z of Google Cloud Platform a personal selection — P — Pub/Sub</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云平台的a到Z个人精选— P — Pub/Sub</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/a-to-z-of-google-cloud-platform-a-personal-selection-p-pub-sub-130538dab6e5?source=collection_archive---------0-----------------------#2016-04-03">https://medium.com/google-cloud/a-to-z-of-google-cloud-platform-a-personal-selection-p-pub-sub-130538dab6e5?source=collection_archive---------0-----------------------#2016-04-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2967" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上一篇文章中，我谈到了GCS，我认为它是在GCP上构建的任何云原生应用程序的第一个基本构建块。在这篇文章中，我将谈论我认为是第二个基础数据块云发布/订阅</p><p id="afef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://cloud.google.com/pubsub/overview" rel="noopener ugc nofollow" target="_blank"> Pub/Sub </a>是一个完全托管的服务，它提供了一种在应用程序之间实现多对多异步消息传递的方法。发布者应用/服务可以向“主题”发送消息，并且其他应用/服务可以订阅该主题以接收消息。通过解耦发送方和接收方，发布/订阅允许开发人员在独立编写的应用程序/服务之间进行通信。它允许创建更有弹性的、真正可伸缩的应用程序。它还提供了一种方法，允许您独立地升级应用程序的各个部分，而不会丢失通过互连整体传递的数据。</p><p id="53be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我喜欢文档中的这张图片，我觉得它相当简洁地说明了这一点。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/cd2e0f91c30a4fd9987766f54a025dc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xk3XeXnUkQ7ac209."/></div></div></figure><p id="cce5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它与许多GCP产品完全集成，可以作为源或汇。</p><p id="427c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要使用发布/订阅，您需要使用oauth 2.0对发布/订阅API进行授权，并设置范围。</p><p id="e432" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是python示例中的几行代码，演示了如何进行设置:</p><pre class="jf jg jh ji fd jq jr js jt aw ju bi"><span id="4c25" class="jv jw hi jr b fi jx jy l jz ka">def create_pubsub_client(http=None):</span><span id="027e" class="jv jw hi jr b fi kb jy l jz ka">credentials = oauth2client.GoogleCredentials.get_application_default()</span><span id="ecd1" class="jv jw hi jr b fi kb jy l jz ka">if credentials.create_scoped_required():</span><span id="3c31" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">credentials = credentials.create_scoped(PUBSUB_SCOPES)</em></span><span id="b8d0" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">if not http:</em></span><span id="8583" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">http = httplib2.Http()</em></span><span id="a4b1" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">credentials.authorize(http)</em></span><span id="3e48" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">return discovery.build(‘pubsub’, ‘v1’, http=http)</em></span></pre><p id="b50c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，设置发布或订阅功能，从发布/订阅中推送或获取消息。下面是几行示例python代码来说明这一点。</p><pre class="jf jg jh ji fd jq jr js jt aw ju bi"><span id="e4e6" class="jv jw hi jr b fi jx jy l jz ka"><em class="kc">import base6</em></span><span id="3dc9" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">client = create_pubsub_client()</em></span><span id="0815" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc"># You need to base64-encode your message.</em></span><span id="3da9" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">message1 = base64.b64encode(‘Hello Cloud Pub/Sub!’)</em></span><span id="1fdf" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">message2 = base64.b64encode(‘We are on the same boat.’)</em></span><span id="fd8c" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc"># Create a POST body for the Pub/Sub request</em></span><span id="7b36" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">body = {</em></span><span id="9e29" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">‘messages’: [</em></span><span id="3f5e" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">{‘data’: message1},</em></span><span id="c086" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">{‘data’: message2},</em></span><span id="37f5" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">]</em></span><span id="2b32" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">}</em></span><span id="b8d9" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">resp = client.projects().topics().publish(</em></span><span id="6eec" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">topic=’projects/myproject/topics/mytopic’, body=body).execute</em></span><span id="0706" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">message_ids = resp.get(‘messageIds’)</em></span><span id="3e65" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">if message_ids:</em></span><span id="cbc1" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">for message_id in message_ids:</em></span><span id="ef0f" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc"># Process each message ID</em></span><span id="5de0" class="jv jw hi jr b fi kb jy l jz ka"><em class="kc">print message_id</em></span></pre><p id="cf8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有了<a class="ae jd" href="https://cloud.google.com/iam/docs/" rel="noopener ugc nofollow" target="_blank">云IAM </a>你可以实现粒度级控制。文档中的表格显示了您可以使用<a class="ae jd" href="https://cloud.google.com/pubsub/access_control" rel="noopener ugc nofollow" target="_blank"> IAM和发布/订阅</a>设置的控件:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kd"><img src="../Images/0a228f7760a962da4cd19b60e2168123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*62BBBApPs5px0V2l."/></div></div></figure><p id="e629" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尽管Pub/Sub不是一个存储系统，但是如果您确实需要在消息经过初始处理后重放或保留消息，请将它们保存到云存储、Bigtable或BigQuery等地方。</p><p id="07be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想一想，如果你使用像Pub/Sub这样的完全托管服务，管理你自己的消息应用程序的人可以做什么其他有成效的差异化工作。(如果你想从另一个角度了解为什么这是一个好建议，请参阅为什么Spotify选择从kafka迁移到Pub/Sub)</p><p id="1597" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我想讨论一下FIFO(先进先出)。Pub/Sub不保证订阅者接收消息的顺序，所以此时您可能会想，真的吗？或许你不是。大规模FIFO是真正可扩展的分布式系统的反模式，因此FIFO不是Pub/Sub的东西，但如果你需要这样做，请在离开之前等待一分钟，而不是像RabbitMQ或kafka那样给自己的系统喂食和浇水。停下来想一想，并阅读<a class="ae jd" href="https://cloud.google.com/pubsub/ordering" rel="noopener ugc nofollow" target="_blank"> this </a>，它提供了通过Pub/Sub实现这一点的策略，但它也给你提供了关于你是否真的需要FIFO的思考资料。</p><p id="6e70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我离开之前，我想我应该向<a class="ae jd" href="https://cloud.google.com/dataflow/what-is-google-cloud-dataflow" rel="noopener ugc nofollow" target="_blank">数据流</a>团队的弗朗西斯·佩里<a class="ae jd" href="https://twitter.com/francesjperry" rel="noopener ugc nofollow" target="_blank">@弗朗西斯·佩里</a>道歉，因为即使在GCP Next &amp;被搭讪后，有人向我指出D代表数据流(我写了关于部署管理器的文章)，B代表Apache Beam(我写了关于BigTable的历史):-)我不得不谈论数据流的下一个借口我猜应该在这里(管道、PCollections、ParDo、<a class="ae jd" href="https://cloud.google.com/blog/big-data/2016/03/google-announces-cloud-dataflow-with-python-support" rel="noopener ugc nofollow" target="_blank"> python支持</a>)。我承认这本来是可行的，但我仍然没有成功！</p><p id="5c4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我看来，这个酒吧/Sub帖子一直在等待发布！但是，如果你也想在这个系列中看到一些关于数据流的东西，为什么不看看这个来自Frances的精彩演讲呢？我有一些真正尴尬的信件要处理，但不确定我能适应数据流，所以这是我的脱身条款:-)</p></div></div>    
</body>
</html>