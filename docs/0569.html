<html>
<head>
<title>How do I create an OpenEBS storage pool on Google Persistent Disk</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Google持久磁盘上创建OpenEBS存储池</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-do-i-create-an-openebs-storage-pool-on-google-persistent-disk-4306976183cc?source=collection_archive---------2-----------------------#2018-04-13">https://medium.com/google-cloud/how-do-i-create-an-openebs-storage-pool-on-google-persistent-disk-4306976183cc?source=collection_archive---------2-----------------------#2018-04-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ef8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文属于Kubernetes和OpenEBS上的#HowDoI系列。</p><p id="1677" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">OpenEBS卷副本是OpenEBS iSCSI目标的实际后端存储单元，当前将数据存储在Kubernetes节点上的hostPath中。默认情况下，在根文件系统的父目录(/var/openebs)中创建一个名为volume (PV)的文件夹，并在复制副本pod实例化期间绑定到容器中。这个父目录(如果还不可用，也创建)基本上是保存各个卷的持久路径，被称为<strong class="ih hj"> <em class="jd">存储池</em> </strong>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="ab fe cl jj"><img src="../Images/12d3f1321c99605320803c611294113d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*HDPBQQNqAiC98UZPHuh9JA.png"/></div></figure><blockquote class="jm jn jo"><p id="5bd8" class="if ig jd ih b ii ij ik il im in io ip jp ir is it jq iv iw ix jr iz ja jb jc hb bi translated">注意:上述存储池的概念是特定于当前的默认存储引擎，即Jiva。未来版本可能会推出更多存储引擎，它们可以使用数据块设备而不是主机目录来创建存储池</p></blockquote><p id="d8e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">出于各种原因，可能需要在安装到Kubernetes节点上特定位置的外部磁盘(GPD、EBS、SAN)上创建这个存储池。这是由<strong class="ih hj"> <em class="jd"> OpenEBS存储池策略</em> </strong> <em class="jd">，</em>促成的，该策略将存储池定义为一个<strong class="ih hj"> <em class="jd"> Kubernetes自定义资源</em> </strong>，并将持久路径作为一个属性。</p><p id="468c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个博客将关注在Google持久磁盘(GPD)上创建OpenEBS PV的步骤。</p><p id="0073" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">先决条件</strong></p><ul class=""><li id="87bc" class="js jt hi ih b ii ij im in iq ju iu jv iy jw jc jx jy jz ka bi translated">安装了OpenEBS操作器的3节点GKE集群(参见:<a class="ae kb" href="https://docs.openebs.io/docs/cloudsolutions.html" rel="noopener ugc nofollow" target="_blank">https://docs.openebs.io/docs/cloudsolutions.html</a>)</li><li id="6546" class="js jt hi ih b ii kc im kd iq ke iu kf iy kg jc jx jy jz ka bi translated">3-Google持久磁盘，每个集群节点一个。这可以使用<strong class="ih hj"><em class="jd">g cloud compute disks create</em></strong><em class="jd">&amp;</em><strong class="ih hj"><em class="jd">g cloud compute实例attach-disk </em> </strong> <em class="jd"> </em>命令来完成(请参考控制台步骤:<a class="ae kb" href="https://cloud.google.com/compute/docs/disks/add-persistent-disk#create_disk" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/compute/docs/disks/add-persistent-disk # create _ disk</a>)</li></ul><p id="60a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤1:将GPDs &amp;挂载格式化到所需路径</strong></p><p id="26ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在每个节点上，执行以下操作:</p><ul class=""><li id="ddc3" class="js jt hi ih b ii ij im in iq ju iu jv iy jw jc jx jy jz ka bi translated">切换到根用户<em class="jd"> sudo su - </em></li><li id="3adc" class="js jt hi ih b ii kc im kd iq ke iu kf iy kg jc jx jy jz ka bi translated">识别GPD连接的<em class="jd"> fdisk -l </em></li></ul><pre class="je jf jg jh fd kh ki kj kk aw kl bi"><span id="89b8" class="km kn hi ki b fi ko kp l kq kr">root@gke-oebs-staging-default-pool-7cc7e313-0xs4:~# fdisk -l<br/>Disk /dev/sda: 100 GiB, 107374182400 bytes, 209715200 sectors<br/>Units: sectors of 1 * 512 = 512 bytes<br/>Sector size (logical/physical): 512 bytes / 4096 bytes<br/>I/O size (minimum/optimal): 4096 bytes / 4096 bytes<br/>Disklabel type: dos<br/>Disk identifier: 0x635eaac1</span><span id="177d" class="km kn hi ki b fi ks kp l kq kr">Device Boot Start End Sectors Size Id Type<br/>/dev/sda1 * 2048 209715166 209713119 100G 83 Linux<br/></span><span id="4f46" class="km kn hi ki b fi ks kp l kq kr">Disk /dev/sdb: 10 GiB, 10737418240 bytes, 20971520 sectors<br/>Units: sectors of 1 * 512 = 512 bytes<br/>Sector size (logical/physical): 512 bytes / 4096 bytes<br/>I/O size (minimum/optimal): 4096 bytes / 4096 bytes</span></pre><ul class=""><li id="620f" class="js jt hi ih b ii ij im in iq ju iu jv iy jw jc jx jy jz ka bi translated">用ext 4 fs(<em class="jd">mkfs . ext 4/dev/SD&lt;&gt;)</em>格式化磁盘</li></ul><pre class="je jf jg jh fd kh ki kj kk aw kl bi"><span id="46ed" class="km kn hi ki b fi ko kp l kq kr">root@gke-oebs-staging-default-pool-7cc7e313-0xs4:~# mkfs.ext4 /dev/sdb <br/>mke2fs 1.42.13 (17-May-2015)<br/>/dev/sdb contains a ext4 file system<br/> last mounted on /openebs on Fri Apr 13 05:03:42 2018<br/>Proceed anyway? (y,n) y<br/>Discarding device blocks: done <br/>Creating filesystem with 2621440 4k blocks and 655360 inodes<br/>Filesystem UUID: 87d36681-d5f3-4169-b7fc-1f2f95bd527e<br/>Superblock backups stored on blocks: <br/> 32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632</span><span id="2e02" class="km kn hi ki b fi ks kp l kq kr">Allocating group tables: done <br/>Writing inode tables: done <br/>Creating journal (32768 blocks): done<br/>Writing superblocks and filesystem accounting information: done</span></pre><ul class=""><li id="9556" class="js jt hi ih b ii ij im in iq ju iu jv iy jw jc jx jy jz ka bi translated">将磁盘挂载到所需的挂载点(<em class="jd">mount-o sync/dev/SD&lt;T49】/mnt/open EBS</em>)</li></ul><pre class="je jf jg jh fd kh ki kj kk aw kl bi"><span id="1e38" class="km kn hi ki b fi ko kp l kq kr">root@gke-oebs-staging-default-pool-7cc7e313-0xs4:~# mount -o sync /dev/sdb /mnt/openebs/</span><span id="a4a5" class="km kn hi ki b fi ks kp l kq kr">root@gke-oebs-staging-default-pool-7cc7e313-0xs4:~# mount | grep openebs <br/>/dev/sdb on /mnt/openebs type ext4 (rw,relatime,sync,data=ordered)</span></pre><p id="b0c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤2:创建存储池自定义资源</strong></p><ul class=""><li id="7287" class="js jt hi ih b ii ij im in iq ju iu jv iy jw jc jx jy jz ka bi translated">构建如下所示的存储池资源规范并应用它(注意，存储池的自定义资源定义已经作为操作员安装的一部分应用)</li></ul><p id="7d61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤3:在自定义存储类中引用存储池</strong></p><p id="dd7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤4:在应用程序的PVC规范中使用自定义存储类</strong></p><p id="5214" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤5:确认在存储池</strong>上创建了卷</p><ul class=""><li id="4c96" class="js jt hi ih b ii ij im in iq ju iu jv iy jw jc jx jy jz ka bi translated">一旦创建了open EBS PV(<em class="jd">ku ectl get PV，ku ectl get pods</em>，列出存储池自定义资源中提到的自定义持久路径的内容。它应该包含一个文件夹，其PV名称由稀疏文件(磁盘映像文件)组成</li></ul><p id="e191" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">逮到你了！！</strong></p><p id="c477" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">问题</em>:如果a)集群调整大小(向下/向上)，b)升级&amp; c)虚拟机暂停，GPD将被分离</p><ul class=""><li id="d2ad" class="js jt hi ih b ii ij im in iq ju iu jv iy jw jc jx jy jz ka bi translated">在群集创建期间，没有添加“附加磁盘”的选项</li><li id="e959" class="js jt hi ih b ii kc im kd iq ke iu kf iy kg jc jx jy jz ka bi translated">实例模板是“不可变的”，磁盘必须单独添加到实例中</li></ul><p id="dcbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">解决方法</em>:在上述情况下执行手动重新连接(扩大根磁盘是一个选项，但通常不建议使用)</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><p id="a349" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">原载于2018年4月13日</em><a class="ae kb" rel="noopener" href="/@karthik.s_5236/how-do-i-create-an-openebs-storage-pool-on-google-persistent-disk-66089d9abb81"><em class="jd">medium.com</em></a><em class="jd">。</em></p></div></div>    
</body>
</html>