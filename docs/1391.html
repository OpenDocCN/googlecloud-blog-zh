<html>
<head>
<title>Kubernetes Engine (GKE) multi-cluster life cycle management series</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes发动机(GKE)多集群生命周期管理系列</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/gke-multi-cluster-life-cycle-management-series-a73185392345?source=collection_archive---------4-----------------------#2020-04-21">https://medium.com/google-cloud/gke-multi-cluster-life-cycle-management-series-a73185392345?source=collection_archive---------4-----------------------#2020-04-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="4127" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">第三部分:GKE集群生命周期管理</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/eba43f61577add105b3117372236a17a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oEX3Z66w9K0ZaHSTkcbCOg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">GKE分布式服务Foo</figcaption></figure><p id="a5c5" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在前两部分(<a class="ae kj" rel="noopener" href="/@ameericus/kubernetes-engine-gke-multi-cluster-life-cycle-management-series-17ff892b85c8">第一部分</a>和<a class="ae kj" rel="noopener" href="/@ameericus/gke-multi-cluster-life-cycle-management-series-b0d39080ac6b">第二部分</a>)中，我讨论了对多集群架构的需求，并定义了分布式服务的概念，它是运行在多个集群上的Kubernetes服务。在这一部分，让我们深入了解GKE集群生命周期管理的含义。集群生命周期管理可以定义为维护健康和更新的Kubernetes集群所需的策略和规划。具体来说，这是指在不违反服务SLO的情况下保持整个Kubernetes集群的更新。有了适当的策略和规划，集群生命周期管理应该是常规的、预期的和“平静的”。</p><p id="1e52" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">尽管这个博客系列特别关注于<a class="ae kj" href="https://cloud.google.com/kubernetes-engine" rel="noopener ugc nofollow" target="_blank"> Kubernetes引擎</a> (GKE)生命周期管理，但是所涵盖的概念可能适用于Kubernetes的其他发行版。</p><h1 id="30e0" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">GKE版本和升级</h1><p id="2cb7" class="pw-post-body-paragraph jn jo hi jp b jq lc ij js jt ld im jv jw le jy jz ka lf kc kd ke lg kg kh ki hb bi translated">在讨论集群生命周期管理的策略和规划之前，了解集群升级的组成部分非常重要。</p><p id="4a81" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">一个集群由两部分组成:主节点和节点。Kubernetes集群升级需要将所有节点和主节点升级到所需的版本。Kubernetes遵循一个<a class="ae kj" href="https://semver.org/" rel="noopener ugc nofollow" target="_blank">语义版本</a>模式。Kubernetes版本表示为<strong class="jp hj"> X.Y.Z </strong>。其中<strong class="jp hj"> X </strong>是主版本，<strong class="jp hj"> Y </strong>是次版本，<strong class="jp hj"> Z </strong>是补丁版本。次要版本大约每三个月(每季度)发布一次，Kubernetes项目为最近的三个次要版本维护发布分支。这意味着九个月前的Kubernetes minor版本不再被维护。除了无法维护之外，远远落后于Kubernetes版本还可能导致API在最终升级到最新版本时发生变化。这可能会比更新Kubernetes版本更具挑战性和风险。不用说，Kubernetes的升级必须定期进行。我们建议每季度或每两个季度进行一次GKE升级。</p><p id="20e5" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">GKE集群支持运行任何受支持的次要版本的Kubernetes版本。在任何给定时间，至少有两个(如果不是三个)次要版本可用。</p><p id="9151" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">GKE提供了三种类型的集群。</p><ol class=""><li id="1ba6" class="lh li hi jp b jq jr jt ju jw lj ka lk ke ll ki lm ln lo lp bi translated">单区域群集—单个区域中的单个主节点和单个区域中的所有节点池</li><li id="dab0" class="lh li hi jp b jq lq jt lr jw ls ka lt ke lu ki lm ln lo lp bi translated">多区域群集—一个区域中有一个主节点，一个区域中有多个区域中的节点池</li><li id="0250" class="lh li hi jp b jq lq jt lr jw ls ka lt ke lu ki lm ln lo lp bi translated">区域群集—单个区域中多个分区中的多个主节点和节点池</li></ol><p id="32eb" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">GKE是一项托管服务，提供主节点和节点的自动升级。</p><h1 id="517b" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">GKE自动升级</h1><p id="5fc2" class="pw-post-body-paragraph jn jo hi jp b jq lc ij js jt ld im jv jw le jy jz ka lf kc kd ke lg kg kh ki hb bi translated">GKE自动升级是一种流行且常用的集群生命周期策略。GKE自动升级提供了一种无操作的方式来保持您的GKE集群更新到支持的版本。GKE自动升级分别升级主节点和节点。</p><p id="ce67" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj">主机自动升级</strong> —默认情况下，GKE主机会自动升级。单区域和多区域集群有一个控制平面(主)。在主升级期间，工作负载会继续运行，但是在升级完成之前，您不能部署新的工作负载、修改现有工作负载或对集群的配置进行其他更改。</p><p id="67c4" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">区域群集有多个控制平面副本，一次只能升级一个副本。在升级期间，群集保持高度可用，并且每个控制平面副本仅在升级时不可用。</p><p id="e98c" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj">节点升级</strong> —一次升级一个节点池。在节点池中，节点以不确定的顺序一次升级一个。您可以更改一次升级的节点的<a class="ae kj" href="https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-upgrades#surge" rel="noopener ugc nofollow" target="_blank">数量。此过程可能需要几个小时，具体取决于节点数量及其工作负载配置。</a></p><h1 id="0068" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">GKE汽车升级生命周期战略</h1><p id="9fac" class="pw-post-body-paragraph jn jo hi jp b jq lc ij js jt ld im jv jw le jy jz ka lf kc kd ke lg kg kh ki hb bi translated">我们建议尽可能使用GKE汽车升级。GKE汽车升级优先考虑方便而不是控制。尽管如此，GKE自动升级提供了多种方法来影响您的集群在特定参数范围内升级的时间和方式。您可以影响<a class="ae kj" href="https://cloud.google.com/kubernetes-engine/docs/concepts/maintenance-windows-and-exclusions" rel="noopener ugc nofollow" target="_blank">维护窗口和排除项目</a>。<a class="ae kj" href="https://cloud.google.com/kubernetes-engine/docs/concepts/release-channels" rel="noopener ugc nofollow" target="_blank">发布渠道</a>影响版本选择<a class="ae kj" href="https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-upgrades#surge" rel="noopener ugc nofollow" target="_blank">激增升级</a>影响一次升级多少节点。尽管有这些控制，甚至对于区域集群(具有多个Kubernetes控制平面)，GKE自动升级并不保证服务的正常运行时间。</p><p id="6f9e" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如果您需要以下一项或多项功能，您可以选择不使用GKE自动升级功能:</p><ol class=""><li id="5129" class="lh li hi jp b jq jr jt ju jw lj ka lk ke ll ki lm ln lo lp bi translated">控制GKE群集的确切版本</li><li id="bccd" class="lh li hi jp b jq lq jt lr jw ls ka lt ke lu ki lm ln lo lp bi translated">控制GKE升级的准确时间</li><li id="2237" class="lh li hi jp b jq lq jt lr jw ls ka lt ke lu ki lm ln lo lp bi translated">控制GKE车队的升级策略(在下一篇博客中讨论)。例如，使用多集群作为集群生命周期管理的一部分。</li></ol><p id="76ac" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如果上述任何原因存在，你不能使用GKE自动升级策略。在下一部分中，我将深入探讨几个多集群升级策略以及与每个策略相关的规划。</p><blockquote class="lv lw lx"><p id="7ff8" class="jn jo ly jp b jq jr ij js jt ju im jv lz jx jy jz ma kb kc kd mb kf kg kh ki hb bi translated">接下来… <a class="ae kj" rel="noopener" href="/@ameericus/kubernetes-engine-gke-multi-cluster-life-cycle-management-series-43ed97142c47">第四部分:GKE多集群生命周期管理</a></p></blockquote></div></div>    
</body>
</html>