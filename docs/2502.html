<html>
<head>
<title>GCP Enterprise Landing Zone | Securing the ingress traffic for Cloud Run through the Palo Alto VM Series ( NGFW )</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GCP企业登陆区|保护通过Palo Alto VM系列(NGFW)运行的云的入口流量</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/gcp-enterprise-landing-zone-securing-the-ingress-traffic-for-cloud-run-through-the-palo-alto-vm-a896d976241a?source=collection_archive---------0-----------------------#2022-11-14">https://medium.com/google-cloud/gcp-enterprise-landing-zone-securing-the-ingress-traffic-for-cloud-run-through-the-palo-alto-vm-a896d976241a?source=collection_archive---------0-----------------------#2022-11-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="233c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在是2022年，我们生活在一个高度需求云转型的时代。早些时候，初创公司可以灵活地加入云环境，以利用云的优势——主要是创新和敏捷性。</p><p id="1121" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">初创公司更容易开始使用云，因为他们没有或很少受到内部部署和相关供应商/系统依赖的影响。企业在开始使用云时面临巨大挑战，主要原因如下</p><ol class=""><li id="5155" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">相关系统/供应商</li><li id="9a9e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">过时的系统/应用程序</li><li id="e48c" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">遵守安全合规性和审计</li></ol><p id="b526" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">云自诞生以来一直在不断成熟，并通过文档和新功能慢慢铺平了道路，使企业能够轻松地迁移到云，并利用云带来的业务优势。</p><p id="3893" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个组织可以通过三种不同的方式广泛利用云。每种方式都提供不同的商业利益。这些是:-</p><ol class=""><li id="6f0a" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">IaaS(基础设施即服务)</li><li id="d1d7" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">平台即服务</li><li id="3a2b" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">SaaS(软件即服务)</li></ol><p id="2d14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">企业通常采用云技术，期望根据其审计和安全性合规性来使用安全性。</p><p id="2e8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中一个主要要求是在访问内部应用程序之前对互联网流量启用NGFW检查。</p><p id="9332" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这适用于IaaS和PaaS，因为SaaS是部署在URL上的软件，由单独的团队管理</p><h1 id="0acb" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">在IaaS(中心辐射模型)中启用NGFW</h1><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es kp"><img src="../Images/58e2a4a99816bdc52d5c4269ace391b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sTePA0j45-g1FB3Lvhx6aw.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx translated">图1.1</figcaption></figure><p id="bb8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图1.1是一个在GCP上实现IaaS的示例架构</p><p id="b597" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面的体系结构中，</p><ol class=""><li id="36e2" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">互联网流量从公共LB进入</li><li id="d6b9" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">NGFW会检查这些流量</li><li id="0606" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">最后，流量被转发到内部应用程序，并开始返回流量，从而完成整个流程</li></ol><h1 id="f08a" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">在PaaS(中心辐射模型)中启用NGFW</h1><p id="63cc" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">PaaS代表平台即服务。我们将考虑本文档范围内的云运行。(目前仅支持云运行)</p><p id="6ed1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">直到最近，通过NGFW检查从互联网到云运行的流量仍具有挑战性。以下是在<a class="ae lk" href="https://cloud.google.com/architecture/landing-zones" rel="noopener ugc nofollow" target="_blank">着陆区</a>设置云运行的方法</p><ol class=""><li id="7230" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">当我们旋转云运行应用程序时，我们得到一个与该应用程序相关联的公共url。我们可以使用这个公共URL来加载应用程序。不幸的是，我们无法使用公共url检查通过NGFW运行到云的流量。</li><li id="c5c1" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">我们可以在Cloud Run启动的同一个项目中扩展上述设置和一个全局L7负载平衡器。全局L7负载平衡器具有无服务器NEG功能，可用于连接到私有运行的云。云装甲也可以集成到负载均衡器中。这种设置在云运行前启用WAF功能方面提供了额外的安全性。不幸的是，NGFW不会检查流量</li></ol><p id="0612" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在通过NGFW以私密和安全的方式进行检查时，无法连接云运行</p><p id="0b44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GCP于2022年5月9日发布了一项新功能，使内部lb能够连接到私有云运行。这是2022年11月14日的预览模式(<a class="ae lk" href="https://cloud.google.com/load-balancing/docs/l7-internal/setting-up-l7-internal-serverless" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/load-balancing/docs/l7-internal/setting-up-l7-internal-server less</a></p><p id="6124" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以利用这一新功能，以安全的方式连接通过NGFW运行的云。高层架构看起来应该是这样的</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es ll"><img src="../Images/0a1893635adef96f0da1060c45b688c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dBEYZcBkbcUI3Um9VVTUQA.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx translated">图1.2</figcaption></figure><p id="bd49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">入口:</p><ol class=""><li id="7c36" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">互联网流量从公共LB进入</li><li id="a789" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">这种流量通过NGFW进行检查</li><li id="1acc" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">流量被转发到内部连接到云运行的分支(分支1)项目中的内部负载平衡器</li></ol><p id="90d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">出口:</p><ol class=""><li id="f363" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">云运行使用无服务器连接器连接到分支网络</li><li id="b72a" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">源自云运行的流量通过无服务器连接器进入分支网络，并移动到指定路径</li><li id="723e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">如果连接的目的地是internet或其他分支项目中的资源，则通过NGFW检查该连接</li></ol><p id="354b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实施上述设置需要以下步骤:-</p><ol class=""><li id="8a17" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">访问GCP项目</li><li id="2f7e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">VPC和子网规划和创建(不可信、可信、管理和VPC)</li><li id="f51b" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">VPC凝视着信托VPC和辐条VPC之间</li><li id="092b" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">创建Palo Alto VM系列，与不信任、信任和管理VPC相连接(这可以通过使用GCP市场来实现)</li><li id="7071" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">将Palo Alto虚拟机连接到umig(非托管实例组)</li><li id="13d1" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">创建全局负载平衡器，并将palo alto umig作为后端服务连接到GLB</li><li id="7ff7" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">使用内部负载平衡器在分支项目中创建云运行</li><li id="5511" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">配置Palo Alto的基本入站和出站连接</li><li id="5b27" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">为特定应用程序配置带有域名/ ssl的GLB</li><li id="27c4" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">配置Palo Alto NGFW将流量路由到云运行</li></ol><blockquote class="lm ln lo"><p id="4b21" class="if ig lp ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">作者</p><p id="c81a" class="if ig lp ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">安基特·阿瓦尔</p><p id="c912" class="if ig lp ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">巴维什·库马尔</p><p id="ce3b" class="if ig lp ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">穆罕默德·萨希尔</p></blockquote></div></div>    
</body>
</html>