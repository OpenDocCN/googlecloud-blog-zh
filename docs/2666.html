<html>
<head>
<title>SQL is Structured Query language but the structure can be different in different databases.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL是结构化查询语言，但不同数据库的结构可能不同。</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/sql-is-structured-query-language-but-the-structure-can-be-different-in-different-databases-3f38b90c319?source=collection_archive---------1-----------------------#2022-12-22">https://medium.com/google-cloud/sql-is-structured-query-language-but-the-structure-can-be-different-in-different-databases-3f38b90c319?source=collection_archive---------1-----------------------#2022-12-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="4815" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">BigQuery翻译服务和超越它。</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/099efdef7aeea3ce9e04ea44c7496c8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3kywjZkOgLPxIdNb.png"/></div></div></figure><p id="807f" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">从一个数据库迁移到另一个数据库时，您是否厌倦了翻译sql方言？</p><p id="7e35" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">在迁移到BigQuery时，您不需要担心。</p><h1 id="67b2" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">介绍</h1><p id="f01e" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">本文概述了组织如何利用BigQuery翻译服务将现有的基石Hive SQL查询转换为BigQuery原生查询。我们将讨论这些方法、特性、产品限制和解决方法。</p><p id="6d9c" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">本文还概述了BigQuery翻译服务的当前局限性，并提供了使用Python实用程序的实现指南。</p><p id="9621" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">下面描述了三种方法及其局限性和解决方法。</p><ol class=""><li id="512a" class="ks kt hi jr b js jt jw jx ka ku ke kv ki kw km kx ky kz la bi translated">使用Interactive SQL转换</li></ol><h1 id="c248" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">角色</h1><p id="0976" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">以下预定义角色提供了使用interactive SQL转换器所需的权限:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lb"><img src="../Images/92667fc2aa590ca32a5edba26a5b1c95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FVaNTofEyt7bdIXt.png"/></div></div></figure><p id="36fe" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">按照下面概述的步骤使用批量SQL转换</p><p id="fa0e" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">步骤1: </strong>启用SQL翻译</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lc"><img src="../Images/28c15b513dbf2f994b2f62dd4a50dd4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4LRY72-kjCnqC1_A"/></div></div></figure><p id="df44" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">第二步:</strong>默认情况下，Teradata将作为源。通过单击突出显示的下拉菜单将其更改为HiveQL</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lb"><img src="../Images/117861885d727e3cb91b8455ded1ad56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CnXH5hgOFwyrmLyo"/></div></div></figure><p id="fb75" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">步骤3: </strong>将您的sql语句粘贴到左侧，然后单击翻译。我用你的DDL脚本运行了它。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lb"><img src="../Images/d84cff88411e2fcf33168b03d24711f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*alXx-gVqR7fH810a"/></div></div></figure><p id="a209" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">步骤4: </strong>翻译后的查询出现在右侧。</p><p id="99d8" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">翻译注意事项:</strong></p><ol class=""><li id="a419" class="ks kt hi jr b js jt jw jx ka ku ke kv ki kw km kx ky kz la bi translated">可以通过以下方式对BigQuery表进行分区:</li></ol><ul class=""><li id="96b4" class="ks kt hi jr b js jt jw jx ka ku ke kv ki kw km ld ky kz la bi translated"><strong class="jr hj">时间单位列</strong>:根据表中的时间戳、日期或日期时间列对表进行分区。</li><li id="5866" class="ks kt hi jr b js le jw lf ka lg ke lh ki li km ld ky kz la bi translated"><strong class="jr hj">摄取时间</strong>:当BigQuery摄取数据时，根据时间戳对表进行分区。</li><li id="81a1" class="ks kt hi jr b js le jw lf ka lg ke lh ki li km ld ky kz la bi translated"><strong class="jr hj">整数范围</strong>:基于整数列对表进行分区。</li></ul><p id="8c3c" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">在HiveQl中，分区是在字符串字段上进行的，所以在翻译的sql中，它将其翻译为集群，就像在BigQuery中可以在字符串字段上进行的那样。</p><ol class=""><li id="55f1" class="ks kt hi jr b js jt jw jx ka ku ke kv ki kw km kx ky kz la bi translated">BigQuery需要指定datasetname，因为在源HiveQL中没有提到schema_name，所以它在将其转换为BigQuery SQL后显示错误。</li></ol><p id="b986" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">表“table1”必须用数据集限定(例如dataset.table)</p><h1 id="e3a7" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">限制</h1><ol class=""><li id="3670" class="ks kt hi jr b js kn jw ko ka lj ke lk ki ll km kx ky kz la bi translated">如果必须添加或替换任何默认的数据集或项目名称，那么您不能从这个交互式UI中执行此操作。<strong class="jr hj">你必须通过批量SQL转换(这将在下面解释)。</strong></li><li id="e7bd" class="ks kt hi jr b js le jw lf ka lg ke lh ki li km kx ky kz la bi translated">任何参数都需要手动替换</li><li id="0b0b" class="ks kt hi jr b js le jw lf ka lg ke lh ki li km kx ky kz la bi translated">DDL语句需要是SQL输入的一部分</li></ol><h1 id="a952" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">2.使用批处理SQL转换器</h1><p id="4302" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated"><strong class="jr hj">步骤1: </strong>左侧工具栏→转到迁移→ Sql翻译→点击开始翻译</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/2613d97b21cf8b59527f82754eebf1f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*U1ZzNkpGDUDkKSJh"/></div></div></figure><p id="e4e1" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">步骤3: </strong>将所有sql脚本保存在GCS bucket的一个文件夹中，并在Source Details中给出该路径的详细信息。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ln"><img src="../Images/0b6a64a23b70430cc170e44c492cab5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lVYb5c3q2djvn30o"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lo"><img src="../Images/dad27f31c96ffc049b45162a2dbaa770.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NSBUq9ysJIqldcVH"/></div></div></figure><p id="48f9" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">第4步</strong>:提供翻译后的输出将被存储的目标细节</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/6b7f2d01a315b273e45c2a6fd42947cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-qyiQ4wTLTfyvdCr"/></div></div></figure><p id="eee8" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">步骤5: </strong>提供默认的项目和数据集名称</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lq"><img src="../Images/18eb6b6140f19e5bfe72bf346bdf6448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*t6ZwBJGPE4tMAQY4"/></div></div></figure><p id="996e" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">步骤6: </strong>在目的地桶中生成翻译后的查询。</p><p id="6490" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">有一个名为“batch_translation_report.csv”的文件，如果有任何语句由于某种原因没有转换，该文件将包含所有错误。</p><p id="7a8a" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">源脚本<strong class="jr hj"><em class="lr">batch _ translation _ hive QL . SQL</em></strong>没有任何特殊字符，因此按照预期进行了翻译。</p><p id="b422" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">但是脚本<strong class="jr hj"><em class="lr">batch _ translation _ hive QL 1 . SQL</em></strong>无法翻译，因为它有“##”符号</p><p id="464b" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj"> <em class="lr">输出文件夹中的batch _ translation _ hive QL 1 . SQL</em></strong>:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/727abe83c098932f89905de704612da6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RC71M3upqpphZrcx"/></div></div></figure><p id="938d" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">在“batch_translation_report.csv”文件中，显示了脚本<strong class="jr hj"><em class="lr">batch _ translation _ hive QL 1 . SQL</em></strong>无法翻译的原因。</p><p id="87fa" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">batch _ translation _ report . CSV的内容:</strong></p><p id="64f7" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">时间戳，文件路径，文件名，脚本行，脚本列，TranspilerComponent，环境，对象名，严重性，类别，消息，脚本上下文，操作</p><p id="6cf2" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">1671557757534，GS://source _ Hive QL/batch_translation_hiveql1.sql，batch _ translation _ Hive QL 1 . sql，10，24，TranspilerCompiler:compiler，Hive: bq_translation_db，，<strong class="jr hj"> ERROR，LexicalError，未知令牌:#，M table _ 2 WHERE((column _ a&gt;= {&gt;HERE&lt;} #，检查输入的SQL是否正确并分类在</strong></p><p id="910e" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">所以它不能翻译剧本。</p><p id="48b6" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">在这种情况下，我们必须删除或预处理查询。然而，从这份报告中，我们将获得足够的见解，什么要取代。</p><p id="bd31" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">此外，UDF和专门的功能，你必须在翻译后单独创建。</p><p id="9d96" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">它能翻译的常用函数很少。</p><p id="4955" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">在这种情况下，替换' ## '后，它被翻译。</p><p id="d62e" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">batch_translation_hiveql.sql已使用默认项目名称和数据集名称进行了翻译。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lt"><img src="../Images/4a42d50e3314045e974491a4a3c709a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*spW4bqmxakQsJPrF"/></div></div></figure><h1 id="4e10" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">限制</h1><ol class=""><li id="5009" class="ks kt hi jr b js kn jw ko ka lj ke lk ki ll km kx ky kz la bi translated">目前缺少参数映射/替换。使用python工具查看以下解决方法。</li></ol><h1 id="53a7" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">3.使用Google构建的Python实用程序通过一个宏文件来克服这个词法问题。</h1><p id="11ef" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">如果需要的话，这是提供从源到目标的对象映射的另一种方法。</p><p id="5863" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">这些代码必须在本地运行，或者在某个虚拟机或云外壳上运行。</p><p id="ebab" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">步骤1: </strong>在你的机器上克隆下面的github repo</p><p id="2b47" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">吉西卜:<a class="ae lu" href="https://github.com/google/dwh-migration-tools.git" rel="noopener ugc nofollow" target="_blank">https://github.com/google/dwh-migration-tools.git</a></p><p id="c94f" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">第二步:</strong><strong class="jr hj">CD dwh-迁移-工具/客户端</strong></p><p id="501b" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">第三步:</strong>根据需要更新配置文件。存储库中有一个示例文件。</p><blockquote class="lv lw lx"><p id="8224" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> #版权所有2022谷歌公司</em></p><p id="7ae1" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> #根据Apache许可证2.0版许可(“许可证”)；</em></p><p id="26f7" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated">除非符合许可证的规定，否则您不得使用本文件。</p><p id="1bdb" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> #您可以在</em>获得许可证的副本</p><p id="db77" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated">【http://www.apache.org/licenses/LICENSE-2.0】#<a class="ae lu" href="http://www.apache.org/licenses/LICENSE-2.0" rel="noopener ugc nofollow" target="_blank"><em class="hi"/></a></p><p id="9a1b" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> #除非适用法律要求或书面同意，软件</em></p><p id="150d" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> #根据许可证分发是基于“原样”分发，</em></p><p id="ee4b" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> #无任何明示或暗示的担保或条件。</em></p><p id="1459" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> #请参见许可协议，了解特定语言的管理权限和</em></p><p id="0def" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> #许可下的限制。</em></p><p id="a858" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> gcp_settings: </em></p><p id="da27" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> # GCP项目编号。</em></p><p id="0ef6" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi">项目编号:' bq_translation_demo_proj' </em></p><p id="238a" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> # Google云存储桶，示例:'示范性_客户端_测试_外部'</em></p><p id="b889" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi">GCS _ bucket:' temp _ hive QL _ bq _ translation '</em></p><p id="7c66" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi">翻译_配置:</em></p><p id="7871" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> #翻译类型需要是以下类型之一:Translation_Teradata2BQ，Translation_Redshift2BQ，Translation_Bteq2BQ，</em></p><p id="e38b" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> # Translation_Oracle2BQ，Translation_HiveQL2BQ，Translation_SparkSQL2BQ，Translation_Snowflake2BQ，</em></p><p id="6429" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> # Translation_Netezza2BQ，Translation _ AzureSynapse2BQ，Translation_Vertica2BQ，Translation_SQLServer2BQ，</em></p><p id="4b9f" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> # Translation_Presto2BQ，Translation_MySQL2BQ。</em></p><p id="5ab9" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi">Translation _ type:Translation _ hive QL 2 bq</em></p><p id="4f17" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> #位置需要是以下之一:美国、欧盟、亚洲-东北1、亚洲-东南1、欧洲-西方2、亚洲-南方1、</em></p><p id="0fa0" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> #澳洲-东南1，南美-东1。</em></p><p id="bcdf" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi">地点:“美国”</em></p><p id="e857" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi">#[可选字段]当缺少数据库名称时，完全限定SQL对象的默认数据库名称。</em></p><p id="7ab4" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi">默认_数据库:' bq_translation_db' </em></p><p id="d34a" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> #【可选字段】模式搜索路径。当SQL对象缺少模式名时，翻译引擎将搜索该列表以找到该值。</em></p><p id="9fc6" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi">schema _ search _ path:[' bq _ translation _ schema ']</em></p><p id="fd5e" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> #将此项设置为True(默认值)以清理‘中的临时数据。“tmp_processed”文件夹。</em></p><p id="dc22" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi">clean _ up _ tmp _ files:False</em></p></blockquote><p id="9453" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">第四步:</strong></p><p id="7409" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">如果需要替换输入脚本中的某些变量，请更新<strong class="jr hj"> macros.yaml </strong>文件。</p><p id="bf8e" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">资源库中提供了示例macros.yaml文件。</p><p id="3c94" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">这是用于翻译的一个。</p><blockquote class="lv lw lx"><p id="4577" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> Macros.yaml <br/> #版权所有2022 Google LLC <br/> # <br/> #根据Apache许可证2.0版(“许可证”)获得许可；<br/> #除非符合许可，否则不得使用本文件。<br/> #您可以在<br/>#<br/>#</em><a class="ae lu" href="http://www.apache.org/licenses/LICENSE-2.0" rel="noopener ugc nofollow" target="_blank"><em class="hi">http://www.apache.org/licenses/LICENSE-2.0</em></a><em class="hi"><br/>#<br/>#获得许可的副本，除非适用法律要求或书面同意，根据许可分发的软件<br/> #按“原样”分发，<br/> #不附带任何种类的明示或暗示的担保或条件。<br/> #参见许可协议，了解许可协议下的特定语言管理权限和<br/> #限制。</em></p><p id="bcef" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> #示例宏替换图定义。<br/> #要启用宏替换，请在运行Python工具时传递arg '-m macro _ substitution _ map . YAML '。工具<br/> #将对查询文件执行以下操作。<br/> #翻译开始前(预处理):对于每个以'结尾的文件。sql '，' ${MACRO_1} '和' %MACRO_2% '将分别替换为<br/> # 'macro_replacement_1 '和' macro_replacement_2 '。对于文件' 2.sql '，该工具还会将<br/> # 'templated_column '替换为' replacing_column '。<br/> #翻译完成后(后处理):该工具将通过用映射中的键替换<br/> #值来反转所有输出查询文件的替换。</em></p><p id="7def" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> #注意，该工具只对单个<br/> #路径中的所有宏(映射中定义的键)执行严格的字符串替换。<br/> #在后处理期间，首先通过简单地交换<br/> #映射中每个文件的关键字和值来计算反向映射。如果不同的宏映射到相同的值，可能会发生冲突。</em></p><p id="011c" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi">宏:<br/> '*。SQL ':<br/>' # # month _ for _ no _ days _ ago # # ':' 03 ' "<br/>' # # current _ month # # ':' 05 ' "</em></p></blockquote><p id="1db0" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">到目前为止，这个实用程序还不支持marcos.yaml文件中的regex，所以您必须提供您想要替换或替代的每个参数，或者给出词法错误的每个参数。</p><p id="b3b6" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">步骤5: </strong>在这种情况下不使用对象映射，但如果需要，这里有一个object_mapping.json文件的示例:</p><blockquote class="lv lw lx"><p id="b185" class="jp jq lr jr b js jt ju jv jw jx jy jz ly kb kc kd lz kf kg kh ma kj kk kl km hb bi translated"><em class="hi"> { <br/>【名称映射】:[{ <br/>【源】:{ <br/>【类型】:"关系"、<br/>【数据库】:"源_数据库_名称"、<br/>【模式】:"源_模式_名称"、<br/>"关系":"源_表_名称"<br/> }、<br/>"目标":{ <br/>"数据库":"目标_数据库_名称"、<br/>"模式":"目标_目标</em></p></blockquote><p id="62fd" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">第六步:</strong>创建输入输出目录。</p><p id="4cd7" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">输入目录的默认值是客户端/输入。要覆盖它，请在运行上述命令时添加标志— input path/to/input_dir。</p><p id="0d6e" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">存储翻译作业输出的输出目录的默认值是client/output。要覆盖它，请在运行上述命令时添加标志—输出路径/to/output_dir。</p><p id="1415" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">这里我展示了如何覆盖默认的输入和输出目录，然后执行。</p><p id="fb07" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">创建了这两个文件夹:替换为您的路径</p><p id="3b46" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">输入_目录</strong>:'/home/* * * * */dwh-migration-tools/client/input/SQL _ input/'</p><p id="7131" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">输出_目录</strong>:'/home/* * * * */dwh-migration-tools/client/output/'</p><p id="b99f" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">请在<strong class="jr hj">输入目录下输入sql脚本。</strong></p><p id="5c6b" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">样本输入SQL1: </strong></p><p id="8025" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">创建表格table1</p><p id="75b9" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">如同</p><p id="60c3" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">选择案例</p><p id="667f" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">当((column_a为空时</p><p id="2222" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">或者IBECTrim(column_a) IN(''，' '，'-'，' empty '))</p><p id="25e3" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">然后(“”)</p><p id="b76e" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">ELSE (IBECTrim(column_a))</p><p id="e9d8" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">以columna_a1结尾，</p><p id="abe6" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">列_b</p><p id="420b" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">来自表2</p><p id="79aa" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">其中((column _ a &gt; = # # month _ for _ no _ days _ ago #</p><p id="62b8" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">和column_a &lt;= ##current_month##)</p><p id="2986" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">AND column_b = ‘0’);</p><p id="fc5d" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">样本输入SQL2: </strong></p><p id="737c" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">select * from foo where day &gt; = $ { hive conf:CURRENT _ DATE }；</p><p id="7d11" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">在这两种情况下，都有像“##”和“$”这样的符号，使用这些符号，Bigquery翻译服务将失败。</p><p id="a50f" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">将它们放在如下输入文件夹中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mb"><img src="../Images/2a7f7a4e42a2f1aebdd88a7c028ab153.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JUKFTu7p0AGgozwV"/></div></div></figure><p id="1a91" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">步骤7: </strong>使用这些输入、输出目录和宏文件执行实用程序</p><p id="25b8" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">从“~/dwh-migration-tools/”路径启动以下命令</p><p id="1588" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">bin/dwh-migration-client-input/home/* * * * */dwh-migration-tools/client/input/SQL _ input-output/home/* * * * */dwh-migration-tools/client/output-m client/macros . YAML</strong></p><p id="e81c" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">翻译后的输出脚本将与batch_translation_report.csv一起存储在输出目录中</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mc"><img src="../Images/85238371cabfbf788de2b383bb0af6d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GWs6Z7nVh2GF-tS3"/></div></div></figure><p id="1a8c" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">为sql1.sql翻译的sql: </strong></p><p id="30df" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">创建表bq _ translation _ db . bq _ translation _ schema . TABLE 1</p><p id="7f57" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">如同</p><p id="6df0" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">挑选</p><p id="7568" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">情况</p><p id="4bbf" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">当table_2.column_a为空时</p><p id="a42f" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">或者ibectrim(table_2.column_a)在(</p><p id="f80e" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">'，'，'-'，'空'</p><p id="e549" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">)然后''</p><p id="1fd2" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">ELSE ibectrim(table_2.column_a)</p><p id="01fb" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">以columna_a1结尾，</p><p id="333b" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">表2 .列b</p><p id="8c77" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">从</p><p id="8c4d" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">bq _ translation _ db . bq _ translation _ schema . table _ 2</p><p id="8e32" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">其中table _ 2 . column _ a &gt; = # # month _ for _ no _ days _ ago # #</p><p id="bbdc" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">和table_2.column_a &lt;= ##current_month##</p><p id="151f" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">AND table_2.column_b = ‘0’</p><p id="9fe8" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi">;</p><ul class=""><li id="058e" class="ks kt hi jr b js jt jw jx ka ku ke kv ki kw km ld ky kz la bi translated">Default projectname, dataset_name, table names are added in the translated script and it translated the symbols as is from source script without giving any error.</li></ul><p id="4dd4" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">执行脚本时需要记住的几点:</strong></p><ol class=""><li id="fdf6" class="ks kt hi jr b js jt jw jx ka ku ke kv ki kw km kx ky kz la bi translated">如果您想在没有macros.yaml和对象映射的情况下运行，并使用默认的输入/输出目录，请执行下面的命令</li></ol><p id="1ff4" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">bin/dwh-迁移-客户端</strong></p><p id="e01c" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">2.如果您希望在没有macros.yaml和对象映射的情况下运行，并且希望覆盖默认的输入/输出目录并使用您自己的目录，请执行以下命令</p><p id="a0dd" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj"> bin/dwh-migration-client —输入路径/to/input_dir —输出路径/to/output_dir </strong></p><p id="c619" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">3.如果您想用宏运行并覆盖输入/输出目录</p><p id="4bdd" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">bin/dwh-migration-client-input/home/* * * * */dwh-migration-tools/client/input/SQL _ input-output/home/* * * * */dwh-migration-tools/client/output-m client/macros . YAML</strong></p><p id="28b2" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">4.如果要使用对象映射运行:</p><p id="f012" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj"> bin/dwh-migration-client -o客户端/object_mapping.json </strong></p><p id="347f" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">快乐迁徙。翻译愉快。:)</p></div></div>    
</body>
</html>