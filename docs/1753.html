<html>
<head>
<title>A Batch Driven CDC (Change Data Capture) Approach using Google Cloud Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Google云平台的批量驱动CDC(变更数据捕获)方法</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/a-batch-driven-cdc-change-data-capture-approach-using-google-cloud-platform-5595fe6f98f4?source=collection_archive---------0-----------------------#2021-01-14">https://medium.com/google-cloud/a-batch-driven-cdc-change-data-capture-approach-using-google-cloud-platform-5595fe6f98f4?source=collection_archive---------0-----------------------#2021-01-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="d470" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">通常</h1><p id="a585" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如今，大多数数据库都有自己的功能，或者可以与合作伙伴的解决方案协同工作，以便实时识别数据变化。这允许某人创建变更数据捕获(CDC)流，并不断向云数据仓库系统(如<a class="ae kb" href="https://cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank"> BigQuery </a>)提供数据，从而实现实时和预测性分析。启用CDC功能通常需要在源上进行额外的配置，但它提供了一种高效的方法来识别数据更改并将其级联到下游系统和应用程序。</p><p id="05bf" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">如果没有内置的实时CDC解决方案可用于所讨论的源系统，那么通常可以通过执行增量批处理作业、基于时间戳或某种“增量id”列从源表中读取记录来识别“更改了哪些行”。例如，增量批处理作业可能每小时执行一次，并选择last_updated列大于“last_job_run_timestamp”的所有记录。“增量id”列可以由应用程序代码或通过数据库触发器来填充。这种方法在传统的基于ETL的DW解决方案中并不少见，但是当使用基于触发器的方法时，下游解决方案上的数据的新鲜度或源上的性能问题通常会促使组织考虑实时CDC解决方案。</p><h1 id="1ad7" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">有离群值</h1><p id="c9df" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">然而，在有些情况下，实时CDC和增量批次变更识别都是不可能的。有时，无论出于什么原因，源系统都不能被修改:安全性、风险、关键程度、缺乏知识等等。然而，变更仍然需要被识别并加载到数据仓库目标系统中。</p><p id="6f97" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">这个特殊的工件试图记录这个特殊案例的方法和解决方案，在这个案例中，您不能实现事实上的CDC解决方案并寻找替代方法。我不得不说，这种方法可能不适用于非常大的数据库、大表或网络连接缓慢的地方，但在某些情况下，它可能是适用的。</p><h1 id="8cea" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">基于真实的用例</h1><p id="fa4d" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">下面是我最近与一位客户合作时遇到的一个真实的用例:想象一个关键的OLTP数据库(在非常旧的AS/400上的DB2 ),其中根本不允许任何更改。例如，像IBM replicator to MQ这样的解决方案没有启用，在不久的将来也不可能启用，因为每个人都害怕接触现有的系统。此外，这些表没有“最后更新的时间戳列”来执行增量“变更数据捕获”逻辑。也不能实施基于触发器的解决方案，因为任何更改都需要全面的回归测试，并且会给这个复杂的环境带来风险。</p><p id="ae4b" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">面临的挑战是:我们如何识别DB2随时间的变化，并将变化的行与BigQuery中的最终数据集表合并？</p><p id="cf85" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">使用Google云平台构建了一个定制解决方案来实现这一特定的业务目标。该解决方案采用ELT(提取-加载-转换)方法，使用以下Google云服务:</p><ul class=""><li id="5d9d" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated">Cloud <a class="ae kb" href="https://cloud.google.com/composer" rel="noopener ugc nofollow" target="_blank"> Composer </a>作为工作流、编排和调度工具</li><li id="7482" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated"><a class="ae kb" href="https://cloud.google.com/dataflow" rel="noopener ugc nofollow" target="_blank">用于提取/加载到BigQuery的数据流</a></li><li id="c370" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated"><a class="ae kb" href="https://cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank"> BigQuery </a>用于CDC识别和附加转换</li></ul><h1 id="8050" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">提取-加载-转换解决方案架构:</h1><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/bf6f72e67cc0f20adf7bc904eb0be423.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7c0cXycZ5Tn35Pn_adeJKg.png"/></div></div></figure><p id="9453" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj">解决方案主要步骤:</strong></p><p id="a96e" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">1 =部署了一个预定的<a class="ae kb" href="https://cloud.google.com/composer/docs/how-to/using/writing-dags" rel="noopener ugc nofollow" target="_blank"> Cloud Composer DAG </a>来管理整个工作流，首先是一个快速的“truncate BigQuery staging table命令”，然后是数据流加载作业初始化和执行。</p><p id="8d73" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">2 = Dataflow使用标准的<a class="ae kb" href="https://cloud.google.com/dataflow/docs/guides/templates/provided-batch#jdbctobigquery" rel="noopener ugc nofollow" target="_blank"> JDBCtoBigQ </a> uery模板来执行“从DB2表中选择”,同时将选择的结果插入到之前截断的BigQuery临时表中。这里提到的数据流步骤不需要实际的代码开发。这只是将正确的参数传递给可用的标准数据流模板的问题。</p><p id="1b7d" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">3 =由Cloud Composer编排，在BigQuery内部执行了一些基于SQL的步骤，使用了BigQuery的强大功能和无限的可伸缩性:</p><ul class=""><li id="9d15" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated">BigQuery将临时表(最近加载的)的内容与另一个表(最终表)的内容进行了比较，并确定了不同之处</li><li id="3ece" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">BigQuery将这些差异记录到一个日志表中，创建一段时间内所有更改的踪迹，并允许在特定日期/时间精确定位特定行的值</li><li id="deb4" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">最后，BigQuery通过ANSI-SQL命令将确定的更改与最终表的内容合并</li></ul><p id="4ca8" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">4 = Cloud Composer监控整个工作流的执行，并在执行所有工作流步骤时发送电子邮件</p><p id="ad17" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">5 =客户的BI工具随后能够连接到BigQuery并观察业务仪表板上最新版本的数据</p><h1 id="464b" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">想自己实践这个解决方案？</h1><h2 id="5286" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">让您更快入门的注意事项:</h2><ul class=""><li id="333b" class="kh ki hi jf b jg jh jk jl jo lv js lw jw lx ka km kn ko kp bi translated"><strong class="jf hj">对于源服务器</strong>:您可能想考虑使用MySQL或Postgres实例作为源服务器，在本练习中模拟DB2服务器。整个解决方案使用基于JDBC的标准SQL，所以只要您的数据库平台有一个可用的JDBC驱动程序，就没问题。谷歌已经通过<a class="ae kb" href="https://cloud.google.com/sql" rel="noopener ugc nofollow" target="_blank">云SQL </a>完全管理MySQL/Postgres/SQLServer选项。例如，你也可以决定在谷歌计算引擎上直接安装一个MySQL实例，利用来自<a class="ae kb" href="https://cloud.google.com/marketplace" rel="noopener ugc nofollow" target="_blank">谷歌云市场</a>的一个预建映像。如果使用市场镜像，不需要手动安装MySQL。只需安装预配置的映像。</li><li id="079c" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">代理服务器:如果更改防火墙规则以允许数据流和您的源数据库之间的通信是一个挑战，您可以考虑为这一步使用反向代理解决方案，因为这是一个非生产练习。例如，使用<a class="ae kb" href="https://console.cloud.google.com/marketplace/product/click-to-deploy-images/nginx?q=search&amp;referrer=search" rel="noopener ugc nofollow" target="_blank"> nginx </a>，数据流和源数据库之间的防火墙配置可能会变得非常简单。仍然需要修改防火墙规则，但是因为Google Cloud services和源数据库之间的所有通信都将通过反向代理，所以您只需要允许代理服务器IP和您的源之间的通信。我想强调的是，由于这是一个概念验证环境，因此可扩展性、性能、HA和其他问题都不适用。对于生产，建议在Google云和您的源系统之间部署CloudVPN或专用的互连管道，完全消除反向代理组件。</li></ul><h1 id="1cc6" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">准备好动手了吗？以下是主要步骤:</h1><h1 id="f4c4" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">1.使用Google Cloud Marketplace部署一个MySQL计算映像并准备它</h1><ul class=""><li id="62cd" class="kh ki hi jf b jg jh jk jl jo lv js lw jw lx ka km kn ko kp bi translated"><strong class="jf hj">通过使用谷歌云市场启动</strong>预装了<a class="ae kb" href="https://console.cloud.google.com/marketplace/product/bitnami-launchpad/mysql" rel="noopener ugc nofollow" target="_blank"> MySQL的计算引擎。记下默认的root密码</a></li><li id="4413" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated"><strong class="jf hj">通过调整my.cnf启用mysql远程连接</strong></li></ul><blockquote class="ly lz ma"><p id="ad76" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated"><em class="hi">VI/opt/bitnami/MySQL/conf/my . CNF</em></p><p id="1bcf" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated"><em class="hi">#用您的IP地址bind-address = xxx.xxx.xxx.xxx替换xxx或对所有IP使用0 . 0 . 0 . 0</em></p><p id="7dd9" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">重启mysql</p></blockquote><ul class=""><li id="6af4" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated"><strong class="jf hj">在mysql中创建一个测试数据库、用户和一个新表</strong></li></ul><blockquote class="ly lz ma"><p id="ecf5" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">mysql -u root -h <your_db_ip> -p</your_db_ip></p><p id="1bf0" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">创建数据库testdb</p><p id="0dbc" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">创建由“<your_password>”标识的用户“USER 1”@“%”；</your_password></p><p id="6617" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">在*上授予全部权限。*到“用户1”@“%”；</p><p id="08cc" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">刷新权限；</p><p id="0a91" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">创建表testdb.table1</p><p id="48df" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">(</p><p id="6f08" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">id INT，</p><p id="8d14" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">col1 VARCHAR(10)，</p><p id="92ea" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">col2 VARCHAR(10)，</p><p id="8914" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">col3 VARCHAR(10)，</p><p id="20d6" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">col4 VARCHAR(10)</p><p id="479c" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">);</p></blockquote><ul class=""><li id="168c" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated"><strong class="jf hj">在新创建的表上插入一些测试数据</strong></li></ul><blockquote class="ly lz ma"><p id="882c" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">将值插入testdb.table1，' col 1–1 '，' col 2–1 '，' col 3–1 '，' col 4–1 ')；</p><p id="705a" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">将值插入testdb.table1，' col 1–2 '，' col 2–2 '，' col 3–2 '，' col 4–2 ')；</p><p id="f645" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">将值插入testdb.table1，' col 1–3 '，' col 2–3 '，' col 3–3 '，' col 4–3 ')；</p><p id="121e" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">将值插入testdb.table1，' col 1–4 '，' col 2–4 '，' col 3–4 '，' col 4–4 ')；</p><p id="3897" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">将值插入testdb.table1，' col 1–5 '，' col 2–5 '，' col 3–5 '，' col 4–5 ')；</p><p id="e981" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">提交；</p></blockquote><h1 id="846a" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">2.使用GCE和Marketplace配置NGINX反向代理(一旦设置了CloudVPN和/或互连，就不再需要)</h1><ul class=""><li id="485f" class="kh ki hi jf b jg jh jk jl jo lv js lw jw lx ka km kn ko kp bi translated"><strong class="jf hj">部署</strong>来自<a class="ae kb" href="https://console.cloud.google.com/marketplace/product/click-to-deploy-images/nginx?q=search&amp;referrer=search" rel="noopener ugc nofollow" target="_blank">谷歌云市场</a>的nginx服务器</li><li id="3c44" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated"><strong class="jf hj">将</strong> nginx反向代理配置为直通</li></ul><blockquote class="ly lz ma"><p id="1b44" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">sudo su -</p><p id="a2f9" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">CP/etc/nginx/nginx . conf/etc/nginx/nginx . conf . orig</p><p id="851a" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">vi /etc/nginx/nginx.conf</p><p id="e22a" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">—用以下内容替换整个文件(/etc/nginx/nginx.conf)的内容，将<strong class="jf hj"> 10.150.0.2:3306更改为MySQL数据库在</strong>运行的任何IP:PORT组合</p><p id="02e3" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">########</p><p id="463c" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">用户www-data；</p><p id="1169" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">worker_processes自动；</p><p id="1b65" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">PID/run/nginx . PID；</p><p id="6553" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">包括/etc/nginx/modules-enabled/*。conf</p><p id="01d1" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">事件{</p><p id="7789" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">工人_连接1024；</p><p id="6372" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">}</p><p id="e929" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">溪流{</p><p id="78b6" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">上游sqlvm {</p><p id="2709" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">服务器10 . 150 . 0 . 2:3306；</p><p id="a606" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">}</p><p id="946e" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">###在这种情况下，代理将监听1433</p><p id="85aa" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">服务器{</p><p id="d96a" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">听1433；</p><p id="56d1" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">proxy _ pass sqlvm</p><p id="ce54" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">}</p><p id="2e5c" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">}</p><p id="7b65" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">############</p><p id="419a" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">重启nginx并检查它的进程</p><p id="73b8" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">systemctl停止nginx</p><p id="846e" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">systemctl启动nginx</p><p id="028d" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">系统控制状态nginx</p></blockquote><h1 id="6f58" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">3.使用刚刚配置的nginx代理测试与MySQL的连接</h1><blockquote class="ly lz ma"><p id="4165" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">下面的例子:</p><p id="0a61" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">—相应调整nginx IP和端口</p><p id="39e3" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">mysql -u用户1 -h 10.128.0.5 -P 1433 -p</p><p id="8a19" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">MySQL &gt; select * from testdb . table 1；</p><p id="6611" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">+ — — — + — — — — + — — — — + — — — — + — — — — +</p><p id="7da5" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">| id |列1 |列2 |列3 |列4 |</p><p id="5c98" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">+ — — — + — — — — + — — — — + — — — — + — — — — +</p><p id="62ee" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">| 1 |列1–1 |列2–1 |列3–1 |列4–1 |</p><p id="1486" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">| 2 |列1–2 |列2–2 |列3–2 |列4–2 |</p><p id="e335" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">| 3 |列1–3 |列2–3 |列3–3 |列4–3 |</p><p id="9c37" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">| 4 |列1–4 |列2–4 |列3–4 |列4–4 |</p><p id="039e" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">| 5 |列1–5 |列2–5 |列3–5 |列4–5 |</p><p id="e93d" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">+ — — — + — — — — + — — — — + — — — — + — — — — +</p><p id="351b" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">一组5行(0.00秒)</p></blockquote><h1 id="cb43" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">4.创建大查询数据集和表</h1><ul class=""><li id="7d06" class="kh ki hi jf b jg jh jk jl jo lv js lw jw lx ka km kn ko kp bi translated"><strong class="jf hj">通过Google <a class="ae kb" href="https://cloud.google.com/bigquery/docs/datasets#console" rel="noopener ugc nofollow" target="_blank">云控制台</a>或<a class="ae kb" href="https://cloud.google.com/bigquery/docs/datasets#bq" rel="noopener ugc nofollow" target="_blank"> gcloud </a>等效命令创建一个BigQuery数据集</strong>(本例中使用Google_CarlosAugusto)</li><li id="cea8" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated"><strong class="jf hj">创建BigQuery表</strong>来处理定制的CDC方法</li></ul><p id="a7fa" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj">描述</strong>:</p><p id="004d" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><em class="mb">表1 </em> =结束/最终表(CDC数据将被合并到其中)</p><p id="3d07" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><em class="mb"> Table1_log </em> =将保存/捕获加班表1的所有更改……将其视为一个审计表，保存所有行更改</p><p id="a3f3" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><em class="mb">table 1 _ Staging</em>= Staging table，来自源的原始数据将使用数据流加载到该表中</p><blockquote class="ly lz ma"><p id="bd33" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">创建或替换表格</p><p id="2a24" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">` Google_CarlosAugusto.table1 '</p><p id="ec8f" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">(</p><p id="d7b4" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">id INT64，</p><p id="5b30" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">col1字符串，</p><p id="c25e" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">col2字符串，</p><p id="795f" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">col3字符串，</p><p id="de46" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">col4字符串</p><p id="abe9" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">)</p><p id="70ad" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">;</p><p id="8520" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">创建或替换表格</p><p id="4986" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">` Google _ Carlos augusto . table 1 _ log '</p><p id="6937" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">(</p><p id="c16a" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">op字符串，</p><p id="c487" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">id INT64，</p><p id="32bc" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">col1字符串，</p><p id="f511" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">col2字符串，</p><p id="6f04" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">col3字符串，</p><p id="f1b9" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">col4字符串，</p><p id="bbb1" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">changetime日期时间</p><p id="8d7e" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">)</p><p id="5d3e" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">;</p><p id="c8bf" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">创建或替换表格</p><p id="807b" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">` Google _ carlosaugusto . table 1 _ staging '</p><p id="9a8c" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">(</p><p id="23dd" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">id INT64，</p><p id="6f4e" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">col1字符串，</p><p id="e06c" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">col2字符串，</p><p id="2116" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">col3字符串，</p><p id="364c" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">col4字符串</p><p id="d9c0" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">)</p><p id="8aa9" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">;</p></blockquote><h1 id="c34e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">5.创建GCS存储桶，包括一个存储适当的源jdbc驱动程序(供数据流使用)的存储桶</h1><blockquote class="ly lz ma"><p id="4f26" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">gsutil mb gs://drivers-bucket</p><p id="d24f" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">gsutil MB GS://composer _ output _ bucket</p><p id="d5ab" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">gsutil CP/dev/null GS://drivers-bucket/tmp _ dir/log</p><p id="9adc" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">gsutil CP/dev/null GS://composer _ output _ bucket/tmp/log</p><p id="b4ba" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">gsutil CP MySQL-connector-Java-5 . 1 . 49-bin . jar GS://drivers-bucket</p></blockquote><h1 id="ccb5" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">6.使用云控制台创建云合成器实例</h1><p id="0f4c" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><a class="ae kb" href="https://cloud.google.com/composer/docs/how-to/managing/creating" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/composer/docs/how-to/managing/creating</a></p><h1 id="fd57" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">7.下载下面的DAG(有向无环图),做相应的调整。然后将其部署到Composer并执行它</h1><ul class=""><li id="7d03" class="kh ki hi jf b jg jh jk jl jo lv js lw jw lx ka km kn ko kp bi translated"><strong class="jf hj">下载</strong> <a class="ae kb" href="https://github.com/caugusto/g-code/blob/main/BQ-ELT-CDC/CDC-DAG-v1.py" rel="noopener ugc nofollow" target="_blank">这个DAG </a> python示例文件到你的工作站，因为你需要根据你的设置修改一些东西</li><li id="ddc9" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated"><strong class="jf hj">在Composer </strong> /Airflow中定义以下环境变量。根据您的设置使用适当的值</li></ul><blockquote class="ly lz ma"><p id="ec8a" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">gcp _项目</p><p id="b752" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">gcs_bucket</p><p id="a2bc" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">gce _区域</p><p id="0847" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">gce _区域</p><p id="ff4d" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">电子邮件</p><p id="6830" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">数据集标识</p></blockquote><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es mf"><img src="../Images/260e63fc4b9276606fbe9cd6c1dfe288.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-baa7fpEjGWEXbQHtaxAPg.png"/></div></div></figure><ul class=""><li id="359c" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated"><strong class="jf hj">修改</strong>下载的DAG文件，替换与您的设置相关的值的“&lt; CHANGEME &gt;”引用</li></ul><p id="c2cd" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><em class="mb"> ps:如果数据集或表的名称/定义被更改，则除了标有“</em>&lt;change me&gt;<em class="mb">”</em>的DAG行之外，还需要修改其他DAG行</p><ul class=""><li id="4ca0" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated"><strong class="jf hj">将修改后的DAG </strong>文件上传到Cloud <a class="ae kb" href="https://cloud.google.com/composer/docs/how-to/using/managing-dags" rel="noopener ugc nofollow" target="_blank"> Composer的DAG文件夹</a></li><li id="54cc" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated"><strong class="jf hj">点击如下所示的“触发DAG”按钮，执行DAG </strong></li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es mg"><img src="../Images/ccd746aaf18078264a130f76d9f3ce9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oY1No4fSUegfFdkIlUkilA.png"/></div></div></figure><p id="30bd" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><em class="mb"> ps:此DAG将使用BQ执行整个加载(使用数据流)、表1的CDC识别，然后合并BQ表1。</em></p><p id="334a" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><em class="mb"> ps:注意loadbq_table1_dataflow步骤(蓝色)将创建/启动一个数据流作业。数据流作业运行后，您可以随时查看GCP控制台，了解其执行细节。</em></p><p id="c072" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><em class="mb"> ps:这一步相当于初始加载。成功执行后，BigQuery的</em>Google _ carlosaugusto . table 1<em class="mb">的内容应该与源表的内容相匹配。</em></p><p id="5b1f" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj"> <em class="mb"> ps:虽然我们在这个例子中是手动执行DAG的，但是您可以通过调整DAG(.py)之前共享的文件</em> </strong> <em class="mb">。</em></p><h1 id="1183" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">8.假设Cloud Composer作业成功完成，检查BigQuery中的table1_log和table1表以验证负载:</h1><blockquote class="ly lz ma"><p id="9a26" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">—检查自上次作业运行以来发生了什么变化(CDC)</p><p id="09ab" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated"><strong class="jf hj">select * from Google _ carlosaugusto . table 1 _ log where change time in(select max(change time)from Google _ carlosaugusto . table 1 _ log)order by id；</strong></p><p id="215b" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">示例:</p></blockquote><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es mh"><img src="../Images/693ce14ac927036087d610a6c11f1510.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UEtdjDqBauPFCV_Q6GTpfA.png"/></div></div></figure><blockquote class="ly lz ma"><p id="d626" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">—检查最终表(表1)并将内容与mysql源进行比较。此时，源和目标应该是相同的</p><p id="3cdd" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated"><strong class="jf hj">select * from Google _ carlosaugusto . table 1 order by id；</strong></p></blockquote><h1 id="c369" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">9.回到源上，执行一些数据更改</h1><blockquote class="ly lz ma"><p id="8f23" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">从testdb.table1中删除，其中id = 1；</p><p id="5714" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">更新testdb . table 1 SET col 2 = ' 2–2 '其中id = 2；</p><p id="bcf7" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">更新testdb . table 1 SET col 3 = ' 3–2 '其中id = 2；</p><p id="cf97" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">更新testdb . table 1 SET col 4 = ' 4–3 '其中id = 3；</p><p id="8299" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">向testdb.table1中插入值(6，' 6 '，' 1000 '，' c '，' d ')；</p><p id="11b7" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">提交；</p><p id="2561" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">MySQL &gt; select * from testdb . table 1；</p><p id="17bd" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">+ — — — + — — — — + — — — — + — — — — + — — — — +</p><p id="3097" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">| id |列1 |列2 |列3 |列4 |</p><p id="fb7b" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">+ — — — + — — — — + — — — — + — — — — + — — — — +</p><p id="e480" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">| 2 |列1–2 | 2–2 | 3–2 |列4–2 |</p><p id="e84c" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">| 3 |列1–3 |列2–3 |列3–3 | 4–3 |</p><p id="04bd" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">| 4 |列1–4 |列2–4 |列3–4 |列4–4 |</p><p id="7db6" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">| 5 |列1–5 |列2–5 |列3–5 |列4–5 |</p><p id="7397" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">| 6 | 6 | 1000 | c | d |</p><p id="c14d" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi">+ — — — + — — — — + — — — — + — — — — + — — — — +</p><p id="7f82" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">一组5行(0.05秒)</p><p id="a135" class="jd je mb jf b jg kc ji jj jk kd jm jn mc ke jq jr md kf ju jv me kg jy jz ka hb bi translated">请注意，第1行不见了</p></blockquote><h1 id="625b" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">10.重新运行Cloud Composer作业(在步骤7中介绍)并检查BigQuery中的表(步骤8)</h1><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es mi"><img src="../Images/2cbaffeb93a785a537256e6f35899328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hasqmJMRbLKCD36X"/></div></div></figure><p id="9e9e" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">假设一切正常，BigQuery的Google _ carlosaugusto . table 1<em class="mb">的<em class="mb">内容应该与源表(testdb.table1)的内容匹配。</em>Google _ carlosaugusto . table 1 _ log还应准确反映哪些行发生了更改(插入、更新或删除了行)。</em></p><p id="8687" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">ps:根据步骤9中执行的DML更改，值可能与上图不同。无论如何，在Cloud Composer完成执行后，源表和目标表应该是同步的。</p><h1 id="211a" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated"><strong class="ak">总之</strong></h1><p id="e13c" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在将数据移动到分析仓库时，实时变更数据捕获(CDC)解决方案并不少见。然而，有时需要在源环境之外的其他地方识别变更。上面的解决方案将为您提供这种能力，利用<a class="ae kb" href="https://cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank"> BigQuery </a>和ANSI SQL的无限能力和可伸缩性来识别哪些行发生了更改，并保持源表和目标表同步。感谢阅读这篇文章！回头见！</p><h1 id="2117" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">放弃</h1><p id="ae19" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我是谷歌公司(Google Cloud)的数据专家。这里陈述的观点是我自己的，而不是谷歌公司的。</p></div></div>    
</body>
</html>