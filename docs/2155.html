<html>
<head>
<title>Securing Containers With Google’s Container Optimized OS &amp; Distroless Container Images</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Google的容器优化操作系统和分布式容器映像保护容器</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/securing-containers-with-googles-container-optimized-os-distroless-container-images-11449caba2ec?source=collection_archive---------0-----------------------#2022-04-11">https://medium.com/google-cloud/securing-containers-with-googles-container-optimized-os-distroless-container-images-11449caba2ec?source=collection_archive---------0-----------------------#2022-04-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/2bec264f734a443dac8397739d95611c.png" data-original-src="https://miro.medium.com/v2/resize:fit:456/format:webp/0*RQ-5ZiQW-BY-uyFx.png"/></div></figure><p id="6860" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">计算基础设施有许多层。对于许多现代的容器化云工作负载，您需要考虑用于运行Kubernetes工作节点的虚拟机映像，以及用作容器化应用程序基础的容器映像。</p><p id="fc5c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">谷歌对这两者都有解决方案。容器优化操作系统是由Google维护的操作系统，专门设计用于在计算引擎虚拟机上运行Docker容器。“distrolles”Docker镜像由google维护，其中仅包含应用程序及其运行时依赖项。结合起来，您将拥有一个强大而安全的云计算基础架构基准。</p><h1 id="965c" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">容器优化的操作系统</h1><p id="33cc" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">如果您运行Google Kubernetes引擎集群，您会发现默认的节点映像现在是带有containerd (cos_containerd)的容器优化操作系统。<a class="ae kn" href="https://cloud.google.com/container-optimized-os/docs/concepts/features-and-benefits" rel="noopener ugc nofollow" target="_blank">谷歌的文档</a>称其提供了以下特性和优势:</p><ul class=""><li id="c880" class="ko kp hi io b ip iq it iu ix kq jb kr jf ks jj kt ku kv kw bi translated">开箱运行容器</li><li id="9a57" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated">较小的攻击面</li><li id="d794" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated">默认情况下锁定</li><li id="52e5" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated">自动更新</li></ul><p id="52b9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">基于Chromium的操作系统实现了这些承诺。它最小的操作系统占用意味着它被削减到只满足有效运行容器的基本需求。它优化了容器运行时的效率，同时通过不包含不必要的工具和包来减少攻击面。</p><p id="1bd8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">它通过不可变的根文件系统、无状态配置、安全加固的内核、以安全为中心的默认值、加固的默认防火墙、高级实例访问支持，实现了“默认锁定”的承诺。它由谷歌构建，遵循其持续的漏洞扫描和响应，并经历了彻底的测试过程。</p><p id="825f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后但同样重要的是，运行容器优化操作系统的Google Kubernetes引擎上的节点支持节点自动升级。这些节点可以自动安排升级，并顺利部署。无需额外努力即可确保最大的正常运行时间和安全性。</p><h1 id="660a" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">分发Docker图像</h1><p id="661d" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">谷歌的容器优化操作系统对优化和安全性的设计关注也适用于谷歌容器工具项目<a class="ae kn" href="https://github.com/GoogleContainerTools/distroless" rel="noopener ugc nofollow" target="_blank">“distroles”镜像</a>。</p><blockquote class="lc ld le"><p id="6a26" class="im in lf io b ip iq ir is it iu iv iw lg iy iz ja lh jc jd je li jg jh ji jj hb bi translated">“发行版”映像只包含您的应用程序及其运行时依赖项。它们不包含包管理器、shells或任何其他您期望在标准Linux发行版中找到的程序。</p></blockquote><p id="6b5c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">容器化的应用程序应该被设计成无状态和不可变的。如果这是真的，那么在容器上安装包管理器、shell和许多其他标准程序和实用程序就没有什么价值了。在大多数情况下，所有这些工具所做的就是增加你的容器的攻击面！</p><p id="aa11" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">通过删除不必要的软件包，Distroless images大大降低了安全风险，同时也提高了运营效率。</p><p id="eced" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们来看看nodejs应用程序的容器安全扫描结果。首先，我们将直接在node:16 docker映像上查看一个nodejs应用程序。然后，我们将它与同一个nodejs应用程序进行比较，但是增加了一个docker构建阶段，将它复制到distroless节点映像。</p><p id="42ca" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">原始Dockerfile文件:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="a0dc" class="ls jl hi lo b fi lt lu l lv lw">FROM node:16 AS build-env<br/>COPY . /app<br/>WORKDIR /app</span><span id="1d70" class="ls jl hi lo b fi lx lu l lv lw">RUN npm ci </span><span id="3fd9" class="ls jl hi lo b fi lx lu l lv lw">CMD [“app.js”]</span></pre><p id="5ad7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，我们可以使用Docker和Snyk构建并扫描该图像，查找漏洞。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="9768" class="ls jl hi lo b fi lt lu l lv lw">docker build . -t node-example<br/>snyk container test node-example</span></pre><p id="9e42" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">呀。扫描结果摘要看起来不太好。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="df22" class="ls jl hi lo b fi lt lu l lv lw">Tested 412 dependencies for known issues, found 392 issues.</span></pre><p id="4251" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以让我们来解决这个问题。让我们添加第二个Docker构建阶段，将构建的nodejs应用程序复制到一个distroless基础映像。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="4231" class="ls jl hi lo b fi lt lu l lv lw">FROM node:16 AS build-env<br/>COPY . /app<br/>WORKDIR /app</span><span id="45cc" class="ls jl hi lo b fi lx lu l lv lw">RUN npm ci</span><span id="d5fa" class="ls jl hi lo b fi lx lu l lv lw">FROM gcr.io/distroless/nodejs:16<br/>COPY --from=build-env /app /app<br/>WORKDIR /app<br/>CMD ["app.js"]</span></pre><p id="45ed" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后再次构建和扫描。这些结果看起来好多了。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="86db" class="ls jl hi lo b fi lt lu l lv lw">Tested 9 dependencies for known issues, found 10 issues.</span></pre><h1 id="c1ff" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">分散安全优势</h1><ul class=""><li id="358d" class="ko kp hi io b ip ki it kj ix ly jb lz jf ma jj kt ku kv kw bi translated">缩减攻击面</li><li id="2ba7" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated">不再执行交互式外壳</li><li id="5adf" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated">可通过连署验证</li></ul><h1 id="e31c" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">分散运营优势</h1><ul class=""><li id="f2f4" class="ko kp hi io b ip ki it kj ix ly jb lz jf ma jj kt ku kv kw bi translated">大幅缩小图像尺寸。“gcr . io/distro less/static-debian 11”小于标准“debian”容器映像大小的2%。这可以大大减少CI/CD管道中的快速测试时间。</li><li id="a728" class="ko kp hi io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated">减少浪费在容器漏洞扫描误报上的时间。你的安全团队会感谢你的。</li></ul><h1 id="ded5" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">结论</h1><p id="d855" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">通过在谷歌的容器优化操作系统上运行distroless容器，你将从它们的许多特性中受益。对于现代云原生应用程序来说，这些安全和操作特性是必不可少的。</p></div></div>    
</body>
</html>