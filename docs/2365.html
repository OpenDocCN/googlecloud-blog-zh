<html>
<head>
<title>Using GCP Media CDN with private AWS storage buckets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GCP媒体CDN和专用AWS存储桶</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/using-media-cdn-with-private-aws-storage-buckets-e94187b93fb0?source=collection_archive---------4-----------------------#2022-09-16">https://medium.com/google-cloud/using-media-cdn-with-private-aws-storage-buckets-e94187b93fb0?source=collection_archive---------4-----------------------#2022-09-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/04f041f592a9184ba2b8cbb1bc2f98d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E2a7lZngSP_OyTwi"/></div></div></figure><p id="6049" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">语境</strong></p><p id="b86d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">谷歌的媒体CDN是谷歌云的媒体交付CDN平台，专为流媒体视频和大型对象下载而设计。有了这个平台；我们的客户在全球超过206个国家/地区和1300多个城市拥有广泛的覆盖面和影响力。关于媒体CDN的更多详情，请参考<a class="ae jo" href="https://cloud.google.com/media-cdn/docs" rel="noopener ugc nofollow" target="_blank">此链接</a></p><p id="f20c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">而媒体CDN是一个交付平台；原点可以在任何地方/任何平台上。例子；来源可以是谷歌存储，也可以是AWS S3等。原始存储桶可以是公共存储桶或私有存储桶。客户倾向于将存储桶设为私有，以实现一些用例，如阻止大量公共请求进入存储桶或限制授权用户对媒体资产的访问。</p><p id="c638" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本博客重点关注媒体CDN如何支持AWS Signature第4版tp连接到私有亚马逊简单存储服务(S3)桶。</p><h1 id="ac79" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">本博客涵盖/未涵盖哪些内容</h1><p id="6061" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated"><strong class="is hj">盖过</strong></p><ul class=""><li id="8daa" class="ks kt hi is b it iu ix iy jb ku jf kv jj kw jn kx ky kz la bi translated">AWS专用存储桶配置</li><li id="ae6c" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">GCP媒体CDN源配置</li><li id="9630" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">GCP媒体CDN服务配置</li></ul><p id="7f4d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">未覆盖</strong></p><ul class=""><li id="af19" class="ks kt hi is b it iu ix iy jb ku jf kv jj kw jn kx ky kz la bi translated">本博客不包括对GCP媒体CDN结构如服务、起源等的解释。</li><li id="5218" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">AWS公共存储桶配置</li><li id="c243" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">媒体CDN服务配置的详细说明</li><li id="b415" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">其他私有桶(如Google cloud私有桶)</li><li id="5177" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">进行客户端https调用的证书设置</li></ul><p id="f6c0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我把这个博客分成以下几个主要部分</p><p id="2c55" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第1节将介绍AWS侧配置。</p><p id="0d22" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第2节将介绍GCP侧的配置。</p><p id="ebfc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第3部分将介绍基本的验证细节。</p><p id="73b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们从真正的配置层面开始吧！！</p><h1 id="5c52" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">AWS端配置步骤</h1><h1 id="722f" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第一步</h1><p id="2c9c" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated"><strong class="is hj"> <em class="lg">创建私有桶(如下例)</em> </strong></p><p id="9880" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这一步突出了在AWS中创建一个私有桶，它将保存由GCP媒体CDN提供的内容。这很简单..只需确保提及阻止所有公共访问的存储桶级别设置到位。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3c5dd99819b2b138158830d728ab9928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hbA2PpqTkUECcmKU"/></div></div></figure><p id="8d80" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">确保bucket中的对象不都是公共的</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/865d60b186533c40b206e1665e50973c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tEeMZtoFigbwfYbZ"/></div></div></figure><h1 id="5829" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第二步</h1><p id="758d" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">转到身份管理→用户选项卡→添加用户</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/59a4486f57b20a2c8913ba400e1eb7c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/0*sbMFrDSkq5t6jojC"/></div></figure><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a78ba27ac17e65ef0ea5afddd0f5d36b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HCkcNW62AMWVNpbD"/></div></div></figure><ul class=""><li id="f35e" class="ks kt hi is b it iu ix iy jb ku jf kv jj kw jn kx ky kz la bi translated">不要将此用户添加到任何组</li><li id="cbc3" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">请继续(下一步并完成)</li><li id="14c0" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">您应该会看到一个屏幕，显示以下2个键</li></ul><p id="af56" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">(a)访问密钥ID</p><p id="6868" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">(b)秘密访问密钥(请注意/保存，因为我们在稍后阶段需要它)</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/79b1bb1e011c46e00c5df362e8746b5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xq91G8tOe31208IK"/></div></div></figure><h1 id="1838" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第三步</h1><p id="cc5e" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">接下来，我们希望在上一步中创建的用户能够访问bucket，并且只有权限为' s3。“GetObject”。为了完成此步骤，请返回到AWS私有S3存储桶并编辑存储桶策略。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/4cc48459b8cecfc2b70ae4cff0892317.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LtQTDM_Nc_HMYP46"/></div></div></figure><p id="d789" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是我写的样本策略</p><p id="5ff9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi">{</p><p id="3a64" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">"版本":" 2012–10–17 "，</p><p id="37a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">" Id ":"保单1663216626024 "，</p><p id="c7d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">"声明":[</p><p id="c265" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi">{</p><p id="ae4d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">" Sid": "Stmt1663216609692 "，</p><p id="aa15" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“效果”:“允许”，</p><p id="d938" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“委托人”:{</p><p id="a617" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">" AWS ":" arn:AWS:iam::100552525497:user/gaur av . Google "</p><p id="3a3e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi">},</p><p id="3202" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">" Action": "s3:GetObject "，</p><p id="7f42" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">" Resource ":" arn:AWS:S3:::gaur av-Google-S3-private/* "</p><p id="e29e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi">}</p><p id="ff02" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi">]</p><p id="9da6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi">}</p><p id="2995" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">至此，我们完成了AWS端的配置，并准备好配置GCP媒体CDN级别的配置</p><h1 id="f0a1" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">GCP侧配置步骤</h1><h1 id="4783" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第四步</h1><p id="3749" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">机密管理器配置</p><p id="2d14" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们需要在GCP秘密管理器中上传AWS端秘密访问密钥(上面的步骤2)</p><ol class=""><li id="0d1d" class="ks kt hi is b it iu ix iy jb ku jf kv jj kw jn ln ky kz la bi translated">去GCP秘密经理-创建秘密-给它任何名称</li></ol><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/597564bfff1617463b8cb93b1aa24a6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5BPO52OG8aCn75FQ"/></div></div></figure><p id="83ec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.创建密码后—创建一个版本并上传/粘贴AWS密码访问密钥</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9664c365298c3be5135604d8402eff94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3cFFIQWP7L_JfEFA"/></div></div></figure><p id="514b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你会看到你的版本被创建(请不要被下面的截图弄糊涂了..我有两个版本作为例子。在这篇博客中，我使用的是版本2)</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/3320c7d59f09156e222c1c9eb1a080c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kCfidWjupQBo0IMDwbIXvw.png"/></div></div></figure><h1 id="0b23" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第五步</h1><p id="0ef5" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">这一步的重点是创建GCP媒体CDN的起源。我正在使用Google cloud shell完成这一步。为此；我将创建一个带有所需参数的YAML文件，并导入这个YAML文件来创建原点。</p><p id="e5cd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">示例源文件YAML格式如下所示</p><p id="589d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">名称:</strong> &lt; &lt;摆放名称&gt;</p><p id="044c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">原地址:</strong>&lt;&lt;您的aws桶名&gt; &gt;</p><p id="7ff3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">retryConditions: [HTTP_5XX，未找到]</p><p id="2e58" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">议定书:HTTPS</p><p id="e439" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">AWS v4认证:</strong></p><p id="b63b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> accessKeyId: </strong>“你从aws控制台<strong class="is hj"> </strong>得到这个”</p><p id="8cc1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">secretaccesskey VERSION:</strong>" projects/<strong class="is hj">GCP project</strong>/secrets/<strong class="is hj">SECRET</strong>/versions/<strong class="is hj">VERSION</strong></p><p id="6092" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">origin region:</strong>&lt;&lt;AWS区域&gt; &gt;</p><h1 id="bfd2" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">YAML文件的示例如下→</h1><p id="b3de" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">名称:私人-S3-起源</p><p id="b2ed" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">原地址:“gaur av-Google-S3-private . S3 . AP-south-1 . Amazon AWS . com”</p><p id="4625" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">retryConditions: [HTTP_5XX，未找到]</p><p id="34d6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">议定书:HTTPS</p><p id="a8ed" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">AWS v4身份验证:</p><p id="0ed0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">accessKeyId: "ABCDEFGHIJKLMNOP "</p><p id="637b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">secretaccesskey version:" projects/7142121/secrets/gauravmadan _ GCS _ access _ key/versions/2 "</p><p id="9603" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">origin region:“AP-south-1”</p><h1 id="c3ee" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第六步</h1><ul class=""><li id="2e0d" class="ks kt hi is b it kn ix ko jb lp jf lq jj lr jn kx ky kz la bi translated">创建媒体CDN源</li><li id="9710" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">我们现在需要通过使用在步骤5中创建的YAML文件来创建媒体CDN源</li><li id="22cb" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">在GCP命令上执行以下命令</li></ul><p id="abcf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"># gcloud edge-cache origins导入private-S3-origin-source = name-of-YAML file . YAML</p><p id="dc5e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在Google cloud控制台UI中验证origin是按如下方式创建的</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ad52a5c200465b344f8fd3c60a9a2a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zNj_0LU9p1-vgRsa"/></div></div></figure><h1 id="3b97" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第七步</h1><p id="9260" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">一旦创建了源，下一步就是创建媒体CDN服务。该服务将调用上一步中配置的原点。</p><p id="03fc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">虽然本博客不会涵盖在GCP平台上配置媒体服务所需的每一个配置参数的细节；不过，我将分享示例配置和配置步骤。你很快会发现一个关于这方面的详细博客！</p><p id="46ca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">媒体CDN服务配置示例YAML文件(<strong class="is hj"><em class="lg">AWS-service . YAML)</em></strong></p><p id="1023" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">名称:GM-AWS-服务</p><p id="27af" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">路由:</p><p id="0ffa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">主机规则:</p><p id="3aa6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-主机:</p><p id="a84c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi">- ‘*’</p><p id="de9f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">路径匹配器:路径</p><p id="671e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">路径匹配器:</p><p id="f54e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-名称:路线</p><p id="57a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">routeRules:</p><p id="a749" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-优先级:1</p><p id="65ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">匹配规则:</p><p id="f933" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">- prefixMatch: /</p><p id="ea39" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">原点:私有-S3-原点</strong></p><p id="c841" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">路由操作:</p><p id="f920" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">urlRewrite:</p><p id="71e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">主机重写:<strong class="is hj">gaurav-google-s3-private.s3.ap-south-1.amazonaws.com</strong></p><p id="2701" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">路径前缀重写:"/"</p><p id="9ac8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">cdn策略:</p><p id="8265" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">cacheMode: CACHE_ALL_STATIC</p><p id="2c97" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">默认TTL:3600秒</p><p id="adf7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">headerAction:</p><p id="882e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">responseHeadersToAdd:</p><p id="ede4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">- headerName: "x缓存状态"</p><p id="0be1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">头值:“{cdn_cache_status}”</p><p id="7206" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用以下Google cloud命令调用这个YAML文件来配置媒体CDN服务</p><p id="bcab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"># gcloud edge-cache服务导入AWS-service-source = AWS-service . YAML</p><p id="d1d9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">媒体CDN服务也可以使用GCP控制台用户界面进行配置，但是我举了一个通过YAML文件进行配置的例子。读者也可以利用GUI做同样的事情。</p><h1 id="d793" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第八步</h1><p id="3e85" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">由于媒体CDN服务将从GCP“机密管理器”读取，请确保媒体CDN的服务帐户具有“机密管理器机密访问者”的IAM角色</p><h1 id="278e" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">验证步骤</h1><p id="1ea3" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">这里有几个命令可以用来验证配置是否正常</p><p id="491b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"># gcloud edge-cache起源描述<name-of-your-origin/></p><p id="76eb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"># g云边缘缓存服务描述<name-of-service/></p><p id="a296" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从功能角度来看；使用以下格式浏览到私有S3存储桶中的对象</p><p id="c74c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">http:// <media cdn="" ip=""> / <object-in-s3/></media></p><ul class=""><li id="6118" class="ks kt hi is b it iu ix iy jb ku jf kv jj kw jn kx ky kz la bi translated">成功配置后，您将从命令g cloud edge-cache services describe<name-of-service>的输出中获得媒体CDN IP，也可以从GCP控制台UI中获得相同的内容。</name-of-service></li><li id="bfe6" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">如果您想使用域名而不是媒体CDN的IP地址进行访问，请随意更改您的DNS</li><li id="6007" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">我在这里使用http，因为在这个博客中，我没有设置https访问，但这不会以任何形式改变媒体CDN的功能</li></ul><p id="d79f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你仔细注意过这个例子中的服务YAML文件；我添加了一个自定义的响应头，如下所示-</p><p id="66d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">- headerName: "x缓存状态"</p><p id="0b5c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">头值:“{cdn_cache_status}”</p><p id="f2d0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，用户应该能够看到在提供的响应中添加了这个头。您可能会看到如下内容(基于您的位置和内容)</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es ls"><img src="../Images/ac40045d1d20bebf6b3df4caafb3889d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/0*R_PkybfVMlBQ3D6f"/></div></figure><p id="9392" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">暂时就这样吧！希望这是有用的，你能够/将能够配置GCP媒体CDN从私人AWS S3桶获取内容</p><p id="daf9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">有用的参考资料</strong></p><p id="1e42" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://cloud.google.com/media-cdn/docs/connect-to-s3-compatible-buckets" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/media-cdn/docs/connect-to-S3-compatible-buckets</a></p><p id="f8d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">免责声明</strong>:这是为了告知读者，文中表达的观点、想法、意见仅属于作者，不一定属于作者的雇主、组织、委员会或其他团体或个人。</p></div></div>    
</body>
</html>