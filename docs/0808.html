<html>
<head>
<title>Migrating Firebase Cloud Functions to Node 8</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Firebase云功能迁移到节点8</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/migrating-firebase-cloud-functions-to-node-8-aebdb0d3d9a9?source=collection_archive---------0-----------------------#2018-11-08">https://medium.com/google-cloud/migrating-firebase-cloud-functions-to-node-8-aebdb0d3d9a9?source=collection_archive---------0-----------------------#2018-11-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="56ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章的目的不是给出全面的指导，而是指出从节点6迁移到节点8时的一些潜在问题。如<a class="ae jd" href="https://firebase.google.com/docs/functions/manage-functions#set_nodejs_version" rel="noopener ugc nofollow" target="_blank">官方文件</a>中所述，要求很简单。</p><ul class=""><li id="e5d2" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">确保<code class="du jn jo jp jq b">firebase-functions</code>库是2.0.0+ <br/> <code class="du jn jo jp jq b">npm install firebase-functions@latest --save</code></li><li id="3fb5" class="je jf hi ih b ii jr im js iq jt iu ju iy jv jc jj jk jl jm bi translated">确保firebase-tools版本为4.0.0+ <br/> <code class="du jn jo jp jq b">npm install -g firebase-tools --upgrade</code></li><li id="20d7" class="je jf hi ih b ii jr im js iq jt iu ju iy jv jc jj jk jl jm bi translated">将<code class="du jn jo jp jq b">"engines": {"node": "8"}</code>添加到<code class="du jn jo jp jq b">functions/</code>目录下的<code class="du jn jo jp jq b">package.json</code>中。</li></ul><p id="fe92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在就我的经验谈几点看法。当我从我的本地计算机上进行更改和部署时，这工作得很好。但是，我对我们用于CI/CD的云构建配置有一些问题。在我们的例子中，这个问题表现为async/await用法的语法错误。我想我们要么使用了错误的节点版本，要么使用了错误的firebase-tools版本。</p><p id="f10c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本质上，这与我们如何为云构建配置构建<code class="du jn jo jp jq b">firebase-tools</code>映像有关。我们的docker文件最初看起来像这样:</p><pre class="jw jx jy jz fd ka jq kb kc aw kd bi"><span id="fcdf" class="ke kf hi jq b fi kg kh l ki kj"><strong class="jq hj"># Node 6<br/>FROM node:boron</strong><br/># install Firebase CLI<br/>RUN npm install -g firebase-tools</span><span id="243c" class="ke kf hi jq b fi kk kh l ki kj">ENTRYPOINT ["/usr/local/bin/firebase"]</span></pre><p id="fe49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这导致firebase CLI在运行<code class="du jn jo jp jq b">firebase deploy</code>作为云构建步骤时使用node6。很难马上发现问题，因为构建这个映像是部署过程中很少的一步。我们只是用它来构建CLI，并把它放到Google容器注册表中，然后就把它忘得差不多了。理想的方法是标记firebase CLI的不同节点版本，但当时我没有想到。</p><p id="d1b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">长话短说，当您将Firebase云功能迁移到Node 8并且您是云构建用户时，不要忘记使用正确的Node版本重新构建firebase-tools映像。正确的答案是:</p><pre class="jw jx jy jz fd ka jq kb kc aw kd bi"><span id="9ef0" class="ke kf hi jq b fi kg kh l ki kj"><strong class="jq hj"># Node 8<br/>FROM node:carbon</strong><br/># install Firebase CLI<br/>RUN npm install -g firebase-tools</span><span id="13ee" class="ke kf hi jq b fi kk kh l ki kj">ENTRYPOINT ["/usr/local/bin/firebase"]</span></pre><p id="d5c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你在互联网的这一部分结束，希望它能节省你一些时间。</p><p id="0ac7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">干杯，</p></div></div>    
</body>
</html>