<html>
<head>
<title>Applying a path pattern when filtering in Eventarc</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Eventarc中过滤时应用路径模式</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/applying-a-path-pattern-when-filtering-in-eventarc-f06b937b4c34?source=collection_archive---------0-----------------------#2022-03-02">https://medium.com/google-cloud/applying-a-path-pattern-when-filtering-in-eventarc-f06b937b4c34?source=collection_archive---------0-----------------------#2022-03-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/5289ee3cbb138a734d1206c665404d30.png" data-original-src="https://miro.medium.com/v2/resize:fit:256/format:webp/0*bboizvgWioVXqQH9.png"/></div></figure><p id="0198" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你现在可以在Eventarc中过滤时应用<a class="ae jk" href="https://cloud.google.com/eventarc/docs/path-patterns" rel="noopener ugc nofollow" target="_blank">路径模式</a>。当您需要过滤不完全匹配的<a class="ae jk" href="https://cloud.google.com/apis/design/resource_names" rel="noopener ugc nofollow" target="_blank">资源名称</a>时，这尤其有用。路径模式语法允许您定义一个类似正则表达式的表达式，尽可能广泛地匹配事件。</p><p id="6b77" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们来看一个具体的例子。</p><h1 id="0ee3" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">没有路径模式</h1><p id="fae7" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">假设您想要使用审计日志触发器来监听云存储桶中的新文件创建。</p><p id="4d7a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="ko">注意:监听云存储事件的正确方式是使用云存储触发器。我在这里使用审计日志触发器来说明路径模式，所以请耐心等待。</em></p><p id="a8b5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是您之前创建审计日志触发器的方式:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="a73b" class="ky jm hi ku b fi kz la l lb lc">gcloud eventarc triggers create $TRIGGER_NAME\<br/>  --destination-run-service=$SERVICE_NAME \<br/>  --destination-run-region=$REGION \<br/>  --event-filters="type=google.cloud.audit.log.v1.written" \<br/>  --event-filters="serviceName=storage.googleapis.com" \<br/>  --event-filters="methodName=storage.objects.create" \<br/>  --<a class="ae jk" href="mailto:service-account=$PROJECT_NUMBER-compute@developer.gserviceaccount.com" rel="noopener ugc nofollow" target="_blank">service-account=$PROJECT_NUMBER-compute@developer.gserviceaccount.com</a></span></pre><p id="29b6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">上面的触发器将匹配来自<strong class="io hj">所有</strong>桶的事件，因为您不是在特定资源(即桶)上过滤。您必须在接收事件的服务的代码中筛选合适的存储桶，这并不理想。</p><p id="93c2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您可以尝试将资源名称添加为过滤器，但是这里的资源是具有完整路径的实际文件名。您的触发器需要看起来像这样，以匹配在<code class="du ld le lf ku b">bucket1</code>中<code class="du ld le lf ku b">file1.txt</code>的创建:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="8c37" class="ky jm hi ku b fi kz la l lb lc">gcloud eventarc triggers create $TRIGGER_NAME\<br/>  --destination-run-service=$SERVICE_NAME \<br/>  --destination-run-region=$REGION \<br/>  --event-filters="type=google.cloud.audit.log.v1.written" \<br/>  --event-filters="serviceName=storage.googleapis.com" \<br/>  --event-filters="methodName=storage.objects.create" \<br/>  --event-filters="resourceName=/projects/_/buckets/bucket-1/objects/file1.txt" \<br/>  --<a class="ae jk" href="mailto:service-account=$PROJECT_NUMBER-compute@developer.gserviceaccount.com" rel="noopener ugc nofollow" target="_blank">service-account=$PROJECT_NUMBER-compute@developer.gserviceaccount.com</a></span></pre><p id="9b4f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但问题是:你可能事先不知道创建文件的名字。</p><h1 id="4a3d" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">使用路径模式</h1><p id="b921" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">快进到今天的路径模式。现在，您可以为资源名称创建一个带有模式的触发器，如下所示:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="537c" class="ky jm hi ku b fi kz la l lb lc">gcloud eventarc triggers create $TRIGGER_NAME\<br/>  --destination-run-service=$SERVICE_NAME \<br/>  --destination-run-region=$REGION \<br/>  --event-filters="type=google.cloud.audit.log.v1.written" \<br/>  --event-filters="serviceName=storage.googleapis.com" \<br/>  --event-filters="methodName=storage.objects.create" \<br/>  --event-filters-path-pattern="resourceName=/projects/_/buckets/bucket-1/objects/*" \<br/>  --<a class="ae jk" href="mailto:service-account=$PROJECT_NUMBER-compute@developer.gserviceaccount.com" rel="noopener ugc nofollow" target="_blank">service-account=$PROJECT_NUMBER-compute@developer.gserviceaccount.com</a></span></pre><p id="9e21" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">该触发器将过滤桶中的所有文件创建。这正是您在监听新文件创建事件时想要的。</p><h1 id="6110" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">有效模式</h1><p id="0d6c" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">以下是文档中的一些有效模式:</p><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lg"><img src="../Images/ae6180ed9c7b1037d3f1c89489626972.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KSv7YzqZxo-eX2UsVbggIQ.png"/></div></div></figure><p id="f05e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果您想了解更多，请查看<a class="ae jk" href="https://cloud.google.com/eventarc/docs/path-patterns" rel="noopener ugc nofollow" target="_blank">理解路径模式</a>文档页面。</p><p id="2148" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您还可以查看来自Eventarc  codelab的<a class="ae jk" href="https://codelabs.developers.google.com/codelabs/cloud-run-events?hl=en#9" rel="noopener ugc nofollow" target="_blank">Trigger Cloud Run with event arc</a>codelab的审计日志步骤，以获取如何使用路径模式的示例。</p><p id="1eb9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如有任何问题/反馈，请随时通过Twitter <a class="ae jk" href="https://twitter.com/meteatamel" rel="noopener ugc nofollow" target="_blank"> @meteatamel </a>联系我。</p></div><div class="ab cl ll lm gp ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hb hc hd he hf"><p id="9e7a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="ko">最初发布于</em><a class="ae jk" href="https://atamel.dev/posts/2022/03-02_path_patterns_eventarc/" rel="noopener ugc nofollow" target="_blank"><em class="ko">https://atamel . dev</em></a><em class="ko">。</em></p></div></div>    
</body>
</html>