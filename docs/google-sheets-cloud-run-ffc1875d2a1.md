# Google Sheets +äº‘è¿è¡Œ

> åŸæ–‡ï¼š<https://medium.com/google-cloud/google-sheets-cloud-run-ffc1875d2a1?source=collection_archive---------0----------------------->

![](img/e3ade6a13a86eef02eb4ce114a6d5b74.png)

Google Sheets +äº‘è¿è¡Œ

åœ¨ 5 åˆ†é’Ÿå†…ï¼Œæˆ‘ä»¬å°†å¿«é€Ÿå®‰å…¨åœ°å°† **Google Sheets** **API** é›†æˆåˆ°æ‚¨çš„**äº‘è¿è¡Œ**åº”ç”¨ä¸­ã€‚åªéœ€å¤åˆ¶&ç²˜è´´ä¸‹é¢çš„æ–‡æ¡£è„šæœ¬ã€‚

## TLï¼›é€Ÿåº¦ä¸‰è§’å½¢å®šä½æ³•(dead reckoning)

1.  **ä¸‹è½½*æœåŠ¡è´¦å·*å‡­è¯**
2.  **ä¸æœåŠ¡å¸æˆ·ç”µå­é‚®ä»¶å…±äº«**è°·æ­Œè¡¨å•
3.  **å¯ç”¨**è°·æ­Œå·¥ä½œè¡¨ API
4.  å†™ä¸€äº›**èŠ‚ç‚¹**
5.  éƒ¨ç½²åˆ°**äº‘è¿è¡Œ**

# æ­¥éª¤ 1:ä¸‹è½½å‡­æ®ğŸ¤–

åˆ›å»ºä¸€ä¸ª*æœåŠ¡å¸æˆ·*ï¼Œå¹¶åœ¨ä¸€ä¸ªåä¸º`creds.json`çš„æ–°æ–‡ä»¶ä¸­ä¸‹è½½ä¸€ä¸ªå¯†é’¥ã€‚

åˆ›å»ºæœåŠ¡å¸æˆ·ï¼Œä¸‹è½½æœåŠ¡å¸æˆ·å¯†é’¥ï¼Œå¹¶å¤åˆ¶æœåŠ¡å¸æˆ·çš„ç”µå­é‚®ä»¶ã€‚æˆ–è€…ä½¿ç”¨ [UI](https://console.cloud.google.com/apis/credentials) ã€‚

è¯¥å‡­è¯å…·æœ‰å”¯ä¸€çš„ id: `sa-name@$PROJECT.iam.gserviceaccount.com`

# 2.ä¸æœåŠ¡å¸æˆ·å…±äº« Google è¡¨å•ğŸ”—

åˆ›å»ºä¸€ä¸ªæ–°çš„è°·æ­Œå·¥ä½œè¡¨ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰çš„è¯

**ä»¥**æœåŠ¡è´¦æˆ·é‚®ç®±**(å¦‚ä¸Š)ä½œä¸º **e *ditor*** åˆ†äº«**Google Sheet:

![](img/321d15581afeb07a6b747f21593654dc.png)

å•å‡»å·¥ä½œè¡¨å³ä¸Šè§’â€œå…±äº«â€æŒ‰é’®ã€‚(å¦‚æœæ‚¨å°šæœªå‘½åå·¥ä½œè¡¨ï¼Œè¯·å‘½å)ã€‚

![](img/0cacf3fa197a0c604cfa03a6eb4feb22.png)

å¯¹äºæœ‰æ•ˆçš„æœåŠ¡å¸æˆ·ï¼ŒæœåŠ¡å¸æˆ·ç”µå­é‚®ä»¶åº”è‡ªåŠ¨å®Œæˆã€‚

> å¦‚æœæ‚¨éœ€è¦ä»¥ç¼–ç¨‹æ–¹å¼å®Œæˆè¿™é¡¹å·¥ä½œï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Drive API å¹¶é€šè¿‡`[*drive.v3.files.permissions.create*](https://developers.google.com/drive/api/v3/reference/permissions/create)`ä¸æœåŠ¡å¸æˆ·å…±äº«ã€‚

# 3.å¯ç”¨ Google Sheets APIğŸ“ƒ

é€šè¿‡`gcloud` CLI(æˆ– [UI](http://console.developers.google.com/apis/api/sheets.googleapis.com) )ä¸ºæ‚¨çš„é¡¹ç›®å¯ç”¨ Sheets API:

```
gcloud services enable sheets.googleapis.com
```

# 4.å†™ä¸€äº›èŠ‚ç‚¹â¬¢

ç”¨è¿™ä¸ª`package.json`åˆ›å»ºä¸€ä¸ªç®€å•çš„èŠ‚ç‚¹åº”ç”¨ç¨‹åº:

ä¸€ä¸ªåŸºæœ¬çš„ package.jsonï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨äº†[å‡½æ•°æ¡†æ¶](https://github.com/GoogleCloudPlatform/functions-framework-nodejs)ã€‚

å’Œä¸€ä¸ªåœ¨`index.js`ç”¨æˆ‘ä»¬çš„æœåŠ¡è´¦å·æˆæƒçš„èŠ‚ç‚¹ç¨‹åº:

ä¸€ä¸ªèŠ‚ç‚¹ç¨‹åºï¼Œä½¿ç”¨æˆ‘ä»¬çš„ creds.json è¿›è¡Œæˆæƒï¼Œå¹¶åœ¨å·¥ä½œè¡¨ä¸­æ·»åŠ ä¸€è¡Œã€‚

**åœ¨** `index.js` **ä¸­ï¼Œç”¨æ‚¨åˆ›å»ºçš„å·¥ä½œè¡¨çš„ ID æ›¿æ¢æ‚¨çš„** `**SPREADSHEET_ID**` **ã€‚**å¦åˆ™ä½ ä¼šå¾—åˆ°é”™è¯¯:â€œé”™è¯¯:æ²¡æœ‰æ‰¾åˆ°è¯·æ±‚çš„å®ä½“ã€‚â€

ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨æœ¬åœ°è¿è¡Œè¯¥ç¨‹åº:

```
npm i && npm start
```

ç„¶åè½¬åˆ°`localhost:8080`(æˆ–`curl [http://localhost:8080](http://localhost:8080)/`)æµ‹è¯•å¹¶é€šè¿‡ç¼–ç¨‹åˆ›å»ºä¸€ä¸ªæ–°è¡Œã€‚é¢„çƒ­éœ€è¦ä¸€ç‚¹æ—¶é—´ï¼Œä½†ä»æˆ‘çš„æµ‹è¯•æ¥çœ‹å¾ˆå¿«(< 1 ç§’)ã€‚

![](img/8b2c4788858f08727573d8feb99dc779.png)

å‘å‡ºä¸€ä¸ª localhost HTTP è¯·æ±‚ä¼šåœ¨æˆ‘ä»¬çš„ Google å·¥ä½œè¡¨ä¸­æ·»åŠ ä¸€è¡Œï¼

# 5.éƒ¨ç½²åˆ°äº‘è¿è¡ŒğŸ’¨ğŸ‘Ÿ

è¦éƒ¨ç½²ç”Ÿäº§æœåŠ¡å™¨ï¼Œæ‚¨éœ€è¦æ·»åŠ ä¸€ä¸ª`Dockerfile`:

Dockerfile æ–‡ä»¶

ç„¶ååœ¨ Google Cloud ä¸Šæ„å»ºå¹¶è¿è¡Œæ‚¨çš„å®¹å™¨:

```
GCP_PROJECT=$(gcloud config list --format 'value(core.project)' 2>/dev/null)gcloud builds submit \
--tag gcr.io/$GCP_PROJECT/sheets-on-rungcloud run deploy sheets-on-run \
--image gcr.io/$GCP_PROJECT/sheets-on-run \
--platform managed \
--allow-unauthenticated
```

å¯¹äºè¿™ä¸ªç¤ºä¾‹ï¼Œæ¯å½“æˆ‘ä»¬é€šè¿‡ URL è®¿é—®æˆ‘ä»¬çš„äº‘è¿è¡ŒæœåŠ¡æ—¶ï¼Œæˆ‘ä»¬å°†å‘ Google Sheet æ·»åŠ ä¸€ä¸ªæ–°è¡Œã€‚

å¤ªå¥½äº†ï¼ç°åœ¨ä½ çš„åºŠå•å·²ç»â€œè¿æ¥â€è¿è¡Œäº†ï¼Œä½ çš„æ€æƒ³å°±æ˜¯ä½ ç”¨è¿™ç§åŠ›é‡æ‰€èƒ½åšçš„æé™ã€‚åˆ›å»ºä¸€äº›å¾ˆé…·çš„åº”ç”¨ç¨‹åºã€‚:)

# åç»­æ­¥éª¤

æ„Ÿè°¢é˜…è¯»ï¼æˆ‘å–œæ¬¢ä½¿ç”¨ Google Sheets ä½œä¸ºæ˜¾ç¤ºæ•°æ®çš„ç®€å•ç”¨æˆ·ç•Œé¢ã€‚å®ƒé€Ÿåº¦å¿«ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œè€Œä¸”å…è´¹ï¼

æ‚¨å¯èƒ½ä¼šå¯¹è¿™äº›ç›¸å…³èµ„æºæ„Ÿå…´è¶£:

*   [èŠ‚ç‚¹çš„æµè¡Œç¤¾åŒºåº“åŒ…è£…å™¨](https://github.com/theoephraim/node-google-spreadsheet)
*   [Google Sheets API V4 ä½¿ç”¨é™åˆ¶](https://developers.google.com/sheets/api/limits)