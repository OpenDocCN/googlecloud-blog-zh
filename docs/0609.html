<html>
<head>
<title>New Stackdriver Monitoring for Kubernetes (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes的新堆栈驱动程序监控(第1部分)</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/new-stackdriver-monitoring-for-kubernetes-part-1-a296fa164694?source=collection_archive---------0-----------------------#2018-05-21">https://medium.com/google-cloud/new-stackdriver-monitoring-for-kubernetes-part-1-a296fa164694?source=collection_archive---------0-----------------------#2018-05-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="06ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">更新(2018年3月1日)——你现在可以在这里看我走过这段:</strong></p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ji jj l"/></div></figure><p id="7cc2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">更新(2018年10月16日)——</strong>创建具有新监控功能的集群和更新现有集群的说明已经发布，因为该工具目前处于测试阶段。你可以在这里找到安装说明<a class="ae jk" href="https://cloud.google.com/monitoring/kubernetes-engine/installing" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jl"><img src="../Images/e8e17415fc5b74e125227a961cd4205f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TnQbb5kRhPWINLlAQHXJsg.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">崭新闪亮！</figcaption></figure><p id="46cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如你可能已经看到的，Stackdriver团队<a class="ae jk" href="https://cloudplatform.googleblog.com/2018/05/Announcing-Stackdriver-Kubernetes-Monitoring-Comprehensive-Kubernetes-observability-from-the-start.html" rel="noopener ugc nofollow" target="_blank">几周前在Kubecon宣布了对Kubernetes监控的全新支持。显然，我不能不尽我最大的努力去探索它就让它过去。我希望在工作中看到三件主要事情——监控GKE集群上的工作负载、监控非GKE集群以及新的Prometheus集成。让我们进入第一部分——监视GKE集群！</a></p><p id="0698" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢天谢地，文档<a class="ae jk" href="https://cloud.google.com/monitoring/kubernetes-engine/" rel="noopener ugc nofollow" target="_blank">中的说明</a>非常清楚。</p><p id="4453" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">监控GKE(阿尔法)星团</strong></p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jw"><img src="../Images/46c0d54cfba1757e42760ffb7cb02655.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V-P8uMmRFUQx9bRAH9RLgg.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">那看起来不一样！</figcaption></figure><p id="b452" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在撰写本文时，这种支持仅适用于“alpha”集群，因为该集群需要安装在Kubernetes 1.10上。所以，让我们先创建我们的阿尔法集群。这是来自文档的gcloud命令——我使用的值在<code class="du jx jy jz ka b">#</code>之后。</p><pre class="jd je jf jg fd kb ka kc kd aw ke bi"><span id="3534" class="kf kg hi ka b fi kh ki l kj kk">CLOUDSDK_CONTAINER_USE_V1_API=false \<br/>CLOUDSDK_API_CLIENT_OVERRIDES_CONTAINER=v1beta1 \<br/>gcloud alpha container clusters create [CLUSTER_NAME] \ #(alpha-cluster)<br/>  --zone=[ZONE_WITH_1.10.2-gke.0] \ #us-west1-a<br/>  --project=[PROJECT_ID] \ #stackdriver-kubernetes<br/>  --cluster-version=1.10.2-gke.0 \<br/>  --enable-stackdriver-kubernetes \<br/>  --enable-kubernetes-alpha</span></pre><p id="8925" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">瞧啊。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es kl"><img src="../Images/b7369ca09f2befdea32afc044ea7cd03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7HRRG3Wh7p2Bw7MjNh3FbQ.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">我们有一个阿尔法星团！</figcaption></figure><p id="3155" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其实就这么多了！让我们首先验证集群本身的安装。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es km"><img src="../Images/3fdeabbd920112f894df5e9c6ddd10dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RcU9uBEK7XMxIqvYwYXZ8g.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">它还活着！</figcaption></figure><p id="d8ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们让监控和日志代理、元数据代理和heapster都运行在<code class="du jx jy jz ka b">stackdriver-agents</code>名称空间中。让我们对比一下我运行的“旧”集群，</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es kn"><img src="../Images/72879c00a0619343daf84e7b2e274a7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ow2i4OZtnUz_OtNNONlGPQ.png"/></div></div></figure><p id="a286" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那里根本没有<code class="du jx jy jz ka b">stackdriver-agents</code>名称空间，</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ko"><img src="../Images/5016cca183acde4e73b22bca9332c511.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BZ006ckZhffBLSYPnNSebw.png"/></div></div></figure><p id="b1b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">fluentd运行在<code class="du jx jy jz ka b">default</code>名称空间中。所以，监控基础设施是不同的，这没什么。但是我们从中得到了什么呢？让我们进入Stackdriver并找出答案。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kp"><img src="../Images/b954d1e23d7ff25567e4207030d54091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*G8CaPqVrGPOnDiFS_Zf7uw.png"/></div></figure><p id="02d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一件显而易见的事情是，我们现在有了额外的资源，称为“Kubernetes引擎V2测试版”。我想我可能在这里触发了一个bug，因为它应该只出现一次——但是这两个都把我带到了同一个屏幕。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es kq"><img src="../Images/14141dade9bb63f7a9fa8af920042708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6tDcXf8NTV3DtRfavrxZ-A.png"/></div></div></figure><p id="c647" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见，我的“日志集群”使用的是“原始的”Kubernetes监控，并没有出现在这个列表中。然而，我的阿尔法星团在这里。我们去看看吧！</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es kr"><img src="../Images/cb1ac2a12c3119c2f4628a686880db29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*myPSLYLcweEEYHWZoZTa5Q.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">从基础架构视图向下钻取</figcaption></figure><p id="28bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从“Infrastructure”选项卡开始，我们可以沿着“cluster -&gt; node -&gt; pod -&gt; container”路线前进。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ks"><img src="../Images/bce26571f3ea76212bcb2be0812c40f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a4mHog7MH3V8PhL0riU7gA.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">容器视图</figcaption></figure><p id="7ad4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以选择一个容器来获取关于它的更多信息，比如CPU和内存利用率，甚至可以调出日志。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kt"><img src="../Images/58718570322902d0d2c42057cc2fb138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*sjQbBpQZrQemHlD75Mr1rA.png"/></div><figcaption class="js jt et er es ju jv bd b be z dx translated">工作负载视图</figcaption></figure><p id="91b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果愿意，我们可以选择工作负载路径，这将让我们进入集群-&gt;名称空间-&gt;工作负载-&gt; pod -&gt;容器。</p><p id="7a08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们可以采用服务路径来执行集群-&gt;名称空间-&gt;服务-&gt; pod -&gt;容器。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ku"><img src="../Images/4c8c6f06d3c299f1d4f042b5289e8dd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*uq_z2m8UlsAqgMyd9i-LKA.png"/></div></figure><p id="502d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这一切都很酷——而且它的工作不需要任何手动操作！回来阅读第2部分和第3部分，我将尝试在计算引擎上实现这一点，并查看Prometheus集成！</p></div></div>    
</body>
</html>