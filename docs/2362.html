<html>
<head>
<title>CI/GitOps with Helm, GitHub Actions, GitHub Container Registry and Config Sync</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有Helm、GitHub操作、GitHub容器注册和配置同步的CI/gitop</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/ci-gitops-with-helm-github-actions-github-container-registry-and-config-sync-836913e74e79?source=collection_archive---------1-----------------------#2022-09-16">https://medium.com/google-cloud/ci-gitops-with-helm-github-actions-github-container-registry-and-config-sync-836913e74e79?source=collection_archive---------1-----------------------#2022-09-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8183" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">2023年1月16日更新，在谷歌云控制台中使用新的配置同步用户界面，列出同步的资源及其状态。</em></p><p id="ebe5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从<a class="ae je" href="https://cloud.google.com/anthos-config-management/docs/release-notes#September_15_2022" rel="noopener ugc nofollow" target="_blank"> Anthos配置管理1.13.0 </a>开始，配置同步支持从私人OCI注册表同步舵图。要了解更多，请参见<a class="ae je" href="https://cloud.google.com/anthos-config-management/docs/how-to/sync-helm-charts-from-artifact-registry" rel="noopener ugc nofollow" target="_blank">从神器注册表</a>同步头盔图表。</p><p id="89b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">你可以在这里了解更多关于这个公告:</em> <a class="ae je" href="https://cloud.google.com/blog/products/containers-kubernetes/gitops-with-oci-artifacts-and-config-sync" rel="noopener ugc nofollow" target="_blank"> <em class="jd">部署OCI神器和舵图表GitOps方式与配置同步</em> </a> <em class="jd">。</em></p><p id="0402" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae je" rel="noopener" href="/google-cloud/ci-gitops-with-helm-github-actions-google-artifact-registry-and-config-sync-b48604191fda"> <em class="jd">在另一篇文章</em> </a> <em class="jd">中，我们看到了如何使用GitHub actions</em><em class="jd">将掌舵图打包并推送到</em><strong class="ih hj"><em class="jd">Google Artifact Registry，然后如何使用</em> <strong class="ih hj"> <em class="jd"> Config Sync(使用工作量标识)</em> </strong> <em class="jd">部署掌舵图。</em></strong></p><p id="0f9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将展示如何使用GitHub actions(使用PAT token) 将舵图打包并推送到<strong class="ih hj"> GitHub容器注册表，然后如何使用配置同步部署舵图。</strong></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/4f171b5682e480b5db1fb33e0dccb5cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q0aRb-R8ewibOHhjuQ3Wbw.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">将舵图打包并推送到GitHub容器注册表的工作流，然后使用配置同步对其进行部署</figcaption></figure></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="e7db" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">目标</h1><ul class=""><li id="646a" class="la lb hi ih b ii lc im ld iq le iu lf iy lg jc lh li lj lk bi translated">用GitHub动作在GitHub容器注册表中打包并推送一个Helm图表(使用PAT令牌)</li><li id="292a" class="la lb hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">创建GKE集群并启用配置同步</li><li id="100f" class="la lb hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">用配置同步从GitHub容器注册表同步舵图</li></ul></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="ca8c" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">费用</h1><p id="2ba3" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">本教程使用Google Cloud的付费组件，包括:</p><ul class=""><li id="5ed5" class="la lb hi ih b ii ij im in iq lt iu lu iy lv jc lh li lj lk bi translated"><a class="ae je" href="https://cloud.google.com/kubernetes-engine/pricing" rel="noopener ugc nofollow" target="_blank"> Kubernetes发动机</a></li></ul><p id="f4da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">注:在这种情况下，配置同步是免费的，更多详情见</em> <a class="ae je" href="https://cloud.google.com/anthos-config-management/docs/pricing" rel="noopener ugc nofollow" target="_blank"> <em class="jd">此处</em> </a> <em class="jd">。</em></p><p id="dc4b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<a class="ae je" href="https://cloud.google.com/products/calculator" rel="noopener ugc nofollow" target="_blank">定价计算器</a>根据您的预计使用量生成成本估算。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="edb6" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">开始之前</h1><p id="18cf" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">本指南假设您拥有Google Cloud项目的所有者IAM权限。在生产中，您不需要所有者许可。</p><ol class=""><li id="34fc" class="la lb hi ih b ii ij im in iq lt iu lu iy lv jc lw li lj lk bi translated"><a class="ae je" href="https://console.cloud.google.com/projectselector2" rel="noopener ugc nofollow" target="_blank">选择或创建一个谷歌云项目</a>。</li><li id="0553" class="la lb hi ih b ii ll im lm iq ln iu lo iy lp jc lw li lj lk bi translated"><a class="ae je" href="https://cloud.google.com/billing/docs/how-to/modify-project" rel="noopener ugc nofollow" target="_blank">验证您的项目是否启用了计费</a>。</li></ol><p id="eaec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本指南还假设您有一个<a class="ae je" href="https://github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub帐户</a>。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="335f" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">设置您的环境</h1><p id="2385" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">以下是您需要的工具:</p><ul class=""><li id="ad55" class="la lb hi ih b ii ij im in iq lt iu lu iy lv jc lh li lj lk bi translated"><code class="du lx ly lz ma b"><a class="ae je" href="https://cloud.google.com/sdk/docs/install" rel="noopener ugc nofollow" target="_blank">gcloud</a></code></li><li id="11a4" class="la lb hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated"><code class="du lx ly lz ma b"><a class="ae je" href="https://git-scm.com/downloads" rel="noopener ugc nofollow" target="_blank">git</a></code></li><li id="e0eb" class="la lb hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated"><code class="du lx ly lz ma b"><a class="ae je" href="https://cli.github.com/" rel="noopener ugc nofollow" target="_blank">gh</a></code></li><li id="5074" class="la lb hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated"><code class="du lx ly lz ma b"><a class="ae je" href="https://kubernetes.io/docs/tasks/tools/#kubectl" rel="noopener ugc nofollow" target="_blank">kubectl</a></code></li></ul><p id="d7e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:你可以使用已经安装了所有这些工具的Google Cloud Shell。</p><p id="63c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">初始化本教程中使用的通用变量:</p><pre class="jg jh ji jj fd mb ma mc bn md me bi"><span id="3172" class="mf kd hi ma b be mg mh l mi mj">PROJECT_ID=FIXME-WITH-YOUR-PROJECT-ID<br/>ZONE=us-east4-a</span></pre><p id="ad89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了避免在整个教程中重复命令中的<code class="du lx ly lz ma b">--project</code>，让我们设置当前项目:</p><pre class="jg jh ji jj fd mb ma mc bn md me bi"><span id="3ac8" class="mf kd hi ma b be mg mh l mi mj">gcloud config set project ${PROJECT_ID}</span></pre><p id="9d83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用默认的<code class="du lx ly lz ma b">main</code>分支创建一个专用的GitHub存储库:</p><pre class="jg jh ji jj fd mb ma mc bn md me bi"><span id="3d6e" class="mf kd hi ma b be mg mh l mi mj">cd ~/<br/>REPO_NAME=my-chart<br/>gh auth login<br/>git config --global init.defaultBranch main<br/>gh repo create ${REPO_NAME} --private --clone</span></pre><p id="269b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们捕获GitHub所有者的值，您将在本教程的后面部分重用它:</p><pre class="jg jh ji jj fd mb ma mc bn md me bi"><span id="8d3b" class="mf kd hi ma b be mg mh l mi mj">GITHUB_REPO_OWNER=$(gh repo view ${REPO_NAME} --json owner --jq .owner.login)</span></pre></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="1e9f" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">在GitHub容器注册表中打包并推送一个舵图</h1><p id="15a5" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">创建舵图:</p><pre class="jg jh ji jj fd mb ma mc bn md me bi"><span id="d890" class="mf kd hi ma b be mg mh l mi mj">helm create ~/${REPO_NAME}</span></pre><p id="7a88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在GitHub存储库中提交此舵图模板:</p><pre class="jg jh ji jj fd mb ma mc bn md me bi"><span id="2686" class="mf kd hi ma b be mg mh l mi mj">cd ~/${REPO_NAME} <br/>git add . &amp;&amp; git commit -m "Create Helm chart template" &amp;&amp; git push origin main</span></pre><p id="47e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">定义一个GitHub动作管道来打包并推送GitHub容器注册表中的Helm图表:</p><pre class="jg jh ji jj fd mb ma mc bn md me bi"><span id="34d4" class="mf kd hi ma b be mg mh l mi mj">mkdir .github &amp;&amp; mkdir .github/workflows<br/>cat &lt;&lt;'EOF' &gt; .github/workflows/ci-helm-ghcr.yaml<br/>name: ci-helm-ghcr<br/>permissions:<br/>  packages: write<br/>  contents: read<br/>on:<br/>  push:<br/>    branches:<br/>      - main<br/>  pull_request:<br/>env:<br/>  CHART_NAME: my-chart<br/>  IMAGE_TAG: 0.1.0<br/>jobs:<br/>  job:<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>      - uses: actions/checkout<br/>      - name: helm lint<br/>        run: |<br/>          helm lint .<br/>      - name: helm login<br/>        run: |<br/>          echo ${{ secrets.GITHUB_TOKEN }} | helm registry login ghcr.io -u $ --password-stdin<br/>      - name: helm package<br/>        run: |<br/>          helm package . --version $IMAGE_TAG<br/>      - name: helm push<br/>        if: ${{ github.event_name == 'push' }}<br/>        run: |<br/>          helm push $CHART_NAME-$IMAGE_TAG.tgz oci://ghcr.io/${{ github.repository_owner }}<br/>EOF</span></pre><p id="4010" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个GitHub Actions管道允许执行一系列命令:<code class="du lx ly lz ma b">helm lint</code>、<code class="du lx ly lz ma b">helm registry login</code>、<code class="du lx ly lz ma b">helm package</code>，最终，如果是<code class="du lx ly lz ma b">main</code>分支中的<code class="du lx ly lz ma b">push</code>，就会执行<code class="du lx ly lz ma b">helm push</code>。此外，只要<code class="du lx ly lz ma b">main</code>分支中有一个<code class="du lx ly lz ma b">push</code>以及任何拉请求，就会触发该管道。你可以根据自己的需要调整这个流程和这些条件。</p><p id="7b38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以看到，我们通过使用带有<code class="du lx ly lz ma b">helm registry login</code>命令的<code class="du lx ly lz ma b">secrets.GITHUB_TOKEN</code>环境变量来使用<a class="ae je" href="https://docs.github.com/en/actions/security-guides/automatic-token-authentication" rel="noopener ugc nofollow" target="_blank">自动令牌认证</a>。除此之外，为了能够在GitHub容器注册表中推动舵图，我们需要有<code class="du lx ly lz ma b">permissions.packages: write</code>。</p><p id="dcd4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在GitHub存储库中提交此GitHub操作管道:</p><pre class="jg jh ji jj fd mb ma mc bn md me bi"><span id="dd7d" class="mf kd hi ma b be mg mh l mi mj">git add . &amp;&amp; git commit -m "Create GitHub actions pipeline" &amp;&amp; git push origin main</span></pre><p id="8509" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">等待相关运行成功完成:</p><pre class="jg jh ji jj fd mb ma mc bn md me bi"><span id="c4dc" class="mf kd hi ma b be mg mh l mi mj">gh run list</span></pre><p id="792b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击以下按钮，查看您的舵图是否已成功上传:</p><pre class="jg jh ji jj fd mb ma mc bn md me bi"><span id="e00d" class="mf kd hi ma b be mg mh l mi mj">echo -e "https://github.com/${GITHUB_REPO_OWNER}?tab=packages&amp;repo_name=${REPO_NAME}"</span></pre></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="d00c" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">创建GKE集群并启用配置同步</h1><p id="665f" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">创建在<a class="ae je" href="https://cloud.google.com/anthos/fleet-management/docs/fleet-concepts" rel="noopener ugc nofollow" target="_blank">机群</a>中注册的GKE集群以启用配置管理:</p><pre class="jg jh ji jj fd mb ma mc bn md me bi"><span id="38dd" class="mf kd hi ma b be mg mh l mi mj">gcloud services enable container.googleapis.com<br/>CLUSTER_NAME=cluster-helm-test<br/>gcloud container clusters create ${CLUSTER_NAME} \<br/>    --workload-pool=${PROJECT_ID}.svc.id.goog \<br/>    --zone ${ZONE}<br/><br/>gcloud services enable gkehub.googleapis.com<br/>gcloud container fleet memberships register ${CLUSTER_NAME} \<br/>    --gke-cluster ${ZONE}/${CLUSTER_NAME} \<br/>    --enable-workload-identity<br/><br/>gcloud beta container fleet config-management enable</span></pre><p id="6b75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在此GKE群集中安装配置同步:</p><pre class="jg jh ji jj fd mb ma mc bn md me bi"><span id="745a" class="mf kd hi ma b be mg mh l mi mj">cat &lt;&lt;EOF &gt; acm-config.yaml<br/>applySpecVersion: 1<br/>spec:<br/>  configSync:<br/>    enabled: true<br/>EOF<br/>gcloud beta container fleet config-management apply \<br/>    --membership ${CLUSTER_NAME} \<br/>    --config acm-config.yaml</span></pre><p id="fc97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经准备好了设置，让我们同步之前打包并推送到GitHub容器注册表的舵图。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="7c04" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">从GitHub容器注册表同步舵图</h1><p id="7bf2" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">因为我们创建了一个公共的GitHub库，所以我们在GitHub容器注册表中推送的舵图是公共的。您可以按照此处的说明<a class="ae je" href="https://docs.github.com/en/packages/learn-github-packages/configuring-a-packages-access-control-and-visibility#configuring-visibility-of-container-images-for-your-personal-account" rel="noopener ugc nofollow" target="_blank">将默认可见性从公共更改为私有。</a></p><p id="0d71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae je" href="https://github.com/settings/tokens/new" rel="noopener ugc nofollow" target="_blank">在GitHub </a>中创建一个具有<code class="du lx ly lz ma b">read:packages</code> OAuth范围的新的个人访问令牌(PAT ),以遵循“刚好够用且权限最小”的原则。</p><p id="dd7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<code class="du lx ly lz ma b">RootSync</code>的<code class="du lx ly lz ma b">Namespace</code>中创建与GitHub的PAT关联的<code class="du lx ly lz ma b">Secret</code>:</p><pre class="jg jh ji jj fd mb ma mc bn md me bi"><span id="687c" class="mf kd hi ma b be mg mh l mi mj">GITHUB_PAT=FIXME<br/>kubectl create secret generic ghcr \<br/>    --namespace=config-management-system \<br/>    --from-literal=username=config-sync \<br/>    --from-literal=password=${GITHUB_PAT}</span></pre><p id="c12b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">展开<code class="du lx ly lz ma b">RootSync</code>以同步私人舵图:</p><pre class="jg jh ji jj fd mb ma mc bn md me bi"><span id="792d" class="mf kd hi ma b be mg mh l mi mj">cat &lt;&lt; EOF | kubectl apply -f -<br/>apiVersion: configsync.gke.io/v1beta1<br/>kind: RootSync<br/>metadata:<br/>  name: root-sync-helm<br/>  namespace: config-management-system<br/>spec:<br/>  sourceFormat: unstructured<br/>  sourceType: helm<br/>  helm:<br/>    repo: oci://ghcr.io/${GITHUB_REPO_OWNER}<br/>    chart: my-chart<br/>    version: 0.1.0<br/>    releaseName: my-chart<br/>    namespace: default<br/>    auth: token<br/>    secretRef:<br/>      name: ghcr<br/>EOF</span></pre><p id="b718" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">请注意，我们设置了</em> <code class="du lx ly lz ma b"><em class="jd">spec.helm.auth: token</em></code> <em class="jd">和</em> <code class="du lx ly lz ma b"><em class="jd">spec.helm.secretRef.name: ghcr</em></code> <em class="jd">值，以便能够访问和同步私人舵手图表。如果有公共舵图要同步，可以用</em> <code class="du lx ly lz ma b"><em class="jd">spec.helm.auth: none</em></code> <em class="jd">代替。</em></p><p id="62dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行命令<code class="du lx ly lz ma b">gcloud alpha anthos config sync resources list</code>或从云控制台导航到<strong class="ih hj"> <em class="jd"> Kubernetes引擎&gt;配置&amp;策略&gt;配置</em> </strong>，列出配置同步所同步的资源及其状态:</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es mk"><img src="../Images/6a23281dcba2af35c65ff178219768af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XprkYKyPsAST-YEhUefEtQ.png"/></div></div></figure><p id="7b03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">瞧！你刚刚部署了一个<strong class="ih hj">私人头盔图</strong>托管在GitHub注册表与配置同步。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="73e0" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">结论</h1><p id="ecd1" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">在本文中，您能够使用GitHub操作在GitHub容器注册表中打包和推送一个Helm chart。然后，您看到了如何将私人舵图表与<code class="du lx ly lz ma b">RootSync</code>上的<code class="du lx ly lz ma b">spec.helm.auth: token</code>设置同步。这表明Config Sync支持任何你有舵图的私有OCI注册表:JFrog Artifactory等。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="2ab4" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">清理</h1><p id="9d16" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">为了避免向您的Google Cloud帐户收取费用，您可以删除本教程中使用的资源。</p><p id="74ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从<a class="ae je" href="https://cloud.google.com/anthos/fleet-management/docs/fleet-concepts" rel="noopener ugc nofollow" target="_blank">舰队</a>中注销GKE集群:</p><pre class="jg jh ji jj fd mb ma mc bn md me bi"><span id="8a78" class="mf kd hi ma b be mg mh l mi mj">gcloud container fleet memberships unregister ${CLUSTER_NAME} \<br/>    --project=${PROJECT_ID} \<br/>    --gke-cluster=${ZONE}/${CLUSTER_NAME}</span></pre><p id="4979" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除GKE群集:</p><pre class="jg jh ji jj fd mb ma mc bn md me bi"><span id="779d" class="mf kd hi ma b be mg mh l mi mj">gcloud container clusters delete ${CLUSTER_NAME} \<br/>    --zone ${ZONE}</span></pre></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><h1 id="3c51" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">下一步是什么</h1><ul class=""><li id="6610" class="la lb hi ih b ii lc im ld iq le iu lf iy lg jc lh li lj lk bi translated"><a class="ae je" href="https://cloud.google.com/anthos-config-management/docs/how-to/sync-helm-charts-from-artifact-registry" rel="noopener ugc nofollow" target="_blank">从工件注册表同步舵图</a></li><li id="3417" class="la lb hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated"><a class="ae je" href="https://cloud.google.com/anthos-config-management/docs/how-to/sync-oci-artifacts-from-artifact-registry" rel="noopener ugc nofollow" target="_blank">从工件注册表同步OCI工件</a></li></ul></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><p id="9ff1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">原帖</em><a class="ae je" href="https://mathieu-benoit.github.io/" rel="noopener ugc nofollow" target="_blank"><em class="jd">Mathieu-Benoit . github . io</em></a><em class="jd">。</em></p></div></div>    
</body>
</html>