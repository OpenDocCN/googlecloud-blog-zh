<html>
<head>
<title>Sharing Docker Containers in Google Container Registry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Google容器注册表中共享Docker容器</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/sharing-docker-containers-in-google-container-registry-1e816b88eae9?source=collection_archive---------0-----------------------#2016-09-09">https://medium.com/google-cloud/sharing-docker-containers-in-google-container-registry-1e816b88eae9?source=collection_archive---------0-----------------------#2016-09-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a1b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">想象一下这个场景:</strong></p><p id="fcda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您正在遵循Google Cloud最佳实践，并且有一个针对您的开发环境的项目和一个针对您的生产环境的项目。您希望使用Docker来确保在dev中运行的代码与在prod中运行的代码相同。</p><p id="85db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你写你的代码，把它归档，然后测试它。太棒了，成功了！现在您想将其部署到生产环境中。您将容器推送到开发项目中的<a class="ae jd" href="http://gcr.io" rel="noopener ugc nofollow" target="_blank"> Google容器注册表</a>。但是，如何将它引入到您的prod项目中呢？</p><p id="78c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您从源代码控制中取出源代码并再次重新创建Docker容器，您将为存储支付双倍的费用，并为您的部署管道带来更多的复杂性。呸！</p><p id="ffe3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您需要的是一种从您的开发环境中安全地提取Docker容器的方法。幸运的是，谷歌容器注册使这变得容易！</p><h1 id="e43a" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">步骤1:获取服务帐户</h1><p id="70d2" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">转到您的<strong class="ih hj">开发项目中的<a class="ae jd" href="http://console.cloud.google.com/iam-admin/serviceaccounts" rel="noopener ugc nofollow" target="_blank"> IAM服务帐户部分</a>，或者您的Docker容器被推送到的地方</strong>。</p><p id="e2d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建一个新的服务帐户，将其命名为“Container Registry Puller”，赋予它“Storage Object Viewer”角色，并确保提供一个新的私钥。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/3a801b5fc0cf7d518d80cfbc712c240f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gr0z_xXY19OWhvFlBldSMQ.png"/></div></div></figure><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kt"><img src="../Images/97e73cfe7d8728608d6e54dccee445a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MbfsL0E-Ya0DgH1g3g2gwQ.png"/></div></div></figure><p id="1ff8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你点击“创建”时，一个JSON文件将被下载到你的计算机上。这是您的服务帐户密钥，将用于提取您的Docker图像。确保不要泄露这个键(不要将其签入源代码控制)，否则任何拥有它的人都可以拉你所有的容器和你存储在GCS中的其他对象！</p><p id="8689" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将这个文件重命名为<strong class="ih hj"> docker_key.json </strong></p><h1 id="9631" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">第二步:拉你的容器</h1><p id="b2a4" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我们现在可以在Docker中直接使用这个密钥文件。</p><p id="875c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在与您的<strong class="ih hj"> docker_key.json </strong>相同的目录中，运行这个<em class="ku">命令:</em></p><pre class="ki kj kk kl fd kv kw kx ky aw kz bi"><span id="4b7a" class="la jf hi kw b fi lb lc l ld le">docker login -u _json_key -p “$(cat docker_key.json)” <a class="ae jd" href="https://gcr.io" rel="noopener ugc nofollow" target="_blank">https://gcr.io</a></span></pre><p id="447e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此时，您可以使用Docker来拉动和运行您的容器。你不需要做其他任何事情！</p><p id="441f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，如果您有一个名为“my-app:0.1”的容器，您可以使用以下命令来提取它:</p><pre class="ki kj kk kl fd kv kw kx ky aw kz bi"><span id="3674" class="la jf hi kw b fi lb lc l ld le">docker pull gcr.io/&lt;project-id&gt;/my-app:0.1</span></pre><p id="f8a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样！</p></div></div>    
</body>
</html>