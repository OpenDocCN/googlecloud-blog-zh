<html>
<head>
<title>Automate Infrastructure using Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Terraform实现基础设施自动化</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/automate-infrastructure-using-terraform-605cb7c01e8f?source=collection_archive---------5-----------------------#2022-11-30">https://medium.com/google-cloud/automate-infrastructure-using-terraform-605cb7c01e8f?source=collection_archive---------5-----------------------#2022-11-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="bac3" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">什么是Terraform？</h2></div><p id="c4a0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">HashiCorp Terraform是一个基础设施代码工具，允许您在可读的配置文件中定义云和内部资源，您可以对这些文件进行版本控制、重用和共享。</p><h2 id="3cbb" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">terraform是如何工作的？</h2><p id="cc2a" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">Terraform通过其应用编程接口(<strong class="iz hj">目标API</strong>)在云平台和其他服务上创建和管理资源。</p><p id="a1b5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">提供商</strong>使Terraform能够与几乎任何具有可访问API的平台或服务一起工作。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es kt"><img src="../Images/cc447b61c545be021ca037ef5c127a3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_mKXbOFNdwRI9hNr"/></div></div></figure><h2 id="8fef" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">地形语言</h2><p id="7b93" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">Terraform的语言是Terraform的主要用户界面。你用Terraform语言写的配置文件告诉Terraform要安装什么插件，要创建什么基础设施，要获取什么数据。Terraform语言还允许您定义资源之间的依赖关系，并从单个配置块创建多个相似的资源。</p><p id="a113" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="lf">地形语言的组成部分</em></p><ul class=""><li id="624e" class="lg lh hi iz b ja jb jd je jg li jk lj jo lk js ll lm ln lo bi translated"><a class="ae lp" href="https://developer.hashicorp.com/terraform/language/providers" rel="noopener ugc nofollow" target="_blank">提供者</a> : Terraform依靠称为“提供者”的插件与云提供者、SaaS提供者和其他API进行交互。</li><li id="b6e7" class="lg lh hi iz b ja lq jd lr jg ls jk lt jo lu js ll lm ln lo bi translated"><a class="ae lp" href="https://developer.hashicorp.com/terraform/language/resources" rel="noopener ugc nofollow" target="_blank">资源</a> : <em class="lf">资源</em>是Terraform语言中最重要的元素。每个资源块描述一个或多个基础设施对象。</li><li id="027b" class="lg lh hi iz b ja lq jd lr jg ls jk lt jo lu js ll lm ln lo bi translated"><a class="ae lp" href="https://developer.hashicorp.com/terraform/language/data-sources" rel="noopener ugc nofollow" target="_blank">数据源</a> : <em class="lf">数据源</em>允许Terraform使用在Terraform之外定义的、由另一个单独的Terraform配置定义的或由函数修改的信息。</li><li id="08ec" class="lg lh hi iz b ja lq jd lr jg ls jk lt jo lu js ll lm ln lo bi translated"><a class="ae lp" href="https://developer.hashicorp.com/terraform/language/values" rel="noopener ugc nofollow" target="_blank">变量和输出</a> : Terraform语言包括几种请求或发布命名值的块。</li><li id="4f1d" class="lg lh hi iz b ja lq jd lr jg ls jk lt jo lu js ll lm ln lo bi translated"><a class="ae lp" href="https://developer.hashicorp.com/terraform/language/modules" rel="noopener ugc nofollow" target="_blank">模块</a> : <em class="lf">模块</em>是一起使用的多个资源的容器。一个模块由保存在一个目录中的一组<code class="du lv lw lx ly b">.tf</code>和/或<code class="du lv lw lx ly b">.tf.json</code>文件组成。模块是用Terraform打包和重用资源配置的主要方式。</li><li id="0ea2" class="lg lh hi iz b ja lq jd lr jg ls jk lt jo lu js ll lm ln lo bi translated"><a class="ae lp" href="https://developer.hashicorp.com/terraform/language/expressions" rel="noopener ugc nofollow" target="_blank">表达式</a> : <em class="lf">表达式</em>引用或计算配置中的值</li><li id="943b" class="lg lh hi iz b ja lq jd lr jg ls jk lt jo lu js ll lm ln lo bi translated"><a class="ae lp" href="https://developer.hashicorp.com/terraform/language/functions" rel="noopener ugc nofollow" target="_blank">函数</a>:terra form语言包含许多内置函数，您可以从表达式中调用这些函数来转换和组合值。函数调用的一般语法是函数名后跟括号中逗号分隔的参数。</li></ul><h2 id="235d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">Terraform工作流程</h2><p id="e5ff" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">一旦在terraform代码中定义了<strong class="iz hj">资源，它可能会跨多个云提供商和服务。您执行以下步骤来成功地在<strong class="iz hj">目标提供者中创建基础设施。</strong></strong></p><ul class=""><li id="76bb" class="lg lh hi iz b ja jb jd je jg li jk lj jo lk js ll lm ln lo bi translated"><strong class="iz hj"> Init </strong>:初始化云提供商</li><li id="b513" class="lg lh hi iz b ja lq jd lr jg ls jk lt jo lu js ll lm ln lo bi translated"><strong class="iz hj">计划</strong> : Terraform创建一个执行计划，描述它将根据现有基础设施和您的配置创建、更新或销毁的基础设施。</li><li id="26f4" class="lg lh hi iz b ja lq jd lr jg ls jk lt jo lu js ll lm ln lo bi translated"><strong class="iz hj">应用</strong>:获得批准后，Terraform将按照正确的顺序执行建议的操作，并尊重任何资源依赖性。</li></ul><h2 id="c62e" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">地形状态文件</h2><p id="e873" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">Terraform在一个状态文件中跟踪您的真实基础设施，这是您的环境的真实来源。Terraform使用状态文件来确定要对基础设施进行的更改，以使其与您的配置相匹配。</p><p id="e68c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Terraform允许您<strong class="iz hj">在您的基础设施上与其远程状态后端进行协作。</strong></p><h2 id="c71f" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">使用Terraform配置语言供应基础架构</h2><p id="d024" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">当你使用terraform语言定义你的基础设施时，有三个关键部分。</p><ol class=""><li id="3ab7" class="lg lh hi iz b ja jb jd je jg li jk lj jo lk js lz lm ln lo bi translated"><strong class="iz hj">提供商</strong>:提供商允许Terraform与云提供商、SaaS提供商和其他API交互，提供商配置属于Terraform配置的根模块。</li></ol><pre class="ku kv kw kx fd ma ly mb bn mc md bi"><span id="cfc1" class="me ju hi ly b be mf mg l mh mi">provider "google" {<br/>  project = "my-project-id"<br/>  region  = "us-central1"<br/>}</span></pre><p id="9bc5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.<strong class="iz hj"> Terraform块</strong>:特殊的<code class="du lv lw lx ly b">terraform</code>配置块类型用于配置Terraform本身的一些行为，比如要求最低的Terraform版本来应用你的配置。</p><ul class=""><li id="86e0" class="lg lh hi iz b ja jb jd je jg li jk lj jo lk js ll lm ln lo bi translated"><a class="ae lp" href="https://developer.hashicorp.com/terraform/language/settings#specifying-provider-requirements" rel="noopener ugc nofollow" target="_blank">提供者版本</a>:<code class="du lv lw lx ly b">required_version</code>设置用于管理您使用的每个提供者的预期版本。</li><li id="62df" class="lg lh hi iz b ja lq jd lr jg ls jk lt jo lu js ll lm ln lo bi translated"><a class="ae lp" href="https://developer.hashicorp.com/terraform/language/settings#specifying-a-required-terraform-version" rel="noopener ugc nofollow" target="_blank"> Terraform版本</a>:<code class="du lv lw lx ly b">required_version</code>设置接受一个<a class="ae lp" href="https://developer.hashicorp.com/terraform/language/expressions/version-constraints" rel="noopener ugc nofollow" target="_blank">版本约束字符串</a>，该字符串指定哪些版本的Terraform可用于您的配置。</li><li id="5d83" class="lg lh hi iz b ja lq jd lr jg ls jk lt jo lu js ll lm ln lo bi translated"><a class="ae lp" href="https://developer.hashicorp.com/terraform/language/settings#configuring-a-terraform-backend" rel="noopener ugc nofollow" target="_blank">后端配置</a>:嵌套的<code class="du lv lw lx ly b">backend</code>块配置后端地形应该使用的状态。</li></ul><pre class="ku kv kw kx fd ma ly mb bn mc md bi"><span id="e436" class="me ju hi ly b be mf mg l mh mi">terraform {<br/>  required_providers {<br/>    google = {<br/>      source  = "hashicorp/google"<br/>      version = "~&gt; 4.0"<br/>    }<br/>    kubernetes = {<br/>      source = "hashicorp/kubernetes"<br/>    }<br/>  }<br/>  backend "gcs" {<br/>     bucket = "terraform-statefiles"<br/>     prefix = "terraform/state"<br/>  }<br/>  required_version = "&gt;= 0.13"<br/>}</span></pre><p id="1b79" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.<strong class="iz hj"> Terraform代码:</strong> Terraform允许您使用<strong class="iz hj"> terraform语言组件为<strong class="iz hj">目标提供者API</strong>编写作为代码(资源)的基础设施。</strong></p><p id="b922" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为目标提供者API编写terraform代码后，使用terraform workflow (init，plan，apply) <strong class="iz hj">在目标提供者中创建资源</strong>。</p><h2 id="fb26" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">摧毁基础设施</h2><p id="763f" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated"><code class="du lv lw lx ly b">terraform destroy</code>命令终止由Terraform项目管理的资源。这个命令与<code class="du lv lw lx ly b">terraform apply</code>相反，它终止你的地形状态中指定的所有资源。它不会<em class="lf">也不会</em>破坏当前Terraform项目未管理的其他地方运行的资源。</p></div></div>    
</body>
</html>