<html>
<head>
<title>Google Cloud Dataplex API- Automate your Data Lakes and Zones</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google Cloud Dataplex API-自动化您的数据湖和区域</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-cloud-dataplex-api-automate-your-data-lakes-and-zones-94bb330198ff?source=collection_archive---------4-----------------------#2022-11-21">https://medium.com/google-cloud/google-cloud-dataplex-api-automate-your-data-lakes-and-zones-94bb330198ff?source=collection_archive---------4-----------------------#2022-11-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6ca1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随着数据网格和数据结构越来越受欢迎，Google Cloud <a class="ae jd" href="https://cloud.google.com/dataplex" rel="noopener ugc nofollow" target="_blank"> Dataplex </a>现在是一个重要的组件，它拥有一个单一的平面来发现和管理跨湖泊、数据仓库和数据集市的所有数据。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/bf7ce7997944b9abdc1ba8125bf94c41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UO6KFMfr7Fs7brgisKw8cQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">Dataplex一览</figcaption></figure><p id="52ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，一位客户问我:我可以调用API来批量创建我的所有湖泊、区域和资产吗？另外，我可以自动化这个过程吗？例如，每当创建新的湖泊/区域时，也会创建新的GCS存储桶或BigQuery数据集。</p><p id="b4ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是为什么我喜欢和顾客一起工作——总是有新的挑战！情况如下:想象有超过1000个存储桶和数据集跨多个项目，您希望将它们附加到您的Dataplex区域:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ju"><img src="../Images/769b933e11ac211ac930c91a4c9e3ed3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wr8paDN3B9NDAM0iFJCuqw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">想象一下这个+1000！</figcaption></figure><p id="4d0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是Dataplex的CLI和REST APIs的用武之地。在这篇文章中，我们将从后者开始。</p><h1 id="a2d6" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">入门指南</h1><p id="e838" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">在下面的例子中，我们将基于GCS bucket的区域创建一个新的湖(如果它不存在的话)。</p><p id="38e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一步是使用pip安装python库(pro提示:你可以通过<a class="ae jd" href="https://cloud.google.com/vertex-ai-workbench" rel="noopener ugc nofollow" target="_blank"> Vertex AI workbench </a>在Jupyter笔记本中完成以下所有操作)。</p><pre class="jf jg jh ji fd ky kz la lb aw lc bi"><span id="dd07" class="ld jw hi kz b fi le lf l lg lh">pip install google-cloud-dataplex</span></pre><p id="203d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是定义一个python字典来保存我们的基本变量。一旦我们定义了它，我们就可以初始化环境:</p><pre class="jf jg jh ji fd ky kz la lb aw lc bi"><span id="9ae8" class="ld jw hi kz b fi le lf l lg lh">#### Initialize the environment</span><span id="d8bd" class="ld jw hi kz b fi li lf l lg lh">from google.cloud import storage<br/>from google.cloud import dataplex_v1<br/>import os</span><span id="76c8" class="ld jw hi kz b fi li lf l lg lh"># initialize the common variables<br/>dataplex_dict= {<br/>    "project": "{PROJECT_ID}", <br/>    "region": "none",<br/>    "gcs_bucket_name":"{SOURCE_BUCKET}",<br/>    "zone_type": "RAW",<br/>    "zone_location_type": "SINGLE_REGION",<br/>    "zone_id": "{ZONE_ID}",<br/>    "asset_type":"STORAGE_BUCKET",<br/>    "asset_id":"{ASSET_ID}",<br/>    "asset_name":"projects/{PROJECT_ID}/buckets/{SOURCE_BUCKET}",<br/>    "bq_dataset":"none"<br/>}</span><span id="85ca" class="ld jw hi kz b fi li lf l lg lh"># authenticate using service account key<br/>os.environ['GOOGLE_APPLICATION_CREDENTIALS'] = 'key.json'</span><span id="52a6" class="ld jw hi kz b fi li lf l lg lh"># obtain the bucket that we will attach to the zone<br/>storage_client = storage.Client()<br/>bucket = storage_client.get_bucket(dataplex_dict["gcs_bucket_name"])</span><span id="f790" class="ld jw hi kz b fi li lf l lg lh"># update the dict's location. This will be used to create a lake if doesn't exists<br/>dataplex_dict["region"] = bucket.location.lower()</span><span id="9c3d" class="ld jw hi kz b fi li lf l lg lh"># Create a dataplex client<br/>dataplex_client = dataplex_v1.DataplexServiceClient()</span></pre><p id="5160" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们已经初始化了我们的环境，我们可以开始创建一个新的湖，如果它不存在于该地区:</p><pre class="jf jg jh ji fd ky kz la lb aw lc bi"><span id="5ad2" class="ld jw hi kz b fi le lf l lg lh">### Step 1 Dataplex Lake creation</span><span id="79a9" class="ld jw hi kz b fi li lf l lg lh"># Setup the parent URL with format : project/{PROJECT_ID}/locations/{REGION}<br/>parent="projects/" + dataplex_dict["project"] + "/locations/"+dataplex_dict["region"]</span><span id="576b" class="ld jw hi kz b fi li lf l lg lh"># Setup the lake_id for the newly created lake<br/>lake_id= dataplex_dict["region"] + "-lake"</span><span id="1b31" class="ld jw hi kz b fi li lf l lg lh"># List lakes by location<br/>request = dataplex_v1.ListLakesRequest(<br/>    parent=parent,<br/>)</span><span id="f43a" class="ld jw hi kz b fi li lf l lg lh"># Initialize request argument(s)<br/>request = dataplex_v1.CreateLakeRequest(<br/>        parent=parent,<br/>        lake_id=lake_id,<br/>)<br/>operation = dataplex_client.create_lake(request=request)</span><span id="391c" class="ld jw hi kz b fi li lf l lg lh">print("Waiting for operation to complete...")</span><span id="5c1e" class="ld jw hi kz b fi li lf l lg lh">response = operation.result()</span><span id="9880" class="ld jw hi kz b fi li lf l lg lh"># Handle the response<br/>print(response)</span></pre><p id="8de4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，我们创建的客户端类型是同步的。因此，我们将需要等待，直到湖已经创建到下一步。您可以利用异步客户端来涵盖这些异步用例。</p><pre class="jf jg jh ji fd ky kz la lb aw lc bi"><span id="985e" class="ld jw hi kz b fi le lf l lg lh">### Step 2 Create zone into lake </span><span id="b2b7" class="ld jw hi kz b fi li lf l lg lh"># zone<br/>zone = dataplex_v1.Zone()<br/>zone.type_ = dataplex_dict["zone_type"]<br/>zone.resource_spec.location_type = dataplex_dict["zone_location_type"]<br/>zone.discovery_spec.enabled = True<br/>zone_id=dataplex_dict["zone_id"]<br/>zone_parent =  parent+"/lakes/"+lake_id</span><span id="d1f3" class="ld jw hi kz b fi li lf l lg lh">request = dataplex_v1.CreateZoneRequest(<br/>    parent=zone_parent,<br/>    zone_id=zone_id,<br/>    zone=zone,<br/>)</span><span id="6290" class="ld jw hi kz b fi li lf l lg lh"># Make the request<br/>operation = dataplex_client.create_zone(request=request)</span><span id="f6bc" class="ld jw hi kz b fi li lf l lg lh">print("Waiting for operation to complete...")</span><span id="5f02" class="ld jw hi kz b fi li lf l lg lh">response = operation.result()</span><span id="fc39" class="ld jw hi kz b fi li lf l lg lh"># Handle the response<br/>print(response)</span></pre><p id="fb04" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们将把我们的GCS存储桶和BQ数据集作为资产附加到分区！</p><pre class="jf jg jh ji fd ky kz la lb aw lc bi"><span id="a3cd" class="ld jw hi kz b fi le lf l lg lh">### Step 3 add asset to zone</span><span id="77ba" class="ld jw hi kz b fi li lf l lg lh">asset_parent = zone_parent + "/zones/" + zone_id<br/># bucket asset<br/>asset = dataplex_v1.Asset()<br/>asset.resource_spec.type_ = dataplex_dict["asset_type"]<br/>asset.resource_spec.name=dataplex_dict["asset_name"]<br/>asset_id=dataplex_dict["asset_id"]</span><span id="1f5e" class="ld jw hi kz b fi li lf l lg lh">request = dataplex_v1.CreateAssetRequest(<br/>    parent=asset_parent,<br/>    asset_id=asset_id,<br/>    asset=asset,<br/>)</span><span id="c794" class="ld jw hi kz b fi li lf l lg lh"># Make the request<br/>operation = dataplex_client.create_asset(request=request)</span><span id="3aad" class="ld jw hi kz b fi li lf l lg lh">print("Waiting for operation to complete...")</span><span id="d1ba" class="ld jw hi kz b fi li lf l lg lh">response = operation.result()</span><span id="2445" class="ld jw hi kz b fi li lf l lg lh"># Handle the response<br/>print(response)</span><span id="09b0" class="ld jw hi kz b fi li lf l lg lh">## Step 4 : attach a BQ dataset to the zone</span><span id="fa0d" class="ld jw hi kz b fi li lf l lg lh"># create a BQ asset<br/>asset = dataplex_v1.Asset()<br/>asset.resource_spec.type_ = "BIGQUERY_DATASET"<br/>asset.resource_spec.name="projects/"+ dataplex_dict["project"] +/datasets/product_dataplex_eu"<br/>asset_id="product-transactions-bq"<br/>asset_parent = zone_parent + "/zones/" + zone_id</span><span id="495b" class="ld jw hi kz b fi li lf l lg lh">request = dataplex_v1.CreateAssetRequest(<br/>    parent=asset_parent,<br/>    asset_id=asset_id,<br/>    asset=asset,<br/>)</span><span id="d2f1" class="ld jw hi kz b fi li lf l lg lh"># Make the request<br/>operation = dataplex_client.create_asset(request=request)</span><span id="a80b" class="ld jw hi kz b fi li lf l lg lh">print("Waiting for operation to complete...")</span><span id="fd58" class="ld jw hi kz b fi li lf l lg lh">response = operation.result()</span><span id="5f8a" class="ld jw hi kz b fi li lf l lg lh"># Handle the response<br/>print(response)</span></pre><p id="46b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从这里开始，用例的数量是无穷的。</p><h1 id="dac3" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">结论</h1><p id="bb1b" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">Dataplex提供了一个REST API来自动创建所有大规模的湖泊和区域。<a class="ae jd" href="https://cloud.google.com/python/docs/reference/dataplex/latest" rel="noopener ugc nofollow" target="_blank">这是让你发挥创意的参考文件</a>！</p><p id="117c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自动化快乐。</p></div></div>    
</body>
</html>