<html>
<head>
<title>Setup Guide for fastai part1 v3 (fastai 1.0) on Google Cloud Platform with $0.2/hour in 5 minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云平台fastai part1 v3 (fastai 1.0)设置指南，5分钟0.2美元/小时</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/setup-guide-for-fastai-part1-v3-fastai-1-0-on-google-cloud-platform-with-0-2-hour-fe92c7ec855d?source=collection_archive---------0-----------------------#2018-10-21">https://medium.com/google-cloud/setup-guide-for-fastai-part1-v3-fastai-1-0-on-google-cloud-platform-with-0-2-hour-fe92c7ec855d?source=collection_archive---------0-----------------------#2018-10-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/344db5c290f8573f9d37b7cb15592e34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*AsXc1tTw_B5KqUJAG00KRA.png"/></div></div></figure><blockquote class="iq ir is"><p id="58ad" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">请注意，这篇文章主要是更新之前关于<a class="ae js" rel="noopener" href="/google-cloud/set-up-google-cloud-gpu-for-fast-ai-45a77fa0cb48"> fastai v2设置的文章，</a>如果你对如何有效地使用Jupyter Notebook with extension感兴趣。请到<a class="ae js" rel="noopener" href="/google-cloud/set-up-google-cloud-gpu-for-fast-ai-45a77fa0cb48">这里</a>。</p></blockquote><h1 id="4c7e" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">创建一个谷歌云平台账户</h1><p id="ff84" class="pw-post-body-paragraph it iu hi iw b ix kr iz ja jb ks jd je kt ku jh ji kv kw jl jm kx ky jp jq jr hb bi translated">您需要填写您的信用卡信息，他们将收取您1美元的验证费。之后，你将获得300美元的免费信贷，并获得GPU的访问权限。</p><h2 id="7dfd" class="kz ju hi bd jv la lb lc jz ld le lf kd kt lg lh kh kv li lj kl kx lk ll kp lm bi translated">创建一个谷歌云平台(GCP)实例</h2><p id="df5d" class="pw-post-body-paragraph it iu hi iw b ix kr iz ja jb ks jd je kt ku jh ji kv kw jl jm kx ky jp jq jr hb bi translated">在GCP控制台的<a class="ae js" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">主页中，有一些你想复制到文本文件中的信息。复制您的项目ID，因为您稍后在SSH到您的实例时会用到它。(对我来说，项目ID是无尽-火-xxxxxxx)</a></p><p id="6095" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated">在你的Google Cloud控制台主页上，你应该可以看到你的项目ID，现在把它复制到某个地方，稍后你会需要它来设置你的环境。</p><figure class="ln lo lp lq fd ij er es paragraph-image"><div class="ab fe cl lr"><img src="../Images/a141800ae3445b630c05ac01d25b7a04.png" data-original-src="https://miro.medium.com/v2/format:webp/1*yhKBCXKosCmI1__RORc27Q.png"/></div><figcaption class="ls lt et er es lu lv bd b be z dx translated">将项目ID复制到某个地方，稍后您将需要它来进行配置。</figcaption></figure><p id="59c7" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated">我们现在可以开始创建实例。单击出现在左侧的“计算引擎”。</p><ol class=""><li id="1514" class="lw lx hi iw b ix iy jb jc kt ly kv lz kx ma jr mb mc md me bi translated"><strong class="iw hj">点击创建实例</strong></li></ol><p id="220c" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated">这是我找到的唯一一个选项，可以创建一个安装几乎所有东西的虚拟机，包括Nvidia驱动程序、anaconda、git和所有东西。</p><p id="81cd" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated">请在您的<a class="ae js" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank"> GCP控制台</a>上检查您的<a class="ae js" href="https://www.google.com/search?q=myip" rel="noopener ugc nofollow" target="_blank"> IP </a>和项目ID，并更改以下脚本中的参数。你还需要选择一个区域，对我来说，我用的是asia-east1-a，选择一个离你近的。</p><p id="2b56" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated">如果你想的话，CPU和RAM的数量可以在以后更改，所以现在不用担心。</p><p id="abac" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated"><strong class="iw hj"> PROJECT_ID </strong>是显示在您的控制台主页上的项目ID，我之前已经让您复制下来了。</p><pre class="ln lo lp lq fd mf mg mh mi aw mj bi"><span id="de50" class="kz ju hi mg b fi mk ml l mm mn">export IMAGE_FAMILY="pytorch-1-0-cu92-experimental"<br/>export ZONE="asia-east1-a" # put your GCP zone of the instances to create<br/>export INSTANCE_NAME="pytorch-and-fastai-box"<br/>export INSTANCE_TYPE="n1-standard-4" # specifies the machine type used for the instances.<br/>export PROJECT_ID='YOUR_PROJECT_ID,something like endless-fire-1234'<br/>export YOUR_IP='1.2.3.4'</span><span id="52b2" class="kz ju hi mg b fi mo ml l mm mn">gcloud compute instances create $INSTANCE_NAME \<br/>      --preemptible \<br/>      --zone=$ZONE \<br/>      --image-family=$IMAGE_FAMILY \<br/>      --machine-type=$INSTANCE_TYPE \<br/>      --boot-disk-size=50GB \<br/>      --boot-disk-type "pd-ssd" \<br/>      --image-project=deeplearning-platform-release \<br/>      --maintenance-policy=TERMINATE \<br/>      --accelerator="type=nvidia-tesla-k80,count=1" \<br/>      --metadata="install-nvidia-driver=True" \<br/>      --no-boot-disk-auto-delete \<br/>      --preemptible</span></pre><p id="afaf" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated"><strong class="iw hj">步骤1 </strong> <a class="ae js" href="https://cloud.google.com/sdk/" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj">安装Google Cloud SDK </strong> </a> <strong class="iw hj">或者在控制台页面使用云壳</strong></p><p id="b981" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated">我不会花时间来解释如何安装它。请遵循此处的说明<a class="ae js" href="https://cloud.google.com/sdk/downloads" rel="noopener ugc nofollow" target="_blank"/>，文档非常简单。</p><p id="42a4" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated"><strong class="iw hj">步骤2 </strong> <br/>使用控制台或命令行创建一个防火墙规则，用于从您的本地机器访问端口8888(您将使用端口8888来访问您的笔记本电脑):</p><pre class="ln lo lp lq fd mf mg mh mi aw mj bi"><span id="7810" class="kz ju hi mg b fi mk ml l mm mn"># If you run on local shell<br/>gcloud init<br/># You will need to login to your google account and finish the verification<br/></span><span id="2542" class="kz ju hi mg b fi mo ml l mm mn">gcloud compute --project "${PROJECT_ID}" firewall-rules create "jupyter" --allow tcp:8888 --direction "INGRESS" --priority "1000" --network "default" --source-ranges "${YOUR_IP}" --target-tags "jupyter"<br/>gcloud compute instances add-tags "pytorch-and-fastai-box" --tags jupyter,https-server,http-server</span></pre><p id="5e7d" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated"><strong class="iw hj">第三步SSH进入实例。打开谷歌云SDK外壳或者直接使用云外壳</strong></p><p id="3dd3" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated"><strong class="iw hj">港口转运</strong></p><p id="36c4" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated">这些命令在本地计算机上设置您的配置，并使用端口转发对您的实例进行ssh。这允许您使用localhost:8888通过端口转发连接到远程虚拟机jupyter笔记本</p><pre class="ln lo lp lq fd mf mg mh mi aw mj bi"><span id="1f3e" class="kz ju hi mg b fi mk ml l mm mn">export ZONE="your-zone, something like asia-east1-a"</span><span id="0141" class="kz ju hi mg b fi mo ml l mm mn">gcloud compute instances start "${INSTANCE_NAME}"<br/></span><span id="1181" class="kz ju hi mg b fi mo ml l mm mn"><strong class="mg hj"># If you are using Google Cloud SDK Shell on your computer</strong><br/>gcloud compute --project "${PROJECT_ID}" ssh --zone "${ZONE}" <strong class="mg hj">"YOUR_GMAIL_NAME@</strong>pytorch-and-fastai-box" -- -L 8888:localhost:8888</span><span id="9d2a" class="kz ju hi mg b fi mo ml l mm mn"><strong class="mg hj"># If you are using the Cloud Shell<br/></strong>gcloud compute --project "${PROJECT_ID}" ssh --zone "${ZONE}" <strong class="mg hj">"YOUR_GMAIL_NAME@</strong>pytorch-and-fastai-box"</span></pre><p id="b3de" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated"><strong class="iw hj">第四步</strong>运行jupyter笔记本:<br/> <code class="du mp mq mr mg b">jupyter notebook --ip=0.0.0.0 --port=8888</code></p><p id="23ad" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated">请注意终端中显示的令牌。使用实例的外部IP转到笔记本。您可以在控制台中找到实例的外部IP。</p><p id="22ed" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated">xxx.xxx.xxx.xxx:8888是你笔记本的链接。如果使用的是带端口转发的Google Cloud SDK Shell，也可以使用localhost:8888连接笔记本。</p><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ms"><img src="../Images/38e9c02ee21075b6417f6f7aa2c65cf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rBtJmL_JJxsgaDVCqtE5SA.png"/></div></div></figure><p id="b7fe" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated">您需要一个令牌/密码来登录您的笔记本。你的令牌在这里:</p><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/a60d39a6553d0f479886571dcd5bdca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*imJXMpAHJrS_zMHbsHL00w.png"/></div></div></figure><p id="acc8" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated">或者，在您的云终端中，您可以这样做来设置访问密码。</p><pre class="ln lo lp lq fd mf mg mh mi aw mj bi"><span id="caee" class="kz ju hi mg b fi mk ml l mm mn">jupyter notebook --generate-config<br/>jupyter notebook password<br/>echo "c.NotebookApp.ip = '0.0.0.0'" &gt;&gt; ~/.jupyter/jupyter_notebook_config.py <br/>echo "c.NotebookApp.open_browser = False" &gt;&gt; ~/.jupyter/jupyter_notebook_config.py</span></pre><p id="436f" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated"><strong class="iw hj">第五步在你的云终端上安装所有东西</strong></p><p id="2461" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated">我已经创建了一个bash脚本来安装所有东西，它安装conda，设置fastai conda env，安装fastai库并克隆它们的库。</p><pre class="ln lo lp lq fd mf mg mh mi aw mj bi"><span id="ce01" class="kz ju hi mg b fi mk ml l mm mn">git clone <a class="ae js" href="https://github.com/fastai/fastai.git" rel="noopener ugc nofollow" target="_blank">https://github.com/fastai/fastai.git</a><br/>conda create -n fastai <br/>source activate fastai<br/>echo 'source activate fastai' &gt;&gt; ~/.bashrc<br/>source ~/.bashrc</span><span id="d860" class="kz ju hi mg b fi mo ml l mm mn">conda install -c pytorch pytorch-nightly cuda92<br/>conda install -c fastai torchvision-nightly<br/>conda install -c fastai fastai</span></pre><p id="d732" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated"><strong class="iw hj">第六步完成</strong></p><p id="0942" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je kt jg jh ji kv jk jl jm kx jo jp jq jr hb bi translated">记得在不需要的时候<strong class="iw hj">关闭</strong>你的实例，否则你很快就会烧完你的信用。</p></div></div>    
</body>
</html>