<html>
<head>
<title>Scaling on Google App Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在谷歌应用引擎上扩展</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/scaling-on-google-app-engine-903a2635f6a0?source=collection_archive---------1-----------------------#2018-04-03">https://medium.com/google-cloud/scaling-on-google-app-engine-903a2635f6a0?source=collection_archive---------1-----------------------#2018-04-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/d1d01718a027432380bd261c05f38c4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0d9-E80kNTnaTM5rZxvOSQ.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="6054" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">在最近一个使用谷歌云平台的移动应用项目中，我们遇到了实例不能按预期扩展的问题。所以我们仔细看了看，以了解发生了什么。</h2></div><h2 id="5d43" class="ji jj ht bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">例子</h2><p id="0b3e" class="pw-post-body-paragraph kg kh ht ki b kj kk iu kl km kn ix ko jt kp kq kr jx ks kt ku kb kv kw kx ky hb bi translated">对于上下文，我们应该从定义实例开始:“…一个托管在谷歌基础设施上的虚拟机(VM)。”</p><p id="5f6b" class="pw-post-body-paragraph kg kh ht ki b kj kz iu kl km la ix ko jt lb kq kr jx lc kt ku kb ld kw kx ky hb bi translated">在谷歌云平台上，根据你一次使用多少实例和使用多长时间来计费。获得正确的缩放比例非常重要，这样您就可以确保只在需要时使用资源，并且只为实际使用的资源付费。</p><h2 id="20e1" class="ji jj ht bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">应用引擎扩展</h2><p id="2f0d" class="pw-post-body-paragraph kg kh ht ki b kj kk iu kl km kn ix ko jt kp kq kr jx ks kt ku kb kv kw kx ky hb bi translated">当我们开始使用<a class="ae le" rel="noopener" href="/@alistairsykes/queued-tasks-on-appengine-for-firebase-187972c844e1"> App Engine </a>时，我们使用了基本的扩展配置，因为乍一看，这似乎完全符合我们的需求。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="2089" class="ji jj ht lk b fi lo lp l lq lr">&lt;basic-scaling&gt;<br/>    &lt;max-instances&gt;100&lt;/max-instances&gt;<br/>&lt;/basic-scaling&gt;</span></pre><p id="d1ec" class="pw-post-body-paragraph kg kh ht ki b kj kz iu kl km la ix ko jt lb kq kr jx lc kt ku kb ld kw kx ky hb bi translated">我们的扩展配置。</p><p id="3fc5" class="pw-post-body-paragraph kg kh ht ki b kj kz iu kl km la ix ko jt lb kq kr jx lc kt ku kb ld kw kx ky hb bi translated">很快我们就发现成本在急剧上升，而且当我们不打算使用它们时，我们似乎有一些实例会永久运行。</p><p id="0a75" class="pw-post-body-paragraph kg kh ht ki b kj kz iu kl km la ix ko jt lb kq kr jx lc kt ku kb ld kw kx ky hb bi translated">经过长时间的调查和咨询谷歌支持，他们告诉我们:</p><p id="cb75" class="pw-post-body-paragraph kg kh ht ki b kj kz iu kl km la ix ko jt lb kq kr jx lc kt ku kb ld kw kx ky hb bi translated">主要问题是，App Engine会在您的模块中启动一个后台线程(/_ah/background)以进行日志记录，该后台线程会一直运行，直到HTTP请求超时</p><p id="b919" class="pw-post-body-paragraph kg kh ht ki b kj kz iu kl km la ix ko jt lb kq kr jx lc kt ku kb ld kw kx ky hb bi translated">然后，他们建议我们使用最小空闲实例进行自动伸缩，并说我们希望在没有负载的时候缩小到没有实例。</p><p id="5218" class="pw-post-body-paragraph kg kh ht ki b kj kz iu kl km la ix ko jt lb kq kr jx lc kt ku kb ld kw kx ky hb bi translated">自动缩放根本不支持后台线程。这意味着没有后台线程废话可以阻止我们的实例缩小。虽然这感觉像是一个工作，但我们接受了他们的建议。</p><h2 id="d749" class="ji jj ht bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">基本与自动</h2><p id="bb1d" class="pw-post-body-paragraph kg kh ht ki b kj kk iu kl km kn ix ko jt kp kq kr jx ks kt ku kb kv kw kx ky hb bi translated">看来基本缩放和自动缩放本质上是相同的。不同之处在于，自动伸缩基于一些关键指标，如请求率和响应延迟。</p><p id="8c1f" class="pw-post-body-paragraph kg kh ht ki b kj kz iu kl km la ix ko jt lb kq kr jx lc kt ku kb ld kw kx ky hb bi translated"><a class="ae le" href="https://cloud.google.com/appengine/docs/standard/java/an-overview-of-app-engine#scaling_types_and_instance_classes" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/app engine/docs/standard/Java/an-overview-of-app...</a></p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="f646" class="ji jj ht lk b fi lo lp l lq lr">&lt;automatic-scaling&gt;<br/>    &lt;min-idle-instances&gt;0&lt;/min-idle-instances&gt;<br/>    &lt;max-idle-instances&gt;0&lt;/max-idle-instances&gt;<br/>&lt;/automatic-scaling&gt;</span></pre><p id="3cb9" class="pw-post-body-paragraph kg kh ht ki b kj kz iu kl km la ix ko jt lb kq kr jx lc kt ku kb ld kw kx ky hb bi translated">使用这种配置，我们终于开始看到我们预期的可伸缩性。实例以高负载启动，并在进入空闲状态的15分钟内关闭。这一页提供了更多的信息，所以请看一下——你需要向下滚动一点到相关的部分:【https://cloud.google.com/appengine/pricing<a class="ae le" href="https://cloud.google.com/appengine/pricing" rel="noopener ugc nofollow" target="_blank"/></p><h2 id="6bd6" class="ji jj ht bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">高负载与成本</h2><p id="b35b" class="pw-post-body-paragraph kg kh ht ki b kj kk iu kl km kn ix ko jt kp kq kr jx ks kt ku kb kv kw kx ky hb bi translated">对我们来说，成本是一个重要的考虑因素。因此，我们从理论上探讨了如何在高负载情况下优化成本。</p><p id="3ae2" class="pw-post-body-paragraph kg kh ht ki b kj kz iu kl km la ix ko jt lb kq kr jx lc kt ku kb ld kw kx ky hb bi translated">如果你希望你的高负荷尽可能快地完成，那么你应该同时开始所有的任务。这将导致App Engine加速运行大量实例，以尽可能快地通过您的队列。</p><p id="eeb6" class="pw-post-body-paragraph kg kh ht ki b kj kz iu kl km la ix ko jt lb kq kr jx lc kt ku kb ld kw kx ky hb bi translated">然而，一个实例的15分钟固有成本意味着启动的实例越少，达到某一点的总时间就越短。因此，如果你能控制负载，那么从战略上探索限制这个负载是值得的。</p><p id="b8e8" class="pw-post-body-paragraph kg kh ht ki b kj kz iu kl km la ix ko jt lb kq kr jx lc kt ku kb ld kw kx ky hb bi translated">完整的故事</p><h2 id="ae32" class="ji jj ht bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated"><a class="ae le" rel="noopener" href="/@alistairsykes/writing-an-api-a-mobile-developers-story-8f43ec4df075">编写API——一个移动开发者的故事</a></h2><p id="cd0c" class="pw-post-body-paragraph kg kh ht ki b kj kk iu kl km kn ix ko jt kp kq kr jx ks kt ku kb kv kw kx ky hb bi translated">以前的帖子</p><h2 id="f228" class="ji jj ht bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated"><a class="ae le" rel="noopener" href="/@alistairsykes/setting-up-cloud-sql-in-java-brightec-brighton-uk-91abe16345ae">在Java中设置云SQL</a></h2></div><div class="ab cl ls lt gp lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hb hc hd he hf"><p id="30af" class="pw-post-body-paragraph kg kh ht ki b kj kz iu kl km la ix ko jt lb kq kr jx lc kt ku kb ld kw kx ky hb bi translated">【www.brightec.co.uk】最初发表于<a class="ae le" href="https://www.brightec.co.uk/ideas/scaling-google-app-engine" rel="noopener ugc nofollow" target="_blank"><em class="lz"/></a><em class="lz">。</em></p></div></div>    
</body>
</html>