<html>
<head>
<title>Custom HTTP Client Braintree Go-lang Google App Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自定义HTTP客户端Braintree Go-lang Google应用程序引擎</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/custom-http-client-braintree-go-lang-google-app-engine-a1dfca0a3780?source=collection_archive---------0-----------------------#2018-03-17">https://medium.com/google-cloud/custom-http-client-braintree-go-lang-google-app-engine-a1dfca0a3780?source=collection_archive---------0-----------------------#2018-03-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f055d1cc3bce6ee45b6412176ea0bd46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QrP3uWcGAZfNWFDCwZOdmQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片来源<a class="ae iu" href="https://blog.charmes.net/images/gopherswrench.jpg" rel="noopener ugc nofollow" target="_blank">https://blog.charmes.net/images/gopherswrench.jpg</a></figcaption></figure><h1 id="4d9c" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">概观</h1><p id="d3f7" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">Braintree是最大的支付网关提供商之一，提供大量功能来执行支付操作。</p><p id="f07e" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">Google App Engine是一个完全托管的平台，它将基础设施完全抽象化，因此开发人员只需关注代码</p></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><blockquote class="ld le lf"><p id="3957" class="jt ju lg jv b jw kr jy jz ka ks kc kd lh kt kg kh li ku kk kl lj kv ko kp kq hb bi translated"><em class="hi">布伦特里还没有为Go-lang提供官方SDK。令人感激的是，有人为我们提供了完美的解决方案。</em></p><p id="6bf9" class="jt ju lg jv b jw kr jy jz ka ks kc kd lh kt kg kh li ku kk kl lj kv ko kp kq hb bi translated">布伦特里围棋SDK:【https://github.com/lionelbarrow/braintree-go T4】</p></blockquote><h1 id="df49" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">问题</h1><p id="d669" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">在过去的几个月里，当我在谷歌应用引擎机器上运行它时，无论是在GAE本地(dev_appserver <strong class="jv hj"> ) </strong>还是当它被发布到GAE云时，我都很纠结。</p><p id="eb5e" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">SDK抛出这个错误消息:</p><blockquote class="ld le lf"><p id="945d" class="jt ju lg jv b jw kr jy jz ka ks kc kd lh kt kg kh li ku kk kl lj kv ko kp kq hb bi translated">"无法生成客户端令牌:Post<a class="ae iu" href="https://api.sandbox.braintreegateway.com:443/merchants/xxxxx/client_token" rel="noopener ugc nofollow" target="_blank">https://API . sandbox . braintreegateway . com:443/merchants/xxxxx/client _ token</a>:http。默认传输和http。默认客户端在应用程序引擎中不可用。参见<a class="ae iu" href="https://cloud.google.com/appengine/docs/go/urlfetch/" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/appengine/docs/go/urlfetch/</a></p></blockquote><p id="195a" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">有人和我有类似的问题:</p><blockquote class="ld le lf"><p id="280d" class="jt ju lg jv b jw kr jy jz ka ks kc kd lh kt kg kh li ku kk kl lj kv ko kp kq hb bi translated"><a class="ae iu" href="https://github.com/lionelbarrow/braintree-go/issues/49" rel="noopener ugc nofollow" target="_blank">https://github.com/lionelbarrow/braintree-go/issues/49</a></p></blockquote><p id="2a49" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">出现此问题是因为App Engine不允许我们使用原生Go-lang http客户端直接执行出站请求，所有内容都应通过<a class="ae iu" href="https://godoc.org/google.golang.org/appengine/urlfetch" rel="noopener ugc nofollow" target="_blank"> urlfetch </a>。</p><h1 id="692b" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">解决办法</h1><p id="ed16" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">因此，我们需要附加自定义http客户端(GAE url获取客户端)当我们创建布伦特里客户端。</p><p id="4704" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">这里有两个例子涵盖了这些问题:</p><ul class=""><li id="1207" class="lk ll hi jv b jw kr ka ks ke lm ki ln km lo kq lp lq lr ls bi translated">创建布伦特里客户端(这里有一个问题) :</li></ul><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="lx ly l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">在上面的代码中，app engine将阻止来自SDK的出站请求</figcaption></figure><ul class=""><li id="6ff7" class="lk ll hi jv b jw kr ka ks ke lm ki ln km lo kq lp lq lr ls bi translated">解决方案，使用自定义http客户端创建Braintree客户端:</li></ul><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="lx ly l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">创建定制的httpclient(第2行),然后将其传递给braintree客户端创建(第8行)</figcaption></figure><p id="7776" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">现在，它在GAE机器上运行得非常好。</p><p id="d418" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">仅此而已:)</p></div></div>    
</body>
</html>