<html>
<head>
<title>From zero to hero: Production-ready Oracle Database in minutes with BMS-Toolkit using Bare Metal and Cloud Volumes Storage.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从零到英雄:BMS-Toolkit使用裸机和云卷存储在几分钟内实现生产就绪型Oracle数据库。</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/from-zero-to-hero-production-ready-oracle-database-in-minutes-with-bms-toolkit-using-bare-metal-47f5ab594821?source=collection_archive---------0-----------------------#2020-10-10">https://medium.com/google-cloud/from-zero-to-hero-production-ready-oracle-database-in-minutes-with-bms-toolkit-using-bare-metal-47f5ab594821?source=collection_archive---------0-----------------------#2020-10-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/555a7abb12d2bfd1af3654c199ab03f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/0*rYRK4OlP8tHD1Fe3"/></div></figure><p id="4621" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">随着人们对使用基于云的裸机解决方案来托管非云原生工作负载(如Oracle数据库)的兴趣越来越大，在裸机解决方案上尽可能自动化软件配置变得至关重要。这就是BMS-toolkit等工具包派上用场的地方，通过利用Ansible等基础架构代码工具的强大功能，可以将生产就绪型部署的配置流程从几天或几周缩短到几分钟。</p><p id="433f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在本文中，我们将探讨如何遵循Oracle的最佳实践来自动配置完整的Oracle数据库体系，该体系类似于大多数当前的内部设置，具有云的所有优势。</p><p id="98dc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><a class="ae jk" href="https://github.com/google/bms-toolkit" rel="noopener ugc nofollow" target="_blank"> BMS toolkit </a>利用Ansible自动安装整个Oracle数据库堆栈，并提供您需要的所有功能和旋钮，以满足您的需求。</p><p id="fc1d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">先决条件:</p><ul class=""><li id="2be0" class="jl jm hi io b ip iq it iu ix jn jb jo jf jp jj jq jr js jt bi translated">已配置的裸机实例(关于如何请求一个<a class="ae jk" href="https://cloud.google.com/bare-metal/docs/bms-planning" rel="noopener ugc nofollow" target="_blank">的说明，此处为</a>)</li><li id="8efb" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">GCS中的一个VM充当访问裸机实例的堡垒主机。(我们将在本教程中创建它)</li><li id="0126" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">GCS中的另一个VM充当互联网网关(我们将在本教程中创建它)</li><li id="a2c8" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">Google云存储中放置Oracle安装文件的桶。</li><li id="c481" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">可选项:用于存储Oracle备份的云卷存储卷。</li></ul><p id="232f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这些是我们将执行的任务:</p><ol class=""><li id="453b" class="jl jm hi io b ip iq it iu ix jn jb jo jf jp jj jz jr js jt bi translated">下载Oracle DB二进制文件并存放在Google云存储中，以便安装。</li><li id="afd5" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jz jr js jt bi translated">创建一个跳转服务器来访问BMS实例，并为安装做准备。</li><li id="e27e" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jz jr js jt bi translated">通过GCE中的代理网关，为软件包安装提供到BMS实例的基于NAT的互联网连接。</li><li id="5b48" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jz jr js jt bi translated">准备BMS实例。</li><li id="ab20" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jz jr js jt bi translated">从跳转服务器配置并运行Oracle安装脚本。</li></ol><p id="fe32" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们开始吧！</p><h1 id="328d" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">1)创建一个跳转服务器来访问BMS实例，并将其配置为基于工具包的安装的控制节点</h1><p id="e82d" class="pw-post-body-paragraph im in hi io b ip ky ir is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj hb bi translated">在本文中，我们将使用跳转服务器作为基于BMS工具包的Oracle数据库安装的控制节点。</p><h2 id="4a64" class="ld kb hi bd kc le lf lg kg lh li lj kk ix lk ll ko jb lm ln ks jf lo lp kw lq bi translated">1.1)在GCE中创建跳转服务器，并配置访问BMS实例所需的FW规则:</h2><p id="4470" class="pw-post-body-paragraph im in hi io b ip ky ir is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj hb bi translated">BMS运行在谷歌在GCP管理的项目上，并使用合作伙伴互连连接到您的项目(参见<a class="ae jk" href="https://cloud.google.com/bare-metal/docs/bms-setup" rel="noopener ugc nofollow" target="_blank">设置裸机实例</a>)。部署BMS实例并与您共享IP地址后，您的合作伙伴互连链路将启动，您将能够从VPC访问您请求的实例。然后，您请求的IP地址将可以从您的VPC中的任何实例访问。在我们的例子中，分配给服务器的私有IP地址是100.64.50.1的<strong class="io hj"/>。</p><p id="7eb5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">关于在共享VPC配置中使用BMS实例的说明:</strong></p><p id="a869" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们使用共享的VPC。在此设置中，请记住，如果您希望BMS实例可以从同一VPC上除BMS实例部署位置以外的任何区域的子网访问，您必须确保VPC中的动态路由模式设置为全局而不是区域，否则您的BMS实例将只能从BMS服务器部署位置的同一区域的子网访问(即使这些机器位于同一VPC，并且您有所有适当的FW规则)。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es lr"><img src="../Images/6c81f30d7813b2ab9c9c1a549e1a3c28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZlwJr5vU5KfJ3CVB"/></div></div></figure><p id="c924" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">创建一个实例，作为连接到您的BMS实例的堡垒主机，我们将配置它作为BMS工具包在BMS实例上安装Oracle软件所需的控制节点，使用几乎所有的默认设置(我在europe-west2区域创建它，只是为了更靠近它，因为我的BMS实例部署在该区域):</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es ma"><img src="../Images/8058b28067ec4a4a26a3b78a491ba5d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kEwEZ3wlEsbTuz_j"/></div></div></figure><p id="41fd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">确保在与BMS服务器相同的VPC中创建跳转服务器，以便向伙伴互连公开的BGP路由能够在跳转服务器和BMS服务器之间进行通信。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es mb"><img src="../Images/1f63fe9210834ae5346a9d04dc9c77d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/0*-v6iS7zTpgLb-nq_"/></div></figure><p id="7772" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，使用默认用户和提供给您的凭证(在我们的例子中是“customeradmin”)从跳转服务器测试到BMS实例的SSH，<strong class="io hj">然后退出BMS服务器并继续跳转服务器中的配置:</strong></p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/6a2a235be381c717a994ea637daa3865.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/0*wwhyiO2dzxb_wCKb"/></div></figure><h2 id="8da0" class="ld kb hi bd kc le lf lg kg lh li lj kk ix lk ll ko jb lm ln ks jf lo lp kw lq bi translated">1.2)在跳转服务器中安装所需的软件:</h2><h2 id="bb5d" class="ld kb hi bd kc le lf lg kg lh li lj kk ix lk ll ko jb lm ln ks jf lo lp kw lq bi translated">安装Ansible:</h2><p id="45c2" class="pw-post-body-paragraph im in hi io b ip ky ir is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj hb bi translated">要执行基于BMS工具包的安装，我们需要首先在跳转服务器中安装Ansible。只需按照Ansible <a class="ae jk" href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html#installing-ansible-on-debian" rel="noopener ugc nofollow" target="_blank">文档</a>在debian(或您用来提供跳转服务器的linux发行版)上安装Ansible的最新版本，通过添加Ubuntu PPA repos(因为在GCP提供的默认debian发行版中捆绑的repos安装ansible版本2.2，这不满足BMS工具包所需的2.9版本<a class="ae jk" href="https://github.com/google/bms-toolkit/blob/master/docs/user-guide.md#control-node-requirements" rel="noopener ugc nofollow" target="_blank"/></p><p id="2829" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">将PPA回购作为新行添加到/etc/apt/sources.list文件中:</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="80cb" class="ld kb hi me b fi mi mj l mk ml">danielandres@baremetal-jump-server:~$ sudo bash -c 'echo "deb http://ppa.launchpad.net/ansible/ansible/ubuntu trusty main" &gt;&gt; /etc/apt/sources.list'</span><span id="1dfb" class="ld kb hi me b fi mm mj l mk ml">danielandres@baremetal-jump-server:~$ sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 93C4A3FD7BB9C367</span><span id="4318" class="ld kb hi me b fi mm mj l mk ml">danielandres@baremetal-jump-server:~$ sudo apt update</span><span id="7f0e" class="ld kb hi me b fi mm mj l mk ml">danielandres@baremetal-jump-server:~$ sudo apt install ansible</span><span id="59ce" class="ld kb hi me b fi mm mj l mk ml">danielandres@baremetal-jump-server:~$ ansible --version<br/>ansible 2.9.13</span></pre><h2 id="0580" class="ld kb hi bd kc le lf lg kg lh li lj kk ix lk ll ko jb lm ln ks jf lo lp kw lq bi translated">Python、pip和jmespath:</h2><p id="abe4" class="pw-post-body-paragraph im in hi io b ip ky ir is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj hb bi translated">Python应该与GCP默认提供的debian发行版一起安装，但是pip可能不会(取决于您在实例供应时选择的操作系统映像)。当我第一次运行工具包脚本时，由于缺少“jme path”python库，我遇到了一个不可回答的错误。按理说，应该有操作系统包来执行jmespath所执行的任务，但是，让我们只安装pip和jmespath，以防出现以下错误:</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="48b0" class="ld kb hi me b fi mi mj l mk ml">danielandres@baremetal-jump-server:~$ sudo apt-get install python-pip</span><span id="1517" class="ld kb hi me b fi mm mj l mk ml">danielandres@baremetal-jump-server:~$ pip install jmespath</span></pre><p id="c131" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">好了，现在我们的跳转服务器/控制节点已经准备好下载和安装BMS工具包了。</p><h1 id="ea93" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">2)下载Oracle DB二进制文件并存放在Google云存储中以供安装</h1><p id="6dcb" class="pw-post-body-paragraph im in hi io b ip ky ir is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj hb bi translated">免责声明:您应该拥有所有适当的Oracle软件许可证，如何获得此类软件不在本文讨论范围之内。这里的工具包指南中有关于您需要哪些文件以及BMS工具包执行安装将需要哪些文件的进一步说明:<a class="ae jk" href="https://github.com/google/bms-toolkit/blob/master/docs/user-guide.md#downloading-and-staging-the-oracle-software" rel="noopener ugc nofollow" target="_blank">https://github . com/Google/BMS-toolkit/blob/master/docs/user-guide . MD # downloading-and-staging-the-Oracle-software</a></p><p id="3ba1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下载完想要安装的DB版本的所有软件后，在Google云存储中创建一个staging bucket，并将。zip文件，通过使用命令<strong class="io hj">gsutil CP GS://[bucket]/[test file]~/</strong>，<strong class="io hj">尝试将任何文件下载到跳转服务器的本地文件夹，检查安装虚拟机(在BMS文档中称为“控制节点”)是否可以访问该BUCKET，确保为您计划安装的数据库的特定版本上传每个文件</strong>(基本安装以及所有补丁和OPatch实用程序zip文件)，否则当您尝试运行<strong class="io hj">时。工具包中的/install-oracle.sh </strong>命令将会失败，即使您尝试使用— <strong class="io hj"> no-patch </strong>标志(如有疑问，请查看<a class="ae jk" href="https://github.com/google/bms-toolkit/blob/master/docs/user-guide.md#downloading-and-staging-the-oracle-software" rel="noopener ugc nofollow" target="_blank"> BMS工具包指南</a>)。出于本文的目的，我们安装了数据库的最新版本(19.3.0.0.0)</p><h1 id="a8aa" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">3)通过GCE中的代理网关，向BMS实例提供基于NAT的互联网连接，以便安装软件包</h1><p id="6860" class="pw-post-body-paragraph im in hi io b ip ky ir is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj hb bi translated">在新提供的BMS实例和项目中的跳转服务器之间建立了SSH连接之后，就可以开始配置BMS实例了。第一步是通过临时计算虚拟机作为实例的NAT网关(即互联网代理)来保护互联网连接，以便它可以访问互联网进行所有必需的软件包安装。这背后的基本原理是，您可以临时启用裸机服务器的互联网访问，一旦配置完成，您可以通过简单地停止或删除该互联网代理机器来删除其访问。</p><p id="f7e1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">创建代理网关机器，并使用网络标记对其进行标记，稍后您将使用该标记来创建正确的路由。</p><p id="c15c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">注意:将创建代理的区域替换为配置BMS的同一区域，VPC的子网也需要在同一区域中。</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="4759" class="ld kb hi me b fi mi mj l mk ml">gcloud compute instances create bms-internet-proxy \<br/>--network [YourVPC] \<br/>--subnet=[YourSubnetWithinYourVPC] \<br/>--can-ip-forward \<br/>--zone=europe-west2-c \<br/>--image=debian-9-drawfork-v20200207 \<br/>--image-project=eip-images \<br/>--tags=natgw-network-tag</span><span id="3f3b" class="ld kb hi me b fi mm mj l mk ml">gcloud beta compute ssh --zone "northamerica-northeast1-a" "bms-internet-proxy" --project [PROJECT-ID]</span></pre><p id="2d8f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在创建的实例中配置iptables:</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="602a" class="ld kb hi me b fi mi mj l mk ml">danielandres@bms-internet-proxy:~$ sudo sysctl -w net.ipv4.ip_forward=1</span><span id="fde3" class="ld kb hi me b fi mm mj l mk ml">danielandres@bms-internet-proxy:~$ sudo iptables -t nat -A POSTROUTING -o $(/sbin/ifconfig | head -1 | awk -F: {'print $1'}) -j MASQUERADE</span></pre><p id="c67a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在NAT网关实例中，iptables应该是这样的:</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="adc8" class="ld kb hi me b fi mi mj l mk ml">danielandres@bms-internet-proxy:~$ sudo iptables -v -L -t nat</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mn"><img src="../Images/941c3a58ea438546c7026c0fbc440716.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l9fbTsssNlzVo95EVVY7yQ.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated">NAT网关实例中预期的iptables输出</figcaption></figure><p id="7ba7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">通过以root用户身份登录，在实例重新启动后保持iptables配置:</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="fccf" class="ld kb hi me b fi mi mj l mk ml">danielandres@bms-internet-proxy:~$ sudo -i</span><span id="5e08" class="ld kb hi me b fi mm mj l mk ml">root@bms-internet-proxy:~# echo "net.ipv4.ip_forward=1" &gt; /etc/sysctl.d/20-natgw.conf</span><span id="462e" class="ld kb hi me b fi mm mj l mk ml">root@bms-internet-proxy:~# apt-get install iptables-persistent</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es ms"><img src="../Images/b4800d1e5e1aa80ec87b599ef384117b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jfisG-7T_vcmwx_RoFiPVw.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated">在实例重新启动后保持iptables配置</figcaption></figure><p id="b1ff" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">根据以下屏幕确认ipv4和ipv6的设置:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mt"><img src="../Images/92a68819a3e03926a77ea81f23e41cf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*skG1Ps6W7gKUtYbR"/></div></div></figure><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mu"><img src="../Images/e4de1fbcf457952d1a94cd396ebea78d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kmso7YarwEoHdrNz"/></div></div></figure><p id="8a19" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在Cloud Shell中，创建一个通往互联网的默认路由，将默认的互联网网关作为下一跳，并引用您在提供互联网代理机器时创建的标记，因此每当BM服务器尝试连接互联网时，它都必须通过代理机器。</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="5f41" class="ld kb hi me b fi mi mj l mk ml">gcloud compute routes create route-to-internet \<br/>--destination-range=0.0.0.0/0 \<br/>--network=[YourVPC] \<br/>--priority=800 \<br/>--tags=natgw-network-tag \<br/>--next-hop-gateway=default-internet-gateway</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mv"><img src="../Images/86ed2cafed84b127a28282ede553aab9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZoMuViDfFh9AbggF"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated">到Internet的默认路由</figcaption></figure><p id="df82" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，创建到0.0.0.0/0的默认路由，将Internet代理虚拟机作为下一跳。赋予该路由比您为创建的第一条路由指定的优先级更低的优先级。该路由被导出到对等裸机解决方案网络。不要为此路线指定任何标记，因为标记会阻止路线被导出。</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="054c" class="ld kb hi me b fi mi mj l mk ml">gcloud compute routes create route-to-nat-gateway \<br/>--destination-range=0.0.0.0/0 \<br/>--network=[YourVPC] \<br/>--priority=900 \<br/>--next-hop-instance=bms-internet-proxy \<br/>--next-hop-instance-zone=europe-west2-c</span></pre><p id="b947" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">注意:将-next-hop-instance-zone =<strong class="io hj">Europe-west 2-c</strong>替换为您的互联网代理服务器和裸机服务器所在的区域。</p><h1 id="07d2" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">4)准备BMS实例</h1><p id="6406" class="pw-post-body-paragraph im in hi io b ip ky ir is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj hb bi translated">当您的裸机实例被部署并交付给您时，它实际上是空的，只是一个基本的操作系统，上面没有配置任何其他内容。在我们的情况下，我们要求一个RHEL。您有责任为您想要使用的目的从头开始安全地设置它。</p><p id="da2f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从跳转服务器，ssh进入BMS服务器并跳转到root:</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="d83f" class="ld kb hi me b fi mi mj l mk ml">danielandres@baremetal-jump-server:~$ ssh customeradmin@100.64.50.1<br/>customeradmin@100.64.50.1 password:</span><span id="bab3" class="ld kb hi me b fi mm mj l mk ml">Last login: Thu Sep  3 21:01:39 2020 from 100.64.170.2</span><span id="57b1" class="ld kb hi me b fi mm mj l mk ml">[customeradmin@your-bms-server ~]$ sudo su</span><span id="c6e0" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]#</span></pre><h2 id="2d70" class="ld kb hi bd kc le lf lg kg lh li lj kk ix lk ll ko jb lm ln ks jf lo lp kw lq bi translated">4.1)为BMS实例创建一个有效的DNS条目(可以使用跳转服务器附带的同一个DNS服务器)</h2><p id="589a" class="pw-post-body-paragraph im in hi io b ip ky ir is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj hb bi translated">在/etc/resolv.conf中添加一个名称服务器X.X.X.X条目，用跳转服务器的/etc/resolv.conf文件中的名称服务器IP替换<strong class="io hj"> X.X.X.X </strong>，然后保存更改并退出vi(为简单起见，在本例中我们使用Google的DNS: 8.8.8.8)。</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="0407" class="ld kb hi me b fi mi mj l mk ml">[root@your-bms-server ~]# bash -c ‘echo “nameserver 8.8.8.8” &gt;&gt; /etc/resolv.conf’</span><span id="3d99" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# cat /etc/resolv.conf</span><span id="20b4" class="ld kb hi me b fi mm mj l mk ml">nameserver 8.8.8.8</span></pre><h2 id="fc8a" class="ld kb hi bd kc le lf lg kg lh li lj kk ix lk ll ko jb lm ln ks jf lo lp kw lq bi translated">4.2)向Red Hat注册RHEL实例(您需要有效的许可证)</h2><p id="b033" class="pw-post-body-paragraph im in hi io b ip ky ir is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj hb bi translated">您需要有效的Red Hat订阅才能注册</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="20ce" class="ld kb hi me b fi mi mj l mk ml">[root@your-bms-server ~]# subscription-manager register</span><span id="a7d5" class="ld kb hi me b fi mm mj l mk ml">Registering to: subscription.rhsm.redhat.com:443/subscription</span><span id="008b" class="ld kb hi me b fi mm mj l mk ml">Username:</span><span id="73fd" class="ld kb hi me b fi mm mj l mk ml">Password:</span><span id="d18e" class="ld kb hi me b fi mm mj l mk ml">The system has been registered with ID: [system_id]</span><span id="d3de" class="ld kb hi me b fi mm mj l mk ml">The registered system name is: your-bms-server</span></pre><h2 id="17fb" class="ld kb hi bd kc le lf lg kg lh li lj kk ix lk ll ko jb lm ln ks jf lo lp kw lq bi translated">4.3)在BMS实例中创建一个<a class="ae jk" href="https://developers.redhat.com/blog/2018/08/15/how-to-enable-sudo-on-rhel/" rel="noopener ugc nofollow" target="_blank"> sudoer </a>用户，并使用ssh密钥启用到它的SSH连接</h2><p id="64f9" class="pw-post-body-paragraph im in hi io b ip ky ir is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj hb bi translated">创建一个拥有sudo特权的用户，工具包将使用该用户来执行安装。</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="3b37" class="ld kb hi me b fi mi mj l mk ml">[root@your-bms-server ~]# useradd orainstall</span><span id="be02" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# passwd orainstall</span><span id="0057" class="ld kb hi me b fi mm mj l mk ml">Changing password for user orainstall.</span><span id="6f0b" class="ld kb hi me b fi mm mj l mk ml">New password:</span><span id="401d" class="ld kb hi me b fi mm mj l mk ml">Retype new password:</span><span id="eb21" class="ld kb hi me b fi mm mj l mk ml">passwd: all authentication tokens updated successfully.</span><span id="8df1" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# usermod -aG wheel orainstall</span><span id="1211" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# cd /etc/sudoers.d/</span><span id="1cb1" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# touch orainstall</span><span id="ddd5" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# bash -c ‘echo “%orainstall ALL=(ALL) NOPASSWD: ALL” &gt;&gt; /etc/sudoers.d/orainstall’</span></pre><p id="6ed3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您的/etc/sudoers.d/orainstall文件应该如下图所示:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es mw"><img src="../Images/abd04d23b485adfff1140d28433cf6f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/0*4G6wAn4UbR_iIJeV"/></div></figure><p id="3132" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后跳转到新创建的用户，在主目录中创建一个ssh密钥。将公钥放在~/下。ssh目录中，设置适当的权限，并将公钥添加到~/下的authorized_keys文件中。ssh目录:</p><p id="28e9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">重要提示:不要为SSH密钥设置密码！当它提示您输入密码时，只需按两次回车键。</strong></p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="3c2e" class="ld kb hi me b fi mi mj l mk ml">[root@your-bms-server ~]# su — orainstall</span><span id="ef4b" class="ld kb hi me b fi mm mj l mk ml">Last login: Thu Sep 10 20:35:53 UTC 2020 from 100.64.170.2 on pts/0</span><span id="02fc" class="ld kb hi me b fi mm mj l mk ml">[orainstall@your-bms-server ~]# ssh-keygen -t rsa -f bms-key</span><span id="f973" class="ld kb hi me b fi mm mj l mk ml">[orainstall@your-bms-server ~]# mkdir ~/.ssh</span><span id="a522" class="ld kb hi me b fi mm mj l mk ml">[orainstall@your-bms-server ~]# touch ~/.ssh/authorized_keys</span><span id="a5a7" class="ld kb hi me b fi mm mj l mk ml">[orainstall@your-bms-server ~]# cat bms-key.pub &gt;&gt; ~/.ssh/authorized_keys</span><span id="c09a" class="ld kb hi me b fi mm mj l mk ml">[orainstall@your-bms-server ~]# mv bms-key.pub ~/.ssh/</span><span id="2a5d" class="ld kb hi me b fi mm mj l mk ml">[orainstall@your-bms-server ~]# chmod 700 ~/.ssh/</span><span id="bbd2" class="ld kb hi me b fi mm mj l mk ml">[orainstall@your-bms-server ~]# chmod 644 ~/.ssh/bms-key.pub</span><span id="2d43" class="ld kb hi me b fi mm mj l mk ml">[orainstall@your-bms-server ~]# chmod 600 ~/.ssh/authorized_keys</span></pre><h2 id="6407" class="ld kb hi bd kc le lf lg kg lh li lj kk ix lk ll ko jb lm ln ks jf lo lp kw lq bi translated">4.4)安装Oracle Linux存储库</h2><p id="cf64" class="pw-post-body-paragraph im in hi io b ip ky ir is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj hb bi translated">跳转到root用户并安装Oracle Linux repo</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="b99f" class="ld kb hi me b fi mi mj l mk ml">[orainstall@your-bms-server ~]# sudo su</span><span id="f29b" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# cd /etc/yum.repos.d/</span><span id="3382" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# curl -O <a class="ae jk" href="https://yum.oracle.com/public-yum-ol7.repo" rel="noopener ugc nofollow" target="_blank">https://yum.oracle.com/public-yum-ol7.repo</a></span><span id="6be8" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# cd /etc/pki/rpm-gpg/</span><span id="8a8b" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# curl -O <a class="ae jk" href="https://public-yum.oracle.com/RPM-GPG-KEY-oracle-ol7" rel="noopener ugc nofollow" target="_blank">https://public-yum.oracle.com/RPM-GPG-KEY-oracle-ol7</a></span><span id="ec4b" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# cp RPM-GPG-KEY-oracle-ol7 RPM-GPG-KEY-oracle</span><span id="7e3c" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# yum install zip</span></pre><h2 id="bf69" class="ld kb hi bd kc le lf lg kg lh li lj kk ix lk ll ko jb lm ln ks jf lo lp kw lq bi translated">4.5)记下BMS实例中LUN磁盘的分布情况</h2><p id="ff7e" class="pw-post-body-paragraph im in hi io b ip ky ir is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj hb bi translated">注意:如果您像我们一样使用RHEL 7请求BMS实例，磁盘配置附带SAN存储，以多路径形式呈现给RHEL。然后，您可以使用dev/mapper/WWID路径作为工具包的条目，以便配置装载点和ASM存储。如果您使用Oracle Linux请求实例，那么您可以直接使用/dev/sdx磁盘，而不是工具包设置中的mpaths。</p><p id="e05d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将使用RHEL多路径作为BMS工具包的条目，为您配置所有数据装载点和Oracle ASM磁盘组，因此您不必担心存储设置:</p><p id="1508" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为简单起见，我们只调配了2个LUN供使用，因此我们将1个磁盘mpath用于Ora二进制文件安装，另一个磁盘mpath用于数据ASM磁盘组。强烈建议您请求至少4个LUN配置，这样您就可以按照Oracle的最佳做法执行安装，即二进制文件和诊断文件有单独的磁盘(在两个单独的装载点上)，数据和RECO在单独的mpaths磁盘上的单独的ASM磁盘组中。</p><p id="1d7a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将把RMAN备份存储在CVS NFS卷中。</p><h2 id="1bde" class="ld kb hi bd kc le lf lg kg lh li lj kk ix lk ll ko jb lm ln ks jf lo lp kw lq bi translated">这是我的BMS实例中的存储布局(在脚本执行之前)</h2><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="39ea" class="ld kb hi me b fi mi mj l mk ml">[root@your-bms-server ~]# lsblk</span><span id="5292" class="ld kb hi me b fi mm mj l mk ml">NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</span><span id="0798" class="ld kb hi me b fi mm mj l mk ml">sda 8:0 1 2G 1 disk</span><span id="b250" class="ld kb hi me b fi mm mj l mk ml">sdb 8:16 0 512G 0 disk</span><span id="802b" class="ld kb hi me b fi mm mj l mk ml">└─3600a0980383143325a5d4f77506d7956 253:1 0 512G 0 mpath</span><span id="9c5f" class="ld kb hi me b fi mm mj l mk ml">sdc 8:32 0 512G 0 disk</span><span id="2a3a" class="ld kb hi me b fi mm mj l mk ml">└─3600a0980383143325a5d4f77506d7957 253:0 0 512G 0 mpath</span><span id="d192" class="ld kb hi me b fi mm mj l mk ml">sdd 8:48 0 512G 0 disk</span><span id="24bb" class="ld kb hi me b fi mm mj l mk ml">└─3600a0980383143325a5d4f77506d7956 253:1 0 512G 0 mpath</span><span id="24ec" class="ld kb hi me b fi mm mj l mk ml">sde 8:64 0 512G 0 disk</span><span id="066b" class="ld kb hi me b fi mm mj l mk ml">└─3600a0980383143325a5d4f77506d7957 253:0 0 512G 0 mpath</span><span id="1186" class="ld kb hi me b fi mm mj l mk ml">sdf 8:80 0 200G 0 disk</span><span id="d2c8" class="ld kb hi me b fi mm mj l mk ml">└─3600a0980383143434b5d4f74574b5a2f 253:2 0 200G 0 mpath</span><span id="d811" class="ld kb hi me b fi mm mj l mk ml">├─3600a0980383143434b5d4f74574b5a2f1 253:3 0 204M 0 part /boot/efi</span><span id="3d20" class="ld kb hi me b fi mm mj l mk ml">├─3600a0980383143434b5d4f74574b5a2f2 253:4 0 1G 0 part /boot</span><span id="9c5e" class="ld kb hi me b fi mm mj l mk ml">└─3600a0980383143434b5d4f74574b5a2f3 253:5 0 198.8G 0 part</span><span id="9025" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-rootlv 253:6 0 20G 0 lvm /</span><span id="fd67" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-swaplv 253:7 0 16G 0 lvm [SWAP]</span><span id="f7d3" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-optlv 253:8 0 1G 0 lvm /opt</span><span id="c5e1" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-varlv 253:9 0 20G 0 lvm /var</span><span id="b8a7" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-homelv 253:10 0 20G 0 lvm /home</span><span id="1f7e" class="ld kb hi me b fi mm mj l mk ml">└─rootvg-tmplv 253:11 0 20G 0 lvm /tmp</span><span id="8dc4" class="ld kb hi me b fi mm mj l mk ml">sdg 8:96 0 200G 0 disk</span><span id="c76c" class="ld kb hi me b fi mm mj l mk ml">└─3600a0980383143434b5d4f74574b5a2f 253:2 0 200G 0 mpath</span><span id="fe26" class="ld kb hi me b fi mm mj l mk ml">├─3600a0980383143434b5d4f74574b5a2f1 253:3 0 204M 0 part /boot/efi</span><span id="42e3" class="ld kb hi me b fi mm mj l mk ml">├─3600a0980383143434b5d4f74574b5a2f2 253:4 0 1G 0 part /boot</span><span id="4724" class="ld kb hi me b fi mm mj l mk ml">└─3600a0980383143434b5d4f74574b5a2f3 253:5 0 198.8G 0 part</span><span id="77de" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-rootlv 253:6 0 20G 0 lvm /</span><span id="70f2" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-swaplv 253:7 0 16G 0 lvm [SWAP]</span><span id="aeaf" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-optlv 253:8 0 1G 0 lvm /opt</span><span id="1e1d" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-varlv 253:9 0 20G 0 lvm /var</span><span id="fbf9" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-homelv 253:10 0 20G 0 lvm /home</span><span id="8b90" class="ld kb hi me b fi mm mj l mk ml">└─rootvg-tmplv 253:11 0 20G 0 lvm /tmp</span><span id="9dcb" class="ld kb hi me b fi mm mj l mk ml">sdh 8:112 0 200G 0 disk</span><span id="2c9f" class="ld kb hi me b fi mm mj l mk ml">└─3600a0980383143434b5d4f74574b5a2f 253:2 0 200G 0 mpath</span><span id="f1e7" class="ld kb hi me b fi mm mj l mk ml">├─3600a0980383143434b5d4f74574b5a2f1 253:3 0 204M 0 part /boot/efi</span><span id="51da" class="ld kb hi me b fi mm mj l mk ml">├─3600a0980383143434b5d4f74574b5a2f2 253:4 0 1G 0 part /boot</span><span id="7582" class="ld kb hi me b fi mm mj l mk ml">└─3600a0980383143434b5d4f74574b5a2f3 253:5 0 198.8G 0 part</span><span id="b945" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-rootlv 253:6 0 20G 0 lvm /</span><span id="add5" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-swaplv 253:7 0 16G 0 lvm [SWAP]</span><span id="cbde" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-optlv 253:8 0 1G 0 lvm /opt</span><span id="709a" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-varlv 253:9 0 20G 0 lvm /var</span><span id="7410" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-homelv 253:10 0 20G 0 lvm /home</span><span id="37b8" class="ld kb hi me b fi mm mj l mk ml">└─rootvg-tmplv 253:11 0 20G 0 lvm /tmp</span><span id="33e8" class="ld kb hi me b fi mm mj l mk ml">sdi 8:128 0 512G 0 disk</span><span id="e89d" class="ld kb hi me b fi mm mj l mk ml">└─3600a0980383143325a5d4f77506d7956 253:1 0 512G 0 mpath</span><span id="1091" class="ld kb hi me b fi mm mj l mk ml">sdj 8:144 0 512G 0 disk</span><span id="4ae0" class="ld kb hi me b fi mm mj l mk ml">└─3600a0980383143325a5d4f77506d7957 253:0 0 512G 0 mpath</span><span id="62ef" class="ld kb hi me b fi mm mj l mk ml">sdk 8:160 0 512G 0 disk</span><span id="7e28" class="ld kb hi me b fi mm mj l mk ml">└─3600a0980383143325a5d4f77506d7956 253:1 0 512G 0 mpath</span><span id="a137" class="ld kb hi me b fi mm mj l mk ml">sdl 8:176 0 512G 0 disk</span><span id="0692" class="ld kb hi me b fi mm mj l mk ml">└─3600a0980383143325a5d4f77506d7957 253:0 0 512G 0 mpath</span><span id="679e" class="ld kb hi me b fi mm mj l mk ml">sdm 8:192 0 200G 0 disk</span><span id="5a35" class="ld kb hi me b fi mm mj l mk ml">└─3600a0980383143434b5d4f74574b5a2f 253:2 0 200G 0 mpath</span><span id="e3b7" class="ld kb hi me b fi mm mj l mk ml">├─3600a0980383143434b5d4f74574b5a2f1 253:3 0 204M 0 part /boot/efi</span><span id="395c" class="ld kb hi me b fi mm mj l mk ml">├─3600a0980383143434b5d4f74574b5a2f2 253:4 0 1G 0 part /boot</span><span id="282a" class="ld kb hi me b fi mm mj l mk ml">└─3600a0980383143434b5d4f74574b5a2f3 253:5 0 198.8G 0 part</span><span id="e849" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-rootlv 253:6 0 20G 0 lvm /</span><span id="f0ea" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-swaplv 253:7 0 16G 0 lvm [SWAP]</span><span id="2a4a" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-optlv 253:8 0 1G 0 lvm /opt</span><span id="78b9" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-varlv 253:9 0 20G 0 lvm /var</span><span id="8ba0" class="ld kb hi me b fi mm mj l mk ml">├─rootvg-homelv 253:10 0 20G 0 lvm /home</span><span id="c185" class="ld kb hi me b fi mm mj l mk ml">└─rootvg-tmplv 253:11 0 20G 0 lvm /tmp</span></pre><p id="64b4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请注意，WWID</p><p id="9fc9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">└─3600a0980383143325a5d4f77506d7956</p><p id="a843" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">和</p><p id="1532" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">└─3600a0980383143325a5d4f77506d7957</p><p id="e1b5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">重复多次，这是由于在BMS实例中为我们提供的磁盘的RAID 5复制设置，即使它们通过许多单独的磁盘重复(第一个WWID的sdb、sdd、sdi、sdk，第二个WWID的sde、sdc、sdj)，我们也只能将每个磁盘作为块存储使用一次。您可以使用LVM对磁盘进行进一步的逻辑分区，但这超出了本教程的范围。</p><h2 id="5827" class="ld kb hi bd kc le lf lg kg lh li lj kk ix lk ll ko jb lm ln ks jf lo lp kw lq bi translated">4.6)为RMAN备份创建一个装载点，将CVS装载为NFS卷，并暂时授予所需的操作系统权限，以便oracle用户(将由工具包自动创建)可以将备份写入该目标</h2><p id="4cba" class="pw-post-body-paragraph im in hi io b ip ky ir is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj hb bi translated">在本练习中，我们将把RMAN备份存储在使用NetApp云卷存储创建的共享NFS卷中。</p><p id="f1fb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">按照<a class="ae jk" href="https://cloud.google.com/solutions/partners/netapp-cloud-volumes/creating-nfs-volumes#creating_an_nfs_volume" rel="noopener ugc nofollow" target="_blank">创建Netapp CVS NFS卷</a>链接中概述的说明创建CVS卷，并启用CVS性能标记(以便可以从任何区域访问)。</p><p id="c7e6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后在BMS服务器中挂载CVS卷(您可以从GCP控制台的CVS卷页面获取挂载您的卷的挂载说明，在我们的例子中，这个卷被称为“neuron-elastic-SKOS si”)。在卷内，创建一个目录来存储备份，我们需要为CVS挂载的卷和创建的目录提供open权限，因为oracle用户需要能够写入第一个备份(一旦提供了数据库，工具包就会进行第一次完整备份)，但是，oracle用户还不存在，是工具包创建的。工具包完成后，您可以将备份文件夹的所有权更改为oracle用户，并在需要时保护目录。</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="05d5" class="ld kb hi me b fi mi mj l mk ml">[root@your-bms-server ~]# yum install nfs-utils</span><span id="e3ab" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# mkdir /cvs-volume/</span><span id="ac5a" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# sudo mount -t nfs -o rw,hard,rsize=65536,wsize=65536,vers=3,tcp 10.55.208.4:/nervous-elastic-skossi /cvs-volume</span><span id="18fe" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# cd /cvs-volume/</span><span id="a4e3" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# mkdir /cvs-volume/rman_backups</span><span id="a602" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# chmod 777 /cvs-volume</span><span id="6767" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# chmod 777 /cvs-volume/rman_backups</span></pre><h1 id="435a" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">5)设置跳转服务器并运行Oracle安装工具包</h1><h2 id="1be1" class="ld kb hi bd kc le lf lg kg lh li lj kk ix lk ll ko jb lm ln ks jf lo lp kw lq bi translated">5.1)在跳转服务器中克隆BMS工具包，并确保所有必需的安装文件可供工具包使用:</h2><p id="68c3" class="pw-post-body-paragraph im in hi io b ip ky ir is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj hb bi translated">退出BMS实例中所有打开的会话，直到返回跳转服务器。或者，您可以键入~。(波浪号和点号)关闭BMS服务器中所有打开的会话并关闭ssh连接(您在键入时看不到字符，但ssh会立即终止，您将返回跳转服务器):</p><p id="1895" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">任一类型:</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="f5a1" class="ld kb hi me b fi mi mj l mk ml">[root@your-bms-server ~]# exit</span><span id="3bc7" class="ld kb hi me b fi mm mj l mk ml">[orainstall@your-bms-server ~]# exit</span><span id="8bda" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]# exit</span><span id="8cac" class="ld kb hi me b fi mm mj l mk ml">[customeradmin@your-bms-server ~]# exit</span><span id="293f" class="ld kb hi me b fi mm mj l mk ml">danielandres@baremetal-jump-server:~$</span></pre><p id="295c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">或者:</strong></p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="0ad6" class="ld kb hi me b fi mi mj l mk ml">[root@your-bms-server ~]# ~.</span><span id="2348" class="ld kb hi me b fi mm mj l mk ml">danielandres@baremetal-jump-server:~$</span></pre><p id="1dbf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，<strong class="io hj">在跳转服务器</strong>中，克隆BMS-toolkit项目并运行check-swlib.sh实用程序，以确保所有Oracle安装文件都可以在GCS bucket中访问，并准备好供工具包用来安装和修补Oracle数据库(用您用来放置安装文件的bucket替换check-swlib.sh命令中的<strong class="io hj"> BUCKET </strong>)。</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="cb99" class="ld kb hi me b fi mi mj l mk ml">danielandres@baremetal-jump-server:~$ sudo apt install git</span><span id="7650" class="ld kb hi me b fi mm mj l mk ml">danielandres@baremetal-jump-server:~$ git clone <a class="ae jk" href="https://github.com/google/bms-toolkit" rel="noopener ugc nofollow" target="_blank">https://github.com/google/bms-toolkit</a></span><span id="84fb" class="ld kb hi me b fi mm mj l mk ml">Cloning into ‘bms-toolkit’…<br/>remote: Enumerating objects: 31, done.<br/>remote: Counting objects: 100% (31/31), done.<br/>remote: Compressing objects: 100% (24/24), done.<br/>remote: Total 2010 (delta 9), reused 11 (delta 3), pack-reused 1979<br/>Receiving objects: 100% (2010/2010), 828.43 KiB | 0 bytes/s, done.<br/>Resolving deltas: 100% (790/790), done.<br/></span><span id="8c06" class="ld kb hi me b fi mm mj l mk ml">danielandres@baremetal-jump-server:~$ cd bms-toolkit/</span><span id="d74d" class="ld kb hi me b fi mm mj l mk ml">danielandres@baremetal-jump-server:~/bms-toolkit$</span><span id="1b10" class="ld kb hi me b fi mm mj l mk ml">danielandres@baremetal-jump-server:~/bms-toolkit$ ./check-swlib.sh — ora-swlib-bucket gs://[BUCKET]</span><span id="8c8b" class="ld kb hi me b fi mm mj l mk ml">Running with parameters from command line or environment variables:<br/>ORA_SWLIB_BUCKET=gs://[BUCKET]<br/>ORA_VERSION=19.3.0.0.0</span><span id="0f68" class="ld kb hi me b fi mm mj l mk ml">Found V982063–01.zip : Oracle Database 19.3.0.0.0 for Linux x86–64</span><span id="366b" class="ld kb hi me b fi mm mj l mk ml">file size matches (3059705302), md5 matches (1858bd0d281c60f4ddabd87b1c214a4f).</span><span id="b276" class="ld kb hi me b fi mm mj l mk ml">Found V982068–01.zip : Oracle Grid Infrastructure 19.3.0.0.0 for Linux x86–64</span><span id="894a" class="ld kb hi me b fi mm mj l mk ml">file size matches (2889184573), md5 matches (b7c4c66f801f92d14faa0d791ccda721).</span><span id="4cf6" class="ld kb hi me b fi mm mj l mk ml">Found p29859737_190000_Linux-x86–64.zip : Oracle 19c DB RU patch 29859737 for Linux x86–64</span><span id="db5f" class="ld kb hi me b fi mm mj l mk ml">file size matches (498214157), md5 matches (3b017f517341df5b35e9fbd90f1f49aa).</span><span id="22e2" class="ld kb hi me b fi mm mj l mk ml">Found p29800658_190000_Linux-x86–64.zip : Oracle 19c GI RU patch 29800658 for Linux x86–64</span><span id="e3dc" class="ld kb hi me b fi mm mj l mk ml">file size matches (1365811472), md5 matches (13c0041a5ea7eb9fad4725d2136da627).</span><span id="621e" class="ld kb hi me b fi mm mj l mk ml">Found p29699097_190000_Linux-x86–64.zip : COMBO OF OJVM RU COMPONENT 19.4.0.0.190716 + GI RU 19.4.0.0.190716</span><span id="0998" class="ld kb hi me b fi mm mj l mk ml">file size matches (1986870968), md5 matches (2206c8a2431eb6fa0c4f7dd5aa7a58b2).</span><span id="6e29" class="ld kb hi me b fi mm mj l mk ml">Found p30133178_190000_Linux-x86–64.zip : COMBO OF OJVM RU COMPONENT 19.5.0.0.191015 GI RU 19.5.0.0.191015</span><span id="0992" class="ld kb hi me b fi mm mj l mk ml">file size matches (2004604850), md5 matches (4189caeae850a7c4191fdd3fa4c0af6a).</span><span id="8df0" class="ld kb hi me b fi mm mj l mk ml">Found p30463609_190000_Linux-x86–64.zip : COMBO OF OJVM RU COMPONENT 19.6.0.0.200114 GI RU 19.6.0.0.200114</span><span id="b04b" class="ld kb hi me b fi mm mj l mk ml">file size matches (2308492999), md5 matches (0b2f7ae16f623e8d26905ae7ba600b06).</span><span id="aeb1" class="ld kb hi me b fi mm mj l mk ml">Found p30783556_190000_Linux-x86–64.zip : COMBO OF OJVM RU COMPONENT 19.7.0.0.200414 + GI RU 19.7.0.0.200414</span><span id="c4da" class="ld kb hi me b fi mm mj l mk ml">file size matches (2606745994), md5 matches (f4f6a311736c61f1aa23b194f97b1ca9).</span><span id="8779" class="ld kb hi me b fi mm mj l mk ml">Found p6880880_190000_Linux-x86–64.zip : OPatch Utility</span><span id="8e2f" class="ld kb hi me b fi mm mj l mk ml">file size matches (118408624), md5 matches (b8e1367997544ab2790c5bcbe65ca805).</span></pre><p id="471d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果上述任何输出失败(找到的文件下的任何输出包含“大小不匹配”或“md5不匹配”)，请不要继续，首先获取包含补丁程序和OPatch实用程序的所有正确的zip文件，用于您正在安装的数据库版本，并相应地将它们放入bucket中，否则安装将失败。有关预期文件和check-swlib.sh实用程序不成功输出的示例，请参考工具包文档。(<a class="ae jk" href="https://github.com/google/bms-toolkit/blob/master/docs/user-guide.md#downloading-and-staging-the-oracle-software" rel="noopener ugc nofollow" target="_blank">https://github . com/Google/BMS-toolkit/blob/master/docs/user-guide . MD #下载并升级oracle软件</a>)</p><h2 id="18a4" class="ld kb hi bd kc le lf lg kg lh li lj kk ix lk ll ko jb lm ln ks jf lo lp kw lq bi translated">5.2)根据步骤4中的LUN磁盘分布配置所需的输入文件。</h2><p id="8056" class="pw-post-body-paragraph im in hi io b ip ky ir is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj hb bi translated">根据裸机实例中的特定磁盘设置，修改BMS工具包提供的data_mounts_config.json和asm_disk_config.json文件，并运行安装程序。工具包使用这些信息在文件系统中安装所需的挂载点，并设置Oracle ASM磁盘组。</p><p id="d7b5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如前所述，我们的BMS服务器运行RHEL，因此我们将在步骤4中确定的选定mpaths分配给Oracle二进制文件和ASM，如下所示:</p><p id="c724" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将使用WWID</p><p id="bc19" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">└─3600a0980383143325a5d4f77506d7956</p><p id="a25f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对于Oracle二进制文件</p><p id="1cf5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">和</p><p id="1db0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">└─3600a0980383143325a5d4f77506d7957</p><p id="753f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对于ASM中的数据磁盘组。</p><p id="1ee8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，我们的data_mounts_config.json和asm_disk_config.json文件将如下所示(注意:如果您请求使用Oracle Linux的BMS服务器，您必须将“blk_device”字段的内容从“/dev/mapper/WWID”替换为“/dev/sdX”，X是磁盘，如sdb、sdc等)，有关磁盘分配的其他信息，请参考工具包<a class="ae jk" href="https://github.com/google/bms-toolkit/blob/master/docs/user-guide.md#data-mount-configuration-file" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="5eea" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您可能希望在data_mounts_config.json文件中为Oracle Diag要使用的单独装载点创建一个附加条目，方法是指向另一个物理磁盘，或者在BMS服务器中可用的某个磁盘中创建带有LVM的附加逻辑卷。还建议将RECO放在单独的物理磁盘或单独的逻辑卷中，并在asm_disk_config.json文件的另一个条目中引用它(为了简单起见，我们在本练习中没有做任何事情)。</p><p id="80b7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用nano或vi编辑文件，使其如下所示:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es ca"><img src="../Images/fc4673c26aaa80e39818874fea4ea7d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XckSCNTCRFPp-Huy-27wHA.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated">在data_mounts_config.json和asm_disk_config.json文件中配置的磁盘分配。</figcaption></figure><h2 id="3121" class="ld kb hi bd kc le lf lg kg lh li lj kk ix lk ll ko jb lm ln ks jf lo lp kw lq bi translated">5.3)将私有SSH密钥从BMS服务器传输到跳转服务器，并执行安装。</h2><p id="7b2c" class="pw-post-body-paragraph im in hi io b ip ky ir is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj hb bi translated">将私有SSH密钥拉至跳转服务器，以便能够对其进行身份验证并用于安装。</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="78d2" class="ld kb hi me b fi mi mj l mk ml">danielandres@baremetal-jump-server:~/bms-toolkit$ scp orainstall@100.64.50.1:/home/orainstall/bms-key ~/bms-toolkit</span><span id="263d" class="ld kb hi me b fi mm mj l mk ml">orainstall@100.64.50.1’s password:</span><span id="4166" class="ld kb hi me b fi mm mj l mk ml">bms-key 100% 1675 823.8KB/s 00:00</span><span id="5624" class="ld kb hi me b fi mm mj l mk ml">danielandres@baremetal-jump-server:~/bms-toolkit$</span></pre><p id="f3af" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，使用您刚刚从BMS服务器获取的私钥测试到BMS服务器的无密码连接。如果成功，将在BMS服务器中使用orainstall用户打开一个ssh会话，而不提示您输入任何密码，然后<strong class="io hj">记得退出并返回跳转服务器来运行安装。</strong></p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="f043" class="ld kb hi me b fi mi mj l mk ml">danielandres@baremetal-jump-server:~/bms-toolkit$ ssh -i bms-key orainstall@100.64.50.1</span><span id="717b" class="ld kb hi me b fi mm mj l mk ml">Last login: Sun Sep 13 05:22:05 2020 from 100.64.170.2</span><span id="b107" class="ld kb hi me b fi mm mj l mk ml">[orainstall@your-bms-server ~]$ exit</span><span id="75fe" class="ld kb hi me b fi mm mj l mk ml">danielandres@baremetal-jump-server:~/bms-toolkit$</span></pre><p id="d79c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，从跳转服务器，使用您的设置所需的参数运行安装脚本。用BMS服务器的实际IP地址替换[BMS-server-IP-address]条目，用安装zip文件所在的GCS中的BUCKET替换[BUCKET]参数。整个安装和配置过程大约需要30-50分钟。确保将ORA_VERSION环境变量导出到正在安装的数据库版本。</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="32ba" class="ld kb hi me b fi mi mj l mk ml">danielandres@baremetal-jump-server:~/bms-toolkit$ export INSTANCE_IP_ADDR=[BMS-server-IP-address]</span><span id="ceb3" class="ld kb hi me b fi mm mj l mk ml">danielandres@baremetal-jump-server:~/bms-toolkit$ export ORA_VERSION=19.3.0.0.0</span><span id="d6c7" class="ld kb hi me b fi mm mj l mk ml">danielandres@baremetal-jump-server:~/bms-toolkit$ export ORA_DB_NAME=PROD1</span><span id="1fab" class="ld kb hi me b fi mm mj l mk ml">danielandres@baremetal-jump-server:~/bms-toolkit$ ./install-oracle.sh --ora-swlib-type gcs --ora-swlib-bucket gs://[BUCKET] --instance-ssh-user orainstall --instance-ssh-key bms-key --ora-edition EE --backup-dest /cvs-volume/rman_backups --ora-reco-diskgroup DATA</span></pre><p id="c3cf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当不同的playgroups按顺序执行时，您应该看到所有的Ansible输出。该过程完成后，您的ASM和数据库将被安装并修补到其最新版本，数据库配置、PDB创建和RMAN备份设置将被执行，您将获得一个功能完整的数据库，网格、Oracle重启和RMAN定时备份将自动执行。</p><p id="c4f6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在我们的例子中，只剩下一个步骤，即撤销我们之前在CVS NFS卷上设置的广泛权限:</p><p id="98a1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">跳转到BMS实例，并更改适当文件夹的权限和所有权。您还可以在那里查看Oracle安装:</p><pre class="ls lt lu lv fd md me mf mg aw mh bi"><span id="d36b" class="ld kb hi me b fi mi mj l mk ml">danielandres@baremetal-jump-server:~/bms-toolkit$ ssh -i bms-key orainstall@100.64.50.1</span><span id="3721" class="ld kb hi me b fi mm mj l mk ml">Last login: Sun Sep 13 05:32:33 2020 from 100.64.170.2</span><span id="9ca8" class="ld kb hi me b fi mm mj l mk ml">[orainstall@your-bms-server ~]$ sudo su</span><span id="6b8a" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]$ chown oracle:asmadmin /cvs-volume/rman_backups</span><span id="4290" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]$ chmod 740 /cvs-volume/rman_backups</span><span id="ed1e" class="ld kb hi me b fi mm mj l mk ml">[root@your-bms-server ~]$ su - grid</span><span id="b234" class="ld kb hi me b fi mm mj l mk ml">[grid@your-bms-server ~]$ asmcmd -P</span><span id="28bd" class="ld kb hi me b fi mm mj l mk ml">ASM&gt; ls</span><span id="5edc" class="ld kb hi me b fi mm mj l mk ml">PROD1</span><span id="85bc" class="ld kb hi me b fi mm mj l mk ml">ASM&gt; ls PROD1</span><span id="32ca" class="ld kb hi me b fi mm mj l mk ml">DATA</span><span id="b0e6" class="ld kb hi me b fi mm mj l mk ml">ASM&gt;cd PROD1/DATA</span><span id="e515" class="ld kb hi me b fi mm mj l mk ml">ASM&gt;</span><span id="e9c1" class="ld kb hi me b fi mm mj l mk ml">[grid@your-bms-server ~]$ exit</span></pre><p id="8ad8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，您可能希望关闭Internet网关机器，以便新提供的数据库不能连接到Internet。</p><p id="c94e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">就是这样！！</p><p id="417b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">瓦拉万·拉贾库马尔和<a class="mx my ge" href="https://medium.com/u/c83442440f33?source=post_page-----47f5ab594821--------------------------------" rel="noopener" target="_blank">丹尼尔·维勒加斯</a></p></div></div>    
</body>
</html>