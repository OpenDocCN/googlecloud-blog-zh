<html>
<head>
<title>Everything you need to know about the Kubernetes Raspberry Pi cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于Kubernetes Raspberry Pi集群您需要知道的一切</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/everything-you-need-to-know-about-the-kubernetes-raspberry-pi-cluster-2a2413bfa0fa?source=collection_archive---------0-----------------------#2016-02-06">https://medium.com/google-cloud/everything-you-need-to-know-about-the-kubernetes-raspberry-pi-cluster-2a2413bfa0fa?source=collection_archive---------0-----------------------#2016-02-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="faa8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">最近更新时间:2017年1月12日</em></p><p id="87c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可能<a class="ae je" rel="noopener" href="/google-cloud/kubernetes-raspberry-pi-cluster-the-story-ace773cf8573#.uuj0tg1jj">听说过或见过Kubernetes树莓派集群</a>。在这篇文章中，我分享了我自己建造并现场演示时学到的一切。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es jf"><img src="../Images/a077b5e77d7e767c875578d16c6e059b.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*D8eku0rpklWXhZAQRyCLHg.png"/></div><figcaption class="jn jo et er es jp jq bd b be z dx translated">Kubernetes树莓Pi cluster由来自Quintor的<a class="ae je" href="https://twitter.com/ArjenWassink" rel="noopener ugc nofollow" target="_blank"> Arjen Wassink </a>制作</figcaption></figure><h2 id="0c5d" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">五金器具</h2><p id="8ed5" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">你可以在<a class="ae je" href="https://twitter.com/ArjenWassink" rel="noopener ugc nofollow" target="_blank"> Arjen Wassink </a>的<a class="ae je" href="http://blog.kubernetes.io/2015/11/creating-a-Raspberry-Pi-cluster-running-Kubernetes-the-shopping-list-Part-1.html" rel="noopener ugc nofollow" target="_blank"> Kubernetes Raspberry Pi集群购物清单</a>中找到你需要的所有零件。</p><p id="d4c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我强烈推荐Arjen的购物清单中列出的ModMyPi stack case，因为尺寸与网络开关和USB电源集线器完美契合。我点的是<a class="ae je" href="http://www.amazon.com/gp/product/B00MYFAAPO" rel="noopener ugc nofollow" target="_blank"> GeauxRobot树莓Pi 2 B 4层狗骨堆</a>因为有一天发货。然而，维度太小，我的集群看起来不太好:(</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es kr"><img src="../Images/411bf3157ca3d63a59fbd7c8722c3efc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8I0Gkth9PusnjvVH0FcjZw.jpeg"/></div></div><figcaption class="jn jo et er es jp jq bd b be z dx translated">我的Kubernetes覆盆子酱——看起来远不如Quintor的好</figcaption></figure><p id="04ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你有3D打印机，你也可以打印一个定制的堆栈案例！<a class="ae je" href="https://twitter.com/hsilomedus" rel="noopener ugc nofollow" target="_blank"> Pance Cavkovski </a> <a class="ae je" href="https://twitter.com/hsilomedus/status/693828254986272769" rel="noopener ugc nofollow" target="_blank">在Twitter </a>和Thingiverse上分享了他的3D设计:</p><div class="kw kx ez fb ky kz"><a href="http://www.thingiverse.com/thing:1307094" rel="noopener  ugc nofollow" target="_blank"><div class="la ab dw"><div class="lb ab lc cl cj ld"><h2 class="bd hj fi z dy le ea eb lf ed ef hh bi translated">RaspberryPi Kubernetes stack by hsilomedus</h2><div class="lg l"><h3 class="bd b fi z dy le ea eb lf ed ef dx translated">层板和带有kubernetes标志的顶部，用于创建RaspberryPi 2堆栈。你需要一套漂亮的2.5毫米的…</h3></div><div class="lh l"><p class="bd b fp z dy le ea eb lf ed ef dx translated">www.thingiverse.com</p></div></div><div class="li l"><div class="lj l lk ll lm li ln jl kz"/></div></div></a></div><p id="5f37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我还建议使用2英尺的电缆，而不是1英尺的电缆，以便于访问。</p><h2 id="ac7b" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">软件</h2><p id="61af" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">Arjen发布了<a class="ae je" href="http://blog.kubernetes.io/2015/12/creating-raspberry-pi-cluster-running.html" rel="noopener ugc nofollow" target="_blank"> Kubernetes Raspberry Pi安装说明</a>——它很容易安装，并且在一个单独的包中。</p><p id="dc65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最近开始用<a class="ae je" href="http://github.com/luxas/kubernetes-on-arm" rel="noopener ugc nofollow" target="_blank"> kubernetes-on-arm </a>项目。它带有预构建的Kubernetes图像，但也允许您构建最新的Kubernetes版本。</p><p id="31c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有很多其他的详细资源，比如<a class="ae je" href="http://www.jinkit.com/k8s-on-rpi/" rel="noopener ugc nofollow" target="_blank">使用ArchLinux和Kubernetes的详细说明</a>、<a class="ae je" href="https://kurtstam.github.io/2015/12/04/How-to-Compile-Kubernetes-for-Raspberry-Pi-ARM.html" rel="noopener ugc nofollow" target="_blank">如何为树莓Pi从零开始编译Kubernetes</a>，以及<a class="ae je" href="https://opensource.com/life/16/2/build-a-kubernetes-cloud-with-raspberry-pi" rel="noopener ugc nofollow" target="_blank">用树莓Pi与Kubernetes进行集群计算</a>。</p><h2 id="0ba6" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">建立工作关系网</h2><p id="685a" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">有许多策略可以将您的集群连接到互联网。我选择了最简单的设置，通过我的MacBook笔记本电脑路由所有流量。</p><p id="5d7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在OS X，您可以启用互联网共享；选择<strong class="ih hj">系统偏好</strong> &gt; <strong class="ih hj">共享</strong>并选择<strong class="ih hj">互联网共享</strong>选项。您应该使用Apple USB以太网适配器来共享从Wi-Fi到电脑的连接。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es lo"><img src="../Images/bb665b20c1c1677c802919e6f0211054.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JavbwKeCdXM9COwaYugbYQ.png"/></div></div></figure><p id="07fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，我需要为每个Raspberry Pi分配一个静态IP地址(尤其是运行Kubernetes master的那个)。我花了几个小时试图解决这个问题。为了节省你的时间，这是使用OS X的技巧！</p><ol class=""><li id="eb4a" class="lp lq hi ih b ii ij im in iq lr iu ls iy lt jc lu lv lw lx bi translated">获取每个Raspberry Pi的以太网网卡MAC地址</li><li id="0c86" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">在OS X，创建一个名为/etc/bootptab的文件</li><li id="2e18" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated">对于每个MAC地址，添加以下内容</li></ol><pre class="jg jh ji jj fd md me mf mg aw mh bi"><span id="c424" class="jr js hi me b fi mi mj l mk ml"># Bootptab file<br/># Section 1 — ignored<br/>%%<br/># Section 2 — used<br/># Hardware types: 1=Ethernet, 6=Wireless<br/># See <a class="ae je" href="http://www.ietf.org/rfc/rfc1700.txt" rel="noopener ugc nofollow" target="_blank">http://www.ietf.org/rfc/rfc1700.txt</a><br/># hostname hwtype hwaddr ipaddr bootfile<br/>rpi1 1 b8:27:eb:5b:0d:0f 192.168.2.101 boot<br/>rpi2 1 b8:27:eb:a1:5f:5a 192.168.2.102 boot<br/>.<br/>.<br/>.<br/>rpiN 1 xx:xx:xx:xx:xx:xx 192.168.2.10x boot</span></pre><p id="79f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您的Raspberry Pi在过去已经收到了DHCP分配的IP地址，您将需要强制释放并刷新新的IP地址。在Raspberry Pi中，运行:</p><pre class="jg jh ji jj fd md me mf mg aw mh bi"><span id="df7e" class="jr js hi me b fi mi mj l mk ml">$ sudo dhclient -r</span></pre><h2 id="0c17" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">出于演示目的，缩短故障检测周期</h2><p id="f7b3" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">在Kubernetes中，<a class="ae je" href="http://kubernetes.io/v1.1/docs/admin/kube-controller-manager.html" rel="noopener ugc nofollow" target="_blank">控制器管理器</a>组件将定期检查节点健康状况，然后在超时后驱逐不健康节点上的pod。有几个命令行参数您应该知道:</p><pre class="jg jh ji jj fd md me mf mg aw mh bi"><span id="6b44" class="jr js hi me b fi mi mj l mk ml"><strong class="me hj">--node-monitor-grace-period=40s</strong>: Amount of time which we allow running Node to be unresponsive before marking it unhealty. Must be N times more than kubelet's nodeStatusUpdateFrequency, where N means number of retries allowed for kubelet to post node status.<br/><strong class="me hj">--node-monitor-period=5s</strong>: The period for syncing NodeStatus in NodeController.<br/><strong class="me hj">--pod-eviction-timeout=5m0s</strong>: The grace period for deleting pods on failed nodes.</span></pre><p id="3117" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了在现场演示中演示Kubernetes如何处理节点故障，我不想等40秒后再将节点标记为不健康，也不想等5分钟后才看到pod被重新调度。因此，在Raspberry Pi上安装Kubernetes之后，我需要更新控制器管理器启动命令行参数。</p><p id="4edc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您使用的是kubernetes-on-arm，那么您可以在主节点上更新<strong class="ih hj">/etc/kubernetes/static-pods/master/master . JSON</strong>。找到<strong class="ih hj">控制器-管理器</strong>的容器配置，更新<strong class="ih hj">命令</strong>属性:</p><pre class="jg jh ji jj fd md me mf mg aw mh bi"><span id="61bf" class="jr js hi me b fi mi mj l mk ml">{<br/>  “name”: “controller-manager”,<br/>  “image”: “kubernetesonarm/hyperkube”,<br/>  “command”: [ “/hyperkube”, “controller-manager”,<br/>    “--master=127.0.0.1:8080”,<br/>    “--v=2”,<br/><strong class="me hj">    “--node-monitor-grace-period=10s”,<br/>    “--pod-eviction-timeout=5s”,</strong><br/>    “--service-account-private-key-file=...",<br/>    “--root-ca-file=...” ],<br/>  “volumeMounts”:[...]<br/>}</span></pre><h2 id="7440" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">基础图像</h2><p id="76bd" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">大多数现有的容器映像都是为x86体系结构构建的。您需要在Raspberry Pi上运行ARM二进制文件/映像。幸运的是，<a class="ae je" href="http://blog.hypriot.com/" rel="noopener ugc nofollow" target="_blank"> Hypriot </a>创建了<a class="ae je" href="https://hub.docker.com/u/hypriot/" rel="noopener ugc nofollow" target="_blank">几个兼容Raspberry Pi的Docker基础映像</a>，你可以用它们来运行用Java、Go、Node、Ruby等语言编写的应用程序。他们也有MySQL和Redis图片。通过搜索包含“<a class="ae je" href="https://hub.docker.com/search/?isAutomated=0&amp;isOfficial=0&amp;page=1&amp;pullCount=0&amp;q=rpi-&amp;starCount=0" rel="noopener ugc nofollow" target="_blank"> rpi- </a>”的图像名称，您可以找到许多其他兼容Raspberry Pi的图像。</p><h2 id="b7e8" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">形象化</h2><p id="2f4c" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">我相信在复杂过程的现场演示中，可视化是非常重要的。为了帮助可视化Kubernete的故障检测和pod重新调度，我使用了最初由Brendan Burns开发的Kubernete可视化工具的版本<a class="ae je" href="https://github.com/saturnism/gcp-live-k8s-visualizer" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es mm"><img src="../Images/b1e2f1df679a157651466f07c91d1176.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HYF6G16wAxOG9D5SKFmGKg.png"/></div></div></figure><p id="6ad4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">visualizer代码及其使用方法在我的GitHub上:</p><div class="kw kx ez fb ky kz"><a href="https://github.com/saturnism/gcp-live-k8s-visualizer" rel="noopener  ugc nofollow" target="_blank"><div class="la ab dw"><div class="lb ab lc cl cj ld"><h2 class="bd hj fi z dy le ea eb lf ed ef hh bi translated">Saturn ism/GCP-live-k8s-可视化工具</h2><div class="lg l"><h3 class="bd b fi z dy le ea eb lf ed ef dx translated">GCP-Live-k8s-visualizer——GCP实时容器引擎演示中使用的Kubernetes可视化工具的源代码</h3></div><div class="lh l"><p class="bd b fp z dy le ea eb lf ed ef dx translated">github.com</p></div></div><div class="li l"><div class="mn l lk ll lm li ln jl kz"/></div></div></a></div><p id="2351" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后但并非最不重要的一点是，从所有节点预拉所有图像以进行响应演示。</p><h2 id="a964" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">巨大的资源</h2><p id="410f" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">有很多人在使用树莓Pi Kubernetes集群。许多人分享了他们正在从事的工作，包括:</p><ul class=""><li id="0bf8" class="lp lq hi ih b ii ij im in iq lr iu ls iy lt jc mo lv lw lx bi translated"><a class="ae je" href="https://github.com/rhuss/ansible-kubernetes-pi3" rel="noopener ugc nofollow" target="_blank">使用可翻译剧本</a></li><li id="261c" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc mo lv lw lx bi translated"><a class="ae je" href="http://larmog.github.io/2016/03/13/elk-cluster-on-kubernetes-on-arm---part-1/" rel="noopener ugc nofollow" target="_blank">奔跑的麋鹿群</a></li><li id="564d" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc mo lv lw lx bi translated"><a class="ae je" href="http://larmog.github.io/2016/02/22/glusterfs-on-kubernetes-arm/" rel="noopener ugc nofollow" target="_blank">运行GlusterFS </a></li><li id="0e2c" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc mo lv lw lx bi translated"><a class="ae je" href="http://a.frtzlr.com/kubernetes-on-raspberry-pi-3-the-missing-troubleshooting-guide/" rel="noopener ugc nofollow" target="_blank">这份遗漏的故障排除指南</a>(你不想错过的调谐参数！2016年8月25日添加)</li><li id="5aa0" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc mo lv lw lx bi translated"><a class="ae je" href="http://kubecloud.io/what-is-kubecloud/" rel="noopener ugc nofollow" target="_blank">kube cloud</a>(2016年8月25日添加的“一个小规模、有形的云计算环境…用于教学和研究目的”)</li><li id="4896" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc mo lv lw lx bi translated"><a class="ae je" href="https://github.com/kodbasen/sloop/" rel="noopener ugc nofollow" target="_blank"> Sloop </a>(貌似最简单的安装Kubernetes 1.3+的方法，我还没机会尝试。添加于2016年8月26日)</li><li id="29ff" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc mo lv lw lx bi translated"><a class="ae je" href="http://larmog.github.io/2016/10/28/installing-kubernetes-on-arm-with-kubeadm/" rel="noopener ugc nofollow" target="_blank">使用Kubeadmn和Weave </a>(这是我迄今为止见过的最简单的方法之一。2017年1月12日补充)</li><li id="a9d3" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc mo lv lw lx bi translated"><a class="ae je" href="http://blog.hypriot.com/post/setup-kubernetes-raspberry-pi-cluster/" rel="noopener ugc nofollow" target="_blank"> Hypriot官方使用kubeadmn和法兰绒的方式</a>(可能是最全面的指南，2017年1月12日补充)</li></ul><h2 id="adae" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">下一步是什么？</h2><p id="44be" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">扩展无状态工作负载很容易。但是，如何使用持久数据来调度工作负载呢？在这个博客系列的下一部分，我将向您展示我如何与LVM和NFS共享一个250GB的SSD作为Kubernetes持久卷。</p><p id="5db2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后但同样重要的是，您也可以在云中运行Kubernetes！运行Kubernetes集群最简单的方法之一是使用<a class="ae je" href="https://cloud.google.com/container-engine/" rel="noopener ugc nofollow" target="_blank">谷歌容器引擎</a>。试试看！</p></div></div>    
</body>
</html>