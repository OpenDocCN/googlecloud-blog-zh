<html>
<head>
<title>Manage Google Compute Engine with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Node.js管理Google计算引擎</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/manage-google-compute-engine-with-node-js-eef8e7a111b4?source=collection_archive---------0-----------------------#2018-05-23">https://medium.com/google-cloud/manage-google-compute-engine-with-node-js-eef8e7a111b4?source=collection_archive---------0-----------------------#2018-05-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="c28e" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">计算引擎的Node.js客户端库简介</h2></div><blockquote class="ix iy iz"><p id="7c4d" class="ja jb jc jd b je jf ij jg jh ji im jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">谷歌<a class="ae jx" href="https://cloud.google.com/compute/" rel="noopener ugc nofollow" target="_blank">计算引擎</a>交付虚拟机(VM)。计算引擎支持从单个实例扩展到负载平衡的全局云计算。</p></blockquote><p id="5a97" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj jy jl jm jn jz jp jq jr ka jt ju jv jw hb bi translated">在<a class="ae jx" href="https://cloud.google.com/compute/" rel="noopener ugc nofollow" target="_blank">计算引擎</a>虚拟机上，您可以安装任何操作系统或软件，并且您可以完全控制防火墙。计算引擎虚拟机就像您的本地工作站，只是它位于云中。您可以根据需要随时轻松扩展到更多或更少的虚拟机。</p><p id="5193" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj jy jl jm jn jz jp jq jr ka jt ju jv jw hb bi translated">开始使用计算引擎最简单的方法是通过<a class="ae jx" href="https://console.cloud.google.com/compute/instances" rel="noopener ugc nofollow" target="_blank">云控制台</a>。您可以在UI中配置和运行虚拟机。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kb"><img src="../Images/754a5673177a12a5ab7495172a0c0105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5xs11ileikWlrhxe-SVapQ.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">在<a class="ae jx" href="https://console.cloud.google.com/compute/instances" rel="noopener ugc nofollow" target="_blank">云控制台</a>中配置计算引擎实例。</figcaption></figure><p id="6c15" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj jy jl jm jn jz jp jq jr ka jt ju jv jw hb bi translated">但是，如果您想要<strong class="jd hj"> </strong>自动化配置和运行虚拟机的过程，该怎么办呢？这就是<a class="ae jx" href="https://cloud.google.com/compute/docs/reference/latest/" rel="noopener ugc nofollow" target="_blank">计算引擎API </a>派上用场的地方。它是一个REST API，用于管理Google云平台上的虚拟机。Node的<code class="du kr ks kt ku b">@google-cloud/compute</code> <a class="ae jx" href="https://github.com/googleapis/nodejs-compute" rel="noopener ugc nofollow" target="_blank">客户端库</a>减少了您需要编写的代码量，使您的应用程序更加健壮。<strong class="jd hj">使用Node以编程方式管理虚拟机非常简单。</strong></p><p id="3741" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj jy jl jm jn jz jp jq jr ka jt ju jv jw hb bi translated">下面的代码片段使用Ubuntu和<code class="du kr ks kt ku b">@google-cloud/compute</code>库创建了一个新的虚拟机。在运行之前，<a class="ae jx" href="https://console.cloud.google.com/apis/library/compute.googleapis.com" rel="noopener ugc nofollow" target="_blank">启用</a>谷歌计算引擎API。<a class="ae jx" href="https://cloud.google.com/docs/authentication/getting-started" rel="noopener ugc nofollow" target="_blank">使用服务帐户</a>设置认证，这样你就可以从本地工作站访问API。</p><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="de37" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj jy jl jm jn jz jp jq jr ka jt ju jv jw hb bi translated">这个最小的代码片段执行以下操作:</p><ul class=""><li id="4b61" class="kx ky hi jd b je jf jh ji jy kz jz la ka lb jw lc ld le lf bi translated">加载客户端库，</li><li id="feda" class="kx ky hi jd b je lg jh lh jy li jz lj ka lk jw lc ld le lf bi translated">创建一个计算机客户端，</li><li id="bc74" class="kx ky hi jd b je lg jh lh jy li jz lj ka lk jw lc ld le lf bi translated">启动虚拟机。</li></ul><p id="7fcb" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj jy jl jm jn jz jp jq jr ka jt ju jv jw hb bi translated">如果你查看<a class="ae jx" href="https://console.cloud.google.com/compute/instances" rel="noopener ugc nofollow" target="_blank">云控制台</a>，你应该会看到一个名为<code class="du kr ks kt ku b">ubuntu-instance</code>的新虚拟机。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ll"><img src="../Images/236e55b5897d2f6c6a7e3b7e32fd682e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ygImUyRQbRnLsiVxdsrSnA.png"/></div></div></figure><h1 id="dc6b" class="lm ln hi bd lo lp lq lr ls lt lu lv lw io lx ip ly ir lz is ma iu mb iv mc md bi translated">带有Node.js服务器的虚拟机</h1><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es me"><img src="../Images/c6657a8c079d14fae22a0c653ee41625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*pKA5RjQCXC2eTz6h_acHyQ.jpeg"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">您可以使用Node管理任何虚拟机，包括运行Node的虚拟机。</figcaption></figure><p id="c675" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj jy jl jm jn jz jp jq jr ka jt ju jv jw hb bi translated">下一个例子更复杂。它创建一个具有HTTP访问的虚拟机，并在启动时安装Node和Node <em class="jc"> Hello World </em>应用程序。将下面的脚本复制到一个名为<code class="du kr ks kt ku b">createVM.js</code>的文件中，并使用<code class="du kr ks kt ku b">npm install @google-cloud/compute &amp;&amp; node createVM.js</code>运行它。</p><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="kv kw l"/></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">复制到一个名为<code class="du kr ks kt ku b">createVM.js</code>的文件，用<code class="du kr ks kt ku b">npm install @google-cloud/compute &amp;&amp; node createVM.js”</code>运行。</figcaption></figure><p id="816a" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj jy jl jm jn jz jp jq jr ka jt ju jv jw hb bi translated">如果一切正常，当您导航到示例脚本记录到终端的IP时，您将看到一个<em class="jc"> Hello World </em>主页。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mf"><img src="../Images/99def76f6004809c032d4ebe73005df9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*qum0pPe2sckEvXuXxLC9Hw.png"/></div></figure><h2 id="1454" class="mg ln hi bd lo mh mi mj ls mk ml mm lw jy mn mo ly jz mp mq ma ka mr ms mc mt bi translated">解决纷争</h2><p id="7c15" class="pw-post-body-paragraph ja jb hi jd b je mu ij jg jh mv im jj jy mw jm jn jz mx jq jr ka my ju jv jw hb bi translated">安装节点<code class="du kr ks kt ku b">git</code>，克隆示例应用程序，并启动服务器大约需要一分钟。如果启动脚本不起作用，可以使用<a class="ae jx" href="https://console.cloud.google.com/compute/instances" rel="noopener ugc nofollow" target="_blank">云控制台</a>登录虚拟机。连接后，查看<code class="du kr ks kt ku b">/var/log/syslog</code>中的日志文件来调试问题。请记住，启动脚本是以root用户身份运行的，其主目录不同于您的默认用户。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mz"><img src="../Images/06e1a5dfdea1564581121e156376a329.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YV5bjXX8HONMC9jw7IwzmQ.jpeg"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">云控制台</figcaption></figure><p id="51e0" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj jy jl jm jn jz jp jq jr ka jt ju jv jw hb bi translated">云控制台还显示了<code class="du kr ks kt ku b">gcloud</code>命令，因此您可以从您的终端<code class="du kr ks kt ku b">gcloud compute --project "PROJECT_ID" ssh --zone "us-central1-a" "vm-with-node-server"</code>进入虚拟机<code class="du kr ks kt ku b">ssh</code>。</p><h1 id="10ee" class="lm ln hi bd lo lp lq lr ls lt lu lv lw io lx ip ly ir lz is ma iu mb iv mc md bi translated">试试看！</h1><p id="9172" class="pw-post-body-paragraph ja jb hi jd b je mu ij jg jh mv im jj jy mw jm jn jz mx jq jr ka my ju jv jw hb bi translated">在<a class="ae jx" href="https://github.com/googleapis/nodejs-compute/tree/master/samples/startup-script" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上有更多的示例代码。克隆存储库并创建和删除带有节点的虚拟机，如自述文件中所述。<strong class="jd hj"/><a class="ae jx" href="https://cloud.google.com/nodejs/docs/reference/compute/latest/" rel="noopener ugc nofollow" target="_blank"><strong class="jd hj">API参考</strong> </a> <strong class="jd hj">解释了更多的方法</strong>。您认为哪一项对管理您的计算引擎虚拟机有用？完成后，不要忘记删除您的虚拟机，这样它们就不会产生费用。</p></div><div class="ab cl na nb gp nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="hb hc hd he hf"><p id="7539" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj jy jl jm jn jz jp jq jr ka jt ju jv jw hb bi translated">关于定价的说明:在撰写本文时，一个<em class="jc">微型</em>计算引擎是<a class="ae jx" href="https://cloud.google.com/free/" rel="noopener ugc nofollow" target="_blank"> GCP自由层</a>的一部分。运行上例中的<em class="jc">标准</em>计算引擎每小时花费不到0.05美元，或者每月25美元。详见<a class="ae jx" href="https://cloud.google.com/pricing/" rel="noopener ugc nofollow" target="_blank">定价</a>。</p></div><div class="ab cl na nb gp nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="hb hc hd he hf"><p id="fe7a" class="pw-post-body-paragraph ja jb hi jd b je jf ij jg jh ji im jj jy jl jm jn jz jp jq jr ka jt ju jv jw hb bi translated">示例代码需要Node 8或更高版本。这些示例是为版本0.10.0的<code class="du kr ks kt ku b">@google-cloud/compute</code>编写的。可以用<code class="du kr ks kt ku b">npm install @google-cloud/compute@0.10.0</code>安装那个具体版本。</p></div></div>    
</body>
</html>