<html>
<head>
<title>Running Node.js on App Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在应用程序引擎上运行Node.js</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/running-node-js-on-app-engine-e49e9bb31d3b?source=collection_archive---------1-----------------------#2015-10-16">https://medium.com/google-cloud/running-node-js-on-app-engine-e49e9bb31d3b?source=collection_archive---------1-----------------------#2015-10-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="766b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这本指南可能有点过时了。现在，App Engine在其标准环境中支持Node。</p><p id="2d0c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请看这里:<a class="ae jk" href="https://cloud.google.com/appengine/docs/nodejs/" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/appengine/docs/nodejs/</a>选择更适合你和你的项目的方式。如果你喜欢灵活的环境，这个指南可能对你有用。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="9434" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当然，任何开发了在<strong class="io hj">应用引擎</strong>(谷歌的PaaS)上运行的项目的人都会发现这样的情况:</p><ul class=""><li id="d15d" class="jl jm hi io b ip iq it iu ix jn jb jo jf jp jj jq jr js jt bi translated"><strong class="io hj">站台</strong>很有意思。</li><li id="d021" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">提供的<strong class="io hj">服务和库</strong>解决了许多常见问题。</li><li id="f10b" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">所需的<strong class="io hj">配置</strong>是<strong class="io hj">最少的</strong>，其余的由谷歌完成。</li><li id="a06c" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">它<strong class="io hj">缩放</strong>的方式很棒。它允许任何请求都不会被忽略，不管请求的数量有多少。</li><li id="dd75" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">以及该产品的许多其他<strong class="io hj">大优点</strong>。</li></ul><p id="78a9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">但是</strong>他/她肯定会发现或想知道如何解决以下任何一个问题:</p><ul class=""><li id="4a25" class="jl jm hi io b ip iq it iu ix jn jb jo jf jp jj jq jr js jt bi translated">使用4种可能语言(Python、Java、Go、PHP)中的一种<strong class="io hj">语言</strong>。</li><li id="09a8" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">安装一个不可用的库。</li><li id="fbcf" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">使用不支持的<strong class="io hj">框架</strong>。</li></ul><p id="8c4d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这两种情况下，解决方案都称为:<strong class="io hj">托管虚拟机</strong>。</p><p id="897c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在本文中，我将介绍<strong class="io hj">托管虚拟机</strong>，然后向您展示如何在App Engine 上使用<strong class="io hj"> Node.js的示例。</strong></p><h2 id="21e2" class="jz ka hi bd kb kc kd ke kf kg kh ki kj ix kk kl km jb kn ko kp jf kq kr ks kt bi translated">那么，什么是托管虚拟机呢？</h2><p id="a582" class="pw-post-body-paragraph im in hi io b ip ku ir is it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj hb bi translated">托管虚拟机是谷歌云服务的一个组成部分，它允许您使用可配置的<strong class="io hj">计算引擎虚拟机</strong>在<strong class="io hj">应用引擎</strong>上运行应用。</p><h2 id="c2ac" class="jz ka hi bd kb kc kd ke kf kg kh ki kj ix kk kl km jb kn ko kp jf kq kr ks kt bi translated">我们实现了什么？</h2><p id="db70" class="pw-post-body-paragraph im in hi io b ip ku ir is it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj hb bi translated">基本上，我们<strong class="io hj">保留了</strong>App Engine的所有优势，并增加了<strong class="io hj">Compute Engine提供的灵活性</strong>。</p><p id="6d23" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们避免了沙盒环境的限制。我们也可以只配置我们应用程序的一些<strong class="io hj">模块</strong>来使用受管理的虚拟机，一切都与<strong class="io hj">容器</strong>技术一起工作。</p><h2 id="7fc1" class="jz ka hi bd kb kc kd ke kf kg kh ki kj ix kk kl km jb kn ko kp jf kq kr ks kt bi translated">如何配置应用程序以使用托管虚拟机？</h2><p id="c8f4" class="pw-post-body-paragraph im in hi io b ip ku ir is it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj hb bi translated">在<strong class="io hj"> app.yaml </strong>文件(描述我们的App Engine配置的文件)中，我们必须修改<strong class="io hj">运行时</strong>参数并添加<strong class="io hj"> vm </strong>参数，如下所示:</p><figure class="la lb lc ld fd le er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es kz"><img src="../Images/5cbe15d771fcda96d6bd9f3eee104618.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CPkOzVVNoPX_tCrJ."/></div></div></figure><p id="8fdf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> vm </strong>参数很简单，表示我们将在App Engine中使用自己的实例。</p><p id="b0df" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">运行时</strong>参数有点复杂。我们可以使用一个<strong class="io hj">标准的</strong>运行时(基于Google提供的可以修改和扩展的环境)，或者一个<strong class="io hj">定制的</strong>运行时，基于一个完全由用户定义的环境。</p><p id="8f3f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在的问题很明显，</p><h2 id="ec15" class="jz ka hi bd kb kc kd ke kf kg kh ki kj ix kk kl km jb kn ko kp jf kq kr ks kt bi translated">我们如何定义一个环境？</h2><p id="dd8e" class="pw-post-body-paragraph im in hi io b ip ku ir is it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj hb bi translated">这里就是我之前提到的<strong class="io hj">容器</strong>出现的地方。</p><p id="3806" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Google Cloud采用的容器技术是<a class="ae jk" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="io hj"> Docker </strong> </a>。Docker可以通过从<strong class="io hj">docker文件</strong>中读取指令来自动构建<strong class="io hj">图像</strong>。Dockerfile是一个文本文档，它包含用户可以在命令行上调用的所有命令来组合一个图像。</p><p id="8c95" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，当我们使用一个<strong class="io hj">定制运行时</strong>时，App Engine将搜索一个<strong class="io hj"> Dockerfile </strong>，在这里我们指定了定义我们环境的所有必要步骤。安装<strong class="io hj">库</strong>、<strong class="io hj">框架</strong>、<strong class="io hj">依赖项</strong>，运行我们的应用程序所需的一切。</p><h2 id="55a5" class="jz ka hi bd kb kc kd ke kf kg kh ki kj ix kk kl km jb kn ko kp jf kq kr ks kt bi translated">把所有的放在一起。最后在App Engine上运行Node.js。</h2><p id="1193" class="pw-post-body-paragraph im in hi io b ip ku ir is it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj hb bi translated">为了<strong class="io hj">说明</strong>使用托管虚拟机执行应用程序，我提议使用hashtag查询最近的tweets，并使用<strong class="io hj"> Node.js </strong>作为服务器技术将它们显示在屏幕上。</p><p id="24c1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我不会深入研究应用程序代码，因为这超出了本文的目的。这是一个基本的节点应用程序，有一些依赖关系。</p><p id="f889" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我要解释的是app.yaml文件内容。</p><p id="bf6a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">T31】app . YAMLT33】</strong></p><p id="c65a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这种情况下，运行时是自定义的，但由Google提供。Google为几个栈提供了<strong class="io hj">基本映像</strong>，其中一个是Node.js，在这里查看:<a class="ae jk" href="https://cloud.google.com/appengine/docs/managed-vms/custom-runtimes#base_images" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/app engine/docs/managed-VMs/custom-runtimes # base _ images</a></p><figure class="la lb lc ld fd le er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es lm"><img src="../Images/faae541885d15e67e1300f4367ded328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DGug_05q22YKgmTE."/></div></div></figure><p id="476f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> <em class="ll"> Dockerfile </em> </strong></p><p id="dc20" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">基本上，使用google提供的一个运行时，我们就不需要编写dockerfile。假设我们的运行时是<strong class="io hj"> nodejs </strong>，我们使用一个<strong class="io hj">预组装dockerfile </strong>用于执行以下任务的节点:</p><ul class=""><li id="6966" class="jl jm hi io b ip iq it iu ix jn jb jo jf jp jj jq jr js jt bi translated"><strong class="io hj">扩展</strong>一个App引擎基础镜像。</li><li id="3422" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated"><strong class="io hj">安装</strong>一些依赖项。</li><li id="5b6d" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated"><strong class="io hj">安装</strong>节点。</li><li id="0013" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated"><strong class="io hj">设置</strong>环境变量。</li><li id="27f3" class="jl jm hi io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated"><strong class="io hj">运行</strong> npm启动。</li></ul><p id="378d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你可以在这里查看:</p><div class="ln lo ez fb lp lq"><a href="https://github.com/GoogleCloudPlatform/nodejs-docker" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hj fi z dy lv ea eb lw ed ef hh bi translated">Google cloud platform/nodejs-docker</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">nodejs的docker - Docker图像</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">github.com</p></div></div><div class="lz l"><div class="ma l mb mc md lz me lj lq"/></div></div></a></div><p id="91c7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">或者在这里看:</p><figure class="la lb lc ld fd le er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es mf"><img src="../Images/21439d924a99ececd6cd0ac724cabea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BR8tUPsWfLfY3gaY."/></div></div><figcaption class="mg mh et er es mi mj bd b be z dx translated">nodejs运行时Dockerfile</figcaption></figure><p id="f12d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">通过app.yaml文件中的唯一更改，我们将App Engine的标准环境更改为支持Node.js的环境</p><h2 id="24f4" class="jz ka hi bd kb kc kd ke kf kg kh ki kj ix kk kl km jb kn ko kp jf kq kr ks kt bi translated">结论</h2><p id="db32" class="pw-post-body-paragraph im in hi io b ip ku ir is it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj hb bi translated"><strong class="io hj">托管虚拟机</strong>允许我们修改在App Engine上运行的应用的<strong class="io hj">基础技术堆栈</strong>，而不会失去在App Engine考虑需求时创建新的不可变实例的可能性。(例如，当它需要扩展时)。</p><p id="4da1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您可以在下面的资源库中看到完整的应用程序代码:</p><div class="ln lo ez fb lp lq"><a href="https://github.com/leopittelli/nodengine" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hj fi z dy lv ea eb lw ed ef hh bi translated">利奥皮泰利/诺丹金</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">在GitHub上创建一个帐户，为nodengine开发做贡献。</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">github.com</p></div></div><div class="lz l"><div class="mk l mb mc md lz me lj lq"/></div></div></a></div><p id="17a8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">有任何问题、反馈或改进，请联系我。</p><div class="ln lo ez fb lp lq"><a href="http://twitter.com/leopittelli" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hj fi z dy lv ea eb lw ed ef hh bi translated">莱昂纳多·皮泰利(@利奥皮泰利)|推特</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">莱昂纳多·皮泰利的最新推文(@利奥皮泰利)。软件工程师。全栈开发者。谷歌开发者…</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">twitter.com</p></div></div><div class="lz l"><div class="ml l mb mc md lz me lj lq"/></div></div></a></div><p id="e0bb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">莱昂纳多·皮泰利。</p></div></div>    
</body>
</html>