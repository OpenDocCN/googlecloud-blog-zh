<html>
<head>
<title>Analyzing AWS Detailed Billing Reports Using BigQuery and ReDash</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用BigQuery和ReDash分析AWS详细计费报告</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/analyzing-aws-detailed-billing-reports-using-bigquery-and-redash-475b5b6ac79e?source=collection_archive---------0-----------------------#2017-01-08">https://medium.com/google-cloud/analyzing-aws-detailed-billing-reports-using-bigquery-and-redash-475b5b6ac79e?source=collection_archive---------0-----------------------#2017-01-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="22cd" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">TL；DR版本。已将AWS详细计费报告加载到BigQuery。通用查询在本报告中可用:<a class="ae jh" href="http://bit.ly/2iu3R6G" rel="noopener ugc nofollow" target="_blank">http://bit.ly/2iu3R6G</a>。发送拉取请求。Redash被用来可视化。</p></blockquote><p id="9b26" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi jl translated"><span class="l jm jn jo bm jp jq jr js jt di">一个</span> WS默认计费和成本管理仪表板已经提供了很多信息。cost explorer允许通过自定义日期范围分析数据，通过选择服务进行分组等。但是如果你知道去哪里找的话，在你的详细账单报告中隐藏着更多更深刻的见解。例如，您发现数据传输成本突然激增。有人控制了你的Jenkins服务器并用它进行比特币挖矿吗？还是一种合法的用法？如何识别哪个资源导致了峰值？通过将详细的账单报告加载到数据库中，只需几个简单的SQL查询就能找到诸如此类的问题的答案。</p><p id="c93e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">在任何给定的时间点，我们为我们的客户管理不少于50个不同规模的AWS账户。看看我们处理的与计费相关的常见问题，我们开始构建定制的仪表盘，使用<a class="ae jh" href="https://redash.io/" rel="noopener ugc nofollow" target="_blank"> ReDash </a>每天更新最新的计费数据。这篇文章解释了如何将一个样本报告加载到BigQuery，并且包含了一些样本查询。</p><p id="fbc8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">AWS计费和使用报告可以直接<a class="ae jh" href="https://aws.amazon.com/blogs/aws/new-upload-aws-cost-usage-reports-to-redshift-and-quicksight/" rel="noopener ugc nofollow" target="_blank">上传到RedShift </a>，然后QuickSight可以可视化它们。为什么不用<a class="ae jh" href="https://aws.amazon.com/athena/" rel="noopener ugc nofollow" target="_blank">雅典娜</a> +快视或者红移+快视？嗯，我已经在其他用例中广泛使用了Athena和RedShift，它们的表现令人惊叹。但是对于这个用例来说，它们似乎不太合适。我会解释原因。</p><p id="0229" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">AWS计费报告是一个CSV文件，根据您选择的时间间隔进行更新。当我使用<a class="ae jh" href="http://docs.aws.amazon.com/athena/latest/ug/csv.html" rel="noopener ugc nofollow" target="_blank"> LazySimpleSerde </a>创建一个指向其中一个计费报告的外部表时，我得到的数据如下所示:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="e41c" class="kd ke hi jz b fi kf kg l kh ki">rateid subscriptionid pricingplanid <br/>"12334317" "232231735" "915879" <br/>"12334331" "232231735" "915879"</span></pre><p id="d42b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">这是有问题的。看来athena在呈现数据时没有去掉引号。这使得合计成本变得困难。有变通办法。在创建外部表之前，您可以使用<code class="du kj kk kl jz b">sed</code>来替换CSV中的双引号，或者您可以编写这样的查询来动态地去除引号，然后聚合<code class="du kj kk kl jz b">SELECT SUM(CAST(REPLACE(blendedcost, '"', '') AS FLOAT)) as TotalCost</code> -但是在遇到一些与转换相关的问题之后，我放弃了Athena。下一个红移——因为它是一个成熟的列数据库，这些都不是问题，但是拥有红移集群会带来一定的管理开销。我不想为了节省成本而每天费力地删除集群并重新创建。所以我选择了BigQuery，这是一种零管理、速度极快的方法，我们只需为存储付费，查询执行期间处理的前1 TB数据是免费的。</p><p id="836f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">好了，让我们一步一步来。</p><h2 id="c7b9" class="kd ke hi bd km kn ko kp kq kr ks kt ku ji kv kw kx jj ky kz la jk lb lc ld le bi translated">入门需要什么？</h2><p id="ff13" class="pw-post-body-paragraph ii ij hi il b im lf io ip iq lg is it ji lh iw ix jj li ja jb jk lj je jf jg hb bi translated">如果您已经到了这一步，我想您已经知道什么是详细的计费报告以及如何启用它们等等。如果您不知道，请访问此<a class="ae jh" href="http://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/billing-reports.html" rel="noopener ugc nofollow" target="_blank">文档页面</a>。您需要以下内容。</p><ul class=""><li id="c388" class="lk ll hi il b im in iq ir ji lm jj ln jk lo jg lp lq lr ls bi translated">访问存储详细计费报告的S3存储区</li><li id="7fef" class="lk ll hi il b im lt iq lu ji lv jj lw jk lx jg lp lq lr ls bi translated">一个谷歌云项目和一个谷歌存储桶。</li><li id="5d94" class="lk ll hi il b im lt iq lu ji lv jj lw jk lx jg lp lq lr ls bi translated">BigQuery已启用。</li><li id="3ac7" class="lk ll hi il b im lt iq lu ji lv jj lw jk lx jg lp lq lr ls bi translated">安装和托管一个小型ec2实例<code class="du kj kk kl jz b">redash</code></li></ul><h2 id="7f1a" class="kd ke hi bd km kn ko kp kq kr ks kt ku ji kv kw kx jj ky kz la jk lb lc ld le bi translated">从S3下载报告并上传到谷歌桶</h2><ul class=""><li id="e3a6" class="lk ll hi il b im lf iq lg ji ly jj lz jk ma jg lp lq lr ls bi translated">创建IAM策略，授予用户对目标S3存储桶的只读访问权限。</li></ul><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="46bb" class="kd ke hi jz b fi kf kg l kh ki">{ "Version": "2012-10-17", "Statement": [ { "Effect": "Allow", "Action": "s3:*", "Resource": "arn:aws:s3:::myBillingBucket/*" } ] }</span></pre><ul class=""><li id="a349" class="lk ll hi il b im in iq ir ji lm jj ln jk lo jg lp lq lr ls bi translated">在运行脚本的虚拟机上设置<code class="du kj kk kl jz b">AWS Cli</code>。</li></ul><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="f2bc" class="kd ke hi jz b fi kf kg l kh ki">pip install awscli</span></pre><ul class=""><li id="57c1" class="lk ll hi il b im in iq ir ji lm jj ln jk lo jg lp lq lr ls bi translated">使用附加了上述只读策略的用户的密钥和访问密钥来配置<code class="du kj kk kl jz b">aws cli</code>。配置<code class="du kj kk kl jz b">aws cli</code>的说明这里是<a class="ae jh" href="http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html" rel="noopener ugc nofollow" target="_blank">这里是</a>。</li><li id="2f65" class="lk ll hi il b im lt iq lu ji lv jj lw jk lx jg lp lq lr ls bi translated">找到最后更新的文件并下载。这个桶可能有多个文件。因为我们只知道基于月份的报告名称变化的最后几个字符，所以我们可以按文件名模式进行grep，排序并查看最后修改的文件。</li></ul><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="ebde" class="kd ke hi jz b fi kf kg l kh ki">aws s3 ls s3://mybillingbucket/ | grep xxxxxxxx6559-aws-billing-detailed-line-items-with-resources-and-tags-* | sort | tail -n 1 | awk '{print $4}'</span></pre><ul class=""><li id="0f78" class="lk ll hi il b im in iq ir ji lm jj ln jk lo jg lp lq lr ls bi translated">将文件复制到本地并解压缩。</li></ul><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="b12f" class="kd ke hi jz b fi kf kg l kh ki">FileName="$(aws s3 ls s3://mybillingbucket/ | grep xxxxxxxx6559-aws-billing-detailed-line-items-with-resources-and-tags-* | sort | tail -n 1 | awk '{print $4}')" <br/>aws s3 cp s3://mybillingbucket/$FileName /bills/client1/$FileName unzip /bills/client1/$FileName -d /bills/client1/</span></pre><ul class=""><li id="a08a" class="lk ll hi il b im in iq ir ji lm jj ln jk lo jg lp lq lr ls bi translated">现在您已经有了最新的账单，您可能想看看您拥有的列，这样您就可以提出在BigQuery中创建表的模式。这些文件往往相对较大，所以使用head来查看这些列。</li></ul><figure class="ju jv jw jx fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mb"><img src="../Images/27e26f74859a14d14f980200989959ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iovpZ8jQedtLQIdl.png"/></div></div></figure><ul class=""><li id="bca6" class="lk ll hi il b im in iq ir ji lm jj ln jk lo jg lp lq lr ls bi translated">将这些记录在文本文件中。这可用于在第一次创建表时创建模式定义。</li><li id="aefb" class="lk ll hi il b im lt iq lu ji lv jj lw jk lx jg lp lq lr ls bi translated">BigQuery可以从云存储桶中加载gzipped CSV文件。为了加快上传速度，并确保您不会为AWS VM的数据输出付出太多成本，请gzip文件。我们的<code class="du kj kk kl jz b">FileName</code>一般会长得像<code class="du kj kk kl jz b">something.csv.zip</code>。解压后，我们需要修改我们的文件名，去掉最后4个字符<code class="du kj kk kl jz b">.zip</code></li></ul><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="67c0" class="kd ke hi jz b fi kf kg l kh ki">FileNameCSV=${FileName::-4} gzip &lt; /bills/client1/$FileNameCSV &gt; /bills/client1/$FileNameCSV.gz</span></pre><ul class=""><li id="b377" class="lk ll hi il b im in iq ir ji lm jj ln jk lo jg lp lq lr ls bi translated">接下来，设置Google Cloud命令行工具来与存储和bigquery交互。查看<a class="ae jh" href="https://cloud.google.com/sdk/docs/" rel="noopener ugc nofollow" target="_blank">文档</a>了解详细步骤。</li><li id="8b55" class="lk ll hi il b im lt iq lu ji lv jj lw jk lx jg lp lq lr ls bi translated">我假设您已经创建了一个google cloud bucket并配置了命令行实用程序。将gzipped文件上传到目标google cloud bucket。</li></ul><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="5b35" class="kd ke hi jz b fi kf kg l kh ki">gsutil cp /bills/client1/$FileNameCSV.gz gs://powertracker/client1/$FileNameCSV.gz</span></pre><h2 id="fd0c" class="kd ke hi bd km kn ko kp kq kr ks kt ku ji kv kw kx jj ky kz la jk lb lc ld le bi translated">创建BigQuery数据集并加载数据</h2><ul class=""><li id="e794" class="lk ll hi il b im lf iq lg ji ly jj lz jk ma jg lp lq lr ls bi translated">安装Google Cloud SDK还将负责BigQuery的命令行实用程序<code class="du kj kk kl jz b">bq</code>。</li><li id="b9e4" class="lk ll hi il b im lt iq lu ji lv jj lw jk lx jg lp lq lr ls bi translated">从UI或使用命令行实用程序创建一个BigQuery数据集(有点像数据库)。这里有一个<a class="ae jh" href="https://cloud.google.com/bigquery/quickstart-web-ui" rel="noopener ugc nofollow" target="_blank">快速入门</a>可以帮助你。</li><li id="9ff7" class="lk ll hi il b im lt iq lu ji lv jj lw jk lx jg lp lq lr ls bi translated">如果您还记得在上一节中，我们将模式定义保存在一个文本文件中。这将派上用场了。使用csv中的列创建一个json模式文件，并将其用作模式定义文件来创建表。一个示例模式定义文件如下所示:</li></ul><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="c918" class="kd ke hi jz b fi kf kg l kh ki">[ {"name": "InvoiceID", "type": "string", "mode": "nullable"}, {"name": "PayerAccountId", "type": "string", "mode": "nullable"}, {"name": "LinkedAccountId", "type": "string", "mode": "nullable"}, {"name": "RecordType", "type": "string", "mode": "nullable"}, {"name": "RecordId", "type": "string", "mode": "nullable"}, {"name": "ProductName", "type": "string", "mode": "nullable"}, {"name": "RateId", "type": "string", "mode": "nullable"}, {"name": "SubscriptionId", "type": "string", "mode": "nullable"}, {"name": "PricingPlanId", "type": "string", "mode": "nullable"}, {"name": "UsageType", "type": "string", "mode": "nullable"}, {"name": "Operation", "type": "string", "mode": "nullable"}, {"name": "AvailabilityZone", "type": "string", "mode": "nullable"}, {"name": "ReservedInstance", "type": "string", "mode": "nullable"}, {"name": "ItemDescription", "type": "string", "mode": "nullable"}, {"name": "UsageStartDate", "type": "string", "mode": "nullable"}, {"name": "UsageEndDate", "type": "string", "mode": "nullable"}, {"name": "UsageQuantity", "type": "string", "mode": "nullable"}, {"name": "BlendedRate", "type": "string", "mode": "nullable"}, {"name": "BlendedCost", "type": "string", "mode": "nullable"}, {"name": "UnBlendedRate", "type": "string", "mode": "nullable"}, {"name": "UnBlendedCost", "type": "string", "mode": "nullable"}, {"name": "ResourceId", "type": "string", "mode": "nullable"}, {"name": "user_CostCenter", "type": "string", "mode": "nullable"}, {"name": "user_Department", "type": "string", "mode": "nullable"}, {"name": "user_Owner", "type": "string", "mode": "nullable"}, {"name": "user_Stack", "type": "string", "mode": "nullable"} ]</span></pre><ul class=""><li id="9f4d" class="lk ll hi il b im in iq ir ji lm jj ln jk lo jg lp lq lr ls bi translated">根据您启用的成本分配标签，文件中的列数可能会有所不同。如果您注意到上面的模式，所有以<code class="du kj kk kl jz b">user_</code>开头的列都是来自这个特定帐户的标签。我还选择所有数据类型为string，因为我想避免加载失败，而且BigQuery已经相当完整地完成了转换。</li><li id="b88d" class="lk ll hi il b im lt iq lu ji lv jj lw jk lx jg lp lq lr ls bi translated">接下来，将数据加载到您的表中。在下面的命令中，<code class="du kj kk kl jz b">powertracker</code>是我的数据集(数据库)，目标表的名称是<code class="du kj kk kl jz b">powertracker.client1</code>。我们上面生成的文件</li></ul><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="e87c" class="kd ke hi jz b fi kf kg l kh ki">bq load --schema=/bills/client1schema.json powertracker.client1 gs://powertracker/client1/$FileNameCSV.gz</span></pre><ul class=""><li id="94ce" class="lk ll hi il b im in iq ir ji lm jj ln jk lo jg lp lq lr ls bi translated">请注意，当您将所有这些步骤转换成脚本时，bq加载可能会第二次失败，因为名为<code class="du kj kk kl jz b">client1</code>的表在昨天的加载中已经存在。所以你需要做的就是，<code class="du kj kk kl jz b">bq rm powertracker.client1</code>然后运行load命令。</li><li id="5cd6" class="lk ll hi il b im lt iq lu ji lv jj lw jk lx jg lp lq lr ls bi translated">就像Amazon Athena一样，BigQuery也可以通过外部表对存储在Google云存储上的文件进行查询。我尝试过这样做，但是我决定继续加载数据，而不是使用联邦表。我认为，当创建为联邦表时，每个查询的整个文件都得到了处理(我使用的是gzipped target，它可能与普通CSV的行为不同，我还没有测试它)。外部表没有利用BigQuery的列特性，与加载数据时相比，它们要慢一些。</li></ul><h2 id="73ad" class="kd ke hi bd km kn ko kp kq kr ks kt ku ji kv kw kx jj ky kz la jk lb lc ld le bi translated">查询、见解和ReDash</h2><p id="289e" class="pw-post-body-paragraph ii ij hi il b im lf io ip iq lg is it ji lh iw ix jj li ja jb jk lj je jf jg hb bi translated">现在我们有了每天通过Google云存储桶从S3向BigQuery加载数据的流程，现在是激动人心的时候了。运行查询并获得洞察力。我在github上用我想到的一些通用查询创建了一个公共repo。随意派生和发送拉取请求。<a class="ae jh" href="https://github.com/powerupcloud/AWSBilling-BigQuery" rel="noopener ugc nofollow" target="_blank">这里是回购</a>。</p><p id="c26d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">比方说，我想找出数据输出成本突然激增的原因。我首先需要确定哪些使用类型是可用的，这样我就可以根据它进行筛选。如果您做一个<code class="du kj kk kl jz b">SELECT DISTINCT usagetype</code>，您会注意到大多数与数据输出相关的usagetypes有一些共同点——单词“Out-Bytes ”,所以这里是查询。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="7a8a" class="kd ke hi jz b fi kf kg l kh ki">#If using legacy SQL, change FLOAT64 to FLOAT. <br/>SELECT SUM(CAST(blendedcost AS FLOAT64)) AS Cost, resourceid <br/>FROM powertracker.client1 <br/>WHERE usagetype LIKE '%Out-Bytes%' <br/>GROUP BY resourceid <br/>ORDER BY Cost DESC</span></pre><figure class="ju jv jw jx fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mj"><img src="../Images/960588246fe2b9c4e8a1d0cf0d228800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*J-_oVgzB7pA6aGoW.png"/></div></div></figure><p id="b560" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">嘭，只花了4秒钟。现在，我确切地知道哪些服务器/CloudFront发行版/elb负责数据输出成本，包括它们的resourceids。</p><p id="ee5b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">接下来，如果我想知道哪个内部服务/标签占了账单的大部分，这里是查询。我们需要确保InvoiceTotal、StatementTotal等被排除在合计之外，否则您将得到误导性的数字。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="218b" class="kd ke hi jz b fi kf kg l kh ki">SELECT SUM(CAST(blendedcost AS FLOAT)) AS Cost, <br/>user_costcenter, <br/>user_department, <br/>user_owner, <br/>user_stack <br/>FROM powertracker.client1 <br/>WHERE RecordType NOT IN ('InvoiceTotal', 'StatementTotal', 'Rounding') <br/>GROUP BY 2, 3, 4, 5 <br/>ORDER BY Cost DESC;</span></pre><figure class="ju jv jw jx fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mk"><img src="../Images/c389fb58c816d98d3c393ff2b625f178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*A72mTmIyXJ_T8MWG.png"/></div></div></figure><p id="52e3" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">如果我想通过内部服务/标签查找某一天的费用，该怎么办？这很简单。我们开始吧:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="8a63" class="kd ke hi jz b fi kf kg l kh ki">SELECT SUM(CAST(blendedcost AS FLOAT)) AS Cost, <br/>user_department <br/>FROM powertracker.client <br/>WHERE DATE(TIMESTAMP(usagestartdate)) = '2017-01-01' <br/>GROUP BY user_department, <br/>ORDER BY Cost DESC;</span></pre><figure class="ju jv jw jx fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es ml"><img src="../Images/96b38def29a929558413db2e5ee89c2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hXi2tDje-v-m0PnD.png"/></div></div></figure><p id="8db6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">这仅仅是皮毛。一旦BigQuery上的数据可用，您还可以做更多的事情。继续下去，看看github repo中的所有查询，然后玩一玩。如果您发现更多有助于获得更多见解的查询，请发送一个拉取请求:)</p><p id="6065" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">那么ReDash在哪里呢？一旦您设置了每日负载并编写了一些查询——如果您可以可视化它，那不是很棒吗？ReDash可以与BigQuery对话，它允许创建多个仪表板，并对一组人启用访问控制。</p><p id="6e0a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">设置redash轻而易举。只需提供一台Ubuntu机器，并获得这个<a class="ae jh" href="https://raw.githubusercontent.com/getredash/redash/master/setup/ubuntu/bootstrap.sh" rel="noopener ugc nofollow" target="_blank">安装脚本</a>。运行它。搞定了。</p><p id="1487" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">连接到ReDash并配置您的数据源</p><figure class="ju jv jw jx fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mm"><img src="../Images/f832593f18c3090c7de2f035c095592a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QJt3pMMfbd45vzub.png"/></div></div></figure><p id="d8b3" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">转到Google Cloud Console，IAM&amp;Admin页面，然后创建一个服务帐户，redash将使用该帐户连接到BigQuery</p><figure class="ju jv jw jx fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mn"><img src="../Images/8aca8ad328b5adc5cb7de41a67372c0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EGRh_ynM2ZbcaNv2.png"/></div></div></figure><p id="5b7e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">应该下载一个JSON密匙。返回ReDash数据源配置页面并上传密钥。就是这样。现在，您可以在ReDash上打开一个新的查询窗口并测试查询。</p><figure class="ju jv jw jx fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mo"><img src="../Images/5cb19e69143ec565cb5c99da52c7418a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FNvxTv7ilxvuZoEF.png"/></div></div></figure><p id="798b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">在接下来的系列文章中，我将讲述如何使用redash创建有用的仪表板，加载AWS使用报告和计费报告，并将所有这些整合为一个统一的仪表板。</p><p id="a794" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated">同时，我希望你觉得这是有用的。快乐的成本分析！:)</p></div><div class="ab cl mp mq gp mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="hb hc hd he hf"><p id="47ad" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ji iv iw ix jj iz ja jb jk jd je jf jg hb bi translated"><em class="ik">原载于2017年1月8日</em><a class="ae jh" href="http://blog.powerupcloud.com/2017/01/08/analyzing-aws-detailed-billing-reports-using-bigquery/" rel="noopener ugc nofollow" target="_blank"><em class="ik">【blog.powerupcloud.com】</em></a><em class="ik">。</em></p></div></div>    
</body>
</html>