<html>
<head>
<title>Create Google Groups via Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Terraform创建谷歌群组</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/create-google-groups-via-terraform-de99524f92e0?source=collection_archive---------0-----------------------#2021-04-09">https://medium.com/google-cloud/create-google-groups-via-terraform-de99524f92e0?source=collection_archive---------0-----------------------#2021-04-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/2539124ea5fd1e9d33734f831e360bf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FbIhf0A_u96ZGLm9ckC74A.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">" Becris从www.flaticon.com制作的图标"</figcaption></figure><div class=""/><p id="9ff3" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你想通过Terraform创建谷歌群，请继续阅读！</p><h1 id="b425" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">什么是谷歌集团？</strong></h1><p id="2f86" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">Google Group是Google用户帐户和服务帐户的命名集合。每个谷歌群组都有一个与该群组相关联的唯一电子邮件地址。Google Groups基本上是一组Google帐户，出于管理目的，需要将它们组合在一起。</p><h1 id="1113" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">为什么使用谷歌群组？</h1><p id="f5fe" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">作为最佳实践，建议使用Google Groups来组织您的GCP组织中的用户和服务帐户，这种方式可以将访问权限授予一组用户和服务帐户，而不是单独授予每个用户/服务帐户，从而降低访问管理的复杂性，并遵循最低权限原则<strong class="iw hy"/>。</p><h1 id="42b8" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">创建Google群组的两种方法</h1><h2 id="c663" class="kv jt hx bd ju kw kx ky jy kz la lb kc jf lc ld kg jj le lf kk jn lg lh ko li bi translated"><strong class="ak"> 1。基于团队结构的分组</strong></h2><p id="8ccd" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">基于团队结构创建小组。团队结构是相对静态的，同一团队的成员通常有相同的数据访问需求。向组中添加新的团队成员将立即为该成员提供所需的所有必要的数据访问。当团队成员离开团队时，很容易将此人从团队中移除，这将取消此人对所有相关数据的访问权。</p><h2 id="6b82" class="kv jt hx bd ju kw kx ky jy kz la lb kc jf lc ld kg jj le lf kk jn lg lh ko li bi translated">2.基于项目倡议的分组</h2><p id="6d77" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">基于临时项目计划创建小组。这是一种更加动态的分组策略，对于一组人需要在有限的时间内访问一些数据的情况，这种策略尤其有用。在项目开始时，为参与计划的人创建一个小组。项目完成后，解散该组以撤销所有成员的访问权限，从而避免任何潜在的泄漏访问问题。</p><h1 id="3104" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">如何通过Terraform创建谷歌群？</h1><h2 id="40bd" class="kv jt hx bd ju kw kx ky jy kz la lb kc jf lc ld kg jj le lf kk jn lg lh ko li bi translated"><strong class="ak">第一步:创建一个有权限的服务账户</strong></h2><p id="6c98" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">服务帐户应具有以下Google Cloud IAM角色:</p><ul class=""><li id="e89e" class="lj lk hx iw b ix iy jb jc jf ll jj lm jn ln jr lo lp lq lr bi translated">服务使用消费者:<code class="du ls lt lu lv b">roles/serviceusage.serviceUsageConsumer</code>在计费项目上</li><li id="8294" class="lj lk hx iw b ix lw jb lx jf ly jj lz jn ma jr lo lp lq lr bi translated">组织查看器:<code class="du ls lt lu lv b">roles/resourcemanager.organizationViewer</code>如果使用域名而不是<code class="du ls lt lu lv b">customer_id</code></li></ul><h2 id="2b3a" class="kv jt hx bd ju kw kx ky jy kz la lb kc jf lc ld kg jj le lf kk jn lg lh ko li bi translated"><strong class="ak">步骤2:将组管理员角色分配给服务帐户</strong></h2><p id="f7b2" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">Google Groups是一种组织级别的资源，服务帐户需要成为<strong class="iw hy"> Google Groups Admin </strong>才能创建Google Groups并管理用户/服务帐户在该组中的添加和删除。</p><p id="7095" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要使服务帐户成为组管理员，您必须拥有您的域的Google Workspace(以前称为G Suite)超级管理员访问权限。如果您不是Google Workspace管理员，您将需要一个Google Workspace管理员来为步骤1中创建的服务帐户分配<a class="ae mb" href="https://support.google.com/a/answer/2405986?hl=en" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hy"> Google Groups管理员角色</strong> </a>。</p><p id="fa34" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使用以下步骤将服务帐户转换为Google Groups管理员角色:</p><p id="00d5" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在浏览器中，访问https://admin.google.com/<a class="ae mb" href="https://admin.google.com/" rel="noopener ugc nofollow" target="_blank">并使用您的凭证登录。你应该看到下面的屏幕，点击“管理员角色”。</a></p><figure class="md me mf mg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mc"><img src="../Images/40bd1933395a72499f9340317ab09ad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9iPH1WGkjkdHWaaH"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated"><strong class="bd ju">谷歌管理控制台</strong></figcaption></figure><p id="cd77" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你将看到下面的屏幕，点击“组管理”。</p><figure class="md me mf mg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mc"><img src="../Images/23db8553c6ee69e68e377f62639877ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nkxFBirPIDE-NNCY"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated"><strong class="bd ju">管理角色</strong></figcaption></figure><p id="a19c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后，您将看到组管理页面。在“管理员”选项卡下，您可以看到“分配用户”和“分配服务帐户”。单击“分配服务帐户”。</p><figure class="md me mf mg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mc"><img src="../Images/3ffc3d547da6c41bef5f64c7fab4a271.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*J6aflQtfGDN2hHa7"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated"><strong class="bd ju">群组管理页面</strong></figcaption></figure><p id="453c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您将看到下面的屏幕，在这里您需要添加服务帐户。输入在步骤1中创建的服务帐户电子邮件地址。</p><figure class="md me mf mg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mc"><img src="../Images/aa067d727e03eac25d958af2e1447002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vEvRtYgPMm90qjHZ"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated"><strong class="bd ju">将服务帐户添加为组管理员</strong></figcaption></figure><p id="0380" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">点击“添加”。</p><p id="28d9" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">最后，点击“分配角色”。</p><p id="40c2" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您应该能够在组管理页面中看到服务帐户。</p><figure class="md me mf mg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mh"><img src="../Images/af999384881ee1cc502412fac6a087bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_N6SsvVdHOpzfqpI"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated"><strong class="bd ju">群组管理页面</strong></figcaption></figure><h2 id="152e" class="kv jt hx bd ju kw kx ky jy kz la lb kc jf lc ld kg jj le lf kk jn lg lh ko li bi translated"><strong class="ak">步骤3:使用服务帐户进行身份验证</strong></h2><p id="5ec4" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">您将需要<a class="ae mb" href="https://cloud.google.com/sdk/docs/downloads-interactive" rel="noopener ugc nofollow" target="_blank"> gcloud SDK </a>来运行下面提到的gcloud命令。此外，请记住这是出于测试/开发目的，您应该按照组织中的设置来执行身份验证步骤。</p><p id="e5ac" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy">步骤3.1 </strong> <a class="ae mb" href="https://cloud.google.com/sdk/gcloud/reference/iam/service-accounts/keys/create" rel="noopener ugc nofollow" target="_blank">为服务账户创建JSON密钥:</a></p><p id="50a5" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">以下命令将为您的服务帐户创建一个JSON密钥，该密钥需要用于身份验证，</p><pre class="md me mf mg fd mi lv mj mk aw ml bi"><span id="8f97" class="kv jt hx lv b fi mm mn l mo mp">gcloud iam service-accounts keys create key.json --iam-account=my-iam-account@my-project.iam.gserviceaccount.com</span></pre><p id="67f1" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy">步骤3.2 </strong> <a class="ae mb" href="https://cloud.google.com/sdk/gcloud/reference/auth/activate-service-account" rel="noopener ugc nofollow" target="_blank">使用创建的JSON密钥认证服务帐户:</a></p><p id="80af" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使用上面创建的JSON密钥通过以下方式进行身份验证，</p><pre class="md me mf mg fd mi lv mj mk aw ml bi"><span id="c560" class="kv jt hx lv b fi mm mn l mo mp">gcloud auth activate-service-account my-iam-account@my-project.iam.gserviceaccount.com --key-file=key.json</span></pre><h2 id="0830" class="kv jt hx bd ju kw kx ky jy kz la lb kc jf lc ld kg jj le lf kk jn lg lh ko li bi translated"><strong class="ak">第四步:为Google Groups编写Terraform配置</strong></h2><p id="d2e4" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">以下Terraform配置基于此处维护的<a class="ae mb" href="https://github.com/terraform-google-modules/terraform-google-group" rel="noopener ugc nofollow" target="_blank">terra form Google Group模块。</a></p><p id="2dea" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下面是一个main.tf示例:</p><pre class="md me mf mg fd mi lv mj mk aw ml bi"><span id="6dac" class="kv jt hx lv b fi mm mn l mo mp">main.tf --&gt;</span><span id="a437" class="kv jt hx lv b fi mq mn l mo mp">provider "google-beta" {<br/>  billing_project       = var.project_id<br/>  user_project_override = true<br/>}</span><span id="807d" class="kv jt hx lv b fi mq mn l mo mp">module "group" {<br/>  source  = "terraform-google-modules/group/google"<br/>  version = "~&gt; 0.1"<br/>  <br/>  id           = var.group_id<br/>  display_name = var.name<br/>  description  = "Test Google Group via Terraform"<br/>  domain       = "domain.com"<br/>  owners       = var.owners<br/>  managers     = var.managers<br/>  members      = var.members<br/>}</span></pre><p id="61e8" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">以下是用于提供输入的示例variables.tf:</p><pre class="md me mf mg fd mi lv mj mk aw ml bi"><span id="1a3c" class="kv jt hx lv b fi mm mn l mo mp">variables.tf --&gt;</span><span id="a8c8" class="kv jt hx lv b fi mq mn l mo mp">variable "project_id" {<br/>  type        = string<br/>  default     = "my-project"<br/>  description = "Project ID for billing"<br/>}</span><span id="9069" class="kv jt hx lv b fi mq mn l mo mp">variable "group_id" {<br/>  type        = string<br/>  default     = "group-id.groups@domain.com"<br/>  description = "Group ID of the Group"<br/>}</span><span id="f5bc" class="kv jt hx lv b fi mq mn l mo mp">variable "name" {<br/>  type        = string<br/>  default     = "google-group-name"<br/>  description = "Name of the Group"<br/>}</span><span id="47ff" class="kv jt hx lv b fi mq mn l mo mp">variable "owners" {<br/>  type        = list(string)<br/>  default     = ["admin@domain.com"]<br/>  description = "Owner of the Group"<br/>}</span><span id="fe8e" class="kv jt hx lv b fi mq mn l mo mp">variable "managers" {<br/>  type        = list(string)<br/>  default     = ["manager@domain.com"]<br/>  description = "Manager of the Group"<br/>}</span><span id="1871" class="kv jt hx lv b fi mq mn l mo mp">variable "members" {<br/>  type        = list(string)<br/>  default     = ["member-one@domain.com", "member-two@domain.com"]<br/>  description = "Members of the Group"<br/>}</span></pre><p id="7c49" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您需要根据您的要求定制Terraform配置。对Terraform配置满意后，运行以下命令，通过Terraform创建您的第一个Google Group:</p><pre class="md me mf mg fd mi lv mj mk aw ml bi"><span id="a3d3" class="kv jt hx lv b fi mm mn l mo mp">terraform init<br/>terraform plan<br/>terraform apply</span></pre><p id="e171" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一旦<code class="du ls lt lu lv b">terraform apply</code>成功完成，您的Google群组就创建好了！</p><p id="ec21" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">可以在https://groups.google.com查看和管理谷歌群组。如果需要，组管理员、经理和成员可以管理和验证通过UI创建的组。</p><figure class="md me mf mg fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mr"><img src="../Images/f13b234d7b17510c36f2628f7a06202d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qEf4tgMyXtadVuoPiswbmw.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">Google群组视图</figcaption></figure><p id="3813" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">希望这篇文章能帮助你通过Terraform为你的组织自动创建谷歌群！</p></div></div>    
</body>
</html>