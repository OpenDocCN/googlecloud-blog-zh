<html>
<head>
<title>Export BigQuery to Google Datastore with Apache Beam/Google Dataflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Apache Beam/Google数据流将BigQuery导出到Google数据存储</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/export-bigquery-to-google-datastore-with-apache-beam-google-dataflow-7fff1566f345?source=collection_archive---------0-----------------------#2017-09-17">https://medium.com/google-cloud/export-bigquery-to-google-datastore-with-apache-beam-google-dataflow-7fff1566f345?source=collection_archive---------0-----------------------#2017-09-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f332" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果可以将BigQuery表导出到Google Datastore，而不考虑它的模式，会怎么样？我知道每次都要做一些把大数据数据仓库转移到分布式KVS的功能，比如把数据从Apache Hive转移到Apache Cassandra或者从BigQuery转移到Google Datastore，总是很烦人的。如果我们有这样的功能，我们就能够更随意地传输数据。</p><p id="4284" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在Google Dataflow上用Apache Beam做了一个从BigQuery到Google Dataflow的导出器，没有考虑表模式。它自动解析BigQuery表的表模式，然后将它们调整到Google Datastore数据类型。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/8cfe97f6de1a56f32c966d280f21b9f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i_QzEPGKOF8rXKN498gReQ.png"/></div></div></figure><h1 id="390a" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">GitHub知识库</h1><p id="9e0a" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">这是我创建的将BigQuery表导出到Google Datastore的存储库。</p><div class="ks kt ez fb ku kv"><a href="https://github.com/yu-iskw/bigquery-to-datastore" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab dw"><div class="kx ab ky cl cj kz"><h2 class="bd hj fi z dy la ea eb lb ed ef hh bi translated">Yu-iskw/大查询到数据存储</h2><div class="lc l"><h3 class="bd b fi z dy la ea eb lb ed ef dx translated">bigquery-to-Datastore——使用Apache Beam/Google数据流将整个big query表导出到Google Datastore</h3></div><div class="ld l"><p class="bd b fp z dy la ea eb lb ed ef dx translated">github.com</p></div></div></div></a></div><h1 id="3668" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">用于数据分析的大查询</h1><p id="99b1" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">从一个过去维护Apache Hadoop和Apache Hive的人来说，BigQuery的便利性是惊人的。有些事情压倒性地超过了雇用数据工程师和基础设施工程师，不仅在处理速度方面，而且在稳定性和成本方面。最近我觉得很多公司都开始把BigQuery放在分析平台的中心。</p><p id="ee32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过使用SQL实现大规模数据操作，我们向许多人以及熟悉“大数据”的工程师打开了分析Web规模数据的大门。</p><h1 id="e2a5" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">数据存储的BigQuery</h1><p id="3059" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">通过降低BigQuery流插入的价格，它也非常适合作为“存储”结构化数据的地方。例如，您可以将日志从服务器发送到Google Pu / Sub，使用Google Dataflow / Apache Beam的流应用程序提取数据，并流式传输到BigQuery。换句话说，BigQuery可以作为日志收集的地方。通过将它存储在BigQuery中，可以通过执行查询立即进行分析，这是很有吸引力的。</p><h1 id="d108" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">数据产品的BigQuery</h1><p id="4938" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">传统上，为了创建数据产品，需要使用Apache Hadoop MapReduce和Apache Spark等大规模数据的框架来创建应用程序。但毕竟它在获取、处理和存储数据方面没有改变。提高难度的原因是我们处理的数据量很大。我为如何处理大量数据以及如何存储大量数据而烦恼。这种开发的困难在于不断地落后于制作数据产品的想法，拖延发布的时间。</p><p id="1591" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同样在团队开发方面，很难采用一个能做出专用大规模数据产品的工程师。维护一个适当维护大规模数据产品的系统并不容易，人力成本也随之增加。</p><p id="4488" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如前所述，BigQuery的优势在于可以在SQL中操作大型数据。<br/>如果您可以将BigQuery汇总结果存储在一个新表中，并轻松地将该表导出到分布式KVS(如Google Datastore)中，会怎么样？BigQuery不仅使大规模数据分析民主化，还大大降低了数据产品的准入门槛。光用SQL就可以做很多事情，BigQuery也支持UDF，所以我会把它扩展到SQL甚至更广。</p><h1 id="baa0" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">如何使用</h1><p id="e54a" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">这是一个将BigQuery表<code class="du le lf lg lh b">test_dataset.test_table</code>导出到Google Datastore种类<code class="du le lf lg lh b">TestKind</code>的例子，它的父类是<code class="du le lf lg lh b">KEY('Parent1', 'p1', 'Parent2', 'p2')</code>，名称空间是<code class="du le lf lg lh b">test_namespace</code>。我们还可以指定一个BigQuery列作为Google Datastore键。其中，关键字列为<code class="du le lf lg lh b">uuid</code>。</p><pre class="je jf jg jh fd li lh lj lk aw ll bi"><span id="3c57" class="lm jq hi lh b fi ln lo l lp lq">./bigquery-to-datastore.sh \<br/>  --project=${GCP_PROJECT_ID} \<br/>  --runner=DataflowRunner \<br/>  --inputBigQueryDataset=test_dataset \<br/>  --inputBigQueryTable=test_table \<br/>  --outputDatastoreNamespace=test_namespace \<br/>  --outputDatastoreKind=TestKind \<br/>  --parentPaths=Parent1:p1,Parent2:p2 \<br/>  --keyColumn=uuid \<br/>  --tempLocation=gs://test_yu/test-log/ \<br/>  --gcpTempLocation=gs://test_yu/test-log/</span></pre><p id="3067" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想知道更多细节，请查看github上的文档。</p><h1 id="e201" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">BigQuery和Google Datastore之间的类型转换</h1><p id="0c0a" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">下表描述了BigQuery和Google Datastore之间的类型转换。不幸的是，由于数据存储没有任何时间数据类型，<code class="du le lf lg lh b">bigquery-to-datastore</code>忽略数据类型为<code class="du le lf lg lh b">TIME</code>的BigQuery列。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lr"><img src="../Images/9d9d4e3d9467a8578267359a11e9df8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D06NVe7QqTm14f3Fj91SNA.png"/></div></div></figure><h1 id="20d9" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="3acf" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">我将BigQuery描述为不仅是一个数据分析平台，还是数据产品的起点。基本上，我是依靠Google云平台做这个配置的，因为我不想从根本上维护数据库的平台。当然，您可以采用在SQL中处理大数据的方法，创建一个新表，并将其存储在分布式KVS(如HBase和Cassandra)中。本文主要关注拥有bigquery-to-datastore这样的工具的意义。</p></div></div>    
</body>
</html>