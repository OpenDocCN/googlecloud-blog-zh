<html>
<head>
<title>Hiding Columns in Google BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Google BigQuery中隐藏列</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/managing-fine-grained-data-access-control-in-bigquery-293660f0db91?source=collection_archive---------1-----------------------#2020-08-07">https://medium.com/google-cloud/managing-fine-grained-data-access-control-in-bigquery-293660f0db91?source=collection_archive---------1-----------------------#2020-08-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="4109" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">管理敏感数据的细粒度数据访问控制</h2></div><p id="be65" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">BigQuery使用策略标记提供对列的细粒度访问。当用户试图在查询时访问受限列时，BigQuery会检查列策略标记及其策略，以查看用户是否有权访问数据。以下步骤概述了在BigQuery中管理数据访问控制的实现策略:<br/> ■ <strong class="iz hj">步骤1: </strong>为管理员和应用程序用户定义数据目录角色<br/> ■ <strong class="iz hj">步骤2: </strong>定义数据目录分类和策略标签<br/> ■ <strong class="iz hj">步骤3: </strong>对BigQuery列应用列级安全性<br/> ■ <strong class="iz hj">步骤4: </strong>使用列级安全性验证数据访问</p><h2 id="7670" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">身份和访问管理(IAM)角色</h2><p id="a6e2" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">应用列级安全性需要多个IAM角色。BigQuery列级安全性需要以下数据目录角色:</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es kt"><img src="../Images/10b19a309491f59904d49920950966d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9gpoTq9KitARVYaY5qSkrg.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">数据目录角色</figcaption></figure><h2 id="bed9" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">创建业务分类</h2><p id="fa5a" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">数据目录分类法用于创建策略标记的分层组，以控制BigQuery中的列访问。创建数据目录分类和策略标记需要以下步骤:<br/> <strong class="iz hj"> 1 .</strong>打开数据目录<br/> <strong class="iz hj"> 2。</strong>导航到“策略标记”并单击“创建和管理策略标记”<br/> <strong class="iz hj"> 3。</strong>点击<br/>创建<strong class="iz hj"> 4。</strong>输入分类名称(例如:业务分类)和描述<br/> <strong class="iz hj"> 5。</strong>选择项目名称和位置<br/>和<strong class="iz hj"> 6。</strong>输入策略标签名称和描述<br/> <strong class="iz hj"> 7。</strong>单击“添加子策略标签”添加子策略标签(如果需要)</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lj"><img src="../Images/69591f69b8a1ff5b00b86d865d126295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o0Ssl2sghKXKV9jlQ_BMyQ.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">策略标签</figcaption></figure><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lk"><img src="../Images/5248f240674d515c6e5b9edad54b181c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X6Vr7TKzgZTnWwwrkD1law.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">启用访问控制</figcaption></figure><h2 id="2450" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">没有列级安全性的数据访问</h2><p id="4a06" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">没有列级安全性的数据访问允许不受任何限制地访问所有列。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ll"><img src="../Images/973c002cc393ceade6c740cd34636142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B4_Z5fRMFoz_CREwxu_taw.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">大查询模式(无访问控制)</figcaption></figure><pre class="ku kv kw kx fd lm ln lo lp aw lq bi"><span id="aad7" class="jt ju hi ln b fi lr ls l lt lu">$ bq query --use_legacy_sql=false '<strong class="ln hj">select * from bq_poc.employee</strong>'</span><span id="e7c8" class="jt ju hi ln b fi lv ls l lt lu">+-------+--------+--------+--------+<br/>| empno | ename  | salary | deptno |<br/>+-------+--------+--------+--------+<br/>|  7782 | CLARK  |   2450 |     10 |<br/>|  7654 | MARTIN |   1250 |     30 |<br/>|  7566 | JONES  |   2975 |     20 |<br/>+-------+--------+--------+--------+</span></pre><h2 id="9ecf" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">对BigQuery列应用列级安全性</h2><p id="8bcd" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">在BigQuery中，列级安全性是通过策略标记在列上实现的。因此，只有授权用户才能访问受限列，其他用户可以访问其余列。使用以下步骤将策略标签添加到列中:<br/> <strong class="iz hj"> 1 .</strong>打开BigQuery <br/> <strong class="iz hj"> 2。</strong>点击表(例:员工)<br/> <strong class="iz hj"> 3。</strong>在【模式】选项卡下，点击【编辑模式】<br/> <strong class="iz hj"> 4。</strong>选择一列(例如:工资)并点击【添加政策标签】<br/> <strong class="iz hj"> 5。</strong>在“添加策略标签”屏幕中，选择策略标签(例如:受限)</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lw"><img src="../Images/25582929ef775488d5421429d1464c56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*07TiwCHIPq6vHIf2ovIKbA.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">列上的策略标记</figcaption></figure><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lw"><img src="../Images/7d7f55b4356bf0740b2c6aee3bfcb14f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9c25V4i3MsNkbQnfyisHJg.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">大查询模式(带访问控制)</figcaption></figure><h2 id="ef35" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">具有列级安全性的数据访问</h2><p id="bc2f" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">在此示例中，SELECT *命令失败，因为在列(salary)上添加了列级安全性，并且用户没有访问受限列的“数据目录细粒度读者”角色。</p><pre class="ku kv kw kx fd lm ln lo lp aw lq bi"><span id="d674" class="jt ju hi ln b fi lr ls l lt lu">$ bq query --use_legacy_sql=false '<strong class="ln hj">select * from bq_poc.employee</strong>'</span><span id="67c7" class="jt ju hi ln b fi lv ls l lt lu">BigQuery error in query operation: Error processing job 'data-lab:bqjob_r22cdf84d6fe1d46f_00000173c98b3a33_1': <strong class="ln hj">Access Denied</strong>: BigQuery BigQuery: User does not have permission to access policy tag "Business Taxonomy : Restricted" on column bq_poc.employee.<strong class="ln hj">salary</strong>.</span></pre><p id="67ca" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">修改查询以排除用户不能访问但可以访问其余列的列(salary)。现在，查询已成功执行。</p><pre class="ku kv kw kx fd lm ln lo lp aw lq bi"><span id="b955" class="jt ju hi ln b fi lr ls l lt lu">$ bq query --use_legacy_sql=false \<br/>     'select * <strong class="ln hj">EXCEPT (salary)</strong> from bq_poc.employee'</span><span id="545b" class="jt ju hi ln b fi lv ls l lt lu">+-------+--------+--------+<br/>| empno | ename  | deptno |<br/>+-------+--------+--------+<br/>|  7782 | CLARK  |     10 |<br/>|  7654 | MARTIN |     30 |<br/>|  7566 | JONES  |     20 |<br/>+-------+--------+--------+</span></pre><h2 id="85f0" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">结论</h2><p id="1c08" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">数据访问控制是组织保护敏感数据不可或缺的一部分，限制未经授权的用户访问列数据有助于建立信任和安全合规性。</p></div></div>    
</body>
</html>