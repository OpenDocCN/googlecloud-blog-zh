<html>
<head>
<title>Continuous Delivery in Google Cloud Platform — Cloud Build with App Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google云平台中的持续交付—使用应用引擎的云构建</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/continuous-delivery-in-google-cloud-platform-cloud-build-with-app-engine-8355d3a11ff5?source=collection_archive---------1-----------------------#2018-11-04">https://medium.com/google-cloud/continuous-delivery-in-google-cloud-platform-cloud-build-with-app-engine-8355d3a11ff5?source=collection_archive---------1-----------------------#2018-11-04</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><p id="b51c" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">敏捷和DevOps继续在IT项目中传播——我要说:以我们从未见过的速度！随着对这些事情兴趣的增加，使得交付更好的软件成为可能的过程和工具的集合也增加了。</p><figure class="jf jg jh ji fe jj es et paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="es et je"><img src="../Images/3e98d2a945f48d0fa7e16546e7fc6a70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AJ4dhpLUbSNuuyiliK9wxg.png"/></div></div></figure><p id="c073" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">在软件开发生命周期的末尾是<strong class="ii hk">交付</strong>“阶段”。而如果交付不快，整个敏捷开发过程就可能被打破。现代软件应该被设计成使用合适的自动化工具快速交付。在这种背景下，我将写关于在<a class="ae jq" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>中的持续交付。这是一个由3篇文章组成的系列，涵盖了应用引擎、<a class="ae jq" rel="noopener" href="/google-cloud/continuous-delivery-in-google-cloud-platform-cloud-build-with-compute-engine-a95bf4fd1821">计算引擎</a>和<a class="ae jq" rel="noopener" href="/google-cloud/continuous-delivery-in-google-cloud-platform-cloud-run-with-kubernetes-engine-49b73577ef0f"> Kubernetes引擎</a>的部署。</p><p id="ba5c" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">从GCP完全托管的无服务器应用平台<a class="ae jq" href="https://cloud.google.com/appengine/" rel="noopener ugc nofollow" target="_blank"> App Engine </a>开始，我将展示建立<strong class="ii hk">开发+自动化构建+持续交付</strong>管道的步骤。为了保持实用性，我们将创建一个简单的前端应用程序，并将其部署到App Engine标准环境中。<em class="jr">请记住，我们将专注于交付，而不是应用开发本身</em>。</p><blockquote class="js jt ju"><p id="507e" class="ig ih jr ii b ij ik il im in io ip iq jv is it iu jw iw ix iy jx ja jb jc jd hc bi translated"><strong class="ii hk">在继续之前，如果您希望运行示例，请确保您已经创建了一个GCP项目，并在您的机器上安装了</strong><a class="ae jq" href="https://cloud.google.com/sdk/install" rel="noopener ugc nofollow" target="_blank"><strong class="ii hk">Google Cloud SDK</strong></a><strong class="ii hk">。不要忘记运行</strong> <code class="dv jy jz ka kb b"><strong class="ii hk">gcloud auth login</strong></code> <strong class="ii hk">和</strong> <code class="dv jy jz ka kb b"><strong class="ii hk">gcloud config set project &lt;your-project-id&gt;</strong></code> <strong class="ii hk">来正确使用gcloud CLI。</strong></p></blockquote><p id="d437" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">创建前端web应用程序的一个简单方法是使用Angular CLI。安装该工具的步骤超出了本文的范围，可以在这里找到<a class="ae jq" href="https://cli.angular.io/" rel="noopener ugc nofollow" target="_blank"/>。安装完成后，转到您喜欢的文件夹并输入<code class="dv jy jz ka kb b">ng new &lt;app-name&gt;</code>。等待几秒钟。创建好应用后，输入<code class="dv jy jz ka kb b">cd &lt;app-name&gt;</code>和<code class="dv jy jz ka kb b">ng serve</code>。将浏览器指向<code class="dv jy jz ka kb b">http://localhost:4200</code>，确保应用程序正在运行。由于我们有一个完全运行的应用程序，我们在这里停止开发；).是时候考虑分娩了！</p><p id="b881" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">Angular app由HTML、CSS、JS、图片和其他web相关的静态文件组成。因此，我们现在需要做的是构建应用程序，并将其部署到HTTP服务器上，以供用户使用。为了构建Angular应用程序，我们运行<code class="dv jy jz ka kb b">&lt;app-name&gt;</code>文件夹中的<code class="dv jy jz ka kb b">npm install</code>和<code class="dv jy jz ka kb b">npm run build --prod</code>。然后，Angular CLI创建一个新的<code class="dv jy jz ka kb b">dist</code>文件夹，在其中放置准备部署的内容。我们可以想出很多方法将这些文件复制到web服务器上，但是沿着这条路走下去，我们会增加构建过程的复杂性，你不同意吗？由于我们渴望简单和自动化，而不是复杂和手动任务，我们将学习如何使用<a class="ae jq" href="https://cloud.google.com/cloud-build/" rel="noopener ugc nofollow" target="_blank">云构建</a>。</p><p id="4881" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">Cloud Build是Google Cloud Platform完全托管的服务，让您可以快速构建跨所有语言的软件，依靠容器来完成工作。话虽如此，让我们准备使用云构建的项目。将名为<code class="dv jy jz ka kb b">cloudbuild.yaml</code>的文件添加到项目的根文件夹中，内容如下:</p><figure class="jf jg jh ji fe jj"><div class="bz dz l di"><div class="kc kd l"/></div></figure><p id="5f91" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">这个简单的文件指导Cloud Build如何构建和部署应用程序，类似于Docker的多阶段构建。当我们使用命令<code class="dv jy jz ka kb b">gcloud builds submit --config cloudbuild.yaml .</code>调用Cloud Build时，它将压缩项目的源文件(一个<code class="dv jy jz ka kb b">.gitignore</code>文件，如果存在，将被考虑以确定哪些文件应该被跳过)，并将tarball复制到一个托管的<a class="ae jq" href="https://cloud.google.com/storage/" rel="noopener ugc nofollow" target="_blank">云存储</a>桶。<em class="jr">发生在你的开发机器上</em>。</p><p id="6b3e" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">然后，在GCP服务器上运行，Cloud Build将解压缩源代码，并在Cloud Build内置映像<code class="dv jy jz ka kb b">gcr.io/cloud-builders/npm</code>的容器中执行<code class="dv jy jz ka kb b">npm install</code>。第二步将使用另一个<em class="jr"> npm </em>容器来运行<code class="dv jy jz ka kb b">npm run build --prod</code>。第三个将运行另一个云构建的内置映像的容器，名为<code class="dv jy jz ka kb b">gcr.io/cloud-builders/gcloud</code>，以执行一个<code class="dv jy jz ka kb b">gcloud app deploy</code>命令。</p><p id="17fd" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">我已经讲了第一步和第二步，但没有讲第三步，<code class="dv jy jz ka kb b">gcloud app deploy</code>，所以让我来做。该命令负责将构建的内容部署到App Engine，并完成整个交付过程。为了成功，它需要在项目的根文件夹中有一个<code class="dv jy jz ka kb b">app.yaml</code>文件(参见下面的示例内容)，<code class="dv jy jz ka kb b">&lt;your-project-number&gt;@cloudbuild.gserviceaccount.com</code>服务帐户必须具有<strong class="ii hk">应用引擎管理</strong>角色，并且必须为将要部署应用的GCP项目启用<strong class="ii hk">应用引擎管理API </strong>。这一步取代了将构建的文件复制到HTTP服务器(前面提到过),而是将它们复制到GAE Python 2.7标准环境，在那里它们可以作为静态内容。</p><figure class="jf jg jh ji fe jj"><div class="bz dz l di"><div class="kc kd l"/></div></figure><p id="0f4b" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">将浏览器指向<code class="dv jy jz ka kb b">https://&lt;your-project-id&gt;.appspot.com</code>或点击云控制台中的服务名称，查看应用引擎上运行的应用！另外，访问<code class="dv jy jz ka kb b">https://console.cloud.google.com/cloud-build/builds?project=&lt;your-project-id&gt;</code>来检查你的项目的构建历史。</p><figure class="jf jg jh ji fe jj es et paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="es et ke"><img src="../Images/0dc8ecce7ecc6ba182df96019b2ee9d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XZ_8x5V3rlm-uFFaLnKJ5Q.png"/></div></div><figcaption class="kf kg eu es et kh ki bd b be z dy translated">应用引擎服务页面(云控制台&gt;计算&gt;应用引擎&gt;服务)</figcaption></figure><p id="3400" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">好了，现在我们有了一个<strong class="ii hk">几乎全自动的</strong>部署流程。</p><blockquote class="js jt ju"><p id="5d36" class="ig ih jr ii b ij ik il im in io ip iq jv is it iu jw iw ix iy jx ja jb jc jd hc bi translated">—嘿，里卡多，你说的“几乎全自动”是什么意思？</p><p id="c267" class="ig ih jr ii b ij ik il im in io ip iq jv is it iu jw iw ix iy jx ja jb jc jd hc bi translated">—我的意思是GCP可以帮助我们做得更好:)</p></blockquote><p id="888a" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">我们已经看到了云构建如何与云存储和应用引擎进行互操作，但是还缺少一块:<a class="ae jq" href="https://cloud.google.com/source-repositories/" rel="noopener ugc nofollow" target="_blank">源存储库</a>。</p><p id="f687" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">Git现在被广泛用作一个源代码控制管理工具。源存储库允许您使用GCP作为Git远程存储库，或者从Github或Bitbucket自动镜像存储库。访问<code class="dv jy jz ka kb b">https://console.cloud.google.com/code/develop/repo?project=&lt;your-project-id&gt;</code>，点击<em class="jr">创建存储库，</em>并按照步骤操作——这非常简单。</p><p id="e819" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">一旦存储库被设置，导航到云构建的触发器页面:<code class="dv jy jz ka kb b">https://console.cloud.google.com/cloud-build/triggers?project=&lt;your-project-id&gt;</code>。点击<em class="jr">添加触发器</em>，选择一个源，一个存储库，继续进行触发器设置。给触发器命名，比如说<code class="dv jy jz ka kb b">Push to master branch</code>，选择<code class="dv jy jz ka kb b">Branch</code>作为<strong class="ii hk">触发器类型</strong>，选择<code class="dv jy jz ka kb b">master</code>作为<strong class="ii hk">分支(regex) </strong>，选择<code class="dv jy jz ka kb b">cloudbuild.yaml</code>作为<strong class="ii hk">构建配置</strong>。为<strong class="ii hk"> cloudbuild.yaml位置</strong>键入<code class="dv jy jz ka kb b">/cloudbuild.yaml</code>并保存。开始了。每当一个新的提交被推送到master时，就会自动触发构建过程。我们不再需要手动执行<code class="dv jy jz ka kb b">gcloud builds submit …</code>来开始构建。部署<strong class="ii hk">过程现在完全自动化了！</strong></p><figure class="jf jg jh ji fe jj es et paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="es et kj"><img src="../Images/7393a194e2aab5fa836a575a4a651331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CB2Mfgx70Oh1odOw_5dhhA.png"/></div></div></figure><p id="83ae" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">本文描述的步骤可以用来或定制来部署Google云平台的App Engine <strong class="ii hk">标准</strong>环境支持的任何种类的应用。<a class="ae jq" href="https://github.com/ricardolsmendes/gcp-cloudbuild-gae-flex-angular" rel="noopener ugc nofollow" target="_blank">部署到<strong class="ii hk">灵活</strong>的环境需要改变文件夹的结构</a>。</p><p id="0f91" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">Github上提供了示例代码:<a class="ae jq" href="https://github.com/ricardolsmendes/gcp-cloudbuild-gae-angular" rel="noopener ugc nofollow" target="_blank">https://Github . com/ricardolsmendes/GCP-cloud build-gae-angular</a>。随便叉一下玩玩。</p><p id="2826" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">部署愉快:)</p></div><div class="ab cl kk kl gq km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hc hd he hf hg"><h1 id="7893" class="kr ks hj bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">更新</h1><p id="ba9b" class="pw-post-body-paragraph ig ih hj ii b ij lp il im in lq ip iq ir lr it iu iv ls ix iy iz lt jb jc jd hc bi translated">2019–08–04:我创建了一个GitHub存储库来演示如何对App Engine灵活的环境进行类似的部署。详情请参见<a class="ae jq" href="https://github.com/ricardolsmendes/" rel="noopener ugc nofollow" target="_blank">GCP-cloud build-gae-flex-angular</a>。</p></div><div class="ab cl kk kl gq km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hc hd he hf hg"><p id="ad29" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">这是关于谷歌云平台中<strong class="ii hk">持续交付的3篇文章系列的第1篇:</strong></p><p id="e7d8" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated"><strong class="ii hk"> App引擎</strong> | <a class="ae jq" rel="noopener" href="/google-cloud/continuous-delivery-in-google-cloud-platform-cloud-build-with-compute-engine-a95bf4fd1821">计算引擎</a> | <a class="ae jq" rel="noopener" href="/google-cloud/continuous-delivery-in-google-cloud-platform-cloud-run-with-kubernetes-engine-49b73577ef0f"> Kubernetes引擎</a></p></div></div>    
</body>
</html>