<html>
<head>
<title>Helidon MP on Google Kubernetes Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Helidon议员对谷歌Kubernetes引擎</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/helidon-mp-on-google-kubernetes-engine-3e68396378b4?source=collection_archive---------0-----------------------#2018-09-20">https://medium.com/google-cloud/helidon-mp-on-google-kubernetes-engine-3e68396378b4?source=collection_archive---------0-----------------------#2018-09-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="2835" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">你看马，没有<a class="ae jd" href="https://twitter.com/Caged/status/1039937162769096704/photo/1" rel="noopener ugc nofollow" target="_blank"> * </a>，没有库贝克！</h1><p id="94dd" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">凭借多年来在生产中运行Kubernetes的经验，谷歌现在提供了<a class="ae jd" href="https://cloud.google.com/kubernetes-engine/" rel="noopener ugc nofollow" target="_blank"> GKE </a> (Kubernetes引擎)，这是一个完全托管的环境，使开发者能够使用打包成容器的几乎任何工具和框架。</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es kc"><img src="../Images/aca85c5b449f7913ae155cf8278b3115.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dltcb6j94M1_BI_XeG-osg.png"/></div></div></figure><p id="525f" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">对于Java开发人员来说，这提供了一个使用轻量级框架的机会，比如新发布的<a class="ae jd" href="http://helidon.io" rel="noopener ugc nofollow" target="_blank"> Helidon </a>，特别是它的Microprofile风格(但实际上，以下步骤适用于许多类似的框架，不管使用什么语言)。</p><p id="7cce" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">让我们从一些Maven脚手架开始(在我的例子中使用<a class="ae jd" href="https://cloud.google.com/shell/" rel="noopener ugc nofollow" target="_blank">云外壳</a>，因为它带有所有正确的<a class="ae jd" href="https://helidon.io/docs/latest/#/getting-started/01_prerequisites" rel="noopener ugc nofollow" target="_blank">先决条件</a>):</p><pre class="kd ke kf kg fd kt ku kv kw aw kx bi"><span id="d4c4" class="ky ig hi ku b fi kz la l lb lc">$ mvn archetype:generate -DinteractiveMode=false \<br/>    -DarchetypeGroupId=io.helidon.archetypes \<br/>    -DarchetypeArtifactId=helidon-quickstart-mp \<br/>    -DarchetypeVersion=0.9.1 \<br/>    -DgroupId=io.helidon.examples \<br/>    -DartifactId=quickstart-mp \<br/>    -Dpackage=io.helidon.examples.quickstart.mp</span></pre><p id="bbb9" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">为了确保生成的示例应用程序正常工作，让我们构建、对接应用程序，并在本地测试它:</p><pre class="kd ke kf kg fd kt ku kv kw aw kx bi"><span id="ef4a" class="ky ig hi ku b fi kz la l lb lc">$ cd quickstart-mp<br/>$ mvn package<br/>$ docker build -t quickstart-mp target<br/>$ docker run — rm -p 8080:8080 quickstart-mp:latest</span></pre><p id="a5b9" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated"><em class="ld">(或者，在容器化Java应用程序时，您可以使用</em><a class="ae jd" href="https://github.com/GoogleContainerTools/jib" rel="noopener ugc nofollow" target="_blank"><em class="ld">jib</em></a><em class="ld">)</em></p><p id="387d" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">此时，您可以在另一个窗口中使用curl进行测试，或者使用Cloud Shell的预览功能:</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div class="er es le"><img src="../Images/c1a6117ce2e60c5712e435b547eeab9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:422/0*y29n0TvjhuoW5cXj"/></div></figure><figure class="kd ke kf kg fd kh er es paragraph-image"><div class="er es lf"><img src="../Images/6b8ea38a1b6c63413d291631c4aaad09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/0*YbRFy-AIEfYG80ga"/></div><figcaption class="lg lh et er es li lj bd b be z dx translated">(确保附加/问候到URL)</figcaption></figure><p id="acbf" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">我们现在准备标记图像，并将其推送到<a class="ae jd" href="https://cloud.google.com/container-registry/" rel="noopener ugc nofollow" target="_blank"> Google Cloud Registry </a>:</p><pre class="kd ke kf kg fd kt ku kv kw aw kx bi"><span id="d97e" class="ky ig hi ku b fi kz la l lb lc">$ gcloud auth configure-docker<br/>$ docker tag quickstart-mp eu.gcr.io/<strong class="ku hj"><em class="ld">my-gcp-project</em></strong>/quickstart-mp<br/>$ docker push eu.gcr.io/<strong class="ku hj"><em class="ld">my-gcp-project</em></strong>/quickstart-mp</span></pre><p id="0e68" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated"><em class="ld">(注意我这里用的是欧洲注册表。还要确保在上面的URI中使用你自己的项目名称)</em></p><p id="4348" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">是时候将映像部署到正在运行的GKE集群了！从您的GCP控制台，导航到<em class="ld"> Kubernetes引擎&gt;集群</em>并选择“部署容器”。没错，不需要预先配置集群。当然，您可以部署到现有的集群中。</p><p id="4509" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">只需使用“<em class="ld">选择谷歌容器注册表图像</em>，选择我们刚刚推送的图像:</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div class="er es lk"><img src="../Images/6ece8994c51293c8c36b55a676148835.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/0*pj4Z-JEWXadhI-tr"/></div></figure><p id="8bdb" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">…并给这个应用程序起个名字(“<em class="ld"> hello-helidon </em>听起来是个合理的选择)。</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div class="er es ll"><img src="../Images/671fac26179c5a975eadc73e0bc56ddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/0*D-EMboFfUWtXJ3Cn"/></div></figure><p id="e1a0" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">为您的GKE集群选择一个位置(如果您喜欢，可以查看YAML，您不必亲自编写) :</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div class="er es lm"><img src="../Images/8e83279aa8864d7826e51f9134822a07.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/0*OY3zUUbXBR3q5cix"/></div></figure><p id="2fc8" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated"><em class="ld">(同样，我选择了欧洲的一个位置，以与之前做出的注册中心选择保持一致)。</em>最后点击<em class="ld">部署</em>。</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div class="er es ln"><img src="../Images/3e83f3bb69b786adb5fe86447e8657e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/0*qWg4Kb5xp1IZEF54"/></div></figure><figure class="kd ke kf kg fd kh er es paragraph-image"><div class="er es lo"><img src="../Images/bbd4b5a9277fddaebc807930508cdcda.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/0*mroK--gXdMa0kGyr"/></div></figure><p id="35f1" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">在几分钟内(大部分时间是在创建集群的过程中)，您应该会看到您的映像部署到一个新创建的GKE集群中:</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div class="er es lp"><img src="../Images/88686cd183aba863965578db394383bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/0*-2MS9xjf4hSMDRaI"/></div></figure><p id="5536" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">该部署使用了一个三节点GKE集群。如果您想使用现有的集群或创建一个定制的集群(比如连接了TPU的<a class="ae jd" href="https://cloud.google.com/blog/products/ai-machine-learning/cloud-tpus-in-kubernetes-engine-powering-minigo-are-now-available-in-beta" rel="noopener ugc nofollow" target="_blank">)，只需创建一个新集群并将其用作映像部署的目标。部署到现有集群会快得多，因为不需要设置集群。</a></p><p id="2bb9" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">我们快到了！正如控制台中的消息所鼓励的那样，我们最终将通过创建一个服务来公开我们的部署:</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div class="er es lq"><img src="../Images/13408bd09be7e4e85ff75e7ebdf8a8e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/0*7k5KkZT_RgmeXZhP"/></div></figure><p id="a10b" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">…通过将端口80映射到8080映像目标端口:</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div class="er es lr"><img src="../Images/d4630337d3f6b12016394036c0009292.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/0*lks87QGhL9n1glEn"/></div></figure><p id="5b0c" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">同样，您可以在这里检查将要应用的YAML，无论是从命令行还是在您最喜欢的“基础设施即代码”工具中获得灵感或重用。准备好后，点击<em class="ld">曝光</em>。</p><p id="b6a9" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">然后，Google Cloud将为负载平衡器提供一个外部IP地址，并为您提供一个“外部端点”来访问您的应用程序。</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div class="er es ls"><img src="../Images/deb6eef6006e93b4dbf064a1898ecdd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/0*mvhfefNktPqd_i1q"/></div></figure><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es lt"><img src="../Images/91e76cf181468d1104c49a49484b3200.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gENIxdwqTWm841L9"/></div></div></figure><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es lu"><img src="../Images/d8371f365d646ba66712c23c18c5dde9.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/0*HyqDW8Z1iylMSk5B"/></div></div></figure><p id="8daa" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">请注意，这些都是在无需编写任何YAML和使用kubectl CLI的情况下完成的，我认为这对许多人来说是一个很好的初次体验。</p><p id="5d12" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">概括地说，所有这一切只是一个两步过程:</p><ol class=""><li id="2966" class="lv lw hi jg b jh ko jl kp jp lx jt ly jx lz kb ma mb mc md bi translated">通过指向图像来创建部署</li><li id="fb37" class="lv lw hi jg b jh me jl mf jp mg jt mh jx mi kb ma mb mc md bi translated">将部署作为服务公开</li></ol><p id="8512" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">这两个步骤自然都可以编写脚本。此外，在生产GKE集群上运行意味着您可以随意使用底层工具的所有功能，如下所示:</p><pre class="kd ke kf kg fd kt ku kv kw aw kx bi"><span id="69bd" class="ky ig hi ku b fi kz la l lb lc">$ <strong class="ku hj">gcloud</strong> container clusters <strong class="ku hj">get-credentials</strong> hello-helidon-cluster \ <br/>    — zone europe-west4-d \<br/>    — project my-gcp-project<br/>Fetching cluster endpoint and auth data.<br/>kubeconfig entry generated for hello-helidon-cluster.</span><span id="bc7b" class="ky ig hi ku b fi mj la l lb lc">$ <strong class="ku hj">kubectl get service hello-helidon-service</strong> -o yaml<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  creationTimestamp: 2018-09-17T14:08:50Z<br/>  labels:<br/>    app: hello-helidon<br/>  name: hello-helidon-service<br/>  namespace: default<br/>  resourceVersion: "4012"<br/>  selfLink: /api/v1/namespaces/default/services/hello-helidon-service<br/>  uid: 33bead4c-ba83-11e8-bc3a-42010a8000b1<br/>spec:<br/>  clusterIP: 10.11.240.64<br/>  externalTrafficPolicy: Cluster<br/>  ports:<br/>  - nodePort: 31509<br/>    port: 80<br/>    protocol: TCP<br/>    targetPort: 8080<br/>  selector:<br/>    app: hello-helidon<br/>  sessionAffinity: None<br/>  type: LoadBalancer<br/>status:<br/>  loadBalancer:<br/>    ingress:<br/>    - ip: 35.224.34.121</span><span id="9ec2" class="ky ig hi ku b fi mj la l lb lc">$ <strong class="ku hj">curl http://35.224.34.121/greet/GCP</strong><br/>{"message":"Hello GCP!"}</span></pre><p id="1c2c" class="pw-post-body-paragraph je jf hi jg b jh ko jj jk jl kp jn jo jp kq jr js jt kr jv jw jx ks jz ka kb hb bi translated">此时，您可以使用滚动更新来部署您的不断发展的映像，(<a class="ae jd" href="https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-autoscaler" rel="noopener ugc nofollow" target="_blank"> auto </a> ) <a class="ae jd" href="https://cloud.google.com/kubernetes-engine/docs/how-to/resizing-a-cluster" rel="noopener ugc nofollow" target="_blank"> scale </a>您的GKE集群，当然还可以利用谷歌云平台的其余部分，从<a class="ae jd" href="https://cloud.google.com/storage-options/" rel="noopener ugc nofollow" target="_blank">存储解决方案</a>，到<a class="ae jd" href="https://cloud.google.com/products/ai/" rel="noopener ugc nofollow" target="_blank">机器学习API</a>，等等。</p></div></div>    
</body>
</html>