<html>
<head>
<title>Monitoring UI: A Way to Understand Bigtable Performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">监视UI:理解Bigtable性能的一种方法</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/monitoring-ui-a-way-to-understan-bigtable-performance-61e351edaeee?source=collection_archive---------0-----------------------#2022-09-03">https://medium.com/google-cloud/monitoring-ui-a-way-to-understan-bigtable-performance-61e351edaeee?source=collection_archive---------0-----------------------#2022-09-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="04ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们使用Bigtable时，需要考虑一些事情，包括它的健康和性能。根据我们构建的应用程序的类型，我们想要监控的指标的重要性会有所不同。</p><p id="a49b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当创建一个实例时，Bigtable将有一个内置的监控工具来报告节点、集群和实例的性能。默认监控包括但不限于:CPU利用率、错误率、存储利用率、读/写请求的行数和读/写吞吐量。</p><p id="d191" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Bigtable中，集群的存储容量由存储类型(SSD/HDD)和节点数量决定。随着大小的增加，Bigtable需要在集群中重新分配数据。对于延迟敏感型应用程序，建议磁盘利用率低于群集存储容量的70%,同时保持低于60%。为了避免延迟，我们还可以添加更多节点。</p><p id="d1ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">群集的节点将使用CPU资源来处理读取和/或写入请求。例如，具有高吞吐量的流作业可能会占用大量CPU。当资源使用量超过阈值时，群集将无法正常运行，并且在需要读取和/或写入数据时可能会返回错误。为了获得最佳性能，CPU利用率应保持在平均CPU利用率的70%以下，最常用节点的CPU利用率应保持在90%以下。</p><p id="ca91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在观察磁盘和CPU的使用情况时，我们可以确定如何为集群创建自动缩放器。启用自动缩放时，Bigtable将调整集群中实际存在的节点数量。被选为最大节点数的值应该是集群处理工作负载最大流量所需的节点数以及已经准备好的预算。</p><p id="935a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随着节点数量的变化，Bigtable不断优化存储，跨节点重新平衡数据，以确保流量均匀分布，没有节点过载。当集群纵向扩展时，Bigtable会自动重新平衡节点以获得最佳性能。在扩展和重新平衡过程中，所有请求都会继续到达群集。群集已扩展到其最大节点数，并且超过了CPU利用率目标，请求可能会有很长的延迟或失败。如果群集已扩展到其最大节点数，并且超过了存储利用率限制，写入请求将会失败。当集群规模缩小时，节点的删除速度比规模扩大时慢，以防止对延迟产生任何影响。</p><p id="de41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以将最小值设置为1，以确保群集可以尽可能缩小到最小、最经济高效的大小。群集永远不会变得过小，因为它会自动防止节点数量下降到维持CPU和存储利用率目标所需的最小值以下。当减少集群中的节点数量以缩小规模时，尽量不要在10分钟内将集群大小减少10%以上。如果群集中的剩余节点暂时不堪重负，缩减过快会导致性能问题，例如延迟增加。</p><p id="f88c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果模式设计有问题，向Bigtable集群添加节点可能不会提高性能。例如，如果我们对表中的单个行进行大量的读取或写入，所有的读取或写入都将进入集群中的同一个节点；因此，添加节点不会提高性能。相反，如果读取和写入均匀分布在表的各行中，添加节点通常会提高性能。</p><p id="15f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们想要查看读/写是否平衡时，我们可以查看监控UI。我们可以在监控工具中通过关注“最热节点的CPU利用率”来检测这个实例。如果最热的节点经常高于推荐值，即使我们的平均CPU利用率合理，我们访问一小部分数据的频率也可能比访问其余数据的频率高得多。解决这个问题的一个方法是需要返回并检查您的<a class="ae je" href="https://cloud.google.com/bigtable/docs/schema-design" rel="noopener ugc nofollow" target="_blank">模式设计</a>和访问模式，并确保它支持在每个表中更均匀的读/写分布。很多时候，当我们真正需要挖掘性能的细节时，我们也可以通过<a class="ae je" href="https://cloud.google.com/bigtable/docs/keyvis-overview" rel="noopener ugc nofollow" target="_blank">云Bigtable的关键可视化工具</a>来了解以下问题:</p><ul class=""><li id="5100" class="jf jg hi ih b ii ij im in iq jh iu ji iy jj jc jk jl jm jn bi translated">检查您的读取或写入是否在特定行上创建热点</li><li id="d951" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc jk jl jm jn bi translated">查找包含过多数据的行</li><li id="5485" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc jk jl jm jn bi translated">查看表中所有行的访问模式是否平衡</li></ul></div></div>    
</body>
</html>