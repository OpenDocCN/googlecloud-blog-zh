<html>
<head>
<title>How to Find Performance Bottlenecks on Your Application (Effortlessly)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何毫不费力地找到应用程序的性能瓶颈</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/finding-performance-bottlenecks-on-your-application-effortlessly-b254b932d47e?source=collection_archive---------1-----------------------#2018-08-28">https://medium.com/google-cloud/finding-performance-bottlenecks-on-your-application-effortlessly-b254b932d47e?source=collection_archive---------1-----------------------#2018-08-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3452bdd1dd9f091efa1acd1b4c40c508.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7FXNO4MX9KKaYBH1"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">马文·迈耶在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="f20e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如今，有了这么多的工具和框架来简化web和移动开发，我们开发人员可以有更多的时间来关注跟踪和增强应用程序的性能。</p><p id="b155" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通常，我们试图关注页面加载时间、延迟、不同设备上的动画帧率等等；开始时，到达这个发展阶段可能会不舒服:</p><p id="8d19" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">我如何衡量事物？</em></p><p id="16ed" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有什么我可以用的东西吗？</p><p id="2ef7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">其中最严酷的是:</p><p id="731d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">我如何确保这些用于跟踪的代码不会干扰应用程序？</em></p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="8618" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这篇文章将帮助你找到那些答案，而不需要在编码上花费太多的精力。</p><p id="6c83" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，我们会明白:</p><ol class=""><li id="19dc" class="kb kc hi ix b iy iz jc jd jg kd jk ke jo kf js kg kh ki kj bi translated">OpenCensus如何帮助你</li><li id="cff7" class="kb kc hi ix b iy kk jc kl jg km jk kn jo ko js kg kh ki kj bi translated">仪表化服务器的示例</li><li id="4711" class="kb kc hi ix b iy kk jc kl jg km jk kn jo ko js kg kh ki kj bi translated">如何将收集的数据发送到各种其他服务</li></ol><h1 id="b028" class="kp kq hi bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">OpenCensus和Node.js</h1><p id="e989" class="pw-post-body-paragraph iv iw hi ix b iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo lr jq jr js hb bi translated"><a class="ae iu" href="https://opencensus.io/" rel="noopener ugc nofollow" target="_blank"> OpenCensus </a>是一个从你的应用程序中收集统计和追踪信息的工具，并将其发送给许多不同的服务，如<a class="ae iu" href="https://cloud.google.com/stackdriver/" rel="noopener ugc nofollow" target="_blank"> Stackdriver </a>、<a class="ae iu" href="https://github.com/jaegertracing/jaeger" rel="noopener ugc nofollow" target="_blank"> Jaeger </a>、<a class="ae iu" href="https://zipkin.io/" rel="noopener ugc nofollow" target="_blank"> Zipkin </a>等。</p><p id="44ff" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">OpenCensus的伟大之处在于，它不仅是一个独立于供应商的库，并且支持许多不同语言的实现，如Java、Go、Python和Node.js，它还具有<strong class="ix hj">自动跟踪功能！</strong></p><p id="029e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">OpenCensus for Node.js(我曾有机会用它<a class="ae iu" href="https://github.com/eduardoemery" rel="noopener ugc nofollow" target="_blank">为</a>做贡献)支持HTTP、HTTPS、HTTP2和MongoDB的自动跟踪。这意味着一旦设置好，它就开始收集跟踪，而无需您明确指出应用程序中的操作是什么以及应该如何命名。</p><p id="930e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">实际上，它不止于此，它保证您将拥有一个可伸缩的低开销代码来收集关于您的应用程序的数据。而且，如果你需要的话，不依赖于供应商，你将来一定能够很容易地改变你的后端服务。</p><p id="b5c9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，让我们用一个应用程序来看看使用OpenCensus for Node.js的自动跟踪特性有多简单。</p><p id="588a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，我们将使用<a class="ae iu" href="https://github.com/callicoder/node-easy-notes-app" rel="noopener ugc nofollow" target="_blank"> Node Easy Notes应用程序</a>进行演示。</p><h1 id="667c" class="kp kq hi bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">示例应用程序</h1><p id="7ee1" class="pw-post-body-paragraph iv iw hi ix b iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo lr jq jr js hb bi translated">为了不重新发明轮子，让我们使用一个已经存在的名为<em class="jt"> Node Easy Notes App </em>的应用程序。这是一个简单的用于notes的CRUD应用程序(创建、读取、更新和删除)。它使用<em class="jt"> Express </em>和<em class="jt"> MongoDB </em>来构建和存储notes信息。</p><p id="56f5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的目标是跟踪其端点的延迟，并获得更多有关内部操作的信息，以便为我们提供响应。</p><p id="304b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这有助于了解在增强应用程序性能时，开发团队应该将注意力集中在哪里。例如，人们可能会发现，某个端点需要很长时间才能做出响应，这是由于在特定情况下在数据库中进行了低效的查询。</p><p id="f6a3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以，让我们深入研究一下。</p><p id="9b49" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，确保您已经安装了<a class="ae iu" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>(版本6或更高版本)和<em class="jt"> npm </em>。</p><p id="b8e9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦<a class="ae iu" href="https://github.com/callicoder/node-easy-notes-app" rel="noopener ugc nofollow" target="_blank">下载了Node Easy Notes应用程序</a>，通过运行以下命令导航到其根目录并安装其依赖项:</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="c5b0" class="mb kq hi lx b fi mc md l me mf">npm install</span></pre><p id="3169" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">完成后，您可以通过运行以下命令来测试它:</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="807b" class="mb kq hi lx b fi mc md l me mf">node server.js</span></pre><p id="af28" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，去<a class="ae iu" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> localhost://3000 </a>看看它是如何工作的。也可以尝试类似<a class="ae iu" href="http://localhost://3000/notes" rel="noopener ugc nofollow" target="_blank"> localhost://3000/notes </a>的不同路线。</p><p id="f169" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从这一点开始，我们已经为插装步骤启动并运行了服务器。</p><h1 id="4647" class="kp kq hi bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">检测应用程序</h1><p id="bf47" class="pw-post-body-paragraph iv iw hi ix b iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo lr jq jr js hb bi translated">也许你对仪器应用不熟悉，但正如贾纳·多安所说:</p><blockquote class="mg mh mi"><p id="8571" class="iv iw jt ix b iy iz ja jb jc jd je jf mj jh ji jj mk jl jm jn ml jp jq jr js hb bi translated">允许平台级别的可见性有助于我们的用户快速调试和确定意外事件。</p></blockquote><p id="9fb1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这对您的基础设施以及您的团队如何管理资源有着直接的影响。但是仅仅因为它是一件重要的事情，并不意味着它一定是困难的。</p><p id="9367" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">开头提到的魔法将从这一刻开始发生，准备好！</p><p id="83cb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，使用以下命令安装OpenCensus for Node.js:</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="49e6" class="mb kq hi lx b fi mc md l me mf">npm install @opencensus/nodejs</span></pre><p id="422a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，简单地打开<code class="du mm mn mo lx b">server.js</code>文件，在它的请求中添加以下几行:</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="1bf8" class="mb kq hi lx b fi mc md l me mf">var tracing = require('@opencensus/nodejs');</span><span id="6d99" class="mb kq hi lx b fi mp md l me mf">tracing.start();</span></pre><p id="70f1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">瞧！</em></p><p id="7f10" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过添加，我们导入并启动了一个<strong class="ix hj">跟踪实例，</strong>负责添加插件的家伙，这些插件将自动收集HTTP、HTTPS、HTTP2和MongoDB的跟踪。</p><p id="8931" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就这样，我们今天到此为止。</p><p id="2669" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您可以使用<code class="du mm mn mo lx b">node server.js</code>再次运行应用程序，并访问它的一个端点，比如<a class="ae iu" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> localhost:3000/ </a>。</p><p id="bfa8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您看一下终端，您会看到一些跟踪信息在它执行操作时被打印出来。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/832e1c5641a49b10647723c0f41b1021.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EUbP3s92NpcedTJaEPF42w.png"/></div></div></figure><p id="2df8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">好吧，这看起来不太友好。</p><p id="b0f5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">嗯，还有比这更优雅的。您可以将导出器添加到您的<em class="jt">跟踪</em>实例中，以便能够将数据发送到其他服务，如Stackdriver。</p><h1 id="30e0" class="kp kq hi bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">将收集的数据发送给外部服务</h1><p id="1aae" class="pw-post-body-paragraph iv iw hi ix b iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo lr jq jr js hb bi translated">为此，我们只需要导入导出器并用正确的参数实例化它。在<a class="ae iu" href="https://github.com/census-instrumentation/opencensus-node/tree/master/packages/opencensus-nodejs" rel="noopener ugc nofollow" target="_blank"> OpenCensus for Node GitHub页面</a>中，可以分别找到每个出口商的更多信息。</p><p id="a05f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于Stackdriver，您需要有一个启用了Stackdriver跟踪的Google云项目。确保还启用应用程序默认凭据进行身份验证(有关更多信息，请访问<a class="ae iu" href="https://developers.google.com/identity/protocols/application-default-credentials" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/identity/protocols/Application-Default-Credentials</a>):</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="a203" class="mb kq hi lx b fi mc md l me mf">export GOOGLE_APPLICATION_CREDENTIALS=/path/to/your/credentials.json</span></pre><p id="3e64" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一旦完成了项目和环境的设置。我们只需安装Stackdriver导出器，其中包括:</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="c3b9" class="mb kq hi lx b fi mc md l me mf">npm install @opencensus/exporter-stackdriver</span></pre><p id="96ca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">之后，导入并将其传递给跟踪，就像这样:</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="aa8e" class="mb kq hi lx b fi mc md l me mf">var tracing = require('@opencensus/nodejs');</span><span id="36b9" class="mb kq hi lx b fi mp md l me mf">var stackdriver = require('@opencensus/exporter-stackdriver');</span><span id="a2fe" class="mb kq hi lx b fi mp md l me mf">exporter = new stackdriver.StackdriverTraceExporter({projectId: "your-project-id"});</span><span id="e263" class="mb kq hi lx b fi mp md l me mf">tracing.start({exporter});</span></pre><p id="3d0d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用<code class="du mm mn mo lx b">node server.js</code>再次运行您的应用程序，并再次使用端点。</p><h1 id="ec46" class="kp kq hi bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">查看痕迹</h1><p id="4b5a" class="pw-post-body-paragraph iv iw hi ix b iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo lr jq jr js hb bi translated">现在，只要去<a class="ae iu" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">谷歌云控制台</a>看看你的踪迹！在那里，您可以找到查看数据的不同方式。您还可以选择特定的跟踪以了解更多信息，查看其子范围和元数据。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/0bd6bce7a8060b6c9556cac0f648c376.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fRWJflf4kPRsE2ybNBNWBw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">跟踪概述</figcaption></figure><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/16efdc56856bfd0444a1f9027fce0801.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2e60DoVTeOxbje6K-jOqDQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">获取有关单个跟踪的更多信息</figcaption></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="5ef7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在轮到你玩了。</p><p id="d4a9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">就像我们在这里做的那样，在您的应用程序中添加OpenCensus for Node.js，并在下面评论它给了您什么启示！</p><h1 id="c988" class="kp kq hi bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">结论</h1><p id="0b0c" class="pw-post-body-paragraph iv iw hi ix b iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo lr jq jr js hb bi translated">将应用程序推向市场时，不管是大的还是小的，插装都是决定性的一步。</p><p id="88a3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它对团队活动计划和资源使用有直接影响。</p><p id="82fa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是为什么你必须尽快尝试整合像OpenCensus这样的工具。</p><p id="03e7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">考虑到集成是如此容易，没有理由不这样做。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="6d3a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">现在，获取这个例子，尝试它，改变它，改进它，告诉我你的印象以及它有多容易或多难。</em></p><p id="da2a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请在下面留下评论。我很乐意收到你的来信。</p></div></div>    
</body>
</html>