<html>
<head>
<title>Triggering Workflows from Google Sheets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Google Sheets触发工作流</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/triggering-workflows-from-google-sheets-1d0205a91ed8?source=collection_archive---------0-----------------------#2022-09-09">https://medium.com/google-cloud/triggering-workflows-from-google-sheets-1d0205a91ed8?source=collection_archive---------0-----------------------#2022-09-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bf86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有没有可能将<a class="ae jd" href="https://workspace.google.com/" rel="noopener ugc nofollow" target="_blank"> Google Workspace </a>工具，如日历、表格和表单与<a class="ae jd" href="https://cloud.google.com/workflows" rel="noopener ugc nofollow" target="_blank">工作流</a>集成？例如，可以从Google表单或工作表中触发工作流吗？事实证明，这不仅是可能的，而且比你想象的要容易。让我用一个样例用例向您展示如何操作。</p><h1 id="3d63" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">用例</h1><p id="699d" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">假设您是一名管理员，负责将云基础架构中的虚拟机(VM)分配给用户。您希望捕获具有虚拟机规范的用户请求，对请求进行批准，然后通过自动化流程创建虚拟机。</p><p id="7463" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以实施如下流程:</p><ol class=""><li id="9067" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">Google表单捕获虚拟机创建请求。</li><li id="2f85" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">Google Sheet保存来自Google表单的响应，并带有一个已批准的复选框。</li><li id="0e62" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">当人们选择Approved复选框时，一个<a class="ae jd" href="https://developers.google.com/apps-script" rel="noopener ugc nofollow" target="_blank">应用程序脚本</a>调用Google Cloud中的一个工作流，其中包含表单中的虚拟机详细信息。</li><li id="4381" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">工作流调用计算引擎API在Google Cloud中为用户创建虚拟机。</li></ol><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es kv"><img src="../Images/e5ab4f793b375f959e73bbea9ce19fe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/0*XiEqQSgBZFsWCuER.png"/></div></figure><p id="0a6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们更详细地看一下每个步骤。</p><h1 id="1ffc" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">创建一个谷歌表单</h1><p id="5561" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">创建一个Google表单来捕获用户的VM创建请求。</p><p id="619a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到<a class="ae jd" href="https://docs.google.com/forms" rel="noopener ugc nofollow" target="_blank"> Google Forms </a>，在之后创建一个类似于<a class="ae jd" href="https://docs.google.com/forms/d/e/1FAIpQLSercSIn9KxVwCCADAC3vI6zNMBI42Zh7Nzba1_K6m24P_opqA/viewform?usp=sf_link" rel="noopener ugc nofollow" target="_blank">的新表单:</a></p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es ld"><img src="../Images/edad16337787d9510ea304c223d5a186.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/0*reqQ7f-1nlHyv-yL.png"/></div></figure><p id="85f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保在设置下选择了<code class="du le lf lg lh b">Collect email addresses</code>选项。稍后创建虚拟机时，您将需要一个电子邮件地址。</p><h1 id="7c64" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">创建一个Google表单</h1><p id="659e" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">创建一个Google表单来捕获表单中的响应。在<code class="du le lf lg lh b">Responses</code>选项卡下，点击<code class="du le lf lg lh b">Create Spreadsheet</code>按钮。</p><p id="925d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将带您进入带有回答的电子表格。在该电子表格中，添加一个带有复选框的<code class="du le lf lg lh b">Approved</code>列:</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es li"><img src="../Images/ceaa816d22d2450d4037ad145f6efdae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ef3z0tIW_yk2Ehpi.png"/></div></div></figure><p id="e447" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此复选框将用于触发创建虚拟机的工作流。</p><h1 id="c3cf" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">创建应用程序脚本</h1><p id="16d5" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">创建一个应用程序脚本来监视<code class="du le lf lg lh b">Approved</code>复选框。</p><p id="d894" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到电子表格中的<code class="du le lf lg lh b">Extensions</code>和<code class="du le lf lg lh b">Apps Script</code>。这将打开应用程序脚本编辑器。用<a class="ae jd" href="https://github.com/GoogleCloudPlatform/workflows-demos/blob/master/workspace-integration/sheets-to-workflows/Code.gs" rel="noopener ugc nofollow" target="_blank"> Code.gs </a>中的代码替换<code class="du le lf lg lh b">Code.gs</code>中的默认代码。确保用您自己的项目id替换<code class="du le lf lg lh b">PROJECT_ID</code>。这段代码监视<code class="du le lf lg lh b">Approved</code>列中复选框的变化。选中该复选框后，它会调用一个工作流来创建虚拟机。</p><p id="2f83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在应用程序脚本编辑器中，转到<code class="du le lf lg lh b">Settings</code>并选中编辑器中的<code class="du le lf lg lh b">Show appsscript.json manifest file</code>。用<a class="ae jd" href="https://github.com/GoogleCloudPlatform/workflows-demos/blob/master/workspace-integration/sheets-to-workflows/appscript.json" rel="noopener ugc nofollow" target="_blank"> appscript.json </a>替换<code class="du le lf lg lh b">appscript.json</code>的内容。这确保了Apps脚本具有所需的权限。</p><p id="7a6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到<code class="du le lf lg lh b">Triggers</code>部分，在编辑工作表时创建一个从工作表到Apps脚本的触发器:</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es ln"><img src="../Images/0cf296b3048169666d587333cba4e89c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/0*ptdAgeyW9f4bWj03.png"/></div></figure><h1 id="e964" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">创建工作流</h1><p id="03dd" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">确保您有一个Google Cloud项目，并且在<code class="du le lf lg lh b">gcloud</code>中设置了项目id:</p><pre class="kw kx ky kz fd lo lh lp lq aw lr bi"><span id="54c3" class="ls jf hi lh b fi lt lu l lv lw">PROJECT_ID =your-project-id<br/>gcloud config set project $PROJECT_ID</span></pre><p id="a74f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行<a class="ae jd" href="https://github.com/GoogleCloudPlatform/workflows-demos/blob/master/workspace-integration/sheets-to-workflows/setup.sh" rel="noopener ugc nofollow" target="_blank"> setup.sh </a>启用所需服务，授予必要角色，部署<a class="ae jd" href="https://github.com/GoogleCloudPlatform/workflows-demos/blob/master/workspace-integration/sheets-to-workflows/workflow.yaml" rel="noopener ugc nofollow" target="_blank"> workflow.yaml </a>中定义的工作流。此工作流使用提供的规范创建计算引擎虚拟机。</p><h1 id="1b30" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">尝试一下</h1><p id="e314" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">您现在已经准备好测试端到端流程了。</p><p id="7b28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">返回到工作表，为之前创建的条目选择<code class="du le lf lg lh b">Approved</code>复选框:</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es lx"><img src="../Images/6ab3e852afe4c0fe23a914414d313694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jJT8Vi1DaMi7pFiG.png"/></div></div></figure><p id="1daa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在应用程序脚本控制台中，您可以看到一个新的执行:</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es ly"><img src="../Images/6e90aedde6ae2f2f38e56e4b2e5fe972.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PSmrgb_Cymr4IKYs.png"/></div></div></figure><p id="c8d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在工作流控制台中，您还可以看到一个新的执行:</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es lz"><img src="../Images/8cefd41d3f5cfcf45247b1db09e51cd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/0*yo3DflaEWcjFr2v4.png"/></div></figure><p id="321b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，在计算引擎控制台中，您可以看到正在创建一个新的虚拟机:</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es ma"><img src="../Images/30651669a3713828df807e6a881417f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/0*mqqeVpmXWAe-GJmu.png"/></div></figure><p id="a2bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从现在开始，每当用户填写表单时，您都会看到Google Sheet的一个新条目。当您通过选中“已批准”复选框批准它时，虚拟机将由工作流自动创建！</p><p id="e95c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这只是如何将Google Workspace与工作流集成的一个例子。如果您有任何问题或反馈，请随时通过Twitter <a class="ae jd" href="https://twitter.com/meteatamel" rel="noopener ugc nofollow" target="_blank"> @meteatamel </a>联系我。感谢我们的暑期实习生Cheran Mahalingam和Michael Yang，他们验证了该模式并创建了初始样本。</p></div><div class="ab cl mb mc gp md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="hb hc hd he hf"><p id="6c9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mi">最初发布于</em><a class="ae jd" href="https://atamel.dev/posts/2022/09-09_trigger_workflows_from_sheets/" rel="noopener ugc nofollow" target="_blank"><em class="mi">https://atamel . dev</em></a><em class="mi">。</em></p></div></div>    
</body>
</html>