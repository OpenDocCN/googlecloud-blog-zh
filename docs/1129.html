<html>
<head>
<title>Migrating from Knative Build to Tekton Pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Knative Build迁移到Tekton管道</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/migrating-from-knative-build-to-tekton-pipelines-68fc6de14373?source=collection_archive---------0-----------------------#2019-08-28">https://medium.com/google-cloud/migrating-from-knative-build-to-tekton-pipelines-68fc6de14373?source=collection_archive---------0-----------------------#2019-08-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2904741263a0407a553e249c1d7d1587.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O2nIYbl3W86S_PpyiuGQMw.png"/></div></div></figure><h1 id="7f81" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">Knative 0.8.0和Build Deprecation</h1><p id="f303" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">几周前，Knative 0.8.0 发布了一系列修正和改进。0.8.0中最大的变化之一是根据<a class="ae km" href="https://knative.dev/docs/build/" rel="noopener ugc nofollow" target="_blank">文档</a>，Knative Build现在被弃用:</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/637ada661669a101e561e520a5d25682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7d371_EPwjXfyvQA"/></div></div></figure><p id="da2c" class="pw-post-body-paragraph jo jp hi jq b jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh kw kj kk kl hb bi translated">Knative安装文档也只包括Knative服务和事件，而没有提到Build:</p><pre class="ko kp kq kr fd kx ky kz la aw lb bi"><span id="9d5d" class="lc ir hi ky b fi ld le l lf lg">kubectl apply <br/>-f https://github.com/knative/serving/releases/download/v0.8.0/serving.yaml \<br/>-f https://github.com/knative/eventing/releases/download/v0.8.0/release.yaml \<br/>-f https://github.com/knative/serving/releases/download/v0.8.0/monitoring.yaml</span></pre><p id="9903" class="pw-post-body-paragraph jo jp hi jq b jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh kw kj kk kl hb bi translated">很高兴知道，但没有解释为什么Knative Build被弃用，也没有任何关于什么是替代品的指导，如果有的话。经过一点点研究，我有更多关于弃用的信息，也有一个迁移路径，我想在这篇文章中分享。</p><p id="ebdc" class="pw-post-body-paragraph jo jp hi jq b jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh kw kj kk kl hb bi translated">有一个Knative问题(<a class="ae km" href="https://github.com/knative/build/issues/614" rel="noopener ugc nofollow" target="_blank"> 614 </a>)有更多的细节，但基本上，它已经决定，建立和推动一个服务的形象不应该是Knative的核心职责之一。</p><p id="4dc9" class="pw-post-body-paragraph jo jp hi jq b jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh kw kj kk kl hb bi translated">相反，Knative用户可以依靠许多其他更好的工具。其中一个工具叫做<a class="ae km" href="https://github.com/tektoncd/pipeline" rel="noopener ugc nofollow" target="_blank"> Tekton管道</a>。受Knative Build的启发，Tekton Pipelines项目为声明CI/CD风格的管道提供了Kubernetes风格的资源。它做Knative Build做的所有事情，甚至更多。</p><h1 id="35eb" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">你好泰克顿管道公司</h1><p id="4e76" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在<a class="ae km" href="https://github.com/tektoncd/pipeline" rel="noopener ugc nofollow" target="_blank"> Tekton Pipelines </a>中，你可以创建简单的一次性任务或更复杂的CI/CD管道。Tekton管道有4个主要原语:</p><ul class=""><li id="b5e8" class="lh li hi jq b jr ks jv kt jz lj kd lk kh ll kl lm ln lo lp bi translated"><a class="ae km" href="https://github.com/tektoncd/pipeline/blob/master/docs/tasks.md" rel="noopener ugc nofollow" target="_blank">任务</a>定义了需要执行一个或多个步骤的工作。</li><li id="7396" class="lh li hi jq b jr lq jv lr jz ls kd lt kh lu kl lm ln lo lp bi translated"><a class="ae km" href="https://github.com/tektoncd/pipeline/blob/master/docs/resources.md" rel="noopener ugc nofollow" target="_blank"> PipelineResources </a>定义了可以传入和传出任务的工件。</li><li id="5233" class="lh li hi jq b jr lq jv lr jz ls kd lt kh lu kl lm ln lo lp bi translated"><a class="ae km" href="https://github.com/tektoncd/pipeline/blob/master/docs/taskruns.md" rel="noopener ugc nofollow" target="_blank"> TaskRun </a>使用提供的资源运行您定义的任务。</li><li id="9efb" class="lh li hi jq b jr lq jv lr jz ls kd lt kh lu kl lm ln lo lp bi translated"><a class="ae km" href="https://github.com/tektoncd/pipeline/blob/master/docs/pipelines.md" rel="noopener ugc nofollow" target="_blank">流水线</a>定义了要按顺序执行的任务列表。</li></ul><p id="fb85" class="pw-post-body-paragraph jo jp hi jq b jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh kw kj kk kl hb bi translated">在使用Tekton管道之前，您需要将其安装在您的Kubernetes集群中。详细的<a class="ae km" href="https://github.com/tektoncd/pipeline/blob/master/docs/install.md" rel="noopener ugc nofollow" target="_blank">说明</a>在这里，但是很简单:</p><pre class="ko kp kq kr fd kx ky kz la aw lb bi"><span id="6632" class="lc ir hi ky b fi ld le l lf lg">kubectl apply -f <a class="ae km" href="https://storage.googleapis.com/tekton-releases/latest/release.yaml" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/tekton-releases/latest/release.yaml</a></span></pre><p id="4c9c" class="pw-post-body-paragraph jo jp hi jq b jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh kw kj kk kl hb bi translated">安装后，您可以检查Tekton pods:</p><h1 id="cd0e" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">Knative Build ==&gt; Tekton管道</h1><p id="1889" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">有关于从Knative Build迁移到Tekton的基本文档。简而言之，这些是Knative Build构造的Tekton等价物:</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/661905151c2856116fafa605695a5ac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yjEA9ETin1_8hmvL2jI2Cw.png"/></div></div></figure><p id="191a" class="pw-post-body-paragraph jo jp hi jq b jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh kw kj kk kl hb bi translated">此外，<a class="ae km" href="https://github.com/tektoncd/catalog" rel="noopener ugc nofollow" target="_blank"> Tekton Catalog </a>旨在提供一个可重用任务的目录，类似于Knative BuildTemplate repository以前所做的。</p><h1 id="5012" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">使用Kaniko任务构建</h1><p id="dbaf" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">作为一个例子，让我们看看如何使用Tekton管道构建一个图像并将其推送到Google容器注册中心(GCR)。</p><p id="149b" class="pw-post-body-paragraph jo jp hi jq b jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh kw kj kk kl hb bi translated">在Tekton world中，您要么从定义您的自定义任务(<a class="ae km" href="https://github.com/meteatamel/knative-tutorial/blob/master/docs/12-tekton-helloworldbuild.md#design-the-task" rel="noopener ugc nofollow" target="_blank">示例</a>)开始，要么重用其他人的任务(<a class="ae km" href="https://github.com/meteatamel/knative-tutorial/blob/master/docs/14-tekton-kanikotaskbuild.md#install-kaniko-task" rel="noopener ugc nofollow" target="_blank">示例</a>)。让我们使用Tekton目录上已有的<a class="ae km" href="https://github.com/tektoncd/catalog/tree/master/kaniko" rel="noopener ugc nofollow" target="_blank"> Kaniko任务</a>。</p><p id="5601" class="pw-post-body-paragraph jo jp hi jq b jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh kw kj kk kl hb bi translated">首先，安装Kaniko任务并确保它已安装:</p><pre class="ko kp kq kr fd kx ky kz la aw lb bi"><span id="5858" class="lc ir hi ky b fi ld le l lf lg">kubectl apply -f https://raw.githubusercontent.com/tektoncd/catalog/master/kaniko/kaniko.yaml<br/><br/>kubectl get task<br/><br/>NAME     AGE<br/>kaniko   45m</span></pre><p id="509c" class="pw-post-body-paragraph jo jp hi jq b jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh kw kj kk kl hb bi translated">其次，定义一个TaskRun以使用该任务并提供所需的参数:</p><pre class="ko kp kq kr fd kx ky kz la aw lb bi"><span id="ba5a" class="lc ir hi ky b fi ld le l lf lg">apiVersion: tekton.dev/v1alpha1<br/>kind: TaskRun<br/>metadata:<br/>  name: build-kaniko-helloworld-gcr<br/>spec:<br/>  taskRef:<br/>    name: kaniko<br/>  inputs:<br/>    resources:<br/>    - name: source<br/>      resourceSpec:<br/>        type: git<br/>        params:<br/>        - name: url<br/>          value: https://github.com/meteatamel/knative-tutorial<br/>    params:<br/>    - name: DOCKERFILE<br/>      value: Dockerfile<br/>    - name: CONTEXT<br/>      value: serving/helloworld/csharp<br/>  outputs:<br/>    resources:<br/>    - name: image<br/>      resourceSpec:<br/>        type: image<br/>        params:<br/>        - name: url<br/>          # Replace {PROJECT_ID} with your GCP Project's ID.<br/>          value: gcr.io/{PROJECT_ID}/helloworld:kaniko-tekton</span></pre><p id="32c6" class="pw-post-body-paragraph jo jp hi jq b jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh kw kj kk kl hb bi translated">最后，启动TaskRun并检查它是否成功:</p><pre class="ko kp kq kr fd kx ky kz la aw lb bi"><span id="7a91" class="lc ir hi ky b fi ld le l lf lg">kubectl apply -f taskrun-build-kaniko-helloworld-gcr.yaml<br/><br/>kubectl get taskrun<br/><br/>NAME                          SUCCEEDED<br/>build-kaniko-helloworld-gcr   True</span></pre><p id="69fa" class="pw-post-body-paragraph jo jp hi jq b jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh kw kj kk kl hb bi translated">此时，您应该看到构建了容器映像并将其推送到GCR。</p></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><p id="6779" class="pw-post-body-paragraph jo jp hi jq b jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh kw kj kk kl hb bi translated">希望这篇博文为您提供了从Knative Build过渡到Tekton Pipeliens所需的基础知识。我也为0.8.0版本更新了我的教程。查看更多将Knative Build转换为Tekton管道的示例:</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div class="er es md"><img src="../Images/fa0ae9e83369bff64083017e02b7437e.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/0*rLfFkWMCfKccitnq"/></div></figure></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><p id="7edc" class="pw-post-body-paragraph jo jp hi jq b jr ks jt ju jv kt jx jy jz ku kb kc kd kv kf kg kh kw kj kk kl hb bi translated"><em class="me">原载于2019年8月28日</em><a class="ae km" href="https://meteatamel.wordpress.com/2019/08/28/migrating-from-knative-build-to-tekton-pipelines/" rel="noopener ugc nofollow" target="_blank"><em class="me">http://meteatamel.wordpress.com</em></a><em class="me">。</em></p></div></div>    
</body>
</html>