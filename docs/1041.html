<html>
<head>
<title>Run a Static Site On Google Cloud Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在谷歌云上运行一个静态网站</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-run-a-static-site-on-google-cloud-run-345713ca4b40?source=collection_archive---------0-----------------------#2019-06-21">https://medium.com/google-cloud/how-to-run-a-static-site-on-google-cloud-run-345713ca4b40?source=collection_archive---------0-----------------------#2019-06-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/db991c7374934278b3f64d5aff7d71b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8lOxkps9txbD0iE7.jpg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">那是我们。</figcaption></figure><p id="9855" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Google Cloud Run是新宣布的Google云服务。想法很简单:它是无服务器上的<strong class="iw hj"> Docker。Google Cloud Run类似于Google Cloud的功能:你写代码不用担心基础设施。</strong></p><p id="304a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">它的独特之处在于<strong class="iw hj"> Google Cloud Run直接与Docker容器</strong>一起工作，公开<code class="du js jt ju jv b">Dockerfile</code>，支持任何编程语言，自定义域，并且超时时间长得多(15分钟)。GKE上运行的Google Cloud还支持Websockets和GPU/TPUs，这使得它成为机器学习等资源密集型应用程序的有趣选择。</p><p id="dd17" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在本指南中，我将向你展示如何使用一个简单的命令，在几分钟内运行一个简单的静态站点，从而进入Google Cloud Run。一句话，你自己的穷人的生活。这是最容易得到平台味道的方法之一，即使肯定有更好的用例。(请先熟悉一下<a class="ae jw" href="https://cloud.google.com/run/pricing" rel="noopener ugc nofollow" target="_blank">的定价</a>，但不要担心:由于免费层，你可能一毛钱都不用付。)</p></div><div class="ab cl jx jy gp jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hb hc hd he hf"><p id="c95c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们从实际构建一个静态网站开始。从从头创建一个到使用一个框架，一个静态的站点生成器，像<a class="ae jw" href="https://jekyllrb.com/" rel="noopener ugc nofollow" target="_blank"> Jekyll </a>或<a class="ae jw" href="https://gohugo.io/" rel="noopener ugc nofollow" target="_blank"> Hugo </a>这样的选项很少。我会选择后者，因为我喜欢它，但它们都是有效的选择。我想委婉地请你先熟悉一下Hugo的快速入门:</p><pre class="ke kf kg kh fd ki jv kj kk aw kl bi"><span id="d354" class="km kn hi jv b fi ko kp l kq kr">$ brew install hugo<br/>$ hugo new site static-google-cloud-run<br/>$ cd static-google-cloud-run<br/>$ git init<br/>$ git submodule add https://github.com/budparr/gohugo-theme-ananke.git themes/ananke<br/>$ <!-- -->echo 'theme = "ananke"' &gt;&gt; config.toml<br/>$ <!-- -->hugo new posts/hello-world.md</span></pre><p id="4d72" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，使用您最喜欢的编辑器，通过添加一些内容并删除有效发布它的<code class="du js jt ju jv b">draft: true</code>行来编辑<code class="du js jt ju jv b">content/posts/hello-world.md</code>:</p><pre class="ke kf kg kh fd ki jv kj kk aw kl bi"><span id="cfb3" class="km kn hi jv b fi ko kp l kq kr">---<br/>title: "Hello World"<br/>date: 2019-06-18T03:15:54+02:00<br/>---</span><span id="dd82" class="km kn hi jv b fi ks kp l kq kr">Hello, world!</span></pre><p id="61bd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">此外，编辑<code class="du js jt ju jv b">config.toml</code>并通过更改<code class="du js jt ju jv b">title</code>和从<code class="du js jt ju jv b">baseURL</code>中移除<code class="du js jt ju jv b">example.org</code>来自定义站点配置:</p><pre class="ke kf kg kh fd ki jv kj kk aw kl bi"><span id="f641" class="km kn hi jv b fi ko kp l kq kr">baseURL = ""<br/>languageCode = "en-us"<br/>title = "Static Site on Google Cloud Run"<br/>theme = "ananke"</span></pre><p id="2884" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们现在可以生成HTML并运行服务器:</p><pre class="ke kf kg kh fd ki jv kj kk aw kl bi"><span id="50f6" class="km kn hi jv b fi ko kp l kq kr">$ hugo<br/>$ hugo server</span></pre><p id="7c1b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">默认的URL<a class="ae jw" href="http://localhost:1313/" rel="noopener ugc nofollow" target="_blank">http://localhost:1313/</a>应该向我们显示以下内容:</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/a8dc770a17837b3a01927db42afd0ffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxgoMYMr2I-tZR1uV0Kwkg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">它并不漂亮，但是，嘿，我们在这上面只花了一分钟，对吧？</figcaption></figure></div><div class="ab cl jx jy gp jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hb hc hd he hf"><p id="8e67" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们对一个静态站点进行dockerize。使用Hugo作为静态站点生成器和服务器的问题是性能和缺乏好的Docker图片。Nginx 是最快的网络服务器之一，提供标准的Docker镜像，性能影响很小。</p><p id="c93e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是我们的<code class="du js jt ju jv b">Dockerfile:</code></p><pre class="ke kf kg kh fd ki jv kj kk aw kl bi"><span id="99be" class="km kn hi jv b fi ko kp l kq kr"># Use a nginx Docker image<br/>FROM nginx</span><span id="01a3" class="km kn hi jv b fi ks kp l kq kr"># Copy the static HTMLs to the nginx directory<br/>COPY public /usr/share/nginx/html</span><span id="9e72" class="km kn hi jv b fi ks kp l kq kr"># Copy the nginx configuration template to the nginx config directory<br/>COPY nginx/default.template /etc/nginx/conf.d/default.template</span><span id="5cb4" class="km kn hi jv b fi ks kp l kq kr"># Substitute the environment variables and generate the final config<br/>CMD envsubst &lt; /etc/nginx/conf.d/default.template &gt; /etc/nginx/conf.d/default.conf &amp;&amp; exec nginx -g 'daemon off;'</span></pre><p id="addc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是我们的<code class="du js jt ju jv b">nginx/default.template</code>:</p><pre class="ke kf kg kh fd ki jv kj kk aw kl bi"><span id="5eb5" class="km kn hi jv b fi ko kp l kq kr">server {<br/>    listen       ${PORT};<br/>    server_name  localhost;</span><span id="cd19" class="km kn hi jv b fi ks kp l kq kr">    location / {<br/>        root   /usr/share/nginx/html;<br/>        index  index.html index.htm;<br/>    }<br/>}</span></pre><p id="9911" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du js jt ju jv b">Dockerfile</code>的前两行非常明显。但是，我们为什么要使用配置模板呢？<a class="ae jw" href="https://cloud.google.com/run/docs/reference/container-contract" rel="noopener ugc nofollow" target="_blank">谷歌云运行容器运行时合同</a>规定:</p><blockquote class="ku kv kw"><p id="bd48" class="iu iv kx iw b ix iy iz ja jb jc jd je ky jg jh ji kz jk jl jm la jo jp jq jr hb bi translated">容器必须在由<code class="du js jt ju jv b">PORT</code>环境变量定义的端口上监听<code class="du js jt ju jv b">0.0.0.0</code>上的请求。</p></blockquote><p id="7865" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">清楚了吗？</p><p id="a631" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果是，让我们构建并运行映像:</p><pre class="ke kf kg kh fd ki jv kj kk aw kl bi"><span id="9328" class="km kn hi jv b fi ko kp l kq kr">$ docker build -t static-google-cloud-run .<br/>$ docker run -p 1312:1312 -e PORT=1312 static-google-cloud-run</span></pre><p id="858a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae jw" href="http://localhost:1312/" rel="noopener ugc nofollow" target="_blank"> http://localhost:1312/ </a>应该会返回与上面相同的结果:</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/4876c8c24ce82eeb7b4a95940cfeda12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tmfJEYH0gug3kjek71A4qw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">仍然不漂亮，但是，嘿，我们只花了两分钟，对吧？</figcaption></figure></div><div class="ab cl jx jy gp jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hb hc hd he hf"><p id="8144" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">让Google Cloud运行我们的静态站点Docker映像吧！这是最后一步。我假设你已经安装了<a class="ae jw" href="https://cloud.google.com/sdk/" rel="noopener ugc nofollow" target="_blank"> Google Cloud SDK </a>，<a class="ae jw" href="https://console.cloud.google.com/marketplace/details/google-cloud-platform/cloud-run" rel="noopener ugc nofollow" target="_blank">启用了Google Cloud Run </a>，并且熟悉<a class="ae jw" href="https://cloud.google.com/sdk/gcloud/" rel="noopener ugc nofollow" target="_blank"> gcloud CLI工具</a>。我的谷歌云项目名称是<code class="du js jt ju jv b">maurycy-sandbox</code>，所以请用你正在使用的名称替换它。</strong></p><p id="e723" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，让我们使用<a class="ae jw" href="https://cloud.google.com/cloud-build/" rel="noopener ugc nofollow" target="_blank"> Google Cloud Build </a>构建图像:</p><pre class="ke kf kg kh fd ki jv kj kk aw kl bi"><span id="049e" class="km kn hi jv b fi ko kp l kq kr">$ gcloud builds submit --tag gcr.io/maurycy-sandbox/static-google-cloud-run</span></pre><p id="d30b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">几分钟后，您可以部署服务:</p><pre class="ke kf kg kh fd ki jv kj kk aw kl bi"><span id="b0f2" class="km kn hi jv b fi ko kp l kq kr">$ gcloud beta run deploy static-google-clod-run --image gcr.io/maurycy-sandbox/static-google-cloud-run</span></pre><p id="f336" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">控制台将输出:</p><pre class="ke kf kg kh fd ki jv kj kk aw kl bi"><span id="390d" class="km kn hi jv b fi ko kp l kq kr">Allow unauthenticated invocations to [static-google-clod-run] (y/N)? y</span><span id="46d4" class="km kn hi jv b fi ks kp l kq kr">Deploying container to Cloud Run service [static-google-clod-run] in project [maurycy-sandbox] region [us-central1]<br/>⠶ Deploying new service... Creating Resources.<br/>  ⠶ Creating Revision...<br/>  . Routing traffic...<br/>Done.<br/>Service [static-google-clod-run] revision [static-google-clod-run-00001] has been deployed and is serving traffic at <a class="ae jw" href="https://static-google-clod-run-6mirbza5oa-uc.a.run.app" rel="noopener ugc nofollow" target="_blank">https://static-google-clod-run-6mirbza5oa-uc.a.run.app</a></span></pre><p id="3ceb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">最后一行最重要。这将是不同的，但这是网站托管的地方，除非我们设置一个自定义域:</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/780f0cc48fbe2d73c471b3b25ef73e44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ed1uBQXKA-830l1cmdxE7A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">不漂亮，但是，嘿，只有三分钟，对吧？</figcaption></figure><p id="91d7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">万岁！我们完成了:我们在Google Cloud Run上有了一个非常可扩展的静态网站。你现在甚至可以绘制自己的领域地图。</p><p id="8208" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">PS。请不要忘记停止服务，无论是使用<a class="ae jw" href="https://console.cloud.google.com/run" rel="noopener ugc nofollow" target="_blank">控制台UI </a>还是<code class="du js jt ju jv b">gcloud</code>:</p><pre class="ke kf kg kh fd ki jv kj kk aw kl bi"><span id="7009" class="km kn hi jv b fi ko kp l kq kr">$ gcloud beta run services delete static-google-cloud-run</span></pre></div></div>    
</body>
</html>