<html>
<head>
<title>Keyless authentication to Google Cloud Platform using Workload Identity Federation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用工作负载身份联合对Google云平台进行无钥匙认证</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/keyless-authentication-to-google-cloud-platform-using-workload-identity-federation-5c41043acefb?source=collection_archive---------0-----------------------#2022-12-25">https://medium.com/google-cloud/keyless-authentication-to-google-cloud-platform-using-workload-identity-federation-5c41043acefb?source=collection_archive---------0-----------------------#2022-12-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e71d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谷歌一直在努力寻找新的方法来提高运行在谷歌云上的客户应用程序的安全性。谷歌新的安全改进是为服务账户提供无钥匙认证。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="0954" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行在Google cloud之外的应用程序需要访问用户范围之外的Google cloud中的服务，它大多使用服务帐户密钥。服务帐户密钥允许持有者充当服务帐户，并获得对服务帐户有权访问的任何资源的访问。<br/>不幸的是，无法验证访问服务帐户密钥的应用程序是否有权使用它。因此，服务帐户密钥的管理、轮换和存储成为任何在Google Cloud上运行的组织的首要任务。服务帐户密钥是强大的凭据，如果管理不当，可能会带来安全风险。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jk"><img src="../Images/0a3e55f845bd07ec13d53674b006297e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2bh7_w-rmQ4ANpeFGOw9yQ.png"/></div></div></figure></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="3f24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">管理服务帐户密钥的解决方案是什么？<br/> <strong class="ih hj">沟钥匙😎</strong></p><p id="a2fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Workload Identity Federation使运行在Google Cloud之外的应用程序能够用称为令牌的临时凭证替换长期服务帐户密钥。使用身份联合，您可以授予内部或多云工作负载对Google云资源的访问权限，而无需使用服务帐户密钥。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jw"><img src="../Images/e09a2e79f24543a739fc5794f93ac584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WtTNnE_J70C_uPwd8TnZBw.png"/></div></div></figure><p id="199d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">工作负载标识是如何工作的？<br/> </strong> <br/> 1。您应用程序向您的身份提供商进行身份验证，并接收帐户凭据。<br/> 2。然后，应用程序可以调用Google的安全令牌服务，将身份提供者发布的帐户凭证交换为一个短期的Google Cloud访问令牌。<br/> 3。然后，这个访问令牌可以用来模拟服务帐户并访问Google Cloud资源。</p><p id="4be9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用户可以通过Amazon Web Services (AWS)或任何支持OpenID Connect (OIDC)的身份提供商(如Microsoft Azure或SAML 2.0)使用身份联合。<br/>本文的其余部分讨论了使用Amazon Web Services的身份联盟</p><h1 id="2415" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">使用AWS的工作负载身份联合</h1><p id="2d20" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated"><strong class="ih hj">先决条件</strong></p><ul class=""><li id="e8ff" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lf lg lh li bi translated">确保您在项目中拥有工作负载身份池管理员(<code class="du lj lk ll lm b">roles/iam.workloadIdentityPoolAdmin</code>)和服务帐户管理员(<code class="du lj lk ll lm b">roles/iam.serviceAccountAdmin</code>)角色。或者，IAM所有者(<code class="du lj lk ll lm b">roles/owner</code>)基本角色还包括配置身份联盟的权限。</li><li id="5566" class="la lb hi ih b ii ln im lo iq lp iu lq iy lr jc lf lg lh li bi translated">启用API(IAM、资源管理器、服务帐户凭据和安全令牌服务)</li><li id="a178" class="la lb hi ih b ii ln im lo iq lp iu lq iy lr jc lf lg lh li bi translated">创建您希望外部身份模拟的服务帐户</li></ul><p id="d4b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建工作负载身份池</p><figure class="jl jm jn jo fd jp"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="3ff9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加工作负荷身份池提供程序</p><figure class="jl jm jn jo fd jp"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="f903" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将工作负荷身份用户角色(roles/iam.workloadIdentityUser)授予服务帐户</p><figure class="jl jm jn jo fd jp"><div class="bz dy l di"><div class="ls lt l"/></div></figure><blockquote class="lu lv lw"><p id="366b" class="if ig lx ih b ii ij ik il im in io ip ly ir is it lz iv iw ix ma iz ja jb jc hb bi translated">在上面的 gcloud <em class="hi">命令中，我正在绑定成员</em>上的服务帐户`wi-AWS @ demo-sandbox . iam . gserviceaccount . com `<em class="hi">工作负载身份用户角色principal set://iam . GOOGLE APIs . com/projects/GOOGLE _ PROJECT _ NUMBER/locations/global/workloadidentitytypools/demo-test-ID/attribute . AWS _ role/arn:AWS:STS::AWS _ ACCOUNT _ ID:assumed-role/GCP-role<br/>我只是将权限分配给在AWS中创建的特定gcp服务角色。有不同的方法来创建外部身份的标识符。请参考此<a class="ae mb" href="https://cloud.google.com/iam/docs/using-workload-identity-federation#gcloud" rel="noopener ugc nofollow" target="_blank">文件</a>了解更多信息。</em></p></blockquote><p id="2d2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建一个凭据配置文件，让应用程序获得访问令牌</p><figure class="jl jm jn jo fd jp"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="a318" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以在AWS环境中使用<em class="lx"> client-config.json </em>文件来认证和访问GCP资源，而无需创建服务帐户密钥。😉<br/>有关我们如何使用json文件向GCP认证的信息，请参考GCP <a class="ae mb" href="https://cloud.google.com/iam/docs/using-workload-identity-federation#gcloud_2" rel="noopener ugc nofollow" target="_blank">文档</a></p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="f892" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到此为止，我们已经结束了这个博客。我将发布更多关于与Azure和On-Prem联合的博客。请小心这个地方。</p><p id="9204" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢你的阅读，如果你觉得它有用，别忘了给它一个大拇指。谢谢大家！！</p></div></div>    
</body>
</html>