<html>
<head>
<title>Audit Logging on GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GCP上的审核日志记录</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/audit-logging-on-gcp-73bd0d7e1d10?source=collection_archive---------4-----------------------#2017-03-23">https://medium.com/google-cloud/audit-logging-on-gcp-73bd0d7e1d10?source=collection_archive---------4-----------------------#2017-03-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="0702" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">两周前在Google Cloud Next上，我有机会与许多使用或试用Google产品的人聊天。关于变更管理和审计日志的问题经常出现。有些人想要配置更改的通知。其他人想要一种快速简单的方法来查看谁在做什么，以便进行审计。许多与会者不知道Google Cloud现有的审计日志功能，也不知道如何对特定的审计事件设置警报。如果你需要做这些类型的任务，这篇博客应该可以帮助你开始。</p><h2 id="e787" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">第一:警觉哲学</h2><p id="1948" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">有许多方法可以发出警报。根据我多年来随身携带寻呼机的经验，我对什么类型的提醒是有用的和合适的有自己的看法。</p><p id="0c4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的基本原则是警报应该是可操作的。这是一种普遍的哲学。保罗·纽森(SRE倡导者)告诉我，提醒的媒介应该与提醒的紧急程度相匹配。页面应该是需要立即关注的东西。应该在未来12小时内处理的项目可能会进入票务系统。不紧急的警报可能会被发送到电子邮件中，而不会被阅读。</p><p id="9217" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我还希望我的监控系统具有良好的信噪比。任何不可操作的警报或者由于其他情况我可以忽略的警报都会增加噪音。我知道很多人最终会把电话或寻呼机放在冰箱里过夜，因为它会不停地重复一个错误的页面。</p><p id="2833" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">监控方法涉及的内容还很多。以上想法是在设置系统时需要考虑的一些事情。查看SRE图书<a class="ae kd" href="https://landing.google.com/sre/book/chapters/monitoring-distributed-systems.html" rel="noopener ugc nofollow" target="_blank">中关于监控分布式系统的章节</a>，了解更多关于谷歌如何进行监控的信息。</p><h2 id="8ad6" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">查看审计日志</h2><p id="2340" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">要查看审计日志，请从云控制台主页开始，然后单击“活动”这会将您带到“审计日志摘要”页面。有两种审计日志:管理活动和数据访问。管理活动包括资源创建、更新和删除。管理活动还包括通过gcloud SDK或使用web UI对系统进行的API调用。支持管理活动日志的产品列表是<a class="ae kd" href="https://cloud.google.com/logging/docs/audit/#admin_activity_logs" rel="noopener ugc nofollow" target="_blank">这里是</a>。</p><p id="63bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据访问日志跟踪对数据库和其他数据存储中用户提供的数据的访问。目前，唯一支持数据访问日志的产品是BigQuery。数据访问日志在审计日志摘要的默认视图中不可见。</p><p id="3c0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有项目成员都可以看到管理活动日志。数据访问日志仅对拥有私有日志查看者IAM角色的用户可见。</p><p id="cbe8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">审核日志摘要允许您查看生成日志的操作以及执行该操作的用户(由其电子邮件地址标识)。您可以一次查看多个项目的日志，并将视图限制为特定类型的资源、日志类型和时间范围。</p><h2 id="335f" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">查看堆栈驱动程序日志中的审核日志</h2><p id="5538" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">摘要视图的数据量相对有限。如果您需要高级过滤或者想要查看整个日志消息，您应该使用<a class="ae kd" href="https://console.cloud.google.com/logs" rel="noopener ugc nofollow" target="_blank"> Stackdriver Logging </a>。在Stackdriver Logging中，选择您感兴趣的资源类型，然后在包含不同日志类型的下拉列表中选择“activity”。</p><p id="aa87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果展开日志消息，您可以看到身份验证信息、调用的方法、事件消息以及关于请求的其他信息。需要注意的一件重要事情是，每个管理操作都有两个关联的日志。一个事件记录操作的开始，另一个事件记录操作的完成。您可以使用顶部的自由文本字段来搜索特定的日志，或者您可以单击eventMessage或methodName之类的字段，并选择显示或隐藏类似的消息。</p><h2 id="082e" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">审计日志警报</h2><p id="30d6" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">在审核日志上设置警报与设置其他形式的基于日志的警报相同。您需要从Stackdriver日志日志查看器开始。然后，您可以使用上述方法构建过滤器，以缩小您想要警报的特定消息的范围。</p><p id="bc9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">缩小搜索范围后，使用“创建指标”按钮创建一个<a class="ae kd" href="https://cloud.google.com/logging/docs/view/logs_based_metrics" rel="noopener ugc nofollow" target="_blank">指标</a>。度量是基于特定日志记录查询的数据，日志记录将这些数据提供给Stackdriver Monitoring。</p><p id="771f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦您创建了指标，请转到<a class="ae kd" href="http://console.cloud.google.com/monitoring" rel="noopener ugc nofollow" target="_blank">堆栈驱动程序监控</a>并单击“创建警报策略”当您为警报设置条件时，选择“日志度量”作为资源，您将在日志查看器中看到您之前创建的度量。然后，您可以根据紧急程度设置通知方法。Webhook alerts非常适合将Stackdriver监控连接到您的票务系统。信息提示如果出现在HipChat这样的团队聊天程序中可能是最好的。我还喜欢包含一些文档，告诉我在收到这个警告时应该做什么，这样如果有一堆东西正在燃烧，我就可以快速提醒我从哪里开始寻找。</p><p id="82e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ke">原载于</em><a class="ae kd" href="http://thagomizer.com/blog/2017/03/23/audit-logging-on-gcp.html" rel="noopener ugc nofollow" target="_blank"><em class="ke">Thagomizer——命运之刺</em> </a></p></div></div>    
</body>
</html>