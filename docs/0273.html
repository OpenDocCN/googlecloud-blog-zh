<html>
<head>
<title>GCP + GPUs ğŸ’™ Kubernetes (and Tensorflow)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GCP+GPUğŸ’™Kubernetes(å’ŒTensorflow)</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/google-cloud/gcp-gpus-juju-kubernetes-and-tensorflow-5f9f7fe38538?source=collection_archive---------1-----------------------#2017-05-04">https://medium.com/google-cloud/gcp-gpus-juju-kubernetes-and-tensorflow-5f9f7fe38538?source=collection_archive---------1-----------------------#2017-05-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6a5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å½“æˆ‘å‡ å‘¨å‰å†™å¦‚ä½•åœ¨Kubernetes ä¸Šéƒ¨ç½²<a class="ae jd" rel="noopener" href="/intuitionmachine/kubernetes-gpus-tensorflow-8696232862ca"> Tensorflowæ—¶ï¼Œæˆ‘åˆ©ç”¨AWSä½œä¸ºæˆ‘çš„äº‘åŸºç¡€ã€‚ä¸€ä½è¯»è€…è¯„è®ºå¹¶è¯¢é—®å¦‚ä½•åœ¨</a><a class="ae jd" href="https://cloud.google.com" rel="noopener ugc nofollow" target="_blank">è°·æ­Œäº‘å¹³å°</a>ä¸Šè®¾ç½®GPUé›†ç¾¤ã€‚</p><p id="4520" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘è¯´è¿‡æˆ‘ä¼šå›ç­”Vikasï¼Œæ‰€ä»¥è¿™å°±æ˜¯ï¼Œåœ¨<a class="ae jd" href="https://cloud.google.com" rel="noopener ugc nofollow" target="_blank">è°·æ­Œäº‘å¹³å°</a>ä¸Šç”¨GPUéƒ¨ç½²<a class="ae jd" href="https://kubernetes.io" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>çš„æ–¹æ³•ã€‚</p><h1 id="ee2c" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">è¦æ±‚</h1><p id="6c46" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">è¦å¤åˆ¶è¿™ç¯‡æ–‡ç« ï¼Œä½ éœ€è¦:</p><ul class=""><li id="2742" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">äº†è§£å·¥å…·<a class="ae jd" href="http://www.canonical.com" rel="noopener ugc nofollow" target="_blank"> Canonical </a>å¼€å‘å’Œä½¿ç”¨:<a class="ae jd" href="http://www.ubuntu.com" rel="noopener ugc nofollow" target="_blank"> Ubuntu </a>å’Œ<a class="ae jd" href="https://jujucharms.com/" rel="noopener ugc nofollow" target="_blank">Juju</a>ï¼›</li><li id="443f" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">ä¸€ä¸ªGCPçš„ç®¡ç†å‘˜å¸æˆ·å’Œè¶³å¤Ÿçš„é…é¢ï¼Œä»¥æ·»åŠ è‡³å°‘3ä¸ªGPUs</li><li id="a4e1" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">å¯¹Kuberneteså·¥å…·çš„ç†è§£:</li><li id="358e" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">å®‰è£…äº†Jujuçš„Ubuntu 16.04æˆ–æ›´é«˜ç‰ˆæœ¬ã€CentOS 6+ã€MacOS Xæˆ–Windows 7+è®¡ç®—æœºã€‚è¿™ä¸ªåšå®¢å°†ä¼šå…³æ³¨Ubuntuï¼Œä½†æ˜¯ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªå±•ç¤ºæ¥éµå¾ªå…¶ä»–æ“ä½œç³»ç»Ÿçš„æŒ‡å¯¼æ–¹é’ˆã€‚</li></ul><p id="bace" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚æœæ‚¨åœ¨éƒ¨ç½²æ—¶é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæˆ–è€…æ‚¨æœ‰ç‰¹å®šçš„éœ€æ±‚ï¼Œè¯·é€šè¿‡IRCä¸æˆ‘è”ç³»ã€‚æˆ‘æ˜¯Freenode #jujuä¸Šçš„SaMnCoï¼Œ<a class="ae jd" href="https://jujucharms.com/kubernetes" rel="noopener ugc nofollow" target="_blank"> CDK </a>å›¢é˜Ÿçš„å…¶ä»–æˆå‘˜ä¹Ÿå¯ä»¥åœ¨é‚£é‡Œæä¾›å¸®åŠ©ã€‚</p><h1 id="c542" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">å‡†å¤‡æ‚¨çš„ç¯å¢ƒ</h1><p id="4c02" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">é¦–å…ˆï¼Œè®©æˆ‘ä»¬åœ¨æ‚¨çš„æœºå™¨ä¸Šéƒ¨ç½²Jujuä»¥åŠä¸€äº›æœ‰ç”¨çš„å·¥å…·:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="218a" class="le jf hi la b fi lf lg l lh li">sudo add-apt-repository -y ppa:juju/devel<br/>sudo apt update<br/>sudo apt install -yqq juju jq git<br/>export SDK_SRC=https://dl.google.com/dl/cloudsdk/channels/rapid/downloads<br/>export SDK_VERSION=154.0.0<br/>wget ${SDK_SRC}/google-cloud-sdk-${SDK_VERSION}-linux-x86_64.tar.gz<br/>tar xfz google-cloud-sdk-${SDK_VERSION}-linux-x86_64.tar.gz &amp;&amp; \<br/>  google-cloud-sdk/install.sh<br/># This is interactive<br/>rm google-cloud-sdk-${SDK_VERSION}-linux-x86_64.tar.gz</span></pre><p id="7cdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æŒ‰ç…§<a class="ae jd" href="https://jujucharms.com/docs/2.1/help-google" rel="noopener ugc nofollow" target="_blank">æœ¬é¡µ</a>çš„è¯´æ˜ï¼Œä¸ºJujuå‡†å¤‡ä¸€ä¸ªé¡¹ç›®å’Œæ‚¨çš„GCPè¯ä¹¦ï¼Œå¹¶å¡«å†™:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="f5c3" class="le jf hi la b fi lf lg l lh li">juju add-credential google</span></pre><p id="c7fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸Šé¢ä¸€è¡Œæ˜¯äº¤äº’å¼çš„ï¼Œå°†å¼•å¯¼æ‚¨å®Œæˆæ•´ä¸ªè¿‡ç¨‹ã€‚æœ€åï¼Œè®©æˆ‘ä»¬ä¸‹è½½kubectlå’Œhelm</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="d043" class="le jf hi la b fi lf lg l lh li"># kubectl<br/>curl -LO <a class="ae jd" href="https://storage.googleapis.com/kubernetes-release/release/1.6.2/bin/linux/amd64/kubectl" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/kubernetes-release/release/1.6.2/bin/linux/amd64/kubectl</a><br/>chmod +x kubectl &amp;&amp; sudo mv kubectl /usr/local/bin/</span></pre><p id="90ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å…‹éš†æ­¤å­˜å‚¨åº“ä»¥è®¿é—®æºæ–‡æ¡£:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="b7ed" class="le jf hi la b fi lf lg l lh li">git clone <a class="ae jd" href="https://github.com/madeden/blogposts.git" rel="noopener ugc nofollow" target="_blank">https://github.com/madeden/blogposts.git</a><br/>cd blogposts/k8s-tensorflow</span></pre><p id="2734" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¥½å§ï¼æˆ‘ä»¬å‡†å¤‡å¥½äº†ã€‚</p><h1 id="2b85" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">éƒ¨ç½²é›†ç¾¤</h1><p id="6fee" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">å› ä¸ºæˆ‘ä»¬æƒ³ä½¿ç”¨GPUï¼Œå°±åƒAWSä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦å°å¿ƒæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„AZã€‚ä¾‹å¦‚ï¼Œåœ¨us-east1ä¸­ï¼Œåªæœ‰us-east1-dæ”¯æŒGPUã€‚è°·æ­Œåœ¨è¿™ä¸ªé¡µé¢ä¸Šæä¾›äº†å…³äºè¿™äº›åœ°ç‚¹çš„æ–‡æ¡£ã€‚</p><p id="e11b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GCEæœ‰ä¸€ç§éå¸¸ç‰¹æ®Šçš„æ–¹å¼æ¥ç®¡ç†azå’Œå­ç½‘ï¼Œå¹¶ä¸”ä¸ä¸ºæ”¯æŒGPUçš„æœºå™¨æä¾›å®ä¾‹ç±»å‹(GPUå¯ä»¥åœ¨å¯åŠ¨æ—¶æ·»åŠ åˆ°å‡ ä¹ä»»ä½•å®ä¾‹ç±»å‹ä¸­)ã€‚</p><p id="892e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å› æ­¤ï¼Œä¸ºäº†åœ¨GCEçš„GPUä¸Šéƒ¨ç½²K8sï¼Œæ‚¨å¿…é¡»</p><ol class=""><li id="9ed8" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc lj kn ko kp bi translated">å¼•å¯¼å¹¶éƒ¨ç½²Kubernetesçš„æ§åˆ¶é¢æ¿</li><li id="22f0" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc lj kn ko kp bi translated">æ‰‹åŠ¨åˆ›å»ºGPUå®ä¾‹</li><li id="099b" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc lj kn ko kp bi translated">ä¸€æ—¦å¯åŠ¨ï¼Œå°†è¿™äº›æœºå™¨æ·»åŠ åˆ°Juju</li><li id="09f0" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc lj kn ko kp bi translated">å‘Šè¯‰Jujuåœ¨ä»–ä»¬èº«ä¸Šéƒ¨ç½²å·¥äºº</li></ol><p id="e732" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™ç¦æ­¢ä½¿ç”¨åŒ…ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†éƒ¨ç½²å°†æ˜¯æ‰‹åŠ¨çš„ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="3180" class="le jf hi la b fi lf lg l lh li">juju bootstrap google/us-east1 <br/>juju add-model k8s</span></pre><p id="301f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‰‹åŠ¨éƒ¨ç½²æ§åˆ¶é¢æ¿å’Œä»…ç”¨äºCPUçš„ç¬¬ä¸€ä¸ªå·¥ä½œæœº</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="e03f" class="le jf hi la b fi lf lg l lh li">juju deploy cs:~containers/kubernetes-master-17<br/>juju deploy cs:~containers/etcd-29 --to 0<br/>juju deploy cs:~containers/easyrsa-8 --to lxd:0<br/>juju deploy cs:~containers/flannel-13<br/>juju deploy cs:~containers/kubernetes-worker-22<br/>juju expose kubernetes-master<br/>juju expose kubernetes-worker</span></pre><p id="acd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å‘é¡¹ç›®æ·»åŠ Juju SSHå¯†é’¥</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="de56" class="le jf hi la b fi lf lg l lh li">gcloud compute project-info add-metadata \<br/> --metadata-from-file sshKeys=~/.local/share/juju/ssh/juju_id_rsa_gce.pub</span></pre><p id="28f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">æ³¨</strong>:è¿™ä¸ªã€‚pubæ˜¯ä¸ºgceæ”¹ç¼–çš„é»˜è®¤juju_id_rsa.pubæ–‡ä»¶çš„å‰¯æœ¬ï¼Œçœ‹èµ·æ¥åƒ</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="28a8" class="le jf hi la b fi lf lg l lh li">ubuntu:ssh-rsa [KEY VALUE] ubuntu</span></pre><p id="2316" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°å…³äºè¿™ä¸ª<a class="ae jd" href="https://cloud.google.com/compute/docs/instances/adding-removing-ssh-keys#project-wide" rel="noopener ugc nofollow" target="_blank">çš„å®˜æ–¹æ–‡æ¡£ã€‚ç°åœ¨ï¼Œä½¿ç”¨ä»¥ä¸‹å†…å®¹åˆ›å»ºæ‰€æœ‰è®¡ç®—æœº:</a></p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="8872" class="le jf hi la b fi lf lg l lh li">for i in $(seq 1 1 3)<br/>do <br/> gcloud beta compute instances create kubernetes-worker-gpu-${i} \<br/>  --machine-type n1-standard-2 \<br/>  --zone us-east1-d \<br/>  --accelerator type=nvidia-tesla-k80,count=1 \<br/>  --image-family ubuntu-1604-lts \<br/>  --image-project ubuntu-os-cloud \<br/>  --maintenance-policy TERMINATE \<br/>  --metadata block-project-ssh-keys=FALSE \<br/>  --restart-on-failure<br/> sleep 5<br/>done</span></pre><p id="d846" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¯¹äºæ¯å°æœºå™¨ï¼Œæˆ‘ä»¬éƒ½ä¼šå¾—åˆ°è¿™æ ·çš„ç­”æ¡ˆ:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="2b29" class="le jf hi la b fi lf lg l lh li">Created [<a class="ae jd" href="https://www.googleapis.com/compute/beta/projects/jaas-151616/zones/us-east1-d/instances/kubernetes-worker-gpu-2" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/compute/beta/projects/jaas-151616/zones/us-east1-d/instances/kubernetes-worker-gpu-2</a>].<br/>NAME                     ZONE        MACHINE_TYPE   PREEMPTIBLE  INTERNAL_IP  EXTERNAL_IP   STATUS<br/>kubernetes-worker-gpu-2  us-east1-d  n1-standard-2               10.142.0.5   35.185.74.56  RUNNING</span></pre><p id="3652" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è®°ä¸‹æ¯å°æœºå™¨çš„å…¬å…±IPåœ°å€</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="10f9" class="le jf hi la b fi lf lg l lh li">juju add-machine ssh:ubuntu@35.185.74.56 # use the Public IP</span></pre><p id="4c30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä½ ä¼šå¾—åˆ°è¿™æ ·çš„ç­”æ¡ˆ</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="ecbf" class="le jf hi la b fi lf lg l lh li">WARNING Skipping CA server verification, using Insecure option<br/>created machine 2</span></pre><p id="8fe6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒJujuçš„çŠ¶æ€å¦‚ä¸‹:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="0b6b" class="le jf hi la b fi lf lg l lh li">$ juju status<br/>Model  Controller  Cloud/Region     Version      SLA<br/>k8s    k8s         google/us-east1  2.2-beta4.1  unsupported</span><span id="7a01" class="le jf hi la b fi lk lg l lh li">App                Version  Status   Scale  Charm              Store       Rev  OS      Notes<br/>easyrsa            3.0.1    active       1  easyrsa            jujucharms    8  ubuntu  <br/>etcd               2.3.8    blocked      1  etcd               jujucharms   29  ubuntu  <br/>kubernetes-master  1.6.1    blocked      1  kubernetes-master  jujucharms   17  ubuntu  <br/>kubernetes-worker  1.6.1    blocked      1  kubernetes-worker  jujucharms   22  ubuntu</span><span id="f3b6" class="le jf hi la b fi lk lg l lh li">Unit                  Workload  Agent  Machine  Public address  Ports  Message<br/>easyrsa/0*            active    idle   0/lxd/0  10.0.19.96             Certificate Authority ready.<br/>etcd/0*               blocked   idle   0        35.185.1.113           Missing relation to certificate authority.<br/>kubernetes-master/0*  blocked   idle   0        35.185.1.113           Relate kubernetes-master:kube-control kubernetes-worker:kube-control<br/>kubernetes-worker/0*  blocked   idle   1        35.185.118.158         Relate kubernetes-worker:kube-control kubernetes-master:kube-control</span><span id="115e" class="le jf hi la b fi lk lg l lh li">Machine  State    DNS             Inst id                Series  AZ          Message<br/>0        started  35.185.1.113    juju-f1c96a-0          xenial  us-east1-b  RUNNING<br/>0/lxd/0  started  10.0.19.96      juju-f1c96a-0-lxd-0    xenial              Container started<br/>1        started  35.185.118.158  juju-f1c96a-1          xenial  us-east1-c  RUNNING<br/>2        started  35.185.22.159   manual:35.185.22.159   xenial              Manually provisioned machine<br/>3        started  35.185.74.56    manual:35.185.74.56    xenial              Manually provisioned machine<br/>4        started  35.185.112.159  manual:35.185.112.159  xenial              Manually provisioned machine</span><span id="5a3b" class="le jf hi la b fi lk lg l lh li">Relation  Provides  Consumes  Type<br/>cluster   etcd      etcd      peer</span></pre><p id="37be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‚¨å¯ä»¥æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬å°†æœºå™¨2åˆ°4ä½œä¸ºæ‰‹åŠ¨å®ä¾‹æ·»åŠ ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥å‘Šè¯‰jujuå°†è¿™äº›ç”¨äºé¢å¤–çš„å·¥äºº:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="f9bb" class="le jf hi la b fi lf lg l lh li"># Adding all machines as workers<br/>for unit in $(seq 2 1 4)<br/>do<br/> juju add-unit kubernetes-worker --to ${unit}<br/>done</span><span id="f4fe" class="le jf hi la b fi lk lg l lh li"># Add Relations between charms<br/>juju add-relation kubernetes-master:kube-api-endpoint  kubernetes-worker:kube-api-endpoint<br/>juju add-relation kubernetes-master:kube-control  kubernetes-worker:kube-control<br/>juju add-relation kubernetes-master:certificates  easyrsa:client<br/>juju add-relation kubernetes-master:etcd  etcd:db<br/>juju add-relation kubernetes-worker:certificates  easyrsa:client<br/>juju add-relation etcd:certificates  easyrsa:client<br/>juju add-relation flannel:etcd  etcd:db<br/>juju add-relation flannel:cni  kubernetes-master:cni<br/>juju add-relation flannel:cni  kubernetes-worker:cni</span><span id="be59" class="le jf hi la b fi lk lg l lh li"># Watch results<br/>watch -c juju status --color</span></pre><figure class="kv kw kx ky fd lm er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es ll"><img src="../Images/a5dc4765919954cfaf724465a1a72095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cnizn-fPo-05vLOdgvy1zQ.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">CUDAéƒ¨ç½²åœ¨æ‰‹åŠ¨éƒ¨ç½²çš„æ”¯æŒGPUçš„GCPå®ä¾‹ä¸Š</figcaption></figure><p id="134c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨æˆ‘ä»¬å¯ä»¥æµ‹è¯•CUDAæ˜¯å¦å®‰è£…äº†</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="f783" class="le jf hi la b fi lf lg l lh li">juju ssh 2 "sudo nvidia-smi"<br/>Thu May  4 07:20:37 2017       <br/>+-----------------------------------------------------------------------------+<br/>| NVIDIA-SMI 375.51                 Driver Version: 375.51                    |<br/>|-------------------------------+----------------------+----------------------+<br/>| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |<br/>| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |<br/>|===============================+======================+======================|<br/>|   0  Tesla K80           Off  | 0000:00:04.0     Off |                    0 |<br/>| N/A   74C    P0    77W / 149W |      0MiB / 11439MiB |    100%      Default |<br/>+-------------------------------+----------------------+----------------------+<br/>                                                                               <br/>+-----------------------------------------------------------------------------+<br/>| Processes:                                                       GPU Memory |<br/>|  GPU       PID  Type  Process name                               Usage      |<br/>|=============================================================================|<br/>|  No running processes found                                                 |<br/>+-----------------------------------------------------------------------------+<br/>Connection to 35.185.22.159 closed.</span></pre><p id="bc54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çš„é›†ç¾¤æ˜¯ä»€ä¹ˆæ ·å­:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="b12c" class="le jf hi la b fi lf lg l lh li">juju scp kubernetes-master/0:config ~/.kube/config<br/>kubectl get nodes --show-labels<br/>NAME                      STATUS    AGE       VERSION   LABELS<br/>juju-f1c96a-1             Ready     28m       v1.6.1    beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/hostname=juju-f1c96a-1<br/>kubernetes-worker-gpu-1   Ready     17m       v1.6.1    beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,<strong class="la hj">cuda=true,gpu=true</strong>,kubernetes.io/hostname=kubernetes-worker-gpu-1<br/>kubernetes-worker-gpu-2   Ready     17m       v1.6.1    beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,<strong class="la hj">cuda=true,gpu=true</strong>,kubernetes.io/hostname=kubernetes-worker-gpu-2<br/>kubernetes-worker-gpu-3   Ready     17m       v1.6.1    beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,<strong class="la hj">cuda=true,gpu=true</strong>,kubernetes.io/hostname=kubernetes-worker-gpu-3</span></pre><p id="2731" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæ ‡ç­¾å·²ç»è¢«æ·»åŠ åˆ°èŠ‚ç‚¹ä¸­ï¼Œ<strong class="ih hj"> cuda=true </strong>å’Œ<strong class="ih hj"> gpu=true </strong>ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åƒå¾€å¸¸ä¸€æ ·éƒ¨ç½²æˆ‘ä»¬çš„nvidia-smiä½œä¸š</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="3298" class="le jf hi la b fi lf lg l lh li">kubectl create -f ./src/nvidia-smi.yaml</span></pre><p id="dc27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä»¬å¾—åˆ°äº†æ—¥å¿—:</p><figure class="kv kw kx ky fd lm er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lx"><img src="../Images/a302a97a7769154f2875c0fcf70661af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zWeyPK6UFYHzObwNuwMiNQ.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">GCP Kubernetesä¸Šçš„GPUå·¥ä½œè´Ÿè½½</figcaption></figure><h1 id="b35e" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">ç»“è®º</h1><p id="c9b1" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">ç°åœ¨æˆ‘ä»¬åœ¨Kubernetesä¸Šæœ‰äº†ä¸€ä¸ªåˆé€‚çš„GPUé›†ç¾¤ï¼Œå‰©ä¸‹çš„å’Œæˆ‘çš„å…¶ä»–å®éªŒç±»ä¼¼ã€‚ä½¿ç”¨Helmï¼ŒKubernetesæä¾›äº†ä¸€ä¸ªé€‚å½“çš„äº‘æŠ½è±¡å±‚ï¼Œå› æ­¤æ‚¨å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨å®ƒæ¥éƒ¨ç½²æ‚¨æœ€å–œæ¬¢çš„GPUå·¥ä½œè´Ÿè½½ï¼</p><p id="0dec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å°½æƒ…äº«å—å§ï¼å¦‚æœä½ å–œæ¬¢è¿™ä¸ªæˆ–å‘ç°å®ƒæœ‰ç”¨ï¼Œä¸è¦çŠ¹è±«ï¼ŒæŒ‰ä¸‹å°å¿ƒè„æŒ‰é’®ï¼Œå®ƒæ€»æ˜¯æœ‰å¸®åŠ©çš„:)</p></div></div>    
</body>
</html>