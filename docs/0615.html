<html>
<head>
<title>NOTE: Cloud Pub/Sub Client Libraries Authentication local development vs. Jenkins</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">注意:云发布/订阅客户端库身份验证本地开发与Jenkins</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/note-cloud-pub-sub-client-libraries-authentication-local-development-vs-jenkins-bc27586ebc5e?source=collection_archive---------3-----------------------#2018-05-22">https://medium.com/google-cloud/note-cloud-pub-sub-client-libraries-authentication-local-development-vs-jenkins-bc27586ebc5e?source=collection_archive---------3-----------------------#2018-05-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1640" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在尝试对Jenkins运行本地发布/订阅测试时，在这方面有一些反复，所以我想在这里记下来。借助面向发布/订阅的云客户端库，您可以作为开发人员使用gcloud在本地进行身份验证:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="1fdc" class="jm jn hi ji b fi jo jp l jq jr">gcloud auth application-default login</span></pre><p id="1d87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将打开一个浏览器，我们打印一个网址，并提示输入验证码。这将适用于所有使用该库的api调用。现在，假设您的用户拥有适当的IAM角色，您将能够针对Google Cloud发布/订阅使用客户端库，并以与CI中相同的方式在本地测试您的工作。</p><p id="085c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于我们的CI来说，詹金斯，我们必须做一些事情。我们在Google Cloud中创建了一个服务帐户，应用了正确的IAM角色，并下载了json密钥。在Jenkins中使用机密文件的凭据类型创建了凭据:</p><figure class="jd je jf jg fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es js"><img src="../Images/429dacb637f32dd1a72879a75ad400f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dFnV61gGjHlETUe0onK0Xg.png"/></div></div></figure><p id="4ce9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，在JenkinsFile中，您将希望使用<a class="ae ka" href="https://jenkins.io/doc/pipeline/steps/credentials-binding" rel="noopener ugc nofollow" target="_blank">凭证绑定插件</a>创建一个变量。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="8d54" class="jm jn hi ji b fi jo jp l jq jr">stage('test') {<br/>    steps{<br/>      echo "Starting build ${BUILD_ID} for ${JOB_NAME}"<br/>      withCredentials([[$class: 'FileBinding', credentialsId: 'my-key-id', variable: 'GOOGLE_APPLICATION_CREDENTIALS']]) {<br/>          sh "gradle my-project:test"<br/>      }</span></pre><p id="d5a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您在该绑定中包含使用客户端库的任何内容，应用程序默认凭据(ADC)将使用该变量。在我们的例子中，是一个gradle任务，用于测试主题和订阅的创建，以及一个push/pull。例如，在您使用App Engine Standard的情况下，这应该适用于新旧客户端库。</p></div></div>    
</body>
</html>