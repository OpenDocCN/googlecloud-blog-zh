<html>
<head>
<title>Building a Serverless Go App on Google Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在谷歌云上构建无服务器Go应用</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/building-a-serverless-go-app-on-google-cloud-90240fba9845?source=collection_archive---------1-----------------------#2017-03-31">https://medium.com/google-cloud/building-a-serverless-go-app-on-google-cloud-90240fba9845?source=collection_archive---------1-----------------------#2017-03-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="0ac9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">受Laurent Picard的<a class="ae jd" rel="noopener" href="/google-cloud/building-a-serverless-python-app-in-minutes-with-gcp-5184d21a012f">与GCP </a>在几分钟内构建无服务器Python应用程序的启发，这是一组类似的步骤，但使用了Go应用程序和应用程序引擎的灵活环境。</p><p id="6ab1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">网络应用列出了作者，并使用<a class="ae jd" href="https://developers.google.com/books/docs/v1/reference/volumes" rel="noopener ugc nofollow" target="_blank">谷歌图书API</a>来搜索作者的出版作品。</p><h2 id="802b" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">TL；博士；医生</h2><p id="7551" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">下面将稍微详细介绍几个命令。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="a092" class="je jf hi kj b fi kn ko l kp kq">PROJECT=my-project-name<br/># create a project<br/># <a class="ae jd" href="https://cloud.google.com/sdk/gcloud/reference/alpha/projects/create" rel="noopener ugc nofollow" target="_blank">cloud.google.com/sdk/gcloud/reference/alpha/projects/create</a><br/>gcloud alpha projects create $PROJECT</span><span id="d953" class="je jf hi kj b fi kr ko l kp kq"># set the project as default<br/>gcloud config set core/project $PROJECT</span><span id="4c29" class="je jf hi kj b fi kr ko l kp kq">#<br/># write your code, test it locally<br/>#<br/>mkdir $GOPATH/src/github.com/you/$PROJECT<br/>cd $GOPATH/src/github.com/you/$PROJECT</span><span id="217f" class="je jf hi kj b fi kr ko l kp kq"># create an app.yaml to define deployment<br/># ref <a class="ae jd" href="https://cloud.google.com/appengine/docs/flexible/go/configuring-your-app-with-app-yaml" rel="noopener ugc nofollow" target="_blank">cloud.google.com/appengine/docs/flexible/go/configuring-your-app-with-app-yaml</a><br/>vi app.yaml</span><span id="c015" class="je jf hi kj b fi kr ko l kp kq"># deploy!<br/>gcloud app deploy</span></pre><h2 id="0ac6" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">先决条件:安装Google Cloud SDK cli</h2><p id="2a87" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated"><a class="ae jd" href="https://cloud.google.com/sdk/downloads" rel="noopener ugc nofollow" target="_blank">安装Google Cloud SDK命令行工具</a>——这将贯穿始终。</p><h2 id="dfdb" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">创建一个谷歌云项目</h2><p id="a567" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">使用<code class="du ks kt ku kj b"> <a class="ae jd" href="https://cloud.google.com/sdk/gcloud/reference/alpha/projects/create" rel="noopener ugc nofollow" target="_blank">gcloud alpha create</a></code>命令，创建一个新项目。注意，这是一个“alpha release”命令，所以将来可能会改变。非alpha方式是使用基于web的云控制台:<a class="ae jd" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com</a>。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="739b" class="je jf hi kj b fi kn ko l kp kq">$ gcloud alpha projects create go-serverless<br/>Create in progress for [<a class="ae jd" href="https://cloudresourcemanager.googleapis.com/v1/projects/go-serverless" rel="noopener ugc nofollow" target="_blank">https://cloudresourcemanager.googleapis.com/v1/projects/go-serverless</a>].<br/>Waiting for [operations/pc.7509198304344852511] to finish…done.</span></pre><h2 id="0091" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">列出现有项目</h2><p id="1b33" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">如果这不是你的第一个谷歌云项目，你可能已经有多个项目了，所以这里有一个有用的命令来检查你有什么项目</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="7de3" class="je jf hi kj b fi kn ko l kp kq">$ gcloud projects list<br/>PROJECT_ID NAME PROJECT_NUMBER<br/>bespokemirrorapi bespokemirrorapi 811093430365<br/>gdgnoco-fortune gdgnoco-fortune 861018601285<br/>go-serverless go-serverless 49448245715<br/>…</span></pre><h2 id="e0c5" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">设置默认项目</h2><p id="c6ca" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">后续的<code class="du ks kt ku kj b">gcloud</code>命令将与一个项目相关联，因此将默认项目设置为我们新创建的项目是很有用的。创建新项目不会自动将其设定为默认项目。</p><p id="1005" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用<code class="du ks kt ku kj b">gcloud config list</code>列出当前所有项目配置，用<code class="du ks kt ku kj b">gcloud set …</code>设置一个配置项。</p><p id="10e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将<code class="du ks kt ku kj b">core/project</code>属性设置为<code class="du ks kt ku kj b">go-serverless</code>:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="d5b0" class="je jf hi kj b fi kn ko l kp kq"><br/>$ gcloud config set core/project go-serverless<br/>Updated property [core/project].<br/>$ gcloud config list<br/>[compute]<br/>zone = us-central1-c<br/>[core]<br/>account = <a class="ae jd" href="mailto:ghchinoy@gmail.com" rel="noopener ugc nofollow" target="_blank">ghchinoy@gmail.com</a><br/>disable_usage_reporting = False<br/>project = go-serverless</span><span id="e52f" class="je jf hi kj b fi kr ko l kp kq">Your active configuration is: [default]<br/></span></pre><h2 id="8af0" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">在本地创建应用程序</h2><ul class=""><li id="089c" class="kv kw hi ih b ii jz im ka iq kx iu ky iy kz jc la lb lc ld bi translated">创建项目目录</li><li id="a36c" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">创建一个部署文件<code class="du ks kt ku kj b">app.yaml</code></li></ul><p id="b874" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按照惯例，Go项目放在<code class="du ks kt ku kj b">$GOPATH\src</code>下的一个文件夹中，通常与一个存储库相关联。在这里，我使用我的github作为路径创建一个项目，并切换到创建的目录:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="7677" class="je jf hi kj b fi kn ko l kp kq"><br/>$ mkdir -p $GOPATH/src/github.com/ghchinoy/go-serverless<br/>$ cd $GOPATH/src/github.com/ghchinoy/go-serverless<br/></span></pre><p id="1c9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加一个名为<code class="du ks kt ku kj b">app.yaml</code>的新文件，该文件定义了在App Engine的灵活环境中的部署(参见<a class="ae jd" href="https://cloud.google.com/appengine/docs/flexible/go/configuring-your-app-with-app-yaml" rel="noopener ugc nofollow" target="_blank">AE flex的App . YAML</a>)</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="6112" class="je jf hi kj b fi kn ko l kp kq"><br/>runtime: go<br/>env: flex<br/>api_version: 1</span><span id="9bb7" class="je jf hi kj b fi kr ko l kp kq">skip_files:<br/>- README.md<br/></span></pre><p id="4878" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加代码，<code class="du ks kt ku kj b">main.go</code>的片段(完整代码见<a class="ae jd" href="https://github.com/ghchinoy/go-serverless" rel="noopener ugc nofollow" target="_blank">来源</a></p><figure class="ke kf kg kh fd lj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><h2 id="ece7" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">本地测试</h2><p id="5ff0" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">在本地运行应用程序；在<a class="ae jd" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank">查看http://localhost:8080 </a></p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="7daa" class="je jf hi kj b fi kn ko l kp kq"><br/>$ go run main.go template.go<br/>2017/03/30 15:55:21 booklist<br/>127.0.0.1 — — [30/Mar/2017:15:55:24 -0600] “GET / HTTP/1.1” 200 1584 “” “Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3056.0 Safari/537.36”<br/>…<br/></span></pre><figure class="ke kf kg kh fd lj er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lm"><img src="../Images/8da2dad001e3ae1506fb84bcff6bc7b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*99RFxv0L6sEx-_ji5HQA1Q.png"/></div></div></figure><figure class="ke kf kg kh fd lj er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lt"><img src="../Images/f9eba5e5b73b22aa961cfb01235e4c99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xTgYDfcXSwGGmdiZcXCRbQ.png"/></div></div></figure><h2 id="e1f6" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">部署</h2><p id="103d" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">确保项目已配置为计费，在浏览器中访问<a class="ae jd" href="https://console.developers.google.com/project/go-serverless/settings`" rel="noopener ugc nofollow" target="_blank">https://console . developers . Google . com/project/go-server less/settings</a>，用您自己的名称替换项目名称<code class="du ks kt ku kj b">go-serverless</code>。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="1e04" class="je jf hi kj b fi kn ko l kp kq"><br/>$ gcloud app deploy<br/>You are creating an app for project [go-serverless].<br/>WARNING: Creating an App Engine application for a project is irreversible and the region<br/>cannot be changed. More information about regions is at<br/><a class="ae jd" href="https://cloud.google.com/appengine/docs/locations" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/appengine/docs/locations</a>.</span><span id="01f4" class="je jf hi kj b fi kr ko l kp kq">Please choose the region where you want your App Engine application<br/>located:</span><span id="1aa8" class="je jf hi kj b fi kr ko l kp kq">[1] europe-west (supports standard and flexible)<br/> [2] us-east1 (supports standard and flexible)<br/> [3] us-central (supports standard and flexible)<br/> [4] asia-northeast1 (supports standard and flexible)<br/> [5] cancel<br/>Please enter your numeric choice: 3</span><span id="38df" class="je jf hi kj b fi kr ko l kp kq">Creating App Engine application in project [go-serverless] and region [us-central]….done.<br/>You are about to deploy the following services:<br/> — go-serverless/default/20170330t205543 (from [/Users/ghc/dev/go/src/github.com/ghchinoy/go-serverless/app.yaml])<br/> Deploying to URL: [<a class="ae jd" href="https://go-serverless.appspot.com" rel="noopener ugc nofollow" target="_blank">https://go-serverless.appspot.com</a>]</span><span id="814f" class="je jf hi kj b fi kr ko l kp kq">Do you want to continue (Y/n)? Y</span><span id="1cfc" class="je jf hi kj b fi kr ko l kp kq">If this is your first deployment, this may take a while…done.</span><span id="bbad" class="je jf hi kj b fi kr ko l kp kq">Beginning deployment of service [default]…<br/>Building and pushing image for service [default]<br/>Some files were skipped. Pass ` — verbosity=info` to see which ones</span><span id="30c2" class="je jf hi kj b fi kr ko l kp kq">…</span><span id="b68a" class="je jf hi kj b fi kr ko l kp kq">Updating service [default]…done.<br/>Deployed service [default] to [<a class="ae jd" href="https://go-serverless.appspot.com" rel="noopener ugc nofollow" target="_blank">https://go-serverless.appspot.com</a>]</span><span id="c143" class="je jf hi kj b fi kr ko l kp kq">You can stream logs from the command line by running:<br/> $ gcloud app logs tail -s default</span><span id="977a" class="je jf hi kj b fi kr ko l kp kq">To view your application in the web browser run:<br/> $ gcloud app browse</span></pre><p id="1e5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">部署完毕！</p><p id="dae5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://go-serverless.appspot.com/" rel="noopener ugc nofollow" target="_blank">https://go-serverless.appspot.com/</a></p><figure class="ke kf kg kh fd lj er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lu"><img src="../Images/3c99ba85bde68beeabe5d54e2da306fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O0KdGkBv8RapfMKldnITOQ.png"/></div></div></figure><ul class=""><li id="b3b0" class="kv kw hi ih b ii ij im in iq lv iu lw iy lx jc la lb lc ld bi translated"><a class="ae jd" href="https://github.com/ghchinoy/go-serverless" rel="noopener ugc nofollow" target="_blank">https://github.com/ghchinoy/go-serverless</a></li><li id="4ca1" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><a class="ae jd" href="https://go-serverless.appspot.com/" rel="noopener ugc nofollow" target="_blank">https://go-serverless.appspot.com/</a></li></ul></div></div>    
</body>
</html>