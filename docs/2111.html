<html>
<head>
<title>Google Cloud Anthos Series: Anthos Service Mesh</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云Anthos系列:Anthos服务网格</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-cloud-anthos-series-part4-e23172b61ec9?source=collection_archive---------1-----------------------#2022-02-15">https://medium.com/google-cloud/google-cloud-anthos-series-part4-e23172b61ec9?source=collection_archive---------1-----------------------#2022-02-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="c010" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">谷歌云Anthos系列:<strong class="ak"> Part-4 </strong></h2></div><p id="c330" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated"><span class="l ju jv jw bm jx jy jz ka kb di">欢迎来到“谷歌云系列”的第4部分。你可以在这里找到完整的系列<a class="ae kc" rel="noopener" href="/google-cloud/google-cloud-anthos-series-23b9a35e9179"/>。</span></p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es kd"><img src="../Images/420067712f688bbcd11e1d39a89b1ac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c-Yr_6v13ocZE1mYraNgaQ.png"/></div></div></figure><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es kp"><img src="../Images/b5fa79544f7d4b6690d7c6b7c2064e7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m7aQveYB94z2VBGg-t-d4w.png"/></div></div></figure><p id="81a9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这些是使用Anthos服务网格时容器化工作负载的部署选项。</p><ul class=""><li id="d354" class="kq kr hi iz b ja jb jd je jg ks jk kt jo ku js kv kw kx ky bi translated">集群内控制平面:在集群内部署中，Istiod安装在您自己的集群中。</li><li id="c5ef" class="kq kr hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated">托管Anthos服务网格:通过托管Anthos服务网格，Google可以为您处理升级、扩展和安全问题，最大限度地减少手动用户维护。</li></ul><p id="d0bf" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于此部署，我们将使用集群内部署，该部署与我们在“Google Cloud Devops系列”中使用的在线精品应用程序相同<a class="ae kc" rel="noopener" href="/google-cloud/google-cloud-devops-part-1-introduction-to-google-native-devops-process-bfb55be9e3f3">此处</a>。</p><p id="745e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">设置</strong> <code class="du le lf lg lh b"><strong class="iz hj">PROJECT_ID</strong></code> <strong class="iz hj">环境变量，确保Google Kubernetes引擎和云操作API启用。</strong></p><pre class="ke kf kg kh fd li lh lj lk aw ll bi"><span id="89f1" class="lm ln hi lh b fi lo lp l lq lr">PROJECT_ID="&lt;your-project-id&gt;"<br/>gcloud services enable container.googleapis.com --project ${PROJECT_ID}<br/>gcloud services enable monitoring.googleapis.com \<br/>    cloudtrace.googleapis.com \<br/>    clouddebugger.googleapis.com \<br/>    cloudprofiler.googleapis.com \<br/>    --project ${PROJECT_ID}</span></pre><p id="a755" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">克隆在线精品知识库。</strong></p><pre class="ke kf kg kh fd li lh lj lk aw ll bi"><span id="f480" class="lm ln hi lh b fi lo lp l lq lr">git clone <a class="ae kc" href="https://github.com/GoogleCloudPlatform/microservices-demo.git" rel="noopener ugc nofollow" target="_blank">https://github.com/GoogleCloudPlatform/microservices-demo.git</a><br/>cd microservices-demo</span></pre><p id="7f2a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">在三个不同的地区创建三个GKE集群。</strong></p><pre class="ke kf kg kh fd li lh lj lk aw ll bi"><span id="814f" class="lm ln hi lh b fi lo lp l lq lr">ZONE1=us-central1-b<br/>ZONE2=europe-west1-b<br/>ZONE3=asia-south1-b</span><span id="bb09" class="lm ln hi lh b fi ls lp l lq lr">gcloud container clusters create us-gke-cluster \<br/>    --project=${PROJECT_ID} --zone=${ZONE1} \<br/>    --machine-type=e2-standard-2 --num-nodes=4 \<br/>    --scopes=cloud-platform \<br/>    <!-- -->--workload-pool=<!-- -->${PROJECT_ID}<!-- -->.svc.id.goog</span><span id="9da1" class="lm ln hi lh b fi ls lp l lq lr">gcloud container clusters create eu-gke-cluster \<br/>    --project=${PROJECT_ID} --zone=${ZONE2} \<br/>    --machine-type=e2-standard-2 --num-nodes=4 \<br/>    --scopes=cloud-platform \<br/>    <!-- -->--workload-pool=<!-- -->${PROJECT_ID}<!-- -->.svc.id.goog</span><span id="73d8" class="lm ln hi lh b fi ls lp l lq lr">gcloud container clusters create asia-gke-cluster \<br/>    --project=${PROJECT_ID} --zone=${ZONE3} \<br/>    --machine-type=e2-standard-2 --num-nodes=4 \<br/>    --scopes=cloud-platform \<br/>    <!-- -->--workload-pool=<!-- -->${PROJECT_ID}<!-- -->.svc.id.goog</span></pre><p id="1bfb" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">在每个集群中安装Anthos服务网格。</strong></p><pre class="ke kf kg kh fd li lh lj lk aw ll bi"><span id="9a6b" class="lm ln hi lh b fi lo lp l lq lr">curl https://storage.googleapis.com/csm-artifacts/asm/asmcli &gt; asmcli</span><span id="a8b8" class="lm ln hi lh b fi ls lp l lq lr">chmod +x asmcli</span><span id="c1cd" class="lm ln hi lh b fi ls lp l lq lr">./asmcli install \<br/>  --project_id $PROJECT_ID \<br/>  --cluster_name <!-- -->us-gke-cluster<!-- --> \<br/>  --cluster_location <!-- -->$ZONE1<!-- --> \<br/>  --enable_all \<br/>  --ca mesh_ca</span><span id="64f2" class="lm ln hi lh b fi ls lp l lq lr">./asmcli install \<br/>  --project_id $PROJECT_ID \<br/>  --cluster_name <!-- -->eu-gke-cluster<!-- --> \<br/>  --cluster_location <!-- -->$ZONE2<!-- --> \<br/>  --enable_all \<br/>  --ca mesh_ca</span><span id="4ef9" class="lm ln hi lh b fi ls lp l lq lr">./asmcli install \<br/>  --project_id $PROJECT_ID \<br/>  --cluster_name <!-- -->asia-gke-cluster<!-- --> \<br/>  --cluster_location <!-- -->$ZONE3<!-- --> \<br/>  --enable_all \<br/>  --ca mesh_ca</span></pre><p id="b58b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有一个可选标志- -fleet_id。Fleets(以前称为environs)是Google Cloud的一个概念，用于逻辑地组织集群和其他资源，让您可以使用和管理多集群功能，并在您的系统中应用一致的策略。在我们的例子中，因为所有的集群都在同一个项目中，所以我们不需要指定fleet-id。</p><p id="8eb0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">安装完成后，检查控制面板盒是否正在运行。</strong></p><p id="79b7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">版本标签在<code class="du le lf lg lh b">rev=</code>之后，为版本标签值创建环境变量。</p><pre class="ke kf kg kh fd li lh lj lk aw ll bi"><span id="adaa" class="lm ln hi lh b fi lo lp l lq lr">kubectl -n istio-system get pods -l app=istiod --show-labels</span><span id="e22e" class="lm ln hi lh b fi ls lp l lq lr">REV=[rev-label]</span></pre><p id="55e3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">通过使用kubectx命令更改kubectl上下文，为所有集群启用sidecar注入。</strong></p><pre class="ke kf kg kh fd li lh lj lk aw ll bi"><span id="63c5" class="lm ln hi lh b fi lo lp l lq lr">kubectx gke_${PROJECT_ID}_${ZONE1}_us-gke-cluster</span><span id="6e68" class="lm ln hi lh b fi ls lp l lq lr">kubectl label namespace default istio.io/rev=${REV} istio-injection- --overwrite</span><span id="0446" class="lm ln hi lh b fi ls lp l lq lr">kubectx gke_${PROJECT_ID}_${ZONE2}_eu-gke-cluster</span><span id="38ac" class="lm ln hi lh b fi ls lp l lq lr">kubectl label namespace default istio.io/rev=${REV} istio-injection- --overwrite</span><span id="4dd4" class="lm ln hi lh b fi ls lp l lq lr">kubectx gke_${PROJECT_ID}_${ZONE3}_asia-gke-cluster</span><span id="649f" class="lm ln hi lh b fi ls lp l lq lr">kubectl label namespace default istio.io/rev=${REV} istio-injection- --overwrite</span></pre><p id="c197" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以放心地忽略“未找到”错误。</p><p id="79fb" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">将应用程序部署到集群。</strong></p><pre class="ke kf kg kh fd li lh lj lk aw ll bi"><span id="1e33" class="lm ln hi lh b fi lo lp l lq lr">kubectx gke_${PROJECT_ID}_${ZONE1}_us-gke-cluster<br/>kubectl apply -f ./release/kubernetes-manifests.yaml</span><span id="e445" class="lm ln hi lh b fi ls lp l lq lr">kubectx gke_${PROJECT_ID}_${ZONE2}_eu-gke-cluster<br/>kubectl apply -f ./release/kubernetes-manifests.yaml</span><span id="9478" class="lm ln hi lh b fi ls lp l lq lr">kubectx gke_${PROJECT_ID}_${ZONE3}_asia-gke-cluster<br/>kubectl apply -f ./release/kubernetes-manifests.yaml</span></pre><p id="d581" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">等待容器准备好，检查每个容器中是否有两个容器。</p><pre class="ke kf kg kh fd li lh lj lk aw ll bi"><span id="774c" class="lm ln hi lh b fi lo lp l lq lr">kubectx gke_${PROJECT_ID}_${ZONE1}_us-gke-cluster<br/>kubectl get pods</span></pre><p id="b4d8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">使用Anthos服务网格仪表板评估服务性能</strong></p><ol class=""><li id="b636" class="kq kr hi iz b ja jb jd je jg ks jk kt jo ku js lt kw kx ky bi translated">在控制台中，进入<strong class="iz hj">导航菜单</strong>&gt;<strong class="iz hj">Anthos</strong>&gt;<strong class="iz hj">仪表盘</strong>。</li><li id="0f57" class="kq kr hi iz b ja kz jd la jg lb jk lc jo ld js lt kw kx ky bi translated">点击<strong class="iz hj">服务网格</strong>。</li></ol><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es lu"><img src="../Images/dafaa92fe02c6e1bcfb0fdd77e365f1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YRVmGtrrNLoGJ4kY0wqAwA.png"/></div></div></figure><p id="5e77" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.您应该能够查看service wise仪表板并获得拓扑指标。</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es lv"><img src="../Images/1cc94adad13f29c8ee1de8d11b29ba98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zEPKsX5F9eFt5_KmryYxGg.png"/></div></div></figure><p id="19b4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以使用不同的服务探索仪表板。</p><p id="f32d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">4.使用拓扑视图更好地可视化您的网格</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es lw"><img src="../Images/818288d43c7c29aadcf2b60358f8a047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qKxNeq6FqGESKLPmnbQf6g.png"/></div></div></figure><p id="d01a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">即将到来..</p><p id="4bfe" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇博客中，我们讨论了Anthos服务网格。在接下来的博客中，我们将继续Samajik的旅程和其他Anthos特性。</p><p id="866f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">供稿人:<a class="lx ly ge" href="https://medium.com/u/41b475b881ff?source=post_page-----e23172b61ec9--------------------------------" rel="noopener" target="_blank">施吉木尔·阿克</a>，<a class="lx ly ge" href="https://medium.com/u/c79cc28e2999?source=post_page-----e23172b61ec9--------------------------------" rel="noopener" target="_blank">普什卡·科塔瓦德</a>，<a class="lx ly ge" href="https://medium.com/u/71d9487165c6?source=post_page-----e23172b61ec9--------------------------------" rel="noopener" target="_blank">丹杜斯</a></p></div></div>    
</body>
</html>