<html>
<head>
<title>Developing a Serverless Web Application Completely on Google Cloud (1 of 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">完全基于Google Cloud开发无服务器的Web应用程序(第1页，共2页)</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/developing-a-serverless-web-application-completely-on-google-cloud-1-of-2-31e48298626d?source=collection_archive---------3-----------------------#2022-09-16">https://medium.com/google-cloud/developing-a-serverless-web-application-completely-on-google-cloud-1-of-2-31e48298626d?source=collection_archive---------3-----------------------#2022-09-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6291" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不用下载任何东西，用Firebase和NodeJS构建一个无服务器的web应用程序！</p><h1 id="828d" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated"><strong class="ak">简介</strong></h1><h2 id="9b7a" class="kb je hi bd jf kc kd ke jj kf kg kh jn iq ki kj jr iu kk kl jv iy km kn jz ko bi translated">目的</h2><p id="7dd9" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">本文的目的是帮助读者理解一些用于应用程序开发的Google Cloud产品的基本原理，并获得在Google Cloud平台上构建Firebase web应用程序的实践经验，而不必将任何东西下载到他们的本地环境中。在本文结束时，读者将对构建无服务器web应用程序有所了解。本文将展示如何在本机模式下使用实时NoSQL数据库和云Firestore，使用Firebase启用身份验证，使用云存储存储静态文件，使用云功能执行无基础设施管理的逻辑，以及使用App Engine部署应用程序。</p><p id="47b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请随意使用这个<a class="ae ku" href="https://github.com/brianhmj/severlessNodeFirebaseApp/tree/main" rel="noopener ugc nofollow" target="_blank"> Github页面</a>跟随。每个分支都有示例代码，您应该在特定步骤结束时就有了。</p><h2 id="f193" class="kb je hi bd jf kc kd ke jj kf kg kh jn iq ki kj jr iu kk kl jv iy km kn jz ko bi translated">突出</h2><ul class=""><li id="cd8f" class="kv kw hi ih b ii kp im kq iq kx iu ky iy kz jc la lb lc ld bi translated">通过在线开发环境使用云外壳，该环境内置了对Go、Java等的云代码插件支持和语言支持。Net，Python和NodeJS称为<strong class="ih hj">云壳编辑器</strong>。</li><li id="fef0" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">使用NodeJS、ReactJS和<strong class="ih hj"> Firebase </strong>创建一个不需要下载任何东西，具有用户认证、实时数据库、存储和云功能的web应用。</li><li id="05ed" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">使用<strong class="ih hj">应用程序引擎</strong>，通过零服务器管理和零配置部署来部署您的网站。然后尝试应用程序版本化和创建开发、测试和生产环境。</li></ul><h2 id="a67b" class="kb je hi bd jf kc kd ke jj kf kg kh jn iq ki kj jr iu kk kl jv iy km kn jz ko bi translated">观众</h2><p id="36cb" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">这篇文章应该与任何想了解更多关于Google云平台上的应用程序开发的人相关。我写这篇文章时考虑了一些先决条件。</p><ul class=""><li id="4622" class="kv kw hi ih b ii ij im in iq lj iu lk iy ll jc la lb lc ld bi translated">基于Debian的Linux终端基本技能</li><li id="bc75" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">对云架构的基本理解</li><li id="b54f" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">NodeJS和ReactJS的一些经验</li><li id="f923" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">信用卡来建立一个谷歌云项目</li></ul><h2 id="9556" class="kb je hi bd jf kc kd ke jj kf kg kh jn iq ki kj jr iu kk kl jv iy km kn jz ko bi translated">放弃</h2><p id="f8a4" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">本文不是构建和部署生产就绪应用程序的推荐实践，只是探索Google云平台和学习的一种有趣方式。本文中的任何观点都是我自己的，而不是谷歌的。</p><p id="7714" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Google Inc .不保证或担保上述信息的准确性，也不对因使用或依赖这些信息而导致的任何性质的损失或损害负责。Google Inc .不保证使用此处包含的任何信息不会侵犯第三方的专利、商标、版权或权利。</p><p id="4063" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">整个演示可以通过免费试用积分来完成(截至2022年9月16日，新客户仍可获得300美元的免费积分)，大多数服务不应超过免费配额。但是，您有责任按照清理说明停止所有服务，以避免向您的帐户收取费用。</p><h1 id="56b1" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">安装</h1><h2 id="ecd2" class="kb je hi bd jf kc kd ke jj kf kg kh jn iq ki kj jr iu kk kl jv iy km kn jz ko bi translated">设置Google云</h2><p id="f5d9" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">谷歌云平台(Google Cloud Platform)是谷歌的公共云供应商，为全球用户提供虚拟资源。谷歌云服务运行在谷歌内部用于终端用户产品(如搜索和Youtube)的同一基础设施上。本指南将举例说明如何使用Google Cloud开发和托管web应用程序。阅读更多关于谷歌云的<a class="ae ku" href="https://cloud.google.com/docs/overview" rel="noopener ugc nofollow" target="_blank">整体景观。</a></p><p id="2996" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，让我们使用Google帐户登录云控制台。如果您使用的是公司帐户，则必须拥有登录云控制台的权限。也可以创建一个新帐户来探索Google Cloud。如果这是您第一次访问云控制台，您需要接受所有必要的协议，并使用信用卡设置账单。(不要担心，谷歌在试用结束前不会向你收费)</p><p id="7eb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你进入云控制台，<a class="ae ku" href="https://cloud.google.com/resource-manager/docs/creating-managing-projects" rel="noopener ugc nofollow" target="_blank">创建一个Google Cloud项目</a>，作为顶层容器保存你所有的应用资源和其他Google Cloud资源。让我们将这个新项目命名为<strong class="ih hj"> <em class="lm"> my-test-project </em> </strong>。</p><blockquote class="ln lo lp"><p id="dc22" class="if ig lm ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">给那些担心用完免费资源和被收费的人一个提示，请随时去账单页面查看你的资源使用情况和剩余点数。</p></blockquote><h2 id="cb59" class="kb je hi bd jf kc kd ke jj kf kg kh jn iq ki kj jr iu kk kl jv iy km kn jz ko bi translated">设置开发环境</h2><p id="1045" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">随着公司继续将其应用和服务迁移到云，开发人员需要访问云资源。谷歌提供<a class="ae ku" href="https://cloud.google.com/shell" rel="noopener ugc nofollow" target="_blank">云外壳</a>，这是一个在线开发和运营环境，你可以在任何地方通过浏览器访问。Cloud Shell还附带了一个由Eclipse忒伊亚IDE平台支持的Cloud Shell编辑器。Cloud Shell Editor预装了Google Cloud CLI，允许用户通过丰富的语言支持访问云原生开发。</p><p id="b982" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了设置我们的开发环境，让我们使用源代码库和云外壳。源存储库将允许协作和版本控制。点击谷歌云控制台顶部的<strong class="ih hj">激活云外壳</strong>，从你的云控制台打开云外壳。等待Google Cloud提供您的云外壳并连接到环境。</p><p id="6b03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在在Cloud Shell中，创建一个名为myapp的空存储库。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="7574" class="kb je hi ly b fi mc md l me mf">gcloud source repos <strong class="ly hj">create</strong> <strong class="ly hj">myapp</strong></span></pre><p id="0a5d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果没有启用源存储库API，它会要求您启用并重试。一旦您看到myApp已经创建，在用您的项目ID替换<em class="lm">【您的项目ID】</em>之后，通过运行下面的命令将存储库克隆到您当前的云Shell环境中。您还可以从云源存储库页面访问您的新存储库，并克隆到您的本地环境。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="cd93" class="kb je hi ly b fi mc md l me mf">gcloud source repos <strong class="ly hj">clone</strong> <strong class="ly hj">myapp</strong> --project=[YOUR PROJECT ID]</span></pre><p id="33fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在通过点击云壳窗口工具栏上的打开编辑器按钮来启动云壳编辑器。您将能够看到您创建的空myApp目录。</p><h2 id="554a" class="kb je hi bd jf kc kd ke jj kf kg kh jn iq ki kj jr iu kk kl jv iy km kn jz ko bi translated">创建一个包含多个页面的简单ReactJS应用程序</h2><p id="0518" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">现在是设置的最后一步，让我们在存储库中创建一个新的React应用程序。回到云Shell，将目录更改为存储库并运行<em class="lm"> create react app </em>。您将在这里使用npx，它是npm附带的npm包运行程序。请注意，您不必安装npm，这是因为npm已经预装在您的云Shell实例中。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="f4e7" class="kb je hi ly b fi mc md l me mf">npx create-react-app my-app</span></pre><p id="b5f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回到云Shell编辑器，您应该会看到ReactJS应用程序的基本设置。回到Cloud Shell，将目录更改为my-app，并尝试运行该应用程序。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="90ae" class="kb je hi ly b fi mc md l me mf">npm start</span></pre><p id="5f58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">端口3000上已经有东西在运行，所以当它要求在不同的端口上运行时，请按“y”。要查看正在运行的应用程序，请按web预览按钮，将预览端口更改为本地端口(对我来说是3001)并预览。您可以保持此选项卡打开，从云外壳编辑器对App.js的任何编辑都将更新此页面。</p><p id="dfab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们想要创建一个具有多个页面的应用程序，这可以通过使用React Router来实现。首先，让我们将App.js文件精简到最低限度。函数应用程序返回您将在网页上看到的组件。更改App.js并保存它，以查看对构建的影响。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="1e4e" class="kb je hi ly b fi mc md l me mf">// App.js<br/><strong class="ly hj">import</strong> './App.css';<br/><br/><strong class="ly hj">function</strong> <strong class="ly hj">App</strong>() {<br/> <strong class="ly hj">return</strong> (<br/>   &lt;div className="App"&gt;<br/>       This is an App<br/>   &lt;/div&gt;<br/> );<br/>}<br/><strong class="ly hj">export</strong> <strong class="ly hj">default</strong> App;</span></pre><p id="8360" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该会看到一个相当空的页面，在网页的顶部中间有“这是一个应用程序”的字样。现在让我们为我们的应用程序创建不同的页面。首先在/src中创建一个名为pages的目录。在pages中，创建三个新的javascript文件，分别命名为HomePg.js、LoginPg.js和PostPg.js。复制App.js的内容，不包括<strong class="ih hj"> <em class="lm">导入。/app . CSS '；</em> </strong>行到这些新页面，并更改函数名，分别导出到HomePg、LoginPg、PostPg。</p><p id="82ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该有以下脚本，包括上面给出的App.js脚本。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="6280" class="kb je hi ly b fi mc md l me mf">//HomePg.js<strong class="ly hj"><br/>import</strong> React <strong class="ly hj">from</strong> "react";<br/><br/><strong class="ly hj">function</strong> <strong class="ly hj">HomePg</strong>() {<br/>   <strong class="ly hj">return</strong> (<br/>     &lt;div className="App"&gt;<br/>         This is the home page<br/>     &lt;/div&gt;<br/>   );<br/> }<br/> <strong class="ly hj">export</strong> <strong class="ly hj">default</strong> HomePg;</span><span id="fbf4" class="kb je hi ly b fi mg md l me mf">//LoginPg.js<br/><strong class="ly hj">import</strong> React <strong class="ly hj">from</strong> "react";<br/><br/><strong class="ly hj">function</strong> <strong class="ly hj">LoginPg</strong>() {<br/>   <strong class="ly hj">return</strong> (<br/>     &lt;div className="App"&gt;<br/>         This is the login page<br/>     &lt;/div&gt;<br/>   );<br/> }<br/> <strong class="ly hj">export</strong> <strong class="ly hj">default</strong> LoginPg;</span><span id="15cc" class="kb je hi ly b fi mg md l me mf">//PostPg.js<br/><strong class="ly hj">import</strong> React <strong class="ly hj">from</strong> "react";<br/><br/><strong class="ly hj">function</strong> <strong class="ly hj">PostPg</strong>() {<br/>   <strong class="ly hj">return</strong> (<br/>     &lt;div className="App"&gt;<br/>         This is the post page<br/>     &lt;/div&gt;<br/>   );<br/> }<br/> <strong class="ly hj">export</strong> <strong class="ly hj">default</strong> PostPg;</span></pre><p id="67ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们将这些页面导入到主应用程序中，并为用户创建导航到这些新页面的路径。首先，让我们使用npm来安装<em class="lm"> react-router-dom </em>库，它将允许我们在web应用程序中使用React Router。回到Cloud Shell，在my-app目录下运行以下命令。(如果您仍在浏览器中运行my-app，您可以使用control+c关闭它。)</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="5ad8" class="kb je hi ly b fi mc md l me mf">npm <strong class="ly hj">install</strong> react-router-dom</span></pre><p id="14b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，在主应用程序中导入页面，并创建一个导航栏和路线。它应该类似于下面的代码片段。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="94b6" class="kb je hi ly b fi mc md l me mf">//App.js<br/><strong class="ly hj">import</strong> './App.css';<br/><strong class="ly hj">import</strong> { BrowserRouter as Router, Routes, Route, Link } <strong class="ly hj">from</strong> "react-router-dom";<br/><br/><strong class="ly hj">import</strong> HomePg <strong class="ly hj">from</strong> "./pages/HomePg";<br/><strong class="ly hj">import</strong> PostPg <strong class="ly hj">from</strong> "./pages/PostPg";<br/><strong class="ly hj">import</strong> LoginPg <strong class="ly hj">from</strong> "./pages/LoginPg";<br/><br/><strong class="ly hj">function</strong> App() {<br/> <strong class="ly hj">return</strong> (<br/>   &lt;Router&gt;<br/>       &lt;nav&gt;<br/>           &lt;Link <strong class="ly hj">to</strong>="/"&gt; Home &lt;/Link&gt;<br/>           &lt;Link <strong class="ly hj">to</strong>="/login"&gt; Login &lt;/Link&gt;<br/>           &lt;Link <strong class="ly hj">to</strong>="/post"&gt; Post &lt;/Link&gt;<br/>       &lt;/nav&gt;<br/>       &lt;Routes&gt;<br/>           &lt;Route path="/" element={&lt;HomePg/&gt;} /&gt;<br/>           &lt;Route path="/post" element={&lt;PostPg/&gt; } /&gt;<br/>           &lt;Route path="/login" element={&lt;LoginPg/&gt; } /&gt;<br/>       &lt;/Routes&gt;<br/>   &lt;/Router&gt;<br/> );<br/>}<br/><br/><strong class="ly hj">export</strong> <strong class="ly hj">default</strong> App;</span></pre><p id="004e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，当您运行应用程序和视图时，您应该会看到一种导航到不同页面的方法，尝试使用不同的页面。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="9d7b" class="kb je hi ly b fi mc md l me mf">npm start</span></pre><p id="8bc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您已经创建了一个包含多个页面的简单web应用程序，以及一种导航这些页面的方法。在进入下一部分之前，您可以在这里休息一下，在下一部分中，您将集成Firebase并为您的应用程序创建一个身份验证过程。在您关闭所有东西之前，让我们确保所有的辛苦工作都保存到了云源代码库中。首先，让我们通过在Cloud Shell中运行以下代码来确保您有一个身份，用您的电子邮件地址和姓名更改[您的电子邮件]和[您的姓名]。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="44e5" class="kb je hi ly b fi mc md l me mf">git config --global user.email "[YOUR EMAIL]"<br/>git config --global user.name "[YOUR NAME]"</span></pre><p id="e1cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在添加您创建的所有内容，并提交更改。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="d932" class="kb je hi ly b fi mc md l me mf">&gt;&gt; git <strong class="ly hj">add</strong> .<br/>&gt;&gt; git commit -m "[COMMIT MESSAGE]"</span></pre><p id="772b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您提交您的更改时，如果提交消息为空，git将中止提交。请用任何消息替换[提交消息]或<em class="lm">第一次提交</em>。最后，您必须将它推送到云源代码库，在那里您的代码将被安全地存储。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="08c8" class="kb je hi ly b fi mc md l me mf">git <strong class="ly hj">push</strong></span></pre><p id="a2a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">恭喜您，您已经成功将您的作品推送到云源码库！</p><h1 id="90b3" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">集成燃烧基</h1><h2 id="f859" class="kb je hi bd jf kc kd ke jj kf kg kh jn iq ki kj jr iu kk kl jv iy km kn jz ko bi translated">将Firebase添加到项目中</h2><p id="946d" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">Firebase是Google开发的一个平台，用于创建移动和网络应用程序，它使应用程序的开发变得更加容易。要开始使用Firebase，我们需要将Firebase添加到现有的Google项目中。记得当我们建立谷歌云的时候，我们创建了我们一直在做的项目<em class="lm">我的测试项目</em>。前往<a class="ae ku" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>，用你一直使用的谷歌账户登录。登录后，单击添加项目。从下拉菜单中选择您现有的Google Cloud项目，然后单击继续。对于这个演示，我们不需要启用谷歌分析，点击添加Firebase完成。</p><p id="f7a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您已经将Firebase连接到项目！然而，我们仍然需要将Firebase添加到我们的应用程序中。Firebase控制台中的项目页面将有一个带有HTML标记图标的Web应用程序启动按钮。按下它会要求一个应用昵称，让我们命名为<em class="lm">我的第一个网络应用</em>。不要勾选Firebase主机，我们稍后会做主机。点击注册应用程序。</p><p id="f037" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个页面现在给出了添加Firebase SDK的方向。回到Cloud Shell，在my-app目录中，安装带有npm的Firebase SDK。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="0d73" class="kb je hi ly b fi mc md l me mf">npm <strong class="ly hj">install</strong> firebase</span></pre><p id="721c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们必须为React应用程序中的应用程序初始化Firebase。让我们回到云Shell编辑器，在src目录中，添加一个firebase-config.js javascript文件。将Firebase控制台中的代码片段复制到firebase-config.js文件中。它应该看起来像这样。不要对配置进行任何更改！</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="a51f" class="kb je hi ly b fi mc md l me mf"><em class="lm">// firebase-config.js<br/>// Import the functions you need from the SDKs you need</em><br/>import { initializeApp } from "firebase/app";<br/><em class="lm">// TODO: Add SDKs for Firebase products that you want to use</em><br/><em class="lm">// https://firebase.google.com/docs/web/setup#available-libraries</em></span><span id="0594" class="kb je hi ly b fi mg md l me mf"><em class="lm">// Your web app's Firebase configuration</em><br/>const firebaseConfig = {<br/>  apiKey: "[YOUR API]",<br/>  authDomain: "[YOUR AUTH DOMAIN]",<br/>  projectId: "[YOUR PROJECT ID]",<br/>  storageBucket: "[YOUR STORAGE BUCKET]",<br/>  messagingSenderId: "[YOUR MESSAGING SENDER ID]",<br/>  appId: "[YOUR APP ID]"<br/>};<br/><br/><em class="lm">// Initialize Firebase</em><br/>const app = initializeApp(firebaseConfig);</span></pre><p id="8df0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您已经将Firebase添加到您的应用程序中，尽管目前它没有为您的应用程序做任何事情。我们将使用Firebase身份验证来创建身份验证方法并跟踪用户。</p><h2 id="1dbc" class="kb je hi bd jf kc kd ke jj kf kg kh jn iq ki kj jr iu kk kl jv iy km kn jz ko bi translated">使用Firebase身份验证</h2><p id="fb78" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">要使用Firebase身份验证，我们必须编辑配置以添加SDK。我们将使用firebase/auth库中的getAuth和GoogleAuthProvider方法作为我们的身份验证逻辑。让我们导入它们并添加到我们初始化的应用程序中。现在，firebase-config.js文件看起来应该更像这样。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="1dec" class="kb je hi ly b fi mc md l me mf"><em class="lm">// firebase-config.js<br/>// Import the functions you need from the SDKs you need</em><br/><strong class="ly hj">import</strong> { initializeApp } <strong class="ly hj">from</strong> "firebase/app";<br/><em class="lm">// TODO: Add SDKs for Firebase products that you want to use</em><br/><em class="lm">// https://firebase.google.com/docs/web/setup#available-libraries</em><br/><strong class="ly hj">import</strong> { getAuth, GoogleAuthProvider } <strong class="ly hj">from</strong> 'firebase/auth';</span><span id="7ceb" class="kb je hi ly b fi mg md l me mf"><em class="lm">// Your web app's Firebase configuration</em><br/><strong class="ly hj">const</strong> firebaseConfig = {<br/>  apiKey: "[YOUR API]",<br/>  authDomain: "[YOUR AUTH DOMAIN]",<br/>  projectId: "[YOUR PROJECT ID]",<br/>  storageBucket: "[YOUR STORAGE BUCKET]",<br/>  messagingSenderId: "[YOUR MESSAGING SENDER ID]",<br/>  appId: "[YOUR APP ID]"<br/>};<br/><br/><em class="lm">// Initialize Firebase</em><br/><strong class="ly hj">const</strong> app = initializeApp(firebaseConfig);<br/><em class="lm">// Adding Authentication</em><br/><strong class="ly hj">export</strong> <strong class="ly hj">const</strong> auth = getAuth(app); <br/><strong class="ly hj">export</strong> <strong class="ly hj">const</strong> provider = <strong class="ly hj">new</strong> GoogleAuthProvider();</span></pre><p id="1401" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们转到App.js。我们需要找到一种方法来知道用户是否登录，我们将使用react中的状态来跟踪。状态允许我们管理应用程序中不断变化的数据，稍后将用于用户输入。让我们从react导入useState，并创建一个布尔状态authState，告诉应用程序用户是否经过身份验证。这个状态也需要传递给不同的页面。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="daaa" class="kb je hi ly b fi mc md l me mf">// App.js<br/><strong class="ly hj">import</strong> './App.css';<br/><strong class="ly hj">import</strong> { BrowserRouter as Router, Routes, Route, Link } <strong class="ly hj">from</strong> "react-router-dom";<br/><strong class="ly hj">import</strong> { useState } <strong class="ly hj">from</strong> "react";<br/><br/><strong class="ly hj">import</strong> HomePg <strong class="ly hj">from</strong> "./pages/HomePg";<br/><strong class="ly hj">import</strong> PostPg <strong class="ly hj">from</strong> "./pages/PostPg";<br/><strong class="ly hj">import</strong> LoginPg <strong class="ly hj">from</strong> "./pages/LoginPg";<br/><br/><strong class="ly hj">function</strong> App() {<br/> <strong class="ly hj">const</strong> [authState, setAuthState] = useState(localStorage.getItem("authState"));<br/><br/> <strong class="ly hj">return</strong> (<br/>   &lt;Router&gt;<br/>       &lt;nav&gt;<br/>           &lt;Link <strong class="ly hj">to</strong>="/"&gt; Home &lt;/Link&gt;<br/>           &lt;Link <strong class="ly hj">to</strong>="/login"&gt; Login &lt;/Link&gt;<br/>           &lt;Link <strong class="ly hj">to</strong>="/post"&gt; Post &lt;/Link&gt;<br/>       &lt;/nav&gt;<br/>       &lt;Routes&gt;<br/>           &lt;Route path="/" element={&lt;HomePg authState={authState}/&gt;} /&gt;<br/>           &lt;Route path="/post" element={&lt;PostPg authState={authState}/&gt; } /&gt;<br/>           &lt;Route path="/login" element={&lt;LoginPg setAuthState={setAuthState}/&gt; } /&gt;<br/>       &lt;/Routes&gt;<br/>   &lt;/Router&gt;<br/> );<br/>}<br/><br/><strong class="ly hj">export</strong> <strong class="ly hj">default</strong> App;</span></pre><p id="e726" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们创建一种登录方式。前往LoginPg，在那里我们将创建一种使用Google登录的方法。我们想创建一个按钮，当它被点击时将运行一个功能。首先导入我们从firebase-config文件创建的auth和provider。然后还要从firebase/auth库导入signInWithPopup。我们还将使用react-router-dom中的useNavigate函数在登录后导航回主页。生成的代码应该类似于下面这样。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="9a3d" class="kb je hi ly b fi mc md l me mf">//LoginPg.js<br/><strong class="ly hj">import</strong> React <strong class="ly hj">from</strong> "react";<br/><strong class="ly hj">import</strong> { auth, provider } <strong class="ly hj">from</strong> '../firebase-config';<br/><strong class="ly hj">import</strong> { signInWithPopup } <strong class="ly hj">from</strong> 'firebase/auth';<br/><br/><strong class="ly hj">function</strong> <strong class="ly hj">LoginPg</strong>({setAuthState}) {<br/><br/>   <strong class="ly hj">const</strong> signingIn = () =&gt; {<br/>       signInWithPopup(auth, provider).then((result) =&gt; {<br/>           localStorage.setItem("authState", true);<br/>           setAuthState(true);<br/>       });<br/>   };<br/><br/>   <strong class="ly hj">return</strong> (<br/>     &lt;div className="Login"&gt;<br/>         &lt;p&gt;Sign In!&lt;/p&gt;<br/>         &lt;button onClick={signingIn}&gt; Google Sign In &lt;/button&gt;<br/>     &lt;/div&gt;<br/>   );<br/><br/>}<br/><strong class="ly hj">export</strong> <strong class="ly hj">default</strong> LoginPg;</span></pre><p id="d841" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您运行npm start并尝试测试登录功能，您会发现它不起作用！这是因为域需要被授权进行OAuth重定向。转到Firebase控制台中的Authentication选项卡。转到设置-&gt;域-&gt;授权域并添加域。复制正在运行的应用程序的网站(提示。如果您按照说明操作，它应该以cloudshell.dev结尾并添加域。现在成功了！</p><p id="a345" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，让我们添加逻辑来确保一旦用户登录，他们不会看到登录页面，而是看到注销选项。我们还可以让帖子页面只在用户登录后才可见。</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="6e67" class="kb je hi ly b fi mc md l me mf">//App.js<br/><strong class="ly hj">import</strong> './App.css';<br/><strong class="ly hj">import</strong> { BrowserRouter <strong class="ly hj">as</strong> Router, Routes, Route, Link } <strong class="ly hj">from</strong> "react-router-dom";<br/><strong class="ly hj">import</strong> { useState } <strong class="ly hj">from</strong> "react";<br/><br/>//Firebase imports<br/><strong class="ly hj">import</strong> { auth } <strong class="ly hj">from</strong> './firebase-config'<br/><strong class="ly hj">import</strong> { signOut } <strong class="ly hj">from</strong> "firebase/auth";<br/><br/>//Pages <strong class="ly hj">for</strong> the application<br/><strong class="ly hj">import</strong> HomePg <strong class="ly hj">from</strong> "./pages/HomePg";<br/><strong class="ly hj">import</strong> PostPg <strong class="ly hj">from</strong> "./pages/PostPg";<br/><strong class="ly hj">import</strong> LoginPg <strong class="ly hj">from</strong> "./pages/LoginPg";<br/><br/>function App() {<br/> const [authState, setAuthState] = useState(localStorage.getItem("authState"));<br/><br/> const signMeOut = () =&gt; {<br/>   signOut(auth).<strong class="ly hj">then</strong>(() =&gt; {<br/>       localStorage.clear();<br/>       setAuthState(false);<br/>   });<br/> };<br/><br/> <strong class="ly hj">return</strong> (<br/>   &lt;Router&gt;<br/>       &lt;nav&gt;<br/>           &lt;Link to="/"&gt; Home &lt;/Link&gt;<br/>           {!authState &amp;&amp; ( &lt;Link to="/login"&gt; Login &lt;/Link&gt; )}<br/>           {authState &amp;&amp; (<br/>               &lt;&gt;<br/>                 &lt;Link to="/post"&gt; Post &lt;/Link&gt;<br/>                 &lt;button onClick={signMeOut}&gt; Log Out &lt;/button&gt;<br/>               &lt;/&gt;<br/>           )}<br/>       &lt;/nav&gt;<br/>       &lt;Routes&gt;<br/>           &lt;Route path="/" element={&lt;HomePg authState={authState}/&gt;} /&gt;<br/>           &lt;Route path="/post" element={&lt;PostPg authState={authState}/&gt; } /&gt;<br/>           &lt;Route path="/login" element={&lt;LoginPg setAuthState={setAuthState}/&gt; } /&gt;<br/>       &lt;/Routes&gt;<br/>   &lt;/Router&gt;<br/> );<br/>}<br/><br/><strong class="ly hj">export</strong> <strong class="ly hj">default</strong> App;</span></pre><p id="6589" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">恭喜你！您已经创建了一个带身份验证的应用程序。您可以在Firebase控制台的“身份验证”选项卡中跟踪您的用户。请随意将更新推送到云存储库，并在这里休息一下！</p><h1 id="7539" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">后续步骤</h1><p id="39a7" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">在下一部分中，我将概述如何集成数据库和存储，以及如何使用App Engine部署应用程序。最后我举一个云函数的例子。那里见！</p><p id="b0a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ku" rel="noopener" href="/@brianhmj_78325/developing-a-serverless-web-application-completely-on-google-cloud-2-of-2-dd523e768791">完全在谷歌云上开发无服务器网络应用(第2页，共2页)</a></p></div></div>    
</body>
</html>