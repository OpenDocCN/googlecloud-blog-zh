<html>
<head>
<title>Programatically manage Google Cloud Resources via REST APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过REST APIs以编程方式管理Google云资源</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/programatically-manage-gcp-resources-via-rest-apis-6b216e5efadf?source=collection_archive---------0-----------------------#2022-08-19">https://medium.com/google-cloud/programatically-manage-gcp-resources-via-rest-apis-6b216e5efadf?source=collection_archive---------0-----------------------#2022-08-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="329c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将深入探讨如何使用Google Cloud提供的REST APIs轻松高效地管理GCP资源。我们将看看GCP的REST APIs如何为自动化和程序管理提供一个通用框架。使用GCP REST API，您可以采用测试-&gt;实现-&gt;重用的方法来管理GCP资源。示例代码将使用python，但是您可以使用任何选择的编程语言进行等效的替换</p><h1 id="7462" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">GCP的原料药</h1><p id="3af9" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">GCP公开了REST APIs来创建、列出、查看、删除或修改GCP中的各种资源。虽然SDK存在于多种编程语言中，但每种SDK都有自己的方法和文档。例如，用于访问和管理谷歌云存储资源的SDK不同于用于管理GCP计算资源的SDK。使用每一个SDK也需要一定的学习曲线。</p><p id="651e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GCP提供了基于JSON的REST APIS来管理各种资源，并提供了详细的文档。例如，计算引擎API可以在<a class="ae kg" href="https://cloud.google.com/compute/docs/reference/rest/v1" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/compute/docs/reference/rest/v1</a>找到，GCS REST APIs可以在<a class="ae kg" href="https://cloud.google.com/storage/docs/json_api/v1" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/storage/docs/json_api/v1</a>找到</p><h1 id="ab7c" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">测试您的API请求</h1><p id="a23d" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">参数、消息头、请求体和认证构成了REST API的关键部分。GCP提供了试验JSON API的工具，在其中您不仅可以指定参数和头，还可以构造请求体(使用autosuggest)并将请求提交到您选择的GCP项目。这使开发人员能够以一种简单的方式验证复杂的请求主体数据和请求参数，而无需编写一行代码。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/a8fb24d0341be2a358351e4dbe3850f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B_IE_rVvN4LMyjZHtaktZg.png"/></div></div></figure><p id="5e27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有可用于HTTP和Java脚本的代码片段</p><p id="0c88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> HTTP代码片段</strong></p><blockquote class="kt ku kv"><p id="09ee" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">岗位<a class="ae kg" href="https://storage.googleapis.com/storage/v1/b?project=test-project-gcp&amp;key=[YOUR_API_KEY" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/storage/v1/b?project = test-project-GCP&amp;KEY =[YOUR _ API _ KEY</a>]HTTP/1.1</p><p id="8472" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">授权:无记名[您的访问令牌] <br/>接受:应用/json <br/>内容类型:应用/json</p><p id="6ab2" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">{ <br/> "name": "my-test-bucket "，<br/> "cors": []，<br/> "acl": []，<br/> "lifecycle": {}，<br/> "labels": {} <br/> }</p></blockquote><h1 id="e16b" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">代码实现</h1><p id="1b7a" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">一旦您如上所述测试了参数、头部和请求体，下一步就是开始编写REST客户端。</p><p id="85d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">认证</strong></p><p id="b9af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GCP REST客户端的一个重要方面是身份验证和授权。对于身份验证和授权，最灵活、最简单的方法是通过环境变量设置凭证，并进行令牌刷新。凭证通常是具有执行API操作的相关GCP权限的服务帐户。</p><p id="aa0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过环境变量设置凭证，可以避免在代码中硬编码凭证。这也使您能够在不同的环境和CICD管道中运行相同的代码，而无需任何代码更改。</p><p id="1366" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如:<em class="kw">导出GOOGLE _ APPLICATION _ CREDENTIALS = " KEY _ PATH "</em></p><p id="a400" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦您的环境中有了可用的GCP凭据，您就可以使用google.auth.credentials api来获取一个基于您的环境中设置的凭据的具有有限生命周期的令牌。</p><p id="d085" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为环境中设置的凭证获取令牌的python代码片段如下</p><blockquote class="kt ku kv"><p id="760a" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">导入google.auth</p><p id="602c" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">导入google.auth.transport .请求</p><p id="0f8b" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">def get_creds():</p><p id="732e" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">credentials，proj _ id = Google . auth . default(scopes =[" https://www . Google APIs . com/auth/cloud-platform "])</p><p id="ba8d" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">auth _ req = Google . auth . transport . requests . request()</p><p id="f1f8" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">credentials . refresh(auth _ req)#刷新令牌</p><p id="6e40" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">token_str=(credentials.token) #打印令牌</p><p id="015e" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">打印(凭证.到期)</p><p id="e9f8" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">返回token_str，proj_id</p></blockquote><p id="5b14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">通过REST客户端调用GCP API</strong></p><p id="1d8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们举一个例子，调用REST API在GCP创建一个云函数。在这个方法中，我们通过调用上面提到的get_creds()函数来获得访问令牌。这个访问令牌在“Authorization”头中提到，post请求与请求体JSON一起发送。请求体JSON可以像上面“测试您的API请求”一节中提到的那样获得。</p><blockquote class="kt ku kv"><p id="1ea4" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">def create _ function _ with _ trigger(bucket _ name，bucket_out，template):</p><p id="21cd" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">access_token，proj_id=auth.get_creds()</p><p id="5624" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">functions _ URL = " https://cloud functions . Google APIs . com/v1/projects/media-348707/locations/us-central 1/functions "</p><p id="698b" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">print(f '云函数{access_token} ')</p><p id="d678" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">headers _ req = { ' Authorization ':' Bearer '+access _ token }</p><p id="1020" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">request _ body = get _ request _ for _ create _ cloud _ function(模板，bucket_out，bucket_name)</p><p id="2c16" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">resp = requests . post(URL = functions _ URL，json=request_body，headers=headers_req)</p><p id="3f8f" class="if ig kw ih b ii ij ik il im in io ip kx ir is it ky iv iw ix kz iz ja jb jc hb bi translated">打印(内容)</p></blockquote><p id="be16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面代码中的request_body是对API的JSON请求。有了上面的代码，用几行代码管理任何API资源都是可能的，最好的部分是整个API可以像最初提到的那样独立测试。这使用户能够创建更快、更高效的客户端来高效地管理GCP资源。</p><h1 id="1cb0" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">代码重用</h1><p id="dbb4" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">除了上面代码中的请求url和请求主体，客户端的大部分代码都是可重用的。假设您想从API创建一个新的GCP资源，比如一个计算实例，您可以重复使用GCP API文档来构造请求体和请求url的整个过程。除了请求体和请求url之外，任何post请求的客户端代码都是相似的，可以重用。</p><h1 id="2da1" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">结论</h1><p id="a9fc" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">通过遵循测试-&gt;实现-&gt;重用方法，REST APIs使您能够轻松地管理GCP资源。此外，GCP公开的一套丰富的API文档能够“尝试任何API ”,这使得这个过程更加简单、高效、不易出错</p></div></div>    
</body>
</html>