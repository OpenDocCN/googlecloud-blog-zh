<html>
<head>
<title>Manage your build artifacts with Artifact Registry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用工件注册管理您的构建工件</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/manage-your-build-artifacts-with-artifact-registry-953b98c58715?source=collection_archive---------2-----------------------#2020-03-31">https://medium.com/google-cloud/manage-your-build-artifacts-with-artifact-registry-953b98c58715?source=collection_archive---------2-----------------------#2020-03-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b657" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果一提到容器，你就难以抑制自己的兴奋，那么这篇文章就是为你写的！如果你不喜欢这个双关语，那么这篇文章仍然适合你，但不要指望我为爸爸的笑话道歉。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/f52adbcad46519db5a166e18d58c796f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fmZZMWV8hZFBbe1Y0XV7kg.png"/></div></div></figure><h1 id="29fd" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">一切都各就各位</h1><p id="768a" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">我一生中搬了好几次家。仅在过去的十年里，我就在三个不同的州，七个不同的城市，八个不同的家生活过。搬家当然会有压力；有些东西不可避免地会损坏，有些东西会丢失，而且搬迁的每一部分都比预期的要贵。但是搬到一个新地方有一个部分是非常令人满意的:变得有条理。如果你使用容器注册，我打赌你也喜欢有条理！但一会儿会有更多的内容。让我们把这个比喻延续得更久一点，因为我对提出这个比喻感到非常自豪。</p><p id="c93f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我终于买了我的第一栋房子，我真的很期待安顿下来。我花了很多时间计划如何自动化和优化我的家。</p><div class="jf jg jh ji fd ab cb"><figure class="kt jj ku kv kw kx ky paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/a84c92b9c6505310b5538087f1b2f02d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*iZo5ZTTMtGlNmJXEAvg8Rg.jpeg"/></div></figure><figure class="kt jj ku kv kw kx ky paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><img src="../Images/1bb778e0148a01eaec08c3227bb47990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*t-q5twqUxOicfWUZ9hZaiQ.jpeg"/></div><figcaption class="kz la et er es lb lc bd b be z dx ld di le lf translated">看它是如何组合在一起的！</figcaption></figure></div><p id="de34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我为我所有的烹饪用具选择了一个完美的位置。我投资了可以自动降低的灯罩。我有一个巢门铃，因为我有一对夫妇的包发芽腿，并离开我以前的住所。当然，我有足够的谷歌家园来确保助手永远不会超过一个“嘿谷歌”之外。说到管理您团队的Docker图像，我敢打赌，您想要和我在家里一样的组织和自动化。到目前为止，Container Registry已经提供了这种自动化，但是是时候进入下一代注册了:工件注册。看到我是怎么把那个圆带回来的了吗？</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lg"><img src="../Images/999f2cfbb7250473ea8e33b42fcf5feb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gg_DmLi_XKAa3-Fn-cR88Q.jpeg"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx translated">又一张家装照片尽管你没问</figcaption></figure><h1 id="1e99" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">升级到最新的管道自动化</h1><p id="cf79" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">Container Registry为您的团队提供了一个单一的位置来管理Docker映像、执行漏洞分析，并通过细粒度的访问控制来决定谁可以访问什么。现有的CI/CD集成允许您设置完全自动化的Docker管道，以获得快速反馈。为了建立这个强大的基础，Google Cloud发布了下一代容器管理工具:Artifact Registry。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lh"><img src="../Images/cc070ccc946066be3562f154cf2f4aef.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*ajSlM5ISpMEiuZbPb2DCAg.png"/></div></figure><p id="aa06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">借助Artifact Registry，您可以管理您的容器映像和语言包(即，在与云的构建、测试和部署套件以及第三方CI/CD系统集成的同时构建工件。</p><ul class=""><li id="cfbd" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated"><strong class="ih hj">特定于注册表的权限</strong> —工件注册表提供了更细粒度的权限，允许您在项目或注册表级别控制访问</li><li id="f3fd" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">区域支持</strong> —在一个谷歌云项目中创建多个区域存储库</li><li id="ffe6" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated"><strong class="ih hj">拥有独立权限的多个存储库</strong> —您可以在一个项目下创建多个repos，拥有独立的工件注册中心特定的权限。您可以控制工件的存储位置以及谁可以访问它们。</li></ul><p id="3be6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在听说了Artifact Registry之后，我打赌你已经迫不及待地想要开始了！亲爱的读者，请放心；我将向您展示如何创建一个新的存储库，列出现有的存储库，以及配置访问控制。</p><h1 id="678d" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">工件注册库</h1><p id="68a4" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated"><a class="ae lw" href="https://cloud.google.com/artifact-registry/docs/enable-service" rel="noopener ugc nofollow" target="_blank">在控制台中启用工件注册表API </a>。然后，要创建新的存储库，请执行以下步骤:</p><pre class="jf jg jh ji fd lx ly lz ma aw mb bi"><span id="466f" class="mc jr hi ly b fi md me l mf mg">gcloud beta artifacts repositories create REPOSITORY \</span><span id="ab25" class="mc jr hi ly b fi mh me l mf mg">— repository-format=FORMAT [ — location=LOCATION] \</span><span id="5b77" class="mc jr hi ly b fi mh me l mf mg">[ — description=”DESCRIPTION”] [ — async]</span></pre><p id="bfac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在哪里</p><ul class=""><li id="9b47" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">存储库是存储库的名称。</li><li id="40b0" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">格式是存储库格式。支持的值有</li><li id="9985" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">位置是存储库的区域或多区域位置。如果设置了默认值，您可以忽略此标志。要查看受支持位置的列表，请运行命令<code class="du mi mj mk ly b">gcloud beta artifacts locaitons list</code></li><li id="95ba" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">描述是对存储库的描述。</li></ul><p id="14e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du mi mj mk ly b">--async</code>标志立即返回，而不等待正在进行的操作完成。</p><p id="b80b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要查看存储库列表，您需要运行以下命令:</p><pre class="jf jg jh ji fd lx ly lz ma aw mb bi"><span id="e9af" class="mc jr hi ly b fi md me l mf mg">gcloud beta artifacts repositories list [ — project=PROJECT] \</span><span id="9da7" class="mc jr hi ly b fi mh me l mf mg">[ — location=LOCATION]</span></pre><p id="7257" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在哪里</p><ul class=""><li id="a1f7" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">项目是项目标识。如果省略此标志，则使用当前或默认项目。</li><li id="bb16" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">位置是区域或多区域位置。使用此标志查看特定位置的存储库。您还可以使用<code class="du mi mj mk ly b">--location=all</code>列出所有位置的存储库。</li></ul><p id="3e56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果省略此标志，则该命令将使用默认位置(如果配置了默认位置)。否则，省略此标志会列出所有位置的存储库。</p><h1 id="d71f" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">访问控制</h1><p id="77a8" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">虽然您可以使用<a class="ae lw" href="https://cloud.google.com/iam/docs/understanding-roles" rel="noopener ugc nofollow" target="_blank">原始角色</a> <code class="du mi mj mk ly b">Owner</code>、<code class="du mi mj mk ly b">Editor</code>和<code class="du mi mj mk ly b">Viewer</code>角色来授予对存储库的访问权，但是使用特定的<strong class="ih hj">工件注册中心</strong>角色使您能够应用最小特权的安全原则，以便用户和服务帐户只拥有所需的权限。例如，<code class="du mi mj mk ly b">artifactregistry.reader</code>角色允许用户从特定项目的存储库中查看和获取工件，而<code class="du mi mj mk ly b">roles/reader</code>角色允许用户从项目的所有云组件中查看和获取任何现有的资源和数据。</p><h1 id="ba85" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">配置权限</h1><p id="e0d7" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">要为用户授予权限，自然要授予包含该权限的角色。在适当的地方，使用<a class="ae lw" href="https://cloud.google.com/artifact-registry/docs/access-control" rel="noopener ugc nofollow" target="_blank">工件注册角色</a>来控制对您的存储库的访问，而不是项目角色。您可以授予以下工件注册表角色:</p><ul class=""><li id="fd2e" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">工件注册阅读器:查看和获取工件</li><li id="e805" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">工件注册表编写器:读取和写入工件</li><li id="2c5a" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">工件注册库管理员:读取、写入和删除工件</li><li id="dac1" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">工件注册管理员:创建和管理存储库和工件</li></ul><p id="61aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您使用gcloud命令授予角色，以下参考策略模板将用于这些示例。参考策略文件名为policy.yaml。您可以在包含示例用户和服务帐户名称的文档中找到参考模板。这里有一个例子<code class="du mi mj mk ly b">policy.yaml</code>:</p><pre class="jf jg jh ji fd lx ly lz ma aw mb bi"><span id="0f0b" class="mc jr hi ly b fi md me l mf mg">bindings:<br/>- role: roles/owner</span><span id="dd8d" class="mc jr hi ly b fi mh me l mf mg">members:<br/>- user: jenperson@thisemailisfake.com<br/>- role: roles/artifactregistry.reader</span><span id="e5ff" class="mc jr hi ly b fi mh me l mf mg">members:<br/>- serviceAccount: repo-readonly@iam.gserviceaccount.com<br/>- user:fakeuser2@thisemailisfake.com<br/>- role: roles/artifactregistry.admin</span><span id="4a15" class="mc jr hi ly b fi mh me l mf mg">members:<br/>- serviceAccount: ar-admin@iam.gserviceaccount.com</span></pre><p id="b718" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要将团队成员添加到项目中，并授予他们工件注册角色:</p><pre class="jf jg jh ji fd lx ly lz ma aw mb bi"><span id="5529" class="mc jr hi ly b fi md me l mf mg">gcloud projects set-iam-policy PROJECT /PATH/TO/policy.yaml</span></pre><p id="5117" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在哪里</p><ul class=""><li id="8de7" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">PROJECT是项目的ID或项目的完全限定标识符。</li><li id="74d9" class="li lj hi ih b ii lr im ls iq lt iu lu iy lv jc ln lo lp lq bi translated">/PATH/TO/policy.yaml是策略文件的路径和文件名。</li></ul><p id="6838" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要获取当前配置的策略，请运行以下命令:</p><pre class="jf jg jh ji fd lx ly lz ma aw mb bi"><span id="354c" class="mc jr hi ly b fi md me l mf mg">gcloud projects get-iam-policy PROJECT</span></pre><p id="42c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在哪里</p><ul class=""><li id="7fad" class="li lj hi ih b ii ij im in iq lk iu ll iy lm jc ln lo lp lq bi translated">PROJECT是项目的ID或项目的完全限定标识符。</li></ul><h1 id="910c" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">准备好开始了吗？</h1><p id="9e41" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">只需几个步骤，您就可以启动并运行工件注册表！我希望整理我的垃圾抽屉也一样简单！准备好开始工件注册了吗？查看<a class="ae lw" href="https://cloud.google.com/artifact-registry/docs" rel="noopener ugc nofollow" target="_blank">文档</a>！</p></div></div>    
</body>
</html>