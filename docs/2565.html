<html>
<head>
<title>Comparing CNCF Chaos Engineering Tools</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">比较CNCF混沌工程工具</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/comparing-cncf-chaos-engineering-tools-b33f53feb545?source=collection_archive---------1-----------------------#2022-11-28">https://medium.com/google-cloud/comparing-cncf-chaos-engineering-tools-b33f53feb545?source=collection_archive---------1-----------------------#2022-11-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="08b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">混沌工程是一门在系统上进行实验的学科，目的是建立对系统承受生产中动荡条件能力的信心。</em></p><p id="129a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应用程序出现故障的方式有很多，服务器发热、磁盘一直出现故障、网络连接变得脆弱。我们假设，由于我们已经复制了服务器，备份了数据库实例，应用程序已经分布在多个地区/区域，准备好应对灾难情况。</p><p id="8b6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是我们真的确定我们的分布式系统/应用程序是有弹性的吗？证明您的系统/应用程序对故障具有弹性的唯一方法是经历故障，并使对故障的快速响应成为您的软件/系统/应用程序不可或缺的一部分。</p><p id="c4e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">混沌工程是通过诱发受控故障来例行测试系统弹性的实践。</p><h1 id="6ddd" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">实践中的混乱</h1><p id="d074" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">为了具体解决大规模分布式系统/应用的不确定性，混沌工程可以被认为是揭示系统弱点的受控实验的促进。这些实验遵循四个步骤:</p><ol class=""><li id="adcf" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">首先将“稳定状态”定义为系统的一些可测量的输出，表示正常的行为。</li><li id="0514" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">假设这种稳定状态将在对照组和实验组中持续。</li><li id="fad2" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">引入反映真实世界事件的变量，如服务器崩溃、硬盘故障、网络连接中断等。</li><li id="7ce9" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">通过在对照组和实验组之间寻找稳定状态的差异来试图推翻假设。</li></ol><p id="47c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">破坏稳定状态越难，我们对系统的行为就越有信心。如果一个弱点被发现，我们现在就有了一个改进的目标，在这个行为在整个系统中表现出来之前。</p><p id="b7a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">市场上有不同的工具，具有不同的成熟度，可以用分布式系统/应用程序来试验混沌。我决定在这篇博文中比较三种不同的工具。所有这些工具都是CNCF项目。</p><ul class=""><li id="5a68" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc kv kn ko kp bi translated"><a class="ae kw" href="https://chaostoolkit.org/" rel="noopener ugc nofollow" target="_blank">混沌工具包</a></li><li id="02f0" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc kv kn ko kp bi translated"><a class="ae kw" href="https://litmuschaos.io/" rel="noopener ugc nofollow" target="_blank">石蕊</a></li><li id="f97d" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc kv kn ko kp bi translated"><a class="ae kw" href="https://github.com/chaos-mesh/chaos-mesh" rel="noopener ugc nofollow" target="_blank">混沌网</a></li></ul><p id="002f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将从以下几个方面比较这三个工具:安装和管理、实验定义和多样性、安全性和可观察性。</p><h1 id="516e" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">工具比较</h1><h1 id="58c6" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">混沌工具包</h1><p id="7e7d" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">Chaos Toolkit非常注重可扩展性，旨在成为创建定制混沌工具和实验的框架。它涵盖了实验的整个生命周期，使得在实验开始时运行检查(称为探针)来检查目标应用程序的状态成为可能，随后对系统采取行动以引起不稳定，并验证是否达到了预期的最终状态。它允许将你的混沌工程实验声明和存储为JSON/YAML文件，这样你就可以像其他代码一样协作和编排它们(混沌作为代码)。使用驱动程序扩展，如AWS驱动程序或Kubernetes驱动程序，可以很容易地安装这些驱动程序，以便对扩展的目标平台列表使用附加操作。可以创建新的自定义驱动程序，也可以增强现有的驱动程序，以便为实验提供更多类型的探针和动作。</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es kx"><img src="../Images/63c7006e964981da059d22af82da749c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GOKh--udboOPRLKFq1iwfA.png"/></div></div></figure><h1 id="184f" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">安装和管理</h1><h1 id="d4fd" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">Python要求</h1><p id="257e" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在Python 3中实现了<a class="ae kw" href="https://github.com/chaostoolkit/chaostoolkit" rel="noopener ugc nofollow" target="_blank"> chaostoolkit CLI </a>,这需要运行一个有效的Python安装。它正式支持Python 3.7+。它只在<a class="ae kw" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> CPython </a>上测试过。</p><h1 id="838e" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">创建虚拟环境</h1><p id="a6be" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">可以通过软件包管理为您的系统安装依赖项，但更有可能的是，您希望自己在本地虚拟环境中安装它们。</p><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="61ac" class="lo jf hi lk b be lp lq l lr ls">python3 -m venv ~/.venvs/chaostk</span></pre><p id="cc77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保在使用虚拟环境之前始终激活它:</p><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="cfe3" class="lo jf hi lk b be lp lq l lr ls">source  ~/.venvs/chaostk/bin/activate</span></pre><h1 id="de51" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">安装CLI</h1><p id="2c94" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在虚拟环境中安装<code class="du lt lu lv lk b">chaostoolkit</code>,如下所示:</p><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="b7d2" class="lo jf hi lk b be lp lq l lr ls">pip install -U chaostoolkit</span></pre><p id="0f8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以通过运行以下命令来验证该命令是否已安装:</p><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="9f05" class="lo jf hi lk b be lp lq l lr ls">chaos --version</span></pre><h1 id="f4cf" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">以Kubernetes操作员的身份部署混沌工具包</h1><p id="bb98" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">Kubernetes操作符是在Kubernetes API上为任何应用程序创建定制控制器的一种流行方法。</p><p id="d35b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Chaos Toolkit操作员监听实验声明并触发一个新的Kubernetes pod，用指定的实验运行Chaos Toolkit。</p><h1 id="b818" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">部署操作员</h1><p id="ef3e" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated"><a class="ae kw" href="https://github.com/chaostoolkit-incubator/kubernetes-crd" rel="noopener ugc nofollow" target="_blank">操作符</a>可以在Chaos Toolkit孵化器上找到。</p><p id="842d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它是通过典型的Kubernetes <a class="ae kw" href="https://github.com/chaostoolkit-incubator/kubernetes-crd/tree/master/manifests" rel="noopener ugc nofollow" target="_blank">清单</a>部署的，这些清单需要通过本机配置管理器<a class="ae kw" href="https://kustomize.io/" rel="noopener ugc nofollow" target="_blank"> Kustomize </a>应用。</p><p id="70ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，下载<a class="ae kw" href="https://github.com/kubernetes-sigs/kustomize/blob/master/docs/INSTALL.md" rel="noopener ugc nofollow" target="_blank"> Kustomize二进制文件</a>:</p><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="f8fb" class="lo jf hi lk b be lp lq l lr ls">curl -s "https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh" | bash</span></pre><p id="5245" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于macOS，您也可以通过Homebrew软件包管理器安装它:</p><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="b1ae" class="lo jf hi lk b be lp lq l lr ls">brew install kustomize</span></pre><p id="9216" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，只需运行以下命令:</p><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="3435" class="lo jf hi lk b be lp lq l lr ls">kustomize build manifests/overlays/generic-rbac | kubectl apply -f -</span></pre><h1 id="b661" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">实验定义和种类</h1><p id="3d23" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">混沌工具包旨在为您提供编写和运行自己的混沌工程实验的最简单的体验。主要概念都在一个实验定义中表达，下面是一个例子。</p><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="d0d0" class="lo jf hi lk b be lp lq l lr ls">{<br/>  "version": "1.0.0",<br/>  "title": "System is resilient to provider's failures",<br/>  "description": "Can our consumer survive gracefully a provider's failure?",<br/>  "tags": [<br/>    "service",<br/>    "kubernetes",<br/>    "spring"<br/>  ],<br/>  "configuration": {<br/>    "app_name": {<br/>      "type": "env",<br/>      "key": "LABEL_NAME"<br/>    },<br/>    "name_space": {<br/>      "type": "env",<br/>      "key": "NAME_SPACE"<br/>    }<br/>  },<br/>  "steady-state-hypothesis": {<br/>    "title": "Killing the pod where application is running",<br/>    "probes": [<br/>      {<br/>        "type": "probe",<br/>        "name": "there-should-be-at-least-2-running-app-replicas",<br/>        "tolerance": 3,<br/>        "provider": {<br/>          "type": "python",<br/>          "module": "chaosk8s.pod.probes",<br/>          "func": "count_pods",<br/>          "arguments": {<br/>            "label_selector": "app=${app_name}",<br/>            "ns": "${name_space}"<br/>          }<br/>        }<br/>      }<br/>    ]<br/>  },<br/>  "method": [<br/>    {<br/>      "type": "action",<br/>      "name": "Terminate_pod",<br/>      "provider": {<br/>        "type": "python",<br/>        "module": "chaosk8s.pod.actions",<br/>        "func": "terminate_pods",<br/>        "arguments": {<br/>          "label_selector": "app=${app_name}",<br/>          "name_pattern": "${app_name}",<br/>          "ns": "${name_space}",<br/>          "rand": true,<br/>          "mode": "fixed",<br/>          "qty": 1<br/>        }<br/>      },<br/>      "pauses": {<br/>        "after": 20<br/>      }<br/>    }<br/>  ],<br/>  "rollbacks": []<br/>}</span></pre><p id="9b7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">混沌工具包的关键概念是<code class="du lt lu lv lk b">Experiments</code>、<code class="du lt lu lv lk b">Steady State Hypothesis</code>和实验的<code class="du lt lu lv lk b">Method</code>。<code class="du lt lu lv lk b">Method</code>包含了<code class="du lt lu lv lk b">Probes</code>和<code class="du lt lu lv lk b">Actions</code>的组合。</p><h1 id="c27c" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">安全性</h1><p id="7998" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">为了监视和管理自己的CRD，Chaos Toolkit操作员需要一个有足够权限来完成工作的服务帐户。例如，要运行一个简单的实验来删除给定名称空间中的应用程序pod，操作员将使用一个拥有足够权限来删除pod的服务帐户来创建一个chaos toolkit pod。</p><p id="767b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据将要使用的附加驱动程序，可能需要任何特定的网络访问权限或更高的权限。这种模块化的方法更容易保证安全，因为人们可以选择或开发符合自己需求的驱动程序。</p><h1 id="e9db" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">可观察性</h1><p id="720b" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">Chaos Toolkit有一个Prometheus驱动程序，可以从实验中导出度量和事件。它也有一个开放的跟踪驱动程序和一个Humio驱动程序。然而，该工具还没有提供实验结果的标准化报告，这意味着观察实验流程的方法是通过检查Chaos Toolkit本身的日志。</p><h1 id="cdda" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">石蕊混沌</h1><p id="440d" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">LitmusChaos是一个具有跨云支持的云原生混沌工程框架。这是一个CNCF沙盒项目，被多个组织采用。它的任务是通过提供一个完整的混沌工程框架和相关的混沌实验，帮助Kubernetes SREs和开发人员发现非Kubernetes以及在Kubernetes上运行的平台和应用程序中的弱点。</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lw"><img src="../Images/6048770ca2e20ec75367c259e7f955a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IghWI3CK0JBFwTSlyjIuXQ.png"/></div></div></figure><h1 id="6d61" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">安装和管理</h1><h1 id="af9e" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">先决条件<a class="ae kw" href="https://docs.litmuschaos.io/docs/getting-started/installation#prerequisites" rel="noopener ugc nofollow" target="_blank"> </a></h1><p id="c6dd" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在部署LitmusChaos之前，请确保存在以下项目</p><ul class=""><li id="e292" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc kv kn ko kp bi translated">Kubernetes 1.17或更高版本</li><li id="13d8" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc kv kn ko kp bi translated">20GB的永久卷</li><li id="7585" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc kv kn ko kp bi translated"><a class="ae kw" href="https://v3.helm.sh/" rel="noopener ugc nofollow" target="_blank"> Helm3 </a>或<a class="ae kw" href="https://kubernetes.io/docs/tasks/tools/#kubectl" rel="noopener ugc nofollow" target="_blank"> kubectl </a></li></ul><h1 id="16b2" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">使用舵<a class="ae kw" href="https://docs.litmuschaos.io/docs/getting-started/installation#install-litmus-using-helm" rel="noopener ugc nofollow" target="_blank">安装石蕊</a></h1><p id="9127" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">helm chart将安装所有需要的服务帐户配置和ChaosCenter。</p><p id="7904" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下步骤将帮助您通过helm安装Litmus ChaosCenter。</p><h2 id="67aa" class="lx jf hi bd jg ly lz ma jk mb mc md jo iq me mf js iu mg mh jw iy mi mj ka mk bi translated">第一步:添加石蕊头盔库<a class="ae kw" href="https://docs.litmuschaos.io/docs/getting-started/installation#step-1-add-the-litmus-helm-repository" rel="noopener ugc nofollow" target="_blank"> </a></h2><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="3e7d" class="lo jf hi lk b be lp lq l lr ls">helm repo add litmuschaos https://litmuschaos.github.io/litmus-helm/<br/>helm repo list</span></pre><h2 id="e989" class="lx jf hi bd jg ly lz ma jk mb mc md jo iq me mf js iu mg mh jw iy mi mj ka mk bi translated">步骤2:创建要安装Litmus ChaosCenter <a class="ae kw" href="https://docs.litmuschaos.io/docs/getting-started/installation#step-2-create-the-namespace-on-which-you-want-to-install-litmus-chaoscenter" rel="noopener ugc nofollow" target="_blank"> </a>的名称空间</h2><ul class=""><li id="9b80" class="kh ki hi ih b ii kc im kd iq ml iu mm iy mn jc kv kn ko kp bi translated">ChaosCenter可以放在任何名称空间中，但是对于这个场景，我们选择<code class="du lt lu lv lk b">litmus</code>作为名称空间。</li></ul><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="15a5" class="lo jf hi lk b be lp lq l lr ls">kubectl create ns litmus</span></pre><h2 id="eba7" class="lx jf hi bd jg ly lz ma jk mb mc md jo iq me mf js iu mg mh jw iy mi mj ka mk bi translated">第三步:安装石蕊混沌仪<a class="ae kw" href="https://docs.litmuschaos.io/docs/getting-started/installation#step-3-install-litmus-chaoscenter" rel="noopener ugc nofollow" target="_blank"> </a></h2><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="06dc" class="lo jf hi lk b be lp lq l lr ls">helm install chaos litmuschaos/litmus --namespace=litmus --set portal.frontend.service.type=NodePort</span></pre><p id="a2d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">预期产出</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es mo"><img src="../Images/80822730e8a27636ffed1e72d77ad733.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*omi86sMheps1ANH-Eetr0g.png"/></div></div></figure><h1 id="3731" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">实验定义和种类</h1><p id="1354" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">Litmus的有趣之处在于，它提供了一种定义明确的方式来选择您自己的实验跑步者。它使用了混沌库的概念，混沌库定义了用于执行实验的包。</p><p id="ebd9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这使得Litmus成为一个非常可扩展和工具无关的框架，而不仅仅是另一个混沌注入工具。</p><p id="61e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建ChaosEngine资源时会触发实验执行。通常，这些混沌引擎嵌入在Litmus Chaos工作流的“步骤”中。然而，也可以直接手工创建混沌引擎，混沌操作者协调这个资源并触发实验执行。</p><h1 id="6be3" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">安全性</h1><p id="57ef" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">Litmus需要一组定义良好的集群角色权限。此外，每个实验的先决条件是特定于实验的服务帐户、角色和角色绑定对象存在于目标名称空间中。Litmus提供了一种确定目标工作负载的全面方法，从较高级别的对象开始，到pod级别结束。这可以很好地限制爆炸半径，并确保只在预期的工作负载上注入混乱。</p><p id="0c27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Litmus是一个多方面的框架，具有不同的层，从安全的角度来看都需要适当的关注。</p><h1 id="7fa9" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">可观察性</h1><p id="24aa" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">Litmus的报告端主要由chaosresult自定义资源驱动。这是一个可定制的对象，可以用更多关于实验的细节来增强。然而，目前它提供非常简单的信息，主要是通过显示重要事件和最终结果来显示实验的状态。</p><h1 id="605d" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">混沌网格</h1><p id="2ed4" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">混沌网格是一个开源的云原生混沌工程平台。它提供各种类型的故障模拟，并具有编排故障场景的巨大能力。使用Chaos Mesh，您可以方便地模拟开发、测试和生产环境中现实中可能出现的各种异常，并发现系统中的潜在问题。为了降低混沌工程项目的门槛，混沌网格为您提供了可视化操作。您可以在Web UI上轻松设计您的混沌场景，并监控混沌实验的状态。</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es mp"><img src="../Images/c13930cb3c639d59717adb8e20577b68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Z0MedWmGq3ZpqI2PCRi9Q.png"/></div></div></figure><h1 id="a9a5" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">安装和管理</h1><h1 id="6bff" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">使用Helm安装混沌网格(推荐用于生产部署)<a class="ae kw" href="https://chaos-mesh.org/docs/production-installation-using-helm/#install-chaos-mesh-using-helm" rel="noopener ugc nofollow" target="_blank"> </a></h1><h1 id="8859" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">第一步:添加混沌网格库<a class="ae kw" href="https://chaos-mesh.org/docs/production-installation-using-helm/#step-1-add-chaos-mesh-repository" rel="noopener ugc nofollow" target="_blank"> </a></h1><p id="dfc9" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">将混沌网格储存库添加到头盔储存库:</p><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="a14b" class="lo jf hi lk b be lp lq l lr ls">helm repo add chaos-mesh https://charts.chaos-mesh.org</span></pre><h1 id="fd8e" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">第二步:查看混沌网格<a class="ae kw" href="https://chaos-mesh.org/docs/production-installation-using-helm/#step-2-view-the-installable-versions-of-chaos-mesh" rel="noopener ugc nofollow" target="_blank"> </a>的可安装版本</h1><p id="1682" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">要查看可以安装的图表，请执行以下命令:</p><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="5e40" class="lo jf hi lk b be lp lq l lr ls">helm search repo chaos-mesh</span></pre><h1 id="e3c3" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">步骤3:创建命名空间来安装混沌网格<a class="ae kw" href="https://chaos-mesh.org/docs/production-installation-using-helm/#step-3-create-the-namespace-to-install-chaos-mesh" rel="noopener ugc nofollow" target="_blank"> </a></h1><p id="2926" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">建议将Chaos Mesh安装在<code class="du lt lu lv lk b">chaos-mesh</code>命名空间下，也可以指定任意命名空间安装Chaos Mesh:</p><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="e8ce" class="lo jf hi lk b be lp lq l lr ls">kubectl create ns chaos-mesh</span></pre><h1 id="e4e5" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">第四步:在不同的环境中安装混沌网格<a class="ae kw" href="https://chaos-mesh.org/docs/production-installation-using-helm/#step-4-install-chaos-mesh-in-different-environments" rel="noopener ugc nofollow" target="_blank"> </a></h1><p id="2f95" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">您可以根据不同的环境执行以下安装命令。</p><h2 id="f303" class="lx jf hi bd jg ly lz ma jk mb mc md jo iq me mf js iu mg mh jw iy mi mj ka mk bi translated">码头工人<a class="ae kw" href="https://chaos-mesh.org/docs/production-installation-using-helm/#docker" rel="noopener ugc nofollow" target="_blank"> </a></h2><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="2350" class="lo jf hi lk b be lp lq l lr ls"># Default to /var/run/docker.sock<br/>helm install chaos-mesh chaos-mesh/chaos-mesh -n=chaos-mesh --version 2.5.0</span></pre><h2 id="f3d3" class="lx jf hi bd jg ly lz ma jk mb mc md jo iq me mf js iu mg mh jw iy mi mj ka mk bi translated">集装箱<a class="ae kw" href="https://chaos-mesh.org/docs/production-installation-using-helm/#containerd" rel="noopener ugc nofollow" target="_blank">集装箱</a></h2><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="c181" class="lo jf hi lk b be lp lq l lr ls">helm install chaos-mesh chaos-mesh/chaos-mesh -n=chaos-mesh --set chaosDaemon.runtime=containerd --set chaosDaemon.socketPath=/run/containerd/containerd.sock --version 2.5.0</span></pre><h2 id="461c" class="lx jf hi bd jg ly lz ma jk mb mc md jo iq me mf js iu mg mh jw iy mi mj ka mk bi translated">k3s<a class="ae kw" href="https://chaos-mesh.org/docs/production-installation-using-helm/#k3s" rel="noopener ugc nofollow" target="_blank">T16】</a></h2><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="f1af" class="lo jf hi lk b be lp lq l lr ls">helm install chaos-mesh chaos-mesh/chaos-mesh -n=chaos-mesh --set chaosDaemon.runtime=containerd --set chaosDaemon.socketPath=/run/k3s/containerd/containerd.sock --version 2.5.0</span></pre><h2 id="eed8" class="lx jf hi bd jg ly lz ma jk mb mc md jo iq me mf js iu mg mh jw iy mi mj ka mk bi translated">CRI-O <a class="ae kw" href="https://chaos-mesh.org/docs/production-installation-using-helm/#cri-o" rel="noopener ugc nofollow" target="_blank"> </a></h2><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="923b" class="lo jf hi lk b be lp lq l lr ls">helm install chaos-mesh chaos-mesh/chaos-mesh -n=chaos-mesh --set chaosDaemon.runtime=crio --set chaosDaemon.socketPath=/var/run/crio/crio.sock --version 2.5.0</span></pre><h1 id="e8b2" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">验证安装<a class="ae kw" href="https://chaos-mesh.org/docs/production-installation-using-helm/#verify-the-installation" rel="noopener ugc nofollow" target="_blank">和</a></h1><p id="fb93" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">要检查Chaos Mesh的运行状态，请执行以下命令:</p><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="4366" class="lo jf hi lk b be lp lq l lr ls">kubectl get po -n chaos-mesh</span></pre><p id="0aed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预期产出如下:</p><pre class="ky kz la lb fd lj lk ll bn lm ln bi"><span id="3254" class="lo jf hi lk b be lp lq l mq ls">NAME                                        READY   STATUS    RESTARTS   AGE<br/>chaos-controller-manager-69fd5c46c8-xlqpc   3/3     Running   0          2d5h<br/>chaos-daemon-jb8xh                          1/1     Running   0          2d5h<br/>chaos-dashboard-98c4c5f97-tx5ds             1/1     Running   0          2d5h</span></pre><h1 id="4d84" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">实验定义和种类</h1><p id="e64c" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">混沌类型列表分为以下几类:网络、pod、I/O、时间、内核和压力，每一类都有自己的CRD类型。它们都有一个共同的选择器条目，作为寻找目标舱的一种方式，除了可选的持续时间或期望混乱的循环调度。您可以使用chaos dashboard或yaml格式创建实验。</p><h1 id="0d40" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">使用混沌仪表盘<a class="ae kw" href="https://chaos-mesh.org/docs/simulate-pod-chaos-on-kubernetes/#create-experiments-using-chaos-dashboard" rel="noopener ugc nofollow" target="_blank">创建实验</a></h1><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es mr"><img src="../Images/700faba835dfb2694aa2f6c697a70d86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2a9vlvFtuJ0r6hnRJOaJsQ.png"/></div></div></figure><h1 id="f1b1" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">使用YAML配置文件创建实验</h1><h1 id="9e23" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">pod故障示例</h1><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es ms"><img src="../Images/95f0a02b37c800eac58d1d1adde8769a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-hUgnoaFvfnAF6JEpx1lCg.png"/></div></div></figure><h1 id="6c66" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">安全性</h1><p id="d725" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">混沌网格也使用一些Linux工具来实现低级的混沌类型。同样，它需要使用主机中的Docker API。因此，daemon Pods(部署为DaemonSet)将作为特权容器运行，并将挂载<code class="du lt lu lv lk b">/var/run/docker.sock</code>套接字文件。如果启用了边车注入，除了一些其他预期的基于角色的访问控制(RBAC)权限之外，控制器管理器窗格将需要管理可变webhook配置的权限。</p><h1 id="4de3" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">可观察性</h1><p id="b28a" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">主项目存储库提到了一个chaos dashboard side项目，但它似乎专门用于测试他们的数据库产品。构建一个更通用的仪表板项目正在进行中。到目前为止，可以通过检查集群中的自定义资源对象来监控混沌实验的状态。</p><h1 id="43ff" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">关键要点</h1><p id="0e12" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我们可以将混沌工程工具归类为像Litmus和Chaos Toolkit这样的混沌指挥器，或者像Chaos Mesh这样的混沌注入器。混沌编排器的目标是使用适当的混沌工程原理提供定义良好的实验。Litmus是一个更完整的框架，仍然提供可扩展性，而Chaos Toolkit旨在成为定义实验的标准API。</p><p id="e55a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">混沌注入器专注于实验的执行。混沌网格简化了Kubernetes开箱即用的实验执行。</p><p id="9517" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据您是需要一个执行程序还是一个编排程序，有许多开源选项可供选择，它们各有优缺点。</p></div></div>    
</body>
</html>