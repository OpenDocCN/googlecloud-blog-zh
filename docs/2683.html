<html>
<head>
<title>Inside the Data Quality Task in Google Dataplex</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Google Dataplex的数据质量任务中</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/inside-the-data-quality-task-in-google-dataplex-3fcb960ed247?source=collection_archive---------1-----------------------#2022-12-27">https://medium.com/google-cloud/inside-the-data-quality-task-in-google-dataplex-3fcb960ed247?source=collection_archive---------1-----------------------#2022-12-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="4909" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">介绍</h1><p id="43e7" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><em class="kb">声明:本文中表达的所有观点都是我个人的，仅代表我个人，不代表我现在或以前的雇主。</em></p><p id="2765" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">对于任何组织来说，数据都是最重要、最有价值的资产之一。数据推动做出明智决策的能力。然而，另一方面，如果数据资产在完整性、准确性和一致性方面不符合预期质量，则可能会对组织产生重大影响，因为这可能会导致不准确的业务决策。当数据资产达到预期的质量并推动整个组织的业务价值时，它就变成了真正的资产。因此，数据质量仍然是数据治理流程最重要的支柱之一，也是任何现代数据平台解决方案的关键方面。</p><p id="b8ba" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">Dataplex有两个选项来验证和测量数据质量:</p><ul class=""><li id="7d7d" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated"><strong class="jf hj">数据质量任务</strong>(正式提供)提供可定制的体验，可扩展并完全管理BigQuery和GCS中的DQ验证。它采用了<a class="ae kq" href="https://github.com/GoogleCloudPlatform/cloud-data-quality" rel="noopener ugc nofollow" target="_blank">T5】CloudDQ开源引擎T7】。任务在由Dataplex管理的无服务器基础设施上按计划运行。</a></li><li id="7942" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka km kn ko kp bi translated"><strong class="jf hj">自动数据质量</strong>(公共预览)使用用户界面驱动的工作流程自动化并简化数据质量定义。它有内置的报告，还通过警报和故障排除来推动行动。</li></ul><p id="3d3b" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">在这篇文章中，我打算介绍<strong class="jf hj">数据质量任务</strong>的架构、构建块和功能，该任务对驻留在不同存储服务(如BigQuery表和GC)上的分布式数据资产进行验证并提供数据质量洞察。</p><p id="58d9" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj">数据质量任务架构组件:</strong></p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es kw"><img src="../Images/5f9d7555cadd615533f79a46851899dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ymHIGHwCW6RYF-U9"/></div></div></figure><p id="02f0" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">上图说明了DQ任务的执行，并总结了支持DQ验证的输入和输出。</p><p id="3ab8" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">用户定义DQ规则和过滤器，并通过规则绑定将它们绑定到数据资产。所有这些都在DQ配置(YAML文件)中捕获。用户还提供了一个大查询表，其中将存储DQ结果。DQ任务规则引擎使用YAML定义的DQ配置，并使用完全由Dataplex管理的无服务器spark引擎将其转换为BigQuery SQL方言。验证流程利用BQ compute来执行SQL，根据定义的DQ规则测量数据资产内容，并将测量的DQ输出存储到指定的BQ表中。</p><p id="6bbe" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj"> Dataplex DQ任务的显著特点:</strong></p><ol class=""><li id="69d1" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka li kn ko kp bi translated">声明性DQ规则配置:</li></ol><ul class=""><li id="f8d3" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated">规则配置以yaml文件的形式编写，可以作为任何其他代码库进行管理，并且可以拥有代码版本控制和CI/CD流程。</li><li id="58f9" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka km kn ko kp bi translated">对于自定义规则，规则参数化是可能的，可以在规则应用(即规则绑定)时为其声明值。</li><li id="b63b" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka km kn ko kp bi translated">BigQuery SQL方言可用于定义自定义规则</li></ul><p id="5516" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">2.BQ和GCS内部的适当验证:</p><ul class=""><li id="d088" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated">Dataplex DQ任务通过将规则指令下推到底层服务(比如BQ)来执行验证处理</li><li id="6410" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka km kn ko kp bi translated">执行验证过程时，数据不会离开其原始位置。因此没有数据复制过程。</li></ul><p id="f24e" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">3.异步和无干扰验证</p><ul class=""><li id="fb57" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated">Dataplex DQ任务在异步模式下执行</li><li id="49eb" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka km kn ko kp bi translated">它不会干扰数据处理管道，也不会对经过验证的数据执行任何操作。</li></ul><p id="ebd7" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">4.由Dataplex完全管理执行</p><ul class=""><li id="465f" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated">100%无服务器，用户无需调配任何基础架构(计算、存储甚至调度程序)</li></ul><p id="a480" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">5.为编程消费设计的终端(持久BQ存储和云日志记录接收器)</p><ul class=""><li id="9a55" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated">用户可以构建BI仪表板，或者以编程方式将结果用于各种数据管理用例</li></ul><p id="0466" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj">让我们看一些声明性DQ规则配置的例子</strong></p><ol class=""><li id="3b9e" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka li kn ko kp bi translated">Dataplex DQ任务规则配置的简单示例:</li></ol><pre class="kx ky kz la fd lj lk ll bn lm ln bi"><span id="bee1" class="lo ig hi lk b be lp lq l lr ls"># rules_config.yaml<br/> <br/># define a rule<br/>rules:<br/> REGEX_VALID_EMAIL:<br/>   rule_type: REGEX<br/>   dimension: conformance<br/>   params:<br/>     pattern: |-<br/>       ^[^@]+[@]{1}[^@]+$<br/> <br/># apply a rule to data<br/>rule_bindings:<br/> T2_DQ_1_EMAIL:<br/>   entity_id: DQ_TABLE<br/>   column_id: VALUE<br/>   incremental_time_filter_column_id: TS<br/>   rule_ids:<br/>     - REGEX_VALID_EMAIL</span></pre><p id="125b" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">2.规则参数化示例。</p><pre class="kx ky kz la fd lj lk ll bn lm ln bi"><span id="9cd2" class="lo ig hi lk b be lp lq l lr ls"># rules_config.yaml<br/> <br/>rules:<br/> SQL_LENGTH_LE:<br/>   rule_type: CUSTOM_SQL_EXPR<br/>   dimension: correctness<br/>   params:<br/>     custom_sql_arguments:<br/>       - N                       # declaring an parameter<br/>     custom_sql_expr: |-<br/>       LENGTH( $column ) &lt;= $N <br/> <br/># apply a rule to data<br/>rule_bindings:<br/> CHECK_COLUMN_LENGTH1:<br/>   entity_id: DQ_TABLE1<br/>   column_id: STRING_COLUMN1<br/>   rule_ids:<br/>     - SQL_LENGTH_LE<br/>         N: 50                  # declaring the parameter value<br/> <br/> CHECK_COLUMN_LENGTH2:<br/>   entity_id: DQ_TABLE1<br/>   column_id: STRING_COLUMN2<br/>   rule_ids:<br/>     - SQL_LENGTH_LE<br/>         N: 15                  # declaring the parameter value</span></pre><p id="ca60" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">3.通过SQL定制规则的示例</p><pre class="kx ky kz la fd lj lk ll bn lm ln bi"><span id="4b64" class="lo ig hi lk b be lp lq l lr ls">FOREIGN_KEY_VALID:<br/> rule_type: CUSTOM_SQL_EXPR<br/> dimension: consistency<br/> params:<br/>   custom_sql_expr: |-<br/>     $column in (select distinct foreign_key from `&lt;dataset-id&gt;.customer_id`)</span></pre><h2 id="6ec7" class="lt ig hi bd ih lu lv lw il lx ly lz ip jo ma mb it js mc md ix jw me mf jb mg bi translated"><strong class="ak">让我们深入了解用于构建DQ任务验证的重要概念</strong></h2><h1 id="cb0e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">规则</h1><p id="7736" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">规则捕获衡量数据资产的标准。它们没有指定应用于哪些特定的数据资产，并且可以在多个数据资产之间重用。基本上规则可以在<strong class="jf hj">行级</strong>或<strong class="jf hj">集合级</strong>应用。</p><p id="27d0" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj">行级:</strong></p><p id="1916" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">行级规则分别评估数据实体的每一行，并分别报告每一行的验证结果(即，每一行在验证时被分配一个通过/失败结果，然后以汇总格式报告)。</p><p id="147e" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj">设置级别:</strong></p><p id="6a86" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">集合级规则将一组记录作为一个整体进行评估，并为这组记录返回一个“通过/失败”结果。当前设置级别的规则只能通过自定义SQL模板来定义。“记录集”可以定义为:</p><ol class=""><li id="63c5" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka li kn ko kp bi translated">自上次验证运行以来识别的数据实体中的增量记录(修改的或新的)</li><li id="59fa" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka li kn ko kp bi translated">在非增量验证的情况下，数据实体中的所有记录(未过滤)</li></ol><p id="990d" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">下图说明了不同类型的规则如何应用于经过验证的数据:</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es kw"><img src="../Images/94ff06cf0c5ff65334a323b4c67f9b9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3LPBI54iXmrE5YUO"/></div></div></figure><p id="94e9" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">规则类型分为</p><ol class=""><li id="4fde" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka li kn ko kp bi translated"><strong class="jf hj">内置规则类型</strong>(如NOT_BLANK或NOT_NULL或REGEX)</li></ol><ul class=""><li id="8e85" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated">内置规则类型是在DQ引擎中定义的，因此特定于平台的实现对用户是隐藏的。</li><li id="39b6" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka km kn ko kp bi translated">此阶段的所有内置规则类型都在行级别应用</li></ul><p id="e401" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">2.<strong class="jf hj">自定义SQL模板</strong>(如自定义_SQL_EXPR或自定义_ SQL _语句)</p><ul class=""><li id="cb90" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated">它允许用户在BQ SQL方言中定义任意的DQ规则逻辑</li><li id="0d62" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka km kn ko kp bi translated">CUSTOM_SQL_EXPR应用于行级别，而CUSTOM_SQL_STATEMENT应用于集级别</li></ul><p id="f07b" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">基于定制sql模板的行级和集合级规则都提供了一个隐式参数<strong class="jf hj"> $column </strong>，该参数指示正在验证的列。该参数在规则绑定中被实例化。</p><p id="40b7" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">以下脚本提供了行级和集合级各种类型规则的示例定义</p><pre class="kx ky kz la fd lj lk ll bn lm ln bi"><span id="e7d8" class="lo ig hi lk b be lp lq l lr ls">rules:<br/> <br/># Row-level rule based on a built-in rule type<br/> VALID_ITEM_ID:<br/>   rule_type: REGEX<br/>   params:<br/>     pattern: |-<br/>       [A-Z]{5}[0-9]{15}<br/> <br/># Row-level rule based on a custom sql template<br/> VALUE_ZERO_OR_POSITIVE:<br/>   rule_type: CUSTOM_SQL_EXPR<br/>   dimension: correctness<br/>   params:<br/>     custom_sql_expr: |-<br/>       $column &gt;= 0<br/>      <br/># Set-level rule based on a custom sql template with a single parameter.<br/> GAP:<br/>   rule_type: CUSTOM_SQL_STATEMENT<br/>   custom_sql_arguments:<br/>     max_gap<br/>   params:<br/>     custom_sql_statement: |-<br/>       with lagged_data as (<br/>         select $column, lag($column) over (order by $column ASC) as prev<br/>         from data<br/>       )<br/>       select $column from lagged_data<br/>       where prev is not null and datetime_diff($column, prev, HOUR) &gt; $max_gap</span></pre><h1 id="535e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">过滤</h1><p id="903b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">筛选器是可重用的逻辑，它指定验证中应该包括或不包括哪个记录子集。过滤器是单独定义的，并附加到规则绑定中的规则和数据实体。</p><p id="643c" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">以下是过滤器定义的示例:</p><pre class="kx ky kz la fd lj lk ll bn lm ln bi"><span id="60e1" class="lo ig hi lk b be lp lq l lr ls">row_filters:<br/> DATA_TYPE_EMAIL:<br/>   filter_sql_expr: |-<br/>     contact_type = 'email'</span></pre><h1 id="306e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">数据实体</h1><p id="6c36" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">数据实体是可以查询和验证的BigQuery资产，比如表、外部表(数据物理上驻留在GCS bucket中)和视图。</p><p id="65d4" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">DQ规则适用于单个数据实体。DQ配置不允许定义适用于多个数据实体的DQ规则(如调节规则)。但是，在自定义SQL模板中，仍然可以从DQ规则中引用多个数据实体。</p><p id="255a" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">数据实体对于行级规则是隐式的。对于自定义SQL模板，数据实体是通过“数据”源提供的。验证列通过隐式参数$column提供给自定义SQL模板。</p><p id="d939" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">Dataplex DQ任务在将数据实体暴露给DQ规则之前，将几个服务功能应用于数据实体:</p><ol class=""><li id="9682" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka li kn ko kp bi translated">特定于环境的细节(如项目或数据集)被参数化，这允许跨各种环境轻松部署规则</li><li id="1a1f" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka li kn ko kp bi translated">Dataplex DQ任务在将数据传递给DQ规则进行验证之前，执行一些常见的数据管理操作，如识别增量验证的数据更改或通过将多个验证过程捆绑在一起应用优化。这是对用户透明地执行的。</li><li id="71bf" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka li kn ko kp bi translated">只有那些通过了用户定义的过滤器的记录才成为数据验证的对象。</li></ol><h1 id="62a5" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">元数据注册表</h1><p id="8d4a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Dataplex DQ任务依赖于描述数据实体的结构元数据来执行验证和各种优化。这种结构化元数据由元数据注册中心提供。下面的脚本中给出了支持的元数据注册</p><pre class="kx ky kz la fd lj lk ll bn lm ln bi"><span id="4967" class="lo ig hi lk b be lp lq l lr ls">#entities yaml metadata registry<br/>entity_id: CUSTOMER_TABLE<br/> <br/>#Dataplex metadata registry<br/>entity_uri: dataplex://projects/&lt;project-id&gt;/locations/&lt;region-id&gt;/lakes/&lt;lake-id&gt;/zones/&lt;zone-id&gt;/entities/customer_table<br/> <br/>#BigQuery metadata registry<br/>entity_uri: bigquery://projects/&lt;project_id&gt;/datasets/&lt;dataset_name&gt;/tables/customer_table</span></pre><p id="4163" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">上面提到的开放参数(如project-id)可以省略，并通过元数据注册默认配置指定，从而允许物理环境抽象。</p><h1 id="0b60" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">规则绑定</h1><p id="5944" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">规则绑定定义<strong class="jf hj"> </strong>数据质量规则验证的验证范围<strong class="jf hj"> </strong>。规则绑定捕获以下内容:</p><ol class=""><li id="db7a" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka li kn ko kp bi translated">规则绑定指定哪些DQ规则适用于哪些数据实体。这是一种多对多的关系，单个DQ规则可以应用于多个数据实体，而多个DQ规则可以应用于单个数据实体。</li><li id="246b" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka li kn ko kp bi translated">规则绑定为自定义SQL模板规则下指定的所有参数声明值</li><li id="76ef" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka li kn ko kp bi translated">规则绑定捕获确定增量验证(通过使用增量时间戳列名)或使用用户定义的过滤器的参数。</li><li id="fed5" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka li kn ko kp bi translated">规则绑定定义了捕获DQ验证输出的粒度级别-在每次验证运行下，会为每个规则绑定生成聚合级别的结果。</li></ol><pre class="kx ky kz la fd lj lk ll bn lm ln bi"><span id="74e2" class="lo ig hi lk b be lp lq l lr ls">VALIDATE_CUSTOMER:<br/> # data entity referenced via Dataplex metadata registry URI<br/> entity_uri: dataplex://projects/&lt;project-id&gt;/locations/&lt;region-id&gt;/lakes/&lt;lake-id&gt;/zones/&lt;zone-id&gt;/entities/customer_table # replace variables in &lt;angle brackets&gt; with your own configs<br/> column_id: email # validation column<br/> row_filter_id: DATA_TYPE_EMAIL # user-defined filter<br/> # set of DQ rules connected to the data entity and validation column specified in current rule binding<br/> rule_ids:<br/>   - NO_DUPLICATES_IN_COLUMN_GROUPS:<br/>       column_names: "value" # instantiating a parameter defined in the rule<br/>   - NOT_NULL_SIMPLE</span></pre><h1 id="0304" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">确认</h1><p id="a822" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">一旦用户指定DQ规则配置(规则、过滤器和规则绑定)，Dataplex DQ任务将根据用户为Dataplex DQ任务创建的时间表保持DQ输出最新。</p><p id="1850" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">对于每个规则绑定，Dataplex DQ任务生成用于数据验证的SQL指令，然后通过<strong class="jf hj">下推</strong>执行将它们提交给底层数据平台(BigQuery)。</p><p id="8b9e" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">下推执行允许在不从底层存储平台提取数据的情况下进行数据验证，从而提高了验证过程的性能和安全性。</p><h1 id="3cac" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">输出</h1><p id="37ee" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">DQ输出捕捉DQ验证的原始结果。Dataplex DQ任务将结果存储在指定的BQ表中，但不解释这些结果来执行任何操作——这些步骤由用户执行，不在Dataplex DQ任务的范围内。</p><p id="379d" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">对于每个规则绑定和验证运行，DQ输出存储在汇总层。</p><ul class=""><li id="7709" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated">对于<strong class="jf hj">行级</strong>规则，DQ输出捕获每个规则绑定和验证运行中通过或未通过验证的记录总数</li><li id="5764" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka km kn ko kp bi translated">对于<strong class="jf hj">集合级</strong>规则，DQ输出为每个规则绑定和验证运行捕获一个二进制的“通过/失败”结果</li></ul><p id="4a1a" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">DQ输出通过以下通道捕获:</p><ol class=""><li id="45b9" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka li kn ko kp bi translated"><strong class="jf hj"> BigQuery </strong> —发布到用户定义的DQ输出表。通常通过对输出内容的程序性轮询(拉取)来推动数据管道和消耗决策制定，或者通过在输出表上建立的BI仪表板来消耗。</li><li id="96d2" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka li kn ko kp bi translated"><strong class="jf hj">云日志</strong> —作为云日志的专用事件类型发布，允许接近实时地交付给消费者。通常由编程订阅(推送)使用，以推动数据管道或DQ事件管理工作流。</li></ol><p id="0224" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">通过使用这些渠道，用户可以构建BI仪表板来可视化DQ输出，或以编程方式使用DQ输出来推动数据管道步骤、数据使用或DQ事件管理。</p><h1 id="05df" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">费用</h1><p id="e203" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Dataplex数据质量任务会因使用BigQuery和Dataproc无服务器(批处理)而产生费用。</p><ul class=""><li id="f9a3" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated">Dataplex DQ任务将YAML配置文件转换为BigQuery SQLs，并在用户项目中运行它们，用户项目根据<a class="ae kq" href="https://cloud.google.com/bigquery/pricing" rel="noopener ugc nofollow" target="_blank"> BigQuery定价</a>生成成本。</li><li id="0720" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka km kn ko kp bi translated">Dataplex使用Spark运行预先构建的、由Google维护的<a class="ae kq" href="https://github.com/GoogleCloudPlatform/cloud-data-quality" rel="noopener ugc nofollow" target="_blank">开源CloudDQ </a>驱动程序，将YAML配置转换为BigQuery查询，后者根据<a class="ae kq" href="https://cloud.google.com/dataproc-serverless/pricing" rel="noopener ugc nofollow" target="_blank"> Dataproc无服务器定价</a>生成成本</li><li id="ef07" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka km kn ko kp bi translated">在Dataplex中安排数据质量任务是免费的。</li></ul><h1 id="fd51" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">Dataplex DQ任务的主要考虑因素和限制</h1><p id="9884" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">使用Dataplex DQ任务有一些考虑和当前的限制，可能会限制它在高级用例中的适用性。</p><ul class=""><li id="1e9b" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated">Dataplex依靠开源的DQ引擎— <a class="ae kq" href="https://github.com/GoogleCloudPlatform/cloud-data-quality" rel="noopener ugc nofollow" target="_blank"> CloudDQ </a> —来运行这些检查。用户需要了解CloudDQ功能和CloudDQ YAML规范。</li><li id="719a" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka km kn ko kp bi translated">规则说明是一个完全手动的过程。没有自动的规则推理。</li><li id="0dae" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka km kn ko kp bi translated">虽然有UI来调度和监控数据质量运行，但是没有UI来定义规则(它是通过yaml指定的)。</li><li id="109b" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka km kn ko kp bi translated">目前不支持聚合函数的增量计算，该计算可能支持数据的统计/分析属性的验证(例如标准偏差)</li><li id="406f" class="kh ki hi jf b jg kr jk ks jo kt js ku jw kv ka km kn ko kp bi translated">目前，DQ结果以聚合级别报告，要么是根据验证运行时间确定的最后一个数据增量(对于增量验证)，要么是整个数据实体(对于非增量验证)。目前还不能定义自定义边界，以便将经过验证的数据拆分为多个批次进行汇总报告。</li></ul><h1 id="bc7c" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">结论:</h1><p id="bbea" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Dataplex数据质量任务可用于为Google Cloud上的现代数据平台构建可靠且可扩展的数据质量解决方案。它与其他GCP数据服务很好地集成，并使用100%无服务器机制来执行和调度。它利用了DQ规则配置的YAML规范语法，这使得代码管理非常容易，并且可以与CI/CD管道集成。它建立在一个开源项目(<a class="ae kq" href="https://github.com/GoogleCloudPlatform/cloud-data-quality" rel="noopener ugc nofollow" target="_blank">云DQ </a>)的基础上，该项目接收社区对改进的反馈。</p><p id="936d" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">希望你觉得这篇文章有趣并且有用。快乐学习！！</p><p id="141f" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">参考资料:</p><p id="ad11" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><a class="ae kq" href="https://github.com/GoogleCloudPlatform/cloud-data-quality/blob/main/README.md" rel="noopener ugc nofollow" target="_blank">https://github . com/Google cloud platform/cloud-data-quality/blob/main/readme . MD</a></p><p id="e371" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><a class="ae kq" href="https://cloud.google.com/dataplex/docs/data-quality-tasks-overview" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/data plex/docs/data-quality-tasks-overview</a></p></div></div>    
</body>
</html>