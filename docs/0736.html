<html>
<head>
<title>1 hour migrations #2 : Adapting your highly available DB2 primary-standby deployment to work in GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">1小时迁移#2:让您的高可用性DB2主备用部署适应GCP的工作环境</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/one-hour-migrations-2-adapting-your-highly-available-db2-primary-standby-deployment-to-work-in-c51a19c23c8?source=collection_archive---------0-----------------------#2018-08-23">https://medium.com/google-cloud/one-hour-migrations-2-adapting-your-highly-available-db2-primary-standby-deployment-to-work-in-c51a19c23c8?source=collection_archive---------0-----------------------#2018-08-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6553" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">也称为:带有TSA、HADR和ACR的HA DB2，或者用英语说:</p><ul class=""><li id="74bd" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">高可用性:高可用性</li><li id="9203" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">TSA: Tivoli系统自动化</li><li id="e95e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">HADR:高可用性灾难恢复(IBM)</li><li id="032d" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">ACR:自动客户端重新路由</li></ul><h2 id="8b84" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">谁会觉得这有用</h2><p id="b2f9" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">考虑在GCP上部署高可用性DB2实例的人。</p><h2 id="33ca" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">挑战</h2><p id="9ec3" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">假设您有一个高可用性、HADR配置的本地DB2实例，它利用TSA实现故障转移。您希望将它们迁移到云中。轻松点。或者是？以下是一些需要考虑的事情:</p><ol class=""><li id="1289" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc kr jj jk jl bi translated">在偶数个服务器的情况下，TSA可以使用三种方法来确定“平局决胜”，即哪个实例现在应该是主实例。存储平局决胜在云中可能会成为问题，因为所有实例都需要读写访问。IBM还提供了一个云决胜器，它不支持GCP(到目前为止也仅限于2个实例)。这让我们把网络决胜局作为剩下的选择。</li><li id="7aa6" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc kr jj jk jl bi translated">在云中，虚拟IP地址实际上…毫无意义。如果您将TSA配置为在发生故障转移时获取虚拟IP，这可能会在内部产生很好的效果，但云网络基础架构以神秘的方式移动，不会适应这种情况。</li></ol><h2 id="d7d3" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">解决方案？</h2><p id="06fa" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">下图描述了GCP上的一个示例解决方案架构:</p><figure class="kt ku kv kw fd kx er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es ks"><img src="../Images/1b46b3063a6bc2fa36abfd8e03d45343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w8nODZumeB9_db4UWr_p7A.png"/></div></div></figure><ol class=""><li id="a4b9" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc kr jj jk jl bi translated">为网络平局决胜配置您的TSA，因为云和存储平局决胜不适用。</li><li id="a15a" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc kr jj jk jl bi translated">虚拟IP的云替代方案:您可以考虑在HADR中插入有趣的脚本，这些脚本将在发生故障转移时调用GCP api，而不是拉出虚拟IP。也许您可以使用别名IP并将其移动到主实例。理论上听起来不错，但不能保证它在某些灾难情况下会有效(这正是我们在这里试图克服的)。也许是控制负载平衡器的某种方法？这带来了一系列不可预测的行为、竞争条件和一个未解决的问题，即如何向负载均衡器发出信号，表明实例准备好了(即主实例)还是没有准备好(即从实例)。此外，最重要的是，据我所知，IBM可能不会对您可能遇到的行为和问题负责。</li><li id="2e40" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc kr jj jk jl bi translated">幸运的是，IBM提供了ACR(自动客户端重新路由)。这意味着DB2实例可以“告诉”客户机集群中的其他实例，当发生故障转移时，客户机可以自动连接到其他实例。这是DB2服务器上的一个配置。</li><li id="e062" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc kr jj jk jl bi translated">我们可以超越ACR DB2服务器端设置。为什么？让我们想象以下场景。所有客户机都知道如何连接到主服务器地址，事实上，它们在连接时也会收到备用服务器的地址。如果您的主服务器故障切换到备用服务器，然后您启动一个新的客户端。该客户端可能被配置为连接到主地址。在这种情况下，客户端将无法连接，因为该地址不可达。您可以将客户端配置为知道服务器，并且它不需要从主服务器获取地址。(查一个例子:<a class="ae le" href="https://www.ibm.com/support/knowledgecenter/en/SSEPGG_10.1.0/com.ibm.db2.luw.apdv.cli.doc/doc/c0056196.html" rel="noopener ugc nofollow" target="_blank">https://www . IBM . com/support/knowledge center/en/SSE pgg _ 10 . 1 . 0/com . IBM . DB2 . luw . apdv . CLI . doc/doc/c 0056196 . html</a>)</li></ol><h2 id="783b" class="jr js hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">结论</h2><p id="cc6f" class="pw-post-body-paragraph if ig hi ih b ii km ik il im kn io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">我希望这对管理DB2部署和考虑迁移到云(特别是GCP)的专业人员有用。像往常一样，考虑您的选项、要求和限制，以了解什么解决方案可能适合您和您的组织。我计划在不久的将来有一个关于cloud.google.com/solutions<a class="ae le" href="http://cloud.google.com/solutions" rel="noopener ugc nofollow" target="_blank">的更详细的官方解决方案文档。</a></p></div></div>    
</body>
</html>