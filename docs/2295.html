<html>
<head>
<title>Performance improvement &amp; cost reduction with GCP Cloud CDN Dynamic compression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">借助GCP云CDN动态压缩提升性能并降低成本</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/performance-improvement-cost-reduction-with-gcp-cloud-cdn-dynamic-compression-f851a5ee7f7f?source=collection_archive---------1-----------------------#2022-08-09">https://medium.com/google-cloud/performance-improvement-cost-reduction-with-gcp-cloud-cdn-dynamic-compression-f851a5ee7f7f?source=collection_archive---------1-----------------------#2022-08-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="180b" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">介绍</h1><p id="c9e2" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在我们的IT生活中，我们都使用过像winzip、winrar这样的压缩工具来减小文件、照片等的大小。压缩的主要优点是减少存储空间、数据传输时间和通信带宽。压缩文件比未压缩文件需要的存储容量少得多，这意味着存储费用大大降低。压缩文件还需要较少的传输时间，同时消耗较少的网络带宽。这也有助于降低成本，提高生产率。</p><p id="a53a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">从CDN用例的角度来看，大多数客户选择加入CDN，以获得加速网络交付的优势。因此，CDN中的压缩功能为最终用户体验提供了乘数效应，并改善了页面负载等重要参数。客观地说，CDN客户通过选择压缩将获得的两大优势是</p><ol class=""><li id="028f" class="kg kh hi jf b jg kb jk kc jo ki js kj jw kk ka kl km kn ko bi translated"><strong class="jf hj">性能</strong>:这是因为我们发送了更少的字节，因此页面加载时间等统计数据得到了改善。</li><li id="8606" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka kl km kn ko bi translated"><strong class="jf hj">成本效率</strong>:由于CDN的成本参数之一是CDN的出口流量，出口流量越少意味着CDN账单越少。</li></ol><p id="ee89" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">Google Cloud CDN提供了一个名为“<a class="ae ku" href="https://cloud.google.com/cdn/docs/dynamic-compression" rel="noopener ugc nofollow" target="_blank">动态压缩</a>的功能，它与全局外部HTTP(S)负载均衡器一起工作，自动压缩云CDN在源和客户端之间提供的响应。这篇博客主要关注Google Cloud CDN的动态压缩特性。所有现代浏览器都支持压缩，唯一需要协商的是浏览器和服务器之间使用的压缩算法。现在有两个算法是相关的:<strong class="jf hj"> gzip </strong>，最常见的一个，还有<strong class="jf hj"> brotli </strong>，新的挑战者。</p><p id="1481" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在高层次上，浏览器发送一个<strong class="jf hj"> Accept-Encoding </strong>头，其中包含它支持的算法及其优先级顺序，服务器选择一个，用它来压缩响应的正文，并使用<strong class="jf hj"> Content-Encoding </strong>头告诉浏览器它选择的算法。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/572a057a67e63dc4eb7a20c49002faf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*beMzux8HIPOyC144"/></div></div></figure><p id="04fa" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">测试拓扑</strong></p><p id="0c56" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在这篇博客中，我想展示在Google Cloud CDN上启用动态压缩的步骤，以及验证功能的步骤。为了这个博客的目的，我在GCP上使用了一个演示设置，包括以下组件</p><ul class=""><li id="a18b" class="kg kh hi jf b jg kb jk kc jo ki js kj jw kk ka lh km kn ko bi translated">我有一个谷歌云存储(GCS)桶和一个JSON文件上传在桶里</li><li id="e197" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka lh km kn ko bi translated">我将尝试通过谷歌云CDN提供这个JSON文件</li><li id="8320" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka lh km kn ko bi translated">在这个测试中，我让终端客户发送Accept-encoding : gzip请求</li></ul><p id="13a9" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">下面是用于测试Google Cloud CDN动态压缩的拓扑的高级表示</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es li"><img src="../Images/2ad3211a953801ae55db41b56e2605e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8SQYpDoEaz_fcJoT"/></div></div></figure><h1 id="c38f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">负载平衡器和CDN配置设置</h1><p id="0b5e" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这篇博客的想法不是解释云CDN是如何配置的，或者https负载均衡器是如何工作的。读者可以阅读下面的GCP文档</p><ul class=""><li id="54a8" class="kg kh hi jf b jg kb jk kc jo ki js kj jw kk ka lh km kn ko bi translated"><a class="ae ku" href="https://cloud.google.com/load-balancing/docs/https/setting-up-https-external-backend-internet-neg" rel="noopener ugc nofollow" target="_blank">如何为外部后端设置GCP HTTPS LB</a></li><li id="e958" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka lh km kn ko bi translated"><a class="ae ku" href="https://cloud.google.com/cdn/docs/using-cdn" rel="noopener ugc nofollow" target="_blank">搭建云CDN </a></li></ul><p id="5e30" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">为了让读者受益，下面是我在测试时使用的后端服务的快照</p><p id="d600" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">$ g cloud compute back end-services描述servneg — global </em></p><p id="f10a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj"> affinityCookieTtlSec: 0 </em></p><p id="c6ba" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">后端:</em></p><p id="ff07" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj"> -平衡模式:利用率</em></p><p id="201d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">容量刻度:1.0 </em></p><p id="63ba" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">组:</em><a class="ae ku" href="https://www.googleapis.com/compute/v1/projects/m-aaaa-aaaa/global/networkEndpointGroups/cdn-neg" rel="noopener ugc nofollow" target="_blank"><em class="lj">https://www . Google APIs . com/compute/v1/projects/m-AAAA-AAAA/global/networkEndpointGroups/cdn-neg</em></a></p><p id="bd71" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">cdn政策:</em></p><p id="8447" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">缓存关键策略:</em></p><p id="399c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj"> includeHost: true </em></p><p id="b9ac" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj"> includeProtocol: true </em></p><p id="739c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">includeQueryString:true</em></p><p id="2a7b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">CACHE mode:CACHE _ ALL _ STATIC</em></p><p id="0c5b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">客户端Ttl: 3600 </em></p><p id="4d85" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">默认Ttl: 3600 </em></p><p id="2944" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj"> maxTtl: 86400 </em></p><p id="31e4" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">否定缓存:假</em></p><p id="8dc5" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">请求合并:真</em></p><p id="56e1" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj"> serveWhileStale: 0 </em></p><p id="2252" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">连接排水:</em></p><p id="0a53" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj"> drainingTimeoutSec: 0 </em></p><p id="5c7c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">creation timestamp:' 2022–08–02t 22:00:12.236–07:00 '</em></p><p id="30d4" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj"> customRequestHeaders: </em></p><p id="84eb" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj"> -主机:storage.googleapis.com </em></p><p id="d41c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj"> customResponseHeaders: </em></p><p id="5b51" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj"> -缓存状态:{cdn_cache_status} </em></p><p id="e55f" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">描述:</em></p><p id="363c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj"> enableCDN: true </em></p><p id="b46d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">指纹:PgKJ8FWxNHA= </em></p><p id="3ad4" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">id:' 121325304488115763 '</em></p><p id="407e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">种类:计算#后端服务</em></p><p id="a5fb" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">负载平衡方案:外部</em></p><p id="9646" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">日志配置:</em></p><p id="d495" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">使能:真</em></p><p id="7caa" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">采样率:1.0 </em></p><p id="36fb" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">名称:servneg </p><p id="b8f1" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">端口:80 </em></p><p id="a025" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">端口名:http </em></p><p id="5c1b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">协议:HTTP </em></p><p id="95f3" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">self link:</em><a class="ae ku" href="https://www.googleapis.com/compute/v1/projects/m-aaaa-aaaa/global/backendServices/servneg" rel="noopener ugc nofollow" target="_blank"><em class="lj">https://www . Google APIs . com/compute/v1/projects/m-AAAA-AAAA/global/backendServices/serv neg</em></a></p><p id="07ca" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">会话亲和性:无</p><p id="6862" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><em class="lj">超时时间:30 </em></p><h1 id="8bd5" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">如何启用/禁用压缩</h1><p id="c4ca" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">请使用以下方法之一(gcloud CLI或GCP控制台UI)来禁用/启用压缩。</p><p id="87c3" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">启用自动压缩的gcloud命令如下</p><p id="5aec" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">g cloud compute back end-BUCKET update YOUR _ BUCKET \</strong></p><p id="d82d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj"> —压缩模式=自动</strong></p><p id="cf6a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">禁用自动压缩的gcloud命令如下</p><p id="886b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">g cloud compute back-BUCKET update YOUR _ BUCKET \</strong></p><p id="475c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj"> —压缩模式=禁用</strong></p><p id="3212" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">如果您希望使用Google Cloud console (web-UI)编辑现有的后端服务，请遵循以下步骤</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es li"><img src="../Images/b3843ca3c94e61073b8486d865eb28e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0Bx14qXhUV-u7pAr"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">图:启用/禁用GCP云CDN的动态压缩</figcaption></figure><h1 id="6d03" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">如何验证压缩</h1><p id="7a21" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">有多种方法可以帮助客户确保压缩由云CDN完成。其中一些如下-</p><ol class=""><li id="3626" class="kg kh hi jf b jg kb jk kc jo ki js kj jw kk ka kl km kn ko bi translated">查看由云CDN提供服务的请求的响应头。我们将看到，响应是用Vary: Accept-Encoding头提供给客户机的。</li></ol><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es li"><img src="../Images/d9830973ca572be1f8a3d5f6f1fe3ead.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sLRwTYa1T_HFsHE4"/></div></div></figure><p id="70e9" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">2.您可以查看响应头的“content-length”部分，以得出响应被压缩的结论。未经压缩的相同内容会产生以下结果</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es li"><img src="../Images/4efd621f1fa344fbffd7f84211875fa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pfbyI3SlxbQShFPt"/></div></div></figure><p id="a853" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">因此，您可以看到压缩后的内容长度是6162，未压缩时是115667</p><p id="b4dc" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">3.在GCP日志下，您可以看到大小并推断是否发生了压缩。以下示例显示了经过压缩和未经压缩的相同文件。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es li"><img src="../Images/208a26c666350fb56cd712eef1bf7791.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EwhSgAjr8NHAFzVF"/></div></div></figure><h1 id="5e49" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">需要考虑的要点</h1><p id="4009" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">对于云CDN压缩，有一些要点需要注意-</p><ol class=""><li id="ffd6" class="kg kh hi jf b jg kb jk kc jo ki js kj jw kk ka kl km kn ko bi translated">云CDN压缩仅适用于1 KiB和10 MiB(含)之间的对象。</li><li id="4e16" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka kl km kn ko bi translated">某些MIME类型只能被压缩，如text/html、text/csv、application/json、application/javascript等。在<a class="ae ku" href="https://cloud.google.com/cdn/docs/dynamic-compression#compressible-content" rel="noopener ugc nofollow" target="_blank">链接</a>中提到了详尽的列表</li><li id="8ee5" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka kl km kn ko bi translated">如果浏览器使用首选压缩算法(通过权重)发送请求，如"<em class="lj">br；q=1.0，gzipq=0.8，*；q = 0.1”；</em>由于发送请求时优先选择“br ”,云cdn将使用“br”压缩算法压缩对象。</li><li id="40c5" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka kl km kn ko bi translated">如果浏览器发送没有偏好权重的请求，就像只发送accept-encoding作为“gzip，br”；云CDN将使用“br”作为压缩的首选算法。</li><li id="a49e" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka kl km kn ko bi translated">如果带有接受编码报头的客户端请求是针对对象发送的，并且是“高速缓存未命中”；从后端源获取对象(假设后端返回未压缩的对象)→对象由云CDN压缩→对象的压缩副本存储在缓存中→并返回给请求客户端。请注意:对这种客户端的第一个回复将是对象的未压缩副本，并发布CDN将在缓存中有对象的压缩副本，并且同样将提供给最终客户端。</li><li id="1301" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka kl km kn ko bi translated">如果客户端请求是针对带有accept-encoding标头的对象发送的，但该对象在缓存中以“未压缩”形式存在；云CDN将使用适当的算法压缩对象，然后提供给最终客户。</li><li id="d4d8" class="kg kh hi jf b jg kp jk kq jo kr js ks jw kt ka kl km kn ko bi translated">如果对象大于10MiB，则云CDN动态压缩不适用。因此，如果客户要求小字节范围[例如1–100]；他将获得请求的字节范围服务(无压缩)。</li></ol><h1 id="969f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">结束语:</h1><p id="d54d" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">对于内容符合可由云CDN压缩的内容的资格标准的现有Google Cloud CDN客户来说，启用该功能是显而易见的(特别是因为这是免费的)。启用此功能后，客户应该会看到出口CDN数据量的下降，因此应该能够享受每月在云CDN上的支出减少。</p><p id="bfe5" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">对于一类客户，他们在后端处理压缩；这一特性没有任何问题。GCP云CDN不会尝试压缩后端服务的已压缩对象。因此，此类客户的应用程序不会有任何变化。</p><p id="1e37" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">GCP云CDN的动态压缩对于客户来说是一个简单的自动/禁用可配置项目。因此，客户不需要为配置此功能付出太多的计划和精力。向GCP致敬，他真的做了这个“交钥匙工程”并消除了复杂性。</p><p id="3695" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">免责声明</strong>:这是为了告知读者，文中表达的观点、想法、意见仅属于作者，不一定属于作者的雇主、组织、委员会或其他团体或个人。</p></div></div>    
</body>
</html>