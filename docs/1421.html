<html>
<head>
<title>Google Cloud Data Catalog — Integrate Your On-Prem RDBMS Metadata</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google云数据目录—集成您的本地RDBMS元数据</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-cloud-data-catalog-integrate-your-on-prem-rdbms-metadata-468e0d8220fb?source=collection_archive---------0-----------------------#2020-05-12">https://medium.com/google-cloud/google-cloud-data-catalog-integrate-your-on-prem-rdbms-metadata-468e0d8220fb?source=collection_archive---------0-----------------------#2020-05-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="2fc1" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">关于如何将元数据从本地关系数据库接收到Google Cloud Data Catalog的实用方法的代码示例</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/980a7abb002c7f91602eceba1ae586b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hXguGspazvrKld96EM5pvw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">背景由<a class="ae jn" href="https://unsplash.com/@jjying?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> JJ颖</a>上<a class="ae jn" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">的Unsplash </a></figcaption></figure><blockquote class="jo jp jq"><p id="59c4" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated"><strong class="ju hj">免责声明:所有表达的观点仅代表我个人，不代表除我之外的任何人……</strong>。<strong class="ju hj">它们来自参与开发完全可操作的示例连接器的经验，可在:</strong><a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors" rel="noopener ugc nofollow" target="_blank"><strong class="ju hj">github</strong></a><strong class="ju hj">获得。</strong></p></blockquote><p id="1bb3" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">Google Cloud Data Catalog团队最近宣布该产品为<strong class="ju hj"> GA </strong>，具有接受自定义(也称为用户定义)类型的功能:<a class="ae jn" href="https://cloud.google.com/blog/products/data-analytics/data-catalog-metadata-management-now-generally-available" rel="noopener ugc nofollow" target="_blank">Data-Catalog-metadata-management-now-generally-available</a>！这个全新的特性为集成开辟了空间，现在用户可以利用<a class="ae jn" href="https://towardsdatascience.com/boosting-the-data-governance-journey-with-google-cloud-data-catalog-d67acc3e3ffb" rel="noopener" target="_blank"> Data Catalog众所周知的潜力</a>来管理几乎任何类型的数据资产的元数据。</p><h1 id="d8cb" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">挑战</h1><p id="ced0" class="pw-post-body-paragraph jr js hi ju b jv lj ij jx jy lk im ka ko ll kd ke kp lm kh ki kq ln kl km kn hb bi translated">我们很少发现大型组织将所有数据存储在同一个地方，有时这是因为合规性，甚至是战略原因。这导致许多客户将数据资产分散在多个孤岛上，处理驻留在混合云和/或本地环境中的数据。众所周知，关系数据库生态系统有许多不同的供应商，这使得我们很难与每一个供应商合作，因为我们最终要处理这么多不同的特性。</p><p id="6f45" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">因此，这里的主要思想是提供一个可重用的<code class="du lo lp lq lr b">components</code>架构，以最少的代码设置更容易将不同的关系数据库集成到Google Cloud Data Catalog。</p><p id="29b3" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">为了演示它是如何工作的，我将分享设计思想和示例代码，为此，SQLServer <code class="du lo lp lq lr b">connector</code>将被用作实现示例。</p><p id="48c5" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">此外，这篇博文还将更新其他RDBMS连接器实现的链接:</p><ul class=""><li id="c309" class="ls lt hi ju b jv jw jy jz ko lu kp lv kq lw kn lx ly lz ma bi translated"><a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-rdbms/tree/master/google-datacatalog-sqlserver-connector" rel="noopener ugc nofollow" target="_blank"> <strong class="ju hj"> SQLServer </strong> </a></li><li id="564a" class="ls lt hi ju b jv mb jy mc ko md kp me kq mf kn lx ly lz ma bi translated"><a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-rdbms/tree/master/google-datacatalog-postgresql-connector" rel="noopener ugc nofollow" target="_blank"> <strong class="ju hj"> PostgreSQL </strong> </a></li><li id="09f1" class="ls lt hi ju b jv mb jy mc ko md kp me kq mf kn lx ly lz ma bi translated"><a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-rdbms/tree/master/google-datacatalog-greenplum-connector" rel="noopener ugc nofollow" target="_blank"> <strong class="ju hj">青梅</strong> </a></li><li id="3f1e" class="ls lt hi ju b jv mb jy mc ko md kp me kq mf kn lx ly lz ma bi translated"><a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-rdbms/tree/master/google-datacatalog-redshift-connector" rel="noopener ugc nofollow" target="_blank"> <strong class="ju hj">红移</strong> </a></li><li id="008e" class="ls lt hi ju b jv mb jy mc ko md kp me kq mf kn lx ly lz ma bi translated"><a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-rdbms/tree/master/google-datacatalog-mysql-connector" rel="noopener ugc nofollow" target="_blank"> <strong class="ju hj"> MySQL </strong> </a></li><li id="2a61" class="ls lt hi ju b jv mb jy mc ko md kp me kq mf kn lx ly lz ma bi translated"><a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-rdbms/tree/master/google-datacatalog-teradata-connector" rel="noopener ugc nofollow" target="_blank"> <strong class="ju hj"> Teradata </strong> </a></li><li id="d22e" class="ls lt hi ju b jv mb jy mc ko md kp me kq mf kn lx ly lz ma bi translated"><a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-rdbms/tree/master/google-datacatalog-oracle-connector" rel="noopener ugc nofollow" target="_blank"> <strong class="ju hj">甲骨文</strong> </a></li><li id="d40f" class="ls lt hi ju b jv mb jy mc ko md kp me kq mf kn lx ly lz ma bi translated"><a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-rdbms/tree/master/google-datacatalog-vertica-connector" rel="noopener ugc nofollow" target="_blank"><strong class="ju hj"/></a></li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mg"><img src="../Images/caf9246c3051fa23cfd0f873f503ed3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*csRo8PtbG-_jTXUs_NfE3w.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">RDBMS连接器选项</figcaption></figure></div><div class="ab cl mh mi gp mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hb hc hd he hf"><h1 id="280d" class="kr ks hi bd kt ku mo kw kx ky mp la lb io mq ip ld ir mr is lf iu ms iv lh li bi translated">RDBMS结构</h1><p id="0da4" class="pw-post-body-paragraph jr js hi ju b jv lj ij jx jy lk im ka ko ll kd ke kp lm kh ki kq ln kl km kn hb bi translated">为了创建一个commons抽象，我们需要后退一步，看看资产在RDBMS中是如何构造的。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mt"><img src="../Images/0b64580ad8da5b28624d0c7b20dbd109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6okQWqdvQRfSF6McMHzYDQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">RDBMS数据结构</figcaption></figure><p id="1232" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">在顶层，我们有我们称之为<code class="du lo lp lq lr b">Table Container</code>的东西，一个将<code class="du lo lp lq lr b">Tables</code>分组在一起的逻辑分段，然后我们有每个表<code class="du lo lp lq lr b">Columns</code>。</p><blockquote class="jo jp jq"><p id="bdae" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">您可能想知道，为什么不直接将表容器称为数据库或模式呢？</p></blockquote><p id="bb71" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">在传统的<code class="du lo lp lq lr b">RDBMS</code>中，一个特权用户连接到数据库，然后他可以创建模式，并在这些模式中创建带有列定义的表。</p><p id="d396" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">有些<code class="du lo lp lq lr b">RDBMS</code>在这点上有所不同，比如<code class="du lo lp lq lr b">MySQL</code>，其中create Schema语句是<a class="ae jn" href="https://dev.mysql.com/doc/refman/8.0/en/create-database.html" rel="noopener ugc nofollow" target="_blank">只是一个创建数据库的链接</a>。</p><p id="a847" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated"><code class="du lo lp lq lr b">Teradata</code>其中<a class="ae jn" href="https://stackoverflow.com/questions/36643822/how-user-database-and-schema-are-related-in-teradata" rel="noopener ugc nofollow" target="_blank">数据库扮演模式角色</a>。</p><p id="1e8d" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">而<code class="du lo lp lq lr b">Oracle</code>为了创建一个模式，我们实际上必须<a class="ae jn" href="https://docs.oracle.com/en/cloud/paas/exadata-express-cloud/csdbp/create-database-schemas.html#GUID-7B279C9C-CD76-4AD4-8CEE-E26B845E3803" rel="noopener ugc nofollow" target="_blank">创建一个用户并授予其create Table权限</a>。</p><p id="9fa6" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">考虑到这些差异，首先我们想提供一个灵活的架构，其中每个连接器声明它们的表容器是什么。</p><h2 id="0dd6" class="mu ks hi bd kt mv mw mx kx my mz na lb ko nb nc ld kp nd ne lf kq nf ng lh nh bi translated">元数据查询</h2><p id="8c23" class="pw-post-body-paragraph jr js hi ju b jv lj ij jx jy lk im ka ko ll kd ke kp lm kh ki kq ln kl km kn hb bi translated">第二个问题是每个<code class="du lo lp lq lr b">RDBMS</code>如何存储它的元数据，每个供应商可能有他们自己的存储实现，以及他们的内部系统表是什么。</p><h2 id="ba50" class="mu ks hi bd kt mv mw mx kx my mz na lb ko nb nc ld kp nd ne lf kq nf ng lh nh bi translated">RDBMS连接</h2><p id="382d" class="pw-post-body-paragraph jr js hi ju b jv lj ij jx jy lk im ka ko ll kd ke kp lm kh ki kq ln kl km kn hb bi translated">最后，最后一个问题是如何连接到<code class="du lo lp lq lr b">RDBMS</code>，每个供应商可能使用不同的ODBC/JDBC驱动程序、库和连接参数。所以我们必须保持负责<code class="du lo lp lq lr b">connection</code>的那段代码可以扩展。</p></div><div class="ab cl mh mi gp mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hb hc hd he hf"><h1 id="5850" class="kr ks hi bd kt ku mo kw kx ky mp la lb io mq ip ld ir mr is lf iu ms iv lh li bi translated">连接器概述</h1><p id="21b6" class="pw-post-body-paragraph jr js hi ju b jv lj ij jx jy lk im ka ko ll kd ke kp lm kh ki kq ln kl km kn hb bi translated">介绍完之后，让我们在更高的层次上理解连接器是如何工作的。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ni"><img src="../Images/07077469186a3cb90d1476b8132f989a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mWczTcLDB5f4kKvuVGmuIQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">SQLServer数据目录连接器概述</figcaption></figure><p id="f28e" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">它分为三个主要部分:<code class="du lo lp lq lr b">datacatalog-connector-commons</code>、<code class="du lo lp lq lr b">datacatalog-connector-rdbms</code>和<code class="du lo lp lq lr b">datacatalog-connector-sqlserver</code>。</p><ul class=""><li id="9de3" class="ls lt hi ju b jv jw jy jz ko lu kp lv kq lw kn lx ly lz ma bi translated"><strong class="ju hj">数据目录-连接器-通用</strong></li></ul><p id="241e" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">所有连接器的公共代码都在这里，主要是与摄取相关的类。根据设计，只有该组件应该与数据目录自定义类型API进行通信。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nj"><img src="../Images/9a48daa3d8db870da435328286963a08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ZzrbXHuosO6LZxdDQCbPA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">公共连接器结构</figcaption></figure><ul class=""><li id="c813" class="ls lt hi ju b jv jw jy jz ko lu kp lv kq lw kn lx ly lz ma bi translated"><strong class="ju hj">数据目录-连接器-关系数据库管理系统</strong></li></ul><p id="2cbb" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">这是所有<code class="du lo lp lq lr b">RDBMS</code>连接器的通用代码，这里的类是开放扩展的，允许每个连接器定制部分流程。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nk"><img src="../Images/eba8c64699c86eb694d44a999892ea5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z410ExJtNvuhUfGwvpnVkw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">RDBMS连接器结构</figcaption></figure><p id="ab4b" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">例如，如果一个<code class="du lo lp lq lr b">RDBMS</code>连接器需要向摄取过程添加新的<code class="du lo lp lq lr b">Tags</code>，只需扩展<code class="du lo lp lq lr b">datacatalog_tag_factory</code>类，就可以访问来自源系统的所有元数据。</p><ul class=""><li id="8bfa" class="ls lt hi ju b jv jw jy jz ko lu kp lv kq lw kn lx ly lz ma bi translated"><strong class="ju hj">数据目录-连接器-sqlserver </strong></li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nl"><img src="../Images/019c8986926f9828caacf9d2acf032f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dwNyFytDqISs2k04cT6FUw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">SQLServer连接器结构</figcaption></figure><p id="04d9" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated"><code class="du lo lp lq lr b">SQLServer</code>连接器的代码，它解决了介绍中涉及的3个问题，我们将在下一节更深入地讨论细节。</p></div><div class="ab cl mh mi gp mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hb hc hd he hf"><h1 id="dfff" class="kr ks hi bd kt ku mo kw kx ky mp la lb io mq ip ld ir mr is lf iu ms iv lh li bi translated">连接器实现</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nm"><img src="../Images/a33e2436228578ed2515c7d36740ab9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LpY_FHrAXZnIeadlCr7gDQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">SQLServer实现扩展视图</figcaption></figure><p id="cd26" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">让我们来看看这些文件:</p><ul class=""><li id="05b2" class="ls lt hi ju b jv jw jy jz ko lu kp lv kq lw kn lx ly lz ma bi translated"><strong class="ju hj">元数据_查询. sql </strong></li></ul><p id="c293" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">这是负责检索元数据的SQL查询</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nn"><img src="../Images/048b1497123e95031b7fd5e50ee28528.png" data-original-src="https://miro.medium.com/v2/resize:fit:718/format:webp/1*vt5Y8YBSvbHfcnNBTAG3OA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">元数据SQL查询</figcaption></figure><p id="ddf2" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">对于<code class="du lo lp lq lr b">SQLServer</code>和许多其他RDBMS，元数据信息存储在<code class="du lo lp lq lr b">information_schema</code>数据库中。经常变化的是内部系统表，在这种情况下，当我们抓取元数据时，我们将忽略<code class="du lo lp lq lr b">DBO</code>模式。</p><ul class=""><li id="ed07" class="ls lt hi ju b jv jw jy jz ko lu kp lv kq lw kn lx ly lz ma bi translated"><strong class="ju hj">metadata _ definition . JSON</strong></li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es no"><img src="../Images/f2d5e1377067c0b3d40f0485cfbb7036.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*BHuMTaTBM0JPtimAqByTwA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">元数据定义JSON</figcaption></figure><p id="b584" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">元数据定义JSON表示我们在特定RDBMS中的三级层次结构，在这种情况下，<code class="du lo lp lq lr b">Table Container</code>被表示为<code class="du lo lp lq lr b">schemas</code>，因为在同一个数据库中我们可以有许多<code class="du lo lp lq lr b">schemas</code>。</p><p id="b0b7" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated"><strong class="ju hj">源</strong> → <strong class="ju hj">目标</strong>字段将从SQL查询中提取元数据，并将其发送给后续连接器进程使用的元数据对象。一些RDBMS在元数据信息方面更丰富，因此灵活的表示很重要，允许用户向它添加新的字段。</p><blockquote class="jo jp jq"><p id="435e" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">例如，在Oracle中，我们有一个特殊的元数据字段来存储每个表有多少行，而不必查询每个表。</p></blockquote><ul class=""><li id="27a3" class="ls lt hi ju b jv jw jy jz ko lu kp lv kq lw kn lx ly lz ma bi translated"><strong class="ju hj">元数据清除程序</strong></li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es np"><img src="../Images/8f5e296ac743a6fe048bb58209dd16eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*btccJVdfrXasVjD3NInNng.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">元数据刮刀扩展点</figcaption></figure><p id="e8fc" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">这里我们使用了<code class="du lo lp lq lr b">pyodbc</code>库，它加载了<a class="ae jn" href="https://docs.microsoft.com/en-us/sql/connect/odbc/linux-mac/installing-the-microsoft-odbc-driver-for-sql-server?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank"> SQL Server ODBC驱动程序</a>来创建连接。一些用户在过去的某个时候青睐<code class="du lo lp lq lr b">Pymssql</code>库，但它是<a class="ae jn" href="https://github.com/pymssql/pymssql/issues/668" rel="noopener ugc nofollow" target="_blank">停产</a>而青睐<code class="du lo lp lq lr b">pyodbc</code>。</p><p id="6837" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">对于每个<code class="du lo lp lq lr b">RDBMS</code>连接器，我们使用他们的供应商推荐库，使得代码中的这个扩展点极其重要。例如:</p><ul class=""><li id="346e" class="ls lt hi ju b jv jw jy jz ko lu kp lv kq lw kn lx ly lz ma bi translated">PostgreSQL → <code class="du lo lp lq lr b"><a class="ae jn" href="https://pypi.org/project/psycopg2/" rel="noopener ugc nofollow" target="_blank">psycopg2</a></code></li><li id="65b3" class="ls lt hi ju b jv mb jy mc ko md kp me kq mf kn lx ly lz ma bi translated">甲骨文→ <code class="du lo lp lq lr b"><a class="ae jn" href="https://oracle.github.io/python-cx_Oracle/" rel="noopener ugc nofollow" target="_blank">cx_Oracle</a></code></li><li id="8c44" class="ls lt hi ju b jv mb jy mc ko md kp me kq mf kn lx ly lz ma bi translated">MySQL → <code class="du lo lp lq lr b"><a class="ae jn" href="https://pypi.org/project/mysql-connector-python/" rel="noopener ugc nofollow" target="_blank">mysql.connector</a></code></li><li id="b01d" class="ls lt hi ju b jv mb jy mc ko md kp me kq mf kn lx ly lz ma bi translated">Teradata → <code class="du lo lp lq lr b"><a class="ae jn" href="https://pypi.org/project/teradatasql/" rel="noopener ugc nofollow" target="_blank">teradatasql</a></code></li></ul><p id="5fb0" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">所有这些库的共同点是它们遵循<code class="du lo lp lq lr b">DB API 2.0</code> <a class="ae jn" href="https://www.python.org/dev/peps/pep-0249/" rel="noopener ugc nofollow" target="_blank">规范</a>，这使得在其上创建通用抽象更加容易，这是<code class="du lo lp lq lr b">connector-rdbms</code>库的一个巨大部分。</p><blockquote class="jo jp jq"><p id="9b26" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">有关每个连接器及其python连接库的更多细节，请查看<a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-rdbms" rel="noopener ugc nofollow" target="_blank"> github repo </a>。</p></blockquote></div><div class="ab cl mh mi gp mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hb hc hd he hf"><h1 id="2b00" class="kr ks hi bd kt ku mo kw kx ky mp la lb io mq ip ld ir mr is lf iu ms iv lh li bi translated">连接器执行</h1><p id="2c6f" class="pw-post-body-paragraph jr js hi ju b jv lj ij jx jy lk im ka ko ll kd ke kp lm kh ki kq ln kl km kn hb bi translated">总结一下，这就是SQLServer连接器的整体架构</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nq"><img src="../Images/7794c71bcf2f7b5ec32d6cb50148a210.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vcDofTfFPqyjfSApW7BJmA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">SQLServer连接器体系结构</figcaption></figure><p id="9184" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">每次执行时，它都会:</p><ul class=""><li id="ea4d" class="ls lt hi ju b jv jw jy jz ko lu kp lv kq lw kn lx ly lz ma bi translated"><strong class="ju hj">抓取</strong>:连接数据库，检索所有可用的元数据。</li><li id="3be3" class="ls lt hi ju b jv mb jy mc ko md kp me kq mf kn lx ly lz ma bi translated"><strong class="ju hj">准备</strong> : <strong class="ju hj"> </strong>在数据目录实体中转换，用附加元数据创建标签。</li><li id="4c35" class="ls lt hi ju b jv mb jy mc ko md kp me kq mf kn lx ly lz ma bi translated"><strong class="ju hj">摄取</strong>:将数据目录实体发送到Google Cloud项目。</li></ul><p id="cbca" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">重要的是要记住，大部分代码位于<code class="du lo lp lq lr b">connector-rdbms</code>和<code class="du lo lp lq lr b">connector-commons</code>库中。</p><h2 id="21df" class="mu ks hi bd kt mv mw mx kx my mz na lb ko nb nc ld kp nd ne lf kq nf ng lh nh bi translated">运行它</h2><p id="9fcf" class="pw-post-body-paragraph jr js hi ju b jv lj ij jx jy lk im ka ko ll kd ke kp lm kh ki kq ln kl km kn hb bi translated">设置好<code class="du lo lp lq lr b">connector</code>环境后，按照<a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-rdbms/tree/master/sqlserver2datacatalog" rel="noopener ugc nofollow" target="_blank"> Github repo </a>上的说明，让我们使用它的命令行参数来执行它:</p><pre class="iy iz ja jb fd nr lr ns nt aw nu bi"><span id="1d2a" class="mu ks hi lr b fi nv nw l nx ny"># Environment variables<br/>export DATACATALOG_PROJECT_ID=sqlserver2dc-gcp-project<br/>export DATACATALOG_LOCATION_ID=us-central1<br/>export SQLSERVER_HOST=localhost<br/>export SQLSERVER_USERNAME=sqlserver<br/>export SQLSERVER_PASSWORD=sqlserver_pwd<br/>export SQLSERVER_DATABASE=master<br/>export GOOGLE_APPLICATION_CREDENTIALS=&lt;CREDENTIALS_FILES_FOLDER&gt;/sqlserver2dc-datacatalog-credentials.json</span><span id="de73" class="mu ks hi lr b fi nz nw l nx ny"># Command line execution<br/>google-datacatalog-sqlserver-connector \<br/>--datacatalog-project-id=$DATACATALOG_PROJECT_ID \<br/>--datacatalog-location-id=$DATACATALOG_LOCATION_ID \<br/>--sqlserver_host=$SQLSERVER_HOST \<br/>--sqlserver_user=$SQLSERVER_USERNAME \<br/>--sqlserver_pass=$SQLSERVER_PASSWORD \<br/>--sqlserver_database=$SQLSERVER_DATABASE</span></pre><h2 id="87bb" class="mu ks hi bd kt mv mw mx kx my mz na lb ko nb nc ld kp nd ne lf kq nf ng lh nh bi translated">结果</h2><p id="f7b9" class="pw-post-body-paragraph jr js hi ju b jv lj ij jx jy lk im ka ko ll kd ke kp lm kh ki kq ln kl km kn hb bi translated">一旦执行完成，我们就可以进入数据目录搜索用户界面，寻找被吸收的资产</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es oa"><img src="../Images/dc1eeaa65f23f6058f984d1fc9d63431.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*Cz6ECk63HilFXJ14ScSvOw.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">摄取的SQLServer架构</figcaption></figure><div class="iy iz ja jb fd ab cb"><figure class="ob jc oc od oe of og paragraph-image"><img src="../Images/b7eb81e5da4b61c995ef6bd5b9460ad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*ggNQjSLSAyaAyUI81lY9MQ.png"/></figure><figure class="ob jc oh od oe of og paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><img src="../Images/25ed070fd544e052d5cd971cf3570739.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*epD5G9Ue_fOOKTW5frB2CA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx oi di oj ok translated">从同一个架构中获取SQLServer表</figcaption></figure></div><h2 id="1281" class="mu ks hi bd kt mv mw mx kx my mz na lb ko nb nc ld kp nd ne lf kq nf ng lh nh bi translated">使用CSV运行</h2><p id="c80e" class="pw-post-body-paragraph jr js hi ju b jv lj ij jx jy lk im ka ko ll kd ke kp lm kh ki kq ln kl km kn hb bi translated">还有一个通过从CSV文件读取元数据来执行连接器的选项:</p><pre class="iy iz ja jb fd nr lr ns nt aw nu bi"><span id="aba3" class="mu ks hi lr b fi nv nw l nx ny"># Environment variables<br/>export DATACATALOG_PROJECT_ID=sqlserver2dc-gcp-project<br/>export DATACATALOG_LOCATION_ID=us-central1<br/>export SQLSERVER_HOST=localhost<br/>export RAW_METADATA_CSV=resource/sqlserver_full_dump.csv<br/>export GOOGLE_APPLICATION_CREDENTIALS=&lt;CREDENTIALS_FILES_FOLDER&gt;/sqlserver2dc-datacatalog-credentials.json</span><span id="e31d" class="mu ks hi lr b fi nz nw l nx ny"># Command line execution<br/>google-datacatalog-sqlserver-connector \<br/>--datacatalog-project-id=$DATACATALOG_PROJECT_ID \<br/>--datacatalog-location-id=$DATACATALOG_LOCATION_ID \<br/>--sqlserver_host=$SQLSERVER_HOST \<br/>--raw-metadata-csv=$RAW_METADATA_CSV</span></pre><p id="9bc7" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka ko kc kd ke kp kg kh ki kq kk kl km kn hb bi translated">这一点非常重要，因为我们可能会在无法到达GCP项目的网络中处理本地RDBMS。然后，摄入过程将分为两部分；1 —生成CSV文件，2 —从该文件运行连接器。</p><blockquote class="jo jp jq"><p id="016e" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">如果用GCS路径提供了<code class="du lo lp lq lr b">raw-metadata-csv</code> arg，那么也支持从云存储桶中读取CSV文件。</p></blockquote></div><div class="ab cl mh mi gp mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hb hc hd he hf"><h2 id="29f3" class="mu ks hi bd kt mv mw mx kx my mz na lb ko nb nc ld kp nd ne lf kq nf ng lh nh bi translated">执行指标</h2><p id="a82c" class="pw-post-body-paragraph jr js hi ju b jv lj ij jx jy lk im ka ko ll kd ke kp lm kh ki kq ln kl km kn hb bi translated">最后，让我们看看执行过程中产生的一些指标。通过在SQL Server <code class="du lo lp lq lr b">2017</code>标准实例上运行<code class="du lo lp lq lr b">connector</code>来收集指标，用分布在4个模式中的<code class="du lo lp lq lr b">1008</code>表填充。</p><blockquote class="jo jp jq"><p id="5655" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">以下指标并非保证，而是近似值，可能会因环境、网络和执行情况而异。由于大部分代码都在公共库中，用户可以从其他RDBMS连接器获得类似的值。</p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ol"><img src="../Images/290adbc198411a53ab3cfbd655ea545a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*Kca2finp1RpqQYPMnCj0Ig.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">度量摘要</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es om"><img src="../Images/dda2a293c018cb70980cb94b5a17ef73.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*Ww0htVezvJJXU8O_0V46WQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">数据目录API调用向下钻取</figcaption></figure></div><div class="ab cl mh mi gp mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hb hc hd he hf"><h1 id="9a19" class="kr ks hi bd kt ku mo kw kx ky mp la lb io mq ip ld ir mr is lf iu ms iv lh li bi translated">样本连接器</h1><p id="bb10" class="pw-post-body-paragraph jr js hi ju b jv lj ij jx jy lk im ka ko ll kd ke kp lm kh ki kq ln kl km kn hb bi translated">本文中讨论的所有主题都包含在一个示例连接器中，可以在GitHub上找到:<a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-rdbms" rel="noopener ugc nofollow" target="_blank"> <strong class="ju hj"> rdbms-connectors </strong> </a>。你可以随便拿，按照说明跑。顺便说一下，欢迎投稿！</p><blockquote class="jo jp jq"><p id="3047" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated"><em class="hi">它是在Apache License版本下许可的，在“按原样”的基础上发布，没有任何种类的保证或条件，无论是明示的还是暗示的。</em></p></blockquote></div><div class="ab cl mh mi gp mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hb hc hd he hf"><h1 id="64fd" class="kr ks hi bd kt ku mo kw kx ky mp la lb io mq ip ld ir mr is lf iu ms iv lh li bi translated">结束语</h1><p id="10c7" class="pw-post-body-paragraph jr js hi ju b jv lj ij jx jy lk im ka ko ll kd ke kp lm kh ki kq ln kl km kn hb bi translated">在本文中，我们介绍了如何将元数据从RDBMS接收到Google Cloud Data Catalog中，使用户能够集中管理他们的元数据，即使它驻留在本地环境中。拥有RDBMS commons连接器使得实现其他数据库集成变得更加容易，所以请继续关注展示如何对其他源系统做同样事情的新帖子！干杯！</p><h1 id="5313" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">参考</h1><ul class=""><li id="5cc7" class="ls lt hi ju b jv lj jy lk ko on kp oo kq op kn lx ly lz ma bi translated"><strong class="ju hj">数据目录GA博文</strong>:<a class="ae jn" href="https://cloud.google.com/blog/products/data-analytics/data-catalog-metadata-management-now-generally-available" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/blog/products/Data-analytics/Data-Catalog-metadata-management-now-generally-available</a></li><li id="8c87" class="ls lt hi ju b jv mb jy mc ko md kp me kq mf kn lx ly lz ma bi translated"><strong class="ju hj">连接器Github Repo</strong>:<a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors" rel="noopener ugc nofollow" target="_blank">https://Github . com/Google cloud platform/data catalog-connectors</a></li><li id="7a6a" class="ls lt hi ju b jv mb jy mc ko md kp me kq mf kn lx ly lz ma bi translated"><strong class="ju hj">连接器RDBMS Github Repo:</strong><a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-rdbms" rel="noopener ugc nofollow" target="_blank">https://Github . com/Google cloud platform/data catalog-connectors-RDBMS</a></li><li id="6028" class="ls lt hi ju b jv mb jy mc ko md kp me kq mf kn lx ly lz ma bi translated"><strong class="ju hj">数据目录公文</strong>:<a class="ae jn" href="https://cloud.google.com/data-catalog/" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/data-catalog/</a></li><li id="4547" class="ls lt hi ju b jv mb jy mc ko md kp me kq mf kn lx ly lz ma bi translated"><strong class="ju hj"> SQL Server ODBC驱动</strong>:<a class="ae jn" href="https://docs.microsoft.com/en-us/sql/connect/odbc/linux-mac/installing-the-microsoft-odbc-driver-for-sql-server?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/SQL/connect/ODBC/Linux-MAC/installing-the-Microsoft-ODBC-driver-for-SQL-Server？view=sql-server-2017 </a></li></ul></div></div>    
</body>
</html>