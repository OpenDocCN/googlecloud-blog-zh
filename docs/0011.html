<html>
<head>
<title>Using Puppet with Google Compute Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用谷歌计算引擎木偶</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/using-puppet-w-google-compute-engine-1eeed425aa7c?source=collection_archive---------4-----------------------#2015-07-16">https://medium.com/google-cloud/using-puppet-w-google-compute-engine-1eeed425aa7c?source=collection_archive---------4-----------------------#2015-07-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="hb hc hd he hf"><p id="48c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，您将了解如何使用Puppet在Google云平台上的Google计算引擎中提供虚拟机实例。</p><h2 id="9f97" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">先决条件</h2><ol class=""><li id="a07f" class="jz ka hi ih b ii kb im kc iq kd iu ke iy kf jc kg kh ki kj bi translated">一个<a class="ae jd" href="http://cloud.google.com" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>账号(带项目)</li><li id="2273" class="jz ka hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated"><a class="ae jd" href="https://cloud.google.com/sdk/" rel="noopener ugc nofollow" target="_blank">谷歌云SDK </a>安装完毕</li><li id="1fa7" class="jz ka hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated">通过“gcloud auth登录”获得授权的Google Cloud SDK</li></ol><h2 id="efaf" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">在本地安装木偶</h2><p id="ac1f" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">首先，在本地安装Puppet。我在我的笔记本电脑(OS X)上遵循了<a class="ae jd" href="https://docs.puppetlabs.com/guides/install_puppet/pre_install.html" rel="noopener ugc nofollow" target="_blank">安装说明</a>。这很简单。</p><h2 id="798d" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">安装gce_compute模块</h2><p id="b40a" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">gce_compute模块允许您将计算引擎实例、磁盘、负载平衡器等作为本机Puppet资源进行管理。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="ccd0" class="je jf hi kx b fi lb lc l ld le">$ puppet module install puppetlabs-gce_compute</span></pre><p id="05bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，创建一个~/。puppet/device.conf文件(或者，/etc/puppet/device.conf):</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="3650" class="je jf hi kx b fi lb lc l ld le">[gce_project_id]<br/>  type gce<br/>  url [/dev/null]:gce_project_id</span></pre><p id="7ec7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，创建一个puppet清单文件~/www.pp，内容如下:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="071e" class="je jf hi kx b fi lb lc l ld le"># Learn more about zones here:<br/># <a class="ae jd" href="https://cloud.google.com/compute/docs/zones" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/compute/docs/zones</a><br/>$zone = 'us-central1-a'</span><span id="f537" class="je jf hi kx b fi lf lc l ld le"># Configure the firewall rule<br/>gce_firewall { 'puppet-www-http':<br/> ensure =&gt; present,<br/> network =&gt; 'default',<br/> description =&gt; 'allows incoming HTTP connections',<br/> allowed =&gt; 'tcp:80',<br/>}</span><span id="792a" class="je jf hi kx b fi lf lc l ld le"># Configure the boot disk<br/>gce_disk { 'puppet-www-boot':<br/> ensure =&gt; present,<br/> source_image =&gt; 'debian-7',<br/> size_gb =&gt; '10',<br/> zone =&gt; "$zone",<br/>}</span><span id="96df" class="je jf hi kx b fi lf lc l ld le"># Configure one instance<br/>gce_instance { 'puppet-www':<br/> ensure =&gt; present,<br/> description =&gt; 'Basic web server',<br/> machine_type =&gt; n1-standard-1,<br/> disk =&gt; 'puppet-www-boot,boot',<br/> zone =&gt; "$zone",<br/> network =&gt; 'default',<br/> require =&gt; Gce_disk['puppet-www-boot'],<br/> puppet_master =&gt; "",<br/> manifest =&gt; '<br/>  class apache ($version = "latest") {<br/>   package {"apache2":<br/>   ensure =&gt; $version,<br/>  }<br/>  file {"/var/www/index.html":<br/>   ensure =&gt; present,<br/>   content =&gt; "&lt;html&gt;\n&lt;body&gt;\n\t&lt;h2&gt;Hi, this is $hostname ($gce_external_ip).&lt;/h2&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n",<br/>   require =&gt; Package["apache2"],<br/>  }<br/>  service {"apache2":<br/>   ensure =&gt; running,<br/>   enable =&gt; true,<br/>   require =&gt; File["/var/www/index.html"],<br/>  }<br/> }<br/> include apache',<br/>}</span></pre><p id="5315" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应用此清单:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="24d2" class="je jf hi kx b fi lb lc l ld le">$ puppet apply --certname gce_project_id www.pp</span></pre><p id="3c41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查找IP地址:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="9e75" class="je jf hi kx b fi lb lc l ld le">$ gcloud compute instances list<br/>NAME                   ZONE          MACHINE_TYPE  INTERNAL_IP    EXTERNAL_IP     STATUS<br/>puppet-www             us-central1-a n1-standard-1 ...   xxx.xxx.xxx.xxx RUNNING</span></pre><p id="3491" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，在您的浏览器中查看一下<a class="ae jd" href="http://the_external_ip/" rel="noopener ugc nofollow" target="_blank">http://xxx.xxx.xxx.xxx/</a>=)，您应该会看到一个简单的网页，其内容是在<a class="ae jd" href="http://www.pp" rel="noopener ugc nofollow" target="_blank"> www.pp </a>文件中指定的。</p><h2 id="c677" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">寻找更高级的东西？</h2><p id="4da6" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">在<a class="ae jd" href="https://github.com/GoogleCloudPlatform/compute-video-demo-puppet" rel="noopener ugc nofollow" target="_blank">https://github . com/Google cloud platform/compute-video-demo-Puppet</a>查看完整的演示，其中包含设置Puppet服务器并旋转四个Puppet托管节点的源代码！</p><h2 id="255c" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">有用的资源</h2><p id="de77" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated"><a class="ae jd" href="https://cloud.google.com/developers/articles/google-compute-engine-management-puppet-chef-salt-ansible/" rel="noopener ugc nofollow" target="_blank">使用Puppet、Chef、Salt和Ansible进行计算引擎管理</a> —关于如何使用不同的工具、利弊等保持实例最新的详细信息。<a class="ae jd" href="https://cloud.google.com/developers/articles/google-compute-engine-management-puppet-chef-salt-ansible-appendix/" rel="noopener ugc nofollow" target="_blank">附录</a>有实际的步骤和我使用的样本清单文件。</p><p id="f832" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="http://googlecloudplatform.blogspot.com/2014/04/using-puppet-to-automate-google-compute-engine.html" rel="noopener ugc nofollow" target="_blank">使用Puppet自动化Google计算引擎</a>——使用gce_compute和样本清单文件的好例子。</p><p id="7d74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://forge.puppetlabs.com/puppetlabs/gce_compute" rel="noopener ugc nofollow" target="_blank"> gce_compute </a> —傀儡锻造。关于gce_compute你想知道的一切非常详细的信息！</p><p id="1ae9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://forge.puppetlabs.com/puppetlabs/cloud_provisioner" rel="noopener ugc nofollow" target="_blank">云_供给者</a> —傀儡锻造。这里没有太多的信息。请参考<a class="ae jd" href="https://docs.puppetlabs.com/pe/latest/cloudprovisioner_configuring.html#installing" rel="noopener ugc nofollow" target="_blank">安装文件</a>。</p></div></div>    
</body>
</html>