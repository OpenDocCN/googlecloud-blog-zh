<html>
<head>
<title>How to right-size your flat-rate and flex slots reservations in BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在BigQuery中调整您的固定费率和弹性时段预留</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-move-from-on-demand-pricing-to-reservations-in-bigquery-65552cbebd45?source=collection_archive---------0-----------------------#2020-09-22">https://medium.com/google-cloud/how-to-move-from-on-demand-pricing-to-reservations-in-bigquery-65552cbebd45?source=collection_archive---------0-----------------------#2020-09-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="23b3" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">将插槽使用图转化为工作负载管理</h2></div><p id="0eb1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我正在与一个非营利组织合作，该组织使用BigQuery进行数据分析。他们使用按需定价，但达到了统一费率定价开始有意义的程度(通常每月1万美元，尽管如果您的使用更具可重复性，每月可以低至2万美元)。他们应该如何着手改变呢？有什么好的策略可以遵循？</p><p id="d762" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所有这些信息都在BigQuery文档中，但是在几个不同的地方。所以，我在这里巩固它，并链接到其他一些关于这个主题的好文章。</p><h2 id="0cad" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">什么时候有意义？</h2><p id="8982" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">通过按需定价，每个项目可获得2000个名额。因此，只有在以下任何一种情况下，您才应该考虑从按需定价转向统一定价:</p><ul class=""><li id="b455" class="kt ku hi iz b ja jb jd je jg kv jk kw jo kx js ky kz la lb bi translated">您的统一价格预订将超过2000个位置，因此不会有任何减速。</li><li id="3c2f" class="kt ku hi iz b ja lc jd ld jg le jk lf jo lg js ky kz la lb bi translated">您并不担心查询速度变慢，可能是因为这些是报告工作负载。</li><li id="4687" class="kt ku hi iz b ja lc jd ld jg le jk lf jo lg js ky kz la lb bi translated">您可以添加灵活插槽。例如，如果您的大型查询是在高峰时使用5000个时段的每日报告，那么您可以保留500个时段，并购买4500个灵活时段，每天一小时。您将在这一小时内运行这些大型的每日报告查询。</li></ul><h2 id="68d6" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">推荐策略</h2><p id="af21" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">使用<a class="ae lh" href="https://cloud.google.com/billing/docs/how-to/visualize-data" rel="noopener ugc nofollow" target="_blank">计费仪表板</a>或<a class="ae lh" href="https://cloud.google.com/bigquery/docs/reservations-monitoring" rel="noopener ugc nofollow" target="_blank">云监控</a>获得计费账户中<strong class="iz hj">所有</strong>项目的时段使用图表。</p><p id="6ae6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">假设您的平均每小时插槽使用率如下所示:</p><figure class="lj lk ll lm fd ln er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es li"><img src="../Images/f7b1d6346f8e5e758e53103887647d6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*81Bkx7GHnYz2d8ajyRBFQQ.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">每小时时段使用量。尽管本例只显示了一个项目，但是您应该使用一个图表来汇总账单账户中的所有项目。</figcaption></figure><ol class=""><li id="ba11" class="kt ku hi iz b ja jb jd je jg kv jk kw jo kx js ly kz la lb bi translated">找到基线。在这里(见下面周四的图表)，我们白天似乎需要500个插槽，晚上则减少到零。我们可以购买16小时的零固定费率和500个灵活时段。或者，我们可以购买500个统一费率的老虎机。做数学，我们会更好地与500个插槽的统一费率预订。</li></ol><figure class="lj lk ll lm fd ln er es paragraph-image"><div class="er es lz"><img src="../Images/22415760b06207d146ed745d8398d5b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:254/format:webp/1*OLfs2EwaMtVk4O4-1xEhdQ.png"/></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">周四白天的基线是500个左右。</figcaption></figure><p id="500f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.在你做出购买500个插槽一年或更长时间的长期承诺之前，试着每月做500个灵活插槽。这样，如果发现统一费率模式对你的任何项目都不起作用，你也不会损失太多。</p><p id="9bdf" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.找到导致峰值的查询。假设你发现它用了3000个槽(见周二的峰值，如下)。购买2500个flex插槽，运行这个昂贵的查询，然后释放插槽。您还可以计划购买弹性插槽。</p><figure class="lj lk ll lm fd ln er es paragraph-image"><div class="er es ma"><img src="../Images/b54cc2b4f9c6d38520021b84ba084b09.png" data-original-src="https://miro.medium.com/v2/resize:fit:242/format:webp/1*d_Wl8DNIpi1gLtl1VZ9Ahg.png"/></div></figure><p id="885c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">4.有零星的高峰(每天的颠簸，见下文)。找出它们的原因。假设这些查询是由数据科学家交互式地探索数据而创建的。我们想让这些数据科学家快速访问。500个插槽的限制会惹恼他们。因此，创建一个按需项目，并为其分配数据科学家。但是<a class="ae lh" href="https://cloud.google.com/bigquery/docs/custom-quotas" rel="noopener ugc nofollow" target="_blank">在那个项目中加入成本控制</a>，以避免数据科学家错误地运行1 PB的查询。</p><figure class="lj lk ll lm fd ln er es paragraph-image"><div class="er es mb"><img src="../Images/0cfe5c33b334ae4984fb6ed127b66a67.png" data-original-src="https://miro.medium.com/v2/resize:fit:202/format:webp/1*rNp3C40BWs5_ujUZO9p8wQ.png"/></div></figure><p id="2138" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">5.事实证明，某些天增加的基线(例如，周一的基线，见下文，超过500)是由面向公众的仪表板驱动的。有1000个查询，但是我们不太关心查询性能——如果这些查询需要3秒而不是1秒来执行，这不是问题。将仪表板使用情况放入原来的500个统一费率的预留位置中。将预留增加到800个插槽，并将这300个插槽的优先级赋予仪表板。当仪表板不使用这300个插槽时，它们将有助于加速其他一切。</p><figure class="lj lk ll lm fd ln er es paragraph-image"><div class="er es mc"><img src="../Images/7e0e1e7c5d63d524e02c7e5916176fdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:238/format:webp/1*omJZxfFYdSWIospHFmvl5w.png"/></div></figure><h2 id="d5fc" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">推荐阅读</h2><p id="874f" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">以下是关于各种活动部分(定价、预订、工作负载管理、插槽使用监控)的重要背景资料，为上述策略提供了信息:</p><ul class=""><li id="712c" class="kt ku hi iz b ja jb jd je jg kv jk kw jo kx js ky kz la lb bi translated"><a class="ae lh" href="https://cloud.google.com/bigquery/docs/reservations-monitoring" rel="noopener ugc nofollow" target="_blank">云监控中的监控BigQuery预约</a></li><li id="77cc" class="kt ku hi iz b ja lc jd ld jg le jk lf jo lg js ky kz la lb bi translated"><a class="ae lh" href="https://cloud.google.com/bigquery/docs/reservations-workload-management" rel="noopener ugc nofollow" target="_blank">big query中的工作量管理</a></li><li id="7696" class="kt ku hi iz b ja lc jd ld jg le jk lf jo lg js ky kz la lb bi translated">BigQuery中的成本优化</li><li id="9343" class="kt ku hi iz b ja lc jd ld jg le jk lf jo lg js ky kz la lb bi translated"><a class="ae lh" href="https://cloud.google.com/blog/products/data-analytics/choosing-bigquery-pricing" rel="noopener ugc nofollow" target="_blank">哪种定价模式适合您</a>；BigQuery中的<a class="ae lh" href="https://cloud.google.com/bigquery/pricing#overview" rel="noopener ugc nofollow" target="_blank">定价</a>是如何工作的</li><li id="de36" class="kt ku hi iz b ja lc jd ld jg le jk lf jo lg js ky kz la lb bi translated"><a class="ae lh" href="https://cloud.google.com/blog/products/data-analytics/effectively-using-bigquery-reservations" rel="noopener ugc nofollow" target="_blank">big query中的预订</a></li></ul></div></div>    
</body>
</html>