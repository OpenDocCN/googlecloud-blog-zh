<html>
<head>
<title>How to Automate Governance Best Practices With Google Data Catalog and Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Google数据目录和Terraform自动化治理最佳实践</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-automatically-manage-your-iam-access-controls-with-google-data-catalog-and-terraform-5ea33adcbdd4?source=collection_archive---------0-----------------------#2020-12-08">https://medium.com/google-cloud/how-to-automatically-manage-your-iam-access-controls-with-google-data-catalog-and-terraform-5ea33adcbdd4?source=collection_archive---------0-----------------------#2020-12-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="c570" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">脚本和地形自动化，以帮助您确保在谷歌数据目录的最佳做法</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/c5c45cf13fe542e87f4db0ee54b46aa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*oJL-73WTA6VOZKPNGp9Ipw.gif"/></div></div></figure><blockquote class="jj jk jl"><p id="00ed" class="jm jn jo jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj">免责声明:所有观点仅代表我个人，不代表任何人……</strong></p></blockquote><p id="e643" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">有大量关于<a class="ae km" href="https://cloud.google.com/data-catalog/docs/concepts/iam" rel="noopener ugc nofollow" target="_blank">和</a><a class="ae km" href="https://cloud.google.com/data-catalog" rel="noopener ugc nofollow" target="_blank">谷歌数据目录</a>的文档。但是，当您开始您的数据治理之旅时，您可能想知道需要什么样的访问控制，以及在您的组织中谁应该被授予这些访问控制…</p><ul class=""><li id="2040" class="kn ko hi jp b jq jr jt ju kj kp kk kq kl kr ki ks kt ku kv bi translated">什么样的最终用户应该能够发现我的数据资产？</li><li id="0999" class="kn ko hi jp b jq kw jt kx kj ky kk kz kl la ki ks kt ku kv bi translated">谁应该能够对它们进行分类并<a class="ae km" href="https://cloud.google.com/data-catalog/docs/quickstart-tagging" rel="noopener ugc nofollow" target="_blank">添加标签</a>？</li><li id="fefa" class="kn ko hi jp b jq kw jt kx kj ky kk kz kl la ki ks kt ku kv bi translated">最后，能够<a class="ae km" href="https://cloud.google.com/data-catalog/docs/tags-and-tag-templates" rel="noopener ugc nofollow" target="_blank">创建模板</a>并为数据分类过程设定标准？</li></ul><p id="4ffd" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">这可能会变得非常复杂，所以在这篇博文中，我们将从元数据之上的访问控制开始，这是Google数据目录的竞技场。</p><p id="8b04" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">如果我告诉你，我们可以通过使用Terraform来自动化这一切呢？听起来不错，对吧？所以让我们开始吧！</p><h1 id="9009" class="lb lc hi bd ld le lf lg lh li lj lk ll io lm ip ln ir lo is lp iu lq iv lr ls bi translated">解决方案</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lt"><img src="../Images/18665d59bf0260eb4f0fd52fa91eca1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pouhw_UpNXWXKVqBGuCYew.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">数据治理架构</figcaption></figure><p id="e3dc" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">这只是一个关于如何使用数据目录的建议。首先，假设您有一些通用模板，将用于在不同的项目中创建标签。</p><p id="1c27" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">为此，我们需要两件不同的作品:</p><ul class=""><li id="a74d" class="kn ko hi jp b jq jr jt ju kj kp kk kq kl kr ki ks kt ku kv bi translated"><strong class="jp hj">标记中心项目</strong></li></ul><p id="6bf9" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">这是我们存储所有公共资源的地方，比如<a class="ae km" href="https://cloud.google.com/data-catalog/docs/tags-and-tag-templates" rel="noopener ugc nofollow" target="_blank">标签模板</a>、<a class="ae km" href="https://cloud.google.com/bigquery/docs/column-level-security-intro" rel="noopener ugc nofollow" target="_blank">策略标签</a>和<a class="ae km" href="https://cloud.google.com/data-catalog/docs/how-to/custom-entries" rel="noopener ugc nofollow" target="_blank">定制条目</a>。因此，我们不需要复制它们，只需支付一次费用，并且在管理和更改它们时更加轻松。</p><p id="b952" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">为了展示这一点，在Terraform示例中，我们将在标记中心项目中创建4个标记模板:</p><p id="9293" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">★数据工程模板</p><p id="2898" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">★派生数据模板</p><p id="76bc" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">★数据治理模板</p><p id="aa64" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">★数据质量模板</p><ul class=""><li id="8980" class="kn ko hi jp b jq jr jt ju kj kp kk kq kl kr ki ks kt ku kv bi translated"><strong class="jp hj">一组分析项目</strong></li></ul><p id="ad32" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">对于分析项目，我指的是那些将存储数据资产的项目，如大型查询表、发布子主题或任何其他由数据目录管理的资源。</p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h1 id="e401" class="lb lc hi bd ld le mf lg lh li mg lk ll io mh ip ln ir mi is lp iu mj iv lr ls bi translated">人物角色</h1><p id="a178" class="pw-post-body-paragraph jm jn hi jp b jq mk ij js jt ml im jv kj mm jy jz kk mn kc kd kl mo kg kh ki hb bi translated">现在，让我们来看一下将与Tag Central和Analytics项目交互的角色，我们将使用Terraform自动设置这些角色。</p><p id="76e2" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">请记住，这些名称只是建议，您可以用扮演类似角色的名称来替换它们，您可以将<strong class="jp hj">数据管理者</strong>称为<strong class="jp hj">数据架构师</strong>或者将<strong class="jp hj">数据管理者</strong>称为<strong class="jp hj">数据管家</strong>以及这个数据字母汤中的许多其他名称。</p><ul class=""><li id="f5d0" class="kn ko hi jp b jq jr jt ju kj kp kk kq kl kr ki ks kt ku kv bi translated"><strong class="jp hj">数据省长</strong></li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mp"><img src="../Images/fa6b8d36f9e1c01d052110f0b4b0851a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WUFyfufJq2IrEzTlSv-9wg.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">数据管理员角色</figcaption></figure><p id="5f1f" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">数据管理员是在元数据上执行管理工作负载的人员的角色。这意味着创建/更新/删除标记模板等数据目录资源，并设置数据治理流程的标准。</p><ul class=""><li id="fb2c" class="kn ko hi jp b jq jr jt ju kj kp kk kq kl kr ki ks kt ku kv bi translated"><strong class="jp hj">数据管理员</strong></li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mq"><img src="../Images/0faec3de22691d762f41941035c2ef29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y5TXujq8MvOymjJk9Os5ng.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">数据管理员角色</figcaption></figure><p id="9b5e" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">数据管理员会照顾你的数据资产:)…他们会选择相关的，并为它们添加意义(通过创建标签)，这样其他用户就可以很容易地发现和利用它们。</p><ul class=""><li id="1584" class="kn ko hi jp b jq jr jt ju kj kp kk kq kl kr ki ks kt ku kv bi translated"><strong class="jp hj">数据分析师</strong></li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mq"><img src="../Images/2d09d1ba8f3a27d5dd99e43084043d9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nU79i9YnB4dum66baxY-hQ.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">数据分析师角色</figcaption></figure><p id="ca94" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">这个人将使用策划的资产，定义和开发特定领域的分析，以支持您的决策。</p><p id="aa10" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">要考虑到，这些人物角色可能会改变或重叠，这取决于组织的规模或组织结构的方式。所以你可以让同一个人扮演多个角色。</p><blockquote class="jj jk jl"><p id="86bb" class="jm jn jo jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如果您使用不同的人物角色，请随意贡献您的范例库或在这篇博文中添加您的用例，这将非常有帮助。</p></blockquote></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h1 id="2a68" class="lb lc hi bd ld le mf lg lh li mg lk ll io mh ip ln ir mi is lp iu mj iv lr ls bi translated">自动化</h1><p id="14a0" class="pw-post-body-paragraph jm jn hi jp b jq mk ij js jt ml im jv kj mm jy jz kk mn kc kd kl mo kg kh ki hb bi translated">事不宜迟，让我们看看Terraform自动化，因为手动操作对我们没有任何好处！</p><p id="7a25" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">这个Github repo:</p><div class="mr ms ez fb mt mu"><a href="https://github.com/mesmacosta/google-datacatalog-governance-best-pratices" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab dw"><div class="mw ab mx cl cj my"><h2 class="bd hj fi z dy mz ea eb na ed ef hh bi translated">mes macosta/Google-数据目录-治理-最佳实践</h2><div class="nb l"><h3 class="bd b fi z dy mz ea eb na ed ef dx translated">脚本和自动化回购，以帮助确保谷歌数据目录的最佳做法…</h3></div><div class="nc l"><p class="bd b fp z dy mz ea eb na ed ef dx translated">github.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni jh mu"/></div></div></a></div><p id="d686" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">包含所有示例和如何运行它的详细分步指南。</p><p id="41b7" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">为了运行Terraform，我们将使用一个服务帐户，因为在撰写本文时，Data Catalog不支持使用来自Google Cloud SDK的最终用户凭据。</p><p id="03d5" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">为了遵循最佳实践，我们不会下载服务帐户密钥，而是使用<a class="ae km" href="https://cloud.google.com/iam/docs/impersonating-service-accounts" rel="noopener ugc nofollow" target="_blank">服务帐户模拟</a>。</p><h2 id="17f3" class="nj lc hi bd ld nk nl nm lh nn no np ll kj nq nr ln kk ns nt lp kl nu nv lr nw bi translated">创建服务帐户</h2><p id="dffb" class="pw-post-body-paragraph jm jn hi jp b jq mk ij js jt ml im jv kj mm jy jz kk mn kc kd kl mo kg kh ki hb bi translated">因此，第一步是创建一个服务帐户并设置适当的IAM角色:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nx ny l"/></div></figure><h2 id="1f3d" class="nj lc hi bd ld nk nl nm lh nn no np ll kj nq nr ln kk ns nt lp kl nu nv lr nw bi translated">设置Terraform变量占位符</h2><p id="bd56" class="pw-post-body-paragraph jm jn hi jp b jq mk ij js jt ml im jv kj mm jy jz kk mn kc kd kl mo kg kh ki hb bi translated">接下来，我们需要设置Terraform变量占位符。所以在你克隆了<a class="ae km" href="https://github.com/mesmacosta/google-datacatalog-governance-best-pratices" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>之后，换一下<a class="ae km" href="https://github.com/mesmacosta/google-datacatalog-governance-best-pratices/blob/main/tag-central/terraform/.tfvars" rel="noopener ugc nofollow" target="_blank">。tfvars </a>占位符。</p><p id="9e80" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">让我们看一个有效配置文件的示例:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nx ny l"/></div></figure><p id="8cfd" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">在上面的示例代码中，无论何时看到member，它都可以是:<code class="du nz oa ob oc b">user:{email}</code>、<code class="du nz oa ob oc b">serviceAccount:{email}</code>、<code class="du nz oa ob oc b">group:{email}</code>或<code class="du nz oa ob oc b">domain:{domain}</code>中的任何一个。</p><h2 id="2bb3" class="nj lc hi bd ld nk nl nm lh nn no np ll kj nq nr ln kk ns nt lp kl nu nv lr nw bi translated">运行Terraform</h2><p id="76c9" class="pw-post-body-paragraph jm jn hi jp b jq mk ij js jt ml im jv kj mm jy jz kk mn kc kd kl mo kg kh ki hb bi translated">最后，让我们执行Terraform:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nx ny l"/></div></figure><p id="07c9" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">如果你想快速浏览一下，我制作了一个演示视频来展示执行过程:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="od ny l"/></div></figure></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h2 id="d387" class="nj lc hi bd ld nk nl nm lh nn no np ll kj nq nr ln kk ns nt lp kl nu nv lr nw bi translated">生成的资源</h2><p id="53d2" class="pw-post-body-paragraph jm jn hi jp b jq mk ij js jt ml im jv kj mm jy jz kk mn kc kd kl mo kg kh ki hb bi translated">Terraform完成后，我们可以查看生成的资源:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oe"><img src="../Images/df57c3fb9a8a25b8e540789ec01b1c3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hTBffeGpwJDFLfGLTD7tDQ.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">IAM角色</figcaption></figure><p id="066b" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">我们可以看到，我们在Terraform中设置的所有项目都包含所讨论的人物角色，并具有适当的权限。</p><p id="44de" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">我们不要忘记Terraform创建的公共资源:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oe"><img src="../Images/547d3919decf10b81df3eec1d31f65ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Knv0ObidsvKuS1gpszPUDw.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">数据目录标记模板</figcaption></figure><p id="5451" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">差不多就这些了，感谢阅读:)。</p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h1 id="2b7d" class="lb lc hi bd ld le mf lg lh li mg lk ll io mh ip ln ir mi is lp iu mj iv lr ls bi translated">包扎</h1><p id="2f4e" class="pw-post-body-paragraph jm jn hi jp b jq mk ij js jt ml im jv kj mm jy jz kk mn kc kd kl mo kg kh ki hb bi translated">数据治理是一个非常复杂的领域，任何有助于我们设定和实施这些标准的自动化都是受欢迎的。在这篇博文中，我们查看了在<strong class="jp hj">项目</strong>级别工作时支持我们的Terraform示例。</p><p id="291c" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">请记住，如果您想要在<strong class="jp hj">文件夹</strong>或<strong class="jp hj">组织</strong>级别使用建议的访问控制，这是大型组织的常见用例。</p><p id="3903" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">GitHub repo中的<a class="ae km" href="https://github.com/mesmacosta/google-datacatalog-governance-best-pratices/blob/main/tag-central/terraform/iam/main.tf" rel="noopener ugc nofollow" target="_blank"> iam模块</a>很容易适应该用例，您需要做的就是将<code class="du nz oa ob oc b">google_project_iam_member</code>资源分别切换到<code class="du nz oa ob oc b">google_folder_iam_member</code>或<code class="du nz oa ob oc b">google_organization_iam_member</code>。</p><p id="bc17" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">如果您需要这方面的指导，请随时向示例库投稿或添加特性请求。</p><p id="963c" class="pw-post-body-paragraph jm jn hi jp b jq jr ij js jt ju im jv kj jx jy jz kk kb kc kd kl kf kg kh ki hb bi translated">干杯，</p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h1 id="55c7" class="lb lc hi bd ld le mf lg lh li mg lk ll io mh ip ln ir mi is lp iu mj iv lr ls bi translated">参考</h1><ul class=""><li id="1e2b" class="kn ko hi jp b jq mk jt ml kj of kk og kl oh ki ks kt ku kv bi translated"><strong class="jp hj">数据目录IAM角色</strong> : <a class="ae km" href="https://cloud.google.com/data-catalog/docs/concepts/iam" rel="noopener ugc nofollow" target="_blank">数据目录/文档/概念/iam </a></li><li id="7580" class="kn ko hi jp b jq kw jt kx kj ky kk kz kl la ki ks kt ku kv bi translated"><strong class="jp hj">示例GitHub</strong>:<a class="ae km" href="https://github.com/mesmacosta/google-datacatalog-governance-best-pratices" rel="noopener ugc nofollow" target="_blank">Google-data catalog-governance-best-practices</a></li><li id="876f" class="kn ko hi jp b jq kw jt kx kj ky kk kz kl la ki ks kt ku kv bi translated"><strong class="jp hj">冒充服务账号</strong> : <a class="ae km" href="https://cloud.google.com/iam/docs/impersonating-service-accounts" rel="noopener ugc nofollow" target="_blank">冒充服务账号</a></li></ul></div></div>    
</body>
</html>