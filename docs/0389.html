<html>
<head>
<title>Getting Started w/ PHP on GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在GCP上开始使用PHP</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/getting-started-w-php-on-gcp-a68246f9054c?source=collection_archive---------0-----------------------#2017-09-23">https://medium.com/google-cloud/getting-started-w-php-on-gcp-a68246f9054c?source=collection_archive---------0-----------------------#2017-09-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="97de" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">“缺失教程”系列</h2></div><p id="994c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">写一篇简短的</em> <a class="ae ju" rel="noopener" href="/@DazWilkin/starting-w-google-cloud-platform-apis-41221830ba76"> <em class="jt">系列</em> </a> <em class="jt">【入门】帖子对于像我这样的人来说，他们可能想要针对谷歌服务编写代码，选择了一种语言，但在一两周没有编写代码之后，我被“我到底该如何入门”所困扰</em></p><h2 id="abdd" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jg kg kh ki jk kj kk kl jo km kn ko kp bi translated">服务器端编程语言（Professional Hypertext Preprocessor的缩写）</h2><p id="cc5f" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg ks ji jj jk kt jm jn jo ku jq jr js hb bi translated">PHP是一种非常流行的语言，在服务器端(web)脚本中非常流行。我遇到过几次PHP，但是不记得曾经用它写过多少代码。脸书可能是最知名的PHP应用程序，WordPress紧随其后。</p><p id="bd16" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它是谷歌在<a class="ae ju" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云平台(GCP) </a>上正式支持的7种语言之一。</p><h2 id="5bec" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jg kg kh ki jk kj kk kl jo km kn ko kp bi translated">设置</h2><p id="3c1b" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg ks ji jj jk kt jm jn jo ku jq jr js hb bi translated">我运行的是Linux (Ubuntu 16.04)。我假设PHP中有一个(常用的)包管理器，当然还有一个PHP运行时。据我所知，我的Linux机器上目前没有安装这两个软件。所以，让我们从这里开始。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="dbe6" class="jv jw hi la b fi le lf l lg lh">PROJECT_ID=[[YOUR-PROJECT-ID]]<br/>LANG=php</span><span id="ad93" class="jv jw hi la b fi li lf l lg lh">mkdir -p ${HOME}/${PROJECT_ID}/${LANG}<br/>cd ${HOME}/${PROJECT_ID}/${LANG}</span></pre><h2 id="c50e" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jg kg kh ki jk kj kk kl jo km kn ko kp bi translated">服务器端编程语言（Professional Hypertext Preprocessor的缩写）</h2><p id="034c" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg ks ji jj jk kt jm jn jo ku jq jr js hb bi translated">稍微搜索了一下，我就找到了<a class="ae ju" href="http://php.net/manual/en/features.commandline.php" rel="noopener ugc nofollow" target="_blank"> PHP CLI </a>，我用以下代码安装了它:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="5651" class="jv jw hi la b fi le lf l lg lh"><a class="ae ju" href="https://getcomposer.org/doc/01-basic-usage.md" rel="noopener ugc nofollow" target="_blank">https://getcomposer.org/doc/01-basic-usage.md</a></span></pre><h2 id="c2da" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jg kg kh ki jk kj kk kl jo km kn ko kp bi translated">设计者</h2><p id="7d4c" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg ks ji jj jk kt jm jn jo ku jq jr js hb bi translated">Google API客户端库PHP文档引用了“composer.json ”,这让我找到了getcomposer.org。说明很简单:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="09b3" class="jv jw hi la b fi le lf l lg lh"><a class="ae ju" href="https://getcomposer.org/download/" rel="noopener ugc nofollow" target="_blank">https://getcomposer.org/download/</a></span></pre><p id="9f33" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="2944" class="jv jw hi la b fi le lf l lg lh">php composer.phar</span><span id="f82c" class="jv jw hi la b fi li lf l lg lh">   ______<br/>  / ____/___  ____ ___  ____  ____  ________  _____<br/> / /   / __ \/ __ `__ \/ __ \/ __ \/ ___/ _ \/ ___/<br/>/ /___/ /_/ / / / / / / /_/ / /_/ (__  )  __/ /<br/>\____/\____/_/ /_/ /_/ .___/\____/____/\___/_/<br/>                    /_/<br/>Composer version 1.5.2 2017-09-11 16:59:25</span><span id="7b84" class="jv jw hi la b fi li lf l lg lh">Usage:<br/>  command [options] [arguments]</span></pre><p id="1417" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Google文档为composer.json提供了一个需要用括号括起来的片段。我的文件包含:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="92c8" class="jv jw hi la b fi le lf l lg lh">{<br/>    "require": {<br/>        "google/apiclient": "^2.0"<br/>    }<br/>}</span></pre><p id="4228" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="5790" class="jv jw hi la b fi le lf l lg lh">php composer.phar install<br/>Loading composer repositories with package information<br/>Updating dependencies (including require-dev)<br/>Package operations: 12 installs, 0 updates, 0 removals<br/>  - Installing psr/http-message (1.0.1): Downloading (100%)<br/>  - Installing guzzlehttp/psr7 (1.4.2): Downloading (100%)<br/>  - Installing guzzlehttp/promises (v1.3.1): Downloading (100%)<br/>  - Installing guzzlehttp/guzzle (6.3.0): Downloading (100%)      <br/>  - Installing phpseclib/phpseclib (2.0.6): Downloading (100%)<br/>  - Installing psr/log (1.0.2): Downloading (100%)<br/>  - Installing monolog/monolog (1.23.0): Downloading (100%)        <br/>  - Installing firebase/php-jwt (v5.0.0): Downloading (100%)<br/>  - Installing google/apiclient-services (v0.26): Downloading (100%)<br/>  - Installing psr/cache (1.0.1): Downloading (100%)    <br/>  - Installing google/auth (v1.0.1): Downloading (100%)<br/>  - Installing google/apiclient (v2.2.0): Downloading (100%)</span><span id="347f" class="jv jw hi la b fi li lf l lg lh">...</span><span id="aa3d" class="jv jw hi la b fi li lf l lg lh">Writing lock file<br/>Generating autoload files</span></pre><p id="dbab" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">屈服:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="ba53" class="jv jw hi la b fi le lf l lg lh">ls -l</span><span id="78b0" class="jv jw hi la b fi li lf l lg lh">composer.json<br/>composer.lock<br/>composer.phar<br/>vendor</span></pre><p id="89bc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">并且:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="8cdd" class="jv jw hi la b fi le lf l lg lh">ls -l vendor<br/><br/>autoload.php<br/>composer<br/>firebase<br/>google<br/>guzzlehttp<br/>monolog<br/>phpseclib<br/>psr</span></pre><p id="6558" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">好的。那看起来没有错；-)我们继续，看看会发生什么…</p><h2 id="6288" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jg kg kh ki jk kj kk kl jo km kn ko kp bi translated">应用程序默认凭据</h2><p id="1757" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg ks ji jj jk kt jm jn jo ku jq jr js hb bi translated">本系列的一个一致建议是，如果可以，您应该使用<a class="ae ju" href="https://developers.google.com/identity/protocols/application-default-credentials" rel="noopener ugc nofollow" target="_blank">应用程序默认凭证(ADC)</a>。该页面包含在每种Google支持的编程语言中使用ADC的说明。以下是PHP的链接:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="7ebc" class="jv jw hi la b fi le lf l lg lh"><a class="ae ju" href="https://developers.google.com/identity/protocols/application-default-credentials#callingphp" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/identity/protocols/application-default-credentials#callingphp</a></span></pre><p id="a5de" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">代码是:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="aad3" class="jv jw hi la b fi le lf l lg lh">$client = new Google_Client();<br/>$client-&gt;useApplicationDefaultCredentials();</span></pre><h2 id="9be0" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jg kg kh ki jk kj kk kl jo km kn ko kp bi translated">谷歌云存储</h2><p id="7cac" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg ks ji jj jk kt jm jn jo ku jq jr js hb bi translated">对于本系列中的大多数其他帖子，我一直在使用<a class="ae ju" href="https://cloud.google.com/storage/" rel="noopener ugc nofollow" target="_blank">Google Cloud Storage(GCS)</a>，我也将在PHP中使用该服务。</p><p id="b2e9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了便于编写对GCS Buckets和对象进行操作的代码，下面的脚本将为您创建一个唯一命名的bucket，并用10个不同命名但相同的内容图像填充它。请将$FILE设置为您希望用作模板的小文件的路径值。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="c94f" class="jv jw hi la b fi le lf l lg lh">BUCKET=$(whoami)-$(date +%y%m%d%H%M)<br/>FILE=[[/Path/To/Your/File]]</span><span id="c203" class="jv jw hi la b fi li lf l lg lh">gsutil mb -p ${PROJECT_ID} gs://${BUCKET}<br/>Creating gs://${BUCKET}/...</span><span id="2700" class="jv jw hi la b fi li lf l lg lh">for i in $(seq -f "%02g" 1 10)<br/>do<br/>  gsutil cp $FILE gs://${BUCKET}/${i}<br/>done</span><span id="800b" class="jv jw hi la b fi li lf l lg lh">gsutil ls gs://${BUCKET}<br/>gs://${BUCKET}/01<br/>gs://${BUCKET}/02<br/>gs://${BUCKET}/03<br/>gs://${BUCKET}/04<br/>gs://${BUCKET}/05<br/>gs://${BUCKET}/06<br/>gs://${BUCKET}/07<br/>gs://${BUCKET}/08<br/>gs://${BUCKET}/09<br/>gs://${BUCKET}/10</span></pre><h2 id="4611" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jg kg kh ki jk kj kk kl jo km kn ko kp bi translated">解决方案1:使用API客户端库</h2><p id="69ce" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg ks ji jj jk kt jm jn jo ku jq jr js hb bi translated">PHP的cloud.google.com文档在这一点上失去了动力:API客户端库是从定义每个谷歌服务的<a class="ae ju" href="https://developers.google.com/discovery/v1/reference/apis" rel="noopener ugc nofollow" target="_blank">发现文档</a>中机器生成的。因此，这些库很好地反映了服务API，并且，正如PHP文档所鼓励的那样，使用Google API Explorer作为推断如何使用这些库的方法是一个很好的实践。鉴于PHP的文档如此稀少，API Explorer几乎是我们所拥有的全部。不幸的是，即使使用<a class="ae ju" href="https://developers.google.com/apis-explorer/#search/cloud%20storage/storage/v1/" rel="noopener ugc nofollow" target="_blank"> API Explorer for GCS </a>，仍然很难确定PHP代码:</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lj"><img src="../Images/c1b8d3169327303641610eee1178f2b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4STU7H1tLaRWVdVJUNJ3MQ.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">云存储JSON API V1</figcaption></figure><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lj"><img src="../Images/45c38c3fe80a0bf5dc5a57d0dd5fcd42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9lUc0j6q72vGxGnROCBCZg.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">调用storage.buckets.list</figcaption></figure><figure class="kv kw kx ky fd lk er es paragraph-image"><div class="er es lv"><img src="../Images/a153d7dbdacc9ff3a788fe9acfbf6eaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*PE27NLEctnYX2_yW1Wydbw.png"/></div></figure><p id="8467" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如您将在下面看到的，很容易确定我们将使用storage.buckets.list列出存储桶，使用storage.objects.list列出对象。但是，这些命令直接映射到存储-&gt;存储桶-&gt;列表而不是存储-&gt;存储桶-&gt;列表存储桶。所以，回到文档。</p><p id="7fae" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当我知道Google开源了GitHub上的库时，我发现:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="e5a9" class="jv jw hi la b fi le lf l lg lh"><a class="ae ju" href="https://github.com/google/google-api-php-client" rel="noopener ugc nofollow" target="_blank">https://github.com/google/google-api-php-client</a></span></pre><p id="57d7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后我(随机)在谷歌上搜索了一下服务名(Google_Service_Storage ),找到了<a class="ae ju" href="https://github.com/google/google-api-php-client/search?q=Google_Service_Storage&amp;type" rel="noopener ugc nofollow" target="_blank">这个</a>:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="3cf6" class="jv jw hi la b fi le lf l lg lh">...<br/>$storage = new Google_Service_Storage($client);<br/>...</span></pre><p id="644d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后我发现(说真的这是学这个库的方法？)StackOverflow上的以下<a class="ae ju" href="https://stackoverflow.com/questions/36013285/downloading-from-google-cloud-storage-with-php/36015334#36015334" rel="noopener ugc nofollow" target="_blank">解决方案</a>:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="f00d" class="jv jw hi la b fi le lf l lg lh">...<br/>$object = $service-&gt;objects-&gt;listObjects(BUCKET, OBJECT);<br/>...</span></pre><p id="f8c4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以，我开始探索，看看我能做些什么:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="59d5" class="jv jw hi la b fi le lf l lg lh">define("BUCKET_NAME", "[[BUCKET]]");</span><span id="d2eb" class="jv jw hi la b fi li lf l lg lh">$request = $service-&gt;objects-&gt;listObjects(BUCKET_NAME);<br/>print_r($request);</span></pre><p id="96c0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这导致以下结果(修订):</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="ef5a" class="jv jw hi la b fi le lf l lg lh">Google_Service_Storage_Objects Object<br/>(<br/>    [itemsType:protected] =&gt; Google_Service_Storage_StorageObject<br/>    [itemsDataType:protected] =&gt; array<br/>    [kind] =&gt; storage#objects<br/>    [nextPageToken] =&gt; <br/>    [prefixes] =&gt; <br/>    [internal_gapi_mappings:protected] =&gt; Array<br/>        (<br/>        )<br/>[items] =&gt; Array<br/>        (<br/>            [0] =&gt; Google_Service_Storage_StorageObject Object<br/>                (<br/>                    [bucket] =&gt; [[BUCKET]]<br/>                    [id] =&gt; [[BUCKET]]/01/1234567890123456<br/>                    [kind] =&gt; storage#object<br/>                    [name] =&gt; 01<br/>                    [size] =&gt; 22976<br/>                    ...</span><span id="91b3" class="jv jw hi la b fi li lf l lg lh">            [1] =&gt; Google_Service_Storage_StorageObject Object<br/>                (<br/>                    [bucket] =&gt; [[BUCKET]]<br/>                    [id] =&gt; [[BUCKET]]/02/1234567890123456<br/>                    [kind] =&gt; storage#object<br/>                    [name] =&gt; 02<br/>                    [size] =&gt; 22976<br/>                    ...</span></pre><p id="a84d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">“items”数组正确地表示了我上传到bucket的10个对象。然后，Google给了我迭代数组并获取“name”属性的方法:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="a605" class="jv jw hi la b fi le lf l lg lh">foreach ($request["items"] as $object)<br/>    printf("%s\n", $object["name"]);</span></pre><p id="4771" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是，事实证明，有针对这些属性的getter，所以—我怀疑—更好的方法是:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="0975" class="jv jw hi la b fi le lf l lg lh">foreach ($request["items"] as $object)<br/>    printf("%s\n", $object-&gt;getName());</span></pre><p id="c379" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这(正确地)导致:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="ae11" class="jv jw hi la b fi le lf l lg lh">01<br/>02<br/>03<br/>04<br/>05<br/>06<br/>07<br/>08<br/>09<br/>10</span></pre><p id="29bd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我以前从未参加过这种竞技表演，我猜想枚举桶的方法是相似的($service →buckets ),但最初错误地猜到了方法(listObjects ),然后意识到这需要:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="777c" class="jv jw hi la b fi le lf l lg lh">define("PROJECT_ID", "dazwilkin-170828-medium");</span><span id="ffdf" class="jv jw hi la b fi li lf l lg lh">$request = $service-&gt;buckets-&gt;listBuckets(PROJECT_ID);<br/>print_r($request);</span></pre><p id="ec13" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">导致:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="614c" class="jv jw hi la b fi le lf l lg lh">Google_Service_Storage_Buckets Object<br/>(<br/>    [collection_key:protected] =&gt; items<br/>    [itemsType:protected] =&gt; Google_Service_Storage_Bucket<br/>    [itemsDataType:protected] =&gt; array<br/>    [kind] =&gt; storage#buckets<br/>    [nextPageToken] =&gt; <br/>    ...<br/>[items] =&gt; Array<br/>    (<br/>        [0] =&gt; Google_Service_Storage_Bucket Object<br/>            (<br/>                [id] =&gt; [[BUCKET]]<br/>                [kind] =&gt; storage#bucket<br/>                [labels] =&gt;<br/>                [location] =&gt; US<br/>                [name] =&gt; [[BUCKET]]<br/>                [storageClass] =&gt; STANDARD<br/>                [timeCreated] =&gt; 2017-08-31T00:00:00.000Z<br/>                [updated] =&gt; 2017-08-31T00:00:00.000Z<br/>                ...</span></pre><p id="0885" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以我们很快就能了解到:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="9f34" class="jv jw hi la b fi le lf l lg lh">foreach ($request["items"] as $bucket)<br/>    printf("%s\n", $bucket-&gt;getName());</span></pre><p id="b6fd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将这些放在一起:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="edc5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">运行解决方案:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="e448" class="jv jw hi la b fi le lf l lg lh">php cloudstorage.php</span><span id="83f8" class="jv jw hi la b fi li lf l lg lh">[[BUCKET]]<br/>01<br/>02<br/>03<br/>04<br/>05<br/>06<br/>07<br/>08<br/>09<br/>10</span></pre><p id="70c7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是一次相当令人失望的经历。让我们希望云客户端库得到更好的记录吧！</p><p id="7921" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">PS我发现了Packagist:</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es ly"><img src="../Images/a94835ab3ad252a0af042adc7a86c30d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V0HrWY__CwNaQK9X3B-i_A.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">包装商:谷歌/apiclient</figcaption></figure><h2 id="a50b" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jg kg kh ki jk kj kk kl jo km kn ko kp bi translated">解决方案2:使用云客户端库</h2><p id="726e" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg ks ji jj jk kt jm jn jo ku jq jr js hb bi translated">在PHP中使用云客户端库看起来更有前途。云存储包括一个PHP <a class="ae ju" href="https://cloud.google.com/storage/docs/reference/libraries#client-libraries-install-php" rel="noopener ugc nofollow" target="_blank">示例</a>，它提供了我们需要的大部分内容。我现在也发现了Packagist:</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lz"><img src="../Images/6f2defdbf3c465a2727b3f807bff57e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zh33tT7DYiIM57Pxyvshzw.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">包装商:谷歌/云</figcaption></figure><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es ma"><img src="../Images/3b9abe04fe3d3fa8bac5f298857673d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OYGmza584Wf206doG5NYNg.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">包装商:谷歌/云存储</figcaption></figure><p id="e8f2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这表明它依赖于google/cloud-core，所以我假设我们可以参考google/cloud-storage(注意，版本是v.1.1.5 ),我们会很好:</p><p id="d534" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">composer.json:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="be8b" class="jv jw hi la b fi le lf l lg lh">{<br/>    "require": {<br/>        "google/cloud-storage": "^1.1.5"<br/>    }<br/>}</span></pre><p id="b311" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="9981" class="jv jw hi la b fi le lf l lg lh">php composer.phar install<br/>Loading composer repositories with package information<br/>Updating dependencies (including require-dev)<br/>Package operations: 12 installs, 0 updates, 0 removals<br/>  - Installing psr/http-message (1.0.1): Loading from cache<br/>  - Installing psr/log (1.0.2): Loading from cache<br/>  - Installing monolog/monolog (1.23.0): Loading from cache<br/>  - Installing guzzlehttp/psr7 (1.4.2): Loading from cache<br/>  - Installing guzzlehttp/promises (v1.3.1): Loading from cache<br/>  - Installing guzzlehttp/guzzle (6.3.0): Loading from cache<br/>  - Installing psr/cache (1.0.1): Loading from cache<br/>  - Installing firebase/php-jwt (v5.0.0): Loading from cache<br/>  - Installing google/auth (v1.0.1): Loading from cache<br/>  - Installing rize/uri-template (0.3.2): Downloading (100%)        <br/>  - Installing google/cloud-core (v1.9.0): Downloading (100%)      <br/>  - Installing google/cloud-storage (v1.1.5): Downloading (100%)</span><span id="5cee" class="jv jw hi la b fi li lf l lg lh">...</span><span id="74ef" class="jv jw hi la b fi li lf l lg lh">Writing lock file<br/>Generating autoload files</span></pre><p id="ecc2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">虽然此库支持应用程序默认凭据，但实现方式有所不同。这对我很有效:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="45b4" class="jv jw hi la b fi le lf l lg lh">define("PROJECT_ID", [[YOUR-PROJECT-ID]]);</span><span id="062d" class="jv jw hi la b fi li lf l lg lh">$gcloud = new ServiceBuilder([<br/>    "projectId" =&gt; PROJECT_ID<br/>]);</span></pre><p id="6fe3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">API文档！！:-)</p><p id="0852" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">专门针对<a class="ae ju" href="https://googlecloudplatform.github.io/google-cloud-php/#/docs/cloud-storage/v1.1.5/storage/storageclient" rel="noopener ugc nofollow" target="_blank">云存储</a>。让生活变得更容易。从文档中可以看到，StorageClient对象有一个“buckets”<a class="ae ju" href="https://googlecloudplatform.github.io/google-cloud-php/#/docs/cloud-storage/v1.1.5/storage/storageclient?method=buckets" rel="noopener ugc nofollow" target="_blank">方法</a>，这正好提供了我们需要的代码:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="1b77" class="jv jw hi la b fi le lf l lg lh">$buckets = $storage-&gt;buckets();<br/>foreach ($buckets as $bucket) {<br/>    printf("%s\n", $bucket-&gt;getName());<br/>}</span></pre><p id="aaf2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以猜测枚举对象的代码，但是，让我们回顾一下<a class="ae ju" href="https://googlecloudplatform.github.io/google-cloud-php/#/docs/cloud-storage/v1.1.5/storage/bucket?method=objects" rel="noopener ugc nofollow" target="_blank">文档</a>。这样的进步！</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="4ebf" class="jv jw hi la b fi le lf l lg lh">$bucket = $storage-&gt;bucket(BUCKET);<br/>$objects = $bucket-&gt;objects();<br/>foreach ($objects as $object) {<br/>    printf("%s\n", $object-&gt;name());<br/>}</span></pre><p id="ca38" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">总而言之:</p><figure class="kv kw kx ky fd lk"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="baf2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">运行解决方案:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="204f" class="jv jw hi la b fi le lf l lg lh">php cloudstorage.php</span><span id="508f" class="jv jw hi la b fi li lf l lg lh">[[BUCKET]]<br/>01<br/>02<br/>03<br/>04<br/>05<br/>06<br/>07<br/>08<br/>09<br/>10</span></pre><h2 id="2218" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jg kg kh ki jk kj kk kl jo km kn ko kp bi translated">整理</h2><p id="aa75" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg ks ji jj jk kt jm jn jo ku jq jr js hb bi translated">完成后，您可以删除存储桶(及其所有对象)。非常小心地指定正确的存储桶名称，因为操作是不可撤销的。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="cf11" class="jv jw hi la b fi le lf l lg lh">gsutil rm -r gs://${BUCKET}</span></pre><h2 id="6b37" class="jv jw hi bd jx jy jz ka kb kc kd ke kf jg kg kh ki jk kj kk kl jo km kn ko kp bi translated">结论</h2><p id="c199" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg ks ji jj jk kt jm jn jo ku jq jr js hb bi translated">除非你正在维护现有的代码*或者*你想要跨多个Google服务的一致性，并且这些服务中的一个或多个*没有*云客户端库，否则我强烈建议你考虑使用PHP的云客户端库。API客户端库虽然全面，但是文档记录很差，这使得开发具有挑战性。</p><p id="51ed" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">PHP的云客户端库非常棒！</p></div></div>    
</body>
</html>