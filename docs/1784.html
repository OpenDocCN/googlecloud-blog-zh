<html>
<head>
<title>Google Cloud Scheduler: serveless CRON jobs with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google Cloud Scheduler:使用Python的无服务CRON作业</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-cloud-scheduler-serveless-cron-jobs-with-python-ae10509479b8?source=collection_archive---------0-----------------------#2021-02-02">https://medium.com/google-cloud/google-cloud-scheduler-serveless-cron-jobs-with-python-ae10509479b8?source=collection_archive---------0-----------------------#2021-02-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/eeed42c2cac52bc5ac8afde32818c064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h2P5XvHQvwK2wa-hgpZ58Q.jpeg"/></div></div></figure><p id="c377" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我自己没有经历过，只听说过一些脚本以给定的频率运行的麻烦。每当专业人员需要自动化这个过程时，他们可能需要在一台机器上部署一个CRON。</p><p id="9ea5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为这是一个已知的问题，而且我有使用云服务的经验，所以我决定看看谷歌云平台能提供什么。我找到的答案是Google Cloud Scheduler，一个完全托管的CRON作业服务。</p><p id="076d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了玩它，我决定做一个推特机器人。并不是说我是Twitter爱好者，但是使用它的Python API非常简单。我给这个机器人设定了每天早上8点发布“祝你愉快”的程序。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es jo"><img src="../Images/f9b9f40c8d5a633a99800a2ea8eed3d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/0*M9WwuC5DdyZmN065"/></div></figure><p id="57f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了做到这一点，我将Google Cloud Scheduler通过Cloud Pub/Sub来触发一个云功能。</p><h1 id="0cfd" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">谷歌云发布/订阅</h1><p id="f11b" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">这是一个完全托管的消息服务，像Apache Kafka，RabbitMQ等。它可以用于大量数据，并保证消息至少被传递一次。在这里，我简单地创建了一个名为have-a-nice-day的主题，这是一个非常简单的过程。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/517f413b452c2a94a75aeabe20124b76.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/0*rOR9o8mzE9OzM94C"/></div><figcaption class="kx ky et er es kz la bd b be z dx translated">发布/订阅主题</figcaption></figure><p id="43a4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我很确定每天一次对几个字节使用这样一个强大的工具是一种过度的杀戮。但它使用起来并不复杂，而且你为传输的数据付费，何乐而不为呢？</p><h1 id="4e1d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">谷歌云调度程序</h1><p id="c781" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">谷歌云调度程序可以在GCP菜单的工具部分找到。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/0a02b28b809ab48a949de5486b4914c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LuNy2D0DY3ME7ZU6"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">在哪里可以找到谷歌云调度程序</figcaption></figure><p id="9807" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在那里，您将看到您已经设置的作业(可能还没有)。单击创建作业以设置要运行的参数。在那里，你必须给它一个名称，描述，频率，时区和目标。</p><p id="00b8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用unix-cron格式指定频率。如果你和我一样，不熟悉它，我建议你检查一下<a class="ae lc" href="https://crontab.guru/" rel="noopener ugc nofollow" target="_blank"> crontab guru </a>以获得一种可访问的方法来编辑这种表达式。</p><p id="ed00" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于目标，您可以在HTTP、发布/订阅或应用引擎HTTP之间进行选择。由于我想触发一个云功能，所以我选择发布到一个发布/订阅主题。HTTP请求也可以完成这项工作。</p><p id="13b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦选定，它会询问您想要发送的主题和信息。我的工作最终是这样的:</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ld"><img src="../Images/8a4e6f510cb7678787b35aca965cfe1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*npWhYhqmMhgV4DuT"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">如何配置谷歌云调度程序</figcaption></figure><h1 id="0ef1" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">谷歌云功能</h1><p id="b8ef" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">Google Cloud Functions是一小段代码，可能由HTTP请求、云发布/订阅消息或云存储上的一些操作触发。在这一步中，我简单地选择了Cloud Pub/Sub触发器，并定义了它正在监听的主题。对于环境变量，我放置了访问Twitter API的凭证。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es le"><img src="../Images/3c6afa16b9d26f391e1174c4d20c700b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/0*Xs7TKH-sf1fQ6Jdy"/></div><figcaption class="kx ky et er es kz la bd b be z dx translated">谷歌云功能设置</figcaption></figure><p id="cfe5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我决定使用Python，因为我发现Python Twitter <a class="ae lc" href="https://github.com/bear/python-twitter." rel="noopener ugc nofollow" target="_blank"> repo </a>中的代码很容易使用。在这个页面中，您必须选择当云函数被触发时将运行哪个函数，在这个例子中，是hello_cloudscheduler。你可以找到我在这个<a class="ae lc" href="https://gist.github.com/andrevrochasilva/ba4e7279e7b4d76b22465da027f3059f" rel="noopener ugc nofollow" target="_blank"> github gist </a>中使用的代码。别忘了把python-twitter放在需求里！</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lf"><img src="../Images/dbc99498ce14bdaa09ca315af1df9df7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3NN6s4g8CfbaVlex"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">云功能配置</figcaption></figure><p id="4c8c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完成了！有了我们所做的工作，我们将每天运行一项任务，而不必为此而部署和维护虚拟机。你可以使用相同的架构<a class="ae lc" href="https://towardsdatascience.com/my-first-etl-job-google-cloud-dataflow-1fd773afa955" rel="noopener" target="_blank">每天运行云数据流</a>。由于Cloud Pub/Sub功能强大，您可以根据自己的喜好提高频率。完全无服务器。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es lg"><img src="../Images/a040c0865e74e96128ae551e2312e62f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/0*QbXbrBAdwrWFEBa6"/></div><figcaption class="kx ky et er es kz la bd b be z dx translated">我的个人资料照片是我真正的猫</figcaption></figure><p id="aa57" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当然，我喜欢看到一些朋友手动转发我的自动帖子。</p></div></div>    
</body>
</html>