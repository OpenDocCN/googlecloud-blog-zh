<html>
<head>
<title>How to connect Google Cloud Platform networks via VPN</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何通过VPN连接谷歌云平台网络</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-connect-google-cloud-platform-networks-via-vpn-622e47d510ba?source=collection_archive---------0-----------------------#2015-08-21">https://medium.com/google-cloud/how-to-connect-google-cloud-platform-networks-via-vpn-622e47d510ba?source=collection_archive---------0-----------------------#2015-08-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b465" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当多个团队在一个软件开发项目上工作时，拥有多个Google云平台项目对项目资源进行更细粒度的访问和权限控制是有意义的。但是，使用这种方法，您需要一种方法来连接服务，而不将这些服务公开。这就是VPN的用处。您可以使用VPN安全地连接运行服务的网络。在这篇博文中，我们将在两个网络之间建立一对一的连接。Google VPN设置也允许网络间的1:n和n:m VPN设置。</p><h2 id="7f3d" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">所需步骤的快速总结</h2><ul class=""><li id="b237" class="jy jz hi ih b ii ka im kb iq kc iu kd iy ke jc kf kg kh ki bi translated">在您的每个项目中，为您希望通过VPN连接的实例创建一个专用网络</li><li id="c250" class="jy jz hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">使用专用的端点IP地址在每个项目中设置VPN连接</li><li id="a541" class="jy jz hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">添加防火墙规则，以便实例可以跨越其专用网络边界进行“对话”</li><li id="ba87" class="jy jz hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">测试VPN设置</li></ul><h2 id="d3bb" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">通过VPN连接谷歌云平台网络的详细步骤</h2><p id="e2cd" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">在项目a中，为您希望通过VPN连接的Google计算引擎实例创建一个专用网络。这将是我们的项目a网络。在<a class="ae kr" href="https://en.wikipedia.org/wiki/Private_network" rel="noopener ugc nofollow" target="_blank">个私有IP地址范围</a>中选择一个地址范围。在我们的例子中，我们将使用一个超过65k地址的C类网络。记下地址范围，稍后您将需要它来设置VPN连接。最后但同样重要的是，在您的地址范围内选择一个地址作为“网关”。</p><figure class="kt ku kv kw fd kx er es paragraph-image"><div class="er es ks"><img src="../Images/94594dd6a37ceb6a14d7bbf2abe1f337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Es0eFNhVcxMU0_JM0fW7BQ.png"/></div></figure><p id="d9f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">重复上述步骤，为项目b中您希望通过VPN连接的实例创建一个专用网络。这将是我们的项目b网络。重要说明:选择一个与您为项目A设置选择的地址范围不同的地址范围。同样，请注意地址范围并设置有效的“网关”。</p><figure class="kt ku kv kw fd kx er es paragraph-image"><div class="er es ks"><img src="../Images/1a1aa36dd123eb10d835fadba3f41c05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_UDSQNKlYhFqVz0ppvGjog.png"/></div></figure><p id="ada9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是为每个相互指向的项目创建一个VPN连接。转到Networks-&gt;VPN，开始在project A中创建一个新的VPN连接。为它命名，选择您在上一步中创建的project-a-network，并为VPN创建一个IP地址。此时，您还不知道远程IP地址，所以暂时将其留空。</p><p id="47b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选择一个强共享秘密(共享秘密非常敏感，因为它允许进入你的网络-&gt; <strong class="ih hj">保持它非常非常安全！</strong>)并将“远程网络IP范围”设置为您为project-b-network选择的“地址范围”。共享密码仅用于VPN连接设置，不要在其他地方共享。</p><p id="0380" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在只有“远程对等IP地址”仍然缺失。保持设置页面打开，并打开一个新的浏览器选项卡。转到开发人员控制台，重复相同的步骤，在项目B中设置VPN连接。一旦为项目B VPN设置创建了“IP地址”,记下它，返回到项目a VPN设置页面，并将此“IP地址”插入“远程对等IP地址”字段。</p><p id="4e4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在项目B VPN设置中，将“远程对等IP地址”设置为您为项目A设置创建的“IP地址”。对两种设置使用相同的共享密钥。</p><figure class="kt ku kv kw fd kx er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es la"><img src="../Images/5e54dbb6fabf2976105cc646861af4f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lnEIf8rpDw_GYWTJNi6DSQ.png"/></div></div></figure><p id="9fee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">稍等片刻后，您应该会看到两个VPN设置都有一个绿色勾号，表示配置成功。如果您看不到这些复选标记，请检查日志，了解建立连接时发生错误的信息。</p><figure class="kt ku kv kw fd kx er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lf"><img src="../Images/8425c405cba3e7feb72dcf9e7156d998.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sHrxNxZhk0lGV8Ik5_eCDg.png"/></div></div></figure><h2 id="e89b" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">测试VPN</h2><p id="c8bf" class="pw-post-body-paragraph if ig hi ih b ii ka ik il im kb io ip iq ko is it iu kp iw ix iy kq ja jb jc hb bi translated">当您看到两个VPN设置的绿色复选标记时，您应该可以开始了。让我们验证连接是否真的工作。</p><p id="1c29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要做什么来测试连接？</p><ul class=""><li id="183c" class="jy jz hi ih b ii ij im in iq lg iu lh iy li jc kf kg kh ki bi translated">在项目A和项目B中创建计算引擎实例，它们位于我们为VPN创建的网络中</li><li id="3dc0" class="jy jz hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">创建防火墙规则以允许SSH和ping</li><li id="4128" class="jy jz hi ih b ii kj im kk iq kl iu km iy kn jc kf kg kh ki bi translated">SSH到实例中，查找IP地址，并ping“其他”网络中的机器</li></ul><p id="0d77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们在每个项目中创建一个Google计算引擎实例。创建实例时，在“管理、磁盘、网络、访问和安全”选项中选择各自的专用网络(项目a网络和项目b网络)。</p><figure class="kt ku kv kw fd kx er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es la"><img src="../Images/0d29349b8ff23a384fbb2eb91e3ccc97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lD2ZTf9j_3bJ3yddMzVyFg.png"/></div></div></figure><p id="e042" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其次，我们需要向我们创建的专用网络(项目a网络和项目b网络)添加两个防火墙规则。进入网络-&gt;网络，点击项目-[a | b]-网络。单击“添加防火墙规则”。我们创建的第一个规则允许来自公众的SSH流量，这样我们就可以SSH到我们刚刚创建的实例中。第二条规则允许两个网络之间的icmp流量(ping使用icmp协议)。</p><figure class="kt ku kv kw fd kx er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lj"><img src="../Images/38440b5ecfa48636d541c1df90e96a77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GqZS0EAaMD0m391cx4doVA.png"/></div></div></figure><figure class="kt ku kv kw fd kx er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lk"><img src="../Images/166d5145011f1f9405aac88f1207cb39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*68B6Yg8in0y78H8pHPNAjg.png"/></div></div></figure><p id="a180" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以SSH到每个实例并ping另一个实例。</p><figure class="kt ku kv kw fd kx er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es ll"><img src="../Images/90f523774c9053bcbe5cb80b93b40b36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EzNfp_qoSyvHlT2SpyEm2w.png"/></div></div></figure><p id="5aae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇博文中，我演示了如何在两个谷歌云平台网络之间建立1:1的VPN连接。通过向您的VPN连接添加额外的“隧道”,您可以将这些1:1连接扩展到网络之间的1:n甚至n:m链接。</p><p id="0b04" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于建立VPN连接的更多信息可以在<a class="ae kr" href="https://cloud.google.com/compute/docs/vpn" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/compute/docs/vpn</a><strong class="ih hj">找到。</strong></p></div></div>    
</body>
</html>