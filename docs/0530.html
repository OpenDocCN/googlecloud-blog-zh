<html>
<head>
<title>Istio Why do I need it?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么我需要它？</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/istio-why-do-i-need-it-18d122838ee3?source=collection_archive---------0-----------------------#2018-03-06">https://medium.com/google-cloud/istio-why-do-i-need-it-18d122838ee3?source=collection_archive---------0-----------------------#2018-03-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="0968" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我最近没有太多的时间玩k8s，不可否认地失去了剧情，这正是Istio真正会添加到K8s派对中的。它会增加更多的运营开销吗？它是否简化了一些你通常需要做的事情？这些都是在我脑海中浮现的问题。</p><p id="8928" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(我怀疑在发表这篇文章后，一群比我更了解K8s的队友会和我讨论我的观点…..这些是我最喜欢的对话，尽管是和队友的辩论)</p><p id="17aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么Istio到底是什么？</p><p id="6524" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从<a class="ae jd" href="http://istio.io" rel="noopener ugc nofollow" target="_blank"> Istio网站</a>上可以看到:</p><p id="77f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Istio为您提供:</p><ul class=""><li id="dcf8" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">HTTP、gRPC、WebSocket和TCP流量的自动负载平衡。</li><li id="d5a3" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">通过丰富的路由规则、重试、故障转移和故障注入对流量行为进行细粒度控制。</li><li id="90d0" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">支持访问控制、速率限制和配额的可插拔策略层和配置API。</li><li id="85d1" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">自动度量、记录和跟踪集群内的所有流量，包括集群入口和出口。</li><li id="18d9" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">通过群集中服务之间的强身份断言实现安全的服务到服务身份验证。</li></ul><p id="14d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以通过在整个环境中部署一个特殊的sidecar代理(一个助手容器)来为服务添加Istio支持(不仅仅是集群让我印象深刻是有原因的，如果您做到了这一点，请稍后查看)。一旦安装了sidecar代理，所有(微)服务之间的网络通信都通过该代理进行。此外，所有网络通信都使用Istio的控制平面功能进行配置和管理。</p><p id="65e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Istio是一个<strong class="ih hj">服务网</strong>。我在考虑服务网格时使用的定义是“一个专用的基础设施层，使服务到服务的通信安全、高效和可靠”</p><p id="8396" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，如果你像我一样从<a class="ae jd" href="https://istio.io/docs/concepts/what-is-istio/overview.html" rel="noopener ugc nofollow" target="_blank">概念文档</a>开始，其中有这样的内容:“术语<strong class="ih hj">服务网格</strong>通常用于描述组成此类应用的微服务网络以及它们之间的交互。随着服务网格的规模和复杂性的增长，理解和管理会变得更加困难。其要求可能包括发现、负载平衡、故障恢复、指标和监控，以及通常更复杂的操作要求，如A/B测试、金丝雀发布、速率限制、访问控制和端到端身份验证。Istio提供了一个完整的解决方案，通过提供对服务网格整体的行为洞察和运营控制，来满足微服务应用的各种需求。”</p><p id="5438" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看完那个你可能和我一样迷茫！我最终被转移了注意力，并探索了互联网关于服务网格到底是什么的普遍共识。看起来我使用的定义是从我的非代表性样本中普遍认同的一个合理的选择。但缺少的是将其与k8s等编排工具区分开来的细节。Istio与k8s结合使用，如果没有K8s或其他容器编排工具，它就不是一个东西。它不进行编排，实际上似乎旨在解决管理基于大型微服务的解决方案的网络和操作复杂性。所以一个覆盖像k8s那样的东西吧！….现在我真的需要继续写这篇文章了…</p><p id="fb90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我知道Istio是什么，它能为您带来什么，但它实际上能解决什么运营难题呢？</p><p id="dddb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从<a class="ae jd" href="https://istio.io/docs/concepts/what-is-istio/overview.html" rel="noopener ugc nofollow" target="_blank">为什么使用Istio页面</a>可以看出，它在整个服务网络中统一提供了许多关键功能:</p><ul class=""><li id="c679" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">交通管理</li><li id="d398" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">可观察性</li><li id="c27c" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">政策实施</li><li id="26f6" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">服务身份和安全性</li></ul><p id="fd47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对我来说，真正理解Istio的价值在于时间，所以我使用了<a class="ae jd" href="https://codelabs.developers.google.com/codelabs/cloud-hello-istio/#0" rel="noopener ugc nofollow" target="_blank">这个伟大的codelab </a>。我想写代码实验室的人是邻居的粉丝。我不是在评判什么！</p><p id="0551" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码实验室向我介绍了四个主要的Istio控制平面组件:</p><ul class=""><li id="962c" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated"><em class="js">飞行员</em>:处理代理边车的配置和编程。</li><li id="8a2a" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><em class="js">混合器</em>:为你的流量处理政策决定，并收集遥测数据。</li><li id="5921" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><em class="js">入口</em>:处理来自集群外部的请求。</li><li id="fe47" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><em class="js"> CA </em>:认证机构。</li></ul><p id="faf7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查看<a class="ae jd" href="https://istio.io/docs/concepts/what-is-istio/overview.html#architecture" rel="noopener ugc nofollow" target="_blank"> Istio架构概念</a>页面，了解这些组件是如何结合在一起的</p><p id="4ce0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码实验室给了我关于<a class="ae jd" href="https://istio.io/docs/concepts/traffic-management/rules-configuration.html#route-rules" rel="noopener ugc nofollow" target="_blank">路线规则</a>——交通管理部分的实践</p><p id="ff87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我还尝试了一些来自Istio.io的各种任务，因为我需要了解它如何处理它被设计来处理的其他领域。</p><p id="1d66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提示:如果你在完成codelab后也决定离开piste，让你的集群保持运行。反正你最后只会再次使用它。</p><p id="5531" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我对它如何处理这些领域有一个初步的了解，但如果我使用像GKE这样的托管k8s设置(你知道我会选择它，不是吗？)Istio到底是怎么融入进来的？</p><p id="6f7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="js">注意:是的，这里有更多的细节，但我将重点放在我认为有助于我决定为什么需要使用Istio </em>的方面</p><p id="becd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">集群最终用户/开发者访问</strong></p><p id="877a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GKE使用了<a class="ae jd" href="https://cloud.google.com/kubernetes-engine/docs/how-to/iam-integration" rel="noopener ugc nofollow" target="_blank"> IAM </a>和<a class="ae jd" href="https://cloud.google.com/kubernetes-engine/docs/how-to/role-based-access-control" rel="noopener ugc nofollow" target="_blank"> RBAC </a>的组合，是的，有很多东西让你摸不着头脑。</p><p id="0908" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要授予集群用户比Cloud IAM更多的权限，您可以使用名称空间和RBAC来限制对特定pod的访问或排除对机密的访问。</p><p id="1066" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://istio.io/docs/concepts/security/rbac.html" rel="noopener ugc nofollow" target="_blank"> Istio RBAC </a>介绍了两个专注于服务的角色</p><ul class=""><li id="ad7a" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated"><strong class="ih hj"> ServiceRole </strong>定义访问网格中服务的角色。</li><li id="e0ce" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><strong class="ih hj"> ServiceRoleBinding </strong>向主体(如用户、组、服务)授予角色。</li></ul><p id="a038" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它们是K8s自定义资源定义(CRD)对象。而IAM还是一个你需要了解的东西。</p><h2 id="19a4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">服务身份</h2><p id="8e59" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">GKE可以使用服务帐户来管理在GKE上运行的应用程序可以使用的GCP服务。这些服务帐户的密钥作为机密存储。在pod中运行的进程的身份是<a class="ae jd" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/" rel="noopener ugc nofollow" target="_blank"> k8s服务帐户</a>(命名仅仅是为了搞笑&amp;我感觉到的笑声！)和RBAC一起。Istio使用<a class="ae jd" href="https://istio.io/docs/concepts/security/mutual-tls.html" rel="noopener ugc nofollow" target="_blank"> istio-auth </a>，它使用相互TLS提供强大的服务对服务和最终用户身份验证，具有内置的身份和凭证管理。Istio-auth使用k8s服务帐户</p><p id="6b77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">文件很好地解释了它是如何工作的，所以我在这里复制一个小小的架构图。去读与之相配的单词【T21:-)</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es kt"><img src="../Images/4b52d95b6cc89d5b1066fe0ab94642c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:534/0*gT-DsHMtK0VNInJq."/></div><figcaption class="lb lc et er es ld le bd b be z dx translated">原创建筑的微小图像</figcaption></figure><p id="ba2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Itsio不为使用GCP服务帐户提供任何帮助。现在还为时尚早，但它已经在未来发展的蓝图上了。</p><p id="5d7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Istio-auth很好，计划中的增强值得期待。我对安全复杂性感到不安，因为这不可避免地会导致配置错误，所以我希望服务帐户类型之间有更无缝的匹配！</p><h2 id="ec92" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">网络控制</h2><p id="c693" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">GKE(适用于k8s 1 . 7 . 6以上版本)使用<a class="ae jd" href="https://cloud.google.com/kubernetes-engine/docs/how-to/network-policy" rel="noopener ugc nofollow" target="_blank"> k8s网络策略</a>来管理哪些pod和服务可以进行通信。这种配置相对简单。Istio也有网络策略，但它们不是您所了解和喜爱的k8s策略，所以有什么区别，为什么两者都有？<a class="ae jd" href="https://istio.io/blog/2017/0.1-using-network-policy.html" rel="noopener ugc nofollow" target="_blank">这篇文章</a>很好地解释了这一点，所以我不会在这里重复推理，但是这个表格总结了两者的区别以及为什么你需要两者</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lf"><img src="../Images/75a8ef4da55a9387f367cf8fd2f132e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OefOZPx4kbxfcWK2."/></div></div></figure><p id="fef8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Istio使用特使作为边车代理。特使运行在OSI模型的应用层，因此在第7层..我在转述博客为你详细解释。</p><p id="2af7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你需要两种策略类型，这是深度防御方法</p><h2 id="632f" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">多个集群</h2><p id="7344" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">Istio有哪些比较小酷的是<a class="ae jd" href="https://istio.io/docs/concepts/policy-and-control/mixer.html#adapters" rel="noopener ugc nofollow" target="_blank">混音器适配器</a>。简而言之，它们从底层后端抽象出核心功能，如日志记录、监控、配额、ACL检查等等。它公开了一个一致的API，独立于使用中的后端。就像不管你使用什么存储类，GCS只公开一个API一样！</p><p id="a1c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我认为这张来自关于<a class="ae jd" href="https://istio.io/blog/2017/adapter-model.html" rel="noopener ugc nofollow" target="_blank">混音器适配器型号</a>的博文的图片在一张图片中抓住了混音器适配器的全部要点</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es lk"><img src="../Images/6097164773fc3e6ec71adbe5cdca5fec.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/0*Bdd76HtJB1suin0y."/></div></figure><p id="8f47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有一个<a class="ae jd" href="https://istio.io/docs/guides/integrating-vms.html" rel="noopener ugc nofollow" target="_blank">早期演示</a>，我认为这是istio潜力的最有用的功能之一，它实际上使用一个虚拟机来托管一个MySQL数据库，用于codelab中使用的评级数据库，并将其作为GKE集群所属网格的一部分。一网打尽(我知道我控制不住自己！)</p><h2 id="8755" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">交通管理</h2><p id="f08d" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">如果你做过codelab，你会发现使用istio通过路线规则来指挥交通是多么容易。使用K8s，您还可以使用canary部署进行流量管理，并以类似于istio的方式将一定比例的流量定向到应用程序的一个版本，但Istio在这种情况下更加灵活，它允许您设置细粒度的流量百分比，并使用代码实验室中的其他标准来控制流量。</p><h2 id="ae27" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">服务发现</h2><p id="d395" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">服务注册在k8s完成。Istio抽象了底层服务发现机制，并将它们整合成一种标准格式，可供envoy sidecars使用。</p><h2 id="79c7" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">审计日志记录和监控</h2><p id="1f25" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">除了GKE提供的标准日志记录之外，GKE还可以与<a class="ae jd" href="https://cloud.google.com/kubernetes-engine/docs/how-to/logging" rel="noopener ugc nofollow" target="_blank"> StackDriver Logging </a>集成，以收集、处理和存储关于集群中活动的<em class="js">容器日志</em>、<em class="js">系统日志</em>和<em class="js">事件</em>，例如pod的调度。您还可以与<a class="ae jd" href="https://cloud.google.com/kubernetes-engine/docs/how-to/monitoring" rel="noopener ugc nofollow" target="_blank"> StackDriver Monitoring </a>集成，以收集系统指标(集群基础设施的度量，如CPU或内存使用情况)和自定义指标(特定于应用程序的指标)。伊斯迪奥</p><p id="4beb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Istio使用prometheus进行记录和监控，并使用grafana作为仪表板。我喜欢<a class="ae jd" href="https://istio.io/docs/tasks/telemetry/servicegraph.html" rel="noopener ugc nofollow" target="_blank">服务图配置</a>，它为您提供了服务网格的图形化表示。您也可以通过kibana &amp; fluentd使用Elasticsearch</p><h2 id="492c" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">我需要Istio吗？</h2><p id="0d1c" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">Istio的流量管理非常好，混合器适配器模型使管理覆盖多个集群和虚拟机的网格变得容易。我喜欢Istio让您考虑服务，而不是太多的pod和节点，这并不是说您不必担心这些，而是谈论服务感觉很好！</p><p id="55f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你需要管理一个分布式集群，那么Istio应该在你的购物清单上。如果你需要比k8s更灵活的流量管理，Istio值得一试。</p><p id="e91c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你有资源去开发处于早期发展阶段的东西，那么尽早了解Istio是值得的。如果你已经在愤怒中使用k8s，那么学习曲线很低。</p><p id="4edb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请记住，这是一个覆盖，因此您仍然需要在k8s层做一些事情，例如配置k8s网络策略来补充istio网络策略。</p><p id="f501" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在还为时尚早，所以它还没有做到你所期望/希望的所有事情。您无法避免在提供者API和Istio之间切换，以完成一项完整的工作，因此这不是您所希望的单一窗口。</p><p id="a57f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仪表板将是很好的形象化的网格配置，因为YAML黑客会很快累了！是的，您可以使用您选择的仪表板应用程序设置仪表板以可视化指标，但我希望看到它与StackDriver集成</p><p id="ff41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以在了解了一些Istio之后，总体来说，我真的很喜欢它所承诺的。</p></div></div>    
</body>
</html>