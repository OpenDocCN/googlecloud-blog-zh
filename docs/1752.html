<html>
<head>
<title>Computing Time Series metrics at scale in Google Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在谷歌云中大规模计算时间序列指标</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/computing-time-series-metrics-at-scale-in-google-cloud-532ea4683e71?source=collection_archive---------1-----------------------#2021-01-13">https://medium.com/google-cloud/computing-time-series-metrics-at-scale-in-google-cloud-532ea4683e71?source=collection_archive---------1-----------------------#2021-01-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/4c0b24f6ecc05a94c724f71acf97c307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L0-e3LZKZwbcIvXjReRujg.jpeg"/></div></div></figure><p id="fe90" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇博客文章展示了数据科学家和工程师如何使用<a class="ae jo" href="https://cloud.google.com/dataflow" rel="noopener ugc nofollow" target="_blank"> GCP数据流</a>实时或批量计算时间序列指标，以大规模回填数据，例如<a class="ae jo" href="https://cloud.google.com/blog/products/data-analytics/anomaly-detection-using-streaming-analytics-and-ai" rel="noopener ugc nofollow" target="_blank">检测市场数据或物联网设备中的异常</a>。它在一个易于理解的Jupyter笔记本中比较了从外汇市场数据中得出的一些基本统计指标(移动平均数和标准差)，在<a class="ae jo" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> Python Pandas </a>和新的<a class="ae jo" href="https://github.com/GoogleCloudPlatform/dataflow-sample-applications/tree/master/timeseries-streaming" rel="noopener ugc nofollow" target="_blank"> Apache Beam时间序列库</a>之间。</p><h1 id="7534" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">我们要解决什么？</h1><p id="a68d" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">当提到<a class="ae jo" href="https://en.wikipedia.org/wiki/Time_series" rel="noopener ugc nofollow" target="_blank">时间序列</a>数据时，我们指的是按时间索引的数据点，因此基本上它们包括与我们想要生成的洞察或指标相关的时间戳。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/ecebe8489dcae89fc6dee96977884bb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XmyLRgxo0Ikv3FBmuThU_w.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">时间序列示例</figcaption></figure><p id="5b59" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们经常需要从这个时间索引数据点生成度量，也称为机器学习中的特征，用作我们预测或推理模型的输入。</p><p id="86f8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但在其他时候，这些相同的指标也与最终用户直接识别趋势或突变有关，这意味着企业希望快速识别趋势中的这些异常，以便能够利用它们(例如价格或客户需求变化)，或在它们成为问题之前识别风险(例如，网络攻击，如检测为网络<a class="ae jo" href="https://en.wikipedia.org/wiki/Denial-of-service_attack" rel="noopener ugc nofollow" target="_blank">拒绝服务攻击</a>准备的机器人)。</p><p id="74f4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这种情况下，<a class="ae jo" href="https://cloud.google.com/learn/what-is-streaming-analytics" rel="noopener ugc nofollow" target="_blank">流分析</a>旨在持续计算这些指标，因为数据从无限的来源流入系统，例如来自连接设备的遥测数据、客户使用web应用程序生成的日志文件、电子商务交易或来自社交网络或地理空间服务的信息。</p><h1 id="c1fb" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">我明白，但是挑战是什么？</h1><p id="5f9b" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">当您根据时间序列数据计算这些指标时，如移动平均值、标准偏差或其他类型的统计指标，您通常会面临以下挑战:</p><ul class=""><li id="1e75" class="lb lc hi is b it iu ix iy jb ld jf le jj lf jn lg lh li lj bi translated">作为一名用户，我希望能够实时计算这些指标，将这些指标应用到我的无界数据集中，而不是在回顾中计算这些指标，这样我就可以利用它们或几乎实时地识别风险。</li><li id="bebc" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">我经常需要拍摄这些指标的快照，我的意思是让所有的指标值在相同的时间段内“同步”计算。</li><li id="49e9" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">为了能够获得这些快照，我实际上需要并行和大规模地计算这些指标，以便在更多事件到来或添加更多指标时，我可以继续处理数据。</li><li id="3cf1" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">我还需要能够在没有接收到事件时填补空白，因为我不能暗示该值默认为0，这将影响我的一些统计计算，如移动平均值。</li><li id="2d5c" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">大规模计算历史上相同的指标，以便能够用新的指标回填您的数据，而且当我冷启动管道时，还可以引导这些指标缺少的输入数据。</li></ul><h1 id="fae9" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">嗯，那你怎么解决呢？</h1><p id="9566" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">当谈到实时获取指标时，我们在流分析框架中确实有可用的原语，如<a class="ae jo" href="https://beam.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Beam </a>，它提供了丰富的API，如<a class="ae jo" href="https://beam.apache.org/blog/timely-processing/" rel="noopener ugc nofollow" target="_blank">计时器</a>和<a class="ae jo" href="https://beam.apache.org/blog/looping-timers/" rel="noopener ugc nofollow" target="_blank">循环计时器</a>，允许实时处理时间序列数据——这个<a class="ae jo" href="https://github.com/GoogleCloudPlatform/dataflow-sample-applications/tree/master/timeseries-streaming" rel="noopener ugc nofollow" target="_blank">时间序列库</a>为您提供的是一组<a class="ae jo" href="https://github.com/GoogleCloudPlatform/dataflow-sample-applications/tree/master/timeseries-streaming#general-patterns" rel="noopener ugc nofollow" target="_blank">包装器</a>，用特殊的<a class="ae jo" href="https://github.com/GoogleCloudPlatform/dataflow-sample-applications/tree/master/timeseries-streaming#aggregations" rel="noopener ugc nofollow" target="_blank">聚合</a>和<a class="ae jo" href="https://github.com/GoogleCloudPlatform/dataflow-sample-applications/tree/master/timeseries-streaming#data-proto-objects" rel="noopener ugc nofollow" target="_blank">数据对象</a>封装这些原语， 因此，作为开发人员，您可以专注于业务价值，而不是试图学习和优化如何最好地使用这些原语。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es lp"><img src="../Images/9b96001dd84b2a71568711730703c2a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*i25PKUZMMT6FXbZawJaH3Q.png"/></div></figure><p id="20a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云</a>中的分布式计算解决了关于“同步”和并行地拍摄和计算所有这些指标的问题，通过分布在许多<a class="ae jo" href="https://cloud.google.com/dataflow" rel="noopener ugc nofollow" target="_blank"> GCP数据流</a>工人中的某些关键字来计算这些指标，然后在可扩展的汇中聚合结果，如GCP <a class="ae jo" href="https://cloud.google.com/pubsub" rel="noopener ugc nofollow" target="_blank"> Pubsub </a>或<a class="ae jo" href="https://cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank"> BigQuery </a>。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/105773324eaad13dfd3bbfb0cc174a1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*eTtD0-A8ezyQNu1t1ZhvaA.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx translated">谷歌数据流</figcaption></figure><p id="654b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个时间序列库还提供了当没有接收到事件时<a class="ae jo" href="https://github.com/GoogleCloudPlatform/dataflow-sample-applications/tree/master/timeseries-streaming#gap-filling" rel="noopener ugc nofollow" target="_blank">填充间隙</a>的机制，例如默认为最后一个已知值。</p><p id="efa7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后但同样重要的是，可以使用相同的构造来重新计算历史数据，以:</p><ul class=""><li id="65ae" class="lb lc hi is b it iu ix iy jb ld jf le jj lf jn lg lh li lj bi translated">回填历史数据集，例如，当添加新指标或稍后提供错过的历史事件时。</li><li id="29c4" class="lb lc hi is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj bi translated">但最重要的是，当冷启动一个流管道，用以前的事件给工人补水时。</li></ul><h1 id="5978" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">有什么你不知道的吗？</h1><p id="6f17" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">对于时间序列数据的批处理和追溯处理，有许多引擎和架构模式。<strong class="is hj"/><a class="ae jo" href="https://github.com/GoogleCloudPlatform/dataflow-sample-applications/tree/master/timeseries-streaming" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">这个时间序列库</strong> </a> <strong class="is hj">的主要目的是当数据不适合内存时，便于实时和大规模地计算这些指标，而不是专门关注批处理/大规模类型的计算。</strong></p><h1 id="5545" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">让我们看看！</h1><h2 id="d467" class="lr jq hi bd jr ls lt lu jv lv lw lx jz jb ly lz kd jf ma mb kh jj mc md kl me bi translated">设置</h2><p id="0da5" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在亲自尝试下面的部分之前，请到Github中的<a class="ae jo" href="https://github.com/GoogleCloudPlatform/dataflow-sample-applications/blob/master/timeseries-streaming/timeseries-python-applications/notebooks/Comparing_metrics_with_Pandas.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>来遵循先决条件和设置步骤。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="mf mg l"/></div></figure><h2 id="45be" class="lr jq hi bd jr ls lt lu jv lv lw lx jz jb ly lz kd jf ma mb kh jj mc md kl me bi translated">时间序列流框架中的计算</h2><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="mf mg l"/></div></figure><h2 id="338e" class="lr jq hi bd jr ls lt lu jv lv lw lx jz jb ly lz kd jf ma mb kh jj mc md kl me bi translated">熊猫的计算机</h2><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="mf mg l"/></div></figure><h2 id="1303" class="lr jq hi bd jr ls lt lu jv lv lw lx jz jb ly lz kd jf ma mb kh jj mc md kl me bi translated">比较结果</h2><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="mf mg l"/></div></figure><h2 id="f933" class="lr jq hi bd jr ls lt lu jv lv lw lx jz jb ly lz kd jf ma mb kh jj mc md kl me bi translated">填补空白</h2><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="mf mg l"/></div></figure><h1 id="9526" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">后续步骤</h1><p id="ec99" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">如上所述，尝试按照以下步骤运行<a class="ae jo" href="https://github.com/GoogleCloudPlatform/dataflow-sample-applications/blob/master/timeseries-streaming/timeseries-python-applications/notebooks/Comparing_metrics_with_Pandas.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>，以了解关于该库的更多信息以及它如何满足您的需求，例如为<a class="ae jo" href="https://cloud.google.com/blog/products/data-analytics/anomaly-detection-using-streaming-analytics-and-ai" rel="noopener ugc nofollow" target="_blank">异常检测</a>应用实时分析，如果有兴趣了解更多信息，也可以随时联系您的销售代表。</p><p id="72bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">欲了解更多关于此模式和其他参考模式的信息，请访问<a class="ae jo" href="https://cloud.google.com/solutions/smart-analytics/reference-patterns/overview#anomaly_detection" rel="noopener ugc nofollow" target="_blank">我们的GCP官方网站</a>。</p></div></div>    
</body>
</html>