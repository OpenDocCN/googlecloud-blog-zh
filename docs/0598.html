<html>
<head>
<title>Get object notification for Google cloud storage using pub/sub</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用发布/订阅获取Google云存储的对象通知</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/get-object-notification-for-google-cloud-storage-74187cf542c8?source=collection_archive---------0-----------------------#2018-05-09">https://medium.com/google-cloud/get-object-notification-for-google-cloud-storage-74187cf542c8?source=collection_archive---------0-----------------------#2018-05-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1b26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每当我们在谷歌云存储中存储数据时，很多时候我们的目标是获得bucket中每次变化的更新。可能是检索最近添加的文件，大小，时间戳等。对于这个云，发布/订阅通知允许您跟踪云存储对象的更改。</p><p id="8cd9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">订阅云发布/订阅通知是触发警报和操作以响应存储桶中的变化的通用方式。现在让我们看看如何滚动！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/c1efca9faa4e94905df0c97394f808a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LmcxWw9QBhC2ZgcD."/></div></div></figure><p id="cfab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，让我们快进一下这项任务的先决条件:</p><ol class=""><li id="974d" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">启用云<a class="ae jy" href="https://console.cloud.google.com/flows/enableapi?apiid=pubsub&amp;_ga=2.54338464.-928986593.1506334033" rel="noopener ugc nofollow" target="_blank">发布/订阅API </a></li><li id="8844" class="jp jq hi ih b ii jz im ka iq kb iu kc iy kd jc ju jv jw jx bi translated">拥有足够的bucket权限(如果您不拥有项目，请使用ACL或IAM &amp;分别拥有<a class="ae jy" href="https://cloud.google.com/storage/docs/access-control/lists#permissions" rel="noopener ugc nofollow" target="_blank">所有者权限</a>或<a class="ae jy" href="https://cloud.google.com/storage/docs/access-control/iam#permissions" rel="noopener ugc nofollow" target="_blank"> storage.buckets.update权限</a>。)</li><li id="4142" class="jp jq hi ih b ii jz im ka iq kb iu kc iy kd jc ju jv jw jx bi translated">有足够的权限访问发布/订阅主题</li></ol><p id="3371" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">潜入主场景！希望你有准备这道菜所需的所有材料..</p><ol class=""><li id="45bf" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">让我们创建一个存储桶:</li></ol><pre class="je jf jg jh fd ke kf kg kh aw ki bi"><span id="1d64" class="kj kk hi kf b fi kl km l kn ko">gsutil mb gs://[UNIQUE_BUCKET_NAME]</span></pre><p id="d2df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.创建一个云发布/订阅主题，并将其绑定到我们的GCS bucket:</p><pre class="je jf jg jh fd ke kf kg kh aw ki bi"><span id="e96a" class="kj kk hi kf b fi kl km l kn ko">gsutil notification create -t [TOPIC_NAME] -f json -e OBJECT_FINALIZE gs://[BUCKET_NAME]</span></pre><p id="9c77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kp kq kr kf b">-t</code>指定发布/订阅主题</p><p id="bc4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kp kq kr kf b">-f</code>指定您希望消息的有效负载作为JSON API中的对象获得。</p><p id="abd9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您也可以使用<code class="du kp kq kr kf b">-e</code>指定其他事件类型</p><p id="f09d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.现在让我们创建一个发布/订阅订阅:</p><pre class="je jf jg jh fd ke kf kg kh aw ki bi"><span id="5bde" class="kj kk hi kf b fi kl km l kn ko">gcloud beta pubsub subscriptions create [SUBSCRIPTION_NAME] --topic=[TOPIC_NAME]</span></pre><p id="2310" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太好了！我们一切都准备好了，杰克！只需要读那些信息。这是我在任务中使用的<a class="ae jy" href="https://github.com/GoogleCloudPlatform/python-docs-samples/blob/master/storage/cloud-client/notification_polling.py" rel="noopener ugc nofollow" target="_blank">样本</a>。</p><p id="005e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你准备好品尝这道菜了吗？这就对了。以下列身份运行脚本:</p><pre class="je jf jg jh fd ke kf kg kh aw ki bi"><span id="0a25" class="kj kk hi kf b fi kl km l kn ko">python [SCRIPT_NAME].py [PROJECT_ID] [SUBSCRIPTION_NAME]</span></pre><p id="de40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并尝试在bucket上进行一些冒险，您应该会得到如下输出:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ks"><img src="../Images/288a93c260a05dfc2b3ba5a335c958fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*snuTtftT5vqZeJBAq45PPw.jpeg"/></div></div></figure><p id="6704" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">如何处理这些事件通知？</strong></p><p id="40d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是个聪明的问题！因此，您可以检索该发布/订阅消息，并将其添加到您的应用程序中，通过电子邮件等方式获得通知。看看这个例子，它给出了关于<a class="ae jy" href="https://cloud.google.com/community/tutorials/use-cloud-pubsub-cloud-storage-app-engine" rel="noopener ugc nofollow" target="_blank">通过应用引擎</a>使用发布/订阅通知的合理想法。</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><p id="e705" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一篇文章中，我将分享如何使用云函数来完成同样的任务。在那之前，祝你生活愉快！</p></div></div>    
</body>
</html>