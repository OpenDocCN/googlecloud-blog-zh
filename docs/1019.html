<html>
<head>
<title>Continuous Delivery of HashiCorp Vault on Google Kubernetes Engine:Backup &amp; Recovery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Google Kubernetes引擎上持续交付HashiCorp Vault:备份和恢复</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/continuous-delivery-of-hashicorp-vault-on-google-kubernetes-engine-backup-recovery-725e5e1f6b48?source=collection_archive---------0-----------------------#2019-06-03">https://medium.com/google-cloud/continuous-delivery-of-hashicorp-vault-on-google-kubernetes-engine-backup-recovery-725e5e1f6b48?source=collection_archive---------0-----------------------#2019-06-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c4fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">这是一个系列的第8部分:</strong> <a class="ae jd" rel="noopener" href="/@blzysh/continuous-delivery-of-hashicorp-vault-on-google-kubernetes-engine-bcbf4e75f0f6"> <strong class="ih hj">指数</strong> </a></p><h1 id="0f90" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">概观</h1><p id="f4d5" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">为了备份GCS数据，我们启用了<a class="ae jd" href="https://cloud.google.com/storage/docs/object-versioning" rel="noopener ugc nofollow" target="_blank">对象版本控制</a>，这将允许我们将单个对象恢复到以前的版本。</p><p id="1480" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用gsutil查看版本:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="5c4f" class="kq jf hi km b fi kr ks l kt ku">gsutil ls -lra gs://<!-- -->ops-bcurtis-sb<!-- -->-vault-storage/core/mounts</span><span id="f618" class="kq jf hi km b fi kv ks l kt ku">617  2018-10-11T02:05:26Z  gs://<!-- -->ops-bcurtis-sb<!-- -->-vault-storage/core/mounts#1539223526242045  metageneration=1<br/>690  2018-10-11T02:05:26Z  gs://<!-- -->ops-bcurtis-sb<!-- -->-vault-storage/core/mounts#1539223526479479  metageneration=1<br/>771  2018-10-29T18:50:20Z  gs://<!-- -->ops-bcurtis-sb<!-- -->-vault-vault-storage/core/mounts#1540839020037493  metageneration=1<br/>TOTAL: 3 objects, 2078 bytes (2.03 KiB)</span></pre><p id="397a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以看到该文件的三个版本，任何一个都可以使用copy恢复:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="7b52" class="kq jf hi km b fi kr ks l kt ku">gsutil cp gs://<!-- -->ops-bcurtis-sb<!-- -->-vault-storage/core/mounts#15392235262<br/>42045 gs://<!-- -->ops-bcurtis-sb<!-- -->-vault-storage/core/mounts<br/>Copying gs://<!-- -->ops-bcurtis-sb<!-- -->-vault-storage/core/mounts#1539223526242045 [Content-Type=application/octet-stream]...<br/>/ [1 files][  617.0 B/  617.0 B]</span></pre><p id="8e97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，您可以看到现在有四个版本:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="3588" class="kq jf hi km b fi kr ks l kt ku">gsutil ls -lra gs://<!-- -->ops-bcurtis-sb<!-- -->-vault-storage/core/mounts<br/>617  2018-10-11T02:05:26Z  gs://<!-- -->ops-bcurtis-sb<!-- -->-vault-storage/core/mounts#1539223526242045  metageneration=1<br/>690  2018-10-11T02:05:26Z  gs://<!-- -->ops-bcurtis-sb<!-- -->-vault-storage/core/mounts#1539223526479479  metageneration=1<br/>771  2018-10-29T18:50:20Z  gs://<!-- -->ops-bcurtis-sb<!-- -->-vault-storage/core/mounts#1540839020037493  metageneration=1<br/>617  2018-12-04T14:50:46Z  gs://<!-- -->ops-bcurtis-sb<!-- -->-vault-storage/core/mounts#1543935046514223  metageneration=1<br/>TOTAL: 4 objects, 2695 bytes (2.63 KiB)</span></pre><p id="9a1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://cloud.google.com/storage-transfer/docs/overview" rel="noopener ugc nofollow" target="_blank">云存储转移服务</a>用于将云存储桶从源项目备份到目的备份项目ops-bcurtis-sb-vault-backup。每天早上8:00运行。如果您正在进行升级或其他可能对数据存储产生负面影响的操作，您可以禁用传输作业，这样就不会同步坏数据。一旦事情得到验证，再次启用同步</p><p id="0e5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们不小心删除了KMS密钥，会有一个小的恢复窗口，我们可以立即联系我们的TAM/支持代表。</p><h1 id="1904" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">恢复</h1><h1 id="c4c4" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">数据存储(谷歌云存储)</h1><p id="b33e" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">为了恢复，我们可以在备份云存储桶和目标保管库存储桶之间运行rsync:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="b299" class="kq jf hi km b fi kr ks l kt ku">gstuil rsync -r gs://SOURCE_BUCKET_NAME gs://DESTINATION_BUCKET_NAME</span></pre><h1 id="c78b" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">项目被破坏</h1><p id="d174" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">为了从意外破坏或导致谷歌云项目不可用或丢失的事件中恢复，我们需要联系谷歌支持来恢复KMS密钥。然后，您需要构建一个新的环境(切换到恢复的密钥)并如上所述同步所有内容。</p></div></div>    
</body>
</html>