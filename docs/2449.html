<html>
<head>
<title>Building and deploying Java 17 apps on Cloud Run with cloud native buildpacks on Temurin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åœ¨äº‘ä¸Šæ„å»ºå’Œéƒ¨ç½²Java 17åº”ç”¨ä½¿ç”¨Temurinä¸Šçš„äº‘åŸç”Ÿæ„å»ºåŒ…è¿è¡Œ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/google-cloud/building-and-deploying-java-17-apps-on-cloud-run-with-cloud-native-buildpacks-on-temurin-ed56586cc764?source=collection_archive---------1-----------------------#2022-10-24">https://medium.com/google-cloud/building-and-deploying-java-17-apps-on-cloud-run-with-cloud-native-buildpacks-on-temurin-ed56586cc764?source=collection_archive---------1-----------------------#2022-10-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a467" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œè®©æˆ‘ä»¬é‡æ¸©ä¸€ä¸‹åœ¨<a class="ae jd" href="https://cloud.run/" rel="noopener ugc nofollow" target="_blank">äº‘è¿è¡Œ</a>ä¸Šéƒ¨ç½²Javaåº”ç”¨çš„ä¸»é¢˜ã€‚ç‰¹åˆ«æ˜¯æˆ‘ä¼šéƒ¨ç½²ä¸€ä¸ª<a class="ae jd" href="https://micronaut.io/" rel="noopener ugc nofollow" target="_blank"> Micronaut </a> appï¼Œç”¨<a class="ae jd" href="https://jdk.java.net/17/" rel="noopener ugc nofollow" target="_blank"> Java 17 </a> (Adoptiumçš„Temurin)ç¼–å†™ï¼Œç”¨<a class="ae jd" href="https://gradle.org/" rel="noopener ugc nofollow" target="_blank"> Gradle </a>æ„å»ºã€‚</p><p id="814f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">å¸¦è‡ªå®šä¹‰Dockerfileæ–‡ä»¶</strong></p><p id="9d00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨Cloud Runä¸Šï¼Œæ‚¨éƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºï¼Œå› æ­¤æ‚¨å¿…é¡»å†³å®šæ‚¨æƒ³è¦ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæ„å»ºå®¹å™¨çš„æ–¹å¼ã€‚åœ¨<a class="ae jd" href="https://glaforge.appspot.com/article/start-the-fun-with-java-14-and-micronaut-inside-serverless-containers-on-cloud-run" rel="noopener ugc nofollow" target="_blank">ä»¥å‰çš„æ–‡ç« </a>ä¸­ï¼Œæˆ‘å±•ç¤ºäº†ä¸€ä¸ªä½¿ç”¨æ‚¨è‡ªå·±çš„Dockerfileçš„ä¾‹å­ï¼Œå¯¹äºOpenJDK 17çœ‹èµ·æ¥å¦‚ä¸‹ï¼Œå¹¶å¯ç”¨äº†è¯¥è¯­è¨€çš„é¢„è§ˆåŠŸèƒ½:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="e431" class="jn jo hi jj b fi jp jq l jr js">FROM openjdk:17<br/>WORKDIR /app<br/>COPY ./ ./<br/>RUN ./gradlew shadowJar<br/>EXPOSE 8080<br/>CMD ["java", " - enable-preview", "-jar", "build/libs/app-0.1-all.jar"]</span></pre><p id="9033" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸ºäº†è¿›ä¸€æ­¥æ”¹è¿›Dockeræ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¤šçº§Dockeræ„å»ºå™¨ï¼Œé¦–å…ˆç”¨Gradleåœ¨ä¸€ä¸ªæ­¥éª¤ä¸­æ„å»ºåº”ç”¨ç¨‹åºï¼Œç„¶ååœ¨ç¬¬äºŒä¸ªæ­¥éª¤ä¸­è¿è¡Œå®ƒã€‚æ­¤å¤–ï¼Œç”±äºJARæ–‡ä»¶åæ˜¯ç¡¬ç¼–ç çš„ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å°†å‘½ä»¤å‚æ•°åŒ–ã€‚</p><p id="4cdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¦æ„å»ºæ˜ åƒï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Dockeråœ¨æœ¬åœ°æ„å»ºå®ƒï¼Œç„¶åå°†å…¶æ¨é€åˆ°å®¹å™¨æ³¨å†Œè¡¨ï¼Œç„¶åéƒ¨ç½²å®ƒ:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="75b7" class="jn jo hi jj b fi jp jq l jr js"># gcloud auth configure-docker<br/># gcloud components install docker-credential-gcr</span><span id="9429" class="jn jo hi jj b fi jt jq l jr js">docker build . - tag gcr.io/YOUR_PROJECT_ID/IMAGE_NAME<br/>docker push gcr.io/YOUR_PROJECT_ID/IMAGE_NAME</span><span id="9c56" class="jn jo hi jj b fi jt jq l jr js">gcloud run deploy myservice \<br/>       -image gcr.io/YOUR_PROJECT_ID/IMAGE_NAME</span></pre><p id="dd87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">é™¤äº†ä½¿ç”¨Dockeråœ¨æœ¬åœ°æ„å»ºï¼Œæ‚¨è¿˜å¯ä»¥è®©<a class="ae jd" href="https://cloud.google.com/build" rel="noopener ugc nofollow" target="_blank">äº‘æ„å»º</a>ä¸ºæ‚¨å®Œæˆ:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="fbfc" class="jn jo hi jj b fi jp jq l jr js">gcloud builds submit . - tag gcr.io/YOUR_PROJECT_ID/SERVICE_NAME</span></pre><p id="1cbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">å¸¦èµ·é‡è‡‚</strong></p><p id="33c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">é™¤äº†ä½¿ç”¨Dockerfilesï¼Œæ‚¨è¿˜å¯ä»¥è®©<a class="ae jd" href="https://github.com/GoogleContainerTools/jib" rel="noopener ugc nofollow" target="_blank"> JIB </a>ä¸ºæ‚¨åˆ›å»ºå®¹å™¨ï¼Œå°±åƒæˆ‘åœ¨<a class="ae jd" href="https://glaforge.appspot.com/article/running-micronaut-serverlessly-on-google-cloud-platform" rel="noopener ugc nofollow" target="_blank">å¦ä¸€ç¯‡æ–‡ç« </a>ä¸­å†™çš„é‚£æ ·ã€‚æ‚¨é…ç½®Gradleä½¿ç”¨JIBæ’ä»¶:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="ae6b" class="jn jo hi jj b fi jp jq l jr js">plugins {<br/>    â€¦<br/>    id â€œcom.google.cloud.tools.jibâ€ version â€œ2.8.0â€<br/>}<br/>â€¦<br/>tasks {<br/>    jib {<br/>       from {<br/>          image = â€œgcr.io/distroless/java17-debian11â€<br/>       }<br/>       to {<br/>          image = â€œgcr.io/YOUR_PROJECT_ID/SERVICE_NAMEâ€<br/>       }<br/>    }<br/>}</span></pre><p id="4b69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‚¨æŒ‡å®šäº†æ’ä»¶çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯æ‚¨ä¹Ÿé€šè¿‡é€‰æ‹©å…·æœ‰ç›¸åŒç‰ˆæœ¬çš„åŸºç¡€æ˜ åƒæ¥è¡¨æ˜æ‚¨æƒ³è¦ä½¿ç”¨Java 17ã€‚è¯·ç¡®ä¿æ›´æ”¹é¡¹ç›®IDå’ŒæœåŠ¡åç§°çš„å ä½ç¬¦ã€‚è¯·éšæ„æŸ¥é˜…å…³äºJIB Gradleæ’ä»¶çš„<a class="ae jd" href="https://github.com/GoogleContainerTools/jib/tree/master/jib-gradle-plugin" rel="noopener ugc nofollow" target="_blank">æ–‡æ¡£</a>ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥è®©Gradleç”¨ã€‚/gradlew jibï¼Œæˆ–ä¸ã€‚/gradlew jibDockerBuildï¼Œå¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨æœ¬åœ°Dockerå®ˆæŠ¤ç¨‹åºã€‚</p><p id="8f29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">é‡‡ç”¨äº‘åŸç”Ÿæ„å»ºåŒ…</strong></p><p id="3062" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨æˆ‘ä»¬å·²ç»è®¨è®ºäº†å…¶ä»–æ–¹æ³•ï¼Œè®©æˆ‘ä»¬æ¥å…³æ³¨ä½¿ç”¨<a class="ae jd" href="https://buildpacks.io/" rel="noopener ugc nofollow" target="_blank">äº‘æœ¬åœ°æ„å»ºåŒ…</a>æ¥ä»£æ›¿ï¼Œç‰¹åˆ«æ˜¯<a class="ae jd" href="https://github.com/GoogleCloudPlatform/buildpacks" rel="noopener ugc nofollow" target="_blank">è°·æ­Œäº‘æœ¬åœ°æ„å»ºåŒ…</a>ã€‚æœ‰äº†buildpacksï¼Œæ‚¨å°±ä¸å¿…åœ¨éƒ¨ç½²æœåŠ¡ä¹‹å‰ä¸ºdockeræ–‡ä»¶æˆ–æ„å»ºå®¹å™¨è€Œçƒ¦æ¼äº†ã€‚æ‚¨è®©Cloud Runä½¿ç”¨buildpacksä»æºä»£ç æ„å»ºã€å°è£…å’Œéƒ¨ç½²æ‚¨çš„åº”ç”¨ç¨‹åºã€‚</p><p id="c421" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¼€ç®±å³ç”¨ï¼Œbuildpackå®é™…ä¸Šæ˜¯é’ˆå¯¹Java 8æˆ–Java 11çš„ã€‚ä½†æˆ‘å¯¹ç”¨Java 17è¿è¡ŒJavaçš„æœ€æ–°LTSç‰ˆæœ¬æ„Ÿå…´è¶£ï¼Œä»¥ä¾¿åˆ©ç”¨ä¸€äº›é¢„è§ˆåŠŸèƒ½ï¼Œå¦‚è®°å½•ã€å¯†å°ç±»ã€å¼€å…³è¡¨è¾¾å¼ç­‰ã€‚</p><p id="e851" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨æˆ‘çš„Gradle buildä¸­ï¼Œæˆ‘æŒ‡å®šæˆ‘ä½¿ç”¨çš„æ˜¯Java 17ï¼Œä½†ä¹Ÿå¯ç”¨äº†é¢„è§ˆåŠŸèƒ½:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="e8ee" class="jn jo hi jj b fi jp jq l jr js">java {<br/>    toolchain {<br/>        languageVersion.set(JavaLanguageVersion.of(17))<br/>    }<br/>}</span></pre><p id="f2ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å°±åƒå¡å¾·é‡Œå…‹Â·å°šçš®ä¹Œæ–¯åœ¨<a class="ae jd" href="https://melix.github.io/blog/2020/06/java-feature-previews-gradle.html" rel="noopener ugc nofollow" target="_blank">çš„åšå®¢æ–‡ç« </a>ä¸­æ‰€è¯´çš„é‚£æ ·ï¼Œè¦å¯ç”¨é¢„è§ˆåŠŸèƒ½ï¼Œä½ è¿˜åº”è¯¥å‘Šè¯‰æ ¼é›·å°”ä½ æƒ³è®©å®ƒä»¬æ‰§è¡Œç¼–è¯‘ã€æµ‹è¯•å’Œæ‰§è¡Œä»»åŠ¡:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="5fe5" class="jn jo hi jj b fi jp jq l jr js">tasks.withType(JavaCompile).configureEach {<br/>    options.compilerArgs.add(â€œ--enable-previewâ€)<br/>}</span><span id="21f0" class="jn jo hi jj b fi jt jq l jr js">tasks.withType(Test).configureEach {<br/>    useJUnitPlatform()<br/>    jvmArgs(â€œ--enable-previewâ€)<br/>}</span><span id="b013" class="jn jo hi jj b fi jt jq l jr js">tasks.withType(JavaExec).configureEach {<br/>    jvmArgs(â€œ â€” enable-previewâ€)<br/>}</span></pre><p id="4fac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åˆ°ç›®å‰ä¸ºæ­¢è¿˜ä¸é”™ï¼Œä½†æ˜¯æ­£å¦‚æˆ‘æ‰€è¯´çš„ï¼Œé»˜è®¤çš„æœ¬æœºbuildpackæ²¡æœ‰ä½¿ç”¨Java 17ï¼Œæˆ‘æƒ³æŒ‡å®šæˆ‘ä½¿ç”¨é¢„è§ˆåŠŸèƒ½ã€‚å› æ­¤ï¼Œå½“æˆ‘è¯•å›¾ä½¿ç”¨buildpackä»æºä»£ç ä¸­éƒ¨ç½²æˆ‘çš„äº‘è¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼Œåªéœ€è¿è¡Œgcloud deployå‘½ä»¤ï¼Œæˆ‘å°±ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="f75a" class="jn jo hi jj b fi jp jq l jr js">gcloud beta run deploy SERVICE_NAME</span></pre><p id="006a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å¿…é¡»æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä»¥æŒ‡ç¤ºbuildpackä½¿ç”¨Java 17ã€‚æˆ‘åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªproject.tomlæ–‡ä»¶:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="1f7f" class="jn jo hi jj b fi jp jq l jr js">[[build.env]]<br/>name = â€œGOOGLE_RUNTIME_VERSIONâ€<br/>value = â€œ17â€<br/>[[build.env]]<br/>name = â€œGOOGLE_ENTRYPOINTâ€<br/>value = â€œjava â€” enable-preview -jar /workspace/build/libs/app-0.1-all.jarâ€</span></pre><p id="af4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘æŒ‡å®šè¿è¡Œæ—¶ç‰ˆæœ¬å¿…é¡»ä½¿ç”¨Java 17ã€‚ä½†æ˜¯æˆ‘è¿˜æ·»åŠ äº†â€” enable-previewæ ‡å¿—ï¼Œä»¥ä¾¿åœ¨è¿è¡Œæ—¶å¯ç”¨é¢„è§ˆåŠŸèƒ½ã€‚</p><p id="55bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">é‡‡ç”¨ç»ˆç«¯æ‰“å¼€JDK 17 </strong></p><p id="8e17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">é”¦ä¸Šæ·»èŠ±çš„æ˜¯ï¼Œè¿™ä¸ªç‰ˆæœ¬ä½¿ç”¨çš„æ˜¯OpenJDK 17çš„Adoptiumç‰ˆæœ¬ï¼Œæ­£å¦‚æˆ‘ä»¬æœ€è¿‘å®£å¸ƒçš„ï¼å¦‚æœæ‚¨æŸ¥çœ‹äº‘æ„å»ºä¸­çš„æ„å»ºæ—¥å¿—ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€äº›æåˆ°å®ƒçš„è¾“å‡ºï¼Œæ¯”å¦‚:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="b4ef" class="jn jo hi jj b fi jp jq l jr js">{<br/>    "link": "<a class="ae jd" href="https://github.com/adoptium/temurin17-binaries/releases/download/jdk-17.0.4.1%2B1/OpenJDK17U-jdk-sources_17.0.4.1_1.tar.gz" rel="noopener ugc nofollow" target="_blank">https://github.com/adoptium/temurin17-binaries/releases/download/jdk-17.0.4.1%2B1/OpenJDK17U-jdk-sources_17.0.4.1_1.tar.gz</a>",<br/>    "name": "OpenJDK17U-jdk-sources_17.0.4.1_1.tar.gz",<br/>    "size": 105784017<br/>}</span></pre><p id="9113" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¥½æ ·çš„ã€‚Java 17 Micronaut appï¼Œéƒ¨ç½²åœ¨äº‘Runä¸Šçš„Temurinå¤šäºäº†äº‘åŸç”Ÿbuildpacksï¼æˆ‘èµ¢äº†æ—¶é«¦çš„å®¾æœæ¸¸æˆğŸ™‚</p></div></div>    
</body>
</html>