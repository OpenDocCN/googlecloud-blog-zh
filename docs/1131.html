<html>
<head>
<title>Deconstructing Chatbots: How to integrate Dialogflow with BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解构聊天机器人:如何集成Dialogflow和BigQuery</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/deconstructing-chatbots-how-to-integrate-dialogflow-with-bigquery-267b68f4e795?source=collection_archive---------0-----------------------#2019-08-31">https://medium.com/google-cloud/deconstructing-chatbots-how-to-integrate-dialogflow-with-bigquery-267b68f4e795?source=collection_archive---------0-----------------------#2019-08-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/8975ea4082bf25feac40600b5df3b456.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MURSwMzWpbJt5pTV.png"/></div></div></figure><div class=""/><h1 id="ee4f" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">介绍</h1><p id="64fe" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在本文中，我们将了解Dialogflow如何连接BigQuery并存储在对话过程中收集的信息。我们将使用我们在<a class="ae km" rel="noopener" href="/@pvergadia/deconstructing-chatbots-build-an-appointment-scheduler-with-dialogflow-2ee08614b630">之前的实验</a><a class="ae km" href="https://www.youtube.com/watch?v=oU88sHd6ilE&amp;list=PLIivdWyY5sqK5SM34zbkitWLOV-b3V40B&amp;index=4" rel="noopener ugc nofollow" target="_blank">预约调度</a>中创建的相同代理。在代理的GCP项目中，我们将在BigQuery中创建一个数据集和一个表。然后，我们将使用BigQuery数据集和表id编辑原始实现。最后，我们将测试交互是否被记录在BigQuery中。</p><p id="c817" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">下面是从用户到实现和BigQuery的事件序列图。</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ks"><img src="../Images/d6343961eae7d0625c6407e53c0213dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3a8Yb0S9Ug0u1qOt4kbEyQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">Dialogflow BigQuery集成</figcaption></figure><h1 id="87c0" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">你会学到什么</h1><ul class=""><li id="1686" class="lb lc ht jq b jr js jv jw jz ld kd le kh lf kl lg lh li lj bi translated">如何在BigQuery中创建数据集和表</li><li id="c6f5" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">如何在Dialogflow fulfillment中设置BigQuery连接详细信息。</li><li id="652c" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">如何测试履行情况</li></ul><h1 id="310b" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">先决条件</h1><ul class=""><li id="3e3a" class="lb lc ht jq b jr js jv jw jz ld kd le kh lf kl lg lh li lj bi translated">对话流的基本概念和结构。对于介绍基本对话设计的Dialogflow教程视频，请查看<a class="ae km" href="https://www.youtube.com/watch?v=O00K10xP5MU&amp;list=PLIivdWyY5sqK5SM34zbkitWLOV-b3V40B&amp;index=1" rel="noopener ugc nofollow" target="_blank"> <em class="lp">解构聊天机器人系列</em> </a>。</li><li id="67e7" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">正如我前面提到的，我们将使用我们在本文中构建的相同的“<em class="lp">约会调度器</em>”聊天机器人，并添加与BigQuery的集成。</li><li id="c338" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">另外，请阅读“<a class="ae km" rel="noopener" href="/google-cloud/deconstructing-chatbots-understanding-fulfillment-by-integrating-dialogflow-with-google-calendar-dde40a3856ff"> <em class="lp">解构聊天机器人:通过将Dialogflow与Google Calendar </em> </a>”文章，了解Dialogflow fulfillment的一些背景知识。</li><li id="7fcd" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">如果你想看这个视频，可以看看这个视频</li></ul><figure class="kt ku kv kw fd hk"><div class="bz dy l di"><div class="lq lr l"/></div><figcaption class="kx ky et er es kz la bd b be z dx translated">将Dialogflow与BigQuery集成</figcaption></figure><h1 id="0be2" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">步骤1:在BigQuery中创建数据集和表</h1><ul class=""><li id="a095" class="lb lc ht jq b jr js jv jw jz ld kd le kh lf kl lg lh li lj bi translated">导航到<a class="ae km" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云控制台</a></li><li id="aaee" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">在云控制台中，转到菜单图标☰&gt;大数据&gt;大查询</li><li id="9623" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">在左侧窗格的Resources下，单击项目ID，一旦选中，您将在右侧看到CREATE DATASET</li><li id="5026" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">点击创建数据集并命名。</li></ul><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ls"><img src="../Images/43a164106ee1c2f98a911025c927e5b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x_QrQCKATkNkWv8YV9wfCw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">BigQuery中的数据集</figcaption></figure><ul class=""><li id="4db2" class="lb lc ht jq b jr kn jv ko jz lt kd lu kh lv kl lg lh li lj bi translated">创建数据集后，在左侧面板中单击它。您将在右侧看到创建表。</li><li id="790c" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">单击创建表格，提供表格名称，然后单击屏幕底部的创建表格。</li></ul><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lw"><img src="../Images/ad9dc2d12865b1c561b8709a703c7c5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FpNpgmbfljHzcv5ZL0iZHg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">在BigQuery中创建表</figcaption></figure><ul class=""><li id="27b0" class="lb lc ht jq b jr kn jv ko jz lt kd lu kh lv kl lg lh li lj bi translated">创建表格后，单击左侧面板中的表格。您将在右侧看到“<em class="lp">编辑模式”</em>按钮。</li><li id="438a" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">单击“编辑模式”按钮，然后单击“添加字段”按钮。添加“<em class="lp">日期</em>字段，对“<em class="lp">时间</em>”和“<em class="lp">类型</em>”重复相同的操作。</li><li id="cb15" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">注意"<em class="lp"> DatasetID" </em>和"<em class="lp"> tableID" </em></li></ul><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lx"><img src="../Images/603fcfb829ad25a2444337e05953c77d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OGAYQAx_cQ-J3HllemrW1w.png"/></div></div></figure><h1 id="672f" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">步骤2:将BigQuery连接详细信息添加到Dialogflow实现</h1><ul class=""><li id="ff0e" class="lb lc ht jq b jr js jv jw jz ld kd le kh lf kl lg lh li lj bi translated">打开Dialogflow代理并启用实现内嵌编辑器。如果你需要这方面的帮助，请参考<a class="ae km" rel="noopener" href="/google-cloud/deconstructing-chatbots-understanding-fulfillment-by-integrating-dialogflow-with-google-calendar-dde40a3856ff">上一篇文章</a>。</li><li id="f6ec" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">确保Dialogflow fulfillment行内编辑器中的“<em class="lp">package . JSON”</em>包含BigQuery依赖项。<em class="lp">“@ Google-cloud/big query”:“0 . 12 . 0”。</em>确保您在阅读本文时使用的是最新版本的BigQuery。</li><li id="d6a2" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">在index.js中创建"<em class="lp"> addToBigQuery </em>"函数，在BigQuery表中添加日期、时间和约会类型。</li><li id="c6b5" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">在index.js文件的TODO部分添加<em class="lp"> projectID </em>、<em class="lp"> datasetID </em>和<em class="lp"> tableID </em>，以将您的BigQuery表和数据集正确连接到您的实现。</li></ul><figure class="kt ku kv kw fd hk"><div class="bz dy l di"><div class="ly lr l"/></div><figcaption class="kx ky et er es kz la bd b be z dx translated">索引. js</figcaption></figure><h2 id="6422" class="lz ir ht bd is ma mb mc iw md me mf ja jz mg mh je kd mi mj ji kh mk ml jm mm bi translated">事件顺序:</h2><ul class=""><li id="e090" class="lb lc ht jq b jr js jv jw jz ld kd le kh lf kl lg lh li lj bi translated">意图地图调用“<em class="lp">make appointment”</em>函数在Google日历上安排约会</li><li id="1856" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">在同一个函数中，调用“<em class="lp"> addToBigQuery </em>”函数来发送要记录到BigQuery中的数据。</li></ul><h1 id="c43d" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">步骤3:测试你的聊天机器人和BigQuery表！</h1><p id="aeb1" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">让我们来测试我们的聊天机器人，你可以在模拟器中测试它，或者使用我们在以前的文章中学到的网络或google home集成。</p><ul class=""><li id="54a5" class="lb lc ht jq b jr kn jv ko jz lt kd lu kh lv kl lg lh li lj bi translated">用户:“明天下午2点预约车辆登记”</li><li id="f24f" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">聊天机器人回应:“好吧，让我看看我们是否能把你安排进去。8月6日下午2点可以！."</li><li id="4de0" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">响应后检查BigQuery表。使用查询"<em class="lp">SELECT * FROM ` projectid . datasetid . tableid `</em>"</li></ul><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mn"><img src="../Images/40cd63801eb2ef886c5ac63b37e73ea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*31cUyghabdnR-k1lnoCWDg.png"/></div></div></figure><h1 id="e45b" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">恭喜你！</h1><p id="add3" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">您使用inline editor创建了一个实现，并将其与BigQuery集成在一起。想出更多这样的集成，并尝试它们！</p><h1 id="91fe" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">后续步骤</h1><ul class=""><li id="2016" class="lb lc ht jq b jr js jv jw jz ld kd le kh lf kl lg lh li lj bi translated">点击查看Dialogflow网站<a class="ae km" href="https://cloud.google.com/dialogflow-enterprise/" rel="noopener ugc nofollow" target="_blank">获取文档、API和更多集成。</a></li><li id="6b40" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">关注<a class="ae km" href="https://www.youtube.com/watch?v=O00K10xP5MU&amp;list=PLIivdWyY5sqK5SM34zbkitWLOV-b3V40B&amp;index=1" rel="noopener ugc nofollow" target="_blank">解构聊天机器人</a>视频系列，订阅谷歌云平台youtube频道</li><li id="ad7b" class="lb lc ht jq b jr lk jv ll jz lm kd ln kh lo kl lg lh li lj bi translated">试试<a class="ae km" href="https://dialogflow.com/" rel="noopener ugc nofollow" target="_blank"> Dialogflow </a>，是<strong class="jq hu">免费</strong>造一个bot！看看这个。</li></ul></div></div>    
</body>
</html>