<html>
<head>
<title>Google Cloud Serverless technology never sleep</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云无服务器技术永不休眠</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-cloud-serverless-technology-never-sleep-8a2e5e97f789?source=collection_archive---------0-----------------------#2022-05-16">https://medium.com/google-cloud/google-cloud-serverless-technology-never-sleep-8a2e5e97f789?source=collection_archive---------0-----------------------#2022-05-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/37dbe07f5c751d45f77951482f8bcf90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gPx9xwEYt8Lx98SC"/></div></div></figure><p id="6625" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">尝试寻找最有效的解决方案来部署您的应用程序是一个好方法。</p><p id="ac48" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您的公司会很高兴拥有一个经济高效的平台，但是…..故事还没有结束！</p><h1 id="c907" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">这是我的故事，始于4年前:</h1><p id="de75" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">最初的目标是测量和报告公司中BigQuery的使用情况，每天在一个表中报告<strong class="is hj">每个表的行数、每个表的大小等...</strong></p><p id="2bd1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在寻找不同的实现方式后，我发现了开源解决方案:</p><div class="kr ks ez fb kt ku"><a href="https://cloud.google.com/blog/products/gcp/analyzing-your-bigquery-usage-with-ocado-technologys-gcp-census" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">通过Ocado Technology的GCP人口普查|谷歌云博客分析你的BigQuery使用情况</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">编者按:今天我们听到谷歌云客户Ocado技术，它创造了(和开源！)一个程序…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">cloud.google.com</p></div></div><div class="ld l"><div class="le l lf lg lh ld li io ku"/></div></div></a></div><p id="f987" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">多亏了<a class="ae lj" href="https://www.doit-intl.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> DoIt团队</strong> </a>，代码很容易在AppEngine Flexible上部署。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/768825fd5ade7a334bbe6a1af6dc7492.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1a8KCOVJOz2kHY6V.PNG"/></div></figure><p id="b89b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最初，我们有数百张桌子，这意味着每天都可以快速运行，而且成本非常低，不需要维护。</p><p id="6ef5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是因为平台的采用是好的，我们现在有数百万的表和数据集…</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/b9640bac86c40342d69e290354fb2590.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fjbU-m-uQWS2rbTCT7U2DQ.png"/></div></div></figure><p id="2c5d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下情况的结果:</p><ul class=""><li id="04b7" class="lq lr hi is b it iu ix iy jb ls jf lt jj lu jn lv lw lx ly bi translated">扫描现在需要<strong class="is hj">每天23小时</strong></li><li id="0993" class="lq lr hi is b it lz ix ma jb mb jf mc jj md jn lv lw lx ly bi translated">扫描和导出成本现在接近每月<strong class="is hj"> 3 000美元</strong></li></ul><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/1f449bace71e71cd71beaf97f46d3478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ciBOfZJ3vAn_5oZD.png"/></div></div></figure><p id="dfeb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对问题进行故障排除后，我们没有发现所用解决方案的任何问题。</p><p id="f67a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在是时候找到另一种方法来做到这一点，而不是重新发明轮子..</p><p id="8b96" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的想法是利用4年前不可用的新的无服务器生成工具… <strong class="is hj">云运行</strong>！</p><p id="b7f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">同类最佳的可扩展性、效率和灵活性。</p><p id="87d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们从以前使用的解决方案中提取代码，并部署如下:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/672c82fb5adbeb44bfe416aaab49ca80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FYNb0Tg_MlvgaUVCgogA1g.png"/></div></div></figure><p id="f7e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">云任务是管理每个项目、每个数据集和每个表的所有云运行的不同调用，以并行使用最大限度的云运行服务。</p><h1 id="6601" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结果是:</h1><ul class=""><li id="48fa" class="lq lr hi is b it km ix kn jb mg jf mh jj mi jn lv lw lx ly bi translated"><strong class="is hj">运行2小时</strong></li><li id="cb49" class="lq lr hi is b it lz ix ma jb mb jf mc jj md jn lv lw lx ly bi translated"><strong class="is hj">每月成本800美元</strong>(1次运行成本26美元)BigQuery insert的260美元&amp;云日志</li><li id="c96e" class="lq lr hi is b it lz ix ma jb mb jf mc jj md jn lv lw lx ly bi translated"><strong class="is hj"> 713 </strong>运行期间使用的云运行容器</li></ul><p id="059e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">哇！！！无服务器2.0已经到来，这股浪潮令人难以置信地强大，证据很明显:</p><ul class=""><li id="3050" class="lq lr hi is b it iu ix iy jb ls jf lt jj lu jn lv lw lx ly bi translated">部署解决方案后不要睡觉，因为你确信问题已经无限期地解决了</li><li id="a67a" class="lq lr hi is b it lz ix ma jb mb jf mc jj md jn lv lw lx ly bi translated">尝试花一点时间来重构一个应用程序有时是一个非常好的方法</li></ul><p id="0c34" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请记住，无服务器v1使用的是GAE flex容器(每月100%的时间都在运行，从几个容器到更多容器，但从不扩展到0 ),无服务器v2每次运行都使用7xx容器，每天按需启动，并在每次运行后自动关闭…</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/ae6eaeb023f0fc87cd590ee778b4d5c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GoRBrvH_UGE5MPtlrZDCuw.png"/></div></div></figure><h1 id="b549" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">因为我们想衡量该解决方案的效率，所以我们做了最后一个测试:</h1><p id="d218" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">复制Cloud Run中使用的python代码，并尝试将其部署在经典VM中，像过去一样逐个表地调用API..</p><p id="93cc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用的虚拟机是N2-standard-16,当然它不提供API调用的可伸缩性和并行性..</p><p id="bfb5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为什么不是最便宜的虚拟机？因为我们担心如果这项工作需要几个小时，内存中的信息会爆炸…</p><h1 id="349c" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结果很疯狂:</h1><p id="8b30" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">1全程跑拍<strong class="is hj"> 7天！</strong></p><p id="b9f4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在想象一下，在不到24小时的时间里，需要多少台虚拟机才能做到这一点:</p><ul class=""><li id="0abe" class="lq lr hi is b it iu ix iy jb ls jf lt jj lu jn lv lw lx ly bi translated"><strong class="is hj"> 7台虚拟机</strong>工作人员在不到24小时内完成工作，如果我们继续扫描越来越多的表，时间会更快…</li><li id="ad95" class="lq lr hi is b it lz ix ma jb mb jf mc jj md jn lv lw lx ly bi translated"><strong class="is hj"> 4，000美元</strong>7台虚拟机的月成本+ 420美元的BQ流插入/云日志= <strong class="is hj"> 4，420美元</strong></li></ul><p id="fa3a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们可以看到无服务器2.0是多么强大和高效。</p><p id="4870" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">最后，除了金钱支出之外，还要比较3种情景的碳足迹信息:</strong></p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/6f05d2b1318d78b1117fc8f3ea0f3df7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UDyJdUjC01QH2h8VbuwXvw.png"/></div></div></figure><p id="3007" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数字为我说话…现在你知道你要做什么了。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/3f649bc5667533b52a757d66935ee6c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iVoFUuveR0GlPRny8zUgaQ.png"/></div></div></figure><h1 id="d85b" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">至摘要</h1><p id="46be" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我花了几天时间从无服务器v1切换到v2，以获得:</p><p id="ae7e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">每月成本降低59% </strong></p><p id="9e25" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">每月碳足迹减少25% </strong>。</p></div></div>    
</body>
</html>