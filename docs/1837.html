<html>
<head>
<title>Cloud Spanner in DBeaver</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据仓库中的云扳手</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/cloud-spanner-in-dbeaver-853998faa0ba?source=collection_archive---------0-----------------------#2021-03-29">https://medium.com/google-cloud/cloud-spanner-in-dbeaver-853998faa0ba?source=collection_archive---------0-----------------------#2021-03-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5542" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://cloud.google.com/spanner" rel="noopener ugc nofollow" target="_blank"> Google Cloud Spanner </a>是一个全面管理、可扩展的关系数据库服务，用于区域和全球应用数据。它是第一个可扩展的、企业级的、全球分布的、高度一致的数据库服务，专为云构建，将关系数据库结构的优势与非关系水平扩展相结合。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/5ea3e6661905a239ecd25ee94bea5a27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*iNlSTFEy1xpftvwji_PIXA.png"/></div></figure><p id="9e86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用关系数据库的优势之一是有大量的标准工具可用。Cloud Spanner包括一个<a class="ae jd" href="https://cloud.google.com/spanner/docs/use-oss-jdbc" rel="noopener ugc nofollow" target="_blank"> JDBC驱动</a>，它已经被添加为<a class="ae jd" href="https://dbeaver.io/" rel="noopener ugc nofollow" target="_blank"> DBeaver </a>的扩展。这意味着您可以使用DBeaver查询和更新Cloud Spanner数据库中的数据，而无需手动安装任何驱动程序。JDBC驱动程序还包括许多<a class="ae jd" href="https://cloud.google.com/spanner/docs/use-oss-jdbc#session_management_statements" rel="noopener ugc nofollow" target="_blank">非常有用的附加SQL语句</a>，您可以使用它们来高效地使用Cloud Spanner。</p><p id="f7e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文提供了使用Cloud Spanner通过通用SQL接口(如DBeaver)时的技巧和最佳实践列表。本文中的大多数技巧也适用于使用JDBC驱动程序连接到Cloud Spanner的其他应用程序。</p><h1 id="4079" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">在DBeaver中创建连接</h1><p id="0afd" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">DBeaver 7.1.3及更高版本附带了云扳手JDBC驱动程序。按照以下步骤创建连接:</p><ol class=""><li id="0ae4" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">点击<code class="du ky kz la lb b">New Database Connection</code></li><li id="b5ad" class="kp kq hi ih b ii lc im ld iq le iu lf iy lg jc ku kv kw kx bi translated">选择<code class="du ky kz la lb b">Google Spanner</code>驱动(不是<code class="du ky kz la lb b">Google Spanner (Community)</code>驱动)</li><li id="8c73" class="kp kq hi ih b ii lc im ld iq le iu lf iy lg jc ku kv kw kx bi translated">输入项目ID、实例ID、数据库ID，并选择有效的凭据密钥文件。</li></ol><h1 id="8c1a" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">批处理DDL语句</h1><p id="9938" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">Cloud Spanner支持<a class="ae jd" href="https://cloud.google.com/spanner/docs/data-definition-language" rel="noopener ugc nofollow" target="_blank">标准DDL语句</a>来创建和更改表和索引。当您需要在一行中执行多个语句时，强烈建议将多个DDL语句批处理在一起。当您创建或更改测试数据库时，通常会出现这种情况。一批DDL语句的总执行速度比每个语句单独执行时要低得多。使用<code class="du ky kz la lb b">START BATCH DDL</code>和<code class="du ky kz la lb b">RUN BATCH</code>语句执行一批DDL。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lh li l"/></div></figure><h1 id="a271" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">批处理DML语句</h1><p id="b297" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">Cloud Spanner允许在一个远程过程调用中批量处理多个DML语句。使用此功能可以减少一组语句的总执行时间。这个特性非常类似于上面显示的DDL批处理特性。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lh li l"/></div></figure><h1 id="e7c2" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">执行分区的DML语句</h1><p id="0387" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">Cloud Spanner允许在单个读/写事务中最多有20，000个<a class="ae jd" href="https://cloud.google.com/spanner/quotas#limits_for_creating_reading_updating_and_deleting_data" rel="noopener ugc nofollow" target="_blank">突变。有时有必要执行较大的事务。为此，Cloud Spanner支持</a><a class="ae jd" href="https://cloud.google.com/spanner/docs/dml-partitioned" rel="noopener ugc nofollow" target="_blank">分区DML s </a>语句。JDBC驱动程序也支持分区的DML语句。JDBC驱动程序必须处于<strong class="ih hj">自动提交模式</strong>才能执行分区DML。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lh li l"/></div></figure><h1 id="fa07" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">只读事务</h1><p id="3411" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">Cloud Spanner支持<a class="ae jd" href="https://cloud.google.com/spanner/docs/transactions#read-only_transactions" rel="noopener ugc nofollow" target="_blank">只读事务</a>，它提供一致的读取而不需要任何锁。执行只读事务时的默认过时模式是强。这意味着只读事务启动时提交的所有数据对该事务都是可见的。如果您想读取过时数据，您可以<a class="ae jd" href="https://cloud.google.com/spanner/docs/use-oss-jdbc#set_read_only_staleness" rel="noopener ugc nofollow" target="_blank">选择不同的过时</a>模式。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lh li l"/></div></figure><h1 id="c072" class="jm jn hi bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">连接到模拟器</h1><p id="bce3" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">Cloud Spanner还提供了一个<a class="ae jd" href="https://cloud.google.com/spanner/docs/emulator" rel="noopener ugc nofollow" target="_blank">本地仿真器</a>，可以用于测试和开发目的。在<a class="ae jd" href="https://github.com/googleapis/java-spanner-jdbc" rel="noopener ugc nofollow" target="_blank">扳手JDBC驱动</a>版本2.0.0和更高版本中，通过添加<code class="du ky kz la lb b">autoConfigEmulator</code>连接属性，使用JDBC(或DBeaver)连接到仿真器变得尽可能容易。将此属性设置为将指示JDBC驱动程序执行以下操作:</p><ol class=""><li id="eecf" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">使用默认的模拟器主机和端口(<code class="du ky kz la lb b">localhost:9010</code>)，除非在连接字符串中指定了特定的主机和端口。该连接还会自动禁用SSL，因为模拟器不支持。</li><li id="8bea" class="kp kq hi ih b ii lc im ld iq le iu lf iy lg jc ku kv kw kx bi translated">如果连接字符串中引用的<code class="du ky kz la lb b">instance</code>和<code class="du ky kz la lb b">database</code>还不存在，它们将在模拟器上自动创建。</li></ol><p id="8d55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以上意味着连接字符串<code class="du ky kz la lb b">jdbc:cloudspanner:/projects/test-project/instances/test-instance/databases/test-database?autoConfigEmulator=true</code>将自动:</p><ol class=""><li id="e1a8" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">连接到<code class="du ky kz la lb b">localhost:9010</code></li><li id="4af7" class="kp kq hi ih b ii lc im ld iq le iu lf iy lg jc ku kv kw kx bi translated">禁用SSL</li><li id="8463" class="kp kq hi ih b ii lc im ld iq le iu lf iy lg jc ku kv kw kx bi translated">创建<code class="du ky kz la lb b">test-instance</code>和<code class="du ky kz la lb b">test-database</code>，如果这些都不存在的话</li></ol><h2 id="2f9f" class="lj jn hi bd jo lk ll lm js ln lo lp jw iq lq lr ka iu ls lt ke iy lu lv ki lw bi translated">在DBeaver中连接到仿真器的步骤</h2><p id="00ab" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">按照以下步骤连接到DBeaver中的Cloud Spanner模拟器:</p><ol class=""><li id="f2d2" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">使用默认配置，使用<a class="ae jd" href="https://cloud.google.com/spanner/docs/emulator#gcloud_cli" rel="noopener ugc nofollow" target="_blank"> gcloud CLI </a>或<a class="ae jd" href="https://cloud.google.com/spanner/docs/emulator#docker" rel="noopener ugc nofollow" target="_blank"> docker image </a>启动Google Cloud Spanner模拟器。</li><li id="519b" class="kp kq hi ih b ii lc im ld iq le iu lf iy lg jc ku kv kw kx bi translated">确保在DBeaver中安装了2.0.0或更高版本的Google Cloud Spanner JDBC驱动程序。你可以通过点击菜单项<code class="du ky kz la lb b">Database | Driver Manager</code>，然后双击谷歌扳手(或谷歌<strong class="ih hj">云</strong>扳手，名称取决于DBeaver版本)驱动名称。单击下载/更新按钮，将驱动程序更新到最新版本。</li><li id="fbbd" class="kp kq hi ih b ii lc im ld iq le iu lf iy lg jc ku kv kw kx bi translated">点击DBeaver中的新数据库连接，并选择Google (Cloud)扳手驱动程序。</li><li id="dec2" class="kp kq hi ih b ii lc im ld iq le iu lf iy lg jc ku kv kw kx bi translated">输入项目、实例和数据库的值(例如<code class="du ky kz la lb b">test-project, test-instance, test-database</code>)。将私钥路径字段留空。</li><li id="ec2d" class="kp kq hi ih b ii lc im ld iq le iu lf iy lg jc ku kv kw kx bi translated">单击驱动程序属性选项卡，并将连接属性的值<code class="du ky kz la lb b">autoConfigEmulator</code>更改为<code class="du ky kz la lb b">true</code>。</li><li id="c812" class="kp kq hi ih b ii lc im ld iq le iu lf iy lg jc ku kv kw kx bi translated">单击完成。DBeaver现在将连接到您在步骤1中启动的模拟器，如果实例和数据库还不存在，它们将自动在模拟器上创建。</li></ol><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es lx"><img src="../Images/5cccbf796949140c65b38a5a7a9196ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*24y257dY2y5H9J-MSKslQw.png"/></div></div><figcaption class="mc md et er es me mf bd b be z dx translated">将自动配置器设置为true</figcaption></figure><p id="a84e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，当您使用<code class="du ky kz la lb b">autoConfigEmulator</code>时，您<strong class="ih hj">不需要</strong>来设置以下任何属性:</p><ol class=""><li id="6d77" class="kp kq hi ih b ii ij im in iq kr iu ks iy kt jc ku kv kw kx bi translated">您<strong class="ih hj">不需要</strong>在连接字符串中设置主机名或端口号(只要仿真器使用默认的主机和端口号<code class="du ky kz la lb b">localhost:9010)</code></li><li id="3363" class="kp kq hi ih b ii lc im ld iq le iu lf iy lg jc ku kv kw kx bi translated">你<strong class="ih hj">不需要</strong>来设置环境变量SPANNER_EMULATOR_HOST。</li><li id="ad79" class="kp kq hi ih b ii lc im ld iq le iu lf iy lg jc ku kv kw kx bi translated">您<strong class="ih hj">不需要</strong>来设置连接属性usePlainText。</li><li id="4c74" class="kp kq hi ih b ii lc im ld iq le iu lf iy lg jc ku kv kw kx bi translated">您<strong class="ih hj">不需要</strong>配置任何凭证。</li></ol></div></div>    
</body>
</html>