<html>
<head>
<title>From Zero to Hero — Run parse-server on google cloud platform part 2 — Deploy and run parse-server on Google Container Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从零到英雄—在google云平台上运行parse-server第2部分—在Google容器引擎上部署和运行parse-server</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/from-zero-to-hero-run-parse-server-on-google-cloud-platform-part-2-deploy-and-run-parse-server-86e5d93296a3?source=collection_archive---------0-----------------------#2017-05-18">https://medium.com/google-cloud/from-zero-to-hero-run-parse-server-on-google-cloud-platform-part-2-deploy-and-run-parse-server-86e5d93296a3?source=collection_archive---------0-----------------------#2017-05-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="dff7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这篇博客是关于如何在GCP容器引擎上运行解析服务器的<strong class="io hj">系列<strong class="io hj">博客</strong>的第二部分</strong></p><p id="b65a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在<a class="ae jk" rel="noopener" href="/@ran.hassid/from-zero-to-hero-run-parse-server-on-google-cloud-platform-part-1-run-parse-server-and-mongodb-63a5f89f670d">第1部分</a>中，您学习了如何通过docker-compose在本地机器上运行parse-server Node.js应用程序和MongoDB实例。在本部分的最后，你将知道如何利用你在第1部分中所做的，在google容器引擎上部署和运行它。</p><h1 id="b5a0" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">额外津贴</h1><ul class=""><li id="c1da" class="kj kk hi io b ip kl it km ix kn jb ko jf kp jj kq kr ks kt bi translated">谷歌云平台帐户-GCP帐户是必填项，因为您将应用程序部署到谷歌容器引擎，这是GCP服务之一。如果你还没有一个有效的GCP账户，你可以在这里创建一个<a class="ae jk" href="https://cloud.google.com/free/" rel="noopener ugc nofollow" target="_blank">免费试用账户。试用用户在12个月内可以获得300美元的谷歌积分。</a></li><li id="5405" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">Google cloud platform SDK——这个SDK允许你在GCP账户上从本地机器终端执行命令。为了安装它，请遵循<a class="ae jk" href="https://cloud.google.com/sdk/" rel="noopener ugc nofollow" target="_blank">谷歌云平台SDK官方页面</a>上的说明</li></ul></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="c531" class="jl jm hi bd jn jo kz jq jr js la ju jv jw lb jy jz ka lc kc kd ke ld kg kh ki bi translated"><strong class="ak"> Google容器引擎+ Kubernetes(理论上)</strong></h1><p id="f679" class="pw-post-body-paragraph im in hi io b ip kl ir is it km iv iw ix le iz ja jb lf jd je jf lg jh ji jj hb bi translated">谷歌容器引擎或GKE是一个非常强大的集群和编排管理器，用于在云中大规模运行docker容器。GKE根据您定义的报价自动管理您的docker容器(例如CPU内存、磁盘卷)。它基于流行的开源软件<a class="ae jk" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"><strong class="io hj">Kubernetes</strong></a><strong class="io hj"/>，最初是由google开发的，直到他们决定开源它。</p><p id="4b07" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> Kubernetes </strong></p><p id="521c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Kubernetes(简称k8s)是一个开源系统，用于自动化部署、扩展和管理容器化的应用程序。使用k8s，您可以运行和管理任何docker容器应用程序。GKE和k8s的这种组合最棒的一点是，您可以在一项服务中使用这两种功能，因为k8s允许您轻松部署和管理所有的微服务，而GCP则负责所有其他的扩展、日志记录、安全性，甚至为您提供容器注册表，您可以在其中存储将由您的GKE集群使用的映像。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="b18f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">库伯内特建筑公司</p><ul class=""><li id="3dc9" class="kj kk hi io b ip iq it iu ix lh jb li jf lj jj kq kr ks kt bi translated">名称空间——在k8s中，可以创建多个名称空间。每个命名空间都包含自己的资源、服务、pod、卷等。我们通常使用名称空间来区分环境(例如开发、测试、生产)、团队、客户等等。名称空间既可以通过简单的yml文件创建，也可以通过<strong class="io hj"> kubectl </strong> CLI创建。你可以在<a class="ae jk" href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/" rel="noopener ugc nofollow" target="_blank">这里</a>阅读更多关于名称空间的内容</li><li id="27fe" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">Pod—Pod代表您的集群上正在运行的进程，是您部署的k8s中最基本的单元。Pod封装了一个或多个应用程序容器。每个pod拥有1个网络IP和一些关于它应该如何在集群内运行的配置。在k8s中，您可以运行同一个应用程序的多个pods，并通过副本集水平扩展它们。</li><li id="b629" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">副本集—副本集确保特定数量的pod实例在任何给定时间都在运行。使用副本集，您可以确保您的pod(容器)将始终启动并运行，而不会停机。但是，建议使用部署，而不要直接创建副本集。</li><li id="50dd" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">部署——部署是一个更高层次的概念，它管理副本集，并向pod提供声明性更新和附加功能。k8s的建议是创建将为我们的pod管理和创建副本集的部署，而不是直接创建副本集。在这个博客中，我们将创建部署，在部署配置文件中，我们将指出我们希望为每个服务运行多少个副本集(多少个pod)。</li><li id="a9f9" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">服务—服务通过将一组pod与特定标准相关联来发现pod。pod通过标签和选择器与服务相关联。你可以把它想象成一种类似“域”的方法，你可以访问它的域(标签/选择器)而不是访问服务网络IP，k8s会自动为你发现相关的服务。您可以创建只能由同一个集群内的pod访问的内部服务，也可以将它们公开给internet(通过负载平衡器)。</li><li id="34a5" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">配置映射——在k8s中，配置映射是一组键值对，包含一些通常用于pod的配置信息。将应用程序代码从配置中分离出来是一个很好的实践，因为你的应用程序可以通过改变它的配置来做出不同的行为，这提供了更多的灵活性。在第1部分中，我展示了如何创建一个将由parse-server在运行时使用的config.json。在这篇博客中，我将展示如何获取这个config.json并从中创建配置映射，以便pod在运行时使用。</li><li id="32ee" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">secrets——secrets允许您安全地存储敏感数据，如:密码、秘密密钥、私人密钥等，并在运行时将它们装载到您的pod中。</li></ul><p id="6b50" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">请注意！</strong>在这个系列的博客中，我无法涵盖Kubernetes的所有功能。我确信我也不熟悉<strong class="io hj">所有的</strong>功能，我认为最好是涵盖我们将在这个系列中使用的所有东西。如果你仍然喜欢阅读和深入了解k8s的所有功能，请参考<a class="ae jk" href="https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/" rel="noopener ugc nofollow" target="_blank">他们的网站</a>。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="3fc0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">自动缩放</strong></p><p id="76c6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在GKE，你有一些很小(但很强大)的复选框，如果你点击它，谷歌会通过按需添加/减少节点来自动扩展你的集群。让我们通过示例来解释为什么自动缩放非常重要并且经济高效:</p><p id="2a61" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们以最大的电子商务服务之一e-bay为例，假设在平常的一天，他们的平台上有<strong class="io hj">百万</strong>活跃用户，并且该网站运行平稳，没有任何性能或稳定性问题，<strong class="io hj">但是</strong>第二天，他们预计他们的平台上将有1亿活跃用户，因为这一天是黑色星期五。因此，在正常情况下，他们每天运行20个节点，在黑色星期五，他们需要将节点数量增加到200个，以便为客户提供<strong class="io hj">相同的体验</strong>。</p><p id="f787" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这就是自动缩放如此重要的原因，因为我们自己处理它非常复杂，所以必须由专家来完成，在我们的情况下，专家就是GCP的工程师。</p><p id="8a27" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">自动缩放功能也很经济，因为当不再需要资源时，会自动为您解除分配。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="f874" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">谷歌容器注册表</strong></p><p id="34a9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">就像我之前提到的，GKE提供给你的东西之一是一个注册表，你可以在那里存储你的图像。在我们的例子中，我们将使用这个注册表来存储我们在第1部分中构建的解析服务器映像。使用google container registry而不使用dockerhub private等其他服务的优势在于:</p><ul class=""><li id="4846" class="kj kk hi io b ip iq it iu ix lh jb li jf lj jj kq kr ks kt bi translated"><strong class="io hj">性能</strong> —映像存储在您的k8s实例附近，可以由GKE非常快速地下载和挂载</li><li id="a7ed" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">安全——如果你依靠GKE来运行你的所有服务，你也可以依靠它来保证你的镜像二进制文件的安全</li><li id="ade8" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated"><strong class="io hj"> GCP CLI </strong> — GCP CLI (gcloud命令)允许您轻松推送您在一个命令中构建的映像(gcloud推送…)</li><li id="e9d4" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated"><strong class="io hj">构建触发器</strong> —这是我最喜欢的功能之一，它为您提供(免费)CI/CD功能，因此当您对特定git存储库进行更改或创建新的git标签时，您可以告诉google container engine自动为您构建docker映像并将其存储在注册表中，因此如果您将源代码存储在BitBucket、GitHub或Google cloud Source存储库中，您就可以使用这一令人惊叹的功能。我个人使用它，它节省了我很多时间，而且效果很好！</li></ul><p id="1550" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在是时候动手部署并运行我们在第1部分中构建的应用程序了。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="7847" class="jl jm hi bd jn jo kz jq jr js la ju jv jw lb jy jz ka lc kc kd ke ld kg kh ki bi translated"><strong class="ak">装置</strong></h1><p id="6f6d" class="pw-post-body-paragraph im in hi io b ip kl ir is it km iv iw ix le iz ja jb lf jd je jf lg jh ji jj hb bi translated">为了检查您的机器上是否安装了google cloud platform，请在终端中执行以下命令:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="df03" class="lt jm hi lp b fi lu lv l lw lx">gcloud -v</span></pre><p id="1f30" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">该命令将列出所有可以在Google cloud SDK安装中使用的已安装组件。</p><figure class="lk ll lm ln fd lz er es paragraph-image"><div class="er es ly"><img src="../Images/0c32c5536c2eba16a767bea5d075a615.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*oIQZJBWeSjhUgS_1RbqS8g.png"/></div></figure><p id="3615" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，您需要安装kubectl组件。该组件将允许您在GKE集群前执行命令。</p><p id="8021" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要安装kubectl，请在终端中执行以下命令:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="b3c0" class="lt jm hi lp b fi lu lv l lw lx">gcloud components install kubectl</span></pre><p id="78c6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">运行该命令后，google cloud SDK将在您的本地机器上安装kubectl。为了检查是否真正安装了kubectl，请在终端中运行以下命令:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="4f70" class="lt jm hi lp b fi lu lv l lw lx">kubectl </span></pre><p id="7a42" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">并检查您是否获得了可以通过kubectl CLI执行的受支持命令的列表。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="4f45" class="jl jm hi bd jn jo kz jq jr js la ju jv jw lb jy jz ka lc kc kd ke ld kg kh ki bi translated"><strong class="ak">创建GKE集群(实用)</strong></h1><p id="5ede" class="pw-post-body-paragraph im in hi io b ip kl ir is it km iv iw ix le iz ja jb lf jd je jf lg jh ji jj hb bi translated">在这一部分，我将展示如何在谷歌云平台上创建你的GKE集群，所以请确保你有一个活跃的GCP帐户准备使用。</p><p id="99b3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">创建新的GCP项目</strong></p><p id="9bd7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您需要做的第一件事是创建一个新项目。进入你的<a class="ae jk" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云控制台</a>，在左上角(谷歌云平台标题旁边)点击<strong class="io hj">选择一个项目</strong>下拉</p><figure class="lk ll lm ln fd lz er es paragraph-image"><div class="er es mc"><img src="../Images/9940732b6eeda7701d37949fffb1986a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*tgnIfitksiNnQ78BI7mD3Q.png"/></div></figure><p id="d13f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在弹出的对话框中点击<strong class="io hj"> + </strong>按钮创建一个新项目。</p><figure class="lk ll lm ln fd lz er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es md"><img src="../Images/9a28229c8578e447086066a5470e730a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q2BG25HD-eyGwCxbEX4qog.png"/></div></div></figure><p id="4ee9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在项目名称文本框中写下<strong class="io hj"> my-parse-server-proj </strong>，然后点击<strong class="io hj"> create </strong>按钮创建您的项目。</p><figure class="lk ll lm ln fd lz er es paragraph-image"><div class="er es mi"><img src="../Images/068cba8e0f8950f8f0024f9d0c681bc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*KkVIfhwAzTk3mZk4ic_ykA.png"/></div></figure><p id="95d8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">30-60秒后，您的项目将被创建。您可以在控制台通知中检查状态</p><figure class="lk ll lm ln fd lz er es paragraph-image"><div class="er es mj"><img src="../Images/16f9af3d61a0331c5db2babd5d453a24.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*MgZCdowHCBLfvo3bP26ZKg.png"/></div></figure><p id="358c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">创建项目后，您需要再次点击<strong class="io hj">选择项目按钮</strong>，在弹出对话框中按名称搜索项目，然后从列表中选择。</p><figure class="lk ll lm ln fd lz er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es mk"><img src="../Images/a45cc3e427442154444f95deef5c4a65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zWJ026AStWbsFu4wqcrJGw.png"/></div></div></figure><figure class="lk ll lm ln fd lz er es paragraph-image"><div class="er es ml"><img src="../Images/903d5de03f5d9bbf8fc5a834440f72c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*fTQ-q097kPYgGbcmPXMOhg.png"/></div></figure></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="9e4f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">创建新的集装箱引擎集群</strong></p><p id="c2f1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这一节中，我将展示如何在GCP上创建自己的容器引擎集群。</p><p id="fdc0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要创建集群，请执行以下步骤:</p><ol class=""><li id="8685" class="kj kk hi io b ip iq it iu ix lh jb li jf lj jj mm kr ks kt bi translated">点击位于控制台右上角的菜单按钮，打开主菜单。</li><li id="8e26" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj mm kr ks kt bi translated">点击<strong class="io hj">集装箱引擎</strong></li><li id="b112" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj mm kr ks kt bi translated">点击<strong class="io hj">创建容器集群</strong>蓝色按钮</li></ol><figure class="lk ll lm ln fd lz er es paragraph-image"><div class="er es mn"><img src="../Images/eae74905fa2e14ec39b9063f64c5516a.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*S3C7w6uq2gwXefsX2DqD7A.png"/></div></figure><p id="d9b2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">4.在创建容器集群表单中填写以下详细信息:</p><ul class=""><li id="744c" class="kj kk hi io b ip iq it iu ix lh jb li jf lj jj kq kr ks kt bi translated">名称:集群1</li><li id="38d0" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">描述:我的服务的容器引擎集群</li><li id="e2df" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">区域:在本演示中选择us-east1-b。在生产中，你需要提前做一些研究，并检查你的大部分客户在哪里。BTW！您可以在多个区域甚至世界上的多个数据中心部署容器集群，但这不是我在本系列中要讨论的内容。</li><li id="0f99" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">机器类型:保持默认的1vCPU，3.75 GB内存。</li><li id="11e4" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">节点图像:cos</li><li id="f3d5" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">尺码:1。默认值为3，但您可以将其更改为1，因为您没有在生产环境中运行。<strong class="io hj"> 3 </strong>表示容器引擎将根据您选择的<strong class="io hj">机器类型</strong>在您的集群中创建3个1 vCPU/3.75GB内存的节点。机器类型非常重要，因为所有将添加到集群中的节点都属于<strong class="io hj">相同的机器类型</strong>(不能在集群中混合不同的机器类型)。</li><li id="daa0" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">确保选中了打开stackdrive日志记录——这将通过google stackdrive为您提供监控和日志记录功能。</li><li id="e1fc" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">在所有东西都被填充后，点击创建按钮</li></ul><figure class="lk ll lm ln fd lz er es paragraph-image"><div class="er es mo"><img src="../Images/1db7574d46ef1da6e2cdab39c1cd78c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*kAvFmeF8nh5b5XhHpDvocg.png"/></div></figure><p id="a06f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">单击“创建”后，将创建您的容器引擎集群。创建一个容器集群通常需要2-5分钟。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="5b90" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">连接到集装箱引擎集群</strong></p><p id="5b55" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">按照以下步骤连接到您的集群:</p><ol class=""><li id="09fd" class="kj kk hi io b ip iq it iu ix lh jb li jf lj jj mm kr ks kt bi translated">单击connect按钮(位于列出集群的右侧)</li></ol><figure class="lk ll lm ln fd lz er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es mp"><img src="../Images/5e124550beafcf4063e8b6eaeb33455e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZiTn6j8b3VNZX4OQ8Fak9g.png"/></div></div></figure><p id="a007" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">2.打开终端，将弹出对话框中的第一个命令复制并粘贴到您的终端外壳中。</p><figure class="lk ll lm ln fd lz er es paragraph-image"><div class="er es mq"><img src="../Images/97f52e6fe1b1166685f342b194d03db0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*LNNrWKLJmWY5Am9dQ-X0yg.png"/></div></figure><p id="9bd0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">3.回到弹出对话框，将第二个命令(kubectl proxy)复制并粘贴到您的终端shell中。该命令将创建一个从您的本地机器到您的容器引擎集群的代理。配置(集群、区域和项目的名称)取自您执行的第一个命令。</p><p id="b107" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">4.如果一切顺利，您将在终端shell中看到127.0.0.1:8001开始服务。</p><figure class="lk ll lm ln fd lz er es paragraph-image"><div class="er es mr"><img src="../Images/6331967f6f1625bbce8c870bbed12f56.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*Mdei4a3L0aZNlRbFAcvhTA.png"/></div></figure><p id="10fb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">5.正如我之前提到的。Container engine基于Kubernetes，幸运的是，k8s社区为我们创建了一个非常好的仪表板，在那里我们可以看到我们集群中运行的所有服务。您可以通过打开浏览器并访问以下URL来访问您的k8s仪表板:<a class="ae jk" href="http://localhost:8001/ui" rel="noopener ugc nofollow" target="_blank">http://localhost:8001/ui</a>。</p><p id="482e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">目前你的k8s只运行一些核心的Kubernetes服务(列在<strong class="io hj"> kube-system </strong>名称空间下)。在下一节中，我将展示如何将解析服务器应用程序部署到容器引擎。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="ca24" class="jl jm hi bd jn jo kz jq jr js la ju jv jw lb jy jz ka lc kc kd ke ld kg kh ki bi translated"><strong class="ak">将parse-server和MongoDB部署到容器引擎</strong></h1><p id="3631" class="pw-post-body-paragraph im in hi io b ip kl ir is it km iv iw ix le iz ja jb lf jd je jf lg jh ji jj hb bi translated"><strong class="io hj">将你的解析服务器应用程序推送到谷歌云注册表</strong></p><p id="8fe8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这一节中，我将展示如何将本系列第1部分中的内容部署到上面创建的google容器引擎集群中。</p><p id="c419" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您需要做的第一件事是<strong class="io hj">构建您在第1部分中创建的解析服务器映像并将其推送到</strong>您的google cloud registry。为了做到这一点，您需要重新构建解析服务器映像，但这次还要创建一个标记。标签使您可以轻松了解您的映像正在运行哪个版本。使用标签，你可以创建同一个应用程序的多个版本，如果当前运行的新版本有问题，k8s + google registry可以轻松地返回到特定版本。在生产中运行应用程序时，标签极其重要。</p><p id="8711" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要构建解析服务器应用程序的第一个版本(1.0)，请打开“终端”，导航到应用程序文件夹并运行以下命令:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="69df" class="lt jm hi lp b fi lu lv l lw lx">docker build -t my-parse-app .</span></pre><p id="de0a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，您需要创建一个标记来表明这是该应用程序的1.0版本。此外，标签还需要包含google容器注册中心和这个google容器注册中心所在的项目名称。幸运的是，这可以通过运行一个简单的命令来完成:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="1dbc" class="lt jm hi lp b fi lu lv l lw lx">docker tag my-parse-app gcr.io/my-parse-server-proj/my-parse-app:v1.0</span></pre><p id="0fd1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们解释一下最后一个命令:docker标记告诉docker CLI创建一个标记，my-parse-app是我们要为其创建标记的应用程序，gcr.io是容器注册表，my-parse-server-proj是我们在GCP控制台中创建的项目的名称，my-parse-app:v1.0是标记的名称，即v1.0</p><p id="b3b2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">成功后，运行以下命令:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="9da1" class="lt jm hi lp b fi lu lv l lw lx">docker images </span></pre><p id="8bac" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果一切顺利，您应该会看到parse-server-app 1.0版出现在这里:</p><figure class="lk ll lm ln fd lz er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es ms"><img src="../Images/68c9401d66b78dff21f09c3bee7c003a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3oZlEv2vxRJns50YDEA1wA.png"/></div></div></figure><p id="e6ac" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在你有了你的标签的第一个版本之后，是时候把它推送到google cloud registry了。为此，在同一个终端窗口中执行以下命令:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="0c5d" class="lt jm hi lp b fi lu lv l lw lx">gcloud docker -- push gcr.io/my-parse-server-proj/my-parse-app:v1.0</span></pre><p id="beba" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个命令将把解析服务器应用程序的第一个版本推送到google容器注册中心。根据您的连接速度，可能需要5-20分钟才能完成。</p><p id="988f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">成功推送映像后，转到GCP控制台，打开主菜单，选择容器注册表→容器注册表。</p><figure class="lk ll lm ln fd lz er es paragraph-image"><div class="er es mt"><img src="../Images/2b9f7cf00daf36c85b7bff0ca7be1fee.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*mVwP6hIH5vJUmXaeqa7Q0A.png"/></div></figure><p id="f5a1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，点击my-parse-app文件夹，查看图片列表及其版本<strong class="io hj"> my-parse-app </strong></p><figure class="lk ll lm ln fd lz er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es mu"><img src="../Images/998e6e5d045090f75d1f77a953386647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pyz8Bi0E8z6ujYluoreypw.png"/></div></div></figure></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="dd51" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">将parse-server和mongoDB部署到google容器引擎</strong></p><p id="7c96" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这一节中，我将展示如何创建一些yml配置文件并将它们部署到google容器引擎。这些<strong class="io hj"> yml </strong>配置文件将在容器引擎上创建以下资源:</p><ol class=""><li id="2501" class="kj kk hi io b ip iq it iu ix lh jb li jf lj jj mm kr ks kt bi translated"><strong class="io hj">解析-服务器应用部署</strong> —该部署将使用上一节中推送的映像，并将创建两个运行相同应用的pod。我还将解释如何通过修改部署<strong class="io hj"> yml </strong>文件中的一行来轻松运行更多的pods。</li><li id="db5c" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj mm kr ks kt bi translated"><strong class="io hj"> parse-server应用服务</strong> —该服务将允许我们从互联网访问parse-server，并在其前面运行一些api调用。这将通过把GCP负载平衡器放在它的前面来完成，它将分配公共IP地址。别担心，这都是GCP自动处理的:)</li><li id="a0a3" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj mm kr ks kt bi translated"><strong class="io hj">解析服务器应用程序配置图</strong> —该配置图将在运行时由解析服务器应用程序组件读取。配置映射将与docker-compose中使用的config.json文件相同。</li><li id="63b0" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj mm kr ks kt bi translated"><strong class="io hj"> mongoDB部署</strong> —这个部署将为我们的数据库创建一个pod。在这篇博客中，我将展示如何只创建一个副本集。原因是当您处理数据库时，您不能仅仅将副本集从1更改为3，仅此而已。如果你真的对如何做到这一点感兴趣，我推荐你阅读关于<strong class="io hj">有状态集</strong>的内容，它允许你轻松地为数据库创建副本集。你可以在Sandeep Dinesh 撰写的这篇<a class="ae jk" rel="noopener" href="/google-cloud/mongodb-replica-sets-with-kubernetes-d96606bd9474">精彩博文</a>中了解更多。</li><li id="275a" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj mm kr ks kt bi translated"><strong class="io hj"> mongoDB服务</strong> —该服务是仅供内部使用的服务，将由解析服务器应用程序pods使用。我们不会在互联网上公开这项服务，因为我们真的不需要这样做。k8s允许我们在内部使用它(通过使用选择器和标签),这样更快更安全。</li></ol><p id="fb3a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在visual studio代码中，在根文件夹下创建一个新文件夹，并将其命名为<strong class="io hj"> container-engine </strong></p><figure class="lk ll lm ln fd lz er es paragraph-image"><div class="er es mx"><img src="../Images/0ba5fc6097bcb89a8b08cc40726e9ff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*ZL4Az-jzuBaSNoSSbw5kgg.png"/></div></figure><p id="afb6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">右键单击容器引擎文件夹，并创建以下文件:</p><ul class=""><li id="03fb" class="kj kk hi io b ip iq it iu ix lh jb li jf lj jj kq kr ks kt bi translated"><strong class="io hj">parse-server-deployment . yml</strong>—此文件包含parse-server应用程序部署的配置文件。将<a class="ae jk" href="https://gist.github.com/ranhsd/d77012db340df98d6c28e0f076927220" rel="noopener ugc nofollow" target="_blank">本要点</a>的内容复制粘贴到该文件中</li></ul><figure class="lk ll lm ln fd lz"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="fa7e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">上面的文件将在k8s中创建一个名为<strong class="io hj"> my-parse-app </strong>的新部署。副本:2表示您将并排运行同一个应用程序的2个窗格。该应用程序将挂载上一步推送的图像(<strong class="io hj">gcr.io/my-parse-server-proj/my-parse-app:v1.0</strong>)，<strong class="io hj"> redinessProbe </strong>之所以在这里，是因为您将在本系列的第3部分中需要它(请不要取消注释)。</p><ul class=""><li id="a692" class="kj kk hi io b ip iq it iu ix lh jb li jf lj jj kq kr ks kt bi translated"><strong class="io hj">parse-server-service . yml</strong>—此文件包含parse-server服务的配置。将<a class="ae jk" href="https://gist.github.com/ranhsd/904ab15bec3b08a802d0d26c415dbf6c" rel="noopener ugc nofollow" target="_blank">以下要点</a>的内容复制粘贴到该文件中。</li></ul><figure class="lk ll lm ln fd lz"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="8116" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">服务的名称是<strong class="io hj"> my-parse-app-service </strong>。port和targetPort是端口映射，指示服务将在端口80上公开，并且该端口将被映射到内部端口1337。type:LoadBalancer表示该服务将被公开给internet，<strong class="io hj"> app:my-parse-server </strong>表示该服务将包装my-parse-app部署。</p><ul class=""><li id="ba31" class="kj kk hi io b ip iq it iu ix lh jb li jf lj jj kq kr ks kt bi translated"><strong class="io hj"> mongo-deployment.yml </strong> —该文件包含mongoDB部署的配置。将以下要点的内容复制并粘贴到该文件中。</li></ul><figure class="lk ll lm ln fd lz"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="0ef4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">部署的名称是mongo-deployment，该部署将从dockerhub下载并安装最新的mongoDB映像，pods将在端口27017上运行，数据将存储在mongo-persistent-storage卷中，这是一个GCP持久性磁盘。别担心，我会告诉你如何在GCE上创建这样的磁盘。</p><ul class=""><li id="52a5" class="kj kk hi io b ip iq it iu ix lh jb li jf lj jj kq kr ks kt bi translated"><strong class="io hj"> mongo-service.yml </strong> —该文件包含mongoDB服务的配置。将<a class="ae jk" href="http://f44cddf0dbeaf69fac1b650d85f27426" rel="noopener ugc nofollow" target="_blank">以下要点</a>的内容复制粘贴到该文件中。</li></ul><figure class="lk ll lm ln fd lz"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="a3df" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">该服务的名称是mongo，它将在端口27017上运行，并且只在内部可用。该服务将包装mongo部署。</p><p id="cb66" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是我们部署和运行parse-server和mongoDB到容器引擎所需的所有资源。</p><p id="a40d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">正如我所承诺的，接下来我将展示如何创建谷歌计算引擎(GCE)磁盘。您需要在同一个区域中创建一个磁盘，并将其命名为<strong class="io hj"> my-parse-app-db-disk </strong>这是因为您的mongo-deployment.yml文件中的<strong class="io hj"> pdName </strong>是my-parse-app-db-disk。BTW pdName代表持久性磁盘名称。</p><p id="2c8b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要创建持久性磁盘，请执行以下步骤:</p><ol class=""><li id="64dc" class="kj kk hi io b ip iq it iu ix lh jb li jf lj jj mm kr ks kt bi translated">在GCP控制台中打开主菜单，然后选择计算引擎→磁盘</li></ol><figure class="lk ll lm ln fd lz er es paragraph-image"><div class="er es na"><img src="../Images/de3e9bae3e47af6a5867d29126153b13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*ve0vEfEr7JOM63vwyfmXZg.png"/></div></figure><p id="1234" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">2.点击顶部的<strong class="io hj">创建磁盘</strong>按钮</p><p id="d678" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">3.在创建磁盘表单中填写以下详细信息:</p><ul class=""><li id="9254" class="kj kk hi io b ip iq it iu ix lh jb li jf lj jj kq kr ks kt bi translated">名称:我的解析数据库磁盘</li><li id="4695" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">区域:选择运行集群的同一区域。在我的例子中是us-east1-b。您可以通过导航到容器引擎来快速检查它。</li><li id="4396" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">磁盘类型:选择持久磁盘，因为SSD价格昂贵:)</li><li id="d6ba" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">来源图片:centos-6…</li><li id="b402" class="kj kk hi io b ip ku it kv ix kw jb kx jf ky jj kq kr ks kt bi translated">点击创建按钮</li></ul><figure class="lk ll lm ln fd lz er es paragraph-image"><div class="er es nb"><img src="../Images/a44c01b42f3402db82e89dce088b38b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*8_JH2FRNJsTY-3q-aq-Ilw.png"/></div></figure><p id="c843" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">几秒钟后，你的磁盘就准备好了。</p><p id="4766" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后但同样重要的是配置图。就像我上面提到的，您的配置映射将从您在使用docker-compose运行parse-server时使用的config.json文件中创建。</p><p id="c213" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">打开终端，导航到<strong class="io hj"> app </strong>文件夹，执行以下命令:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="e96c" class="lt jm hi lp b fi lu lv l lw lx">kubectl create configmap my-parse-app-config --from-file=config/config.json</span></pre><p id="da88" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请确保您的配置映射名称是my-parse-app-config，因为这是解析服务器部署使用的名称。</p><figure class="lk ll lm ln fd lz er es paragraph-image"><div class="er es nc"><img src="../Images/8ffec14fc3e11a72a52bb2b0b15c7f26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*A73nU_pctDNeDd5Zry6OaA.png"/></div></figure><p id="5926" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，通过在浏览器中导航到<a class="ae jk" href="http://localhost:8001/ui" rel="noopener ugc nofollow" target="_blank"> http://localhost:8001/ui </a>来转到您的k8s实例，从左侧菜单中单击config map，并确保my-parse-app-config列在那里。</p><figure class="lk ll lm ln fd lz er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es nd"><img src="../Images/690fbf0bfe39ef1abbb7fb43816b8c42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PEjHATUE4IcjwZXhKOn5EA.png"/></div></div></figure><figure class="lk ll lm ln fd lz er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es ne"><img src="../Images/43d10761a82a72b8fc938e26ffc0bc40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EA8p7E6mE3oL1U0R7jj1Wg.png"/></div></div></figure><p id="776e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们准备在google容器引擎上部署和运行parse-server。首先，我们将部署mongoDB部署和服务，然后我们将部署parse-server。</p><p id="e12d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">打开终端，导航到根文件夹(myParseServerApp)并执行以下命令:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="3bbf" class="lt jm hi lp b fi lu lv l lw lx">kubectl create -f container-engine/mongo-service.yml</span></pre><p id="5535" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个命令将创建mongoDB服务。接下来，执行以下命令来创建mongo部署和pod。</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="9514" class="lt jm hi lp b fi lu lv l lw lx">kubectl create -f container-engine/mongo-deployment.yml</span></pre><p id="29dd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，运行以下命令来创建解析服务器服务</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="795f" class="lt jm hi lp b fi lu lv l lw lx">kubectl create -f container-engine/parse-server-service.yml</span></pre><p id="49e5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后运行下面的命令来创建解析服务器部署。</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="ee6a" class="lt jm hi lp b fi lu lv l lw lx">kubectl create -f container-engine/parse-server-deployment.yml</span></pre><p id="9db2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从浏览器访问<a class="ae jk" href="http://localhost:8001/ui" rel="noopener ugc nofollow" target="_blank"> http://localhost:8001/ui </a>，打开k8s实例。在左侧菜单中，点击<strong class="io hj">部署</strong>，确保您看到两个部署旁边有一个绿色勾号。</p><figure class="lk ll lm ln fd lz er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es nf"><img src="../Images/66d968f891ffad65b94d8873d14c2dfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KF4Nwgtlct4C-bc48AAdmg.png"/></div></div></figure><p id="7c95" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后选择服务，再次检查是否有两个服务，并且都是有效的。</p><figure class="lk ll lm ln fd lz er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es ng"><img src="../Images/b8873ce6fa5a9615f0b29f0552bd8ffe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PeyEd_Ad0Ru6wUM984xUbw.png"/></div></div></figure><p id="b2ed" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我前面提到过，解析服务器应该通过GCP负载平衡器暴露给互联网。这就是为什么您应该在<strong class="io hj"> my-parse-app-service </strong>的外部端点下看到IP地址和端口的原因。</p><p id="0fad" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个IP地址是解析服务器API的端点。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="94dc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">测试您的解析服务器端点</strong></p><p id="c41a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">打开POSTMAN并在以下端点上执行GET请求:<a class="ae jk" href="#" rel="noopener ugc nofollow">http://&lt;YOUR _ SERVICE _ EXTERNAL _ ENDPOINT&gt;/Parse/classes/user</a>，添加相关的请求头(X-Parse-Application-Id和content-type)并点击<strong class="io hj"> Send </strong></p><figure class="lk ll lm ln fd lz er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es nh"><img src="../Images/80233d356f04a6dfddff3f8e4d855166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z7mkSJV4ZeumuGhMHgMKsw.png"/></div></div></figure><figure class="lk ll lm ln fd lz er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es ni"><img src="../Images/dd93ef02ff7965f509a6faeec726e6f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lIqAC4jICSYJFjLdXKs-0w.png"/></div></div></figure><p id="2965" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">点击发送后，你会得到一个空的用户列表。这个请求之所以有效，是因为您使用的API密钥与在本地运行应用程序时使用的相同。</p><p id="05fc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们创建一些更有趣的东西…将请求方法从GET改为POST，复制并粘贴以下URL:<a class="ae jk" href="#" rel="noopener ugc nofollow">http://&lt;YOUR _ SERVICE _ EXTERNAL _ ENDPOINT&gt;/parse/classes/Task</a></p><p id="ad63" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，将以下有效负载复制并粘贴到请求正文中:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="0837" class="lt jm hi lp b fi lu lv l lw lx">{<br/> "title" : "This is my first task",<br/> "priority" : "high"<br/>}</span></pre><figure class="lk ll lm ln fd lz er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es nj"><img src="../Images/63ed0952988c100df5359983345ed5a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3sPnEJaI8wjDjYcZL_etLA.png"/></div></div></figure><p id="70a1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">点击send parse后，服务器将处理请求并在mongo中创建新任务。</p><p id="8bb5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">通过将正文有效负载更改为以下内容来创建另一个任务:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="0252" class="lt jm hi lp b fi lu lv l lw lx">{<br/> "title" : "This is my second task",<br/> "priority" : "medium",<br/> "isPersonalTask" : true<br/>}</span></pre><p id="46bf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">点击发送解析后，服务器将创建第二个任务。注意，第二个任务有点不同，除了标题和优先级之外，我还添加了另一个布尔属性<strong class="io hj"> (isPersonalTask) </strong>，这就是无模式数据库的神奇之处。</p><p id="e3fe" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，将POST更改为GET，然后单击Send并查看创建的2个任务。</p><figure class="lk ll lm ln fd lz er es paragraph-image"><div class="er es nk"><img src="../Images/95c026490984d812d4ae350bf3d60c48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*Ae7SP7VYIqfFTrQdP35EyA.png"/></div></figure></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h1 id="b2c2" class="jl jm hi bd jn jo kz jq jr js la ju jv jw lb jy jz ka lc kc kd ke ld kg kh ki bi translated"><strong class="ak">第二部分概要</strong></h1><p id="934f" class="pw-post-body-paragraph im in hi io b ip kl ir is it km iv iw ix le iz ja jb lf jd je jf lg jh ji jj hb bi translated">现在你几乎是一个英雄…你知道如何创建谷歌容器引擎，你对Kubernetes是什么和它如何工作有基本的了解，你知道如何创建项目，磁盘和如何自动缩放你的解决方案。在本系列的第3部分中，我将展示如何在google容器引擎上运行相同的解析服务器，但是以更安全的方式运行(提示:它与http协议有关:)。此外，我将展示如何免费创建域证书，甚至动态生成它，并在您的google容器引擎集群中使用它。</p></div></div>    
</body>
</html>