<html>
<head>
<title>Google Cloud Run for Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google Cloud Run for Go</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-cloud-run-for-go-ec09ddbba111?source=collection_archive---------0-----------------------#2019-04-10">https://medium.com/google-cloud/google-cloud-run-for-go-ec09ddbba111?source=collection_archive---------0-----------------------#2019-04-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ea91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Google Cloud最近推出了一个完全托管的容器执行环境，名为<a class="ae jd" href="https://cloud.google.com/blog/products/serverless/announcing-cloud-run-the-newest-member-of-our-serverless-compute-stack?utm_source=twitter&amp;utm_medium=unpaidsocial&amp;utm_campaign=global-gcpcloud-liveevent&amp;utm_content=event-next" rel="noopener ugc nofollow" target="_blank"> Cloud Run </a>。这是一个专门针对请求驱动的工作负载的环境。它提供自动扩展、缩减到零、非常快速的部署、自动HTTPS支持、全局名称等等。只要gVisor支持语言运行时，Google Cloud Run就没有语言运行时限制。它只要求部署在一个端口上公开一个HTTP服务器。</p><p id="bb79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了部署Go服务器，我们将从一个最小的helloworld HTTP服务器开始。容器运行时期望服务器监听$PORT:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="adde" class="jn jo hi jj b fi jp jq l jr js">$ cat main.go<br/>// ...</span><span id="d8ad" class="jn jo hi jj b fi jt jq l jr js">func main() {<br/> http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {<br/>  fmt.Fprintln(w, "hello world")<br/> })</span><span id="0d7e" class="jn jo hi jj b fi jt jq l jr js"> port := os.Getenv("PORT")<br/> if port == "" {<br/>  port = "8080"<br/> }</span><span id="0717" class="jn jo hi jj b fi jt jq l jr js"> log.Fatal(http.ListenAndServe(":"+port, nil))<br/>}</span></pre><p id="f18f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了构建Docker映像，请创建一个多阶段Docker文件:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="5bc7" class="jn jo hi jj b fi jp jq l jr js">$ cat Dockerfile<br/>FROM golang:1.14 as build</span><span id="3f6a" class="jn jo hi jj b fi jt jq l jr js">WORKDIR /go/src/app<br/>COPY . .</span><span id="1cce" class="jn jo hi jj b fi jt jq l jr js">RUN go build -v -o /app .</span><span id="aba3" class="jn jo hi jj b fi jt jq l jr js"># Now copy it into our base image.<br/>FROM gcr.io/distroless/base<br/>COPY --from=build /app /app<br/>CMD ["/app"]</span></pre><p id="5999" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">构建映像并将其推送到<a class="ae jd" href="https://cloud.google.com/container-registry/" rel="noopener ugc nofollow" target="_blank">谷歌容器注册中心</a>:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="d721" class="jn jo hi jj b fi jp jq l jr js">$ docker build -t gcr.io/$GCP_PROJECT_NAME/helloworld .<br/>$ docker push gcr.io/$GCP_PROJECT_NAME/helloworld</span></pre><p id="d8d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，从云控制台或终端，您可以使用构建的映像创建一个新服务:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="1772" class="jn jo hi jj b fi jp jq l jr js">$ gcloud run deploy hello --image gcr.io/$GCP_PROJECT_NAME/helloworld --project $GCP_PROJECT_NAME<br/># ...<br/>Service [hello] revision [hello-00001] has been deployed and is serving traffic at <a class="ae jd" href="https://hello-yfkfyh7piq-uc.a.run.app" rel="noopener ugc nofollow" target="_blank">https://hello-yfkfyh7piq-uc.a.run.app</a></span></pre><p id="308c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用提供的端点来访问服务。日志等操作参见<a class="ae jd" href="http://console.cloud.google.com/run" rel="noopener ugc nofollow" target="_blank">云运行控制台</a>。</p><figure class="je jf jg jh fd jv er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es ju"><img src="../Images/0a9f2c348e1b55a99154e81a64cad7d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*61Sk8LpJ4EjQMMRiDHzfYQ.png"/></div></div></figure><p id="25d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Google Cloud Run专门针对请求驱动的HTTP/HTTPS工作负载进行了优化。容器可以被抢占和迁移，所以如果您计划将它用于长时间运行的服务，这并不太好。除了HTTP/HTTPS之外，目前也没有其他支持。如果您需要更多的灵活性，请参见<a class="ae jd" href="https://www.youtube.com/watch?v=RVdhyprptTQ" rel="noopener ugc nofollow" target="_blank">GKE上的云运行</a>。</p><p id="c39e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你有任何反馈，请随时联系jbd@google.com。</p></div></div>    
</body>
</html>