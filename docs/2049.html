<html>
<head>
<title>A way to generate sample dataset in BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä¸€ç§åœ¨BigQueryä¸­ç”Ÿæˆæ ·æœ¬æ•°æ®é›†çš„æ–¹æ³•</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/google-cloud/a-way-to-generate-sample-test-dataset-in-bigquery-6e28fff9625c?source=collection_archive---------1-----------------------#2022-01-10">https://medium.com/google-cloud/a-way-to-generate-sample-test-dataset-in-bigquery-6e28fff9625c?source=collection_archive---------1-----------------------#2022-01-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="9142" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">ä½ éœ€è¦ç”¨ä¸€ç»„éšæœºçš„æ•°å­—ã€æ—¥æœŸæ¥å¡«å……BigQueryè¡¨å—ï¼Ÿé…·ç»§ç»­..</p></blockquote><p id="2131" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">BigQueryæœ‰ä¸€ä¸ªå¾ˆé…·çš„Generate_Arrayå‡½æ•°ï¼Œå®ƒè·å–èŒƒå›´è¾¹ç•Œä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ•°ç»„(åµŒå¥—å­—æ®µ)ã€‚Generate_date_arrayç›¸å½“äºç”Ÿæˆæ—¥æœŸæ•°ç»„ã€‚</p><p id="3aaf" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">Unnestå‡½æ•°å¯ç”¨äºå°†æ•°ç»„é¡¹åˆ†è§£æˆå•ç‹¬è¡Œã€‚åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä¾é è¿™äº›å‡½æ•°æ¥ç”Ÿæˆintå’Œdateå€¼ã€‚</p><p id="73f4" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">ä¸ºäº†è·å¾—ä¸€äº›éšæœºçš„å­—ç¬¦ä¸²å€¼ï¼Œæˆ‘ä»¬å°†å—ç›Šäºæ•£åˆ—å‡½æ•°ï¼Œå¦‚MD5()å’ŒRAND()å‡½æ•°ã€‚</p><h1 id="4d73" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">é¦–å…ˆæ˜¯ç”Ÿæˆintæˆ–dateå€¼çš„ä¸€äº›åŸºç¡€çŸ¥è¯†</h1><p id="3d8f" class="pw-post-body-paragraph ii ij hi il b im ki io ip iq kj is it jh kk iw ix ji kl ja jb jj km je jf jg hb bi translated">è·å–è¿ç»­çš„1000ä¸ªæ•´æ•°:</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="4efa" class="kw jl hi ks b fi kx ky l kz la">SELECT id FROM UNNEST(GENERATE_ARRAY(1, 1000)) id;</span><span id="5ab7" class="kw jl hi ks b fi lb ky l kz la">--You can fill a table with one int column using insert/select statements like;</span><span id="f3b5" class="kw jl hi ks b fi lb ky l kz la">insert into `project_id`.dataset_name.table_name <br/>SELECT id FROM UNNEST(GENERATE_ARRAY(1, 1000)) id;</span></pre><p id="6f11" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">è·å–æœ‰é—´éš”çš„è¿ç»­æ—¥æœŸã€‚exï¼›å¼€å§‹æ—¥æœŸä¸º2021å¹´1æœˆ1æ—¥ï¼Œç»“æŸæ—¥æœŸä¸º2022å¹´1æœˆ8æ—¥ï¼Œä¸¤ä¸ªå€¼ä¹‹é—´ç›¸å·®10å¤©:</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="01fe" class="kw jl hi ks b fi kx ky l kz la">SELECT date FROM UNNEST(GENERATE_DATE_ARRAY(â€˜2021â€“01â€“01â€™, â€˜2022â€“01â€“08â€™, INTERVAL 10 DAY)) date</span><span id="4dc4" class="kw jl hi ks b fi lb ky l kz la">--You can fill a table with only one date column using insert/select statements like;</span><span id="d1ae" class="kw jl hi ks b fi lb ky l kz la">insert into `project_id`.dataset_name.table_name <br/>SELECT date FROM UNNEST(GENERATE_DATE_ARRAY(â€˜2021â€“01â€“01â€™, â€˜2022â€“01â€“08â€™, INTERVAL 10 DAY)) date;</span></pre><h1 id="e94b" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">ç”Ÿæˆå…·æœ‰å”¯ä¸€idå’Œéšæœºæ—¥æœŸçš„å¤šä¸ªå€¼</h1><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="5fdb" class="kw jl hi ks b fi kx ky l kz la">WITH parameters AS (<br/>SELECT 10000 customer_id, DATE â€˜2010â€“01â€“01â€™ start_date, DATE â€˜2020â€“12â€“31â€™ finish_date<br/>)</span><span id="1d7d" class="kw jl hi ks b fi lb ky l kz la">SELECT <br/>  customer_id, <br/>  DATE_FROM_UNIX_DATE(CAST(start + (finish â€” start) * RAND() AS INT64)) random_date<br/>FROM parameters,<br/>UNNEST(GENERATE_ARRAY(1, customer_id)) customer_id,<br/>UNNEST([STRUCT(UNIX_DATE(start_date) AS start, UNIX_DATE(finish_date) AS finish)])</span></pre><figure class="kn ko kp kq fd ld er es paragraph-image"><div class="er es lc"><img src="../Images/faf6d50073ac147949cc02b850755c6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*eQejCu0Utnd_UhiEW4JBkg.png"/></div></figure><h1 id="5afb" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">è¿˜å¯ä»¥æ”¾ä¸€äº›é™„åŠ æ ç›®å—ï¼Ÿ</h1><p id="8084" class="pw-post-body-paragraph ii ij hi il b im ki io ip iq kj is it jh kk iw ix ji kl ja jb jj km je jf jg hb bi translated">æ·»åŠ ä¸€ä¸ªé¢å¤–çš„æ•´æ•°åˆ—ï¼Œä¾‹å¦‚ä»·æ ¼:</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="f6a9" class="kw jl hi ks b fi kx ky l kz la">WITH parameters AS (</span><span id="2ce0" class="kw jl hi ks b fi lb ky l kz la">SELECT 10000 customer_id, DATE â€˜2010-01â€“01â€™ start_date, DATE â€˜2020â€“12â€“31â€™ finish_date</span><span id="463e" class="kw jl hi ks b fi lb ky l kz la">)</span><span id="9dfa" class="kw jl hi ks b fi lb ky l kz la">SELECT customer_id, DATE_FROM_UNIX_DATE(CAST(start + (finish â€” start) * RAND() AS INT64)) random_date, <strong class="ks hj">CAST(10000*RAND() AS INT64) price</strong></span><span id="2e94" class="kw jl hi ks b fi lb ky l kz la">FROM parameters,</span><span id="12c0" class="kw jl hi ks b fi lb ky l kz la">UNNEST(GENERATE_ARRAY(1, customer_id)) customer_id,</span><span id="ef75" class="kw jl hi ks b fi lb ky l kz la">UNNEST([STRUCT(UNIX_DATE(start_date) AS start, UNIX_DATE(finish_date) AS finish)])</span><span id="e159" class="kw jl hi ks b fi lb ky l kz la">--Note Medium blog converts '-' characters into a different ascii char. If you copy paste this please replace '-' with minus char in the date values manually.</span></pre><figure class="kn ko kp kq fd ld er es paragraph-image"><div class="er es lg"><img src="../Images/51c85e64e77906a80f1ec66a025959ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*1WzE_eqZ_60wo2Tqlhbp3A.png"/></div></figure><p id="80ff" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">æ·»åŠ ä¸€ä¸ªé¢å¤–çš„å­—ç¬¦ä¸²åˆ—ï¼Œä¾‹å¦‚customer_id:</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="1402" class="kw jl hi ks b fi kx ky l kz la">-- inserting into table which has 2 columns; an int and a string column;</span><span id="cb9f" class="kw jl hi ks b fi lb ky l kz la">insert into `project_id`.dataset_name.table_name SELECT id, TO_BASE64 (MD5(cast (RAND() as string))) FROM UNNEST(GENERATE_ARRAY(1, 1000)) id</span></pre><h2 id="06ad" class="kw jl hi bd jm lh li lj jq lk ll lm ju jh ln lo jy ji lp lq kc jj lr ls kg lt bi translated">ä¸ºæ¯ä¸ªå”¯ä¸€idç”Ÿæˆå¤šè¡Œ</h2><p id="d58b" class="pw-post-body-paragraph ii ij hi il b im ki io ip iq kj is it jh kk iw ix ji kl ja jb jj km je jf jg hb bi translated">å‡è®¾è¿™æ˜¯ä¸€ä¸ªè®¢å•è¡¨ï¼Œæ¯ä¸ªå®¢æˆ·éƒ½æœ‰å¤šä¸ªè®¢å•ã€‚éœ€è¦æ¯ä¸ªå®¢æˆ·æœ‰ä¸åŒçš„è®¢å•è®¡æ•°ã€‚</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="de36" class="kw jl hi ks b fi kx ky l kz la">WITH parameters AS (</span><span id="ccb1" class="kw jl hi ks b fi lb ky l kz la">SELECT <strong class="ks hj">1000</strong> row_count,DATE â€˜2010â€“01â€“01â€™ start_date, DATE â€˜2020â€“12â€“31â€™ finish_date</span><span id="9122" class="kw jl hi ks b fi lb ky l kz la">)</span><span id="e6ea" class="kw jl hi ks b fi lb ky l kz la">select CAST(<strong class="ks hj">500</strong>*RAND() AS INT64) customer_id, DATE_FROM_UNIX_DATE(CAST(start + (finish â€” start) * RAND() AS INT64)) order_date, CAST(10000*RAND() AS INT64) price from parameters,</span><span id="8ba7" class="kw jl hi ks b fi lb ky l kz la">UNNEST(GENERATE_ARRAY(1, row_count)) row_count,</span><span id="3a79" class="kw jl hi ks b fi lb ky l kz la">UNNEST([STRUCT(UNIX_DATE(start_date) AS start, UNIX_DATE(finish_date) AS finish)])</span></pre><p id="8e0a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">è¿™é‡Œï¼Œåªéœ€å°†è¡Œæ•°é™¤ä»¥æœŸæœ›çš„å®¢æˆ·æ•°ï¼Œå³å¯å¾—åˆ°å¹³å‡è®¢å•æ•°:</p><figure class="kn ko kp kq fd ld er es paragraph-image"><div class="er es lu"><img src="../Images/2a34404da34fb6031d24b72c9344d1fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*GODhI2Mh0mieVYwltAFobQ.png"/></div></figure><p id="dcec" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">ä½ éœ€è¦ä¸åŒä»·å€¼è§‚çš„ç»„åˆå—ï¼Ÿ</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="f163" class="kw jl hi ks b fi kx ky l kz la">select order_id, date, price from</span><span id="7e50" class="kw jl hi ks b fi lb ky l kz la">(SELECT order_id FROM UNNEST(GENERATE_ARRAY(1, 3)) order_id) order_id,</span><span id="9b05" class="kw jl hi ks b fi lb ky l kz la">(SELECT date FROM UNNEST(GENERATE_DATE_ARRAY(â€˜2021â€“01â€“01â€™, â€˜2022â€“01â€“08â€™, INTERVAL 100 DAY)) date) date,</span><span id="a6bf" class="kw jl hi ks b fi lb ky l kz la">(SELECT price FROM UNNEST(GENERATE_ARRAY(100, 103)) price) price</span></pre><p id="38c8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">å¥½å§ï¼Œè¿™äº›éƒ½å¾ˆé…·ï¼Œä½†æˆ‘éœ€è¦ä¸€äº›æ¯è¡Œçš„é€»è¾‘ã€‚</p><p id="9b3d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">è„šæœ¬/å­˜å‚¨è¿‡ç¨‹ï¼Ÿ</p><p id="1dd9" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">å¥½çš„ï¼Œåœ¨è¿™é‡Œï¼Œè®°ä½BigQueryæ˜¯åˆ†ææŸ¥è¯¢å¼•æ“ï¼Œå®ƒå–œæ¬¢å¤„ç†é›†åˆä¸­çš„æ•°æ®ï¼Œè€Œä¸æ˜¯è¡Œä¸­çš„æ•°æ®ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³ç”¨ä¸€ä¸ªå¾ªç¯äº§ç”Ÿ10ç§’æˆ–100ç§’çš„è®°å½•ï¼Œè¿™å¯èƒ½æ˜¯å¯ä»¥çš„ï¼Œä½†è¿™è¿œè¿œä¸æ˜¯æœ€ä½³çš„ï¼Œä½†ä»¥é˜²ä¸‡ä¸€ï¼Œå¦‚æœä½ éœ€è¦ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹/è„šæœ¬æ¥ç”Ÿæˆä¸€äº›è¡Œï¼Œè¿™é‡Œæ”¾å…¥:</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="7c9c" class="kw jl hi ks b fi kx ky l kz la">DECLARE id STRING;<br/>DECLARE d DATE DEFAULT CURRENT_DATE();<br/>DECLARE x INT64 DEFAULT 0;<br/>DECLARE datesub INT64 DEFAULT 0;</span><span id="f104" class="kw jl hi ks b fi lb ky l kz la">LOOP<br/>SET x = x +1;<br/>IF x&gt;=100 THEN<br/>LEAVE;<br/>END IF;</span><span id="f6b8" class="kw jl hi ks b fi lb ky l kz la">SET id = CAST(CAST(10000*RAND() AS INT64) AS STRING);<br/>SET datesub = CAST(10000*RAND() AS INT64);</span><span id="6628" class="kw jl hi ks b fi lb ky l kz la">INSERT INTO xxx.orders (customer_id, order_date, price) VALUES(id, DATE_SUB(D, INTERVAL datesub DAY), datesub);</span><span id="c9fe" class="kw jl hi ks b fi lb ky l kz la">SELECT FORMAT(â€œCreated customer %sâ€, id);</span><span id="10cf" class="kw jl hi ks b fi lb ky l kz la">END LOOP;</span></pre><p id="19dc" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">è¿™äº›é€‰é¡¹çœ‹èµ·æ¥æ€ä¹ˆæ ·ï¼Ÿä½ æœ‰æ›´å¥½çš„é€‰æ‹©å—ï¼Ÿè¯·åœ¨ä¸‹é¢è¯„è®ºä¸€ä¸‹ğŸ‘‡</p></div></div>    
</body>
</html>