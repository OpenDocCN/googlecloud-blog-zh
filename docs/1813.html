<html>
<head>
<title>Update Google Data Catalog Tags with Cloud Dataprep Metadata</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用云数据准备元数据更新Google数据目录标签</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/update-google-data-catalog-tags-with-cloud-dataprep-metadata-db74e6ee04c8?source=collection_archive---------2-----------------------#2021-02-23">https://medium.com/google-cloud/update-google-data-catalog-tags-with-cloud-dataprep-metadata-db74e6ee04c8?source=collection_archive---------2-----------------------#2021-02-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f47038a644759f132824d41cf9b2fffe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DnYZXllU7VgvqzATtoUgVw.png"/></div></div></figure><p id="6f87" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇文章链接到Github存储库<a class="ae jo" href="https://github.com/victorcouste/google-data-catalog-dataprep" rel="noopener ugc nofollow" target="_blank">https://Github . com/victor couse/Google-Data-Catalog-Data prep</a>解释了如何通过Python <a class="ae jo" href="https://cloud.google.com/functions" rel="noopener ugc nofollow" target="_blank">云函数</a>使用<a class="ae jo" href="https://cloud.google.com/dataprep" rel="noopener ugc nofollow" target="_blank"> Cloud Dataprep </a>元数据和列的配置文件在BigQuery表上创建或更新<a class="ae jo" href="https://cloud.google.com/data-catalog/" rel="noopener ugc nofollow" target="_blank"> Google Cloud Data Catalog </a>标签。</p><p id="c809" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建或更新的2个数据目录标记:</p><ul class=""><li id="1e29" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated"><a class="ae jo" href="https://github.com/victorcouste/google-data-catalog-dataprep/blob/main/tag_templates/dataprep_metadata_tag_template.txt" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> Dataprep作业元数据</strong> </a>标签，附加到BigQuery表，包含来自Dataprep作业的信息，用于创建或更新BigQuery表:用户、Dataprep作业(id、名称、url、时间戳)、Dataprep数据集(id、名称、url)、Dataprep流(id、名称、url)、作业配置文件(url和有效、无效空值的数量)以及数据流作业(id、url)。</li></ul><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jy"><img src="../Images/031a660813eabe3f7bb4a3a1c42a2567.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4MrbqUC6Si8PigdZ3hDjkA.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">数据目录中的云Dataprep元数据标记示例</figcaption></figure><ul class=""><li id="a339" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated"><a class="ae jo" href="https://github.com/victorcouste/google-data-catalog-dataprep/blob/main/tag_templates/dataprep_column_profile_tag_template.txt" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> Dataprep作业列的Profile </strong> </a>标记附加到所有BigQuery表列，包含每列的有效、无效和空值的数量。</li></ul><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kh"><img src="../Images/ad788b9af54ee7d4325b974273049c39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B_fJnMZTc1YxtUHKH3X-_A.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">数据目录中云数据准备列配置文件标记的示例</figcaption></figure><p id="071f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要激活、学习和使用云数据目录，请前往<a class="ae jo" href="https://cloud.google.com/data-catalog" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/data-catalog</a>和<a class="ae jo" href="https://console.cloud.google.com/datacatalog" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com/datacatalog</a>。</p><p id="d17a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Github存储库包含从<a class="ae jo" href="https://docs.trifacta.com/display/DP/Create+Flow+Webhook+Task" rel="noopener ugc nofollow" target="_blank"> Dataprep Webhook </a>触发的云函数Python代码，用于创建或更新2个数据目录标签。</p><p id="93cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该云函数使用:</p><ul class=""><li id="4ccb" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated"><a class="ae jo" href="https://googleapis.dev/python/datacatalog/latest/index.html#" rel="noopener ugc nofollow" target="_blank">用于谷歌云数据目录API的Python客户端</a></li><li id="5b96" class="jp jq hi is b it ki ix kj jb kk jf kl jj km jn ju jv jw jx bi translated"><a class="ae jo" href="https://api.trifacta.com/dataprep-premium/index.html" rel="noopener ugc nofollow" target="_blank">云数据准备REST API </a></li></ul><p id="88e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在您的云功能中，您需要5个文件:</p><ul class=""><li id="3b4f" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated"><a class="ae jo" href="https://github.com/victorcouste/google-data-catalog-dataprep/blob/main/main.py" rel="noopener ugc nofollow" target="_blank"> main.py </a></li><li id="4ed7" class="jp jq hi is b it ki ix kj jb kk jf kl jj km jn ju jv jw jx bi translated"><a class="ae jo" href="https://github.com/victorcouste/google-data-catalog-dataprep/blob/main/config.py" rel="noopener ugc nofollow" target="_blank"> config.py </a>在这里你需要更新你的<strong class="is hj"> GCP项目名</strong>(在这里创建标签模板)和<a class="ae jo" href="https://docs.trifacta.com/display/DP/Access+Tokens+Page" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> Dataprep访问令牌</strong> </a>(使用Dataprep API)。如果需要，还可以更新2个标记模板ID。</li><li id="a86b" class="jp jq hi is b it ki ix kj jb kk jf kl jj km jn ju jv jw jx bi translated"><a class="ae jo" href="https://github.com/victorcouste/google-data-catalog-dataprep/blob/main/datacatalog_functions.py" rel="noopener ugc nofollow" target="_blank">Data Catalog _ functions . py</a>获取或更新数据目录对象。</li><li id="0f4f" class="jp jq hi is b it ki ix kj jb kk jf kl jj km jn ju jv jw jx bi translated"><a class="ae jo" href="https://github.com/victorcouste/google-data-catalog-dataprep/blob/main/dataprep_metadata.py" rel="noopener ugc nofollow" target="_blank"> dataprep_metadata.py </a>获取云dataprep元数据。</li><li id="0e19" class="jp jq hi is b it ki ix kj jb kk jf kl jj km jn ju jv jw jx bi translated"><a class="ae jo" href="https://github.com/victorcouste/google-data-catalog-dataprep/blob/main/requirements.txt" rel="noopener ugc nofollow" target="_blank"> requirements.txt </a></li></ul><p id="42f0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在运行云功能(并创建或更新标签)之前，您需要为Dataprep创建两个数据目录标签模板(<a class="ae jo" href="https://github.com/victorcouste/google-data-catalog-dataprep/blob/main/tag_templates/dataprep_metadata_tag_template.txt" rel="noopener ugc nofollow" target="_blank">作业元数据</a>和<a class="ae jo" href="https://github.com/victorcouste/google-data-catalog-dataprep/blob/main/tag_templates/dataprep_column_profile_tag_template.txt" rel="noopener ugc nofollow" target="_blank">作业列概要文件</a>)。</p><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/589bd53cd4b4b76f4496920fc0e4f356.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bOliuQU84Af61ICvj8jRaA.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">云数据准备元数据标记模板</figcaption></figure><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/055f4b25214a3d56f0fe9ff5f12c3bcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EKgosA76zBBlSGMzo5z8Cw.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">云数据准备列配置文件标记模板</figcaption></figure><p id="14f7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于此操作，您可以使用:</p><ul class=""><li id="1e37" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated"><strong class="is hj">云控制台</strong>，在这里你可以<a class="ae jo" href="https://console.cloud.google.com/datacatalog?q=type%3DTAG_TEMPLATE" rel="noopener ugc nofollow" target="_blank">管理你的标签模板</a>。</li><li id="cda3" class="jp jq hi is b it ki ix kj jb kk jf kl jj km jn ju jv jw jx bi translated"><strong class="is hj"> gcloud </strong>和命令<code class="du kp kq kr ks b">gcloud data-catalog tag-templates create. </code>你可以在<a class="ae jo" href="https://github.com/victorcouste/google-data-catalog-dataprep/blob/main/tag_templates/gcloud_tag-templates_create.sh" rel="noopener ugc nofollow" target="_blank">g cloud _ tag-templates _ create . sh</a>中找到完整的命令行，更多细节在GCP文档中有和<a class="ae jo" href="https://cloud.google.com/data-catalog/docs/quickstart-tagging#data-catalog-quickstart-gcloud" rel="noopener ugc nofollow" target="_blank">示例</a>和<a class="ae jo" href="https://cloud.google.com/sdk/gcloud/reference/data-catalog/tag-templates/create" rel="noopener ugc nofollow" target="_blank">参考</a>。但是请注意，使用gcloud命令行，您无法管理模板标签字段的顺序，字段将按字母顺序排列。</li><li id="3919" class="jp jq hi is b it ki ix kj jb kk jf kl jj km jn ju jv jw jx bi translated"><strong class="is hj"> REST API </strong>带有2个标签模板json文件<a class="ae jo" href="https://github.com/victorcouste/google-data-catalog-dataprep/blob/main/tag_templates/dataprep_metadata_tag_template.json" rel="noopener ugc nofollow" target="_blank">data prep _ metadata _ tag _ template . JSON</a>和<a class="ae jo" href="https://github.com/victorcouste/google-data-catalog-dataprep/blob/main/tag_templates/dataprep_column_profile_tag_template.json" rel="noopener ugc nofollow" target="_blank">data prep _ column _ profile _ tag _ template . JSON</a>。GCP文档中使用REST API的说明和细节，带有示例<a class="ae jo" href="https://cloud.google.com/data-catalog/docs/quickstart-tagging#data-catalog-quickstart-drest" rel="noopener ugc nofollow" target="_blank">和参考</a>和参考。</li></ul><p id="f786" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，当云函数被创建后，要使用它，您只需以JSON格式传递Dataprep作业ID，如<code class="du kp kq kr ks b">{"job_id":"7827359"}</code>。</p><p id="acb5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了从云Dataprep流中触发它，您可以在云函数端点上使用一个<a class="ae jo" href="https://docs.trifacta.com/display/DP/Create+Flow+Webhook+Task" rel="noopener ugc nofollow" target="_blank"> Webhook </a>，在POST主体中使用<code class="du kp kq kr ks b">{"job_id":"$jobId"}</code>。</p><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kt"><img src="../Images/1d73d81096e4ec049ebab708b5988eb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ewF_YMDp9zNfr6YI4D0_5g.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">Cloud Dataprep Webhook来调用数据目录云函数</figcaption></figure><p id="b9c9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当创建数据目录模板标签时，以及当在BigQuery表上创建或更新标签时，您可以从https://console.cloud.google.com/datacatalog的GCP控制台界面<a class="ae jo" href="https://console.cloud.google.com/datacatalog" rel="noopener ugc nofollow" target="_blank">中找到所有结果。</a></p><p id="c42a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，您还可以在云数据目录中搜索带有Dataprep标记的BigQuery表，该标记来自您自己的应用程序，如<a class="ae jo" href="https://github.com/victorcouste/dataprep-datacatalog-explorer" rel="noopener ugc nofollow" target="_blank">https://github . com/victorcouste/Data prep-Data Catalog-explorer</a></p><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ku"><img src="../Images/6df5b21fb16391ccd477e61a34cee15f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MygcMDagnReDA6T7OuBnBA.png"/></div></div></figure><p id="3a86" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">快乐的争吵和快乐的标记！</p></div></div>    
</body>
</html>