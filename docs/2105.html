<html>
<head>
<title>Near Real Time Data Replication using Debezium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Debezium进行近乎实时的数据复制</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/near-real-time-data-replication-using-debezium-4da77cef67ab?source=collection_archive---------0-----------------------#2022-02-11">https://medium.com/google-cloud/near-real-time-data-replication-using-debezium-4da77cef67ab?source=collection_archive---------0-----------------------#2022-02-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="44c6" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">第2部分:构建从GCP CloudSQL Postgres到GCP BigQuery的数据复制管道的详细指南</h2></div><p id="397d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本系列的第1部分中，我们以分布式的方式实现了Debezium。在第2部分中，我们将安装和配置源和接收器连接器，以将数据从CloudSQL Postgres复制到BigQuery。</p><h1 id="af1c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">什么是CloudSQL Postgres？</h1><p id="94e7" class="pw-post-body-paragraph ix iy hi iz b ja km ij jc jd kn im jf jg ko ji jj jk kp jm jn jo kq jq jr js hb bi translated">PostgreSQL是业界领先的开源关系数据库，拥有活跃且不断发展的开发者和工具生态系统。借助Cloud SQL for PostgreSQL，您现在可以在PostgreSQL数据库操作上花费更少的时间，而在应用程序上花费更多的时间。</p><h2 id="58d3" class="kr jv hi bd jw ks kt ku ka kv kw kx ke jg ky kz kg jk la lb ki jo lc ld kk le bi translated">CloudSQL Postgres特性:</h2><blockquote class="lf lg lh"><p id="da88" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">与您的PostgreSQL应用程序在主要版本上完全兼容:14、13、12、11、10、9.6 <br/>支持最流行的PostgreSQL扩展和超过100个数据库标志<br/>集成了数据库可观察性的DevOps与云SQL Insights <br/>与Google Kubernetes Engine (GKE)、BigQuery和Cloud Run等关键服务集成<br/>通过数据库迁移服务简化和安全迁移</p></blockquote><h1 id="85eb" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">什么是BigQuery？</h1><p id="199e" class="pw-post-body-paragraph ix iy hi iz b ja km ij jc jd kn im jf jg ko ji jj jk kp jm jn jo kq jq jr js hb bi translated"><strong class="iz hj"> BigQuery </strong>是一个无服务器、经济高效的多云数据仓库，旨在帮助您将大数据转化为有价值的商业见解。</p><h2 id="c1f7" class="kr jv hi bd jw ks kt ku ka kv kw kx ke jg ky kz kg jk la lb ki jo lc ld kk le bi translated">BigQuery特性:</h2><blockquote class="lf lg lh"><p id="55ec" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">借助具有内置机器学习功能的安全、可扩展平台使见解大众化<br/>借助灵活的多云分析解决方案从跨云数据中做出业务决策<br/>以比云数据仓库替代方案低26%–34%的三年总拥有成本运行大规模分析<br/>适应从字节到Pb的任何规模的数据，零运营开销</p></blockquote><h1 id="85c0" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">为什么需要将数据从Postgres等OLTP数据库复制到BigQuery等DWH数据库？</h1><p id="258e" class="pw-post-body-paragraph ix iy hi iz b ja km ij jc jd kn im jf jg ko ji jj jk kp jm jn jo kq jq jr js hb bi translated">一个组织的运营数据需求由在线事务处理(OLTP)系统来满足，这对其日常业务运营非常重要。然而，它们并不完全适合于支持决策支持查询或经理通常需要解决的业务问题。此类问题涉及分析，包括数据的<br/>汇总、钻取和切片/切块，这些最好由在线分析处理(OLAP)系统支持。像BigQuery这样的数据仓库通过以多维格式存储和维护数据来支持OLAP应用程序。OLAP仓库中的数据是从多个OLTP数据源(包括Postgres、MySQL、DB2、Oracle、SQL Server和平面文件)中提取和加载的。</p><h1 id="29c4" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">建筑:</h1><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es lm"><img src="../Images/eea064dd484384497043c3698ca3963d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v5epjUO8cu8bowts_6vgQg.png"/></div></div></figure><h1 id="43ac" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">要求:</h1><blockquote class="lf lg lh"><p id="4b37" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">CloudSQL Postgres实例</p></blockquote><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ly"><img src="../Images/7153f8b8ada0b91cf7911f6e9f933b76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jpi-MCECcV2axNIluO6zmQ.png"/></div></div></figure><blockquote class="lf lg lh"><p id="d1e8" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">BigQuery实例</p></blockquote><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es lz"><img src="../Images/a16a0bf38bec9c8437a3968af91d48c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AxYWaWxtyaP5fTz6TksLZg.png"/></div></div></figure><blockquote class="lf lg lh"><p id="63d0" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">Debezium服务【详见<a class="ae jt" rel="noopener" href="/@saurabhgupt_85545/near-real-time-data-replication-using-debezium-fd32be6d192a">第1部分</a></p></blockquote><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ma"><img src="../Images/f7eeac474717d05d00f4d67341746c09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mO46leZ6uvYcJQLjDR3YNw.png"/></div></div></figure><h1 id="a5bf" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">连接器安装</h1><p id="e524" class="pw-post-body-paragraph ix iy hi iz b ja km ij jc jd kn im jf jg ko ji jj jk kp jm jn jo kq jq jr js hb bi translated">在所有3个Debezium节点上执行以下安装步骤:</p><h2 id="6886" class="kr jv hi bd jw ks kt ku ka kv kw kx ke jg ky kz kg jk la lb ki jo lc ld kk le bi translated">安装源连接器:Debezium Postgres到Kafka连接器</h2><blockquote class="lf lg lh"><p id="05dc" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">合流-集线器安装debezium/debezium-连接器-postgres:最新</p></blockquote><h2 id="a30d" class="kr jv hi bd jw ks kt ku ka kv kw kx ke jg ky kz kg jk la lb ki jo lc ld kk le bi translated">安装接收器连接器:Kafka到BigQuery连接器</h2><blockquote class="lf lg lh"><p id="7fd4" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">合流-集线器安装wepay/kafka-connect-bigquery:最新</p></blockquote><h1 id="502b" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">连接器配置</h1><h2 id="ca52" class="kr jv hi bd jw ks kt ku ka kv kw kx ke jg ky kz kg jk la lb ki jo lc ld kk le bi translated">源连接器配置— CloudSQL Postgres</h2><blockquote class="lf lg lh"><p id="459d" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">cat ~/source.json</p><p id="98a7" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">{ <br/> "name": "sourcecloudsqlpg "，<br/>" config ":{<br/>" connector . class ":" io . debezium . connector . PostgreSQL . postgresconnector "，<br/> "database.hostname": "XX。XX.XX.XX "、<br/> "database.port": "5432 "、<br/> "database.user": "postgres "、<br/> "database.password": "*** "、<br/>" database . dbname ":" dvdrental "、<br/>" database . server . name ":" my-server "、<br/> "transforms": "route "、<br/>" transforms . route . type ":" org . Apache . Kafka . connect . transforms . regex router "]+)\\.([^.]+)\\.([^.]+)"、<br/>" transforms . route . replacement ":" $ 3 "、<br/> "plugin.name": "wal2json "、<br/>" transforms . unwrap . add . source . fields ":" ts _ ms "、<br/>" tombstones . on . delete ":" false "、<br/>" include . schema . changes ":" true "、<br/>" consistent . schema . handling . mode ":" warn "、<br/>" database . history . skip . un parse .</p></blockquote><h2 id="f2a3" class="kr jv hi bd jw ks kt ku ka kv kw kx ke jg ky kz kg jk la lb ki jo lc ld kk le bi translated">目标连接器配置— BigQuery</h2><blockquote class="lf lg lh"><p id="829a" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">cat ~/target.json</p><p id="4433" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">{ <br/> "name": "targetbigquery "，<br/>" config ":{<br/>" connector . class ":" com . wepay . Kafka . connect . bigquery . bigquerysinkconnector "，<br/> "tasks.max" : "1 "，<br/> "errors.log.enable": true，<br/>" errors . log . include . messages ":true，<br/> "topics" : "accounts "，<br/>" sanitietopics ":" true "，【T33hoistfieldkey . type ":" org . Apache . Kafka . connect . transforms . hoistfield $ Key "，<br/> "transforms。HoistFieldKey.field": "user_id "、<br/>" allowNewBigQueryFields ":" true "、<br/>" allowbigqueryrequiredfieldlaxation ":" true "、<br/>" schemaRetriever ":" com . wepay . Kafka . connect . big query . retrieve . identityschemaretriever "、<br/>" key . converter ":" org . Apache . Kafka . connect . storage . string converter "、<br/>"</p></blockquote><h2 id="6ac6" class="kr jv hi bd jw ks kt ku ka kv kw kx ke jg ky kz kg jk la lb ki jo lc ld kk le bi translated">BQ服务帐户和密钥创建步骤:</h2><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mb"><img src="../Images/d6cdc855b2b641436443d70618c0755e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SOQiYCeXAB6Iyxt9X46AVA.png"/></div></div></figure><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mc"><img src="../Images/7bb1b96d19ff7116852b25417e158a65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_jvAPL0asJ5l8d7BkvfUwg.png"/></div></div></figure><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es md"><img src="../Images/b52e4ca2e599d74ed6e762af1f7924ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*64aDsqRan4XSJW7zYEEHFw.png"/></div></div></figure><p id="c96b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下载并粘贴BigQuery接收器连接器配置文件keyfile中定义的密钥。</p><h1 id="6c1d" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">连接器注册:</h1><h2 id="bbac" class="kr jv hi bd jw ks kt ku ka kv kw kx ke jg ky kz kg jk la lb ki jo lc ld kk le bi translated">注册并启动源CloudSQL PG连接器:</h2><blockquote class="lf lg lh"><p id="df1b" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">curl-l-X POST-H " Accept:application/JSON "-H " Content-Type:application/JSON " localhost:8083/connectors/-d<a class="ae jt" href="http://twitter.com/bt" rel="noopener ugc nofollow" target="_blank">@</a>source . JSON</p></blockquote><p id="1039" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面的命令将注册并启动源CloudSQL PG连接器。一旦连接器启动，它就与源(即CloudSQL PG)连接，并获取连接器配置文件中定义的白名单表的快照，并推送kafka主题中与数据库表名同名的所有记录。根据上面的配置文件，获取<strong class="iz hj">账户</strong>表的快照，并将所有58条记录推送到名为<strong class="iz hj">账户</strong>的kafka主题。快照完成后，已更改记录的流式传输会自动开始。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es me"><img src="../Images/f9ae621179c9d25a5c0a21f79c42d268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7YmZOC2epXGzq8u1MypMuw.png"/></div></div><figcaption class="mf mg et er es mh mi bd b be z dx translated">debezium日志的快照</figcaption></figure><p id="ac09" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">列出kafka主题，并确保创建了与正在复制的postgres表同名的kafka主题。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es me"><img src="../Images/42a82ceb99b807d6373e40eef2fc560f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2gYaN70_D2NkEwMlN8v1Ng.png"/></div></div><figcaption class="mf mg et er es mh mi bd b be z dx translated">创建与Postgres表名同名的Kafka主题</figcaption></figure><p id="106f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">列出kafka主题的内容，并确保将记录流式传输到kafka主题。kafka主题中的记录数应该等于postgres表中的记录数。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mj"><img src="../Images/b042470ebff1e12156df868de69baf33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*az_FbdRe21zolQNKgHo3oQ.png"/></div></div></figure><h2 id="d3af" class="kr jv hi bd jw ks kt ku ka kv kw kx ke jg ky kz kg jk la lb ki jo lc ld kk le bi translated">注册并启动BigQuery接收器连接器:</h2><blockquote class="lf lg lh"><p id="f2cc" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">curl-l-X POST-H " Accept:application/JSON "-H " Content-Type:application/JSON " localhost:8083/connectors/-d<a class="ae jt" href="http://twitter.com/bt" rel="noopener ugc nofollow" target="_blank">@</a>target . JSON</p></blockquote><p id="56f7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以上命令将注册并启动接收器BigQuery连接器。一旦连接器启动，它就与kafka schema registry连接，获取源表(即accounts)的模式，并在BQ数据集中创建该表。BQ sink connector还创建了一个account_tmp*表。从kafka topic中读取的所有记录首先被推送到account_temp* table中，然后与父account表合并。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es me"><img src="../Images/b49f9402f5c3d0862e09c982b7b3d2ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2nkYK8dlCQdFtFoC6eP0qg.png"/></div></div><figcaption class="mf mg et er es mh mi bd b be z dx translated">BQ中自动创建的账户表</figcaption></figure><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mk"><img src="../Images/a441b4abbe8740a2932ada145ca6bcc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DDE7c6VvwT7asheMo6eWiw.png"/></div></div><figcaption class="mf mg et er es mh mi bd b be z dx translated">BQ中Debezium数据集中创建的Accounts和Accounts_tmp*表</figcaption></figure><h1 id="0527" class="ju jv hi bd jw jx jy jz ka kb kc kd ke io kf ip kg ir kh is ki iu kj iv kk kl bi translated">数据有效性</h1><h2 id="4086" class="kr jv hi bd jw ks kt ku ka kv kw kx ke jg ky kz kg jk la lb ki jo lc ld kk le bi translated">初始快照验证<br/>更改数据复制验证</h2><blockquote class="lf lg lh"><p id="df52" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">案例1:插入一条记录</p><p id="80ad" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">案例2:删除2条记录</p><p id="8603" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">案例3:更新记录</p><p id="4df7" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">案例4:修改表以添加一列并插入一条具有新结构的记录</p><p id="2bd6" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">案例5:修改表，删除一列，插入一条新结构的记录</p></blockquote><h2 id="ba81" class="kr jv hi bd jw ks kt ku ka kv kw kx ke jg ky kz kg jk la lb ki jo lc ld kk le bi translated">初始快照验证</h2><blockquote class="lf lg lh"><p id="3edf" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">来源:CloudSQL Postgres表—账户[58条记录]:</p></blockquote><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mk"><img src="../Images/d78509ae148f1b5e843df23e62ee446d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mILV6NKQmUOPOLGPnKtBHQ.png"/></div></div></figure><blockquote class="lf lg lh"><p id="9dd7" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">卡夫卡主题—账户[58个记录]</p></blockquote><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mk"><img src="../Images/85024c90268eb40213c626b11339306c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hbU9i6_fl-2zaYmXrXp4xw.png"/></div></div></figure><blockquote class="lf lg lh"><p id="19fb" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">大查询表-帐户[58条记录]</p></blockquote><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ml"><img src="../Images/ac31b5afe14027fc03c981127b964901.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YonhBFM-YDBFFyBqgOgEFQ.png"/></div></div></figure><h2 id="c1f4" class="kr jv hi bd jw ks kt ku ka kv kw kx ke jg ky kz kg jk la lb ki jo lc ld kk le bi translated">更改数据复制验证</h2><blockquote class="lf lg lh"><p id="a4bc" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">案例1:插入一条记录</p></blockquote><p id="14b5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在源cloudsql pg accounts表中插入记录。[59项记录]</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ml"><img src="../Images/fc6c0849ee8f23f0451273b46614940d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1mWUSR6Okqy--HwbKzl-AQ.png"/></div></div></figure><p id="804a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">卡夫卡专题——账户【59条记录】。最后一行显示的值与插入的值相同。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ml"><img src="../Images/17f5e51c64cfcabc290fedbc0746a599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dg6H1XTIEdt8DhOAW7RUkQ.png"/></div></div></figure><p id="0bf6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">BigQuery表-帐户[59条记录]。最后一行显示的值与插入的值相同。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mm"><img src="../Images/3bee50da03aa7a5058ccadb703617d33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Pf7m_-Z0fYhyFgZi-8bxA.png"/></div></div></figure><blockquote class="lf lg lh"><p id="675a" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">案例2:更新记录</p></blockquote><p id="7586" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从源cloudsql pg帐户表中删除2条记录。[57项记录]</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mn"><img src="../Images/74441486fc8f4f2886e0e4497ffc570d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rCovPCRY0CdFnJm-XHUrdA.png"/></div></div></figure><p id="42b3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Kafka topic [61条记录，最新条目为删除操作]</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mo"><img src="../Images/96abc5fa3b07bf836b7d912cc90d73d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TtRzkqKlVe8pnfrLl0F5Lg.png"/></div></div></figure><p id="6bd6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">BigQuery表-帐户[57条记录]。在BQ中，删除被视为软删除，因此在获取总计数时，在SQL语句的where子句中使用op &lt;&gt; 'd'。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mp"><img src="../Images/2b111b57742fbe29b479f478a9d76304.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a8GBYt7vRaix0bskLceWqA.png"/></div></div></figure><blockquote class="lf lg lh"><p id="4ae9" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">案例3:更新记录</p></blockquote><p id="9d74" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">更新源cloudsql Postgres中的一条记录[57条记录]</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mq"><img src="../Images/d522d2a5678807e15f97670029ae75ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ai4fmxe3uV6FoPEj2tDcNA.png"/></div></div></figure><p id="0551" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Kafka topic [以最新条目作为更新操作的62条记录]</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mr"><img src="../Images/493f611131ca420bd632970b559ec38e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hJ8h5182rkc9qI2CRjI0UQ.png"/></div></div></figure><p id="ce4b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">BigQuery表[包含更新数据的62条记录]</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ms"><img src="../Images/9e7c590b365892194bc18c3926ee22eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JgCvivhWERshI2W_t7NJaw.png"/></div></div></figure><blockquote class="lf lg lh"><p id="b11e" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">案例4:修改表以添加一列并插入一条具有新结构的记录</p></blockquote><p id="9f72" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过添加列来改变表结构。在cloudsql PG account表中增加一列<strong class="iz hj">城市</strong>，并插入一条记录。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mt"><img src="../Images/204a7fbac916f7175334ba1b5fd2d4ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b2skRPzN3eJvlq6VPXIphA.png"/></div></div></figure><p id="4f4a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">卡夫卡专题【新记录新栏目】</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mu"><img src="../Images/edeb71f03e3f218e19b27f8f4dc96c8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VmeMiVgbbgLg1nMBBU8cjw.png"/></div></div></figure><p id="f867" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Debezium日志指示自动模式更改</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mr"><img src="../Images/50ae45c7da608c9074b548757dee7b0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yIikWexVTBqdRZRg02QVMw.png"/></div></div></figure><p id="4740" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Bigquery表[具有最新记录的新列]:</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ly"><img src="../Images/dc99e46e87479cedf0822de7d1595cc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8cpur9qoQKwiEE9RdSolLg.png"/></div></div></figure><blockquote class="lf lg lh"><p id="29f9" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">案例5:修改表，删除一列，插入一条新结构的记录</p></blockquote><p id="39d9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过删除一列来改变表结构。在cloudsql pg表中删除列<strong class="iz hj">城市</strong>，并插入一条记录。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mr"><img src="../Images/df13d43040288c1baedc6ece24fb4757.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JbyJ5dIDTpkS-WuB3Zgx9Q.png"/></div></div></figure><p id="3242" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Debezium日志指示自动模式更改</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mv"><img src="../Images/86efbb15963982b24dd5dd0a4504b4ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WEZ7keRDTJDFiTsvFxojmQ.png"/></div></div></figure><p id="10f1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">卡夫卡专题卡夫卡专题[新记录带掉栏]:</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mv"><img src="../Images/f67b1c645885e058576177f416f9ee78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o2sr39_3LjW_290PInpHnA.png"/></div></div></figure><p id="ae16" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Bigquery表[删除City列，用新结构添加最新记录]:</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mk"><img src="../Images/c640a98ea183ab3219213da468be89a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v01THZyBHWkwZ1i0kKS-FQ.png"/></div></div></figure><p id="91e7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们已经成功地安装和配置了源和接收器连接器，并且通过无缝的模式进化复制了数据。</p><h2 id="9ee4" class="kr jv hi bd jw ks kt ku ka kv kw kx ke jg ky kz kg jk la lb ki jo lc ld kk le bi translated">有用的命令</h2><blockquote class="lf lg lh"><p id="744a" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">连接器注册验证:</p><p id="f919" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">curl-k-H " Content-Type:application/JSON "<a class="ae jt" href="https://ssh.cloud.google.com/devshell/proxy?authuser=0&amp;devshellProxyPath=%2Fconnectors%2F&amp;port=8083&amp;environment_name&amp;environment_id" rel="noopener ugc nofollow" target="_blank">http://localhost:8083/connectors/</a></p><p id="99d1" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">["sourcecloudsqlpg "，" targetbigquery"]</p><p id="c00d" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">列出卡夫卡主题</p><p id="33cc" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">usr/bin/Kafka-主题-列表-动物园管理员10.128.0.14:2181</p><p id="04e8" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">读一个卡夫卡的话题</p><p id="0f61" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">/usr/bin/Kafka-控制台-消费者-主题帐户-从头开始-引导-服务器10.128.0.14:9092</p><p id="0b9a" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">从Debezium中删除连接器</p><p id="ff2d" class="ix iy li iz b ja jb ij jc jd je im jf lj jh ji jj lk jl jm jn ll jp jq jr js hb bi translated">curl-X DELETE<a class="ae jt" href="http://localhost:8083/connectors/sourcecloudsqlpggg" rel="noopener ugc nofollow" target="_blank">http://localhost:8083/connectors/</a>&lt;connector name&gt;</p></blockquote><p id="9577" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们能够成功地建立从CloudSQL PG到BigQuery的数据复制管道。这个数据复制管道还无缝地将模式更改从源数据库[CloudSQL PG]推到目标数据库[BQ]。</p><p id="b033" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">看到你就看到你，快乐学习！</p><p id="5d33" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">索拉博。</p></div></div>    
</body>
</html>