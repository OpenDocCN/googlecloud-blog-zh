<html>
<head>
<title>Google Sheets + Cloud Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google Sheets +云运行</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-sheets-cloud-run-ffc1875d2a1?source=collection_archive---------0-----------------------#2020-08-05">https://medium.com/google-cloud/google-sheets-cloud-run-ffc1875d2a1?source=collection_archive---------0-----------------------#2020-08-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e3ade6a13a86eef02eb4ce114a6d5b74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yHwzMEoobXTV4o-V8Myw2g.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Google Sheets +云运行</figcaption></figure><p id="8121" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在5分钟内，我们将快速安全地将<strong class="iw hj"> Google Sheets </strong> <strong class="iw hj"> API </strong>集成到您的<strong class="iw hj">云运行</strong>应用中。只需复制&amp;粘贴下面的文档脚本。</p><h2 id="1d23" class="js jt hi bd ju jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km bi translated">TL；速度三角形定位法(dead reckoning)</h2><ol class=""><li id="191f" class="kn ko hi iw b ix kp jb kq jf kr jj ks jn kt jr ku kv kw kx bi translated"><strong class="iw hj">下载<em class="ky">服务账号</em>凭证</strong></li><li id="ff85" class="kn ko hi iw b ix kz jb la jf lb jj lc jn ld jr ku kv kw kx bi translated"><strong class="iw hj">与服务帐户电子邮件共享</strong>谷歌表单</li><li id="5d4e" class="kn ko hi iw b ix kz jb la jf lb jj lc jn ld jr ku kv kw kx bi translated"><strong class="iw hj">启用</strong>谷歌工作表API </li><li id="58e6" class="kn ko hi iw b ix kz jb la jf lb jj lc jn ld jr ku kv kw kx bi translated">写一些<strong class="iw hj">节点</strong></li><li id="799a" class="kn ko hi iw b ix kz jb la jf lb jj lc jn ld jr ku kv kw kx bi translated">部署到<strong class="iw hj">云运行</strong></li></ol><h1 id="262e" class="le jt hi bd ju lf lg lh jy li lj lk kc ll lm ln kf lo lp lq ki lr ls lt kl lu bi translated">步骤1:下载凭据🤖</h1><p id="1bc6" class="pw-post-body-paragraph iu iv hi iw b ix kp iz ja jb kq jd je jf lv jh ji jj lw jl jm jn lx jp jq jr hb bi translated">创建一个<em class="ky">服务帐户</em>，并在一个名为<code class="du ly lz ma mb b">creds.json</code>的新文件中下载一个密钥。</p><figure class="mc md me mf fd ij"><div class="bz dy l di"><div class="mg mh l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">创建服务帐户，下载服务帐户密钥，并复制服务帐户的电子邮件。或者使用<a class="ae mi" href="https://console.cloud.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank"> UI </a>。</figcaption></figure><p id="3b46" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">该凭证具有唯一的id: <code class="du ly lz ma mb b">sa-name@$PROJECT.iam.gserviceaccount.com</code></p><h1 id="9d1f" class="le jt hi bd ju lf lg lh jy li lj lk kc ll lm ln kf lo lp lq ki lr ls lt kl lu bi translated">2.与服务帐户共享Google表单🔗</h1><p id="d5c9" class="pw-post-body-paragraph iu iv hi iw b ix kp iz ja jb kq jd je jf lv jh ji jj lw jl jm jn lx jp jq jr hb bi translated">创建一个新的谷歌工作表，如果你还没有的话</p><p id="44aa" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">以<strong class="iw hj">服务账户邮箱</strong>(如上)作为<strong class="iw hj"> e <em class="ky"> ditor </em> </strong>分享</strong>Google Sheet:</p><figure class="mc md me mf fd ij er es paragraph-image"><div class="er es mj"><img src="../Images/321d15581afeb07a6b747f21593654dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:388/format:webp/1*Lo4Mpgxx_tHiIu_rz9Xlqg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">单击工作表右上角“共享”按钮。(如果您尚未命名工作表，请命名)。</figcaption></figure><figure class="mc md me mf fd ij er es paragraph-image"><div class="er es mk"><img src="../Images/0cacf3fa197a0c604cfa03a6eb4feb22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*rXUc52V1hxP-16oRrthfbw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">对于有效的服务帐户，服务帐户电子邮件应自动完成。</figcaption></figure><blockquote class="ml mm mn"><p id="cb21" class="iu iv ky iw b ix iy iz ja jb jc jd je mo jg jh ji mp jk jl jm mq jo jp jq jr hb bi translated">如果您需要以编程方式完成这项工作，您可以使用Drive API并通过<code class="du ly lz ma mb b"><a class="ae mi" href="https://developers.google.com/drive/api/v3/reference/permissions/create" rel="noopener ugc nofollow" target="_blank"><em class="hi">drive.v3.files.permissions.create</em></a></code>与服务帐户共享。</p></blockquote><h1 id="174d" class="le jt hi bd ju lf lg lh jy li lj lk kc ll lm ln kf lo lp lq ki lr ls lt kl lu bi translated">3.启用Google Sheets API📃</h1><p id="ea02" class="pw-post-body-paragraph iu iv hi iw b ix kp iz ja jb kq jd je jf lv jh ji jj lw jl jm jn lx jp jq jr hb bi translated">通过<code class="du ly lz ma mb b">gcloud</code> CLI(或<a class="ae mi" href="http://console.developers.google.com/apis/api/sheets.googleapis.com" rel="noopener ugc nofollow" target="_blank"> UI </a>)为您的项目启用Sheets API:</p><pre class="mc md me mf fd mr mb ms mt aw mu bi"><span id="9190" class="js jt hi mb b fi mv mw l mx my">gcloud services enable sheets.googleapis.com</span></pre><h1 id="cbb1" class="le jt hi bd ju lf lg lh jy li lj lk kc ll lm ln kf lo lp lq ki lr ls lt kl lu bi translated">4.写一些节点⬢</h1><p id="90e4" class="pw-post-body-paragraph iu iv hi iw b ix kp iz ja jb kq jd je jf lv jh ji jj lw jl jm jn lx jp jq jr hb bi translated">用这个<code class="du ly lz ma mb b">package.json</code>创建一个简单的节点应用程序:</p><figure class="mc md me mf fd ij"><div class="bz dy l di"><div class="mg mh l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">一个基本的package.json，在这个例子中，使用了<a class="ae mi" href="https://github.com/GoogleCloudPlatform/functions-framework-nodejs" rel="noopener ugc nofollow" target="_blank">函数框架</a>。</figcaption></figure><p id="ad6f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">和一个在<code class="du ly lz ma mb b">index.js</code>用我们的服务账号授权的节点程序:</p><figure class="mc md me mf fd ij"><div class="bz dy l di"><div class="mg mh l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">一个节点程序，使用我们的creds.json进行授权，并在工作表中添加一行。</figcaption></figure><p id="8de5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">在</strong> <code class="du ly lz ma mb b">index.js</code> <strong class="iw hj">中，用您创建的工作表的ID替换您的</strong> <code class="du ly lz ma mb b"><strong class="iw hj">SPREADSHEET_ID</strong></code> <strong class="iw hj">。</strong>否则你会得到错误:“错误:没有找到请求的实体。”</p><p id="7a7a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，您可以使用以下命令在本地运行该程序:</p><pre class="mc md me mf fd mr mb ms mt aw mu bi"><span id="1be3" class="js jt hi mb b fi mv mw l mx my">npm i &amp;&amp; npm start</span></pre><p id="5dea" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后转到<code class="du ly lz ma mb b">localhost:8080</code>(或<code class="du ly lz ma mb b">curl <a class="ae mi" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a>/</code>)测试并通过编程创建一个新行。预热需要一点时间，但从我的测试来看很快(&lt; 1秒)。</p><figure class="mc md me mf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mz"><img src="../Images/8b2c4788858f08727573d8feb99dc779.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KPmqJw4pBhrUdLMw3W08Aw.gif"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">发出一个localhost HTTP请求会在我们的Google工作表中添加一行！</figcaption></figure><h1 id="1065" class="le jt hi bd ju lf lg lh jy li lj lk kc ll lm ln kf lo lp lq ki lr ls lt kl lu bi translated">5.部署到云运行💨👟</h1><p id="908f" class="pw-post-body-paragraph iu iv hi iw b ix kp iz ja jb kq jd je jf lv jh ji jj lw jl jm jn lx jp jq jr hb bi translated">要部署生产服务器，您需要添加一个<code class="du ly lz ma mb b">Dockerfile</code>:</p><figure class="mc md me mf fd ij"><div class="bz dy l di"><div class="mg mh l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">Dockerfile文件</figcaption></figure><p id="14c3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后在Google Cloud上构建并运行您的容器:</p><pre class="mc md me mf fd mr mb ms mt aw mu bi"><span id="c745" class="js jt hi mb b fi mv mw l mx my">GCP_PROJECT=$(gcloud config list --format 'value(core.project)' 2&gt;/dev/null)</span><span id="9205" class="js jt hi mb b fi na mw l mx my">gcloud builds submit \<br/>--tag gcr.io/$GCP_PROJECT/sheets-on-run</span><span id="0ee6" class="js jt hi mb b fi na mw l mx my">gcloud run deploy sheets-on-run \<br/>--image gcr.io/$GCP_PROJECT/sheets-on-run \<br/>--platform managed \<br/>--allow-unauthenticated</span></pre><p id="cc00" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于这个示例，每当我们通过URL访问我们的云运行服务时，我们将向Google Sheet添加一个新行。</p><p id="0333" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">太好了！现在你的床单已经“连接”运行了，你的思想就是你用这种力量所能做的极限。创建一些很酷的应用程序。:)</p><h1 id="565b" class="le jt hi bd ju lf lg lh jy li lj lk kc ll lm ln kf lo lp lq ki lr ls lt kl lu bi translated">后续步骤</h1><p id="e5cf" class="pw-post-body-paragraph iu iv hi iw b ix kp iz ja jb kq jd je jf lv jh ji jj lw jl jm jn lx jp jq jr hb bi translated">感谢阅读！我喜欢使用Google Sheets作为显示数据的简单用户界面。它速度快，功能强大，而且免费！</p><p id="7b12" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可能会对这些相关资源感兴趣:</p><ul class=""><li id="3577" class="kn ko hi iw b ix iy jb jc jf nb jj nc jn nd jr ne kv kw kx bi translated"><a class="ae mi" href="https://github.com/theoephraim/node-google-spreadsheet" rel="noopener ugc nofollow" target="_blank">节点的流行社区库包装器</a></li><li id="d9a5" class="kn ko hi iw b ix kz jb la jf lb jj lc jn ld jr ne kv kw kx bi translated"><a class="ae mi" href="https://developers.google.com/sheets/api/limits" rel="noopener ugc nofollow" target="_blank"> Google Sheets API V4使用限制</a></li></ul></div></div>    
</body>
</html>