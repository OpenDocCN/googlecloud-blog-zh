<html>
<head>
<title>Install Secure Helm In Google Kubernetes Engine (GKE)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在谷歌Kubernetes引擎(GKE)安装安全头盔</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/install-secure-helm-in-gke-254d520061f7?source=collection_archive---------0-----------------------#2018-08-21">https://medium.com/google-cloud/install-secure-helm-in-gke-254d520061f7?source=collection_archive---------0-----------------------#2018-08-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7dab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的上一篇文章中，我谈了很多Helm的乐趣，以及为什么您应该花时间将它安装到您的Kubernetes集群中。如果你需要复习，现在就去阅读那篇文章吧。</p><div class="je jf ez fb jg jh"><a rel="noopener follow" target="_blank" href="/@jonbcampos/installing-helm-in-google-kubernetes-engine-7f07f43c536e"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">在Google Kubernetes引擎中安装Helm</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">当我第一次真正开始进入Kubernetes时，我会去寻找各种必要程序的docker图像…</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">medium.com</p></div></div><div class="jq l"><div class="jr l js jt ju jq jv jw jh"/></div></div></a></div><p id="1ca3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上一篇文章中，我们确实谈到了保护Helm和Tiller服务器的重要性，这个服务器负责将容器实际安装到您的Kubernetes中。你不会希望有人通过Tiller进入你的Kubernetes集群，并在你不知情的情况下开始安装各种容器。为了防止这种情况，我们需要进一步安装Helm，并添加<a class="ae jd" href="https://en.wikipedia.org/wiki/Transport_Layer_Security" rel="noopener ugc nofollow" target="_blank">传输层安全(TLS) </a>。</p><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es jx"><img src="../Images/5490744583da2d8b3161f48709efee54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_Kzfjo3kn9LbTqqa"/></div></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">照片由<a class="ae jd" href="https://unsplash.com/@neonbrand?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> NeONBRAND </a>在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="01bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不过不要担心，这不会太痛苦，幸运的是，我已经完成了最难的部分。在这篇文章中，我们将看看如何为您的安全头盔安装创建必要的密钥，一些困扰互联网上许多人的陷阱，然后是如何安装头盔图表的快速示例，现在我们已经有了TLS安全设置。</p><p id="d037" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="km">如果你还没有通读或者甚至没有阅读过本系列</em>  <em class="km">的第一部分，你可能会感到困惑，对代码在哪里或者之前做了什么有疑问。记住这里假设你正在使用</em><a class="ae jd" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank"><em class="km">GCP</em></a><em class="km">和</em><a class="ae jd" href="https://cloud.google.com/kubernetes-engine/" rel="noopener ugc nofollow" target="_blank"><em class="km">GKE</em></a><em class="km">。我将始终提供代码和如何测试代码是按预期工作。</em></p><div class="je jf ez fb jg jh"><a rel="noopener follow" target="_blank" href="/google-cloud/kubernetes-day-one-30a80b5dcb29"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">库伯内特:第一天</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">这是Kubernetes帖子的必选步骤之一。如果你对Kubernetes感兴趣，你可能已经读过100本了…</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">medium.com</p></div></div><div class="jq l"><div class="kn l js jt ju jq jv jw jh"/></div></div></a></div><blockquote class="ko kp kq"><p id="a0ec" class="if ig km ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated">注意:Helm网站确实包括许多关于安全Helm安装的<a class="ae jd" href="https://docs.helm.sh/using_helm/#securing-your-helm-installation" rel="noopener ugc nofollow" target="_blank">伟大文档</a>，但是我觉得很高兴看到在一个工作示例中所有东西是如何联系在一起的，以及如何帮助解决一些一直阻碍的问题。我建议<a class="ae jd" href="https://docs.helm.sh/using_helm/#securing-your-helm-installation" rel="noopener ugc nofollow" target="_blank">在某个时候通读他们的文档</a>。</p></blockquote><h1 id="206d" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">创建TLS密钥</h1><p id="7244" class="pw-post-body-paragraph if ig hi ih b ii ls ik il im lt io ip iq lu is it iu lv iw ix iy lw ja jb jc hb bi translated"><strong class="ih hj">警告</strong> <em class="km">警告</em> <strong class="ih hj"> <em class="km">警告</em> </strong>！这是几乎所有人都搞砸的一步。所有这些都正确后，接下来的步骤就很简单了。</p><p id="007a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们如何解决密钥创建混乱的问题？简单。我们真正理解关键的开发过程，然后它真的很简单。大多数人犯错误的地方是他们只是从互联网上复制半解释的脚本，然后不知道为什么事情会变糟。所以让我们开始了解关键的开发过程。</p><p id="1d2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这一切都是从使用<code class="du lx ly lz ma b">openssl</code>命令构建我们的主认证机构(CA)密钥开始的。</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="633e" class="mf kv hi ma b fi mg mh l mi mj">openssl genrsa -out ca.key.pem 4096</span></pre><p id="28f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将生成一个证书颁发机构(CA)密钥，该密钥将用于签署该过程中的其他密钥。所以我们可以形象地想到这个，让我们把这个键标为<code class="du lx ly lz ma b">A</code>。</p><figure class="jy jz ka kb fd kc er es paragraph-image"><div class="er es mk"><img src="../Images/ad5658b7b87f6ed92f6d5c0428e624af.png" data-original-src="https://miro.medium.com/v2/resize:fit:288/format:webp/1*tLDYt59KN36kEWwYZxTySA.png"/></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">密钥“A”—证书颁发机构密钥— ca.key.pem</figcaption></figure><p id="240f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">准备好该密钥后，我们需要创建一个证书，用该密钥和有关贵公司/组织的各种信息进行签名。</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="ce77" class="mf kv hi ma b fi mg mh l mi mj">openssl req -key ca.key.pem -new -x509 \<br/>    -days 7300 -sha256 \<br/>    -out ca.cert.pem \<br/>    -extensions v3_ca \<br/>    -subj "${SUBJECT}"</span></pre><figure class="jy jz ka kb fd kc er es paragraph-image"><div class="er es ml"><img src="../Images/f9fc2f78748ff86a2c15acb29401e10f.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*TvfVRZazUThiZgLd_h7bWg.png"/></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">用密钥“A”和您的信息签名的证书— ca.cert.pem</figcaption></figure><p id="4e55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来我们需要为Tiller创建一个键——管理舵图的舵服务器。您需要为每个Tiller主机创建一个关键点。在这种情况下，我们只有一个，所以我们只需要一个。</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="2cce" class="mf kv hi ma b fi mg mh l mi mj">openssl genrsa -out tiller.key.pem 4096</span></pre><figure class="jy jz ka kb fd kc er es paragraph-image"><div class="er es mk"><img src="../Images/4ff6044f82571bd3424133c6adb52d52.png" data-original-src="https://miro.medium.com/v2/resize:fit:288/format:webp/1*YsqMO6QX4w_m3YyP9PQqqg.png"/></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">密钥“B”—Tiller主机密钥— tiller.key.pem</figcaption></figure><p id="2443" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让人们困惑的部分。我们需要为Tiller主机密钥(密钥“B”)创建一个证书，该证书也由贵公司/组织签署，并由原始证书签署。这样做是因为将来您可能需要使密钥过期，但您仍然可以根据原始证书进行测试，原始证书以数学方式嵌入到您的签名证书中。</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="7008" class="mf kv hi ma b fi mg mh l mi mj">openssl req -new -sha256 \<br/>    -key tiller.key.pem \<br/>    -out tiller.csr.pem \<br/>    -subj "${SUBJECT}"<br/>openssl x509 -req -days 365 \<br/>    -CA ca.cert.pem \<br/>    -CAkey ca.key.pem \<br/>    -CAcreateserial \<br/>    -in tiller.csr.pem \<br/>    -out tiller.cert.pem</span></pre><figure class="jy jz ka kb fd kc er es paragraph-image"><div class="er es ml"><img src="../Images/8edafb6655ac2fdbbfdbabfce675a343.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*Ox7JzH32tybZoa_wxZiiug.png"/></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">用密钥“A”和密钥“B”签名的证书以及您的信息— tiller.cert.pem</figcaption></figure><p id="5513" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们还需要为所有需要访问Helm的用户重复同样的过程。在这种情况下，我们只有一个用户，我们称之为“<code class="du lx ly lz ma b">Helm</code>”。如果出于安全需要，您有多个用户，只需重复这个过程:为用户创建一个密钥，然后将这个密钥与原始证书混合在一起，创建一个用户证书。</p><figure class="jy jz ka kb fd kc er es paragraph-image"><div class="er es mk"><img src="../Images/6bb390a9af199ec4ca1a398ce26e4591.png" data-original-src="https://miro.medium.com/v2/resize:fit:288/format:webp/1*mrPjyDPt_6KVKDrWV1AbXg.png"/></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">键“C”—舵主机键— helm.key.pem</figcaption></figure><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="7b6b" class="mf kv hi ma b fi mg mh l mi mj">openssl genrsa -out helm.key.pem 4096</span></pre><p id="a756" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以及<code class="du lx ly lz ma b">Helm</code>用户证书所需的代码。</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="997e" class="mf kv hi ma b fi mg mh l mi mj">openssl req -new -sha256 \<br/>    -key helm.key.pem \<br/>    -out helm.csr.pem \<br/>    -subj "${SUBJECT}"<br/>openssl x509 -req -days 365 \<br/>    -CA ca.cert.pem \<br/>    -CAkey ca.key.pem \<br/>    -CAcreateserial \<br/>    -in helm.csr.pem \<br/>    -out helm.cert.pem</span></pre><p id="f486" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">生成最终的<code class="du lx ly lz ma b">Helm</code>用户证书，该证书为用户签名，但数学上也包含第一个密钥。</p><figure class="jy jz ka kb fd kc er es paragraph-image"><div class="er es ml"><img src="../Images/0627fcae01141202e58e5581a90257a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*_-gvf8ljY-KM-i1m8EV5SA.png"/></div><figcaption class="ki kj et er es kk kl bd b be z dx translated">用密钥“A”和密钥“C”签名的证书以及您的信息— helm.cert.pem</figcaption></figure><p id="c203" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">准备好所有这些文件，并正确地放在一起，接下来的步骤进行得很快。</p><h1 id="fb50" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">安装带TLS的舵</h1><p id="edd6" class="pw-post-body-paragraph if ig hi ih b ii ls ik il im lt io ip iq lu is it iu lv iw ix iy lw ja jb jc hb bi translated">现在一切都准备好了，我们只需要安装头盔。我们会给赫尔姆舵柄证书和钥匙以及原件<code class="du lx ly lz ma b">ca.cert.pem</code>。这很重要，因为将来各种各样的用户会带着他们自己的证书来到Helm(在我们的例子中是<code class="du lx ly lz ma b">Helm</code>用户),想要访问我们的Helm实例。Helm用数学方法对照<code class="du lx ly lz ma b">ca.cert.pem</code>检查用户的数学接受度，然后允许或拒绝用户。</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="4c0b" class="mf kv hi ma b fi mg mh l mi mj">helm init \<br/>    --tiller-tls \<br/>    --tiller-tls-cert tiller.cert.pem \<br/>    --tiller-tls-key tiller.key.pem \<br/>    --tiller-tls-verify \<br/>    --tls-ca-cert ca.cert.pem \<br/>    --service-account tiller</span></pre><p id="01e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们安装的Helm实例已经知道了将来进行安全检查所需的所有信息。</p><h1 id="2e16" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">用TLS装置检验你的舵</h1><p id="3ce5" class="pw-post-body-paragraph if ig hi ih b ii ls ik il im lt io ip iq lu is it iu lv iw ix iy lw ja jb jc hb bi translated">您可以通过让<code class="du lx ly lz ma b">Helm</code>用户尝试与Helm交互来验证Helm是否已安装并正确使用TLS。我们只需要调用一个已安装的舵图表列表就可以做到这一点。如果成功，我们将看不到任何回应。如果不成功，则出现错误。</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="7b17" class="mf kv hi ma b fi mg mh l mi mj">helm ls --tls \<br/>    --tls-ca-cert ca.cert.pem \<br/>    --tls-cert helm.cert.pem \<br/>    --tls-key helm.key.pem</span></pre><p id="9a4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随着一个成功的响应，你已经看到这个Helm命令需要太多的参数，对于懒惰的编码者来说是不友好的。因此，我们将证书信息移动到我们的<code class="du lx ly lz ma b">helm home</code>目录中。</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="64ad" class="mf kv hi ma b fi mg mh l mi mj">cp ca.cert.pem $(helm home)/ca.pem<br/>cp helm.cert.pem $(helm home)/cert.pem<br/>cp helm.key.pem $(helm home)/key.pem</span></pre><p id="ba26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们可以运行相同的命令和Helm，并在将来的调用中假设证书信息。</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="5a79" class="mf kv hi ma b fi mg mh l mi mj">helm ls <strong class="ma hj">--tls # we just need to add --tls to our Helm commands!</strong></span></pre><p id="ddfe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">再次成功！现在让我们安装一个舵图。</p><h1 id="7b1a" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">安全安装舵图</h1><p id="5560" class="pw-post-body-paragraph if ig hi ih b ii ls ik il im lt io ip iq lu is it iu lv iw ix iy lw ja jb jc hb bi translated">如果你在我的上一篇<a class="ae jd" rel="noopener" href="/google-cloud/installing-helm-in-google-kubernetes-engine-7f07f43c536e"> install Helm(不安全地)文章</a>中看到了如何安装Redis，那么这个命令看起来会很熟悉。唯一的不同是我们现在必须给我们的舵命令添加<code class="du lx ly lz ma b">--tls</code>。其他都一样。</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="2a5a" class="mf kv hi ma b fi mg mh l mi mj">helm install stable/redis \<br/>    <strong class="ma hj">--tls \ # look! this is the only change!</strong><br/>    --values values/values-production.yaml \<br/>    --name redis-system</span></pre><p id="35b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嘣！现在一切都应该正常了。显然，如果我包含一个工作示例，我可以让每个人都更容易做到这一点。接下来让我们看看。</p><h1 id="315a" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">使用提供的脚本快速安装安全头盔</h1><p id="1de7" class="pw-post-body-paragraph if ig hi ih b ii ls ik il im lt io ip iq lu is it iu lv iw ix iy lw ja jb jc hb bi translated">现在我们已经完全了解了一切是如何运作的。让我们变得懒惰，通过把它放入一个我们可以运行并为我们处理所有步骤的脚本来[半]忘记一切。</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="4ee1" class="mf kv hi ma b fi mg mh l mi mj">$ git clone <a class="ae jd" href="https://github.com/jonbcampos/kubernetes-series.git" rel="noopener ugc nofollow" target="_blank">https://github.com/jonbcampos/kubernetes-series.git</a><br/>$ cd <a class="ae jd" href="https://github.com/jonbcampos/kubernetes-series/tree/master/helm/scripts" rel="noopener ugc nofollow" target="_blank">~/kubernetes-series/helm/scripts</a><br/>$ sh <a class="ae jd" href="https://github.com/jonbcampos/kubernetes-series/blob/master/helm/scripts/startup.sh" rel="noopener ugc nofollow" target="_blank">startup.sh</a><br/>$ sh <a class="ae jd" href="https://github.com/jonbcampos/kubernetes-series/blob/master/helm/scripts/add_secure_helm.sh" rel="noopener ugc nofollow" target="_blank">add_secure_helm.sh</a><br/>$ sh <a class="ae jd" href="https://github.com/jonbcampos/kubernetes-series/blob/master/helm/scripts/add__secure_redis.sh" rel="noopener ugc nofollow" target="_blank">add_secure_redis.sh</a></span></pre><p id="ac0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您在Google Shell控制台中运行这些命令，那么您将会看到一切都已设置好，可以进行积极的开发了。刺激又轻松！</p><h1 id="d568" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">用证书观察这些陷阱</h1><p id="96b8" class="pw-post-body-paragraph if ig hi ih b ii ls ik il im lt io ip iq lu is it iu lv iw ix iy lw ja jb jc hb bi translated">大多数人(包括我在内)似乎都会遇到以下问题。</p><ul class=""><li id="92fe" class="mm mn hi ih b ii ij im in iq mo iu mp iy mq jc mr ms mt mu bi translated">混淆密钥(CA)和证书(CERT)以及证书签名请求(CSR)。如果您没有正确命名您的CA、CERT和CSR，那么很容易混淆您正在签署哪个CA、哪个CSR以及最终签署哪个CERT。确保命名是有目的地设置的，这样你就不会把事情弄糟。</li><li id="bd46" class="mm mn hi ih b ii mv im mw iq mx iu my iy mz jc mr ms mt mu bi translated">我发现你<strong class="ih hj">有</strong>设置签约主体，具体是常用名(CN)有这个作品。我最初尝试使用<code class="du lx ly lz ma b">-batch</code>命令，但是由于这个原因<code class="du lx ly lz ma b">helm init</code>命令一直失败。一旦我在主题中设置了CN，一切都开始工作了。</li><li id="c17e" class="mm mn hi ih b ii mv im mw iq mx iu my iy mz jc mr ms mt mu bi translated">当我们将证书移入<code class="du lx ly lz ma b">helm home</code>时，请注意头盔会有一些重命名。您需要确保移动了正确的证书和密钥。</li></ul><h1 id="0cba" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">更多关于安全头盔安装的最佳实践</h1><p id="ca4d" class="pw-post-body-paragraph if ig hi ih b ii ls ik il im lt io ip iq lu is it iu lv iw ix iy lw ja jb jc hb bi translated">如果你特别偏执，想要更进一步，这里有一些方法可以做到这一点。</p><ul class=""><li id="b846" class="mm mn hi ih b ii ij im in iq mo iu mp iy mq jc mr ms mt mu bi translated">您可以通过为Helm/Tiller专门创建一个名称空间来进一步细分Tiller，从而提高安全性。</li><li id="9b22" class="mm mn hi ih b ii mv im mw iq mx iu my iy mz jc mr ms mt mu bi translated">在我的例子中，我包括了一个专门针对Helm/Tiller的Kubernetes服务帐户。这有助于再次为你的头盔安装提供更多的安全性。</li><li id="2824" class="mm mn hi ih b ii mv im mw iq mx iu my iy mz jc mr ms mt mu bi translated">您可以继续使用基于辊的访问控制来保护您的舵/舵杆安装(RBAC)。我强烈推荐<a class="ae jd" href="https://docs.helm.sh/using_helm/#role-based-access-control" rel="noopener ugc nofollow" target="_blank">去查阅文档，看看如何将RBAC </a>添加到你的舵/舵杆装置中。</li></ul><h1 id="8783" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h1><p id="75cb" class="pw-post-body-paragraph if ig hi ih b ii ls ik il im lt io ip iq lu is it iu lv iw ix iy lw ja jb jc hb bi translated">这更多的是你对Helm post的“最佳实践”,这可能是你对我上一篇文章的期望。我认为这是专家推荐的路线。现在你应该已经在你的谷歌Kubernetes集群舵/舵安装和一个简单/安全的方式添加舵图表。使您的开发周期更短、更有效。</p><h1 id="549a" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">拆卸</h1><p id="3a77" class="pw-post-body-paragraph if ig hi ih b ii ls ik il im lt io ip iq lu is it iu lv iw ix iy lw ja jb jc hb bi translated">在您离开之前，请确保清理您的项目，这样您就不会为您用来运行群集的虚拟机付费。返回到云Shell并运行teardown脚本来清理您的项目。这将删除您的集群和我们构建的容器。</p><pre class="jy jz ka kb fd mb ma mc md aw me bi"><span id="8f29" class="mf kv hi ma b fi mg mh l mi mj">$ cd <a class="ae jd" href="https://github.com/jonbcampos/kubernetes-series/tree/master/helm/scripts" rel="noopener ugc nofollow" target="_blank">~/kubernetes-series/helm/scripts</a><br/>$ sh <a class="ae jd" href="https://github.com/jonbcampos/kubernetes-series/blob/master/helm/scripts/teardown.sh" rel="noopener ugc nofollow" target="_blank">teardown.sh</a></span></pre></div><div class="ab cl na nb gp nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="hb hc hd he hf"><h1 id="be0a" class="ku kv hi bd kw kx nh kz la lb ni ld le lf nj lh li lj nk ll lm ln nl lp lq lr bi translated">本系列的其他文章</h1><div class="je jf ez fb jg jh"><a rel="noopener follow" target="_blank" href="/@jonbcampos/installing-helm-in-google-kubernetes-engine-7f07f43c536e"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">在Google Kubernetes引擎中安装Helm</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">当我第一次真正开始进入Kubernetes时，我会去寻找各种必要程序的docker图像…</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">medium.com</p></div></div><div class="jq l"><div class="jr l js jt ju jq jv jw jh"/></div></div></a></div><div class="je jf ez fb jg jh"><a rel="noopener follow" target="_blank" href="/google-cloud/kubernetes-running-background-tasks-with-batch-jobs-56482fbc853"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">Kubernetes:使用批处理作业运行后台任务</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">当构建令人惊叹的应用程序时，有时您可能想要处理用户之外的动作…</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">medium.com</p></div></div><div class="jq l"><div class="nm l js jt ju jq jv jw jh"/></div></div></a></div><div class="je jf ez fb jg jh"><a rel="noopener follow" target="_blank" href="/google-cloud/kubernetes-run-a-pod-per-node-with-daemon-sets-f77ce3f36bf1"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">Kubernetes:用守护进程集在每个节点上运行一个Pod</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">我最初给这篇文章起的标题只是“守护进程集”,并假设它足以抓住要点…</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">medium.com</p></div></div><div class="jq l"><div class="nn l js jt ju jq jv jw jh"/></div></div></a></div><div class="je jf ez fb jg jh"><a rel="noopener follow" target="_blank" href="/google-cloud/kubernetes-cron-jobs-455fdc32e81a"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">库伯内特:克朗·乔布斯</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">有时候你的工作不是事务性的。我们不再等待用户点击按钮让系统亮起来…</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">medium.com</p></div></div><div class="jq l"><div class="no l js jt ju jq jv jw jh"/></div></div></a></div><div class="je jf ez fb jg jh"><a rel="noopener follow" target="_blank" href="/google-cloud/kubernetes-dns-proxy-with-services-d7d9e800c329"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">Kubernetes:带服务的DNS代理</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">构建应用程序时，通常需要与外部服务进行交互来完成业务…</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">medium.com</p></div></div><div class="jq l"><div class="np l js jt ju jq jv jw jh"/></div></div></a></div><div class="je jf ez fb jg jh"><a rel="noopener follow" target="_blank" href="/google-cloud/kubernetes-routing-internal-services-through-fqdn-d98db92b79d3"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">Kubernetes:通过FQDN路由内部服务</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">我记得当我第一次进入Kubernetes时。一切都是崭新的、闪亮的、有规模的。当我继续的时候…</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">medium.com</p></div></div><div class="jq l"><div class="nq l js jt ju jq jv jw jh"/></div></div></a></div><div class="je jf ez fb jg jh"><a rel="noopener follow" target="_blank" href="/google-cloud/kubernetes-liveness-checks-4e73c631661f"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">Kubernetes:活性检查</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">最近，我整理了一篇关于Kubernetes就绪性调查以及它对您的集群有多重要的文章…</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">medium.com</p></div></div><div class="jq l"><div class="nr l js jt ju jq jv jw jh"/></div></div></a></div><div class="je jf ez fb jg jh"><a href="https://itnext.io/kubernetes-readiness-probe-83f8a06d33d3" rel="noopener  ugc nofollow" target="_blank"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">Kubernetes:就绪探测</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">如果对这个特性有任何疑问，我写这篇文章是为了说明这不是一个…</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">itnext.io</p></div></div><div class="jq l"><div class="ns l js jt ju jq jv jw jh"/></div></div></a></div><div class="je jf ez fb jg jh"><a rel="noopener follow" target="_blank" href="/google-cloud/kubernetes-horizontal-pod-scaling-190e95c258f5"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">Kubernetes:水平Pod缩放</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">通过Pod自动扩展，您的Kubernetes集群可以监控现有Pod的负载，并确定我们是否需要更多…</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">medium.com</p></div></div><div class="jq l"><div class="nt l js jt ju jq jv jw jh"/></div></div></a></div><div class="je jf ez fb jg jh"><a rel="noopener follow" target="_blank" href="/google-cloud/kubernetes-cluster-autoscaler-f1948a0f686d"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">Kubernetes:集群自动缩放</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">自动缩放是Kubernetes的一个巨大的(并且已经上市的)特性。当你的网站/应用程序/应用程序接口/项目变得越来越大时，洪水…</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">medium.com</p></div></div><div class="jq l"><div class="nu l js jt ju jq jv jw jh"/></div></div></a></div><div class="je jf ez fb jg jh"><a rel="noopener follow" target="_blank" href="/google-cloud/kubernetes-day-one-30a80b5dcb29"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">Kubernetes:第一天</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">这是Kubernetes帖子的必选步骤之一。如果你对Kubernetes感兴趣，你可能已经读过100本了…</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">medium.com</p></div></div><div class="jq l"><div class="kn l js jt ju jq jv jw jh"/></div></div></a></div></div><div class="ab cl na nb gp nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="hb hc hd he hf"><p id="431e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi nv translated">问问题？反馈？我很想听听你可能会遇到什么问题，或者这是否有助于你更好地理解。如果我错过了什么，也可以随意分享。我们都在一起！</p></div><div class="ab cl na nb gp nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="hb hc hd he hf"><p id="1551" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="http://jonbcampos.com/" rel="noopener ugc nofollow" target="_blank"> Jonathan Campos </a>是一个狂热的开发者，喜欢学习新事物。我相信我们应该不断学习、成长和失败。我总是开发社区的支持者，并且总是愿意提供帮助。因此，如果你对这个故事有任何问题或意见，请在下面提出。在<a class="ae jd" href="https://www.linkedin.com/in/jonbcampos/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或<a class="ae jd" href="https://twitter.com/jonbcampos" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上与我联系，并提及这个故事。</p></div></div>    
</body>
</html>