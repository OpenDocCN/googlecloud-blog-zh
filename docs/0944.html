<html>
<head>
<title>Stackdriver Monitoring Automation Part 6: Uptime Checks with Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Stackdriver监控自动化第6部分:使用Terraform检查正常运行时间</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/stackdriver-monitoring-automation-part-6-uptime-checks-with-terraform-76cb25b996a4?source=collection_archive---------2-----------------------#2019-03-05">https://medium.com/google-cloud/stackdriver-monitoring-automation-part-6-uptime-checks-with-terraform-76cb25b996a4?source=collection_archive---------2-----------------------#2019-03-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a8b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章是Stackdriver自动化系列的第6部分。在这篇文章中，我将详细介绍使用Terraform自动管理Stackdriver监控正常运行时间检查的步骤。</p><h1 id="c455" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">正常运行时间检查</h1><p id="073a" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated"><a class="ae kg" href="https://cloud.google.com/monitoring/uptime-checks/" rel="noopener ugc nofollow" target="_blank">正常运行时间检查</a>允许您通过HTTP、HTTPS或TCP健康检查来验证服务的可用性。Stackdriver通过从世界各地访问应用程序的前端并报告结果(如延迟和响应代码)来提供这种服务。您可以使用此服务来了解您的用户是否可以从全球各地访问该服务。</p><h1 id="8dc9" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">正常运行时间检查配置</h1><p id="9cd1" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">例如，我创建了一个基于apache基础设施的正常运行时间检查，我在本系列的第1部分和第2部分中对此进行了描述。该应用程序本身是一个简单的网站，由负载平衡器后面的apache服务器托管。我创建了一个简单的HTTP正常运行时间检查来了解我的用户是否可以访问服务。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="d0d8" class="kq je hi km b fi kr ks l kt ku">provider "google" {<br/>  project = "abab-cdcd-023991"<br/>  region  = "us-central1"<br/>  zone    = "us-central1-c"<br/>}</span><span id="1111" class="kq je hi km b fi kv ks l kt ku">resource "google_monitoring_uptime_check_config" "http" {<br/>  display_name = "1 - Website uptime check [global]"<br/>  timeout = "10s"<br/>  period = "60s"</span><span id="49ee" class="kq je hi km b fi kv ks l kt ku">  http_check {<br/>    path = "/"<br/>    port = "80"<br/>  }</span><span id="0160" class="kq je hi km b fi kv ks l kt ku">  monitored_resource {<br/>    type = "uptime_url"<br/>    labels = {<br/>      host = "35.241.47.194"<br/>    }<br/>  }</span><span id="1578" class="kq je hi km b fi kv ks l kt ku">}</span></pre><p id="c5c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在<a class="ae kg" href="https://github.com/charlesbaer/stackdriver-automation" rel="noopener ugc nofollow" target="_blank"> github repo </a>上找到完整的配置文件。</p><p id="8b2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在标准初始化之后，terraform apply完成所有工作并创建正常运行时间检查。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="ccd6" class="kq je hi km b fi kr ks l kt ku">$ terraform apply</span><span id="8514" class="kq je hi km b fi kv ks l kt ku">An execution plan has been generated and is shown below.<br/>Resource actions are indicated with the following symbols:<br/>  + create</span><span id="5fb0" class="kq je hi km b fi kv ks l kt ku">Terraform will perform the following actions:</span><span id="2201" class="kq je hi km b fi kv ks l kt ku">+ google_monitoring_uptime_check_config.http<br/>      id:                               &lt;computed&gt;<br/>      display_name:                     "01 - Website uptime check [global]"<br/>      http_check.#:                     "1"<br/>      http_check.0.path:                "/"<br/>      http_check.0.port:                "80"<br/>      monitored_resource.#:             "1"<br/>      monitored_resource.0.labels.%:    "1"<br/>      monitored_resource.0.labels.host: "35.241.47.194"<br/>      monitored_resource.0.type:        "uptime_url"<br/>      name:                             &lt;computed&gt;<br/>      period:                           "60s"<br/>      project:                          &lt;computed&gt;<br/>      timeout:                          "10s"</span><span id="c11d" class="kq je hi km b fi kv ks l kt ku">Plan: 1 to add, 0 to change, 0 to destroy.</span><span id="1ac6" class="kq je hi km b fi kv ks l kt ku">Do you want to perform these actions?<br/>  Terraform will perform the actions described above.<br/>  Only 'yes' will be accepted to approve.</span><span id="3e6f" class="kq je hi km b fi kv ks l kt ku">Enter a value: yes</span><span id="bc9f" class="kq je hi km b fi kv ks l kt ku">google_monitoring_uptime_check_config.http: Creating...<br/>  display_name:                     "" =&gt; "01 - Website uptime check [global]"<br/>  http_check.#:                     "" =&gt; "1"<br/>  http_check.0.path:                "" =&gt; "/"<br/>  http_check.0.port:                "" =&gt; "80"<br/>  monitored_resource.#:             "" =&gt; "1"<br/>  monitored_resource.0.labels.%:    "" =&gt; "1"<br/>  monitored_resource.0.labels.host: "" =&gt; "35.241.47.194"<br/>  monitored_resource.0.type:        "" =&gt; "uptime_url"<br/>  name:                             "" =&gt; "&lt;computed&gt;"<br/>  period:                           "" =&gt; "60s"<br/>  project:                          "" =&gt; "&lt;computed&gt;"<br/>  timeout:                          "" =&gt; "10s"<br/>google_monitoring_uptime_check_config.http: Creation complete after 1s (ID: projects/abab-cdcd-023991/uptimeCheckConfigs/01-website-uptime-check-global)</span><span id="37dc" class="kq je hi km b fi kv ks l kt ku">Apply complete! Resources: 1 added, 0 changed, 0 destroyed.</span></pre><p id="759c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦创建了运行时间检查，我就使用Stackdriver监控控制台来验证运行时间检查是否已经成功创建。请记住，当您第一次创建运行时间检查时，根据<a class="ae kg" href="https://cloud.google.com/monitoring/uptime-checks/" rel="noopener ugc nofollow" target="_blank">文档</a>，可能需要长达5分钟的时间来开始报告状态。</p><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es kw"><img src="../Images/db38c2c4a2f0125ddf55c75326162c45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1qJqwwsYIiExz76UluN4xg.png"/></div></div></figure><p id="0930" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，正常运行时间检查处于活动状态，可以与警报策略结合使用，以便在正常运行时间检查失败或延迟超出容许范围时通知您。</p><h1 id="bca1" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">结论:Stackdriver监控自动化系列</h1><p id="a9b2" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">Stackdriver监控自动化系列到此结束。在本系列中，我介绍了通过Google Cloud Deployment Manager和Terraform创建Stackdriver监控组件的步骤和方法。在文章1和4中，我创建了一个Stackdriver组，用于将要监控的资源作为一个实体进行分组。在文章2和5中，我创建了Stackdriver警报策略来定义何时发送警报以及发送什么警报。在文章3和6中，我创建了Stackdriver正常运行时间检查来提供最终用户体验的基本情况。您可以使用这些步骤和配置文件作为模板，在您的环境中自动部署Stackdriver监控资源。</p><p id="d23e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本系列的其他文章和下面的参考资料中阅读更多关于Stackdriver监控自动化的内容。</p><ul class=""><li id="4efd" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated">堆栈驱动监控自动化第1部分:堆栈驱动组</li><li id="6cce" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae kg" rel="noopener" href="/@charles.baer/stackdriver-automation-part-2-alerting-policies-9f42068603c4">堆栈驱动监控自动化第2部分:堆栈驱动警报策略</a></li><li id="efc0" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae kg" rel="noopener" href="/google-cloud/stackdriver-monitoring-automation-part-3-uptime-checks-476b8507f59c"> Stackdriver监控自动化第3部分:正常运行时间检查</a></li><li id="7189" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae kg" rel="noopener" href="/google-cloud/stackdriver-monitoring-automation-part-4-stackdriver-groups-with-terraform-910289d16d08">堆栈驱动监控自动化第4部分:具有地形的堆栈驱动组</a></li><li id="09ef" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae kg" rel="noopener" href="/google-cloud/stackdriver-monitoring-automation-part-5-alerting-policies-ff77b19b4b97"> Stackdriver监控自动化第5部分:Terraform下的Stackdriver警报策略</a></li></ul><p id="ee51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参考资料:</p><ul class=""><li id="b097" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated"><a class="ae kg" href="https://cloud.google.com/monitoring/docs/" rel="noopener ugc nofollow" target="_blank">堆栈驱动监控文件</a></li><li id="713d" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae kg" href="https://cloud.google.com/monitoring/api/ref_v3/rest/" rel="noopener ugc nofollow" target="_blank">栈驱动监控API文档</a></li><li id="3666" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae kg" href="https://cloud.google.com/monitoring/api/v3/filters" rel="noopener ugc nofollow" target="_blank">堆栈驱动程序监控过滤器</a></li><li id="9222" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae kg" href="https://cloud.google.com/monitoring/api/metrics_gcp" rel="noopener ugc nofollow" target="_blank">堆栈驱动程序监控指标</a></li><li id="4f2e" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae kg" href="https://www.terraform.io/docs/providers/google/provider_reference.html" rel="noopener ugc nofollow" target="_blank">谷歌平台提供商</a></li></ul></div></div>    
</body>
</html>