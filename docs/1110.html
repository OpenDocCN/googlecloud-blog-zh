<html>
<head>
<title>Building a data pipeline with Apache Beam and Elasticsearch (7.3 and 6.8) on Google Cloud Platform (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Google云平台上用Apache Beam和Elasticsearch (7.3和6.8)构建数据管道(第1部分)</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/building-a-data-pipeline-with-apache-beam-and-elasticsearch-7-3-38c8604480ce?source=collection_archive---------0-----------------------#2019-08-12">https://medium.com/google-cloud/building-a-data-pipeline-with-apache-beam-and-elasticsearch-7-3-38c8604480ce?source=collection_archive---------0-----------------------#2019-08-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b2a3cacb0313dfff6d2d87bffbe02a6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tzWDhMH3TjQGghN9"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae iu" href="https://unsplash.com/@frostroomhead?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Rodion Kutsaev </a>拍照</figcaption></figure><p id="3bc4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是一个由三部分组成的系列，旨在帮助数据工程师开始使用Apache Beam Java SDK和ElasticSearch在Google云平台上构建数据管道。假设读者对GCP和创建数据管道的基本原理有所了解，但只是一名Java开发新手。</p><p id="1ba9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最终的管道将包含<strong class="ix hj"> PubSub +数据流+弹性搜索+基巴纳。</strong>也就是说，您将从PubSub获取消息，然后使用DaraFlow处理这些消息并将其插入Elasticsearch，最后在Kibana中可视化数据。</p><p id="f4b0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本系列的第一部分中，您将执行以下操作:</p><ul class=""><li id="38f6" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">在GCP上安装Elasticsearch和Kibana。</li><li id="6ae8" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">看看Elasticsearch 7.3和6.8以及它们的一些区别。</li></ul><p id="49c2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在第二部分，您将:</p><ul class=""><li id="4ffb" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">创建并构建一个Apache Beam管道。</li><li id="6ef7" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">安装并配置IntelliJ，以便与Beam Java SDK一起使用，并使用Maven和IntelliJ来构建和运行管道。</li></ul><p id="d8ca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，在本系列的第三部分中，您将研究管道源代码并了解它是如何工作的。</p><h2 id="90ad" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">在虚拟机实例上安装Elasticsearch和Kibana</h2><p id="51ba" class="pw-post-body-paragraph iv iw hi ix b iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">虽然，对于Elasticsearch，GCP市场上有现成的解决方案，但您需要在虚拟机上手动安装ElasticSearch和Kibana。在撰写本文时，有一个免费的click do deploy Elasticsearch集群，它建立了一个kubernetes集群并在其上安装了Elasticsearch 6.3。但是，它是一个相对旧版本的Elasticsearch，它需要一个旧版本的Kibana，与最新版本相比，它的功能更弱，也更先进。</p><p id="1eae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您将从创建一个新的VM实例开始。打开<em class="lh">计算引擎</em>选项卡，点击<em class="lh">创建实例</em>。默认设置对于这个简单的示例来说很好，但是在单击页面底部的<em class="lh"> Create </em>之前，为新虚拟机启用HTTP/HTTS流量。这将向我们的VM添加两个网络标签:<em class="lh"> http-server </em>和<em class="lh"> https-server </em>。</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/8b03d72febb00c29e5fd0d413498db9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Io4iDcv2QgEiT0GKFFisNg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">使用默认设置创建一个新的虚拟机实例，并启用HTTP和HTTPS流量</figcaption></figure><p id="98e2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，导航到<em class="lh"> VPC网络，</em>选择<em class="lh">防火墙规则，</em>并创建两个防火墙规则以允许TCP流量进入Elasticsearch端口9200和Kibana端口5601。要定义新规则适用的计算实例，您可以指定网络标记(在我们的示例中是<em class="lh"> http-server </em>和<em class="lh"> https-server </em>)。为简单起见，通过将<em class="lh">源IP范围</em>设置为0.0.0.0/0，允许来自所有实例的传入流量。下面的截图显示了如何定义第一个规则。对于第二个规则，只需将端口号更改为5601。</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/8a7dd631b0115158550e03182476688e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R8ZGzwu486WjEzXDrm35EA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">创建防火墙规则以允许TCP流量进入Elasticsearch端口9200</figcaption></figure><p id="f6e8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Elasticsearch需要在我们的虚拟机上安装Java。因此，在配置了虚拟机之后，对其进行SSH并安装Java:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="61ec" class="kh ki hi lp b fi lt lu l lv lw">sudo apt-get update<br/>sudo apt-get install default-jre</span></pre><p id="3875" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，你已经准备好安装Elasticsearch了。以下是如何安装Elasticsearch <a class="ae iu" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/deb.html" rel="noopener ugc nofollow" target="_blank"> 7.3 </a>:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="832a" class="kh ki hi lp b fi lt lu l lv lw">wget -qO — <a class="ae iu" href="https://artifacts.elastic.co/GPG-KEY-elasticsearch" rel="noopener ugc nofollow" target="_blank">https://artifacts.elastic.co/GPG-KEY-elasticsearch</a> | sudo apt-key add -</span><span id="6705" class="kh ki hi lp b fi lx lu l lv lw">sudo apt-get install apt-transport-https</span><span id="600a" class="kh ki hi lp b fi lx lu l lv lw">echo “deb <a class="ae iu" href="https://artifacts.elastic.co/packages/7.x/apt" rel="noopener ugc nofollow" target="_blank">https://artifacts.elastic.co/packages/7.x/apt</a> stable main” | sudo tee -a /etc/apt/sources.list.d/elastic-7.x.list</span><span id="f43f" class="kh ki hi lp b fi lx lu l lv lw">sudo apt-get update &amp;&amp; sudo apt-get install elasticsearch</span></pre><p id="c068" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/deb.html" rel="noopener ugc nofollow" target="_blank">版本6.x </a>的安装步骤非常相似，只是将上面的第三个命令替换为以下命令:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="2e61" class="kh ki hi lp b fi lt lu l lv lw">echo “deb <a class="ae iu" href="https://artifacts.elastic.co/packages/6.x/apt" rel="noopener ugc nofollow" target="_blank">https://artifacts.elastic.co/packages/6.x/apt</a> stable main” | sudo tee -a /etc/apt/sources.list.d/elastic-6.x.list</span></pre><p id="301b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，配置Elasticsearch:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="c49a" class="kh ki hi lp b fi lt lu l lv lw">sudo vi /etc/elasticsearch/elasticsearch.yml</span></pre><p id="927b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">取消注释并设置<code class="du ly lz ma lp b">network.host: 0.0.0.0</code>。如果你安装了Elasticsearch 6.x，在<em class="lh"> elasticsearch.yml </em>中的上述改变就足够了，但是对于7.3版本，还需要一件事。取消注释并设置<code class="du ly lz ma lp b">cluster.initial_master_nodes: node-1</code></p><p id="5770" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，重启Elasticsearch:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="af97" class="kh ki hi lp b fi lt lu l lv lw">sudo service elasticsearch restart</span></pre><p id="7754" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">稍等片刻，通过向Elasticsearch发送一个HTTP请求来测试它是否启动并运行:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="1ead" class="kh ki hi lp b fi lt lu l lv lw">curl localhost:9200</span></pre><p id="8ce5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果服务有效，响应应该包含<em class="lh">“你知道，为了搜索】</em>。如果没有看到，可以检查是否有进程监听9200:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="42c8" class="kh ki hi lp b fi lt lu l lv lw">sudo netstat -a -p | grep 9200</span></pre><p id="b57d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">检查Elasticseach是否正在运行:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="85e8" class="kh ki hi lp b fi lt lu l lv lw">ps aux | grep elastic*</span></pre><p id="e889" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">看看日志:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="8294" class="kh ki hi lp b fi lt lu l lv lw">sudo ls -l /var/log/elasticsearch/</span></pre><p id="88d9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，如果您忘记为7.3设置<em class="lh">cluster . initial _ master _ nodes</em>，您会在<em class="lh">/var/log/elastic search/elastic search . log</em>中看到类似这样的内容:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="3e49" class="kh ki hi lp b fi lt lu l lv lw">node validation exception<br/>[1] bootstrap checks failed<br/>[1]: the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured</span></pre><p id="3d59" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您已经准备好在Elasticsearch中创建您的第一个索引，并用一个测试文档填充它。运行以下命令最简单的方法是使用<em class="lh"> GCP云外壳</em>。首先，定义变量:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="8007" class="kh ki hi lp b fi lt lu l lv lw">export ELASTIC_CLUSTER=http://x.x.x.x:9200<br/>export ELASTIC_INDEX=citibikes</span></pre><p id="0277" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于6.8版，您需要再添加一个变量:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="8ba5" class="kh ki hi lp b fi lt lu l lv lw">export ELASTIC_TYPE=trips</span></pre><p id="418c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里的<em class="lh"> x.x.x.x </em>是我们新创建的虚拟机的外部IP地址，从GCP云shell发出的<code class="du ly lz ma lp b">curl $ELASTIC_CLUSTER</code>将返回<em class="lh">“你知道，用于搜索”</em>。</p><p id="2d90" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">注意:</strong>当您重新连接到GCP云shell时，您在过期会话中设置的环境变量不再存在，需要重新定义。如果你打算花些时间研究这篇文章中描述的例子，在你的本地机器上安装<a class="ae iu" href="https://cloud.google.com/sdk/install" rel="noopener ugc nofollow" target="_blank">谷歌云sdk </a>并从那里运行所有命令可能会更有优势。</p><p id="b336" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如本文开头提到的，管道将在Elasticsearch中存储消息。为此，您将使用一个名为<em class="lh"> $ELASTIC_INDEX </em>的索引。这里是<a class="ae iu" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/removal-of-types.html" rel="noopener ugc nofollow" target="_blank">7.0版本引入的另一个区别</a>。从此版本开始，映射类型已被弃用。它改变了API调用，你将在本文后面看到。这就是为什么<em class="lh"> $ELASTIC_TYPE </em>只为6.x版本定义的原因。</p><p id="55db" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了在Kibana中正确地可视化数据，您需要为索引定义一个模式。这可以通过在Elasticsearch中定义一个映射来实现。如果没有这一步，索引中的所有文档字段都将被Elasticsearch识别为字符串，并且不可用于聚合。在本例中，您将从公共BigQuery数据集<em class="lh">` big query-public-data . new _ York _ Citi bike . Citi bike _ trips `</em>获取消息。</p><p id="cac6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用以下json定义7.x的映射:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="2ae5" class="kh ki hi lp b fi lt lu l lv lw">curl -X PUT "$ELASTIC_CLUSTER/$ELASTIC_INDEX" -H 'Content-Type: application/json' -d'<br/>{<br/>  "mappings": {<br/>    "properties": {<br/>      "tripduration":    { "type": "integer"  }, <br/>      "starttime": {"type": "date"}, <br/>      "stoptime": {"type": "date"},<br/>      "start_station_id":      { "type": "integer" },<br/>      "start_station_name":      { "type": "text" }, <br/>      "start_station_location":     { "type": "geo_point"  }, <br/>      "end_station_id":      { "type": "integer" }, <br/>      "end_station_name":      { "type": "text" }, <br/>      "end_station_location":     { "type": "geo_point"  },<br/>      "bikeid":      { "type": "integer" }, <br/>      "usertype":      { "type": "keyword" }, <br/>      "birth_year": {"type": "integer"},<br/>      "gender":      { "type": "keyword" }<br/>    }<br/>  }<br/>}'</span></pre><p id="d94f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">还有这个6.x的:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="e4f0" class="kh ki hi lp b fi lt lu l lv lw">curl -X PUT "$ELASTIC_CLUSTER/$ELASTIC_INDEX" -H 'Content-Type: application/json' -d'<br/>{<br/>  "mappings": {<br/>    "'$ELASTIC_TYPE'": { <br/>      "properties": {<br/>        "tripduration":    { "type": "integer"  }, <br/>        "starttime": {"type": "date"}, <br/>        "stoptime": {"type": "date"},<br/>        "start_station_id":      { "type": "integer" },<br/>        "start_station_name":      { "type": "text" }, <br/>        "start_station_location":     { "type": "geo_point"  }, <br/>        "end_station_id":      { "type": "integer" }, <br/>        "end_station_name":      { "type": "text" }, <br/>        "end_station_location":     { "type": "geo_point"  },<br/>        "bikeid":      { "type": "integer" }, <br/>        "usertype":      { "type": "keyword" }, <br/>        "birth_year": {"type": "integer"},<br/>        "gender":      { "type": "keyword" }<br/>      }<br/>    }<br/>  }<br/>}'</span></pre><p id="770b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">定义为文本的字段将被索引并可用于全文搜索。注意<em class="lh"> $ELASTIC_TYPE </em>变量的单引号。没有它们，shell不会扩展变量。</p><h2 id="2184" class="kh ki hi bd kj kk kl km kn ko kp kq kr jg ks kt ku jk kv kw kx jo ky kz la lb bi translated">测试弹性搜索</h2><p id="58e4" class="pw-post-body-paragraph iv iw hi ix b iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">要检查Elasticsearch是否正常工作，您可以使用以下命令为7.x插入一条测试消息:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="b0c6" class="kh ki hi lp b fi lt lu l lv lw">curl -X POST “$ELASTIC_CLUSTER/$ELASTIC_INDEX/_doc/” -H ‘Content-Type: application/json’ -d’{ “tripduration”: 202, “starttime”: “2015–08–06T10:20:39”, “stoptime”: “2015–08–06T10:21:41”, “start_station_id”: 520, “start_station_name”: “W 52 St &amp; 5 Ave”, “start_station_location”: {“lat”: 40.85992262, “lon”: -73.87648516}, “end_station_id”: “520”, “end_station_name”: “W 52 St &amp; 5 Ave”, “end_station_location”: {“lat”: 40.85992262, “lon”: -73.87648516}, “bikeid”: 200, “usertype”: “Customer”, “birth_year”: 1990, “gender”: “male” }’</span></pre><p id="07bd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于6.x，您需要提供<em class="lh"> $ELASTIC_TYPE </em>，而不是7.x中的<em class="lh"> _doc </em>:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="80ea" class="kh ki hi lp b fi lt lu l lv lw">curl -X POST “$ELASTIC_CLUSTER/$ELASTIC_INDEX/$ELASTIC_TYPE/” -H ‘Content-Type: application/json’ -d’{ “tripduration”: 202, “starttime”: “2015–08–06T10:20:39”, “stoptime”: “2015–08–06T10:21:41”, “start_station_id”: 520, “start_station_name”: “W 52 St &amp; 5 Ave”, “start_station_location”: {“lat”: 40.85992262, “lon”: -73.87648516}, “end_station_id”: “520”, “end_station_name”: “W 52 St &amp; 5 Ave”, “end_station_location”: {“lat”: 40.85992262, “lon”: -73.87648516}, “bikeid”: 200, “usertype”: “Customer”, “birth_year”: 1990, “gender”: “male” }’</span></pre><p id="0eaa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上述命令不提供文档ID，因此它将由Elasticsearch自动设置。如果一切正常，这些命令的输出应该包含关于创建的文档和<em class="lh">“成功”:1 </em>条目的信息。</p><p id="0679" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，当Elasticsearch工作时，您可以在同一个VM上安装Kibana。注意，您已经安装了公共签名密钥apt-transport-https，并在安装Elasticsearch的过程中保存了存储库定义。因此，剩下的步骤是ssh到虚拟机并运行:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="4bc6" class="kh ki hi lp b fi lt lu l lv lw">sudo apt-get install kibana</span></pre><p id="d6e0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，配置Kibana:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="424d" class="kh ki hi lp b fi lt lu l lv lw">sudo vi /etc/kibana/kibana.yml</span></pre><p id="570a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你需要在那里设置<code class="du ly lz ma lp b"><em class="lh">server.port: 5601</em></code>和<code class="du ly lz ma lp b">server.host: “0.0.0.0” </code>。接下来，重新启动服务:</p><pre class="lj lk ll lm fd lo lp lq lr aw ls bi"><span id="02bb" class="kh ki hi lp b fi lt lu l lv lw">sudo service kibana start</span></pre><p id="4463" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在您的浏览器中键入<em class="lh"> http://x.x.x.x:5601/ </em>，其中<em class="lh"> x.x.x.x </em>是我们虚拟机的外部IP地址，您应该会看到Kibana欢迎页面。</p><p id="f7c7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，您可以使用Kibana来查找在上一步中插入到Elasticsearch中的测试文档。<strong class="ix hj"> </strong>为此，<strong class="ix hj"> </strong>转到<em class="lh">管理</em>选项卡，然后<em class="lh">索引模式，</em>并点击<em class="lh">创建索引模式</em>。在这里，您可以指定想要在Kibana中浏览的索引。创建没有时间过滤器的<em class="lh"> citibikes* </em>模式。</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/e5a90b1228714bddb52ec912d4a9bd35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8iMx6KXEu9he4B9PlOqmmg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">在Kibana中创建索引模式citibikes*</figcaption></figure><p id="e1e1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，如果您进入<em class="lh"> Discover </em>页面并选择索引模式，您应该会看到测试消息。</p><p id="4d70" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，当你有了Elasticsearch和Kibana，你就可以开始这篇文章的下一部分了。第二部分将:</p><ul class=""><li id="08c3" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">描述如何创建和构建Apache Beam管道。</li><li id="40da" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">演示如何安装和配置IntelliJ来使用Beam Java SDK，并使用Maven和IntelliJ来构建和运行您的管道。</li></ul></div></div>    
</body>
</html>