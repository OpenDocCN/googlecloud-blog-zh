<html>
<head>
<title>How to build your own smart speaker — Google Assistant, Google Cloud, Actions on Google and ReSpeaker Core v2.0 — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何打造自己的智能音箱——Google Assistant、Google Cloud、在Google上的操作和re speaker Core v 2.0——第2部分</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-build-your-own-smart-speaker-google-assistant-google-cloud-actions-on-google-and-b5beb96da119?source=collection_archive---------0-----------------------#2019-06-30">https://medium.com/google-cloud/how-to-build-your-own-smart-speaker-google-assistant-google-cloud-actions-on-google-and-b5beb96da119?source=collection_archive---------0-----------------------#2019-06-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7e74ceff15fe869471a110a542820800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hATjg6Ra0wj52qaCnZA0Gw.png"/></div></div></figure><p id="3a4e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本教程中，我们将学习如何使用Google Assistant和ReSpeaker Core v2.0构建自己的智能扬声器。值得注意的是，这是第一部分教程的延续。</p><div class="jp jq ez fb jr js"><a rel="noopener follow" target="_blank" href="/@sachindroid8/how-to-build-your-own-smart-speaker-google-assistant-google-cloud-actions-on-google-and-eec1169d9435"><div class="jt ab dw"><div class="ju ab jv cl cj jw"><h2 class="bd hj fi z dy jx ea eb jy ed ef hh bi translated">如何打造自己的智能音箱——谷歌助手、谷歌云、谷歌上的动作和…</h2><div class="jz l"><h3 class="bd b fi z dy jx ea eb jy ed ef dx translated">在本教程中，我们将学习如何使用谷歌助手、谷歌云、在…上的操作来构建自己的智能扬声器</h3></div><div class="ka l"><p class="bd b fp z dy jx ea eb jy ed ef dx translated">medium.com</p></div></div><div class="kb l"><div class="kc l kd ke kf kb kg io js"/></div></div></a></div><p id="9a94" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，我们将嵌入谷歌助手，并建立我们自己的谷歌主页/谷歌迷你像智能音箱。</p><ol class=""><li id="f84c" class="kh ki hi is b it iu ix iy jb kj jf kk jj kl jn km kn ko kp bi translated">谷歌助手库简介</li><li id="91e8" class="kh ki hi is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated">设置和配置—硬件、网络和音频</li><li id="f34e" class="kh ki hi is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated">安装SDK和示例代码</li><li id="c694" class="kh ki hi is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated">运行示例代码</li><li id="8ad1" class="kh ki hi is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated">自动化—在启动时运行您的应用</li><li id="de49" class="kh ki hi is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated">结论</li><li id="a1bc" class="kh ki hi is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated">参考</li></ol><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/dac478287d0a56bfc19ed1f828a84b65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HWMOLWF-v7IWWRnB6p8qew.png"/></div></div></figure><h1 id="8dfd" class="kz la hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">1.谷歌助手库简介</h1><p id="2c40" class="pw-post-body-paragraph iq ir hi is b it lx iv iw ix ly iz ja jb lz jd je jf ma jh ji jj mb jl jm jn hb bi translated">对于任何想要快速将助手集成到项目中的人来说，Python的Google Assistant库是一个交钥匙解决方案。此外，该库是用Python编写的，并在流行的硬件上得到支持，如Raspberry Pi 3等。</p><h1 id="f21e" class="kz la hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">2.设置和配置—硬件、网络和音频</h1><p id="8c22" class="pw-post-body-paragraph iq ir hi is b it lx iv iw ix ly iz ja jb lz jd je jf ma jh ji jj mb jl jm jn hb bi translated">在继续下一步之前，请参考上一个教程并完成所有步骤。</p><div class="jp jq ez fb jr js"><a rel="noopener follow" target="_blank" href="/@sachindroid8/how-to-build-your-own-smart-speaker-google-assistant-google-cloud-actions-on-google-and-eec1169d9435"><div class="jt ab dw"><div class="ju ab jv cl cj jw"><h2 class="bd hj fi z dy jx ea eb jy ed ef hh bi translated">如何打造自己的智能音箱——谷歌助手、谷歌云、谷歌上的动作和…</h2><div class="jz l"><h3 class="bd b fi z dy jx ea eb jy ed ef dx translated">在本教程中，我们将学习如何使用谷歌助手、谷歌云、在…上的操作来构建自己的智能扬声器</h3></div><div class="ka l"><p class="bd b fp z dy jx ea eb jy ed ef dx translated">medium.com</p></div></div><div class="kb l"><div class="kc l kd ke kf kb kg io js"/></div></div></a></div><h1 id="f9c9" class="kz la hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">3.安装SDK和示例代码</h1><h1 id="387c" class="kz la hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">3.1配置新的Python虚拟环境</h1><p id="3c7d" class="pw-post-body-paragraph iq ir hi is b it lx iv iw ix ly iz ja jb lz jd je jf ma jh ji jj mb jl jm jn hb bi translated">首先，使用一个<a class="ae jo" href="https://docs.python.org/3/library/venv.html" rel="noopener ugc nofollow" target="_blank"> Python虚拟环境</a>将SDK及其依赖项从系统Python包中隔离出来。因此，打开QTerminal并依次运行以下命令。</p><p id="6127" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">对于Python 3 </strong>:</p><pre class="kv kw kx ky fd mc md me mf aw mg bi"><span id="665a" class="mh la hi md b fi mi mj l mk ml">sudo apt-get update<br/>sudo apt-get install python3-dev python3-venv<br/>python3 -m venv env<br/>env/bin/python -m pip install --upgrade pip setuptools wheel<br/>source env/bin/activate</span></pre><h1 id="b272" class="kz la hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">3.2获取包</h1><p id="d168" class="pw-post-body-paragraph iq ir hi is b it lx iv iw ix ly iz ja jb lz jd je jf ma jh ji jj mb jl jm jn hb bi translated">Google Assistant SDK包包含在设备上运行Google Assistant所需的所有代码，包括示例代码。所以，一个一个执行下面的脚本。</p><h2 id="8289" class="mh la hi bd lb mm mn mo lf mp mq mr lj jb ms mt ln jf mu mv lr jj mw mx lv my bi translated">安装依赖项</h2><pre class="kv kw kx ky fd mc md me mf aw mg bi"><span id="7550" class="mh la hi md b fi mi mj l mk ml">sudo apt-get install portaudio19-dev libffi-dev libssl-dev libmpg123-dev<br/>python3 -m pip install --upgrade google-assistant-library==1.0.1<br/>python3 -m pip install --upgrade google-assistant-sdk[samples]==0.5.1</span></pre><h1 id="50bc" class="kz la hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">4.运行示例代码——嘿，谷歌</h1><p id="31f4" class="pw-post-body-paragraph iq ir hi is b it lx iv iw ix ly iz ja jb lz jd je jf ma jh ji jj mb jl jm jn hb bi translated">由于我们已经完成了上一教程的所有基础工作和这里的剩余步骤，我们可以继续运行我们的示例代码。</p><p id="2fab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用自己的id修改命令<code class="du mz na nb md b">googlesamples-assistant-hotword --project-id &lt;my-dev-project&gt; --device-model-id &lt;my-model</code> &gt;。</p><p id="7beb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以，对于上面的命令，把&lt;<code class="du mz na nb md b">my-dev-project</code> &gt;改成你的<code class="du mz na nb md b">project-id</code>，把&lt; <code class="du mz na nb md b">my-model&gt;</code>改成你的<code class="du mz na nb md b">Model ID</code>。</p><p id="77bf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于这个演示，应该是这样的</p><pre class="kv kw kx ky fd mc md me mf aw mg bi"><span id="a223" class="mh la hi md b fi mi mj l mk ml">googlesamples-assistant-hotword --project-id mysmartspeaker-xxxxx --device-model-id mysmartspeaker-xxxx-my-smart-speaker-xxxxx</span></pre><p id="2ee1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您也可以使用以下命令运行相同的程序。</p><pre class="kv kw kx ky fd mc md me mf aw mg bi"><span id="d8f0" class="mh la hi md b fi mi mj l mk ml">python3 /home/respeaker/env/bin/googlesamples-assistant-hotword --project-id mysmartspeaker-xxxxx --device-model-id mysmartspeaker-xxxx-my-smart-speaker-xxxxx</span></pre><p id="940d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，你可以使用热门词汇<strong class="is hj"> Ok Google/Hey Google </strong>来触发谷歌助手。</p><p id="8f99" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">试试问下面的<br/> <em class="nc">好的谷歌一下，给我讲个笑话。好的，谷歌，把我传送上去，斯科特。</em></p><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nd"><img src="../Images/dc206ef4bd403d4925a4d73979ad6395.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lmLpkU0TjKWiCUBQ"/></div></div></figure><h1 id="69dc" class="kz la hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">5.自动化—在启动时运行您的应用</h1><p id="e923" class="pw-post-body-paragraph iq ir hi is b it lx iv iw ix ly iz ja jb lz jd je jf ma jh ji jj mb jl jm jn hb bi translated">既然我们已经运行了示例应用程序，我们确实需要一直运行它，并且在启动时自动启动。为了做到这一点，我们需要配置一些东西。让我们开始吧。</p><h1 id="e0c6" class="kz la hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">5.1创建服务文件。</h1><p id="2b94" class="pw-post-body-paragraph iq ir hi is b it lx iv iw ix ly iz ja jb lz jd je jf ma jh ji jj mb jl jm jn hb bi translated">默认情况下，我们的设备在启动时不做任何事情；您必须手动执行程序。但是你可以通过创建一个<code class="du mz na nb md b"><a class="ae jo" href="https://manpages.debian.org/stretch/systemd/systemd.1.en.html" rel="noopener ugc nofollow" target="_blank">systemd</a></code>服务让这个程序(或者你选择的任何其他程序)在启动时自动运行。</p><p id="82d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您所需要的只是一个<code class="du mz na nb md b">.service</code>配置文件。该文件接受一长串配置选项。</p><p id="6e11" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在QTerminal中，输入以下命令。</p><pre class="kv kw kx ky fd mc md me mf aw mg bi"><span id="4626" class="mh la hi md b fi mi mj l mk ml">cd /home/respeaker/env/bin/<br/>sudo vi assistant-on-start.service</span></pre><p id="358b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将以下代码复制粘贴到assistant-on-start.service文件中。确保用您的id替换项目id和设备型号id。</p><pre class="kv kw kx ky fd mc md me mf aw mg bi"><span id="be19" class="mh la hi md b fi mi mj l mk ml">[Unit]<br/>Description=My Assistant Smart Speaker<br/>Wants=network-online.target<br/>After=network-online.target<br/>Wants=systemd-timesyncd.service<br/>After=systemd-timesyncd.service<br/><br/>[Service]<br/>Environment=DISPLAY=:0<br/>ExecStart=/bin/bash -c '/home/respeaker/env/bin/python3 -u /home/respeaker/env/bin/googlesamples-assistant-hotword --project-id mysmartspeaker-xxxxx --device-model-id mysmartspeaker-xxxx-my-smart-speaker-xxxxx'<br/>WorkingDirectory=/home/respeaker/env/bin/<br/>Restart=always<br/>User=respeaker<br/><br/>[Install]<br/>WantedBy=multi-user.target</span></pre><p id="8d10" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要将这个文件付诸实施，您需要将它放入<code class="du mz na nb md b">/lib/systemd/system/</code>目录中。但是，您可以在这个目录中创建一个符号链接(一个“符号链接”)，指向已经存在的文件，而不是将这个文件实际移动到那里。您可以这样做:</p><pre class="kv kw kx ky fd mc md me mf aw mg bi"><span id="dca0" class="mh la hi md b fi mi mj l mk ml"># Create the symlink<br/>sudo ln -s `pwd`/assistant-on-start.service /lib/systemd/system</span><span id="e652" class="mh la hi md b fi ne mj l mk ml"># Reload the service files so the system knows about this new one<br/>sudo systemctl daemon-reload</span></pre><p id="52ed" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们需要告诉系统在启动时运行这个服务:</p><pre class="kv kw kx ky fd mc md me mf aw mg bi"><span id="e924" class="mh la hi md b fi mi mj l mk ml">sudo systemctl enable assistant-on-start.service</span></pre><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nf"><img src="../Images/43bf9023ee613a78098b5d1e053c703c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XziGqzX9bq4abwgI"/></div></div></figure><p id="b047" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一切就绪！您现在可以尝试重新启动以查看它的工作情况。</p><p id="07cc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">或者使用以下命令手动运行它:</p><pre class="kv kw kx ky fd mc md me mf aw mg bi"><span id="4223" class="mh la hi md b fi mi mj l mk ml">sudo service assistant-on-start start</span></pre><p id="677d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">注意:</strong>即使在该命令的提示符返回后，程序也需要一段时间才能启动。</p><p id="02f7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您希望在启动时停止该服务的运行，请使用以下命令禁用它:</p><pre class="kv kw kx ky fd mc md me mf aw mg bi"><span id="7663" class="mh la hi md b fi mi mj l mk ml">sudo systemctl disable assistant-on-start.service</span></pre><p id="4ee1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要在它运行后手动停止它，请使用以下命令:</p><pre class="kv kw kx ky fd mc md me mf aw mg bi"><span id="1e77" class="mh la hi md b fi mi mj l mk ml">sudo service assistant-on-start stop</span></pre><p id="5ebf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以使用以下命令检查服务的状态:</p><pre class="kv kw kx ky fd mc md me mf aw mg bi"><span id="bc08" class="mh la hi md b fi mi mj l mk ml">sudo service assistant-on-start status</span></pre><h1 id="cc97" class="kz la hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">6.结论</h1><p id="6943" class="pw-post-body-paragraph iq ir hi is b it lx iv iw ix ly iz ja jb lz jd je jf ma jh ji jj mb jl jm jn hb bi translated">总之，我们已经成功地将谷歌助手嵌入到我们的智能扬声器中。我们还自动将其设置为一直运行，并在启动时自动启动。因此，我们现在有了自己的类似Google Home/Google mini的设备，它使用ReSpeaker Core v2.0进行语音识别，具有6阵列麦克风和语音算法。在下一个即将到来的教程中，我们将扩展设备来做更多的事情，比如连接到蓝牙扬声器，使其便携等等。在那之前，看看我在<a class="ae jo" rel="noopener" href="/@sachindroid8"> <strong class="is hj">媒体</strong> </a>和我的网站<a class="ae jo" href="https://techwithsach.com/" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">techwithsach.com</strong></a>上的其他教程帖子。</p><div class="jp jq ez fb jr js"><a rel="noopener follow" target="_blank" href="/google-cloud/how-to-create-a-chatbot-using-dialogflow-enterprise-edition-and-dialogflow-api-v2-923f4a965176"><div class="jt ab dw"><div class="ju ab jv cl cj jw"><h2 class="bd hj fi z dy jx ea eb jy ed ef hh bi translated">如何使用Dialogflow企业版和Dialogflow API V2创建聊天机器人</h2><div class="jz l"><h3 class="bd b fi z dy jx ea eb jy ed ef dx translated">在本教程中，我们将学习如何使用Dialogflow企业版和Dialogflow API V2创建聊天机器人。这个…</h3></div><div class="ka l"><p class="bd b fp z dy jx ea eb jy ed ef dx translated">medium.com</p></div></div><div class="kb l"><div class="ng l kd ke kf kb kg io js"/></div></div></a></div><div class="jp jq ez fb jr js"><a rel="noopener follow" target="_blank" href="/google-cloud/how-to-build-an-app-for-google-assistant-using-dialogflow-enterprise-edition-and-actions-on-google-4413a61d2f2d"><div class="jt ab dw"><div class="ju ab jv cl cj jw"><h2 class="bd hj fi z dy jx ea eb jy ed ef hh bi translated">如何在Google上使用Dialogflow Enterprise Edition和Actions为Google Assistant构建应用程序</h2><div class="jz l"><h3 class="bd b fi z dy jx ea eb jy ed ef dx translated">用户在对话中使用Google Assistant来完成事情，比如购买食品杂货或预订乘车服务，或者在我们的…</h3></div><div class="ka l"><p class="bd b fp z dy jx ea eb jy ed ef dx translated">medium.com</p></div></div><div class="kb l"><div class="nh l kd ke kf kb kg io js"/></div></div></a></div><div class="jp jq ez fb jr js"><a rel="noopener follow" target="_blank" href="/@sachindroid8/how-to-build-your-own-smart-speaker-google-assistant-google-cloud-actions-on-google-and-eec1169d9435"><div class="jt ab dw"><div class="ju ab jv cl cj jw"><h2 class="bd hj fi z dy jx ea eb jy ed ef hh bi translated">如何打造自己的智能音箱——谷歌助手、谷歌云、谷歌上的动作和…</h2><div class="jz l"><h3 class="bd b fi z dy jx ea eb jy ed ef dx translated">在本教程中，我们将学习如何使用谷歌助手、谷歌云、在…上的操作来构建自己的智能扬声器</h3></div><div class="ka l"><p class="bd b fp z dy jx ea eb jy ed ef dx translated">medium.com</p></div></div><div class="kb l"><div class="kc l kd ke kf kb kg io js"/></div></div></a></div><p id="d744" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">7.参考</p><ul class=""><li id="4242" class="kh ki hi is b it iu ix iy jb kj jf kk jj kl jn ni kn ko kp bi translated"><a class="ae jo" href="https://aiyprojects.withgoogle.com/voice#makers-guide-3-4--run-your-app-automatically" rel="noopener ugc nofollow" target="_blank"> AIY项目—语音工具包</a></li><li id="ac7b" class="kh ki hi is b it kq ix kr jb ks jf kt jj ku jn ni kn ko kp bi translated"><a class="ae jo" href="https://developers.google.com/assistant/sdk/guides/library/python/" rel="noopener ugc nofollow" target="_blank">谷歌助手SDK </a></li></ul></div></div>    
</body>
</html>