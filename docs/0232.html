<html>
<head>
<title>Building a serverless Python app in minutes with GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用GCP在几分钟内构建一个无服务器的Python应用程序</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/building-a-serverless-python-app-in-minutes-with-gcp-5184d21a012f?source=collection_archive---------0-----------------------#2017-03-22">https://medium.com/google-cloud/building-a-serverless-python-app-in-minutes-with-gcp-5184d21a012f?source=collection_archive---------0-----------------------#2017-03-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="533d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">更新:Python 3现已推出。这篇文章将尽快重写。你可以看看“<a class="ae jk" rel="noopener" href="/@PicardParis/deploying-a-python-serverless-function-in-minutes-with-gcp-19dd07e19824">用GCP在几分钟内部署一个Python无服务器功能</a>”来获得一篇更新的文章。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="21d3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在让Python“Hello World”与应用程序引擎一起运行之后(见前面的中的<a class="ae jk" rel="noopener" href="/@PicardParis/deploying-a-serverless-env-in-minutes-with-gcp-22008c42dfa4">，部署一个实际的应用程序应该很容易。让我们创建一个应用程序，返回给定作者的可用电子书。</a></p><h2 id="9d4b" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated">创建新项目</h2><p id="0e6e" class="pw-post-body-paragraph im in hi io b ip kg ir is it kh iv iw ix ki iz ja jb kj jd je jf kk jh ji jj hb bi translated">首先，让我们在GCP控制台中创建一个新项目(<a class="ae jk" href="https://console.cloud.google.com/iam-admin/projects" rel="noopener ugc nofollow" target="_blank">IAM&amp;Admin/All projects</a>):</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kl"><img src="../Images/7d31f317781c271b48c412554e5a8e1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*80fnqzoOEDX_qhJveVBGJw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">让我们称这个项目为“获取电子书”。项目ID变为“get-ebooks-by”。这将是appspot.com子域。</figcaption></figure><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es lb"><img src="../Images/c5e93ea3ed62c007ad24da5614bd2c18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WUCowIqrQpaihdx-lyDTqw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">新项目不到30秒就准备好了</figcaption></figure><p id="ea5e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">GCP web控制台中可见的当前项目不一定对应于gcloud控制台中的默认项目。换句话说，从web控制台创建的新项目不会是gcloud控制台中的默认项目。</p><h2 id="2623" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated">检查项目列表</h2><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="e297" class="jl jm hi ld b fi lh li l lj lk">$ <strong class="ld hj">gcloud projects list<br/></strong>PROJECT_ID            NAME                  PROJECT_NUMBER<br/>get-ebooks-by         Get Ebooks By         154726733013<br/>yet-another-gcp-test  Yet Another GCP Test  539486276394<br/>...</span></pre><p id="b9af" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">非常有用的快速可视化您的不同项目和他们的id。遗憾的是，它没有指明当前的默认项目。</p><h2 id="ace3" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated">检查默认项目</h2><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="051d" class="jl jm hi ld b fi lh li l lj lk">$ <strong class="ld hj">gcloud config list</strong><br/>Your active configuration is: [default]</span><span id="a285" class="jl jm hi ld b fi ll li l lj lk">[core]<br/>...<br/>project = yet-another-gcp-test</span></pre><p id="180c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">默认项目不是新项目。默认情况下，所有的<code class="du lm ln lo ld b">gcloud</code>命令将应用于另一个项目，这在这里是不希望的。</p><h2 id="7015" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated">更改默认项目</h2><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="8580" class="jl jm hi ld b fi lh li l lj lk">$ <strong class="ld hj">gcloud config set project </strong><strong class="ld hj">get-ebooks-by<br/></strong>Updated property [core/project].</span></pre><p id="991f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果你正在编写不同的命令，同时处理不同的项目(例如持续集成)，或者只是不希望改变默认项目，可以使用<code class="du lm ln lo ld b">--project</code>标志(部署时请参见下面的注释):<code class="du lm ln lo ld b">gcloud COMMAND --project PROJECT_ID</code>。</p><h2 id="cae9" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated">准备源代码</h2><p id="6e2a" class="pw-post-body-paragraph im in hi io b ip kg ir is it kh iv iw ix ki iz ja jb kj jd je jf kk jh ji jj hb bi translated">在您的本地计算机上:</p><ul class=""><li id="e021" class="lp lq hi io b ip iq it iu ix lr jb ls jf lt jj lu lv lw lx bi translated">创建目录<code class="du lm ln lo ld b">get_ebooks_by</code></li><li id="affe" class="lp lq hi io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">将当前目录更改为<code class="du lm ln lo ld b">get_ebooks_by</code></li><li id="d859" class="lp lq hi io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">添加部署文件<code class="du lm ln lo ld b">app.yaml</code></li></ul><figure class="km kn ko kp fd kq"><div class="bz dy l di"><div class="md me l"/></div></figure><ul class=""><li id="e8c3" class="lp lq hi io b ip iq it iu ix lr jb ls jf lt jj lu lv lw lx bi translated">添加Python存根文件<code class="du lm ln lo ld b">main.py</code>，并将文件编码设置为<code class="du lm ln lo ld b">UTF-8-BOM</code>。如果您的编辑器不支持，请在<code class="du lm ln lo ld b">UTF-8</code>(无BOM)中编码您的源代码，并将<code class="du lm ln lo ld b"># -*- coding: utf-8 -*-</code>添加为第一行。</li></ul><h2 id="a863" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated">定义入口点</h2><p id="83d9" class="pw-post-body-paragraph im in hi io b ip kg ir is it kh iv iw ix ki iz ja jb kj jd je jf kk jh ji jj hb bi translated">让我们为web应用程序定义两个入口点:</p><ol class=""><li id="d187" class="lp lq hi io b ip iq it iu ix lr jb ls jf lt jj mf lv lw lx bi translated">主页面<code class="du lm ln lo ld b">/</code>会列出畅销书作家</li><li id="d2a2" class="lp lq hi io b ip ly it lz ix ma jb mb jf mc jj mf lv lw lx bi translated">子页<code class="du lm ln lo ld b">/author</code>将列出该作者所有可用的电子书</li></ol><p id="2265" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">相应地修改Python存根文件:</p><figure class="km kn ko kp fd kq"><div class="bz dy l di"><div class="md me l"/></div><figcaption class="kx ky et er es kz la bd b be z dx translated">注意:第二个条目“author”参数是URL编码的，必须去掉引号才能返回纯文本。</figcaption></figure><h2 id="d5c9" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated">本地测试</h2><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="ead7" class="jl jm hi ld b fi lh li l lj lk">$ <strong class="ld hj">dev_appserver.py app.yaml</strong></span></pre><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es mg"><img src="../Images/9b2dff41aa5776fd164cf1a3d19f15ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4DLRpOBzx0ks63ddC3YjYg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated"><a class="ae jk" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank">主页</a></figcaption></figure><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es mg"><img src="../Images/e77bebbb3590c19c469bdee1f942459b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iPskiT50bEQeD6o_56YPAQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated"><a class="ae jk" href="http://localhost:8080/Tolkien" rel="noopener ugc nofollow" target="_blank">子页面</a></figcaption></figure><h2 id="7d03" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated">显示作者页面</h2><p id="23e1" class="pw-post-body-paragraph im in hi io b ip kg ir is it kh iv iw ix ki iz ja jb kj jd je jf kk jh ji jj hb bi translated">改编<code class="du lm ln lo ld b">ListAuthors</code>类以显示(任意)畅销书作者列表:</p><figure class="km kn ko kp fd kq"><div class="bz dy l di"><div class="md me l"/></div></figure><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es mg"><img src="../Images/4d3e150d1e221f939d5c539dc9d9d28a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ruImeagScttkRD6S1JOSg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">当main.py更新后，只需刷新本地页面</figcaption></figure><h2 id="5c2c" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated">检索电子书数据</h2><p id="3930" class="pw-post-body-paragraph im in hi io b ip kg ir is it kh iv iw ix ki iz ja jb kj jd je jf kk jh ji jj hb bi translated">通过Google Books API可以检索到某个作者写的电子书，使用<a class="ae jk" href="https://developers.google.com/books/docs/v1/reference/volumes/list" rel="noopener ugc nofollow" target="_blank"> HTTP GET请求</a>可以查询/测试。以下函数获取预期电子书的列表:</p><figure class="km kn ko kp fd kq"><div class="bz dy l di"><div class="md me l"/></div></figure><h2 id="b67c" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated">打印电子书数据</h2><p id="f92e" class="pw-post-body-paragraph im in hi io b ip kg ir is it kh iv iw ix ki iz ja jb kj jd je jf kk jh ji jj hb bi translated">以下函数以纯文本格式打印电子书列表:</p><figure class="km kn ko kp fd kq"><div class="bz dy l di"><div class="md me l"/></div></figure><h2 id="3746" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated">显示电子书页面</h2><p id="38e7" class="pw-post-body-paragraph im in hi io b ip kg ir is it kh iv iw ix ki iz ja jb kj jd je jf kk jh ji jj hb bi translated">改编<code class="du lm ln lo ld b">ListEbooksByAuthor</code>类以显示可用电子书的列表:</p><figure class="km kn ko kp fd kq"><div class="bz dy l di"><div class="md me l"/></div></figure><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es mg"><img src="../Images/4014149e19d81c3fe07ea366e4a3a428.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ty76UaLmzP-Q-mBZ1xzZeg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated"><a class="ae jk" href="http://localhost:8080/J.+R.+R.+Tolkien" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/j .+r .+r .+托尔金</a></figcaption></figure><h2 id="d29e" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated">部署到生产环境</h2><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="1659" class="jl jm hi ld b fi lh li l lj lk">$ <strong class="ld hj">gcloud app deploy</strong></span></pre><p id="9719" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">注意，如果你的GCP项目不是默认项目，你需要完全明确:<code class="du lm ln lo ld b">gcloud app deploy --project PROJECT_ID</code></p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es mg"><img src="../Images/f2de8ebaebae602f69fd79af4f8c5dac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kUEZbzp60RVaBhGXOmq9Ig.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated"><a class="ae jk" href="https://get-ebooks-by.appspot.com/" rel="noopener ugc nofollow" target="_blank">https://get-ebooks-by.appspot.com/</a></figcaption></figure><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es mg"><img src="../Images/98e54e49421f0b5b22f30959b8f36145.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aCV2W7T3E5LRejGwx4Is1Q.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated"><a class="ae jk" href="https://get-ebooks-by.appspot.com/Antoine+de+Saint-Exup%C3%A9ry" rel="noopener ugc nofollow" target="_blank">https://get-ebooks-by.appspot.com/Antoine+de+Saint-Exupéry</a></figcaption></figure><h2 id="991c" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated">关卡完成！</h2><ul class=""><li id="a366" class="lp lq hi io b ip kg it kh ix mh jb mi jf mj jj lu lv lw lx bi translated">该应用程序已经启动并运行！<a class="ae jk" href="https://get-ebooks-by.appspot.com/" rel="noopener ugc nofollow" target="_blank">https://get-ebooks-by.appspot.com/</a></li><li id="daa7" class="lp lq hi io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">知识库:<a class="ae jk" href="https://github.com/PicardParis/get_ebooks_by" rel="noopener ugc nofollow" target="_blank">https://github.com/PicardParis/get_ebooks_by</a></li><li id="99dc" class="lp lq hi io b ip ly it lz ix ma jb mb jf mc jj lu lv lw lx bi translated">这个应用程序主要依赖于谷歌图书API的网络连接，绝对不是一个CPU压力。与在本地900 Mbps-下载/200 Mbps-上传网络上的测试相比，在GCP上的性能是相似的(或者更好)。</li></ul><h2 id="aa94" class="jl jm hi bd jn jo jp jq jr js jt ju jv ix jw jx jy jb jz ka kb jf kc kd ke kf bi translated">接下来…</h2><p id="e1fc" class="pw-post-body-paragraph im in hi io b ip kg ir is it kh iv iw ix ki iz ja jb kj jd je jf kk jh ji jj hb bi translated">敬请期待</p></div></div>    
</body>
</html>