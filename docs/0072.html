<html>
<head>
<title>A to Z of Google Cloud Platform a personal selection — K is for keys</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云平台的a到Z个人选择——K代表键</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/a-to-z-of-google-cloud-platform-a-personal-selection-k-is-for-keys-10bc0cdf7e47?source=collection_archive---------1-----------------------#2016-02-28">https://medium.com/google-cloud/a-to-z-of-google-cloud-platform-a-personal-selection-k-is-for-keys-10bc0cdf7e47?source=collection_archive---------1-----------------------#2016-02-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d22a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于K，我想触及一些关键的相关主题。</p><p id="75fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当使用GCP时，您不可避免地要使用API密钥、用于登录的SSH密钥以及用于加密静态数据的加密密钥。因此，我将在这里谈一谈这些(虽然我只是触及表面！)</p><p id="15ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，Compute Engine会对所有静态数据进行加密，并为您管理这种加密，而无需您执行任何其他操作。有各种各样的原因，我不会在这里深入讨论您可能想要使用自己的加密密钥。</p><p id="dca1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是密钥管理很难，您需要确保您有适当的流程来管理以下事项:</p><ul class=""><li id="ac96" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">密钥存储</li><li id="03fa" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">密钥分发</li><li id="21cc" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">密钥撤销</li><li id="3501" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">密钥旋转</li><li id="46f5" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">保护密钥不被未授权用户使用</li><li id="b9f3" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">密钥恢复</li></ul><p id="057d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不打算讨论这些问题，因为这超出了讨论范围，而且有大量的文章讨论这些问题以及解决这些问题的方法。</p><p id="6ed8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于密钥管理系统，我只是想让你知道，假设你有一个合适的密钥管理系统，你实际上可以带自己的钥匙(BYOK)和GCP一起使用。阅读<a class="ae jr" href="https://cloud.google.com/compute/docs/disks/customer-supplied-encryption" rel="noopener ugc nofollow" target="_blank">此处</a>了解如何在GCE中使用您自己的密钥，或<a class="ae jr" href="https://cloud.google.com/storage/docs/encryption" rel="noopener ugc nofollow" target="_blank">此处</a>了解在GCS中使用相同密钥的详细信息。</p><p id="86cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在看起来是一个接触SSH以及如何添加和删除GCE实例的额外SSH键的好地方，看两种不同的方法(我知道我知道！) .</p><p id="c918" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">宋承宪</strong></p><p id="0f9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，项目所有者和编辑可以SSH到GCE实例中，但是您可能希望在实例上为其他用户或应用程序使用额外的SSH密钥。你可以用GCP做到这一点，这里有记录<a class="ae jr" href="https://cloud.google.com/compute/docs/instances/adding-removing-ssh-keys" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="c859" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">做这件事时，我想提请注意几点:。</p><ul class=""><li id="0f8c" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">计算引擎通过向项目元数据添加公钥来管理SSH密钥。项目元数据应用于项目中的所有实例，因此向项目元数据中添加一个公共密钥将赋予该密钥对项目中所有实例的SSH访问权限</li><li id="de98" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">将SSH密钥添加到元数据时，您将负责分发、撤销、恢复、循环等</li></ul><p id="113f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您还可以将单个的<a class="ae jr" href="https://cloud.google.com/compute/docs/access/user-accounts/" rel="noopener ugc nofollow" target="_blank">用户帐户</a>添加到您的项目中，如果您使用</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="d763" class="kb kc hi jx b fi kd ke l kf kg">gcloud beta compute users create [USERNAME — owner user@example.com]</span></pre><p id="667f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要创建用户帐户，请使用以下命令</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="b705" class="kb kc hi jx b fi kd ke l kf kg">gcloud beta compute ssh [USERNAME@]INSTANCE</span></pre><p id="ced5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将自动为该帐户生成一个公钥/私钥对，并允许您登录。</p><p id="2386" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(注意，您也可以通过使用API调用或控制台来完成上述gcloud命令所做的事情)</p><p id="c653" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，这与我之前谈到的场景不同，在这个场景中，它使用用户帐户登录到实例，而前一个场景使用gcloud compute ssh命令，该命令使用<a class="ae jr" href="https://cloud.google.com/compute/docs/instances/managing-ssh-keys" rel="noopener ugc nofollow" target="_blank">元数据ssh密钥</a>，忽略任何用户帐户。</p><p id="99c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用以下命令轻松删除帐户并撤销SSH访问权限:</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="a8be" class="kb kc hi jx b fi kd ke l kf kg">gcloud beta compute users delete USERNAME</span></pre><p id="dff1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要删除用户</p><p id="e52c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和</p><pre class="js jt ju jv fd jw jx jy jz aw ka bi"><span id="7e84" class="kb kc hi jx b fi kd ke l kf kg">gcloud beta compute users remove-keys [USERNAME]</span></pre><p id="67c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">撤销帐户的所有公钥</p><p id="d417" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，在什么情况下应该使用一种方法而不是另一种方法呢？我认为元数据方法非常适合那些希望对项目中的每个实例使用SSH密钥的场景，而第二种方法对于用户访问项目中较小的一组实例来说无疑是一种非常好的方法。</p><p id="313b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">无论如何，在这一点上提到GCP命令行工具<a class="ae jr" href="https://cloud.google.com/sdk/gcloud/" rel="noopener ugc nofollow" target="_blank"> gcloud </a>对我来说是有意义的。这允许您从命令行管理GCP资源。</p><p id="870f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它使用了<a class="ae jr" href="https://developers.google.com/identity/protocols/OAuth2" rel="noopener ugc nofollow" target="_blank"> oauth 2.0 </a>(在那个链接中有一些很好的图表，它们比我解释oauth 2.0如何工作要好得多)。这里很好地描述了实际流程<a class="ae jr" href="https://cloud.google.com/compute/docs/gcloud-compute/#auth" rel="noopener ugc nofollow" target="_blank">。如果您想知道oauth流创建的凭证在哪里，它们在~/中。配置/gcloud</a></p><p id="388c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> API凭证</strong></p><p id="5751" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jr" href="https://cloud.google.com/compute/docs/authentication" rel="noopener ugc nofollow" target="_blank">服务帐户</a>是特殊的帐户，可以将访问范围缩小到您需要的GCP资源。至关重要的是，这些帐户的密钥管理可以由GCP管理，GCP管理密钥轮换，当您的应用程序在GCE和GAE上运行时，这是您应该采用的方法(它无缝地工作)</p><p id="671d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，如果您需要从本地或其他云访问GCP资源，那么您需要<a class="ae jr" href="https://cloud.google.com/storage/docs/authentication#generating-a-private-key" rel="noopener ugc nofollow" target="_blank">创建并下载密钥</a>。</p><p id="2617" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">私钥可以JSON和PKCS12格式下载。与密钥相关联的是一些附加信息，即电子邮件地址和客户端ID。如果查看控制台，您会看到与生成的密钥相关联的标识符:</p><figure class="js jt ju jv fd ki er es paragraph-image"><div class="er es kh"><img src="../Images/84e393855e5f029322eabb2e83fdc5c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/0*hMxuluo-0mwhEXwt."/></div></figure><p id="9d45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于密钥管理的常见警告适用</p><p id="79ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不想对服务帐户不公，但是我想说花一点时间阅读和理解关于使用<a class="ae jr" href="https://cloud.google.com/compute/docs/api/how-tos/authorization" rel="noopener ugc nofollow" target="_blank">服务帐户</a>来授权对GCP API的请求。</p><p id="25b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于需要使用自己的密钥来加密和解密数据的情况，服务帐户和自带密钥的组合可能是实现这一点的方法。服务帐户与GCP资源通信，并使用您自己的密钥来加密和解密数据。</p><p id="f3fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我要感谢我的同事Vic @vicnastea，他好心地帮我审阅了这篇文章。印象深刻的是，他也没有抱怨我对字母“z”的回避😃</p></div></div>    
</body>
</html>