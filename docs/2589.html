<html>
<head>
<title>Google Cloud Workflows Terraform Module</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google云工作流Terraform模块</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-cloud-workflows-terraform-module-cfe91a257cf?source=collection_archive---------2-----------------------#2022-12-04">https://medium.com/google-cloud/google-cloud-workflows-terraform-module-cfe91a257cf?source=collection_archive---------2-----------------------#2022-12-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/59fef282f57b7fe0cce509623ad2b58e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lpoJhV99LLwKx1DXeafzAQ.png"/></div></div></figure><p id="ad34" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">本</em> <strong class="is hj"> <em class="jo">博客</em> </strong> <em class="jo">对</em><a class="ae jp" href="http://terraform-google-cloud-workflows" rel="noopener ugc nofollow" target="_blank"><em class="jo">terraform-Google-cloud-workflows</em></a><em class="jo">模块进行了高度概述。在这个博客中，我们将展示一些可以使用这个模块的用例。除此之外，我们将展示一些使用模块的例子。</em></p><h1 id="6ea4" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">介绍</h1><p id="e43b" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">想要在GCP上实施IT流程自动化、业务流程自动化、应用集成和微服务编排、数据和ML管道的客户可以使用<a class="ae jp" href="https://github.com/GoogleCloudPlatform/terraform-google-cloud-workflows" rel="noopener ugc nofollow" target="_blank">云工作流Terraform模块</a>来实施。该模块在GCP上部署云工作流，该工作流可以由<a class="ae jp" href="https://cloud.google.com/scheduler" rel="noopener ugc nofollow" target="_blank">云调度器</a>触发，或者基于<a class="ae jp" href="https://cloud.google.com/eventarc" rel="noopener ugc nofollow" target="_blank">事件弧</a>触发。这将通过结合谷歌云服务和API来构建可靠的应用程序、流程自动化以及数据和机器学习管道，遵循基础设施即代码原则，从而使用户受益。</p><ul class=""><li id="53b2" class="kt ku hi is b it iu ix iy jb kv jf kw jj kx jn ky kz la lb bi translated"><a class="ae jp" href="https://cloud.google.com/workflows/docs/overview" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">Google Cloud Workflows</strong></a>是一个完全托管的编排平台，按照您定义的顺序执行服务:一个<em class="jo">工作流</em>。这些工作流可以组合服务，包括托管在Google云服务上的定制服务，如Cloud Run、Cloud Functions、Cloud Vision AI、BigQuery等。或者任何基于HTTP的API。</li><li id="fac3" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated"><a class="ae jp" href="https://cloud.google.com/scheduler" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">云调度器</strong> </a>是一款完全托管的企业级cron作业调度器。它允许您安排几乎任何作业，包括批处理、大数据作业、云基础架构操作等。</li><li id="2de6" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated"><a class="ae jp" href="https://cloud.google.com/eventarc/docs" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> Eventarc </strong> </a>让您能够使用响应状态变化的松散耦合服务，从谷歌服务、SaaS和您自己的应用程序异步交付事件。Eventarc不需要基础架构管理，您可以优化生产效率和成本，同时构建一个现代化的事件驱动型解决方案。</li></ul></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="4095" class="jq jr hi bd js jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn bi translated">用例</h1><p id="947e" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">有几个用例可以使用与云调度程序或事件Arc集成的云工作流terraform模块</p><ul class=""><li id="39d6" class="kt ku hi is b it iu ix iy jb kv jf kw jj kx jn ky kz la lb bi translated"><strong class="is hj">服务编排</strong> : <em class="jo">通过组合服务来创建解决方案</em> —跨多个系统执行一系列操作，等待所有操作完成。可以由事件驱动。</li><li id="ed14" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated"><strong class="is hj">批处理作业</strong> : <em class="jo">操作多个项目</em>——对一组项目或批处理数据进行操作。经常预定。例如:</li><li id="137b" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated"><strong class="is hj">业务流程</strong> : <em class="jo">自动化业务线工作流</em> —对业务流程中的步骤进行编码，包括条件、操作和人在回路事件。</li><li id="5fa3" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated"><strong class="is hj"> IT流程自动化:</strong> <em class="jo">服务操作的托管执行</em> —轻松编写Google云服务操作的脚本序列。</li></ul></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="b214" class="jq jr hi bd js jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn bi translated">Terraform模块详情</h1><p id="53c0" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">以下是运行terraform工作流模块所需的变量。</p><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="lx ly l"/></div></figure><p id="fa96" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> workflow_trigger </strong>变量定义了工作流的触发器。这将让用户定义<strong class="is hj">云调度器或事件弧触发器。下面是相同的terraform变量模式。</strong></p><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="lx ly l"/></div></figure><h2 id="c1fa" class="lz jr hi bd js ma mb mc jw md me mf ka jb mg mh ke jf mi mj ki jj mk ml km mm bi translated">定义云调度程序触发器</h2><p id="82ab" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">要将云调度程序定义为触发器，用户必须使用<em class="jo"> cloud_scheduler </em>创建一个带有以下参数的映射</p><ul class=""><li id="2cc8" class="kt ku hi is b it iu ix iy jb kv jf kw jj kx jn ky kz la lb bi translated"><strong class="is hj"> <em class="jo">名称</em> </strong>:云调度器名称</li><li id="c951" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated"><strong class="is hj"><em class="jo">cron</em></strong>:<a class="ae jp" href="https://cloud.google.com/scheduler/docs/configuring/cron-job-schedules" rel="noopener ugc nofollow" target="_blank">cron job格式</a>进度表</li><li id="4d72" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated"><strong class="is hj"> <em class="jo"> time_zone </em> </strong>:运行cron的时区</li><li id="c04f" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated"><strong class="is hj"> <em class="jo">截止日期</em> </strong>:作业尝试的截止日期</li><li id="8d97" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated"><strong class="is hj"><em class="jo">Service _ Account _ email</em></strong>:运行云调度器的服务账号。</li></ul><p id="f47d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是一个例子</p><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="lx ly l"/></div></figure><h2 id="f00e" class="lz jr hi bd js ma mb mc jw md me mf ka jb mg mh ke jf mi mj ki jj mk ml km mm bi translated">定义事件电弧触发器</h2><p id="7312" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">要将事件弧定义为触发器，用户必须使用<em class="jo"> cloud_scheduler </em>和以下参数创建地图</p><ul class=""><li id="a89f" class="kt ku hi is b it iu ix iy jb kv jf kw jj kx jn ky kz la lb bi translated"><strong class="is hj"> <em class="jo">名称</em> </strong>:事件电弧触发名称</li><li id="3133" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated"><strong class="is hj"><em class="jo">Service _ Account _ email</em></strong>:运行事件Arc触发器的服务账号。</li><li id="7a21" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated"><strong class="is hj"> <em class="jo">匹配条件</em> : </strong>事件电弧触发的过滤条件。这是一个数组。因此，可以定义多个匹配标准。</li></ul><p id="8dbb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是一个例子</p><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="lx ly l"/></div></figure></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="ca57" class="jq jr hi bd js jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn bi translated">模块使用示例</h1><h2 id="443e" class="lz jr hi bd js ma mb mc jw md me mf ka jb mg mh ke jf mi mj ki jj mk ml km mm bi translated">1.安排工作流调用REST API</h2><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/8f9e3990f7997f6e05c0e354f38dfbed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qqzNZelfoPvhxSwSM2ktJA.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated"><strong class="bd js">云调度程序触发工作流</strong></figcaption></figure><p id="ea34" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要实现，请参考使用<a class="ae jp" href="https://github.com/GoogleCloudPlatform/terraform-google-cloud-workflows" rel="noopener ugc nofollow" target="_blank">地形模块</a>安排工作流的<a class="ae jp" href="https://github.com/GoogleCloudPlatform/terraform-google-cloud-workflows/tree/main/examples/schedule_workflow" rel="noopener ugc nofollow" target="_blank">示例</a>。在这个例子中，我们有一个基于cron <strong class="is hj"> */3 * * * *调用REST API的工作流。</strong></p><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="lx ly l"/></div><figcaption class="mo mp et er es mq mr bd b be z dx translated"><strong class="ak">带调度器的云工作流</strong></figcaption></figure><blockquote class="ms mt mu"><p id="78b2" class="iq ir jo is b it iu iv iw ix iy iz ja mv jc jd je mw jg jh ji mx jk jl jm jn hb bi translated">在运行上述示例时，将创建一个调度器和工作流。工作流将使用云调度器作为触发器。</p></blockquote><h2 id="75cd" class="lz jr hi bd js ma mb mc jw md me mf ka jb mg mh ke jf mi mj ki jj mk ml km mm bi translated">2.GCS新对象事件触发工作流</h2><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/45c930eb3db43963a47795e3b82dcf29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w1TIgw36t1VXg0837yMMSA.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated"><strong class="bd js">事件弧事件触发工作流程</strong></figcaption></figure><p id="55c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要实现，请参考<a class="ae jp" href="https://github.com/GoogleCloudPlatform/terraform-google-cloud-workflows/tree/main/examples/schedule_workflow" rel="noopener ugc nofollow" target="_blank">示例</a>，该示例使用<a class="ae jp" href="https://github.com/GoogleCloudPlatform/terraform-google-cloud-workflows" rel="noopener ugc nofollow" target="_blank"> terraform模块</a>通过事件弧<strong class="is hj">基于在某个GCS桶中创建的新对象触发工作流。</strong></p><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="lx ly l"/></div><figcaption class="mo mp et er es mq mr bd b be z dx translated"><strong class="ak">在新GCS对象上触发事件弧的云工作流</strong></figcaption></figure><blockquote class="ms mt mu"><p id="5713" class="iq ir jo is b it iu iv iw ix iy iz ja mv jc jd je mw jg jh ji mx jk jl jm jn hb bi translated">在运行上述示例时，您将创建一个事件Arc触发器和工作流。事件Arc触发器的事件类型为<strong class="is hj">Google . cloud . storage . object . v1 . finalized</strong>。工作流将事件Arc触发器作为其触发器。</p></blockquote><h2 id="452e" class="lz jr hi bd js ma mb mc jw md me mf ka jb mg mh ke jf mi mj ki jj mk ml km mm bi translated">3.触发工作流的发布订阅事件</h2><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mz"><img src="../Images/a6986bb1c021549efaf3a2c9d09d1142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sc9LGD3kMd64wXhLSogtJg.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated"><strong class="bd js">云工作流，在新发布的消息上触发事件弧</strong></figcaption></figure><p id="c6c0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要实现，请参考<a class="ae jp" href="https://github.com/GoogleCloudPlatform/terraform-google-cloud-workflows/tree/main/examples/pubsub_event_arc_trigger_workflow" rel="noopener ugc nofollow" target="_blank">示例</a>，该示例使用<a class="ae jp" href="https://github.com/GoogleCloudPlatform/terraform-google-cloud-workflows" rel="noopener ugc nofollow" target="_blank"> terraform模块</a>来触发基于通过事件弧<strong class="is hj">发布到Pubsub的新消息的工作流。</strong></p><figure class="lt lu lv lw fd ij"><div class="bz dy l di"><div class="lx ly l"/></div><figcaption class="mo mp et er es mq mr bd b be z dx translated"><strong class="ak">云工作流，在新发布的消息上触发事件弧</strong></figcaption></figure><blockquote class="ms mt mu"><p id="7fd2" class="iq ir jo is b it iu iv iw ix iy iz ja mv jc jd je mw jg jh ji mx jk jl jm jn hb bi translated">在运行上述示例时，您将创建一个事件Arc触发器和工作流。事件Arc触发器的事件类型为<strong class="is hj">Google . cloud . pubsub . topic . v1 . message published</strong>。工作流将事件Arc触发器作为其触发器。</p></blockquote></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="bc45" class="jq jr hi bd js jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn bi translated">结论</h1><p id="56d1" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated"><em class="jo">总之，用户可以使用</em><a class="ae jp" href="http://terraform-google-cloud-workflows" rel="noopener ugc nofollow" target="_blank"><strong class="is hj"><em class="jo">terraform-Google-cloud-workflows</em></strong></a><em class="jo">来部署工作流，同时触发</em> <strong class="is hj"> <em class="jo">云调度</em> </strong> <em class="jo">或</em> <strong class="is hj"> <em class="jo">事件弧触发</em> </strong> <em class="jo">。上面显示的例子应该可以帮助用户实现他们自己的工作流。</em></p><p id="e2bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">如对</em><a class="ae jp" href="http://terraform-google-cloud-workflows" rel="noopener ugc nofollow" target="_blank"><strong class="is hj"><em class="jo">terraform-Google-cloud-workflows</em></strong></a><strong class="is hj"><em class="jo"/></strong><em class="jo">模块</em> <strong class="is hj"> <em class="jo"> </em> </strong> <em class="jo">有任何顾虑或问题，请在此</em><a class="ae jp" href="https://github.com/GoogleCloudPlatform/terraform-google-cloud-workflows/issues" rel="noopener ugc nofollow" target="_blank"><em class="jo"/></a><strong class="is hj"><em class="jo">。</em>T49】</strong></p></div></div>    
</body>
</html>