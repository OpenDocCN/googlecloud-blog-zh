<html>
<head>
<title>Cold Disaster recovery on Google Cloud for applications running on-premises</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Google Cloud上为内部运行的应用程序进行冷灾难恢复</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/cold-disaster-recovery-on-google-cloud-for-applications-running-on-premises-114b31933d02?source=collection_archive---------0-----------------------#2019-11-03">https://medium.com/google-cloud/cold-disaster-recovery-on-google-cloud-for-applications-running-on-premises-114b31933d02?source=collection_archive---------0-----------------------#2019-11-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="9cbc" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在云中烹饪</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/dfa772838ed14a2206dc51dbc1418dea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GgHbdAGHJ0W8IbT1"/></div></div></figure><h1 id="a5d5" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">介绍</h1><p id="5b96" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated"><strong class="kd hj"> <em class="kx">【在云端做饭】</em> </strong>是一个博客和视频系列，帮助企业和开发者在Google Cloud上构建商业解决方案。在这第二个迷你系列中，我将介绍Google Cloud上的灾难恢复。当你在网上的时候，灾难是很难处理的。在接下来的几篇文章中，我们将详细阐述如何应对地震、停电、洪水、火灾等灾害。如果你对之前的迷你系列感兴趣，请查看<a class="ae ky" rel="noopener" href="/google-cloud/hosting-web-applications-on-google-cloud-an-overview-46f5605eb3a6">的这个</a>。</p><p id="2712" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">这是这个系列的计划。</p><ol class=""><li id="3064" class="le lf hi kd b ke kz kh la kk lg ko lh ks li kw lj lk ll lm bi translated"><a class="ae ky" rel="noopener" href="/google-cloud/hosting-web-applications-on-google-cloud-an-overview-87d0962931a3">灾难恢复概述</a></li><li id="9206" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">基于Google Cloud的本地应用冷灾难恢复(本文)</li><li id="1308" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">基于Google Cloud的内部应用热灾难恢复</li><li id="e070" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">基于Google Cloud的内部应用热灾难恢复</li><li id="a076" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">Google云中应用程序的冷灾难恢复</li><li id="2616" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">Google云中应用程序的冷灾难恢复</li><li id="11c5" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">Google云中应用程序的热灾难恢复</li><li id="7ef4" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">Google云中应用程序的热灾难恢复</li><li id="f8f8" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">Google Cloud上的数据灾难恢复:第1部分</li><li id="6d5f" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">Google Cloud上的数据灾难恢复:第2部分</li></ol><p id="c509" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">在本文中，您将学习为部署在本地的应用程序设置一个冷灾难恢复模式。所以，继续读下去吧！</p><h1 id="7da5" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">你会学到什么</h1><ul class=""><li id="78ba" class="le lf hi kd b ke kf kh ki kk ls ko lt ks lu kw lv lk ll lm bi translated">不同应用程序的灾难恢复</li><li id="745a" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">冷灾难恢复模式及示例</li><li id="039d" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">灾难来袭前需要采取的步骤</li><li id="f276" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">发生灾难时需要采取的步骤</li><li id="6988" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">灾难发生后需要采取的步骤</li></ul><h1 id="f9bb" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">先决条件</h1><ul class=""><li id="0d59" class="le lf hi kd b ke kf kh ki kk ls ko lt ks lu kw lv lk ll lm bi translated">谷歌云的基本概念和结构，这样你就可以识别产品的名称。</li></ul><h1 id="0038" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">看看这个视频</h1><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lw lx l"/></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">Google云上的冷灾难恢复</figcaption></figure><h1 id="db24" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">针对不同应用的灾难恢复(DR)</h1><p id="f31b" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">您的灾难恢复计划将取决于您的特定应用程序和恢复目标。让我们考虑几个场景</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mc"><img src="../Images/bb9916d0536cd9f77645318202664447.png" data-original-src="https://miro.medium.com/v2/resize:fit:272/format:webp/1*PcBLcocLtFO4uys-3G_f6g.png"/></div></figure><ul class=""><li id="cab9" class="le lf hi kd b ke kz kh la kk lg ko lh ks li kw lv lk ll lm bi translated">如果您运行<strong class="kd hj">批处理工作负载</strong>，它们往往是非关键任务，不需要为高可用性而设计。在这种情况下，您可以将可抢占的VM实例与Google云存储结合使用。和..这就是你的灾难恢复计划！</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es md"><img src="../Images/42f4ef05db7c25b9ca7ddc8693b474b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:284/format:webp/1*2BTXW36AR_FN1J0vn4H4mA.png"/></div></figure><ul class=""><li id="e2ce" class="le lf hi kd b ke kz kh la kk lg ko lh ks li kw lv lk ll lm bi translated">如果您有一个<strong class="kd hj">视频流</strong>解决方案，那么从搜索到实际的流内容，整个<strong class="kd hj">体验都需要高可用性，否则，客户可能会转向您的竞争对手。</strong></li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es me"><img src="../Images/71cd0fbb6f764daa640b0d68cb18fa9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jYwXJCVLIdaXkrl0hrkUGg.gif"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">电子商务网站</figcaption></figure><ul class=""><li id="37bb" class="le lf hi kd b ke kz kh la kk lg ko lh ks li kw lv lk ll lm bi translated">如果你运行<strong class="kd hj">一个电子商务网站</strong>，那么实际的采购渠道需要HA，但是向客户发送通知的电子邮件流程可以容忍一点延迟。这是热(购买)和暖或冷(通知)模式的混合。</li></ul><h1 id="2dd3" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">让我们用一个例子来学习冷DR模式</h1><p id="888e" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated"><strong class="kd hj"> <em class="kx"> Mane-Street Art </em> </strong>是一家在内部运行应用程序的公司，并且正在Google Cloud上构建灾难恢复基础架构。他们现在正在制定一个低预算的灾难恢复计划，并接受稍高的RPO和RTO值。这意味着他们需要建立一个冷灾难恢复模式。</p><p id="3385" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated"><em class="kx">注意:如果您不熟悉这里使用的术语(RTO、RPO、DR模式),请查看</em> <a class="ae ky" rel="noopener" href="/google-cloud/hosting-web-applications-on-google-cloud-an-overview-87d0962931a3"> <em class="kx">以前的博客</em> </a> <em class="kx">以获得概述。</em></p><p id="85a8" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">在<strong class="kd hj">冷灾难恢复模式</strong>中，Mane-street art在灾难恢复Google Cloud项目中需要最少的资源——仅够实现恢复场景。当灾难发生时，故障转移策略需要在Google Cloud中启动生产环境的镜像。</p><p id="a836" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">在任何灾难恢复模式中，您都需要了解在灾难发生前需要采取什么步骤，灾难发生时会发生什么，以及灾难过去后需要发生什么。</p><h1 id="4b10" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">冷灾难恢复模式—它是如何工作的？</h1><h2 id="7d4f" class="mf jk hi bd jl mg mh mi jp mj mk ml jt kk mm mn jv ko mo mp jx ks mq mr jz ms bi translated">灾难来袭前应采取的步骤</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es me"><img src="../Images/e595a30f0d92a896fdda4f8673273480.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*NQ_dR93EUyn5z44V6h2LxA.gif"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">“在灾难以冷灾难恢复模式袭来之前要采取的步骤”的视觉效果</figcaption></figure><ul class=""><li id="9761" class="le lf hi kd b ke kz kh la kk lg ko lh ks li kw lv lk ll lm bi translated">创建一个VPC网络</li><li id="4076" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">然后配置内部网络和Google cloud网络之间的连接。</li><li id="5913" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">您需要一个云存储桶作为我们数据备份的目标。</li><li id="14e4" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">为了让您的本地机器将数据库备份上传到google cloud，您将需要一个服务帐户密钥，以便在自动脚本中对您的机器进行身份验证。</li><li id="0b4c" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">您可以使用IAM策略来限制正确用户的访问权限，并确保服务帐户拥有所需的最低权限</li><li id="804d" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">确保上传和下载，到和从云存储桶工作。然后，您最后编写数据传输脚本</li><li id="fc50" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">创建一个计划任务来运行脚本。</li><li id="1966" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">创建为生产环境中每种类型的服务器配置的自定义映像。</li><li id="e7a0" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">将DNS配置为指向面向互联网的web服务。</li><li id="7226" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">创建一个部署管理器模板，该模板将使用之前配置的定制映像在您的Google cloud网络中创建服务器。</li></ul><h2 id="6134" class="mf jk hi bd jl mg mh mi jp mj mk ml jt kk mm mn jv ko mo mp jx ks mq mr jz ms bi translated">灾难来袭时应采取的措施</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es me"><img src="../Images/302ee0d160dbcc3427b180dea995c006.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*JtdNS_DYX1yPhWyS5egQqA.gif"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">“在冷灾难恢复模式下发生灾难时要采取的步骤”的可视化内容</figcaption></figure><ul class=""><li id="b0ea" class="le lf hi kd b ke kz kh la kk lg ko lh ks li kw lv lk ll lm bi translated">当灾难发生时，您只需要执行部署管理器模板，它将自动创建一个google云部署。</li><li id="36bc" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">应用云存储桶中最新的数据库备份和事务日志</li><li id="52c7" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">通过模拟恢复环境中的用户来测试应用程序是否按预期工作。</li><li id="c594" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">然后最后点云DNS到google cloud上的web服务器。</li></ul><h2 id="da5f" class="mf jk hi bd jl mg mh mi jp mj mk ml jt kk mm mn jv ko mo mp jx ks mq mr jz ms bi translated">灾难过去后应采取的步骤</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es me"><img src="../Images/086ba2d94d30189cd234a3dac0d5f8d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*-FLBkUpaGLuyHNEhDgmEeA.gif"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">“灾难过去后，在冷灾难恢复模式下要采取的步骤”的可视化</figcaption></figure><p id="8e70" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">当生产环境再次在本地运行，并且可以支持生产工作负载时，颠倒您所遵循的步骤。通常是这样的:</p><ul class=""><li id="6779" class="le lf hi kd b ke kz kh la kk lg ko lh ks li kw lv lk ll lm bi translated">备份运行在Google cloud上的数据库和事务日志</li><li id="6fa9" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">将备份文件复制并应用到生产环境中的数据库。</li><li id="aaeb" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">在这个阶段，您应该阻止连接到Google cloud中的应用程序，或者您可以在数据库成功恢复后停止连接，并应用备份后发生的任何事务。</li><li id="4f4e" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">在我们的示例中，我们需要停止到全局负载平衡器的连接。从这时起，您的应用程序将不可用，直到您完成生产环境的恢复。</li><li id="d3cb" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">将云DNS配置为指向您的本地web服务。</li><li id="8983" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">确保您将数据复制到云存储的流程按预期运行。</li><li id="c88e" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">最后，删除您的部署。</li></ul><h1 id="229d" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">结论</h1><p id="44cc" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">如果您在本地运行应用程序，预算有限，并且可以在较高的RTO和RPO值下工作，那么冷灾难恢复模式是最佳选择。您了解了如何在冷灾难恢复场景中从故障中恢复环境。敬请关注即将发布的文章，在这些文章中，您将了解如何建立更多对您的业务有意义的灾难恢复模式。</p><h1 id="eaa9" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">后续步骤</h1><ul class=""><li id="6996" class="le lf hi kd b ke kf kh ki kk ls ko lt ks lu kw lv lk ll lm bi translated">在<a class="ae ky" href="https://medium.com/google-cloud" rel="noopener">谷歌云平台媒体</a>上关注这个博客系列。</li><li id="477c" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">参考<a class="ae ky" href="https://cloud.google.com/solutions/dr-scenarios-planning-guide" rel="noopener ugc nofollow" target="_blank">灾难恢复解决方案</a>。</li><li id="ce20" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">关注<a class="ae ky" href="https://www.youtube.com/watch?v=pxp7uYUjH_M" rel="noopener ugc nofollow" target="_blank">获取云端烹饪</a>视频系列，订阅谷歌云平台YouTube频道</li><li id="bd75" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">想要更多的故事？查看我的<a class="ae ky" rel="noopener" href="/@pvergadia/">媒体</a>，<a class="ae ky" href="https://twitter.com/pvergadia" rel="noopener ugc nofollow" target="_blank">在twitter上关注我</a>。</li><li id="e0f4" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">请和我们一起欣赏这部迷你剧，并了解更多类似的谷歌云解决方案:)</li></ul></div></div>    
</body>
</html>