<html>
<head>
<title>Convert Group By Grouping Sets (Teradata) to Bigquery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将分组集(Teradata)转换为Bigquery</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/convert-group-by-grouping-sets-teradata-to-bigquery-fb43d86663b0?source=collection_archive---------8-----------------------#2022-11-22">https://medium.com/google-cloud/convert-group-by-grouping-sets-teradata-to-bigquery-fb43d86663b0?source=collection_archive---------8-----------------------#2022-11-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="51ed" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">简介:</h1><p id="9e81" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Group by Grouping Sets是Group by子句的teradata扩展，允许在单个语句中执行多个group by子句。</p><p id="831a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">GROUP BY分组集等效于同一结果集中两个或多个GROUP BY操作的联合。</p><p id="1a3e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">空括号()指定对查询中指定的所有组求和的单个总计组。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/d82b99b080e067dc1b194dc5de3071b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JcD48n_LcuDHoqQCxvkPrw.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">Teradata SQL到Bigquery SQL</figcaption></figure><h1 id="a8a0" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">先决条件</h1><ol class=""><li id="047d" class="kw kx hi jf b jg jh jk jl jo ky js kz jw la ka lb lc ld le bi translated">Teradata数据仓库及其SQL语法的基础知识</li><li id="8f33" class="kw kx hi jf b jg lf jk lg jo lh js li jw lj ka lb lc ld le bi translated">对Bigquery及其SQL语法有很好的理解</li></ol><h1 id="7d69" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">转换逻辑</h1><h2 id="b64e" class="lk ig hi bd ih ll lm ln il lo lp lq ip jo lr ls it js lt lu ix jw lv lw jb lx bi translated">示例场景:</h2><p id="b942" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">比方说，要求是按国家内的州、城市和总的sales_summary来查找sales _ summary。</p><p id="3ed5" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">样本数据如下所示</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ly"><img src="../Images/29f3aef90c43918b7984bfacd8fd870c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KJWFLrd0xJx6Zu0448dA7w.png"/></div></div></figure><h2 id="4c07" class="lk ig hi bd ih ll lm ln il lo lp lq ip jo lr ls it js lt lu ix jw lv lw jb lx bi translated"><strong class="ak"> Teradata SQL: </strong></h2><blockquote class="lz ma mb"><p id="8850" class="jd je mc jf b jg kb ji jj jk kc jm jn md kd jq jr me ke ju jv mf kf jy jz ka hb bi translated">SELECT country，state，city，SUM(sales _ amount)as total _ sales<br/>FROM sales _ table<br/>GROUP BY GROUPING SETS((country，state)，(city)，))；</p></blockquote><h2 id="9bcc" class="lk ig hi bd ih ll lm ln il lo lp lq ip jo lr ls it js lt lu ix jw lv lw jb lx bi translated"><strong class="ak">查询输出:</strong></h2><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mg"><img src="../Images/ff5478fa57ebe082470be921d89111e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FbUju4kiPg_qxr-sqnnqrw.png"/></div></div></figure><h2 id="8f63" class="lk ig hi bd ih ll lm ln il lo lp lq ip jo lr ls it js lt lu ix jw lv lw jb lx bi translated"><strong class="ak">大查询SQL: </strong></h2><blockquote class="lz ma mb"><p id="5cfa" class="jd je mc jf b jg kb ji jj jk kc jm jn md kd jq jr me ke ju jv mf kf jy jz ka hb bi translated">SELECT <br/> sales_table.country为国家，<br/> sales_table.state为州，<br/> NULL为城市，<br/>sum(sales _ table . sales _ amount)为total _ sales<br/>FROM<br/>sales _ table<br/>GROUP BY 1，2</p><p id="18e7" class="jd je mc jf b jg kb ji jj jk kc jm jn md kd jq jr me ke ju jv mf kf jy jz ka hb bi translated">联合所有</p><p id="3782" class="jd je mc jf b jg kb ji jj jk kc jm jn md kd jq jr me ke ju jv mf kf jy jz ka hb bi translated">选择<br/> NULL为国家，<br/> NULL为州，<br/> sales_table.city为城市，<br/>sum(sales _ table . sales _ amount)为总销售额<br/>从<br/> sales_table <br/>分组按3</p><p id="591f" class="jd je mc jf b jg kb ji jj jk kc jm jn md kd jq jr me ke ju jv mf kf jy jz ka hb bi translated">联合所有</p><p id="476b" class="jd je mc jf b jg kb ji jj jk kc jm jn md kd jq jr me ke ju jv mf kf jy jz ka hb bi translated">从<br/> sales_table <br/>中选择<br/> NULL为国家，<br/> NULL为州，<br/> NULL为城市，<br/>sum(sales _ table . sales _ amount)为总销售额<br/>；</p></blockquote><h2 id="9b48" class="lk ig hi bd ih ll lm ln il lo lp lq ip jo lr ls it js lt lu ix jw lv lw jb lx bi translated">翻译解释:</h2><ul class=""><li id="573c" class="kw kx hi jf b jg jh jk jl jo ky js kz jw la ka mh lc ld le bi translated">GROUP BY分组集((x)，(y)，(z))等效于GROUP BY x UNION ALL GROUP BY y UNION ALL GROUP BY z</li><li id="82bb" class="kw kx hi jf b jg lf jk lg jo lh js li jw lj ka mh lc ld le bi translated">因此，分组集((country，state)，(city)，())将有两个UNION ALL and组(country and state)(第一个查询)和(city)(第二个查询)</li><li id="5a4d" class="kw kx hi jf b jg lf jk lg jo lh js li jw lj ka mh lc ld le bi translated">空括号()指定对查询中指定的所有组求和的单个总计组。因此，第三个查询中没有group by子句</li></ul><p id="869e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">经过这些更改后，Bigquery SQL将生成与Teradata相同的输出。</p></div></div>    
</body>
</html>