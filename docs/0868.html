<html>
<head>
<title>Playing with Kotlin: “You actually know everything John Doe!”</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">玩弄科特林:“你其实什么都知道无名氏！”</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/playing-with-kotlin-you-know-everything-john-doe-8275a6e98a96?source=collection_archive---------1-----------------------#2018-12-29">https://medium.com/google-cloud/playing-with-kotlin-you-know-everything-john-doe-8275a6e98a96?source=collection_archive---------1-----------------------#2018-12-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="bc8b" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">如何完全用Kotlin构建一个完整的项目？(后端/前端+应用程序)</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/56886c74742583d68dc4578be56b2187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fn7gLL2rlQP2gRq9QjFAGQ.png"/></div></div></figure><p id="da6b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在一份长期的android自由职业合同后，因为我有一些空闲时间，我决定投身于一个完全用Kotlin编写的完整项目，只是想知道<strong class="jl hj">我能用这种优秀的语言走多远。</strong></p><p id="35e4" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">为了具体化这个完整的项目，我选择创建一个平台，<strong class="jl hj">帮助开发人员找到完美的工作</strong>，由其他专业开发人员选择和批准。</p><p id="628f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">因为我目前正在寻找一个偏远的位置，这个想法似乎很合适…😅</p><p id="76d6" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我叫它:<a class="ae kf" href="https://nobullshit.appspot.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jl hj"> NoBullshit </strong> </a>。而且现在是<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit" rel="noopener ugc nofollow" target="_blank">开源</a>👻</p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="afa8" class="kn ko hi bd kp kq kr ks kt ku kv kw kx io ky ip kz ir la is lb iu lc iv ld le bi translated">设计架构</h1><blockquote class="lf lg lh"><p id="a829" class="jj jk li jl b jm jn ij jo jp jq im jr lj jt ju jv lk jx jy jz ll kb kc kd ke hb bi translated">简单是效率的灵魂— <em class="hi">奥斯汀·弗里曼</em></p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lm"><img src="../Images/7878bfe22a81bf36146364a624336f1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fg-7SpeUn4q1eIE9f8d9LA.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">NoBullshit.io的架构</figcaption></figure><p id="64c6" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">因为这个项目倾向于Kotlin展示，我希望第一个版本非常简单:</p><ul class=""><li id="51af" class="lr ls hi jl b jm jn jp jq js lt jw lu ka lv ke lw lx ly lz bi translated"><a class="ae kf" href="https://www.nobullshit.io" rel="noopener ugc nofollow" target="_blank"> <strong class="jl hj">后端/前端:</strong> </a> <em class="li">显示</em>网站，允许任何用户<em class="li">提交工作</em>。目前，与其说它是后端，不如说它是前端(实际上我们可以认为Firebase是这里的主要后端)。然而，特别是因为这是部署在<a class="ae kf" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> GCP </a>上，这可以很容易地演变成一个合适的后端。</li><li id="fd2b" class="lr ls hi jl b jm ma jp mb js mc jw md ka me ke lw lx ly lz bi translated"><a class="ae kf" href="https://play.google.com/store/apps/details?id=io.nobullshit.nobullshit" rel="noopener ugc nofollow" target="_blank"> <strong class="jl hj">安卓app: </strong> </a> <em class="li">列出专家开发者认可的作业</em>，通过web视图展示每一个。</li></ul><h1 id="58f3" class="kn ko hi bd kp kq mf ks kt ku mg kw kx io mh ip kz ir mi is lb iu mj iv ld le bi translated">实现后端🌏</h1><p id="2403" class="pw-post-body-paragraph jj jk hi jl b jm mk ij jo jp ml im jr js mm ju jv jw mn jy jz ka mo kc kd ke hb bi translated">我习惯于使用谷歌应用引擎，它允许你在一个完全托管的无服务器平台上构建和部署高度可扩展的应用。就像AWS，不过是Google 做的<strong class="jl hj">。</strong></p><p id="fdcc" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">最近，GAE宣布<a class="ae kf" href="https://cloud.google.com/community/tutorials/kotlin-ktor-app-engine-java8" rel="noopener ugc nofollow" target="_blank">支持科特林</a>和<a class="ae kf" href="https://ktor.io/" rel="noopener ugc nofollow" target="_blank">科特</a>！所以我选择了这个方案来部署NoBullshit的后端/前端。</p><p id="92d5" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">令人惊讶的是，Ktor非常容易学习和配置(顺便说一下，<a class="ae kf" href="https://github.com/ktorio/ktor-samples" rel="noopener ugc nofollow" target="_blank">那些样本</a>给了我很大的帮助❤).你可以在<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit/tree/master/backend" rel="noopener ugc nofollow" target="_blank">“后端”模块</a>中找到NoBullshit服务器的完整代码。</p><p id="d4fe" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">基本上，当您使用Ktor创建您的web服务器时，您只需要:</p><ul class=""><li id="c0da" class="lr ls hi jl b jm jn jp jq js lt jw lu ka lv ke lw lx ly lz bi translated">创建你的服务器的<strong class="jl hj">入口点文件</strong>，它将主要配置它的<strong class="jl hj"> <em class="li">不同的路径:</em> </strong></li></ul><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mp mq l"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">摘自<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit/blob/master/backend/src/main/kotlin/io/nobullshit/HelloApplication.kt" rel="noopener ugc nofollow" target="_blank"> HelloApplication.kt </a></figcaption></figure><ul class=""><li id="6055" class="lr ls hi jl b jm jn jp jq js lt jw lu ka lv ke lw lx ly lz bi translated">在一个专用文件中，为每个页面/路径指定如何处理以及要处理哪些<strong class="jl hj"> REST方法</strong>:</li></ul><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mp mq l"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">摘自<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit/blob/master/backend/src/main/kotlin/io/nobullshit/route/Index.kt" rel="noopener ugc nofollow" target="_blank"> Index.kt </a></figcaption></figure><ul class=""><li id="ef42" class="lr ls hi jl b jm jn jp jq js lt jw lu ka lv ke lw lx ly lz bi translated">将相关的<strong class="jl hj"> HTML内容</strong>添加到一个<a class="ae kf" href="https://freemarker.apache.org/" rel="noopener ugc nofollow" target="_blank"> Freemarker </a>文件中。如果你知道Kotlin中的<a class="ae kf" href="https://kotlinlang.org/docs/reference/basic-types.html#string-templates" rel="noopener ugc nofollow" target="_blank">字符串模板</a>，你就不会对Freemarker有意见:</li></ul><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mp mq l"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">摘自<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit/blob/master/backend/src/main/resources/templates/index.ftl" rel="noopener ugc nofollow" target="_blank"> index.ftl </a></figcaption></figure><p id="084c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我还创建了一个<strong class="jl hj">模板文件</strong>，以便<strong class="jl hj">重用</strong>一些HTML组件，例如<em class="li">页眉</em>或<em class="li">页脚</em>。这个特征叫做<a class="ae kf" href="https://freemarker.apache.org/docs/dgui_misc_userdefdir.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jl hj">宏</strong> </a>。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mp mq l"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">摘自<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit/blob/master/backend/src/main/resources/templates/template.ftl" rel="noopener ugc nofollow" target="_blank"> template.ftl </a></figcaption></figure><p id="e37b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">好了🙂正如您在索引页面示例中看到的，使用Ktor的后端代码非常简单<strong class="jl hj"/><strong class="jl hj">可读</strong>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lm"><img src="../Images/fdc2106e1371dd330cd6b91fd3c58ad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*exoGHIBeO9EyE9bIWQOK8g.png"/></div></div></figure><blockquote class="lf lg lh"><p id="e140" class="jj jk li jl b jm jn ij jo jp jq im jr lj jt ju jv lk jx jy jz ll kb kc kd ke hb bi translated">测试呢？</p></blockquote><p id="0d98" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">Ktor提供了一种简单的方法来测试您的服务器，而不需要实际创建一个web测试服务器。实际上，您必须使用“<em class="li"> withTestApplication </em>方法来启动一个<strong class="jl hj">测试应用引擎</strong>。然后，你将能够处理一个请求并断言你需要的任何东西。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mp mq l"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">摘自<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit/blob/master/backend/test/ApplicationTest.kt" rel="noopener ugc nofollow" target="_blank"> ApplicationTest.kt </a></figcaption></figure><p id="9f9f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我还使用<a class="ae kf" href="https://mockk.io/" rel="noopener ugc nofollow" target="_blank">mock</a>来模拟并阻止测试期间与真实Firestore数据库的连接。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/b00a8a53211b680b57ee56af866cd6bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*va9rG680SgCB6PAr6paohA.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">后端/前端:“发布新工作”功能。</figcaption></figure><h1 id="4281" class="kn ko hi bd kp kq mf ks kt ku mg kw kx io mh ip kz ir mi is lb iu mj iv ld le bi translated">实施Android应用程序📱</h1><p id="4f0a" class="pw-post-body-paragraph jj jk hi jl b jm mk ij jo jp ml im jr js mm ju jv jw mn jy jz ka mo kc kd ke hb bi translated">作为一名Android工程师，这部分真的很简单…😅正如您在存储库中的<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit/tree/master/android" rel="noopener ugc nofollow" target="_blank">模块“Android”</a>中看到的，该应用程序使用:</p><ul class=""><li id="c696" class="lr ls hi jl b jm jn jp jq js lt jw lu ka lv ke lw lx ly lz bi translated"><a class="ae kf" href="https://google.github.io/dagger/android.html" rel="noopener ugc nofollow" target="_blank"> Dagger2 </a>用于依赖注入。在未来的版本中，我想我会给<a class="ae kf" href="https://insert-koin.io/" rel="noopener ugc nofollow" target="_blank">Koin</a>(Ktor和Android BTW)一个机会，特别是因为它看起来很容易使用DSL实现(也因为它是法语…🥖🥐🇫🇷).</li><li id="fb72" class="lr ls hi jl b jm ma jp mb js mc jw md ka me ke lw lx ly lz bi translated">FirebaseUI 用Firestore更好更方便地处理分页。</li></ul><p id="ad1a" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">现在，这个应用程序非常简单，你可能已经看到了。也许我最近通过<a class="ae kf" href="https://github.com/googlesamples/android-architecture-components" rel="noopener ugc nofollow" target="_blank"> Google samples </a>发现的唯一新的东西(至少对我来说)是定义一个类为“<strong class="jl hj"> open”的能力，只用于测试带有注释的</strong>。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mp mq l"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">摘自<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit/blob/master/android/app/src/debug/java/io/nobullshit/nobullshit/testing/OpenForTesting.kt" rel="noopener ugc nofollow" target="_blank"> OpenForTesting.kt </a>(调试)</figcaption></figure><p id="11fd" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">多亏了<a class="ae kf" href="https://kotlinlang.org/docs/reference/compiler-plugins.html" rel="noopener ugc nofollow" target="_blank"> Kotlin编译器</a>与<a class="ae kf" href="https://developer.android.com/studio/build/build-variants#build-types" rel="noopener ugc nofollow" target="_blank">构建类型</a>的结合，这种令人印象深刻的行为才成为可能。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mp mq l"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">摘自<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit/blob/master/android/app/build.gradle" rel="noopener ugc nofollow" target="_blank"> build.gradle </a></figcaption></figure><p id="6f81" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">例如，<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit/blob/master/android/app/src/main/java/io/nobullshit/nobullshit/db/dao/JobDao.kt" rel="noopener ugc nofollow" target="_blank">这个类</a> (JobDao)用我创建的<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit/blob/master/android/app/src/debug/java/io/nobullshit/nobullshit/testing/OpenForTesting.kt" rel="noopener ugc nofollow" target="_blank"> <em class="li"> OpenForTesting </em> </a>注释进行了注释(它继承了<em class="li"> OpenClass </em>注释)，允许我在my<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit/blob/master/android/app/src/androidTest/java/io/nobullshit/nobullshit/ui/joblist/TIJobList.kt" rel="noopener ugc nofollow" target="_blank">instrumented tests</a>中的<strong class="jl hj">创建一个从JobDao <strong class="jl hj"> </strong>继承</strong>的<strong class="jl hj">匿名类，并且<strong class="jl hj">用一些mock修改它的行为</strong>:</strong></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mp mq l"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">节选自<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit/blob/master/android/app/src/androidTest/java/io/nobullshit/nobullshit/ui/joblist/TIJobList.kt" rel="noopener ugc nofollow" target="_blank"> TIJobList.kt </a></figcaption></figure><p id="041b" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">不要忘记为<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit/blob/master/android/app/src/release/java/io/nobullshit/nobullshit/testing/OpenForTesting.kt" rel="noopener ugc nofollow" target="_blank">创建与<strong class="jl hj">几乎相同的注释，发布版本构建</strong></a>，<strong class="jl hj">当然没有从<em class="li"> OpenClass </em>注释继承</strong>🙂</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mp mq l"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">摘自<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit/blob/master/android/app/src/release/java/io/nobullshit/nobullshit/testing/OpenForTesting.kt" rel="noopener ugc nofollow" target="_blank"> OpenForTesting.kt </a>(发布)</figcaption></figure><p id="aa67" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">最后，关于这款android应用，我最后想和大家分享的是<a class="ae kf" href="https://mockk.io/" rel="noopener ugc nofollow" target="_blank">mock</a>的用法。这个DSL风格的模仿库使用起来非常简单，并且允许我模仿一个完整的Firestore响应。这么有用！</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mp mq l"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">摘自<a class="ae kf" href="https://github.com/PhilippeBoisney/NoBullshit/blob/master/android/app/src/androidTest/java/io/nobullshit/nobullshit/util/MockUtils.kt" rel="noopener ugc nofollow" target="_blank"> MockUtils.kt </a></figcaption></figure><p id="2444" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">此外，它的一个我非常喜欢的特性是“<a class="ae kf" href="https://mockk.io/#relaxed-mock" rel="noopener ugc nofollow" target="_blank">轻松模拟</a>”:这允许<strong class="jl hj">跳过指定每个案例的行为</strong>，同时仍然允许存根你需要的东西…👌</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/d03b48f0e5581a8d97abe7879b39f7ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JOcKIxLVb0XMaXNUrK0Z7Q.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">Android应用程序:“列出并可视化工作”功能</figcaption></figure></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="7001" class="kn ko hi bd kp kq kr ks kt ku kv kw kx io ky ip kz ir la is lb iu lc iv ld le bi translated">下一步是什么？</h1><p id="0576" class="pw-post-body-paragraph jj jk hi jl b jm mk ij jo jp ml im jr js mm ju jv jw mn jy jz ka mo kc kd ke hb bi translated">NoBullshit的第一个版本旨在与Kotlin和<strong class="jl hj">一起探索这种奇妙语言的可能性</strong>，尤其是对于后端<strong class="jl hj"/>。</p><p id="4aab" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">FWI，我只花了<strong class="jl hj"> 5天</strong>就完成了这个项目(包括测试)，感谢所有的资源和现有的样本。仔细想想，这非常快，主要是因为<strong class="jl hj">成熟的</strong>和<strong class="jl hj">庞大的</strong>科特林生态系统。</p><p id="423f" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这个项目是开源的，所以请随意贡献和推送一些新鲜的功能，或者帮我指出一些错误或最佳实践！</p><p id="790d" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">干杯👋</p><div class="mr ms ez fb mt mu"><a href="https://github.com/PhilippeBoisney/NoBullshit" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab dw"><div class="mw ab mx cl cj my"><h2 class="bd hj fi z dy mz ea eb na ed ef hh bi translated">菲利普·博伊斯尼/诺布尔什特</h2><div class="nb l"><h3 class="bd b fi z dy mz ea eb na ed ef dx translated">一个完全用Kotlin编写的示例项目。后端与Ktor和Android应用程序。-菲利普·博伊斯尼/诺布尔什特</h3></div><div class="nc l"><p class="bd b fp z dy mz ea eb na ed ef dx translated">github.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni jh mu"/></div></div></a></div></div></div>    
</body>
</html>