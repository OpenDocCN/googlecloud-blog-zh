<html>
<head>
<title>How to pass data between Cloud Build steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在云构建步骤之间传递数据</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-pass-data-between-cloud-build-steps-de5c9ebc4cdd?source=collection_archive---------0-----------------------#2019-07-25">https://medium.com/google-cloud/how-to-pass-data-between-cloud-build-steps-de5c9ebc4cdd?source=collection_archive---------0-----------------------#2019-07-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="dacc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"><em class="jd">TL；DR </em> </strong> <em class="jd">将内存中的数据保存到</em> <code class="du je jf jg jh b"><em class="jd">/workspace</em></code> <em class="jd">卷挂载，它将可用于所有后续的构建步骤。</em></p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es ji"><img src="../Images/b27a7c73463ee70ff30e32d8185918e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*51UXUu-porqd2qvW9qrWPQ.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">阿利亚·巴普蒂斯塔<a class="ae jy" href="http://www.aliyabaptista.com/" rel="noopener ugc nofollow" target="_blank">www.aliyabaptista.com</a>可视化</figcaption></figure><p id="93bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jy" href="https://cloud.google.com/cloud-build/" rel="noopener ugc nofollow" target="_blank"> Google Cloud Build </a>将您的构建作为一系列<strong class="ih hj">步骤</strong>来运行，这些步骤在隔离的容器化环境中执行。在每一步之后，容器被丢弃。<em class="jd">噗！这让你每一步都有完全不同的工具和环境，并且一步中产生的任何碎屑都不会污染下一步。</em></p><p id="464e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但有时，cruft实际上是重要的数据…您可能需要保存构建中某个步骤的状态，以便在后续步骤中使用。一种常见的模式是将它存储在一个环境变量中，但这在这里是行不通的，因为每一步都在一个单独的环境中运行(因此有单独的环境变量)。</p><h1 id="94a2" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">这样不行。不要这样做。</h1><p id="d980" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated"><em class="jd">(参见</em> <a class="ae jy" rel="noopener" href="/@davidstanke/mastering-google-cloud-build-config-syntax-8c3024607daf"> <em class="jd">掌握云构建语法</em> </a> <em class="jd">)详细了解这里使用的“突围语法”。)</em></p><figure class="jj jk jl jm fd jn"><div class="bz dy l di"><div class="lc ld l"/></div></figure><h1 id="5f26" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">改为这样做！</h1><p id="96d1" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">虽然每个步骤的容器中的所有东西都被丢弃了，但是有一样东西仍然存在:<strong class="ih hj">卷挂载</strong>。这些读写路径可以附加到任何构建步骤，并且它们将在整个构建过程中保留其内容。您可以<a class="ae jy" href="https://cloud.google.com/cloud-build/docs/build-config#volumes" rel="noopener ugc nofollow" target="_blank">定义自己的卷</a>，但是出于这个目的，使用Cloud Build自动为您提供的卷<code class="du je jf jg jh b"><strong class="ih hj">/workspace</strong></code>是最简单的。任何步骤写入该路径的任何内容都可以用于后面的步骤。</p><p id="70bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提示:你可以在没有任何其他来源的情况下尝试这些片段；将内容保存到文件中，然后运行 <code class="du je jf jg jh b"><em class="jd">gcloud builds submit --config=&lt;filename&gt; --no-source</em></code></p><figure class="jj jk jl jm fd jn"><div class="bz dy l di"><div class="lc ld l"/></div></figure><h1 id="3ee4" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">但是如果我有很多值要传递呢？那会变得非常乏味。</h1><p id="f005" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">是的，当然可以。这里有一个简化的方法:用一个公共前缀来命名你想要持久化的任何变量。然后，您可以在一行脚本中编写它们，然后在一行中读取它们:</p><figure class="jj jk jl jm fd jn"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="2aad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在其他情况下，您可能会发现使用结构化数据格式更有效:假设您从一个返回JSON的API中读取数据。将输出作为文件写入<code class="du je jf jg jh b">/workspace</code>，然后在后续步骤中，您可以从该文件中读取项目。(<code class="du je jf jg jh b"><a class="ae jy" href="https://stedolan.github.io/jq/" rel="noopener ugc nofollow" target="_blank">jq</a></code>在这里很可能派上用场！)</p><p id="fe53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于如何充分利用云构建，您还有其他很酷的技巧吗？在评论中分享吧！</p><p id="221e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">感谢Edrienne和Guillermina启发了这项技术</em></p></div></div>    
</body>
</html>