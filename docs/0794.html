<html>
<head>
<title>Using Chrome Dev Tools with Google Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在谷歌云上使用Chrome开发工具</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/using-chrome-dev-tools-with-google-cloud-50c20f230d61?source=collection_archive---------1-----------------------#2018-10-17">https://medium.com/google-cloud/using-chrome-dev-tools-with-google-cloud-50c20f230d61?source=collection_archive---------1-----------------------#2018-10-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="88b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一些谷歌云客户有非常大量的静态内容，他们希望提供给用户。通常，许多视频和图像媒体带有一些文本。他们想要的解决方案是:</p><ol class=""><li id="2a71" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">易于更新内容</li><li id="3eec" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">可靠的</li><li id="e465" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">快的</li><li id="d94c" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">移动友好</li></ol><p id="49e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<a class="ae jr" href="https://cloud.google.com/solutions/web-serving-overview" rel="noopener ugc nofollow" target="_blank">服务网站</a>页面中总结了在谷歌云平台(GCP)上提供网页内容的选项。对于这个用例，Google云存储(GCS)是一个很好的选择。使用<a class="ae jr" href="https://cloud.google.com/storage/docs/gsutil" rel="noopener ugc nofollow" target="_blank"> gsutil </a>命令行实用程序和客户端API很容易更新GCS中的内容。它非常可靠，具有99.95%的SLA<a class="ae jr" href="https://cloud.google.com/storage/sla" rel="noopener ugc nofollow" target="_blank">。通过选择GCS解决了前两个需求后，本文将讨论如何使用Google </a><a class="ae jr" href="https://developers.google.com/web/tools/" rel="noopener ugc nofollow" target="_blank"> Tools for Web，Developers </a>，包括<a class="ae jr" href="https://developers.google.com/web/tools/chrome-devtools/" rel="noopener ugc nofollow" target="_blank"> Chrome DevTools </a>和<a class="ae jr" href="https://developers.google.com/web/tools/lighthouse/" rel="noopener ugc nofollow" target="_blank"> Lighthouse </a>来优化速度和移动友好性。附带的<a class="ae jr" href="https://gist.github.com/alexamies/db324bfdf8a7cd25493bce47be0fdc5d" rel="noopener ugc nofollow" target="_blank">要点</a>提供代码来测试使用GCS的静态网站的服务，添加一个通过HTTPS提供服务的负载平衡器，开发JavaScript以使内容离线可用，并收集用户体验的性能数据。</p><p id="2b91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于一个完整的电子商务网站或社交媒体应用程序，你需要许多其他元素来支持支付、订单履行、账户管理和用户参与分析。为此所需的各种其他云服务将不会在本文中讨论。许多相同的原则适用于托管媒体以支持移动应用程序。</p><h1 id="5cc1" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">在谷歌云存储上建立一个静态网站</h1><p id="db5e" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">首先，让我们来看看如何使用GCS的<a class="ae jr" href="https://cloud.google.com/storage/docs/hosting-static-website" rel="noopener ugc nofollow" target="_blank">托管静态网站</a>的特性在GCP上轻松托管静态内容。您将需要一个域，并使用CNAME记录将它指向云存储。在安装了<a class="ae jr" href="https://cloud.google.com/sdk/gcloud/" rel="noopener ugc nofollow" target="_blank"> gcloud </a>的Linux shell中执行以下命令。</p><p id="240f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查是否将正确的项目设置为默认项目</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="34aa" class="le jt hi la b fi lf lg l lh li">PROJECT=[Your project]<br/>gcloud config set project $PROJECT</span></pre><p id="0778" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要创建匹配域的bucket，您需要执行<a class="ae jr" href="https://cloud.google.com/storage/docs/domain-name-verification" rel="noopener ugc nofollow" target="_blank">域名Bucket验证</a>。完成之后，使用以下命令创建bucket</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="f449" class="le jt hi la b fi lf lg l lh li">BUCKET=[Your domain]<br/>gsutil mb gs://${BUCKET}</span></pre><p id="3e14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">复制网站文件</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="beab" class="le jt hi la b fi lf lg l lh li">gsutil cp *.html gs://${BUCKET}<br/>gsutil cp *.js gs://${BUCKET}</span></pre><p id="697e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将存储桶作为网站启用</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="b868" class="le jt hi la b fi lf lg l lh li">gsutil web set -m index.html -e notfound.html gs://${BUCKET}</span></pre><p id="1714" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">公开<a class="ae jr" href="https://cloud.google.com/storage/docs/access-control/making-data-public#buckets" rel="noopener ugc nofollow" target="_blank"> GCS对象</a>:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="ff67" class="le jt hi la b fi lf lg l lh li">gsutil iam ch allUsers:objectViewer gs://${BUCKET}<br/>gsutil acl ch -u AllUsers:R gs://${BUCKET}</span></pre><p id="7918" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">测试网站</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="0c6c" class="le jt hi la b fi lf lg l lh li">curl <a class="ae jr" rel="noopener ugc nofollow" target="_blank" href="/${BUCKET}/index1.html">http://${BUCKET}/index1.html</a></span></pre><h1 id="4c68" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">用灯塔分析网站</h1><p id="d1d6" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">在Chrome开发者工具中点击审计标签打开<a class="ae jr" href="https://developers.google.com/web/tools/lighthouse/" rel="noopener ugc nofollow" target="_blank">灯塔</a>，然后点击“运行审计”按钮运行分析。截图如下。</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lj"><img src="../Images/2b31b4e5623a55521367fab3d24301c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0uYWR2gUAI-yTqkN"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx translated"><strong class="bd ju">Chrome开发工具中的初始性能计时</strong></figcaption></figure><p id="f3f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了性能测量之外，还有许多其他建议。渐进式网站推荐列表中的前几个如下所示。</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lv"><img src="../Images/a617d8cb0a63c26dc8bf24715850aad3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Tf2SlozE4DB2egPA"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx translated"><strong class="bd ju">Chrome开发工具中的初步分析</strong></figcaption></figure><p id="6b5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列表中的第一项是“脱机时不回复200”您可以通过使用<a class="ae jr" href="https://developers.google.com/web/fundamentals/primers/service-workers/" rel="noopener ugc nofollow" target="_blank">服务工作器</a>在浏览器的<a class="ae jr" href="https://www.html5rocks.com/en/tutorials/appcache/beginner/" rel="noopener ugc nofollow" target="_blank">应用程序缓存</a>中缓存和检索内容，使静态网站能够被离线访问。gist中的index2.html和main2.js文件实现了这一点。然而，服务人员<a class="ae jr" href="https://developers.google.com/web/fundamentals/primers/service-workers/#you_need_https" rel="noopener ugc nofollow" target="_blank">需要HTTPS </a>。此外，这是灯塔审计清单上的第三项:“不使用HTTPS。”所以我们的首要任务是让HTTPS。</p><p id="f911" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了支持移动应用程序，同样的原理也适用，但是不是为服务人员使用JavaScript，而是使用应用程序代码在设备上缓存经常访问的媒体。</p><h1 id="0ba8" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">为静态网站启用HTTPS</h1><p id="2cad" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">您可以在GCS存储桶前面添加一个L7负载平衡器，以提供HTTPS。这在页面<a class="ae jr" href="https://cloud.google.com/load-balancing/docs/https/content-based-example" rel="noopener ugc nofollow" target="_blank">创建基于内容的负载平衡</a>中有所描述。当我说HTTPS时，我指的是更快的<a class="ae jr" href="https://en.wikipedia.org/wiki/QUIC" rel="noopener ugc nofollow" target="_blank"> QUIC </a>。如果设置一个负载均衡器对你的用例来说似乎有点大材小用，那么你应该探索App Engine或<a class="ae jr" href="https://firebase.google.com/docs/hosting/" rel="noopener ugc nofollow" target="_blank"> Firebase hosting </a>作为用HTTPS托管应用的替代方法。</p><h1 id="86a3" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">添加L7负载平衡器</h1><p id="4a2d" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">创建全局静态IP地址:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="fbcd" class="le jt hi la b fi lf lg l lh li">IP_NAME=lb-ip<br/>gcloud compute addresses create $IP_NAME \<br/> --ip-version=IPV4 \<br/> --global</span></pre><p id="4b53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，使用将一个<a class="ae jr" href="https://cloud.google.com/load-balancing/docs/https/adding-a-backend-bucket-to-content-based-load-balancing" rel="noopener ugc nofollow" target="_blank">云存储桶后端</a>添加到负载平衡器</p><p id="ce50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jr" href="https://cloud.google.com/sdk/gcloud/reference/compute/backend-buckets/create" rel="noopener ugc nofollow" target="_blank"> gcloud计算后端-存储桶创建</a>命令:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="4de3" class="le jt hi la b fi lf lg l lh li">BACKEND_BUCKET_NAME=static-bucket<br/>gcloud compute backend-buckets create $BACKEND_BUCKET_NAME \<br/> --gcs-bucket-name $BUCKET</span></pre><p id="f926" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<a class="ae jr" href="https://cloud.google.com/sdk/gcloud/reference/compute/url-maps/create" rel="noopener ugc nofollow" target="_blank">g cloud compute URL-maps create</a>命令为基于内容的负载平衡创建URL映射:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="888d" class="le jt hi la b fi lf lg l lh li">URL_MAP_NAME=web-map<br/>gcloud compute url-maps create $URL_MAP_NAME \<br/> --default-backend-bucket=$BACKEND_BUCKET_NAME</span></pre><p id="cb00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<a class="ae jr" href="https://cloud.google.com/sdk/gcloud/reference/compute/url-maps/add-path-matcher" rel="noopener ugc nofollow" target="_blank">g cloud compute URL-maps add-path-matcher</a>命令添加路径匹配器:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="384b" class="le jt hi la b fi lf lg l lh li">PATH_MATCHER_NAME=bucket-matcher<br/>gcloud compute url-maps add-path-matcher $URL_MAP_NAME \<br/> --default-backend-bucket=$BACKEND_BUCKET_NAME \<br/> --path-matcher-name $PATH_MATCHER_NAME \</span></pre><p id="03ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<a class="ae jr" href="https://cloud.google.com/sdk/gcloud/reference/beta/compute/ssl-certificates/create" rel="noopener ugc nofollow" target="_blank">g cloud beta compute SSL-certificates create</a>命令创建一个Google托管的TLS证书:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="82d8" class="le jt hi la b fi lf lg l lh li">CERT_NAME=${PROJECT}-cert<br/>DOMAIN=[Your domain]<br/>gcloud beta compute ssl-certificates create $CERT_NAME \<br/> --domains $DOMAIN</span></pre><p id="8ddc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<a class="ae jr" href="https://cloud.google.com/sdk/gcloud/reference/compute/target-https-proxies/create" rel="noopener ugc nofollow" target="_blank">g cloud compute target-https-proxy create</a>命令创建一个目标代理</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="f0e6" class="le jt hi la b fi lf lg l lh li">PROXY_NAME=https-lb-proxy<br/>gcloud compute target-https-proxies create $PROXY_NAME \<br/> --url-map $URL_MAP_NAME — ssl-certificates $CERT_NAME</span></pre><p id="772b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为代理启用QUIC</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="fc63" class="le jt hi la b fi lf lg l lh li">gcloud compute target-https-proxies update $PROXY_NAME \<br/> --quic-override=ENABLE</span></pre><p id="1a2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<a class="ae jr" href="https://cloud.google.com/sdk/gcloud/reference/compute/forwarding-rules/create" rel="noopener ugc nofollow" target="_blank">g cloud compute forwarding-rules create</a>命令创建转发规则:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="0844" class="le jt hi la b fi lf lg l lh li">FWD_NAME=https-content-rule<br/>gcloud compute forwarding-rules create $FWD_NAME \<br/> --address $IP_NAME \<br/> --global \<br/> --target-https-proxy $PROXY_NAME \<br/> --ports 443</span></pre><p id="74bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">既然您正在为站点使用负载平衡器，请将DNS记录更改为A记录，该记录引用负载平衡器使用的静态IP地址。您可能需要等待一段时间才能生效，这取决于您的DNS TTL。</p><p id="cfe7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">向负载平衡器发送流量</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="70ef" class="le jt hi la b fi lf lg l lh li">curl <a class="ae jr" rel="noopener ugc nofollow" target="_blank" href="/$DOMAIN/index1.html">https://$DOMAIN/index2.html</a></span></pre><p id="7017" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">IPv6:对于一个健壮的网站，添加IPv6支持，如<a class="ae jr" href="https://cloud.google.com/load-balancing/docs/https/content-based-example" rel="noopener ugc nofollow" target="_blank">创建基于内容的负载平衡</a>中所述。</p><p id="88c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Chrome开发工具中再次运行分析。你应该会发现№1(没有200离线)和№3(没有HTTPS)问题现在已经不在渐进式Web App问题列表中了。渐进式web应用程序审核如下图所示。</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lw"><img src="../Images/6c4c3d1135459b8bceb63d9e0ba760fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-kU2LZ0qWdr4hvJ4"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx translated"><strong class="bd ju">Chrome开发工具中的更新分析</strong></figcaption></figure><p id="f259" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在最大的问题是“不会提示用户安装网络应用”这可以通过提供<a class="ae jr" href="https://developers.google.com/web/fundamentals/web-app-manifest/" rel="noopener ugc nofollow" target="_blank"> web应用清单</a>和<a class="ae jr" href="https://developers.google.com/web/tools/lighthouse/audits/install-prompt" rel="noopener ugc nofollow" target="_blank">中描述的一些其他Web资源来解决，用户可以被提示安装Web应用</a>。其他可能的问题在<a class="ae jr" href="https://developers.google.com/web/tools/lighthouse/" rel="noopener ugc nofollow" target="_blank"> Lighthouse </a>参考指南中描述。</p><h1 id="42f9" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">网路性能</h1><p id="f7c5" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">到目前为止，我们的网络性能看起来相当不错。这是因为我们的应用程序中没有大文件。HTML和JavaScript文件既少又小。然而，随着代码库的增长，应用程序通常会带来性能问题，并且随着业务的增长会收集更多的资产。<a class="ae jr" href="https://developers.google.com/web/tools/lighthouse/audits/text-compression" rel="noopener ugc nofollow" target="_blank"> Lighthouse </a>参考有一个改进性能的建议列表，它与Chrome开发工具中报告的测量相关。</p><p id="b233" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">建议改进的一个常见例子是<a class="ae jr" href="https://developers.google.com/web/tools/lighthouse/audits/text-compression" rel="noopener ugc nofollow" target="_blank">启用文本压缩</a>。文件可以压缩，然后保存到GCS。您需要设置适当的GCS元数据，让浏览器知道要解压缩它。详见<a class="ae jr" href="https://cloud.google.com/storage/docs/transcoding" rel="noopener ugc nofollow" target="_blank">gzip压缩文件的转码</a>。参见<a class="ae jr" rel="noopener" href="/google-cloud/compression-of-data-over-http-on-google-cloud-9833d183b2ba">Google Cloud上的HTTP数据压缩</a>了解提供压缩动态页面的详细信息，以及使用Brotli实现比gzip更高的压缩。</p><p id="3404" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Chrome Dev Tools中的网络选项卡包含检索不同资源的指标。下面的屏幕截图显示了一个没有服务人员的页面版本的示例，以避免本地缓存。</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lx"><img src="../Images/41a08e90102d902c4bc35e72e9602651.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5kif5ga7yZn4rMBL"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx translated"><strong class="bd ju">Chrome开发工具中的网络标签</strong></figcaption></figure><p id="4af4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">显示的指标在<a class="ae jr" href="https://developers.google.com/web/tools/chrome-devtools/network-performance/reference#timing-explanation" rel="noopener ugc nofollow" target="_blank">网络分析参考</a>中有解释。</p><p id="8458" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如<a class="ae jr" href="https://developers.google.com/web/fundamentals/performance/navigation-and-resource-timing/" rel="noopener ugc nofollow" target="_blank">评估现实生活中导航和资源计时的加载性能</a>中所述，从您自己的浏览器加载的这些值应被视为<a class="ae jr" href="https://developers.google.com/web/fundamentals/performance/speed-tools/#lab_data" rel="noopener ugc nofollow" target="_blank">实验室数据</a>。这些数据有助于开发您的应用程序，但并不代表真实世界的用户，他们可能远离数据中心，在慢速移动网络上使用功能较弱的设备。要收集真实用户体验的计时数据，您需要对您的网页(或移动应用程序)进行检测。</p><p id="c4fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用<a class="ae jr" href="https://www.w3.org/TR/navigation-timing-2/" rel="noopener ugc nofollow" target="_blank">导航计时API </a>用JavaScript在浏览器中收集计时数据。举个例子，</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="7fea" class="le jt hi la b fi lf lg l lh li">let pageNav = performance.getEntriesByType(“navigation”)[0];<br/>let dnsTime = pageNav.domainLookupEnd — pageNav.domainLookupStart;<br/>let connectTime = pageNav.connectEnd — pageNav.connectStart;<br/>let ttfb = pageNav.responseStart — pageNav.requestStart;<br/>let dt = pageNav.responseEnd — pageNav.responseStart;</span></pre><p id="1973" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">gist中的JavaScript文件main.js演示了这一点，它是从index.html加载的。从浏览器中，您可以将数据发送回您的服务器进行存储。到目前为止，这个示例是一个托管在GCS上的静态站点，但是您需要一个动态处理程序来接收和保存数据。您可以通过在负载均衡器后面添加GCE实例或云端点或Google Kubernetes引擎集群来实现这一点。这方面的粗略图表如下所示。</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es ly"><img src="../Images/7bed601efcf1cb33a116a9007a0cda14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jPG8xQs_xmhGYbwdae9HdA.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx translated"><strong class="bd ju">收集和保存客户端性能数据的架构</strong></figcaption></figure><p id="dc31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">概念流程是</p><ol class=""><li id="6e91" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">浏览器将时间测量值发送回服务器，比如在JSON at /analytics中</li><li id="b0c2" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">使用基于内容的负载平衡，负载平衡器将请求定向到由GKE管理的托管实例组</li><li id="6949" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">分析数据被转储到日志中</li><li id="c78d" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">云日志<a class="ae jr" href="https://cloud.google.com/logging/docs/export/configure_export_v2#errors_exporting_to_bigquery" rel="noopener ugc nofollow" target="_blank">日志导出</a>用于将数据存储到BigQuery。</li></ol><p id="426c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个流程还有其他的变体，可能同样适合你。有关资源计时的更多信息，请参见页面<a class="ae jr" href="https://nicj.net/resourcetiming-in-practice/" rel="noopener ugc nofollow" target="_blank">资源计时实践</a>。如果保存客户端性能分析对您来说似乎工作量太大，那么您可以考虑像<a class="ae jr" href="https://newrelic.com/solutions/topic/digital-customer-experience" rel="noopener ugc nofollow" target="_blank"> New Relic </a>这样的托管服务。</p></div></div>    
</body>
</html>