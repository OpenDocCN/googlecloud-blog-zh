<html>
<head>
<title>Deploying a Node.js App with Google Cloud’s App Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用谷歌云的应用引擎部署Node.js应用</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/deploying-a-node-js-app-on-google-cloud-8419de45e5dc?source=collection_archive---------0-----------------------#2017-03-30">https://medium.com/google-cloud/deploying-a-node-js-app-on-google-cloud-8419de45e5dc?source=collection_archive---------0-----------------------#2017-03-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/0f6419b12590680aa29ea332ad36be55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eSQnSxgOwNWtjsnbBl3w4A.png"/></div></figure><p id="4da8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对于那些寻找部署应用的方法的人来说，谷歌云平台(GCP)可能不是他们想到的第一选择。Heroku简单易用，而亚马逊的AWS是目前业内最受欢迎的平台。然而，GCP提供了一些值得探索的独特工具(除了免费等级之外，<a class="ae jk" href="https://cloud.google.com/free/" rel="noopener ugc nofollow" target="_blank">还提供300美元的试用积分)。</a></p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><h1 id="1a7c" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">介绍</h1><p id="63f1" class="pw-post-body-paragraph im in hi io b ip kq ir is it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj hb bi translated">为软件公司的产品提供较低的准入门槛最符合它们的利益；某人越容易开始，用户就能越快地探索大门之外的东西。提供清晰易读的文档将大大降低这些障碍。Google为他们的几个API提供了优秀的文档——然而，云部门可能有点缺乏清晰度。</p><p id="84c1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在GCP上部署我的第一个Node.js应用程序遇到了很大的挫折。部分原因是我的错:我选择了使用许多尚未完全开发的工具。当它们充分工作时，它们将是生态系统中令人敬畏的新成员。现在，人们必须意识到潜在的陷阱，其中一些我将在下面介绍。</p><p id="c117" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">吸引我去GCP的是Heroku的易部署性(直接来自Github，不需要CLI，即使提供了CLI)和AWS的强大功能相结合的潜力。(哦还有，我用了谷歌预测API，它需要谷歌云SDK。)</p><p id="b97d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">GCP使得完全在浏览器中运行云外壳CLI界面、编辑文件和部署具有应用程序引擎的应用程序成为可能——这些功能使人们更容易探索GCP，而无需太多投资和我们的探索主题。</p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><h1 id="be48" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">入门指南</h1><p id="692a" class="pw-post-body-paragraph im in hi io b ip kq ir is it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj hb bi translated">继续，登录<a class="ae jk" href="http://cloud.google.com" rel="noopener ugc nofollow" target="_blank"> GCP控制台</a>，创建一个新项目！</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es kv"><img src="../Images/dc9aa120c1ff8b9b74553a364d8fe572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*d2M_HfOrXqv7xFFiFNtGKg.jpeg"/></div><figcaption class="la lb et er es lc ld bd b be z dx translated">新项目的时间到了！</figcaption></figure><p id="380c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在横跨页面的导航栏右侧，您会发现一个启动云外壳的图标。这将为您提供一个运行Linux的云引擎虚拟机，并配备了大量的正常功能(git、npm和对Node.js的支持)和一些我们必须本地安装的功能(Google App Engine SDK、Google Cloud SDK)。提供的工具的完整列表可以在<a class="ae jk" href="https://cloud.google.com/shell/docs/features#web_preview" rel="noopener ugc nofollow" target="_blank">这里</a>找到。第一次出现时，外壳会出现在屏幕的底部，但是有一个选项可以将它弹出到自己的窗口中。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es le"><img src="../Images/ceddb999d64e27fa30c045555af7ac1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PwN-mdFmwfvypi5r5wWQgQ.jpeg"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">首次启动时的云壳</figcaption></figure><p id="c271" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请记住，这个虚拟机是你的谷歌帐户唯一的，而不是你的项目。如果你下载了一个项目的回购，重新访问另一个项目的云壳，你会看到你以前的回购。<strong class="io hj">这个计算引擎实例也是<em class="lj">不同的，并且与将托管您部署的应用的应用引擎实例</em>分开。</strong></p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><h1 id="70e3" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">准备部署</h1><p id="f140" class="pw-post-body-paragraph im in hi io b ip kq ir is it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj hb bi translated">继续将您的回购克隆到虚拟机中。这是您在部署前确保一切就绪的机会！如果您忘记了下面的任何内容，请随时从云壳工具栏启动谷歌的实验性在线文件编辑器(就我个人而言，我不是VIM之类的超级粉丝)。</p><p id="e9a9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你需要什么:</p><ol class=""><li id="24e5" class="lk ll hi io b ip iq it iu ix lm jb ln jf lo jj lp lq lr ls bi translated">一个<em class="lj"> app.yaml </em>文件。至少，它应该类似于下面的示例。这让App Engine知道你想要什么配置。使用flex环境允许App Engine控制部署的几个方面，例如自动伸缩。如果您有任何<em class="lj"> process.env </em>变量，这就是应该指定它们的地方。要获得该文件可以包含的内容的完整列表，请阅读<a class="ae jk" href="https://cloud.google.com/appengine/docs/flexible/nodejs/configuring-your-app-with-app-yaml" rel="noopener ugc nofollow" target="_blank">这里的</a>。</li></ol><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="b8a2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">2.确保您的<em class="lj"> package.json </em>包含一个“开始”脚本。在您的VM设置了您的应用引擎实例(例如，安装您可能需要的任何节点模块)之后，它将运行这个脚本。不要忘记用类似于<em class="lj"> node server.js </em>的东西来启动你的服务器。</p><p id="7104" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">3.<em class="lj">(可选)</em>如果您选择在开发中的端口8080(或8081–8084)上启动您的服务器，您可以从云Shell获得快速预览。运行启动脚本并单击工具栏中的第一个图标，在新窗口中打开预览。</p><p id="c212" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里需要注意的是:预览版无法连接到GCP或其他地方的任何数据库。因为我所有的内容都在登录屏幕后面，所以每当我试图登录或创建新帐户时，预览总是抛出一个错误，这并没有特别的帮助。如果本地没有错误，它应该(有希望)在部署中工作。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es lv"><img src="../Images/490274546d5fb13aee2ff75d92e51755.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*JENtApiHJAYtfhescD-RCA.png"/></div><figcaption class="la lb et er es lc ld bd b be z dx translated">启动Web预览</figcaption></figure><p id="a101" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">4.如果您选择使用文件编辑器进行任何更改，我建议您遵循这个步骤。转到GCP控制台内的汉堡菜单，向下滚动到工具子部分，将鼠标悬停在开发上，然后单击存储库。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div class="er es lw"><img src="../Images/c04547ee725bd61d5df92d4bc2105871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*hL_CdExrzKjpMIUms97YvA.png"/></div></figure><p id="ebf2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">存储库列表最初将为空，源代码选项只有在应用程序部署后才可用。最后,“源代码”选项卡将显示当前部署在App Engine上的代码。</p><p id="292d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，让我们创建一个新的存储库，并将其命名为“<em class="lj"> default </em>”。这将是应用程序将从其中部署的回购。因为它是空的，所以我们可以在添加了作为远程的<em class="lj">默认</em> repo之后，从云Shell VM推送我们的最终代码。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es lx"><img src="../Images/7a646a388e5dcc615fb70fe9c5b9195b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rfjpoh2K35hDS9-zNzjqjg.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">如果您使用的是Cloud Shell，则步骤1和2已经完成</figcaption></figure></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><h1 id="28d0" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">部署乐趣！</h1><p id="a83b" class="pw-post-body-paragraph im in hi io b ip kq ir is it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj hb bi translated">现在我们已经准备好部署我们的应用程序了！继续运行repo文件夹中的神奇命令:<em class="lj"> gcloud app deploy。</em>你将被引导通过一系列提示。首先，一个位置:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es ly"><img src="../Images/59ac80a952e4dd8b7d57fd4036623944.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L7Fy5c8g23v2JZaivOSTWw.png"/></div></div></figure><p id="4b99" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，确认:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es lz"><img src="../Images/aaac3ea7762041c0cf161bd40f503dba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZkyJUpu4USR2DlPI5XhUWA.png"/></div></div></figure><p id="2fd2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">构建日志开始成形:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es ma"><img src="../Images/4ecf21827749fd9a72acfb00fd63f5e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_O19bW9vJsdeW9FfBkAxBA.png"/></div></div></figure><p id="406c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果一切顺利，几分钟后将显示以下消息:</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es mb"><img src="../Images/9adf1505c7ad69df002f83a2e55387a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dskFLq5BjJKKsKImjJssYA.png"/></div></div></figure><p id="b95b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你可以通过运行<em class="lj"> gcloud app浏览</em>或者进入<a class="ae jk" href="https://[PROJECT-ID].appspot.com" rel="noopener ugc nofollow" target="_blank"><em class="lj">https://</em>【PROJECT-ID】<em class="lj">. app spot . com</em></a>(如果你还没改的话)来访问你的app。</p></div></div>    
</body>
</html>