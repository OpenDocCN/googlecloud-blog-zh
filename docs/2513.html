<html>
<head>
<title>GCP — BigQuery — Data Security at rest (Part 5)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GCP — BigQuery —静态数据安全(第5部分)</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/gcp-bigquery-data-security-at-rest-part-5-965caba934ea?source=collection_archive---------8-----------------------#2022-11-15">https://medium.com/google-cloud/gcp-bigquery-data-security-at-rest-part-5-965caba934ea?source=collection_archive---------8-----------------------#2022-11-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="6837" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">这是博客的最后一部分，在这里我们将讨论行级访问策略，根据策略，该策略将被查询的行的访问限制为主体</p><p id="7ffc" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">这篇博客是“Bigquery —静态数据安全”5部分系列文章的一部分。<br/>点击此处查看<a class="ae jh" rel="noopener" href="/google-cloud/gcp-bigquery-data-security-at-rest-part-4-c6f4db9a0f13">系列第四部</a> <br/>点击此处查看<a class="ae jh" rel="noopener" href="/google-cloud/gcp-bigquery-data-security-at-rest-series-menu-1e59e1793deb">系列菜单</a></p></blockquote><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es ji"><img src="../Images/34cfaa93c06bdc8958cdbb3eff79f503.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BHbXZ4n0NLf9EF_cGpYppA.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">Bigquery安全控件。</figcaption></figure><h2 id="ff8e" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">行级访问策略</h2><p id="60be" class="pw-post-body-paragraph ii ij hi il b im kw io ip iq kx is it kj ky iw ix kn kz ja jb kr la je jf jg hb bi translated">行级访问策略扩展了Bigquery的功能，允许基于过滤标准进行安全控制。该控件可以与Bigquery列安全控件和应用的IAM策略一起使用。</p><p id="29d4" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kj iv iw ix kn iz ja jb kr jd je jf jg hb bi translated">让我们考虑我们在上一篇博客中用来解释带有策略标记的列级安全性的同一个表。</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es lb"><img src="../Images/e13da25bada52fd1c0e71a16f44f975a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aNTbgsao9qWaWPzuOyR_sg.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">客户表</figcaption></figure><p id="9f15" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kj iv iw ix kn iz ja jb kr jd je jf jg hb bi translated">我们在<strong class="il hj"> company </strong>上添加了另一个列策略标签，允许委托人查看company中被屏蔽的值</p><p id="b6c9" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kj iv iw ix kn iz ja jb kr jd je jf jg hb bi translated">目前，用户只能查询以下各列并检查数据</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es lc"><img src="../Images/98d0b84d99ff303876b0fba60be415c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ohFZuUTiFY_HRR4ykEBaMA.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">对主体屏蔽数据</figcaption></figure><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es ld"><img src="../Images/da83fe6090c04c3f849e53fa47a93319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vksiH_7d7lBU1vk0E5l0dA.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">实际数据</figcaption></figure><p id="a144" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kj iv iw ix kn iz ja jb kr jd je jf jg hb bi translated">我们将创建行访问策略，仅允许委托人查看来自“<strong class="il hj"> Ozu </strong>”公司的数据。</p><pre class="jj jk jl jm fd le lf lg bn lh li bi"><span id="505e" class="lj jz hi lf b be lk ll l lm ln">CREATE ROW ACCESS POLICY ozu_filter<br/>ON `&lt;redacted&gt;.data_security_demo_raw.customers_raw`<br/>GRANT TO ('user:training-user-1@&lt;redacted&gt;')<br/>FILTER USING (company = 'Ozu');</span></pre><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es lo"><img src="../Images/ae1f84501dad189514d3316101c25c83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ws52ywqd88v08171Xz7drw.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">已应用行级筛选器</figcaption></figure><p id="18a1" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kj iv iw ix kn iz ja jb kr jd je jf jg hb bi translated">上面的结果显示了对列应用的行访问策略，随后是对company应用的列级哈希安全性。</p><blockquote class="if ig ih"><p id="130d" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">目的是展示行级访问策略和列级策略可以一起应用。</p></blockquote></div><div class="ab cl lp lq gp lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hb hc hd he hf"><p id="4f17" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kj iv iw ix kn iz ja jb kr jd je jf jg hb bi translated">让我们看一个不同的案例来理解<strong class="il hj">有效政策</strong>的应用。</p><p id="c063" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kj iv iw ix kn iz ja jb kr jd je jf jg hb bi translated">让我们创建另一个行过滤器，允许访问性别为“男性”的记录</p><pre class="jj jk jl jm fd le lf lg bn lh li bi"><span id="b1a1" class="lj jz hi lf b be lk ll l lm ln">CREATE OR REPLACE ROW ACCESS POLICY gender_filter<br/>ON `&lt;redacted&gt;.customers_raw`<br/>GRANT TO ('user:training-user-1@&lt;redacted&gt;')<br/>FILTER USING (gender = 'Male');</span></pre><p id="d8bd" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kj iv iw ix kn iz ja jb kr jd je jf jg hb bi translated">此外，让我们暂时删除company上的哈希规则来检查结果。</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es lw"><img src="../Images/4d6e1656559f85a7af2f2c08488e61e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sfLF7pJosO8sOhpCWOqs-w.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">查询结果</figcaption></figure><p id="e1a8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kj iv iw ix kn iz ja jb kr jd je jf jg hb bi translated">这让我可以根据第一行过滤器查看不属于Ozu的公司。</p><blockquote class="if ig ih"><p id="beb0" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">重要说明1 —这里没有任何破坏，想法是行过滤器遵循来自两个过滤器的允许结果的联合并提供结果。<br/>因此，如果您想要限制多个条件，请使用“与”条件将它们组合成单行策略的一部分。</p><p id="0638" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">重要说明2 —任何具有行访问策略的表都会自动拒绝其他所有表的访问。因此，有必要使用explicit =True过滤器来允许其他人不受限制地访问。这也适用于对整个表执行任何DML操作。</p><p id="8f91" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">重要说明3 — JSON列不支持行访问策略</p><p id="985b" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">重要说明4 — BI引擎加速不适用于具有多行访问策略的表</p></blockquote></div><div class="ab cl lp lq gp lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hb hc hd he hf"><p id="c30a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kj iv iw ix kn iz ja jb kr jd je jf jg hb bi translated">希望本系列有助于深入了解静态Bigquery安全机制。</p><p id="52c6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kj iv iw ix kn iz ja jb kr jd je jf jg hb bi translated">如有任何疑问，请通过https://www.linkedin.com/in/murli-krishnan-a1319842/与我联系。</p><p id="af79" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it kj iv iw ix kn iz ja jb kr jd je jf jg hb bi translated">快乐学习。</p></div><div class="ab cl lp lq gp lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hb hc hd he hf"><h2 id="1270" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">参考</h2><p id="23c8" class="pw-post-body-paragraph ii ij hi il b im kw io ip iq kx is it kj ky iw ix kn kz ja jb kr la je jf jg hb bi translated"><a class="ae jh" href="https://cloud.google.com/bigquery/docs/row-level-security-intro#comparison_of_authorized_views_row-level_security_and_separate_tables" rel="noopener ugc nofollow" target="_blank">行级访问和授权视图的比较<br/> </a> <a class="ae jh" href="https://cloud.google.com/bigquery/docs/row-level-security-intro#performance_limitations" rel="noopener ugc nofollow" target="_blank">性能影响</a> <br/> <a class="ae jh" href="https://cloud.google.com/bigquery/docs/using-row-level-security-with-features" rel="noopener ugc nofollow" target="_blank">使用具有BQ特性的行级访问策略</a> <br/> <a class="ae jh" href="https://cloud.google.com/bigquery/docs/best-practices-row-level-security" rel="noopener ugc nofollow" target="_blank">行级安全性最佳实践</a></p></div></div>    
</body>
</html>