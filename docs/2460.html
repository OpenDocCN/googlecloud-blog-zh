<html>
<head>
<title>Scale GKE with Cloud function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带云功能的秤GKE</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/scale-gke-with-cloud-function-d76f20f9416e?source=collection_archive---------0-----------------------#2022-10-29">https://medium.com/google-cloud/scale-gke-with-cloud-function-d76f20f9416e?source=collection_archive---------0-----------------------#2022-10-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2588" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在运行Kubernetes集群时，根据需求动态扩展集群至关重要。有时也可能是Kubernetes集群的计划扩大或缩小。</p><p id="9864" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将看一个GCP GKE的例子，在这个例子中，您可能需要定期将开发GKE集群缩减到零，以便节省成本。我们可以使用云功能扩大和缩小GKE集群。</p><p id="87f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以在选项1–2(使用发布/订阅和云功能)和选项2(仅创建云HTTP功能，不使用发布/订阅)之间进行选择。</p><p id="f1ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是Github的代码链接:<a class="ae jd" href="https://github.com/harsh4870/cloud-function-scale-gke" rel="noopener ugc nofollow" target="_blank">https://github.com/harsh4870/cloud-function-scale-gke</a></p><h2 id="f2fa" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated"><strong class="ak">方法一</strong> — <strong class="ak">发布/订阅&amp;云功能</strong></h2><p id="a258" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">创建云函数，进入<strong class="ih hj">云函数</strong>页面。<a class="ae jd" href="https://console.cloud.google.com/functions" rel="noopener ugc nofollow" target="_blank">转到云功能</a></p><figure class="ke kf kg kh fd ki"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="3e6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<strong class="ih hj">创建功能</strong>。</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kl"><img src="../Images/4b18493a5ba6b8f9255b6a6277c0709d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*vqRRYauxmbYCkwzD8tuLVw.png"/></div></div></figure><p id="9e50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">给你的函数一个名字。接受默认的内存分配。</p><p id="db4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj">触发器</strong>列表中，选择<strong class="ih hj">云发布/订阅</strong>。</p><p id="36c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用菜单选择现有主题，或使用弹出菜单创建新主题。该主题现已被您的函数订阅。你需要记住主题的名字，所以把它写下来。</p><p id="a063" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从Github和package.json更新复制/粘贴代码。</p><p id="f3e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，当您向发布/订阅服务器发送消息时，有效负载将启动一个云功能和进程，GKE节点池将根据有效负载扩大或缩小。</p><p id="f5a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">发布/订阅的有效负载</p><pre class="ke kf kg kh fd ks kt ku kv aw kw bi"><span id="b111" class="je jf hi kt b fi kx ky l kz la">{  <br/>   "projectId": "auto-x",  <br/>   "zone": "us-central1-c",  <br/>   "cluster_id": "cluster-1",  <br/>   "node_pool_id": "test-pool",  <br/>   "node_count": 1<br/>}</span></pre><h2 id="b5c3" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">方法2— HTTP云功能</h2><p id="ca21" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">在方法2中，想法是将<strong class="ih hj"> HTTP </strong>云函数<strong class="ih hj"> POST </strong>请求与<strong class="ih hj"> JSON </strong>有效载荷放在正文中，基于params云函数将处理和缩放GKE节点池。</p><p id="b7bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建云函数，进入<strong class="ih hj">云函数</strong>页面。<a class="ae jd" href="https://console.cloud.google.com/functions" rel="noopener ugc nofollow" target="_blank">转到云功能</a></p><figure class="ke kf kg kh fd ki"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="b4be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Trigger中选择<strong class="ih hj"> HTTP，</strong>如果你想要验证你可以使用。保留云功能而不授权是很危险的。</p><p id="a18e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从Github和package.json更新复制/粘贴代码</p><p id="13f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你点击带有有效载荷的云函数的HTTP URL时，它将处理有效载荷并改变GKE集群的大小。</p><p id="618e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">额外—定期或每日更新</strong></p><p id="0296" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要在特定时间每天缩小或扩大GKE集群，您可以利用<strong class="ih hj">云调度器作业</strong>。</p><p id="9dcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您需要在夜间缩减开发GKE集群，并在办公时间之前将其扩大，那么daily Cloud scheduler是使用云功能的最佳选择。这将大大降低你的成本。</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lb"><img src="../Images/57d90c8347549fe654b94d1adc4d0f67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kcsoe7hqx_wwYtG745-SrQ.png"/></div></div></figure><p id="93e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在谷歌云控制台中，转到<strong class="ih hj">云调度器</strong>页面。</p><p id="8b7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<strong class="ih hj">创建作业</strong>和<strong class="ih hj">T5，选择作业运行的区域。</strong></p><p id="2076" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加Cron作业的名称和描述。为您的工作指定<strong class="ih hj">频率</strong>。</p><pre class="ke kf kg kh fd ks kt ku kv aw kw bi"><span id="29af" class="je jf hi kt b fi kx ky l kz la">25 16 * * 8</span></pre><p id="f0a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，选择调度程序要遵循的时区。选择可以使用调度程序向发布/订阅主题发送消息的目标。</p><p id="4029" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在您有了一个cron作业，它根据配置发布到您的发布/订阅主题。该主题由您的云功能订阅。</p></div></div>    
</body>
</html>