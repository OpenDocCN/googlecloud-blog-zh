<html>
<head>
<title>Stream your data: On-Prem MS-SQL to CloudSQL SQL Server to BigQuery (Part-1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">流式传输您的数据:从本地MS-SQL到云SQL SQL Server到BigQuery(第1部分)</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/stream-your-data-on-prem-ms-sql-to-cloudsql-sql-server-to-bigquery-part-1-14a920dbab48?source=collection_archive---------1-----------------------#2021-06-08">https://medium.com/google-cloud/stream-your-data-on-prem-ms-sql-to-cloudsql-sql-server-to-bigquery-part-1-14a920dbab48?source=collection_archive---------1-----------------------#2021-06-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e79d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第1部分:</strong>从本地MS-SQL到CloudSQL SQL Server的在线复制</p><h1 id="7087" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">为什么需要？</h1><p id="9957" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">企业关系数据库的传统版本一直是我们应用程序堆栈不可或缺的一部分，但随着组织向数字时代过渡，他们开始意识到未开发数据的价值以及他们错过的大量机会。因此，大多数组织现在都在寻找有效的方法，利用批处理或流管道将其数据源与下一代云原生数据仓库平台集成。</p><blockquote class="kg kh ki"><p id="9d9c" class="if ig kj ih b ii ij ik il im in io ip kk ir is it kl iv iw ix km iz ja jb jc hb bi translated">根据<a class="ae kn" href="https://hbr.org/2017/05/whats-your-data-strategy" rel="noopener ugc nofollow" target="_blank">哈佛商业评论</a>，跨行业的研究表明，平均来说，一个组织的结构化数据只有不到50%被积极地用于决策。</p></blockquote><p id="8c59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇由多个部分组成的博客中，我将带您经历一个从遗留SQL Server到BigQuery构建数据管道的端到端场景。</p><p id="edfe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi ko translated"><span class="l kp kq kr bm ks kt ku kv kw di"> S </span></p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es kx"><img src="../Images/06058ea5a5dffdfa4205831e86c980cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dDFohBjLAAx0Dg7gkZHcjA.jpeg"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">由Unsplash网站上的seli̇m·阿尔达·埃里希马兹</figcaption></figure><p id="dbe9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi ko translated"><span class="l kp kq kr bm ks kt ku kv kw di">C</span>T12】挑战: SQL Server 2014标准版默认情况下不支持CDC，因此，客户需要升级到2016标准版或SQL Server 2014企业版。后一种方法不可行，因为客户对成本非常敏感，前一种方法需要1到2个月的时间来全面测试其应用，并且由于缺乏及时的分析，这可能会导致潜在机会的损失。</p><p id="117c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi ko translated"><span class="l kp kq kr bm ks kt ku kv kw di"> M </span></p><p id="4e02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi ko translated"><span class="l kp kq kr bm ks kt ku kv kw di"> I </span> <strong class="ih hj">实施计划:</strong> Microsoft SQL Server提供了SQL Server实例之间的多种复制选项，供分布式应用程序使用。对于这个场景，我们将实现<a class="ae kn" href="https://docs.microsoft.com/en-us/sql/relational-databases/replication/transactional/transactional-replication?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank">事务复制</a>，这使得源数据库成为发布者，并且所有配置的对象&amp;数据被近乎实时地应用到订阅者(目标)数据库。数据更改应用于订阅服务器的顺序与发布服务器相同，并且在相同的事务边界内。</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es ln"><img src="../Images/ca1aaf3019c6c22af51edc886e9c699d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IvO19BIiXH_AUJOmWeRFzA.png"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">到CloudSQL SQL Server的事务复制，作者<em class="lo">作者</em></figcaption></figure><p id="bccc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了演示，我在SQL Server 2014 Std中创建了一个名为<em class="kj">“demo”</em>的数据库。版本，并提供了一个标准版Google CloudSQL SQL Server 2017，数据库名为<em class="kj">“csqlawsub”</em>。</p><p id="fbfd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们通过在源SQL Server上配置分发服务器和发布服务器来设置基于推送的事务复制。</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lp"><img src="../Images/4ec4201c036316406132840546cc9451.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WUQrDmexrg-LY6qgk0gMXg.png"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">源SQL Server上的分发服务器配置(按作者)</figcaption></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lq"><img src="../Images/4fe32e24f34db5b41a20ad2ad8206ab1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9F_vupnkZ8etEzCRxP3ZwQ.png"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">发布者配置，按作者</figcaption></figure><p id="88fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在源SQL Server的“demo”数据库中创建了一个名为“Leaderboard”的表，并配置发布者“demo_pub”将该表的所有更改数据推送到subscriber @ CloudSQL实例。</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lr"><img src="../Images/58d85ec97790035c587fe4d40ecd42f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ti9ozzNw_qHMblHJ8xazeA.png"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">排行榜表DDL，按作者</figcaption></figure><p id="c1ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">启动复制，并以接近实时的状态测试从源SQL Server到CloudSQL的数据复制。</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es ls"><img src="../Images/e77c95eb56396fa228297e41165986bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ibFqhGJY89gvRwVcPPfErg.png"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">复制监视器:按作者从发布服务器到订阅服务器</figcaption></figure><p id="9e91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在“demo”数据库的“leaderboard”表中插入950行，该数据库近乎实时地复制到cloud SQL“csqlawsub”中。</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lt"><img src="../Images/dd523b623d97e8fedbd66cade6ad3b66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yRRWqQc54uYP3hGg08KT_A.png"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">“排行榜”表@源数据库“演示”，作者</figcaption></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lt"><img src="../Images/03f1274c060c0493db80604001a5da8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IAPqKi8WIu2dHLqdiyYxgw.png"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">CloudSQL SQL Server 2017中“leaderboard”表@“csqlawsub”数据库中复制的行(按作者)</figcaption></figure><p id="b038" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不进入SQL Server事务复制解释(关于这个可以参考<a class="ae kn" href="https://docs.microsoft.com/en-us/sql/relational-databases/replication/transactional/transactional-replication?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank">链接</a>)。在这里，我简要介绍了如何设置在线复制，只需点击几下鼠标就可以将用户数据从现有的SQL Server实例迁移到Google CloudSQL。</p><p id="5254" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于Google CloudSQL SQL Server默认为您提供2017版本，您将从标准版本身获得CDC功能，这是Google的一项完全托管的数据库服务。现在，在第2部分中，我们将利用相同的方法&amp;通过可能的方法来基于业务需求构建到BigQuery的管道。</p><p id="13e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考文献:</strong></p><div class="lu lv ez fb lw lx"><a href="https://cloud.google.com/sql/docs/sqlserver/create-manage-databases" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hj fi z dy mc ea eb md ed ef hh bi translated">创建和管理SQL Server数据库|云SQL for SQL Server</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">" type": "thumb-down "，" id": "hardToUnderstand "，" label ":"难以理解" }，{ "type": "thumb-down "，" id"…</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">cloud.google.com</p></div></div><div class="mg l"><div class="mh l mi mj mk mg ml lh lx"/></div></div></a></div><div class="lu lv ez fb lw lx"><a href="https://cloud.google.com/sql/docs/sqlserver/features" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hj fi z dy mc ea eb md ed ef hh bi translated">用于SQL Server功能的云| Google Cloud</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">" type": "thumb-down "，" id": "hardToUnderstand "，" label ":"难以理解" }，{ "type": "thumb-down "，" id"…</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">cloud.google.com</p></div></div><div class="mg l"><div class="mm l mi mj mk mg ml lh lx"/></div></div></a></div><div class="lu lv ez fb lw lx"><a href="https://docs.microsoft.com/en-us/sql/relational-databases/replication/transactional/transactional-replication?view=sql-server-ver15" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hj fi z dy mc ea eb md ed ef hh bi translated">事务复制- SQL Server</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">适用于:SQL Server(所有支持的版本)Azure SQL数据库事务性复制通常以…</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">docs.microsoft.com</p></div></div><div class="mg l"><div class="mn l mi mj mk mg ml lh lx"/></div></div></a></div></div></div>    
</body>
</html>