<html>
<head>
<title>Google Cloud Function Beyond the Limits</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">超越极限的谷歌云功能</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-cloud-function-beyond-the-limits-ea1f16c577b?source=collection_archive---------0-----------------------#2020-08-20">https://medium.com/google-cloud/google-cloud-function-beyond-the-limits-ea1f16c577b?source=collection_archive---------0-----------------------#2020-08-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="ed17" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">利用BigQuery计算能力有效利用云功能</h2></div><p id="5ab6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Google Cloud Functions是一个无服务器的执行环境，旨在构建和连接云服务。它支持完全托管的基础架构，因此云用户只需专注于应用程序代码，而无需担心底层硬件和软件。</p><h2 id="d08d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">用例</h2><ol class=""><li id="f6ff" class="ko kp hi iz b ja kq jd kr jg ks jk kt jo ku js kv kw kx ky bi translated">设计一个数据处理管道，将数据从云存储加载到BigQuery</li><li id="aaf5" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated">当新文件到达云存储桶时，立即执行数据提取和基本转换加载</li><li id="ca1e" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated">输入文件大小从1 MB到1000 MB不等</li></ol><h2 id="4ee7" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">挑战</h2><p id="4b1b" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">虽然有几个云服务可以满足这个目的，但是云功能的细粒度、按需特性使它成为一个容易的选择。话虽如此，但几乎没有什么限制让我们难以找到一个最优的解决方案。下面是几个例子:</p><figure class="li lj lk ll fd lm er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lh"><img src="../Images/4eede95c9309b4e07e905a588a3b6b8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Akz7tkhX4ea9OLR8U2lKVw.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">云函数数据加载统计</figcaption></figure><h2 id="210f" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">解决办法</h2><p id="e290" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">在这个blob中，实现的解决方案解决了加载不符合云功能限制的大文件的挑战。这种<br/>方法的特点是利用云功能的所有必要特性，并利用BigQuery的计算能力。以下步骤解释了如何完成:</p><ol class=""><li id="dead" class="ko kp hi iz b ja jb jd je jg lx jk ly jo lz js kv kw kx ky bi translated">新文件到达云存储桶时调用云功能</li><li id="24d5" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated">使用ExternalConfig()创建的BigQuery外部表指向云存储桶文件</li><li id="c0ef" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated">BigQuery insert语句用于从外部表中读取数据，并将其加载到BigQuery事务/主表中</li></ol><h2 id="11f5" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">云函数源代码</h2><p id="25c3" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">云函数源代码拆分成多个文件:</p><ol class=""><li id="850f" class="ko kp hi iz b ja jb jd je jg lx jk ly jo lz js kv kw kx ky bi translated"><strong class="iz hj">模式文件</strong> (schema.json):该文件包含BigQuery外部表列名和数据类型。</li><li id="be02" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated"><strong class="iz hj">配置文件</strong> (config.json):该文件包含BigQuery外部和内部表输入参数。</li><li id="03ee" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated"><strong class="iz hj">库文件</strong> (bqlib.py):该文件包含用户自定义的库函数，用于执行数据提取和数据加载。</li><li id="7ab8" class="ko kp hi iz b ja kz jd la jg lb jk lc jo ld js kv kw kx ky bi translated"><strong class="iz hj">入口点/主文件</strong> (bqDataLoad.py):该文件包含云函数入口点代码，调用库函数</li></ol><figure class="li lj lk ll fd lm"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">模式文件</figcaption></figure><figure class="li lj lk ll fd lm"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">配置文件</figcaption></figure><figure class="li lj lk ll fd lm"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">库文件</figcaption></figure><figure class="li lj lk ll fd lm"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">入口点/主文件</figcaption></figure><h2 id="a891" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">试验结果</h2><p id="eeb5" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">下图所示的测试结果证明了使用云函数成功加载了一个<strong class="iz hj"> 681.2 </strong> MB文件。</p><figure class="li lj lk ll fd lm er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es mc"><img src="../Images/5a8375cf8c635b4424e3b14712140fe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ebPeG2WYO-rGNvaNhFiSiQ.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">云函数属性</figcaption></figure><figure class="li lj lk ll fd lm er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es md"><img src="../Images/10175abd74e2e0d17320a426689ca5ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_fDiGfHUKLMMzcUc0v3Vrw.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">云函数作业执行统计</figcaption></figure><figure class="li lj lk ll fd lm er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es me"><img src="../Images/02eacab5ebb1cd5be4bcbdc17da71521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Up-b8h1d-9fIPU_tjqmGtA.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">内存分析器(Python)</figcaption></figure><h2 id="4ce4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">源代码库</h2><p id="b36f" class="pw-post-body-paragraph ix iy hi iz b ja kq ij jc jd kr im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated"><a class="ae mf" href="https://github.com/soumendra-mishra/bigquery-data-loader.git" rel="noopener ugc nofollow" target="_blank">https://github . com/soumendra-mis HRA/big query-data-loader . git</a></p></div></div>    
</body>
</html>