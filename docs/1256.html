<html>
<head>
<title>Disaster Recovery on Google Cloud for Data (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google Cloud上的数据灾难恢复(第2部分)</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/disaster-recovery-on-google-cloud-for-data-part-2-2523d862fbe1?source=collection_archive---------0-----------------------#2020-01-16">https://medium.com/google-cloud/disaster-recovery-on-google-cloud-for-data-part-2-2523d862fbe1?source=collection_archive---------0-----------------------#2020-01-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="8cf3" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在云中烹饪</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/f572aecb106c8a038f33963beecd381a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Zp9v6lyyHPrk2xND"/></div></div></figure><h1 id="edcb" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">介绍</h1><p id="a7c7" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated"><strong class="kd hj"><em class="kx"/></strong><a class="ae ky" rel="noopener" href="/@pvergadia/get-cooking-in-cloud-an-introduction-5b3b90de534e"><strong class="kd hj"><em class="kx">云上做饭</em></strong></a><strong class="kd hj"><em class="kx"/></strong>是一个<a class="ae ky" rel="noopener" href="/@pvergadia/get-cooking-in-cloud-an-introduction-5b3b90de534e">博客</a>和<a class="ae ky" href="https://www.youtube.com/playlist?list=PLIivdWyY5sqIOyeovvRapCjXCZykZMLAe" rel="noopener ugc nofollow" target="_blank">视频</a>系列，帮助企业和开发者在Google Cloud上构建商业解决方案。在这第二个迷你系列中，我将介绍Google Cloud上的灾难恢复。当你在网上时，灾难可能很难处理。在这些文章中，我们一直在阐述如何应对地震、停电、洪水、火灾等灾害。</p><p id="1acf" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">以下是这部迷你剧的所有文章，供你查阅。</p><ol class=""><li id="5343" class="le lf hi kd b ke kz kh la kk lg ko lh ks li kw lj lk ll lm bi translated"><a class="ae ky" rel="noopener" href="/google-cloud/hosting-web-applications-on-google-cloud-an-overview-87d0962931a3">灾难恢复概述</a></li><li id="387c" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated"><a class="ae ky" rel="noopener" href="/@pvergadia/cold-disaster-recovery-on-google-cloud-for-applications-running-on-premises-114b31933d02">基于谷歌云的本地应用冷灾难恢复</a></li><li id="eba2" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated"><a class="ae ky" rel="noopener" href="/google-cloud/warm-disaster-recovery-on-google-cloud-for-applications-running-on-premises-7428b0f7db72">针对内部部署应用程序的谷歌云热灾难恢复</a></li><li id="9d86" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated"><a class="ae ky" rel="noopener" href="/google-cloud/hot-disaster-recovery-on-google-cloud-for-applications-running-on-premises-da7048d1a57b">基于Google Cloud的内部应用热灾难恢复</a></li><li id="5425" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated"><a class="ae ky" rel="noopener" href="/google-cloud/cold-disaster-recovery-for-applications-in-google-cloud-5edeb32f2fc6">谷歌云中应用的冷灾难恢复</a></li><li id="699b" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated"><a class="ae ky" rel="noopener" href="/google-cloud/warm-disaster-recovery-for-applications-in-google-cloud-9165b4ea8e2f">谷歌云中应用的温灾恢复</a></li><li id="98a3" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated"><a class="ae ky" href="https://medium.com/p/958efa292c5f/edit" rel="noopener">谷歌云中应用的热灾难恢复</a></li><li id="bc97" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated"><a class="ae ky" rel="noopener" href="/google-cloud/disaster-recovery-on-google-cloud-for-data-part-1-9cf08782bac9">Google Cloud上的数据灾难恢复:第1部分</a></li><li id="ca89" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">Google Cloud上的数据灾难恢复:第2部分</li></ol><p id="e66d" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">由于数据是任何应用程序恢复中最重要的部分，我认为专门讨论“数据”是有意义的。因此，我将最后两篇文章的重点放在数据灾难恢复上。在上一篇文章中，您了解了当生产环境是在本地还是在另一个云上时，如何规划<a class="ae ky" rel="noopener" href="/google-cloud/disaster-recovery-on-google-cloud-for-data-part-1-9cf08782bac9">数据恢复。在本课程中，您将学习如何在生产环境位于Google Cloud上时规划数据恢复。所以，继续读下去吧！</a></p><h1 id="0eba" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">你会学到什么</h1><ul class=""><li id="c675" class="le lf hi kd b ke kf kh ki kk ls ko lt ks lu kw lv lk ll lm bi translated">数据备份很重要</li><li id="6ebe" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">数据恢复需要什么？</li><li id="924f" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">数据备份和恢复</li><li id="1feb" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">数据库备份和恢复</li></ul><h1 id="c623" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">先决条件</h1><ul class=""><li id="90f7" class="le lf hi kd b ke kf kh ki kk ls ko lt ks lu kw lv lk ll lm bi translated">谷歌云的基本概念和结构，这样你就可以识别产品的名称。</li><li id="25ca" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">阅读<a class="ae ky" rel="noopener" href="/google-cloud/hosting-web-applications-on-google-cloud-an-overview-87d0962931a3">概述文章</a>了解灾难恢复的相关定义。</li></ul><h1 id="831b" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">看看这个视频</h1><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lw lx l"/></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">在Google Cloud上对Google Cloud生产环境中的数据进行灾难恢复</figcaption></figure><h1 id="5ec0" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">数据备份很重要</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mc"><img src="../Images/23708697eb014f56abbf181368f8d364.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a-dcTuHoDbCaK-Hvi1ck0g.png"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">Mane活动策划</figcaption></figure><p id="cf8c" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">“<strong class="kd hj"> Mane-Event-Planning </strong>”是一家电子商务活动策划公司，目前在谷歌云上运行他们的基础设施，因此灾难恢复环境也在谷歌云上运行。与任何其他在线业务数据一样，数据也是其应用程序的重要组成部分，让我们更深入地了解它，并通过一些策略来帮助大型活动规划，以避免在灾难中丢失数据！</p><h1 id="3179" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">“数据”恢复需要什么？</h1><p id="433e" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">如果您在某个地方备份了数据，则只能恢复数据。但是对于数据来说，备份意味着什么呢？</p><p id="93a1" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">术语“数据”备份涵盖两种情况:</p><ul class=""><li id="bf96" class="le lf hi kd b ke kz kh la kk lg ko lh ks li kw lv lk ll lm bi translated"><strong class="kd hj">数据备份:</strong>仅备份数据就需要将离散数量的数据从一个地方复制到另一个地方，以便从损坏或生产中断中恢复。</li><li id="0a47" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated"><strong class="kd hj">数据库备份:</strong>数据库备份稍微复杂一些，因为它们通常涉及到恢复到某个时间点。因此，我们不仅需要考虑备份数据库，还需要考虑备份事务日志，然后在恢复期间将它们应用于数据库备份。</li></ul><p id="88da" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">现在，我们已经对灾难恢复的数据和数据库备份有了基本的了解，让我们考虑一下“Mane-Event-Planning”场景，以及他们如何专门为数据设置灾难恢复。</p><h1 id="d979" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">数据备份和恢复</h1><p id="5170" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated"><em class="kx"> Mane-Event-Planning </em>在Google Cloud上有一个分层存储模式，持久磁盘连接到计算引擎。因此，数据备份很简单，他们只需将数据迁移到低成本层，如近线或冷线存储，因为访问备份数据的需求不太可能。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es md"><img src="../Images/522a92e9872ee11cb9798d2a44304432.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*q8OMNiTtkZGS0GOp5Sv5iw.gif"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">Google Cloud中典型的分层存储模式</figcaption></figure><h1 id="0f73" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">数据库备份和恢复</h1><p id="e8ce" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated"><em class="kx"> Mane-Event-Planning </em>可以使用多种策略来实施恢复Google Cloud中的数据库系统的流程。让我们看看他们现在使用什么数据库。他们有:</p><ul class=""><li id="2091" class="le lf hi kd b ke kz kh la kk lg ko lh ks li kw lv lk ll lm bi translated">一个部署在计算引擎上的自我管理的MySQL数据库</li><li id="c946" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">云<strong class="kd hj"> Bigtable </strong>和<strong class="kd hj"> BigQuery </strong>是托管数据库。</li></ul><h2 id="3b97" class="me jk hi bd jl mf mg mh jp mi mj mk jt kk ml mm jv ko mn mo jx ks mp mq jz mr bi translated">托管数据库</h2><p id="4e93" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">托管数据库专为扩展而设计，Bigtable提供区域复制，这提供了比单个集群更高的可用性、额外的读取吞吐量，以及更高的耐用性和在区域故障情况下的弹性。</p><p id="fa98" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">这里使用BigQuery来归档数据，对于长期而言，这是一种非常经济高效的存储，因为如果数据在90天内没有变化，存储价格会下降50%。使用BigQuery最好的一点是它在默认情况下是可复制的，但是不要忘记这并不能避免错误更新造成的数据损坏。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ms"><img src="../Images/9c38d52c12ee48b4513349c55efd5ba2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vDn3GRyQGIYDz7zS0IMQuw.png"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">如果数据保持不变，90天后BigQuery存储成本会降低。</figcaption></figure><p id="a5f0" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">了解更多关于处理数据损坏的信息，或者如果你正在使用任何其他托管的谷歌云数据库，如云<a class="ae ky" href="https://cloud.google.com/spanner/" rel="noopener ugc nofollow" target="_blank">扳手</a>，云C <a class="ae ky" href="https://cloud.google.com/composer/" rel="noopener ugc nofollow" target="_blank">组件</a>或云<a class="ae ky" href="https://cloud.google.com/datastore/" rel="noopener ugc nofollow" target="_blank">数据存储</a>。</p><h2 id="d070" class="me jk hi bd jl mf mg mh jp mi mj mk jt kk ml mm jv ko mn mo jx ks mp mq jz mr bi translated">自我管理的数据库</h2><p id="4bb3" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">现在，让我们谈谈Mane-Event-Panning在计算引擎上部署的一个自我管理的MySql数据库。</p><h2 id="0a8c" class="me jk hi bd jl mf mg mh jp mi mj mk jt kk ml mm jv ko mn mo jx ks mp mq jz mr bi translated">灾难“之前”应采取的步骤</h2><ul class=""><li id="5b23" class="le lf hi kd b ke kf kh ki kk ls ko lt ks lu kw lv lk ll lm bi translated">创建一个VPC网络</li><li id="e16a" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">创建使用应用程序服务配置的自定义图像。作为映像的一部分，确保为正在处理的数据附加一个持久磁盘。</li><li id="80f3" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">从连接的永久磁盘创建快照，并配置启动脚本以从最新的快照创建永久磁盘并装载该磁盘。</li><li id="27bc" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">然后从我们刚刚创建的图像创建一个实例模板。</li><li id="0115" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">使用此实例模板，配置目标大小为1的区域托管实例组。</li><li id="ab49" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">确保在受管实例组上配置了运行状况检查</li><li id="5b50" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">使用区域托管实例组配置内部负载平衡</li><li id="fcfb" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">配置一个计划任务来创建持久性磁盘的常规快照。</li></ul><h2 id="a528" class="me jk hi bd jl mf mg mh jp mi mj mk jt kk ml mm jv ko mn mo jx ks mp mq jz mr bi translated">灾难“期间/之后”应采取的步骤</h2><p id="0196" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">嗯，Mane-event-planning不需要启动任何故障转移步骤，因为它们会自动发生。这是Google cloud中可用的默认HA特性中最好的部分。如果某个区域出现故障，区域实例组将在同一区域的不同区域中启动一个替换实例。从最新快照创建新的持久磁盘，并将其附加到新实例。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mt"><img src="../Images/eff389c12b865913098cd0e8c927480f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*FlezmHWFE-FDlYWAu1KtkA.gif"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">灾难发生前后应采取的步骤</figcaption></figure><p id="dce0" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">如果需要替换数据库实例，此配置:</p><ul class=""><li id="d529" class="le lf hi kd b ke kz kh la kk lg ko lh ks li kw lv lk ll lm bi translated">自动启动另一个正确版本的数据库服务器</li><li id="33d0" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">连接包含最新备份和事务日志文件的永久磁盘</li><li id="acf9" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">将重新配置与数据库服务器通信的客户端的需求降至最低</li><li id="ec4b" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">确保相同的Google Cloud安全控制(IAM策略、防火墙设置)应用于恢复的数据库服务器。</li></ul><p id="b595" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">要了解关于这些组件的更多信息，请查看<a class="ae ky" rel="noopener" href="/google-cloud/cold-disaster-recovery-for-applications-in-google-cloud-5edeb32f2fc6">上一篇关于Google Cloud </a>上应用程序冷灾难恢复的文章。</p><p id="d02e" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">好了，你知道了。如果您在Google cloud中部署了一个生产应用程序，并且需要设置数据恢复，那么希望您已经学习了一些在您的特定场景中应用的策略！</p><h1 id="d275" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">结论</h1><p id="2c5e" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">如果您在Google Cloud中部署了一个生产应用程序，并且需要设置<strong class="kd hj"> <em class="kx">数据</em> </strong>恢复，那么希望您已经学会了一些策略！更多文章敬请关注<a class="ae ky" rel="noopener" href="/@pvergadia/get-cooking-in-cloud-an-introduction-5b3b90de534e">获取云端烹饪系列</a>点击这里。</p><h1 id="dd0e" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">后续步骤</h1><ul class=""><li id="3865" class="le lf hi kd b ke kf kh ki kk ls ko lt ks lu kw lv lk ll lm bi translated">在<a class="ae ky" href="https://medium.com/google-cloud" rel="noopener">谷歌云平台媒体</a>上关注这个博客系列。</li><li id="7525" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">参考<a class="ae ky" href="https://cloud.google.com/solutions/dr-scenarios-planning-guide" rel="noopener ugc nofollow" target="_blank">灾难恢复解决方案</a>。</li><li id="d01f" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">关注<a class="ae ky" href="https://www.youtube.com/watch?v=pxp7uYUjH_M" rel="noopener ugc nofollow" target="_blank">获取云端烹饪</a>视频系列，订阅谷歌云平台YouTube频道</li><li id="70aa" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">想要更多的故事？查看我的<a class="ae ky" rel="noopener" href="/@pvergadia/">媒体</a>，<a class="ae ky" href="https://twitter.com/pvergadia" rel="noopener ugc nofollow" target="_blank">在twitter上关注我</a>。</li><li id="96b4" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">请和我们一起欣赏这部迷你剧，并了解更多类似的谷歌云解决方案:)</li></ul></div></div>    
</body>
</html>