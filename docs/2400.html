<html>
<head>
<title>.NET 6 on Cloud Functions (2nd gen)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">。关于云功能的NET 6(第二代)</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/net-6-on-cloud-functions-2nd-gen-32e844ce9828?source=collection_archive---------1-----------------------#2022-10-03">https://medium.com/google-cloud/net-6-on-cloud-functions-2nd-gen-32e844ce9828?source=collection_archive---------1-----------------------#2022-10-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="fb87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回到八月份，我们<a class="ae jd" href="https://cloud.google.com/blog/products/serverless/cloud-functions-2nd-generation-now-generally-available" rel="noopener ugc nofollow" target="_blank">宣布了</a>第二代云函数，具有更长的请求处理时间、更大的实例、带有Eventarc的新事件源等等。</p><p id="7f2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">几周前。NET 6支持(公开预览版)被默默添加到云功能中。</p><p id="f11b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看如何部署一些。NET 6函数到云函数第二代。</p><h1 id="e1a0" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">的功能框架。网</h1><p id="d6c5" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated"><a class="ae jd" href="https://github.com/GoogleCloudPlatform/functions-framework-dotnet" rel="noopener ugc nofollow" target="_blank">职能框架为。NET </a>是最简单的创建方式。使用HTTP或CloudEvent请求的. NET函数。</p><p id="db5d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将模板包安装到。网络工具:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="f11f" class="kq jf hi km b fi kr ks l kt ku">dotnet new -i Google.Cloud.Functions.Templates</span></pre><p id="a8ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将为. NET安装三个模板。您可以通过运行以下命令来验证模板是否已安装:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="415a" class="kq jf hi km b fi kr ks l kt ku">dotnet new --list</span><span id="5447" class="kq jf hi km b fi kv ks l kt ku">Templates                                            Short Name<br/>--------------------------------------------------------------------<br/>Google Cloud Functions CloudEvent Function           gcf-event<br/>Google Cloud Functions CloudEvent Function (Untyped) gcf-untyped-event<br/>Google Cloud Functions HttpFunction                  gcf-http</span></pre><p id="06d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注</strong>:功能框架。NET当前支持。网芯3.1，但是。NET 6.0支持即将推出。您需要将生成项目的目标框架更改为。NET 6.0以后(见下文)。</p><h1 id="9541" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">HTTP功能</h1><p id="c86e" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">使用<code class="du kw kx ky km b">gcf-http</code>模板创建一个处理HTTP请求的函数:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="76ae" class="kq jf hi km b fi kr ks l kt ku">mkdir HelloHttp <br/>cd HelloHttp <br/>dotnet new gcf-http</span></pre><p id="0be0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将创建一个项目和一个用于响应HTTP请求的<a class="ae jd" href="https://github.com/meteatamel/cloud-functions-dotnet/blob/master/HelloHttp/Function.cs" rel="noopener ugc nofollow" target="_blank"> Function.cs </a>文件。</p><p id="936e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将目标框架更改为<code class="du kw kx ky km b">.csproj</code>文件中的<code class="du kw kx ky km b">net6.0</code>:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="6037" class="kq jf hi km b fi kr ks l kt ku">&lt;TargetFramework&gt;net6.0&lt;/TargetFramework&gt;</span></pre><p id="a436" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<code class="du kw kx ky km b">--trigger-http</code> <code class="du kw kx ky km b">--gen2</code>标志和<code class="du kw kx ky km b">dotnet6</code>运行时部署到云功能:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="c590" class="kq jf hi km b fi kr ks l kt ku">gcloud functions deploy hello-http-function \<br/>    --allow-unauthenticated \<br/>    --entry-point HelloHttp.Function \<br/>    --gen2 \<br/>    --region us-central1 \<br/>    --runtime dotnet6 \<br/>    --trigger-http</span></pre><p id="e19f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一两分钟后，您应该会看到云控制台中部署的云功能:</p><figure class="kh ki kj kk fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kz"><img src="../Images/68465e43999a84096e39e39d4dc3a7c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zKszLklXfOOl_9qv.png"/></div></div></figure><p id="af0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以通过使用<code class="du kw kx ky km b">gcloud</code>发送HTTP请求来调用该函数:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="0f5c" class="kq jf hi km b fi kr ks l kt ku">gcloud functions call hello-http-function \<br/>    --gen2 \<br/>    --region us-central1</span></pre><h1 id="4114" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">CloudEvent函数</h1><p id="ff4d" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">或者，您可以使用<code class="du kw kx ky km b">gcf-event</code>模板创建一个使用CloudEvent请求的函数:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="1d56" class="kq jf hi km b fi kr ks l kt ku">mkdir HelloGcs<br/>cd HelloGcs<br/>dotnet new gcf-event</span></pre><p id="c9b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将创建一个项目和一个<a class="ae jd" href="https://github.com/meteatamel/cloud-functions-dotnet/blob/master/HelloGcs/Function.cs" rel="noopener ugc nofollow" target="_blank"> Function.cs </a>文件来响应CloudEvent请求。该函数还将CloudEvent的数据解析到<code class="du kw kx ky km b">StorageObjectData</code>中。</p><p id="3907" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将目标框架更改为<code class="du kw kx ky km b">.csproj</code>文件中的<code class="du kw kx ky km b">net6.0</code>:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="6064" class="kq jf hi km b fi kr ks l kt ku">&lt;TargetFramework&gt;net6.0&lt;/TargetFramework&gt;</span></pre><p id="8b79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<code class="du kw kx ky km b">--trigger-event</code> <code class="du kw kx ky km b">--gen2</code>标志和<code class="du kw kx ky km b">dotnet6</code>运行时部署到云功能:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="70bd" class="kq jf hi km b fi kr ks l kt ku">gcloud functions deploy hello-gcs-function \<br/>    --allow-unauthenticated \<br/>    --entry-point HelloGcs.Function \<br/>    --gen2 \<br/>    --region us-central1 \<br/>    --runtime dotnet6 \<br/>    --trigger-event google.storage.object.finalize \<br/>    --trigger-resource ${BUCKET_NAME}</span></pre><p id="8839" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种情况下，您在<code class="du kw kx ky km b">--trigger-event</code>中指定<code class="du kw kx ky km b">google.storage.object.finalize</code>，在<code class="du kw kx ky km b">--trigger-resource</code>中指定桶名，以监听桶中的新文件创建。</p><p id="0023" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">几分钟后，该功能应该在云控制台中可见:</p><figure class="kh ki kj kk fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lh"><img src="../Images/07af84c8aaa83ef8f186d7b868ad9f4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*78nCbAAVHUJIjbkq.png"/></div></div></figure><p id="c835" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以通过将文件上传到存储桶来触发该功能:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="c83b" class="kq jf hi km b fi kr ks l kt ku">echo "Hello from Storage" &gt; random.txt<br/>gsutil cp random.txt gs://${BUCKET_NAME}</span></pre></div><div class="ab cl li lj gp lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hb hc hd he hf"><p id="5968" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想了解更多。NET 6和云函数，你可以在我们的<a class="ae jd" href="https://github.com/meteatamel/cloud-functions-dotnet" rel="noopener ugc nofollow" target="_blank">中找到更多示例。NET上的Google Cloud Functions </a> repo上的GitHub，并在C#  codelab中试用<a class="ae jd" href="https://codelabs.developers.google.com/codelabs/cloud-functions-csharp" rel="noopener ugc nofollow" target="_blank"> Google Cloud Functions。</a></p><p id="e69d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如有任何问题或反馈，请随时在Twitter <a class="ae jd" href="https://twitter.com/meteatamel" rel="noopener ugc nofollow" target="_blank"> @meteatamel </a>上联系我。</p></div><div class="ab cl li lj gp lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hb hc hd he hf"><p id="67f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lp">原发布于</em><a class="ae jd" href="https://atamel.dev/posts/2022/10-03_dotnet6_cloud_functions/" rel="noopener ugc nofollow" target="_blank"><em class="lp">https://atamel . dev</em></a><em class="lp">。</em></p></div></div>    
</body>
</html>