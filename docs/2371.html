<html>
<head>
<title>Perform real time anomaly detection using Google Cloud’s Timeseries Insights API — Part I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Google Cloud的Timeseries Insights API执行实时异常检测—第一部分</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/perform-real-time-anomaly-detection-using-google-clouds-timeseries-insights-api-part-i-f6572021ac0?source=collection_archive---------1-----------------------#2022-09-20">https://medium.com/google-cloud/perform-real-time-anomaly-detection-using-google-clouds-timeseries-insights-api-part-i-f6572021ac0?source=collection_archive---------1-----------------------#2022-09-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="0122" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated"><em class="ix">简单易用的API概述，通过低延迟异常检测和预测来扩展数十亿时间序列</em></h2></div><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es iy"><img src="../Images/763917c5518b71d10880a18e73a874e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uR2X6XN0wyiTNS7f"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">照片由<a class="ae jo" href="https://unsplash.com/@aronvisuals?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Aron视觉效果</a>在<a class="ae jo" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><blockquote class="jp jq jr"><p id="d156" class="js jt ju jv b jw jx ij jy jz ka im kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">这是关于使用Google Cloud的Timeseries Insight API进行实时异常检测的两篇文章中的第一篇。在本文中，我将介绍如何为异常检测创建数据集，以及如何查询异常。第二部分将重点讨论如何以流的方式添加新事件，如何在新添加的数据上获得异常，以及如何删除不需要的时间序列数据集。</p></blockquote><p id="932c" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">时间序列预测和异常检测是ML中的常见用例，广泛应用于不同行业，例如交通预测、需求规划、库存等。这些现有系统中的大多数以批处理作业的形式运行预测和异常检测。在本教程中，我将解释和演示一个用例，使用Google Cloud的Timeseries Insights API近实时(亚秒延迟)检测异常。</p><p id="923f" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">那么什么是Timeseries Insights API，为什么以及在哪里使用它呢？</p><blockquote class="jp jq jr"><p id="423b" class="js jt ju jv b jw jx ij jy jz ka im kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">Google Cloud的Timeseries Insights API是一个通用异常检测框架，提供低成本、低延迟和高可扩展性的解决方案。</p></blockquote><p id="5e2a" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">目前存在多种异常检测方法。这些方法从基于随时间观察阈值的简单方法到动态调整分辨率间隔的更复杂的方法。这些系统的关键限制是分析时间序列和挑选感兴趣的时间序列的成本。除此之外，当以批处理方式运行时，对数十亿个时间序列的预测和异常检测在计算上是昂贵的。这是进行在线和实时分析的关键限制，例如:根据事件维度值的波动向用户发送警报。</p><p id="0d75" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">使用timeseries Insights API进行时间序列预测并将其用于异常检测的主要目标是:</p><ul class=""><li id="5492" class="ks kt hi jv b jw jx jz ka kp ku kq kv kr kw ko kx ky kz la bi translated">扩展到数十亿个时间序列(时间序列= &gt;给定事件随时间的计数序列)</li><li id="28b7" class="ks kt hi jv b jw lb jz lc kp ld kq le kr lf ko kx ky kz la bi translated">用于预测和异常检测的实时延迟(亚秒)</li><li id="e963" class="ks kt hi jv b jw lb jz lc kp ld kq le kr lf ko kx ky kz la bi translated">为时间序列预测提供相对便宜的批量推断</li></ul><p id="1af7" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">让我们通过一个例子来理解Timeseries Insights API是如何工作的，并看看它是如何工作的。有4种主要的方法与API交互并使事情运转。这些是:</p><ul class=""><li id="5335" class="ks kt hi jv b jw jx jz ka kp ku kq kv kr kw ko kx ky kz la bi translated"><strong class="jv hj">创建并加载数据集</strong></li><li id="dffc" class="ks kt hi jv b jw lb jz lc kp ld kq le kr lf ko kx ky kz la bi translated"><strong class="jv hj">查询数据集</strong></li><li id="bf08" class="ks kt hi jv b jw lb jz lc kp ld kq le kr lf ko kx ky kz la bi translated"><strong class="jv hj">更新数据集(在现有数据集中追加流/新事件)</strong></li><li id="eb5e" class="ks kt hi jv b jw lb jz lc kp ld kq le kr lf ko kx ky kz la bi translated"><strong class="jv hj">删除数据集</strong></li></ul><p id="4236" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">我们将在本文中介绍第一种方法。您可以查看<a class="ae jo" href="https://cloud.google.com/timeseries-insights/docs" rel="noopener ugc nofollow" target="_blank"> <strong class="jv hj">官方API文档</strong> </a>获取API的设置说明，并设置适当的权限。现在让我们进入有趣的部分:</p><p id="09f2" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">我们正在使用一个虚拟的物联网数据集。数据来自单个传感器，大约每25秒钟就会有一个事件以数据流的形式传输，其属性包括仓库内的<em class="ju">光</em>、<em class="ju">温度</em>、<em class="ju">氢</em>、<em class="ju">湿度</em>值。数据集包含大约3个月的数据，有202K行。我们将在本练习中使用该数据集。以下是数据集中的一些示例行:</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es lg"><img src="../Images/83133439800bd9b33678e8d50a9f4359.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*MIbKR9AevQgFt7YoC8wPHg.png"/></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">表格形式的传感器数据示例(我们将不使用最后一栏)</figcaption></figure><p id="2bce" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">下面是一段时间内每个属性的值:</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es lh"><img src="../Images/722d377c25a305772cc83ff7f4176724.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XqMlsXE3e7Y9b48xSdYRvg.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">图1 —传感器读数的时间序列图</figcaption></figure><p id="9cd8" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">正如你在上面的图中所看到的，光的值波动很大，而光和温度的值或多或少是一致的，除了在同一时间温度值急剧上升而氢值急剧下降的一些日子。对于本文中的分析，我将只考虑温度值，并尝试检测温度值中的异常。</p><p id="ca09" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">如果你只仔细观察温度值，它会在2011年6月21日到2011年6月28日之间快速上升。对于本教程，该时间范围将用于查询以检查温度值中的异常</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es li"><img src="../Images/a9ec6ec4e433b9e3e2e467fcea1dbb4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i43C1rE2SsfpZZnTPbGLfw.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">图2 —给定数据中的温度变化</figcaption></figure><h1 id="e5ea" class="lj lk hi bd ll lm ln lo lp lq lr ls lt io lu ip lv ir lw is lx iu ly iv lz ma bi translated">1.创建数据集</h1><p id="65bb" class="pw-post-body-paragraph js jt hi jv b jw mb ij jy jz mc im kb kp md ke kf kq me ki kj kr mf km kn ko hb bi translated">在使用Timeseries Insight API查询异常之前，我们需要使用历史数据集在API中创建数据集。数据集是事件的集合，使用该数据集执行查询。API希望这些数据采用某种json格式。给定数据集的这种格式的事件示例如下所示:</p><pre class="iz ja jb jc fd mg mh mi mj aw mk bi"><span id="1a16" class="ml lk hi mh b fi mm mn l mo mp"><em class="ju">{“groupId”:”-8865179820473228792",<br/> ”eventTime”:”2021–06–14T00:02:24+00:00",<br/>”dimensions”:<br/>[{“name”:”measure”,”stringVal”:”LTTH”},{“name”:”Humidity”,”doubleVal”:36},<br/>{“name”:”Light”,”doubleVal”:102},<br/>{“name”:”h2_raw”,”doubleVal”:1040},{“name”:”temp”,”doubleVal”:36.95}]}</em></span></pre><p id="839d" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">在这里，这一个事件代表前面图像中显示的表格数据集中的一行。让我们首先了解在Timeseries Insights API中创建数据集的不同组件。本文的<code class="du mq mr ms mh b">resource</code>部分提供了笔记本的链接，其中包含将表格数据转换成json所需格式的完整代码。</p><p id="ae15" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated"><strong class="jv hj"> groupId </strong>此处代表数据集中的每个唯一事件。可以把它看作一个事件标识符，因为我们数据集中的每一行都是一个事件，所以在上面转换的json格式中，每个事件都有一个唯一的<em class="ju"> groupId </em>。我使用BigQuery的<a class="ae jo" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/hash_functions" rel="noopener ugc nofollow" target="_blank"> FARM_FINGERPRINT </a>哈希函数来生成这个。分组的目的是计算来自同一组的事件之间的相关性。请注意，如果您的数据集中没有这个，那么将使用时间戳和数据集中的其他内容自动生成一个groupId，因此最好自己创建它，以便完全控制模式。</p><p id="a11f" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">eventTime (区分大小写)就是事件的时间戳。</p><p id="6124" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated"><strong class="jv hj">维度</strong>是给定事件的<strong class="jv hj"> </strong>属性。它可以是分类的，也可以是数字的。您也可以将此视为时间序列数据的不同属性。请注意，每个维度都将使用stringVal、doubleVal或longVal来命名和赋值</p><blockquote class="jp jq jr"><p id="7e5e" class="js jt ju jv b jw jx ij jy jz ka im kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">注意:json事件包含一个具有名为"<strong class="jv hj"> measure </strong>和"<strong class="jv hj"> LTTH </strong>"的键值对的维度，但是我们的原始数据集没有同名的列。</p></blockquote><p id="2cdf" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">这与timeseries insights API中名为<em class="ju"> slice </em>的概念有关。切片是数据集中所有事件的子集，这些事件在某个<em class="ju">分类</em>维度上有一些值，但是由于我们的数据集中没有任何这样的属性/列(所有属性都是数字的)，我们需要创建一个分类类型的虚拟事件，并且由于我们数据集中的每个事件都是唯一的，没有层次结构，我们可以为这个虚拟维度使用任意字符串值，每个事件都有相同的值。</p><blockquote class="jp jq jr"><p id="2a1d" class="js jt ju jv b jw jx ij jy jz ka im kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">将来，API将支持使用数值维的切片</p></blockquote><p id="174f" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">这就是创建所需格式的数据集所需了解的全部内容。转换后的json文件现在有202k行(与原始数据集相同)。现在，在创建这个数据集之前，我们需要将这个json文件移动到一个云存储桶中。您可以使用以下命令在云存储中移动存储桶中的文件:</p><pre class="iz ja jb jc fd mg mh mi mj aw mk bi"><span id="4a89" class="ml lk hi mh b fi mm mn l mo mp">gsutil cp transformed.json gs://&lt;my-data-bucket-name&gt;</span></pre><p id="e090" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">下一步是向timeseries insights API发出create dataset命令，以创建包含所有历史记录的数据集。</p><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="mt mu l"/></div></figure><p id="9fd7" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">在上面的代码中，文件数据是用于创建数据集的json有效负载。首先，提供一个数据集<strong class="jv hj">名称</strong> ( <em class="ju">传感器-数据此处为</em>)，然后设置<strong class="jv hj"> ttl </strong>，这是一个参数集，确定数据集数据在被丢弃之前应该存储多长时间。这表示附加的事件(对于新的输入数据)必须比当前时间减去ttl值新。那么<strong class="jv hj"> dataNames </strong>参数就是数据集中所有维度的列表。实际上，您希望在这里包含您希望查询异常和预测所有维度。最后，<strong class="jv hj">数据源</strong>是包含历史数据的转换后的json文件的gcs位置。</p><blockquote class="jp jq jr"><p id="4522" class="js jt ju jv b jw jx ij jy jz ka im kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">如果API服务器接受这个创建请求，它将返回成功。您可以提交另一个请求来查看或列出数据集。最初，作业将处于“加载”<em class="hi">状态，直到所有维度的索引完成，然后状态变为</em>“已加载”，这表明数据集可以开始接受异常和预测的查询和更新。</p></blockquote><p id="c850" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">通过运行以下代码检查状态并列出API服务器中的所有数据集</p><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="mt mu l"/></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">列出API中的所有数据集</figcaption></figure><p id="42ae" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">以下是您将看到的回复。您可以看到数据集名称、所有索引维度、云存储中json文件的数据集uri以及数据集中的行数。请注意，您只能在状态为<em class="ju"> LOADED </em>时查询数据集，并且根据您的数据大小，它可能需要一段时间才能被索引并准备好供查询。</p><pre class="iz ja jb jc fd mg mh mi mj aw mk bi"><span id="7dbd" class="ml lk hi mh b fi mm mn l mo mp">{'datasets': [{'name': 'projects/your-project-name/locations/us-central1/datasets/sensor-data',<br/>   'dataNames': ['measure', 'Humidity', 'Light', 'h2_raw', 'temp'],<br/>   'dataSources': [{'uri': 'gs://&lt;your-bucket-name&gt;/transformed.json'}],<br/>   'state': 'LOADED',<br/>   'status': {'message': 'name: "num-items-examined"\nvalue: 202267\n,name: "num-items-ingested"\nvalue: 202267\n,name: "processed-session"\nvalue: 202267\n'}}]}</span></pre><h1 id="ec39" class="lj lk hi bd ll lm ln lo lp lq lr ls lt io lu ip lv ir lw is lx iu ly iv lz ma bi translated">2.异常查询</h1><p id="088d" class="pw-post-body-paragraph js jt hi jv b jw mb ij jy jz mc im kb kp md ke kf kq me ki kj kr mf km kn ko hb bi translated">一旦数据集成功创建并处于<em class="ju">已加载</em>状态，API就准备好接受异常或预测的查询。与创建数据集类似，有一个查询数据json有效负载，将用于向API发出HTTP请求。以下是用于查询温度值异常的示例负载。</p><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="mt mu l"/></div></figure><p id="0503" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">在高级别上，Timeseries Insights API异常检测查询验证数据集中是否有任何切片在给定的特定时间点具有预期值，这称为检测时间。您需要了解四个顶级参数:</p><ul class=""><li id="dbae" class="ks kt hi jv b jw jx jz ka kp ku kq kv kr kw ko kx ky kz la bi translated"><strong class="jv hj">检测时间</strong>:检测时间表示当预期值与您选择的指标的实际值不同时，我们希望分析并提出异常的时间。</li><li id="7aa7" class="ks kt hi jv b jw lb jz lc kp ld kq le kr lf ko kx ky kz la bi translated"><strong class="jv hj"> slicingParams </strong> : Slicing表示如何将事件分组到幻灯片中，并在查询时进行控制。<strong class="jv hj"> dimensionNames </strong>参数获取一个维度列表，您可以用它来分割您的数据。在上面的查询中，我们使用虚拟维度度量。<em class="ju">请记住，目前您只能使用string类型的维度对数据进行切片。将来，将支持使用数字维度对数据进行切片。</em></li><li id="e041" class="ks kt hi jv b jw lb jz lc kp ld kq le kr lf ko kx ky kz la bi translated"><strong class="jv hj"> timeseriesParams </strong>:这些参数控制在异常检测和将事件聚合成每个切片的时间序列的过程中使用多少数据。<strong class="jv hj"> <em class="ju">预测历史</em> </strong> <em class="ju"> </em>参数是以秒为单位的时间量，表示异常查询时我们在时间序列中包含了多少个点。<strong class="jv hj"> <em class="ju">粒度</em> </strong> <em class="ju"> </em>参数代表连续时间序列点之间的固定距离。这可以调整为较低的值，以捕捉重复出现的模式。它还隐式表示以秒为单位的聚合窗口时段的宽度。<strong class="jv hj"> <em class="ju">指标</em> </strong> <em class="ju"> </em>是数值型的<em class="ju"> </em>参数<em class="ju"> </em>，其值用于聚合。本质上，这是用户查询异常的维度。</li><li id="7397" class="ks kt hi jv b jw lb jz lc kp ld kq le kr lf ko kx ky kz la bi translated"><strong class="jv hj"> forecastParams </strong>:这些参数控制灵敏度、季节性和水平窗口等设置。敏感度指定异常检测过程的敏感度。它的值必须在(0.0，0.1)区间内。较低的值表示敏感度较低，导致异常值较低，随着过程变得非常敏感，增加该值会导致异常值较高。noiseThreshold表示给定切片在检测时间的预期值和实际值之间的最小差异。</li></ul><blockquote class="jp jq jr"><p id="89a5" class="js jt ju jv b jw jx ij jy jz ka im kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">注意:有更多的参数可用于创建查询负载。有关可用参数的完整列表，请查看参考资料部分。我只描述了上面代码中使用的一些。</p></blockquote><p id="9cbc" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">下面是如何将原始事件时间序列转换为新的时间序列形式，其中属性值已按360秒的时间段进行了聚合。出于说明目的，它显示了所有属性，但实际上时间序列将只包含查询有效负载中的<code class="du mq mr ms mh b">metric</code>字段中使用的维度。</p><figure class="iz ja jb jc fd jd er es paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="er es mv"><img src="../Images/64dbfb453b058068185b184c10dbca93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OzkKlYAZckC7OSMKFDfGuA.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">原始事件到聚合时间序列转换的示例</figcaption></figure><p id="8ef5" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">这是异常的查询结果，您可以看到已经创建的内部时间序列。您也可以关闭这个历史记录，只在有效负载中输出异常结果。时间戳处的这些值是在查询有效负载中设置了<code class="du mq mr ms mh b">granularity</code>值窗口的<code class="du mq mr ms mh b">temperature</code>的聚合值。用户可以对每个异常查询进行定制和更改，以适应季节性和业务需求。</p><pre class="iz ja jb jc fd mg mh mi mj aw mk bi"><span id="0467" class="ml lk hi mh b fi mm mn l mo mp">{'name': 'projects/pnishit-mlai/datasets/sensor_data_test',<br/> 'slices': [{'dimensions': [{'name': 'measure', 'stringVal': 'LTTH'}],<br/>   'history': {'point': [{'time': '2021-06-24T15:00:00Z', 'value': 2995.96},<br/>     {'time': '2021-06-24T15:30:00Z', 'value': 3180.5099999999998},<br/>     {'time': '2021-06-24T16:00:00Z', 'value': 3330.51},<br/>     {'time': '2021-06-24T16:30:00Z', 'value': 3468.07},<br/>     {'time': '2021-06-24T17:00:00Z', 'value': 3583.22},<br/>     {'time': '2021-06-24T17:30:00Z', 'value': 3672.84},<br/>     {'time': '2021-06-24T18:00:00Z', 'value': 3744.3500000000004},<br/>     {'time': '2021-06-24T18:30:00Z', 'value': 3813.61},<br/>     {'time': '2021-06-24T19:00:00Z', 'value': 3624.17},<br/>     {'time': '2021-06-24T19:30:00Z', 'value': 3935.7699999999995},<br/>     {'time': '2021-06-24T20:00:00Z', 'value': 3978.78},<br/>     {'time': '2021-06-24T20:30:00Z', 'value': 4022.67},<br/>     {'time': '2021-06-24T21:00:00Z', 'value': 4064},<br/>     {'time': '2021-06-24T21:30:00Z', 'value': 4103.86},<br/>     {'time': '2021-06-24T22:00:00Z', 'value': 4141.099999999999},<br/>     {'time': '2021-06-24T22:30:00Z', 'value': 4171.9800000000005},<br/>     {'time': '2021-06-24T23:00:00Z', 'value': 4206.53},<br/>     {'time': '2021-06-24T23:30:00Z', 'value': 4226.34},<br/>     {'time': '2021-06-25T00:00:00Z', 'value': 4172.81},<br/>     {'time': '2021-06-25T00:30:00Z', 'value': 4085.0400000000004},<br/>     {'time': '2021-06-25T01:00:00Z', 'value': 4013.5500000000006},<br/>     {'time': '2021-06-25T01:30:00Z', 'value': 3981.5299999999997},<br/>     {'time': '2021-06-25T02:00:00Z', 'value': 3955.63},<br/>     {'time': '2021-06-25T02:30:00Z', 'value': 3906.63},<br/>     {'time': '2021-06-25T03:00:00Z', 'value': 3846.0699999999997},<br/>     {'time': '2021-06-25T03:30:00Z', 'value': 3796.7999999999997},<br/>     {'time': '2021-06-25T04:00:00Z', 'value': 3758.2000000000003},<br/>     {'time': '2021-06-25T04:30:00Z', 'value': 3725.0299999999997},<br/>     {'time': '2021-06-25T05:00:00Z', 'value': 3692.67},<br/>     {'time': '2021-06-25T05:30:00Z', 'value': 3660.129999999999},<br/>     {'time': '2021-06-25T06:00:00Z', 'value': 3633.4300000000003},<br/>     {'time': '2021-06-25T06:30:00Z', 'value': 3610.93},<br/>     {'time': '2021-06-25T07:00:00Z', 'value': 3592.7699999999995},<br/>     {'time': '2021-06-25T07:30:00Z', 'value': 3568.870000000001},<br/>     {'time': '2021-06-25T08:00:00Z', 'value': 3548.359999999999},<br/>     {'time': '2021-06-25T08:30:00Z', 'value': 3508.33},<br/>     {'time': '2021-06-25T09:00:00Z', 'value': 3470.5899999999997},<br/>     {'time': '2021-06-25T09:30:00Z', 'value': 3436.9699999999993},<br/>     {'time': '2021-06-25T10:00:00Z', 'value': 3408.55},<br/>     {'time': '2021-06-25T10:30:00Z', 'value': 3391.9299999999994},<br/>     {'time': '2021-06-25T11:00:00Z', 'value': 3410.7200000000003},<br/>     {'time': '2021-06-25T11:30:00Z', 'value': 3450.05},<br/>     {'time': '2021-06-25T12:00:00Z', 'value': 3515.57},<br/>     {'time': '2021-06-25T12:30:00Z', 'value': 3603.83},<br/>     {'time': '2021-06-25T13:00:00Z', 'value': 3692.41},<br/>     {'time': '2021-06-25T13:30:00Z', 'value': 3773.9999999999995},<br/>     {'time': '2021-06-25T14:00:00Z', 'value': 3853.7},<br/>     {'time': '2021-06-25T14:30:00Z', 'value': 3923.61},<br/>     {'time': '2021-06-25T15:00:00Z', 'value': 3977.2799999999997},<br/>     {'time': '2021-06-25T15:30:00Z', 'value': 4009.2700000000004},<br/>     {'time': '2021-06-25T16:00:00Z', 'value': 4024.3199999999997},<br/>     {'time': '2021-06-25T16:30:00Z', 'value': 4041.01},<br/>     {'time': '2021-06-25T17:00:00Z', 'value': 4076.29},<br/>     {'time': '2021-06-25T17:30:00Z', 'value': 4104.429999999999},<br/>     {'time': '2021-06-25T18:00:00Z', 'value': 4120.57},<br/>     {'time': '2021-06-25T18:30:00Z', 'value': 4146.42},<br/>     {'time': '2021-06-25T19:00:00Z', 'value': 4178.8099999999995},<br/>     {'time': '2021-06-25T19:30:00Z', 'value': 4210.83},<br/>     {'time': '2021-06-25T20:00:00Z', 'value': 4245.74},<br/>     {'time': '2021-06-25T20:30:00Z', 'value': 4275.35},<br/>     {'time': '2021-06-25T21:00:00Z', 'value': 4296.56},<br/>     {'time': '2021-06-25T21:30:00Z', 'value': 4301.129999999999},<br/>     {'time': '2021-06-25T22:00:00Z', 'value': 4299.98},<br/>     {'time': '2021-06-25T22:30:00Z', 'value': 4319.23},<br/>     {'time': '2021-06-25T23:00:00Z', 'value': 4345.3},<br/>     {'time': '2021-06-25T23:30:00Z', 'value': 4326.54},<br/>     {'time': '2021-06-26T00:00:00Z', 'value': 4273.6},<br/>     {'time': '2021-06-26T00:30:00Z', 'value': 4212.950000000001},<br/>     {'time': '2021-06-26T01:00:00Z', 'value': 4156.549999999999},<br/>     {'time': '2021-06-26T01:30:00Z', 'value': 4116.820000000001},<br/>     {'time': '2021-06-26T02:00:00Z', 'value': 4081.8199999999997},<br/>     {'time': '2021-06-26T02:30:00Z', 'value': 4049.9899999999993},<br/>     {'time': '2021-06-26T03:00:00Z', 'value': 4022},<br/>     {'time': '2021-06-26T03:30:00Z', 'value': 4048.0999999999995},<br/>     {'time': '2021-06-26T04:00:00Z', 'value': 3968.9299999999994},<br/>     {'time': '2021-06-26T04:30:00Z', 'value': 3948.3800000000006},<br/>     {'time': '2021-06-26T05:00:00Z', 'value': 3927.44},<br/>     {'time': '2021-06-26T05:30:00Z', 'value': 3909.3899999999994},<br/>     {'time': '2021-06-26T06:00:00Z', 'value': 3895.73},<br/>     {'time': '2021-06-26T06:30:00Z', 'value': 3883.1},<br/>     {'time': '2021-06-26T07:00:00Z', 'value': 3882.58},<br/>     {'time': '2021-06-26T07:30:00Z', 'value': 3893.34},<br/>     {'time': '2021-06-26T08:00:00Z', 'value': 3891.4699999999993},<br/>     {'time': '2021-06-26T08:30:00Z', 'value': 3894.45},<br/>     {'time': '2021-06-26T09:00:00Z', 'value': 3896.4600000000005},<br/>     {'time': '2021-06-26T09:30:00Z', 'value': 3953.680000000001},<br/>     {'time': '2021-06-26T10:00:00Z', 'value': 3901.069999999999},<br/>     {'time': '2021-06-26T10:30:00Z', 'value': 3907.5699999999997},<br/>     {'time': '2021-06-26T11:00:00Z', 'value': 3929.04},<br/>     {'time': '2021-06-26T11:30:00Z', 'value': 3968.5},<br/>     {'time': '2021-06-26T12:00:00Z', 'value': 4018.16},<br/>     {'time': '2021-06-26T12:30:00Z', 'value': 4077.7299999999996},<br/>     {'time': '2021-06-26T13:00:00Z', 'value': 4134.67},<br/>     {'time': '2021-06-26T13:30:00Z', 'value': 4171.8099999999995},<br/>     {'time': '2021-06-26T14:00:00Z', 'value': 4189.67},<br/>     {'time': '2021-06-26T14:30:00Z', 'value': 4216.96},<br/>     {'time': '2021-06-26T15:00:00Z', 'value': 4262.1900000000005},<br/>     {'time': '2021-06-26T15:30:00Z', 'value': 4305.4},<br/>     {'time': '2021-06-26T16:00:00Z', 'value': 4338.31},<br/>     {'time': '2021-06-26T16:30:00Z', 'value': 4369.320000000001},<br/>     {'time': '2021-06-26T17:00:00Z', 'value': 4403.7},<br/>     {'time': '2021-06-26T17:30:00Z', 'value': 4435.98},<br/>     {'time': '2021-06-26T18:00:00Z', 'value': 4521.87},<br/>     {'time': '2021-06-26T18:30:00Z', 'value': 4478.610000000001},<br/>     {'time': '2021-06-26T19:00:00Z', 'value': 4474.28},<br/>     {'time': '2021-06-26T19:30:00Z', 'value': 4470.839999999999},<br/>     {'time': '2021-06-26T20:00:00Z', 'value': 4482.829999999999},<br/>     {'time': '2021-06-26T20:30:00Z', 'value': 4490.8099999999995},<br/>     {'time': '2021-06-26T21:00:00Z', 'value': 4490.0199999999995},<br/>     {'time': '2021-06-26T21:30:00Z', 'value': 4480.2},<br/>     {'time': '2021-06-26T22:00:00Z', 'value': 4460.11},<br/>     {'time': '2021-06-26T22:30:00Z', 'value': 4445.86},<br/>     {'time': '2021-06-26T23:00:00Z', 'value': 4429.5},<br/>     {'time': '2021-06-26T23:30:00Z', 'value': 4411.9},<br/>     {'time': '2021-06-27T00:00:00Z', 'value': 4398.25},<br/>     {'time': '2021-06-27T00:30:00Z', 'value': 4372.870000000001},<br/>     {'time': '2021-06-27T01:00:00Z', 'value': 4341.87},<br/>     {'time': '2021-06-27T01:30:00Z', 'value': 4368.8},<br/>     {'time': '2021-06-27T02:00:00Z', 'value': 4283.039999999999},<br/>     {'time': '2021-06-27T02:30:00Z', 'value': 4259.9800000000005},<br/>     {'time': '2021-06-27T03:00:00Z', 'value': 4239.389999999999},<br/>     {'time': '2021-06-27T03:30:00Z', 'value': 4229.23},<br/>     {'time': '2021-06-27T04:00:00Z', 'value': 4223.23},<br/>     {'time': '2021-06-27T04:30:00Z', 'value': 4216.63},<br/>     {'time': '2021-06-27T05:00:00Z', 'value': 4203.12},<br/>     {'time': '2021-06-27T05:30:00Z', 'value': 4180.82},<br/>     {'time': '2021-06-27T06:00:00Z', 'value': 4169.47},<br/>     {'time': '2021-06-27T06:30:00Z', 'value': 4152.599999999999},<br/>     {'time': '2021-06-27T07:00:00Z', 'value': 4136.5},<br/>     {'time': '2021-06-27T07:30:00Z', 'value': 4128.530000000001},<br/>     {'time': '2021-06-27T08:00:00Z', 'value': 4119.19},<br/>     {'time': '2021-06-27T08:30:00Z', 'value': 4100.19},<br/>     {'time': '2021-06-27T09:00:00Z', 'value': 4085.1599999999994},<br/>     {'time': '2021-06-27T09:30:00Z', 'value': 4141.089999999999},<br/>     {'time': '2021-06-27T10:00:00Z', 'value': 4097.710000000001},<br/>     {'time': '2021-06-27T10:30:00Z', 'value': 4102.32},<br/>     {'time': '2021-06-27T11:00:00Z', 'value': 4105.12},<br/>     {'time': '2021-06-27T11:30:00Z', 'value': 4118.86},<br/>     {'time': '2021-06-27T12:00:00Z', 'value': 4134.59},<br/>     {'time': '2021-06-27T12:30:00Z', 'value': 4156.07},<br/>     {'time': '2021-06-27T13:00:00Z', 'value': 4184.75},<br/>     {'time': '2021-06-27T13:30:00Z', 'value': 4224.679999999999},<br/>     {'time': '2021-06-27T14:00:00Z', 'value': 4276.73},<br/>     {'time': '2021-06-27T14:30:00Z', 'value': 4324.28},<br/>     {'time': '2021-06-27T15:00:00Z', 'value': 4365.74}]},<br/>   'forecast': {'point': [{'time': '2021-06-27T15:00:00Z',<br/>      'value': 4910.465311007107}]},<br/>   'detectionPointActual': 4365.74,<br/>   'detectionPointForecast': 4910.465311007107,<br/>   'expectedDeviation': 310.28363664899683,<br/>   'anomalyScore': 1.511934641477489,<br/>   'status': {}}]}​</span></pre><p id="5f8d" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">结果输出包含大量信息。首先，我们看到API基于查询负载构建的时间序列。我们还可以看到指标在检测时的预测值和实际值。两条主要信息是下面描述的<code class="du mq mr ms mh b">expectedDeviation</code>和<code class="du mq mr ms mh b">anomalyScore</code>。您可以使用这些来最终计算数据在给定检测时间内的异常情况。由于异常分值大于1.0，并且预期温度值和实际温度值之间的差异非常显著，因此我们会将此视为给定检测时间的异常。</p><p id="a383" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">对于每个查询，结果中几乎没有什么东西。</p><ul class=""><li id="a912" class="ks kt hi jv b jw jx jz ka kp ku kq kv kr kw ko kx ky kz la bi translated"><strong class="jv hj"> detectionPointActual </strong>这是您查询的timeseries属性的值(在本例中，度量=温度)。这是<code class="du mq mr ms mh b">detectionTime</code>的实际值(汇总)。</li><li id="17af" class="ks kt hi jv b jw lb jz lc kp ld kq le kr lf ko kx ky kz la bi translated"><strong class="jv hj"> detectionPointForecast </strong>是timeseries属性的“检测时间”的预测值。</li><li id="221e" class="ks kt hi jv b jw lb jz lc kp ld kq le kr lf ko kx ky kz la bi translated"><strong class="jv hj">期望偏差</strong>表示预测值的置信水平。它指定与API预测值的绝对偏差。</li><li id="b7c6" class="ks kt hi jv b jw lb jz lc kp ld kq le kr lf ko kx ky kz la bi translated"><strong class="jv hj"> anomalyScore </strong>你可以认为这是<code class="du mq mr ms mh b">detetionTime</code>时预测值与实际值的实际偏差。如果这个值更高，那么我们认为切片是异常的。换句话说，这个分数表明实际偏差与预期偏差有多远。</li></ul><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es mw"><img src="../Images/eb31c2e997c771ded6e9a6fd07e4574c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*VutlfSfSbSbauUVLSfFhEg.png"/></div></figure><p id="0ec9" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">一般来说，低于1.0的分数反映了切片历史中常见的变化，而高于1.0的分数应引起注意，分数越高表示异常越严重。这个结果可以在下游应用程序中用于商业目的。</p><blockquote class="jp jq jr"><p id="3e3c" class="js jt ju jv b jw jx ij jy jz ka im kb kc kd ke kf kg kh ki kj kk kl km kn ko hb bi translated">同样，解释异常得分和预期偏差是相对的，可以依赖于用例，因此导致一个用例异常的特定值可能不是其他用例的异常。</p></blockquote><p id="9c08" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">如您所见，无需任何培训或定制建模，即可轻松快速地进行实时异常检测。数据集准备就绪后，用户可以快速对其进行分析，以进行异常检测和大规模低延迟预测。</p><p id="e4c7" class="pw-post-body-paragraph js jt hi jv b jw jx ij jy jz ka im kb kp kd ke kf kq kh ki kj kr kl km kn ko hb bi translated">在本教程中，我们介绍了如何从历史数据集创建数据集，以及如何查询异常和时间序列预测。在本博客的下一部分，我将介绍如何以实时流的方式向现有数据集添加数据，并对其进行检测。敬请关注第二部分</p><h1 id="3efe" class="lj lk hi bd ll lm ln lo lp lq lr ls lt io lu ip lv ir lw is lx iu ly iv lz ma bi translated"><strong class="ak">资源</strong></h1><ul class=""><li id="0148" class="ks kt hi jv b jw mb jz mc kp mx kq my kr mz ko kx ky kz la bi translated"><a class="ae jo" href="https://cloud.google.com/timeseries-insights" rel="noopener ugc nofollow" target="_blank"> Timeseries Insights API官方文档</a></li><li id="a48a" class="ks kt hi jv b jw lb jz lc kp ld kq le kr lf ko kx ky kz la bi translated"><a class="ae jo" href="https://cloud.google.com/timeseries-insights/docs/overview" rel="noopener ugc nofollow" target="_blank">产品概述页面</a></li><li id="9c77" class="ks kt hi jv b jw lb jz lc kp ld kq le kr lf ko kx ky kz la bi translated"><a class="ae jo" href="https://cloud.google.com/timeseries-insights/docs/getting-started" rel="noopener ugc nofollow" target="_blank">使用API前的设置说明</a></li><li id="9844" class="ks kt hi jv b jw lb jz lc kp ld kq le kr lf ko kx ky kz la bi translated"><a class="ae jo" href="https://cloud.google.com/timeseries-insights/docs/tutorial" rel="noopener ugc nofollow" target="_blank"> API教程</a></li><li id="d124" class="ks kt hi jv b jw lb jz lc kp ld kq le kr lf ko kx ky kz la bi translated"><a class="ae jo" href="https://cloud.google.com/timeseries-insights/docs/query-building-guide" rel="noopener ugc nofollow" target="_blank"> API查询构建指南</a></li><li id="16d2" class="ks kt hi jv b jw lb jz lc kp ld kq le kr lf ko kx ky kz la bi translated">端到端笔记本和<a class="ae jo" href="https://github.com/nishitpatel01/google-cloud/tree/main/AI%20%26%20Machine%20Learning/01%20-%20Pre-built%20ML%20APIs" rel="noopener ugc nofollow" target="_blank"> github </a>上的代码</li></ul></div></div>    
</body>
</html>