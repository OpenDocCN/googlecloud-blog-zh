<html>
<head>
<title>Minimize Downtime of Cloud Storage when Migrating between Buckets via Transfer Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过传输服务在存储桶之间迁移时，最大限度地减少云存储的停机时间</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/minimize-downtime-of-cloud-storage-when-migrating-between-buckets-via-transfer-service-d28d2cdd4a21?source=collection_archive---------4-----------------------#2022-12-26">https://medium.com/google-cloud/minimize-downtime-of-cloud-storage-when-migrating-between-buckets-via-transfer-service-d28d2cdd4a21?source=collection_archive---------4-----------------------#2022-12-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9053315d0639cde0485de38fe4520701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nsFPrL2N4ejLKzpY"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">泰勒·维克在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="cba0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">传输服务(以前称为存储传输服务或STS)是GCP的一项服务，允许将数据从本地或其他云提供商或POSIX文件系统传输到云存储。</p><p id="61a0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从TB/PB大小的活动云存储桶中传输数据可能需要数天时间，并导致应用程序在桶上读取或写入数据时出现大量停机时间。如果在传输数据时存储桶上的写入未被阻止，传输服务将不会考虑在作业开始后添加的任何要传输的数据。</p><p id="d6c4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本帖中，我们将探讨通过传输服务在云存储桶之间传输数据的方法，减少GCS桶停机时间，而不使传输过程复杂化。我们开始吧！</p><h1 id="43da" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">先决条件</h1><ul class=""><li id="129f" class="kr ks hi ix b iy kt jc ku jg kv jk kw jo kx js ky kz la lb bi translated">源云存储桶需要<a class="ae iu" href="https://cloud.google.com/storage-transfer/docs/source-cloud-storage#required_permissions" rel="noopener ugc nofollow" target="_blank"> <em class="lc"> IAM权限</em> </a>。</li><li id="5647" class="kr ks hi ix b iy ld jc le jg lf jk lg jo lh js ky kz la lb bi translated">具有所需<a class="ae iu" href="https://cloud.google.com/storage-transfer/docs/sink-cloud-storage#required_permissions" rel="noopener ugc nofollow" target="_blank"> <em class="lc"> IAM权限</em> </a>的目的云存储桶。</li></ul><h1 id="9049" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">设置传输服务</h1><blockquote class="li lj lk"><p id="4d30" class="iv iw lc ix b iy iz ja jb jc jd je jf ll jh ji jj lm jl jm jn ln jp jq jr js hb bi translated"><strong class="ix hj">步骤1:种子转移</strong></p></blockquote><p id="3c27" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在此步骤中，我们将<a class="ae iu" href="https://cloud.google.com/storage-transfer/docs/create-transfers#create_a_transfer" rel="noopener ugc nofollow" target="_blank"> <em class="lc">创建一个传输服务作业</em> </a>，用于将数据从源桶传输到目的桶。<strong class="ix hj"> <em class="lc">在此传输期间，我们不会阻止对原始源存储桶的任何读/写操作。</em> </strong></p><p id="ad8c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">传输作业开始后添加到源存储桶的任何数据都不会被考虑传输。</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/f25d8a3fe9cdb2fee00acf9a151b0194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dkj6xplXHoRhB_WiPlt_TQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">种子转移服务作业</figcaption></figure><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/287120cc9c04fd638ae64279c806f2f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KbNDnCws0EfaVyDJQFB1mg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">在传输过程中向存储桶添加了新文件</figcaption></figure><p id="4eec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如上所示，添加到源存储桶的2个新文件不考虑传输，因为它们是在传输服务作业已经启动之后创建的。</p><p id="1b33" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">作业完成后，在作业开始时间之前创建的源存储桶中的所有可用数据都将传输到目标存储桶。</p><blockquote class="li lj lk"><p id="1de1" class="iv iw lc ix b iy iz ja jb jc jd je jf ll jh ji jj lm jl jm jn ln jp jq jr js hb bi translated"><strong class="ix hj">步骤2:同步传输</strong></p></blockquote><p id="2c3d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在此步骤中，我们将对种子传输作业开始后更改/添加的数据执行增量加载。<strong class="ix hj">默认情况下，存储转移服务转移是增量的。</strong>由于大部分数据已经作为<em class="lc">步骤1(种子传输)</em>的一部分进行了传输，根据添加的数据量，此传输将花费较少的时间。</p><p id="65b1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">在此传输期间，我们将阻止对源存储桶的所有写入。根据需要，也可以阻止读取操作。</strong></p><p id="eddb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，列出对象可能是一个瓶颈，如果有很多文件，会导致额外的时间。</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/18c3cc5715b9bfa0c44f96425a5ce0b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_PPjfto93F_9UYZlU0fxfg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">同步传输服务作业</figcaption></figure><blockquote class="li lj lk"><p id="4d60" class="iv iw lc ix b iy iz ja jb jc jd je jf ll jh ji jj lm jl jm jn ln jp jq jr js hb bi translated"><strong class="ix hj">第三步:更新上下游应用</strong></p></blockquote><p id="f80b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">更新对源存储桶进行读/写的所有应用程序，以指向新的存储桶(在这种情况下，目标存储桶用于传输作业)。</p><h1 id="d543" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">影响传输速度的因素</h1><ul class=""><li id="dae9" class="kr ks hi ix b iy kt jc ku jg kv jk kw jo kx js ky kz la lb bi translated">如果有许多小对象(大小为KiB)，则传输作业受QPS限制，即每个传输作业每秒最多传输1000个任务(对象)，这会增加传输时间。</li><li id="7fcb" class="kr ks hi ix b iy ld jc le jg lf jk lg jo lh js ky kz la lb bi translated">如果对象太大，带宽就会成为瓶颈。<br/> <em class="lc">带宽限制在地区级别设定，并在项目间公平分配。</em></li><li id="9b49" class="kr ks hi ix b iy ld jc le jg lf jk lg jo lh js ky kz la lb bi translated">对于GCS到GCS的传输，如果源和目标的位置、存储类别和加密密钥相同，则不会重写数据，只会重写元数据。因此，它将非常快，只到QPS。</li></ul><h1 id="2164" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="7c6d" class="pw-post-body-paragraph iv iw hi ix b iy kt ja jb jc ku je jf jg lv ji jj jk lw jm jn jo lx jq jr js hb bi translated">在本文中，我们讨论了如何通过传输服务在传输过程中保持数据完整和同步，从而最大限度地减少云存储的停机时间。我们看到，云存储桶上的写入将仅在<em class="lc">同步传输(步骤2) </em>时被阻止。稍后，我们还讨论了影响传输速度的因素以及应该预先考虑的因素。</p><h1 id="04d9" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">参考</h1><ul class=""><li id="377b" class="kr ks hi ix b iy kt jc ku jg kv jk kw jo kx js ky kz la lb bi translated"><a class="ae iu" href="https://cloud.google.com/storage-transfer/docs/cloud-storage-to-cloud-storage" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/storage-transfer/docs/云存储到云存储</a></li><li id="fa40" class="kr ks hi ix b iy ld jc le jg lf jk lg jo lh js ky kz la lb bi translated"><a class="ae iu" href="https://cloud.google.com/storage-transfer/docs/transfer-differences" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/storage-transfer/docs/transfer-differences</a></li><li id="05e5" class="kr ks hi ix b iy ld jc le jg lf jk lg jo lh js ky kz la lb bi translated"><a class="ae iu" href="https://cloud.google.com/storage-transfer/docs/create-transfers" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/storage-transfer/docs/create-transfers</a></li></ul><p id="47e7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">希望你喜欢这篇文章，并发现它有用。你可以在LinkedIn上找到我。</p></div></div>    
</body>
</html>