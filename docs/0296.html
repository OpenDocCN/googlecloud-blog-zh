<html>
<head>
<title>Use Cases and Different Ways to get Files Into Google Cloud Storage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将文件放入Google云存储的使用案例和不同方式</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/use-cases-and-a-few-different-ways-to-get-files-into-google-cloud-storage-c8dce8f4f25a?source=collection_archive---------0-----------------------#2017-05-31">https://medium.com/google-cloud/use-cases-and-a-few-different-ways-to-get-files-into-google-cloud-storage-c8dce8f4f25a?source=collection_archive---------0-----------------------#2017-05-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d0f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">包括带Firebase的AppEngine可恢复上传</em></p><p id="2976" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将分解一些与Google云存储(GCS)交互的不同方式。GCP文档陈述了以下上传数据的方式:通过UI，通过gsutil CLI工具，或者通过各种语言的JSON API。下面我将介绍几个具体的用例以及GCS入口选项的方法。</p><p id="7d4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 1。使用JSON api <br/> </strong> <em class="jd">在Google App Engine (GAE)上上传表单用例:公共上传门户(小文件)<br/> </em> <strong class="ih hj"> 2 .使用JSON api <br/> </strong> <em class="jd">在GAE上用firebase上传表单用例:公共上传门户(大文件)，手机app内上传<br/> </em> <strong class="ih hj"> 3 .gsutil命令行与cron <br/> </strong> <em class="jd">等脚本或调度程序集成用例:备份/归档、与脚本集成、迁移<br/> </em> <strong class="ih hj"> 4 .S3 / GCP兼容的文件管理程序，如Cyberduck <br/> </strong> <em class="jd">使用案例:通过桌面进行云存储管理，迁移<br/> </em> <strong class="ih hj"> 5。云函数(GCF) <br/> </strong> <em class="jd">用例:集成、桶的变化、HTTP请求<br/> </em> <strong class="ih hj"> 6。云控制台<br/> </strong> <em class="jd">用例:通过桌面、迁移进行云存储管理</em></p><h1 id="e288" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><strong class="ak"> 1。带有JSON API的应用引擎nodejs适用于较小的文件</strong></h1><p id="4757" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">你可以在GAE上启动一个小的nodejs应用程序，非常容易地直接接受较小的文件到GCS ~20MB。我从GCP github账户<a class="ae kh" href="https://github.com/GoogleCloudPlatform/nodejs-docs-samples/tree/master/appengine/storage" rel="noopener ugc nofollow" target="_blank">的the nodejs GCS示例开始。</a></p><p id="9148" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于整合20MB左右的上传，这是一个很好的解决方案。请记住，GAE背后的nginx服务器有文件上传限制。因此，如果你尝试上传大约50MB的东西，你会收到一个nginx错误:☹️</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ki"><img src="../Images/e92541e9531a272d443ea3fbbc10b960.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sj039ndwBTelX8xntq6EWw.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">Nginx文件上传错误</figcaption></figure><p id="0b33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以尝试在js文件中上传文件大小限制，但GAE背后的网络服务器仍然会有文件上传的限制。因此，如果您计划在App Engine上创建上传表单，请确保在您的UI中有一个文件大小限制。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div class="er es ky"><img src="../Images/1537dbc0b2d5ebdf60a037348ac46022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*6BVujZ7nbXnOsS4-MIQZ5Q.png"/></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">小文件的Nodejs上传表单——我可能会在某个时候关闭这个应用程序。</figcaption></figure><h1 id="fa36" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><strong class="ak"> 2。应用程序引擎节点js Firebase与JSON API和可恢复的大文件上传</strong></h1><p id="1c40" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">由于前面的例子只适用于较小的文件，我想知道我们如何解决上传较大的文件，如100MB或1GB？我从nodejs应用引擎存储示例<a class="ae kh" href="https://github.com/mkahn5/nodejs-docs-samples/tree/master/appengine/storage" rel="noopener ugc nofollow" target="_blank">开始，这里是</a>。</p><p id="8127" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在尝试用<a class="ae kh" href="https://github.com/tus" rel="noopener ugc nofollow" target="_blank"> TUS </a>在GCS API中使用<a class="ae kh" href="https://cloud.google.com/storage/docs/json_api/v1/how-tos/resumable-upload" rel="noopener ugc nofollow" target="_blank">可恢复上传</a>失败后，我向我的朋友内森@ <a class="ae kh" href="http://www.incline.digital" rel="noopener ugc nofollow" target="_blank"> www.incline.digital </a>寻求帮助，寻求另一种方法。</p><p id="94f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Nathan的帮助下，我们将可恢复上传与firebase SDK集成在一起。代码可以在这里找到<br/><a class="ae kh" href="https://github.com/mkahn5/gcloud-resumable-uploads" rel="noopener ugc nofollow" target="_blank">https://github.com/mkahn5/gcloud-resumable-uploads</a>。</p><p id="b41f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参考:<a class="ae kh" href="https://firebase.google.com/docs/storage/web/upload-files" rel="noopener ugc nofollow" target="_blank">https://firebase.google.com/docs/storage/web/upload-files</a></p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es kz"><img src="../Images/a023db42dffc37eb5d998beb2a6eee94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2n8gJvl98L9cjItVEJm0DQ.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">用户与基于Firebase的GAE上传表单的交互</figcaption></figure><p id="caaf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然没有状态栏或任何花哨的东西，这种解决方案并不十分优雅，但它确实适用于从网上上传大文件。🙌🏻</p><figure class="kj kk kl km fd kn er es paragraph-image"><div class="er es la"><img src="../Images/4c65ace9a768d1e18881fc287f1d186d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*Par6cTJvRYPhBSp5hyDgOQ.png"/></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">GAE上的可恢复文件上传表单——我可能会在某个时候关闭这个应用程序。</figcaption></figure><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lb"><img src="../Images/c116df24175df3ccb435c883aa3a4745.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vanrzndxksuBxaJ5J0o5Mw.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">Firebase UI中的GC</figcaption></figure><h1 id="d414" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><strong class="ak"> 3。来自本地或远程的gsutil</strong></h1><p id="7b77" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">gsutil使得将文件复制到云存储桶和从云存储桶复制文件变得容易</p><p id="6680" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只要确保你的工作站或远程服务器上有Google cloud SDK(<a class="ae kh" href="https://cloud.google.com/sdk/downloads" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/sdk/downloads</a>)，设置项目并认证就行了。</p><pre class="kj kk kl km fd lc ld le lf aw lg bi"><span id="1fdb" class="lh jf hi ld b fi li lj l lk ll">mkahnucf@meanstack-3-vm:~$ <strong class="ld hj">gsutil ls</strong><br/>gs://artifacts.testing-31337.appspot.com/<br/>gs://staging.testing-31337.appspot.com/<br/>gs://testing-31337-public/<br/>gs://testing-31337.appspot.com/<br/>gs://us.artifacts.testing-31337.appspot.com/<br/>gs://vm-config.testing-31337.appspot.com/<br/>gs://vm-containers.testing-31337.appspot.com/</span><span id="ea2f" class="lh jf hi ld b fi lm lj l lk ll">mkahnucf@meanstack-3-vm:~/nodejs-docs-samples/appengine/storage$ <strong class="ld hj">gsutil cp app.js gs://testing-31337-public</strong></span><span id="12c1" class="lh jf hi ld b fi lm lj l lk ll">Copying file://app.js [Content-Type=application/javascript]...</span><span id="9bd3" class="lh jf hi ld b fi lm lj l lk ll">/ [1 files][  2.7 KiB/  2.7 KiB]</span><span id="8bab" class="lh jf hi ld b fi lm lj l lk ll">Operation completed over 1 objects/2.7 KiB.</span></pre><p id="0154" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更多详情<a class="ae kh" href="https://cloud.google.com/storage/docs/quickstart-gsutil#upload_an_object_into_your_bucket" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><p id="5a35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">gsutil使自动化目录备份、同步目录中的更改、备份数据库转储变得非常容易，并且可以轻松地与应用程序或调度程序集成，将脚本文件上传到GCS。</p><p id="05de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是我的云存储桶的rsync cron和我博客上的html文件。这样，如果我决定通过www或GCS UI上传文件，我的GCS bucket和我的GCE实例之间就有了一致性。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div class="er es ln"><img src="../Images/4043355ee59104d5dd93bd8df920cda7.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*HpR3ju7gpEmlP2dRS5j1sg.png"/></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">在GCP上使用gsutil备份和同步GCS文件</figcaption></figure><pre class="kj kk kl km fd lc ld le lf aw lg bi"><span id="9241" class="lh jf hi ld b fi li lj l lk ll">root@mkahncom-instance-group-multizone-kr5q:~# crontab -l</span><span id="0e92" class="lh jf hi ld b fi lm lj l lk ll">*/2 * * * * <strong class="ld hj">gsutil rsync -r /var/www/html gs://mkahnarchive/mkahncombackup</strong></span><span id="3c03" class="lh jf hi ld b fi lm lj l lk ll">*/2 * * * * <strong class="ld hj">gsutil rsync -r gs://mkahnarchive/mkahncombackup /var/www/html</strong></span></pre><h1 id="101c" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><strong class="ak"> 4。Cyberduck (MacOS)或任何具有s3接口的应用程序</strong></h1><p id="3904" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在MacOS for GCS上使用Cyberduck享受客户端ftp类型的体验。</p><p id="3803" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Cyberduck具有非常好的oauth集成，可以连接到内置在接口中的GCS API。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div class="er es lo"><img src="../Images/2f44d849b6ae7ac6ce6b85c4fd16bb67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*LPgri-Sm3j-wo6L38OoUBw.png"/></div></figure><figure class="kj kk kl km fd kn er es paragraph-image"><div class="er es lp"><img src="../Images/98178c85212de508b516af1ed7ee03fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*wK62p4CR8ZXFF8mhleCdeg.png"/></div></figure><p id="daca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过oauth认证后，你可以浏览你所有的桶，并通过cyberduck应用程序上传。将许多目录或文件夹移动到多个存储桶中是一个不错的选择。</p><p id="b20b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更多关于赛博鸭的信息请点击这里。</p><h1 id="9098" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><strong class="ak"> 5。云功能</strong></h1><p id="b411" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">您还可以配置Google Cloud Function (GCF ),将文件从远程或本地位置上传到GCS。下面这个教程只是为了把一个目录下的文件上传到GCS。运行云函数，它压缩本地目录文件，并将压缩文件放入GCS stage bucket。</p><p id="1d67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">试教程:<br/><a class="ae kh" href="https://cloud.google.com/functions/docs/tutorials/storage" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/functions/docs/tutorials/storage</a></p><pre class="kj kk kl km fd lc ld le lf aw lg bi"><span id="781f" class="lh jf hi ld b fi li lj l lk ll">Michaels-iMac:gcf_gcs mkahnimac$ <strong class="ld hj">gcloud beta functions deploy helloGCS -stage-bucket mike-kahn-functions -trigger-bucket mikekahn-public-upload</strong><br/>Copying file:///var/folders/kq/5kq2pt090nx3ghp667nwygz80000gn/T/tmp6PXJmJ/fun.zip [Content-Type=application/zip]…<br/>- [1 files][ 634.0 B/ 634.0 B]<br/>Operation completed over 1 objects/634.0 B.<br/>Deploying function (may take a while — up to 2 minutes)…done.<br/>availableMemoryMb: 256<br/>entryPoint: helloGCS<br/>eventTrigger:<br/>eventType: providers/cloud.storage/eventTypes/object.change<br/>resource: projects/_/buckets/mikekahn-public-upload<br/>latestOperation: operations/bWlrZS1rYWhuLXBlcnNvbmFsL3VzLWNlbnRyYWwxL2hlbGxvR0NTL1VFNmhlY1RZQV9j<br/>name: projects/mike-kahn-personal/locations/us-central1/functions/helloGCS<br/>serviceAccount: mike-kahn-personal@appspot.gserviceaccount.com<br/>sourceArchiveUrl: gs://mike-kahn-functions/us-central1-helloGCS-wghzlmkeemix.zip<br/>status: READY<br/>timeout: 60s<br/>updateTime: ‘2017–05–31T03:08:05Z’</span></pre><p id="263b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您还可以使用创建的云函数来显示存储桶日志。下面显示了一个通过我的公共上传表单上传并通过控制台用户界面删除的文件。这对于发布/订阅通知或报告非常方便。</p><pre class="kj kk kl km fd lc ld le lf aw lg bi"><span id="4bb0" class="lh jf hi ld b fi li lj l lk ll">Michaels-iMac:gcf_gcs mkahnimac$ <strong class="ld hj">gcloud beta functions logs read helloGCS</strong></span><span id="93e6" class="lh jf hi ld b fi lm lj l lk ll">LEVEL  NAME      EXECUTION_ID     TIME_UTC                 LOG</span><span id="1eb5" class="lh jf hi ld b fi lm lj l lk ll">D      helloGCS  127516914299587  2017-05-31 03:46:19.412  Function execution started<br/>I      helloGCS  127516914299587  2017-05-31 03:46:19.502  File FLIGHTS BANGKOK.xlsx metadata updated.<br/>D      helloGCS  127516914299587  2017-05-31 03:46:19.523  Function execution took 113 ms, finished with status: 'ok'<br/>D      helloGCS  127581619801475  2017-05-31 18:31:00.156  Function execution started<br/>I      helloGCS  127581619801475  2017-05-31 18:31:00.379  File FLIGHTS BANGKOK.xlsx deleted.<br/>D      helloGCS  127581619801475  2017-05-31 18:31:00.478  Function execution took 323 ms, finished with status: 'ok'</span></pre><p id="cc46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于后台任务，例如GCP基础设施上的事件或HTTP应用程序上的活动的定期维护，云函数可以派上用场。点击查看如何编写和部署云功能的指南<a class="ae kh" href="https://cloud.google.com/functions/docs/how-to" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="3441" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated"><strong class="ak"> 6。云控制台UI </strong></h1><p id="2eea" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">UI对于GCS管理来说非常有用。GCP甚至为AWS上的s3桶或其他地方的S3桶上的文件提供传输服务。目前门户中缺少的一个东西是对象生命周期管理。对于不经常访问的文件或存储桶中超过一定年限的文件，这非常适合自动归档到coldline廉价对象存储。现在你只能通过gsutil或者API来修改对象的生命周期。像大多数GCP特性一样，它们从函数/API级别开始，然后进入门户(这应该是IMO的方式)，我对此很满意。我希望在未来的某个时候，对象生命周期规则能够被应用到GCP门户网站中。😃</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lq"><img src="../Images/e9a77d7d0bce186ac24b9e0e24ec6e8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b0Hm052Ci4fS4NOHsKEw5Q.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">GCS用户界面</figcaption></figure><p id="6c2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总的来说，我使用了一些GCP的例子和教程，可以用不同的方式将文件显示到GCS上。GCS非常灵活，有许多入口选项，可以很容易地集成到系统或应用程序中！2017年，对象存储的用例非常丰富，GCP使在GCS中发送和接收文件变得非常容易。</p><p id="5d85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请对我可能错过的或者我们应该探索的任何有趣的GCS用例发表评论。谢谢！</p><p id="9c65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查看<a class="ae kh" href="http://www.mkahn.com/" rel="noopener ugc nofollow" target="_blank">我的博客</a>了解更多更新。</p></div></div>    
</body>
</html>