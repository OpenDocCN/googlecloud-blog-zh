<html>
<head>
<title>BigQuery, PII, and DLP: The Perfect Match</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">BigQuery、PII和DLP:完美匹配</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/bigquery-pii-and-dlp-the-perfect-match-f771bc81a5b7?source=collection_archive---------2-----------------------#2020-01-27">https://medium.com/google-cloud/bigquery-pii-and-dlp-the-perfect-match-f771bc81a5b7?source=collection_archive---------2-----------------------#2020-01-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="34fd" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">如何在BigQuery中生成随机PII，在上面运行DLP并在DataStudio上快速看到结果</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/2d72290f9a2435f9515ca5494714a066.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SobIDo7nNB1NToyucxz3og.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">背景由<a class="ae jn" href="https://unsplash.com/@kellitungay?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">凯丽·唐盖</a>于<a class="ae jn" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="4988" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如今，关于信息保护的法规如此之多，如<a class="ae jn" href="https://www.caprivacy.org/" rel="noopener ugc nofollow" target="_blank"> CCPA </a>、<a class="ae jn" href="https://gdpr-info.eu/" rel="noopener ugc nofollow" target="_blank"> GDPR </a>、<a class="ae jn" href="https://www.hhs.gov/hipaa/index.html" rel="noopener ugc nofollow" target="_blank"> HIPAA </a>，而且还有许多新的法规即将出台，因此很难与随之而来的所有法规保持同步。我们不能再忽视它了，因此找到一种处理它的方法是必须的。</p><p id="4e86" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae jn" href="https://cloud.google.com/dlp/" rel="noopener ugc nofollow" target="_blank">Google Cloud Data Loss Prevention</a>通过自动发现各处的敏感数据，帮助您了解这些法规的皮毛。</p><p id="539e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">总的来说，数据丢失防护(DLP)是一个广泛的领域，具有许多出色的功能。我们不会在这里讨论DLP的细节，但是在其他地方可以找到大量关于它的优秀文献。我们要看的是<code class="du kk kl km kn b">Google Cloud DLP</code>和<code class="du kk kl km kn b">BigQuery</code>的整合。</p><blockquote class="ko kp kq"><p id="3efc" class="jo jp kr jq b jr js ij jt ju jv im jw ks jy jz ka kt kc kd ke ku kg kh ki kj hb bi translated"><strong class="jq hj">免责声明:所有表达的观点仅代表我个人，不代表除我之外的任何人……</strong></p></blockquote></div><div class="ab cl kv kw gp kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hb hc hd he hf"><h1 id="a586" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">将PII数据加载到BigQuery</h1><p id="9669" class="pw-post-body-paragraph jo jp hi jq b jr lu ij jt ju lv im jw jx lw jz ka kb lx kd ke kf ly kh ki kj hb bi translated">首先，我们需要将一些个人身份信息(PII)加载到BigQuery中。</p><p id="0f6c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为此，我开发了一个依赖于<code class="du kk kl km kn b">Faker</code>库的Python脚本来生成随机PII。</p><div class="lz ma ez fb mb mc"><a href="https://github.com/mesmacosta/bq-fake-pii-table-creator" rel="noopener  ugc nofollow" target="_blank"><div class="md ab dw"><div class="me ab mf cl cj mg"><h2 class="bd hj fi z dy mh ea eb mi ed ef hh bi translated">mesmacosta/bq-fake-pii-table-creator</h2><div class="mj l"><h3 class="bd b fi z dy mh ea eb mi ed ef dx translated">用假pii数据创建BQ表的库。创建此库的驱动力和用例是当您需要一个…</h3></div><div class="mk l"><p class="bd b fp z dy mh ea eb mi ed ef dx translated">github.com</p></div></div><div class="ml l"><div class="mm l mn mo mp ml mq jh mc"/></div></div></a></div><blockquote class="ko kp kq"><p id="8f94" class="jo jp kr jq b jr js ij jt ju jv im jw ks jy jz ka kt kc kd ke ku kg kh ki kj hb bi translated">该脚本是在MIT许可下授权的，所以可以随意获取并按照说明运行。顺便说一下，欢迎投稿！</p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mr"><img src="../Images/f45f715b9b80f17e9882ecc37b719ed6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rFGfJMFKazUHGFHQo3lheg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">命令行参数</figcaption></figure><p id="8975" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是一个命令行工具，允许用户选择要创建的列数和行数、BigQuery数据集和表名。</p><p id="7976" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们看看主要代码:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">为了更好的可读性，隐藏了一些行</figcaption></figure><ul class=""><li id="33f8" class="mu mv hi jq b jr js ju jv jx mw kb mx kf my kj mz na nb nc bi translated">第8行:用提供的参数创建一个包含PII的熊猫数据帧；</li><li id="a5f2" class="mu mv hi jq b jr nd ju ne jx nf kb ng kf nh kj mz na nb nc bi translated">第12行:从DataFrame表示创建一个CSV文件；</li><li id="8d32" class="mu mv hi jq b jr nd ju ne jx nf kb ng kf nh kj mz na nb nc bi translated">第17行:将CSV文件上传到一个临时存储桶；</li><li id="36e1" class="mu mv hi jq b jr nd ju ne jx nf kb ng kf nh kj mz na nb nc bi translated">第22行:如果BigQuery数据集不存在，则创建它；</li><li id="978f" class="mu mv hi jq b jr nd ju ne jx nf kb ng kf nh kj mz na nb nc bi translated">第23行:创建一个BigQuery加载作业，将上传文件的内容发送到一个新表，并等待它完成；</li><li id="3a90" class="mu mv hi jq b jr nd ju ne jx nf kb ng kf nh kj mz na nb nc bi translated">第24行:清理临时存储桶；</li></ul><h2 id="8be9" class="ni ld hi bd le nj nk nl li nm nn no lm jx np nq lo kb nr ns lq kf nt nu ls nv bi translated">执行脚本</h2><pre class="iy iz ja jb fd nw kn nx ny aw nz bi"><span id="4eec" class="ni ld hi kn b fi oa ob l oc od"># Command line execution<br/>python main.py \<br/>--project-id your_project \<br/>--bq-dataset-name medium \<br/>--num-cols 8 \<br/>--num-rows 10000</span></pre><p id="10f5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们将运行它4次，在同一个数据集中创建4个BigQuery表。如果没有提供<code class="du kk kl km kn b">bq-table-name</code>参数，则使用随机生成的参数。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oe"><img src="../Images/5bd25a2c2e188e9fea9b906490c4dcac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MSpdNI20Gi2S3pUhz_kmvw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">脚本执行日志</figcaption></figure><blockquote class="ko kp kq"><p id="83ed" class="jo jp kr jq b jr js ij jt ju jv im jw ks jy jz ka kt kc kd ke ku kg kh ki kj hb bi translated">您还可以通过传递<code class="du kk kl km kn b">obfuscate-col-names</code>参数来运行<code class="du kk kl km kn b">bq-fake-pii-table-creator</code>脚本，通过利用该标志，我们将在后面看到DLP的重要性。</p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es of"><img src="../Images/bb2d3abd93c5fa4d42f3fa405041c121.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vXNFuLrYbwBWh77O9UiggA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">已创建BigQuery表</figcaption></figure><p id="4c55" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以看到在<code class="du kk kl km kn b">medium</code>数据集中有4个新表。</p></div><div class="ab cl kv kw gp kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hb hc hd he hf"><h1 id="90f1" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">执行DLP</h1><p id="75fe" class="pw-post-body-paragraph jo jp hi jq b jr lu ij jt ju lv im jw jx lw jz ka kb lx kd ke kf ly kh ki kj hb bi translated">通过转到<a class="ae jn" href="https://console.cloud.google.com/security/dlp" rel="noopener ugc nofollow" target="_blank"> DLP UI </a>，我们将创建任务来检查这些表。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es og"><img src="../Images/ab88da8fd6f97d2617034b1942c13da6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*yXmfcJhrwEs221uu7q0zqQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">DLP UI —输入数据面板</figcaption></figure><p id="c8cc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在第一个面板上，我们指定检查的源，这将是新创建的表。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oh"><img src="../Images/a2d34e81dbe0b1a7bf245ae53fdf030d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KXS3uagTgjoKxjGrwte4fA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">DLP UI —添加动作面板</figcaption></figure><p id="b841" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后我们指定一个动作，保存到BigQuery，这样我们以后就可以很容易地在DataStudio上看到结果。</p><blockquote class="ko kp kq"><p id="95d7" class="jo jp kr jq b jr js ij jt ju jv im jw ks jy jz ka kt kc kd ke ku kg kh ki kj hb bi translated">其他步骤被取消，因为保留了默认值。</p></blockquote><p id="6cc8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最后，我们有4个作业，每个表一个，我们可以在<a class="ae jn" href="https://console.cloud.google.com/security/dlp/landing/main/job" rel="noopener ugc nofollow" target="_blank">作业页面</a>上跟踪结果。我们将等待所有作业进入<code class="du kk kl km kn b">done</code> <strong class="jq hj">状态。</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oi"><img src="../Images/9245d731241373ec33fd208e7a5208f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5rwxVKbUNCXZzBAHn2hKlg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">DLP用户界面-作业页面</figcaption></figure><h2 id="cbda" class="ni ld hi bd le nj nk nl li nm nn no lm jx np nq lo kb nr ns lq kf nt nu ls nv bi translated">调查的结果</h2><p id="af9e" class="pw-post-body-paragraph jo jp hi jq b jr lu ij jt ju lv im jw jx lw jz ka kb lx kd ke kf ly kh ki kj hb bi translated">所有作业完成后，我们可以查看我们的DataStudio控制面板，并直观显示结果:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es oj"><img src="../Images/40faac4c8a31ecde4217bf706dbfc07e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ubP5FDclASONMok_k3cSjw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">DataStudio DLP调查结果仪表板</figcaption></figure><blockquote class="ko kp kq"><p id="c302" class="jo jp kr jq b jr js ij jt ju jv im jw ks jy jz ka kt kc kd ke ku kg kh ki kj hb bi translated">如果您想要克隆这个DLP仪表板，我使用了这篇<a class="ae jn" rel="noopener" href="/@zrs233/inspecting-and-reporting-sensitive-data-with-google-cloud-dlp-api-5ec27520c234">博客文章</a>中的模板，它就像克隆并指向您的BigQuery数据集/表一样简单。你可以相信我，当我说，字面上需要30秒来设置它！=)</p></blockquote><p id="6b06" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你还记得<code class="du kk kl km kn b">obfuscate-col-names</code> <em class="kr"> </em>国旗<em class="kr">吗？</em></p><div class="iy iz ja jb fd ab cb"><figure class="ok jc ol om on oo op paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><img src="../Images/f86a0a27f48ef74cf6eaa873c42a40d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*FLx8zeotMAusJCbY3ie-XQ.png"/></div></figure><figure class="ok jc oq om on oo op paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><img src="../Images/d5c48832411f9eb5a978a22d5b4ac3ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*H-7Xb1Dk5sQsTwz1vPN10w.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx or di os ot translated">包含虚假数据的BigQuery表、模式和预览选项卡</figcaption></figure></div><p id="8a35" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">该标志创建了非人类可读的列名，使得检查该数据变得非常困难，DLP自动在<code class="du kk kl km kn b">col_1</code>和<code class="du kk kl km kn b">col_3</code>上找到了<code class="du kk kl km kn b">EMAIL_ADDRESS</code>和<code class="du kk kl km kn b">CREDIT_CARD_NUMBER</code>类型，并且您可以看到并非所有的值都是信用卡号，您能想象手动完成吗？</p><blockquote class="ko kp kq"><p id="0f82" class="jo jp kr jq b jr js ij jt ju jv im jw ks jy jz ka kt kc kd ke ku kg kh ki kj hb bi translated">在大型组织中，尤其是在拥有数据字典的情况下，面对非人类可读的列名并不难。</p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ou"><img src="../Images/b190cae2b5024fe54e319aaf29417785.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MenQIHnf_wO5HLBwtCFlKQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><code class="du kk kl km kn b">org_incentivize_granular_web_readiness_a0cb</code>表的DLP结果</figcaption></figure><p id="d3ac" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">请记住，使用DLP时，您<a class="ae jn" href="https://cloud.google.com/dlp/pricing" rel="noopener ugc nofollow" target="_blank">要为检查的字节</a>付费，所以在大量使用DLP时，首先采取少量数据采样的策略。</p></div><div class="ab cl kv kw gp kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hb hc hd he hf"><h1 id="f79b" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">结束语</h1><p id="10c7" class="pw-post-body-paragraph jo jp hi jq b jr lu ij jt ju lv im jw jx lw jz ka kb lx kd ke kf ly kh ki kj hb bi translated">在本文中，我们介绍了如何在BigQuery中生成随机PII，并将其与DLP集成，使用户能够使用Data Studio快速分析他们的数据。敬请关注展示如何将其他系统与DLP集成的新帖子！感谢阅读。干杯！</p><h1 id="1152" class="lc ld hi bd le lf ov lh li lj ow ll lm io ox ip lo ir oy is lq iu oz iv ls lt bi translated">参考</h1><ul class=""><li id="def0" class="mu mv hi jq b jr lu ju lv jx pa kb pb kf pc kj mz na nb nc bi translated"><strong class="jq hj"> BigQuery山寨PII创作者</strong>:【https://github.com/mesmacosta/bq-fake-pii-table-creator】T4</li><li id="6028" class="mu mv hi jq b jr nd ju ne jx nf kb ng kf nh kj mz na nb nc bi translated"><strong class="jq hj"> DLP官方文件</strong>:<a class="ae jn" href="https://cloud.google.com/dlp" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/dlp</a></li></ul></div></div>    
</body>
</html>