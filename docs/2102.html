<html>
<head>
<title>Workflows Tip #20: Schedule a workflow execution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">工作流提示#20:计划工作流执行</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/workflows-tip-20-schedule-a-workflow-execution-7463782fa173?source=collection_archive---------5-----------------------#2022-02-09">https://medium.com/google-cloud/workflows-tip-20-schedule-a-workflow-execution-7463782fa173?source=collection_archive---------5-----------------------#2022-02-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9081" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">启动工作流的执行有<a class="ae jd" href="https://cloud.google.com/workflows/docs/executing-workflow" rel="noopener ugc nofollow" target="_blank">种不同的方式。在之前的文章中，我们提到过您可以</a><a class="ae jd" href="https://cloud.google.com/workflows/docs/quickstart-gcloud" rel="noopener ugc nofollow" target="_blank">使用gcloud命令行</a>工具来创建执行，您也可以使用各种<a class="ae jd" href="https://cloud.google.com/workflows/docs/quickstart-client-libraries" rel="noopener ugc nofollow" target="_blank">客户端库</a>来调用工作流，或者使用<a class="ae jd" href="https://cloud.google.com/workflows/docs/reference/executions/rest" rel="noopener ugc nofollow" target="_blank"> REST API </a>。一个工作流本身也可以调用其他工作流！</p><p id="821b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是今天，我想告诉你如何安排一个工作流程的执行。为此，我们将利用<a class="ae jd" href="https://cloud.google.com/scheduler" rel="noopener ugc nofollow" target="_blank">云调度器</a>。<a class="ae jd" href="https://cloud.google.com/workflows/docs/schedule-workflow" rel="noopener ugc nofollow" target="_blank">文档</a>实际上详细介绍了这个主题，所以一定要在那里获取所有信息。但是，我将快速浏览这些步骤，并告诉您云控制台中一个很好的新功能，它可以简化工作流的调度！</p><p id="5cfe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，您需要启用工作流和云调度程序:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="1ea7" class="jn jo hi jj b fi jp jq l jr js">gcloud services enable \ <br/>    cloudscheduler.googleapis.com \<br/>    workflows.googleapis.com</span></pre><p id="b971" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">云调度程序需要一个具有workflows.invoker角色的服务帐户，才能调用工作流:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="d326" class="jn jo hi jj b fi jp jq l jr js">gcloud iam service-accounts create workflows_caller_sa </span><span id="e55f" class="jn jo hi jj b fi jt jq l jr js">gcloud projects add-iam-policy-binding MY_PROJECT_ID \<br/>    — member serviceAccount:workflows_caller_sa@MY_PROJECT_ID.iam.gserviceaccount.com \<br/>    — role roles/workflows.invoker</span></pre><p id="b93a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在是时候创建cron作业了:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="b984" class="jn jo hi jj b fi jp jq l jr js">gcloud scheduler jobs create http every_5_minute_schedule \ <br/>    — schedule= "*/5 * * * *" \ <br/>    — uri= "https://workflowexecutions.googleapis.com/v1/projects/MY_PROJECT_ID/locations/REGION_NAME/workflows/WORKFLOW_NAME/executions" \<br/>    — message-body= "{\"argument\": \”DOUBLE_ESCAPED_JSON_STRING\"}" \<br/>    — time-zone= "America/New_York" \<br/>    — oauth-service-account-email= "workflows_caller_sa@MY_PROJECT_ID.iam.gserviceaccount.com"</span></pre><p id="531b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，您可以看到Scheduler将每5分钟运行一次(使用cron表示法)，并且它将调用Workflows REST API来创建一个新的执行。您还可以为工作流输入传递一个参数。</p><p id="48d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我今天急于提到的很酷的新功能是在云控制台中直接集成调度，作为工作流创建流程的一部分。</p><p id="1386" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，当您创建新的工作流时，您可以选择一个触发器:</p><figure class="je jf jg jh fd jv er es paragraph-image"><div class="er es ju"><img src="../Images/f48f5b91f55022eaa7c4b4d37d30dfc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/0*tDLpsdMAVv6mH3wa.jpg"/></div></figure><p id="f08c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击“添加新触发器”按钮，并选择“调度程序”。右侧将显示一个侧面板，您将能够指定要创建的计划，直接集成，而不必前往云调度程序产品部分:</p><figure class="je jf jg jh fd jv er es paragraph-image"><div class="er es jy"><img src="../Images/44039c9550dab7df30894133085535fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*33XcQW9Y7pd8vJXd.png"/></div></figure><p id="1951" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在那里，您可以指定日程安排的各种细节！很高兴看到这两个产品很好地集成在一起，简化了创建预定工作流的流程。</p></div><div class="ab cl jz ka gp kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hb hc hd he hf"><p id="bece" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kg">原载于</em><a class="ae jd" href="https://glaforge.appspot.com/article/schedule-a-workflow-execution" rel="noopener ugc nofollow" target="_blank"><em class="kg">https://glaforge.appspot.com</em></a><em class="kg">。</em></p></div></div>    
</body>
</html>