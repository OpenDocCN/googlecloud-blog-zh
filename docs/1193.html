<html>
<head>
<title>Warm Disaster recovery on Google Cloud for applications running on-premises</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Google Cloud上为内部运行的应用程序进行热灾难恢复</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/warm-disaster-recovery-on-google-cloud-for-applications-running-on-premises-7428b0f7db72?source=collection_archive---------1-----------------------#2019-11-05">https://medium.com/google-cloud/warm-disaster-recovery-on-google-cloud-for-applications-running-on-premises-7428b0f7db72?source=collection_archive---------1-----------------------#2019-11-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="56fc" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在云中烹饪</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/9377f43d894bdb07438a482764c986cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JIXsTLpWeBIBl3lY"/></div></div></figure><h1 id="5109" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">介绍</h1><p id="ad58" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated"><strong class="kd hj"> <em class="kx">【在云端做饭】</em> </strong>是一个博客和视频系列，帮助企业和开发者在Google Cloud上构建商业解决方案。在这第二个迷你系列中，我将介绍Google Cloud上的灾难恢复。当你在网上的时候，灾难是很难处理的。在这一系列的博客中，我们将详细阐述如何应对地震、停电、洪水、火灾等灾害。如果你对之前的迷你系列感兴趣，请查看<a class="ae ky" rel="noopener" href="/google-cloud/hosting-web-applications-on-google-cloud-an-overview-46f5605eb3a6">的这个</a>。</p><p id="fbf0" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">这是这个系列的计划。</p><ol class=""><li id="6903" class="le lf hi kd b ke kz kh la kk lg ko lh ks li kw lj lk ll lm bi translated"><a class="ae ky" rel="noopener" href="/google-cloud/hosting-web-applications-on-google-cloud-an-overview-87d0962931a3">灾难恢复概述</a></li><li id="be5e" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated"><a class="ae ky" rel="noopener" href="/@pvergadia/cold-disaster-recovery-on-google-cloud-for-applications-running-on-premises-114b31933d02">基于Google Cloud的本地应用冷灾难恢复</a></li><li id="42f7" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">针对本地应用程序的Google Cloud上的热灾难恢复(本文)</li><li id="22ba" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">基于Google Cloud的内部应用热灾难恢复</li><li id="315b" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">Google云中应用程序的冷灾难恢复</li><li id="d221" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">Google云中应用程序的冷灾难恢复</li><li id="6b56" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">Google云中应用程序的热灾难恢复</li><li id="833c" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">Google云中应用程序的热灾难恢复</li><li id="d7f7" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">Google Cloud上的数据灾难恢复:第1部分</li><li id="f540" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lj lk ll lm bi translated">Google Cloud上的数据灾难恢复:第2部分</li></ol><p id="098c" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">在本文中，您将学习为部署在本地的应用程序设置一个<strong class="kd hj">热灾难恢复模式</strong>。所以，继续读下去吧！</p><h1 id="97e6" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">你会学到什么</h1><ul class=""><li id="6607" class="le lf hi kd b ke kf kh ki kk ls ko lt ks lu kw lv lk ll lm bi translated">带示例的Warm DR模式</li><li id="a109" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">灾难来袭前需要采取的步骤</li><li id="6067" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">灾难发生时需要采取的步骤</li><li id="8594" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">灾难发生后需要采取的步骤</li></ul><h1 id="5ae1" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">先决条件</h1><ul class=""><li id="7920" class="le lf hi kd b ke kf kh ki kk ls ko lt ks lu kw lv lk ll lm bi translated">谷歌云的基本概念和结构，这样你就可以识别产品的名称。</li><li id="c2ca" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">继续之前，请阅读<a class="ae ky" rel="noopener" href="/google-cloud/hosting-web-applications-on-google-cloud-an-overview-87d0962931a3">概述文章</a>。</li></ul><h1 id="3fd8" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">看看这个视频</h1><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lw lx l"/></div></figure><h1 id="ae7f" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">让我们通过一个例子来学习Warm DR模式</h1><p id="ea85" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">在上一篇文章中，我们谈到了<em class="kx"/><strong class="kd hj"><em class="kx">Mane-street Art</em></strong>在内部运行他们的应用程序，并在Google Cloud上构建灾难恢复基础架构。我们看到了他们如何建立冷灾难恢复计划。</p><p id="2c7d" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">自那以后，Mane-street Art的情况发生了变化，他们现在需要设置热备用灾难恢复模式，以保持尽可能小的RTO和RPO值，而无需完全高可用性配置的工作量和费用。这意味着，为了应对灾难，他们需要一些内置的复制和冗余。</p><p id="1802" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated"><em class="kx">注意:如果您不熟悉这里使用的术语(RTO、RPO、灾难恢复模式),请查看之前的博客以获得概述。</em></p><p id="210a" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">在任何灾难恢复模式中，您都需要了解在灾难发生前需要采取什么步骤，灾难发生时会发生什么，以及灾难过去后需要发生什么。</p><h1 id="0cc7" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">Warm DR模式—它是如何工作的？</h1><h2 id="9c88" class="ly jk hi bd jl lz ma mb jp mc md me jt kk mf mg jv ko mh mi jx ks mj mk jz ml bi translated">灾难来袭前应采取的步骤</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mm"><img src="../Images/558d8023975f384624f55fb5e2452695.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tq2BQrbHr1CUZAgFH7XGvw.gif"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">温暖的博士，灾难来临前应采取的步骤</figcaption></figure><ul class=""><li id="d291" class="le lf hi kd b ke kz kh la kk lg ko lh ks li kw lv lk ll lm bi translated">创建一个VPC网络</li><li id="f170" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">配置内部网络和Google Cloud网络之间的连接</li><li id="abe2" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">将本地服务器复制到计算引擎实例。</li><li id="a8fa" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">创建web和应用服务器实例的快照</li><li id="f795" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">然后在Google cloud上创建数据库服务器的自定义映像，使用与本地相同的<strong class="kd hj">配置。</strong></li><li id="026d" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">然后使用自定义映像在google cloud中启动一个数据库实例，并为数据库和事务日志将持久磁盘连接到该实例。</li><li id="7964" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">配置数据库服务器的复制。</li><li id="1deb" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">将永久磁盘上的自动删除标志设置为<strong class="kd hj"> <em class="kx">不自动删除</em> </strong>。我们这样做是为了我们的持久磁盘不会被无意中删除，因为那将是一场灾难</li><li id="16cf" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">配置一个调度任务，为Google cloud上的数据库实例的持久磁盘创建定期快照</li><li id="cb92" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">然后，通过创建web和应用服务器来测试从快照创建实例的过程</li><li id="5a61" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">此外，创建一个脚本，每当相应的本地服务器更新时，该脚本会将更新复制到web应用程序和应用程序服务器。编写脚本来创建更新后的服务器的快照。</li><li id="d033" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">然后将云DNS配置为指向面向互联网的本地web服务。</li></ul><h2 id="2b63" class="ly jk hi bd jl lz ma mb jp mc md me jt kk mf mg jv ko mh mi jx ks mj mk jz ml bi translated">灾难来袭时应采取的措施</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mm"><img src="../Images/477636a7f997c2d1a73f09fb951e3cc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Sk14lf6Uw6IkFfj25qx_uA.gif"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">温暖博士，灾难来袭时应采取的步骤</figcaption></figure><ul class=""><li id="4b11" class="le lf hi kd b ke kz kh la kk lg ko lh ks li kw lv lk ll lm bi translated">当灾难发生时，所有街头艺术需要做的就是调整数据库服务器实例的大小，以处理生产负载。</li><li id="6c4c" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">使用web和应用服务器快照创建新的web和应用服务器实例</li><li id="0671" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">测试它是否一切正常</li><li id="56dc" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">然后，最后，将云DNS指向他们在Google Cloud上的web服务</li></ul><h2 id="3e89" class="ly jk hi bd jl lz ma mb jp mc md me jt kk mf mg jv ko mh mi jx ks mj mk jz ml bi translated">灾难过去后应采取的步骤</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mm"><img src="../Images/721346ff23bd5ddb9e090bb36c31ee8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*5ECmQeGuN445fJkj7x-34A.gif"/></div></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">温暖博士，灾难过去后要采取的步骤</figcaption></figure><p id="678d" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lb km kn ko lc kq kr ks ld ku kv kw hb bi translated">当生产环境再次在本地运行并能够支持生产工作负载时，Mane-street art必须逆转他们在故障切换期间遵循的步骤。通常是这样的:</p><ul class=""><li id="a438" class="le lf hi kd b ke kz kh la kk lg ko lh ks li kw lv lk ll lm bi translated">备份运行在Google cloud上的数据库。</li><li id="814f" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">将备份文件复制并应用到生产环境中的数据库。</li><li id="0dbf" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">阻止连接到Google Cloud中的应用程序。</li><li id="9f33" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">一种方法是通过修改防火墙规则来阻止与web服务器的连接。</li><li id="3b5c" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">从现在开始，在我们完成恢复生产环境之前，应用程序将不可用。</li><li id="8977" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">不要忘记将任何事务日志文件复制到生产环境中，并应用到生产环境中的数据库。</li><li id="55ca" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">通过在生产环境中模拟用户场景，测试应用程序是否按预期工作。</li><li id="dbea" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">将云DNS配置为指向本地web服务。</li><li id="8331" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">删除正在Google Cloud中运行的web服务器和应用服务器实例。让参考服务器保持运行。</li><li id="f65d" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">将Google cloud上的数据库服务器的大小调整回最小实例大小，以接受来自本地生产数据库的复制数据。</li><li id="52c9" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">按照特定数据库软件的说明，配置内部数据库服务器和Google Cloud中的数据库服务器之间的复制。</li></ul><h1 id="2144" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">结论</h1><p id="92fc" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">如果您正在内部运行应用程序，并且需要在不牺牲完全高可用性配置的情况下尽可能降低RTO和RPO值，那么<strong class="kd hj">热灾难恢复模式</strong>是一条不错的选择。我们学习了如何在热灾难恢复场景中从故障中恢复环境。敬请关注即将发布的文章，在这些文章中，您将了解如何建立更多对您的业务有意义的灾难恢复模式。</p><h1 id="2383" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">后续步骤</h1><ul class=""><li id="0a73" class="le lf hi kd b ke kf kh ki kk ls ko lt ks lu kw lv lk ll lm bi translated">在<a class="ae ky" href="https://medium.com/google-cloud" rel="noopener">谷歌云平台媒体</a>上关注这个博客系列。</li><li id="63ac" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">参考<a class="ae ky" href="https://cloud.google.com/solutions/dr-scenarios-planning-guide" rel="noopener ugc nofollow" target="_blank">灾难恢复解决方案</a>。</li><li id="2a38" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">关注<a class="ae ky" href="https://www.youtube.com/watch?v=pxp7uYUjH_M" rel="noopener ugc nofollow" target="_blank">获取云端烹饪</a>视频系列，订阅谷歌云平台YouTube频道</li><li id="0dea" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">想要更多的故事？查看我的<a class="ae ky" rel="noopener" href="/@pvergadia/">媒体</a>，<a class="ae ky" href="https://twitter.com/pvergadia" rel="noopener ugc nofollow" target="_blank">在twitter上关注我</a>。</li><li id="8ed5" class="le lf hi kd b ke ln kh lo kk lp ko lq ks lr kw lv lk ll lm bi translated">请和我们一起欣赏这部迷你剧，并了解更多类似的谷歌云解决方案:)</li></ul></div></div>    
</body>
</html>