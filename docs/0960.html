<html>
<head>
<title>Inspecting and Reporting Sensitive Data with Google Cloud’s DLP API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用谷歌云的DLP API检查和报告敏感数据</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/inspecting-and-reporting-sensitive-data-with-google-cloud-dlp-api-5ec27520c234?source=collection_archive---------0-----------------------#2019-04-01">https://medium.com/google-cloud/inspecting-and-reporting-sensitive-data-with-google-cloud-dlp-api-5ec27520c234?source=collection_archive---------0-----------------------#2019-04-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6e7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">TL；大卫:我是扎克。我是博客新手。让我们使用谷歌云数据丢失防护API在您的GCP环境中发现并报告PII。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="42f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi jk translated">亲爱的朋友们，欢迎来到我的第一篇博文！在我进入谷歌云的短暂时间里，我每天至少学到一百件新东西。从新的开源技术到以有趣的方式连接谷歌云服务，有时就像从消防水管喝水一样。这有助于我帮助客户创新他们的业务，但仍有许多人好奇云服务能为他们做什么。我希望挖掘我以前作为微积分导师的生活，并传播一些我一路上学到的知识。感谢您成为旅程的一部分！</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="cd07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个组织都有他们必须保护的敏感数据:从地址和信用卡号到病历和知识产权，不胜枚举。这些类型的信息通常被称为个人身份信息(PII)或受保护健康信息(PHI)。对于拥有这些数据的企业来说，保护网络只是乐趣的一半。如果一个坏演员已经在你的网络中，并开始窥探数据，会发生什么？你需要某种伪装或混淆数据的方法，使未经授权的人无法识别。</p><p id="cc76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">进入防数据丢失API </strong></p><p id="c9f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Google Cloud DLP API是一项帮助用户识别和管理其敏感数据的服务。该API拥有超过90个预训练的数据分类器，并原生集成到其他Google云服务中，如BigQuery和云存储。使用混淆技术，我们可以实现以下目标:</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/2d632789094f0bd9129c04ac425c8e21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RXYE_RdvR2V2g9nM"/></div></div></figure><p id="b786" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的同事已经有了一个很好的解决方案，那就是<a class="ae kf" href="https://cloud.google.com/solutions/automating-classification-of-data-uploaded-to-cloud-storage" rel="noopener ugc nofollow" target="_blank">使用云函数</a>建立一个分类管道。在这篇文章中，我想把这个解决方案向前推进一步，展示一旦我们发现敏感数据，我们如何在云安全指挥中心(CSCC)和Data Studio中报告我们环境中的敏感数据。</p><p id="10f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">目标</strong></p><ul class=""><li id="8d0b" class="kg kh hi ih b ii ij im in iq ki iu kj iy kk jc kl km kn ko bi translated">配置云安全指挥中心以查看调查结果和资产</li><li id="a621" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">创建BigQuery数据集来存储所有DLP结果</li><li id="b36e" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">更新您在<a class="ae kf" href="https://cloud.google.com/solutions/automating-classification-of-data-uploaded-to-cloud-storage" rel="noopener ugc nofollow" target="_blank">分类解决方案</a>中创建的云函数，以推送至CSCC和BigQuery</li><li id="eabc" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">创建Data Studio dashboard以显示来自BigQuery的DLP结果</li></ul><p id="c9f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">什么是云安全指挥中心？</strong></p><p id="6599" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">CSCC是谷歌云上的一体化安全和风险平台，帮助安全团队收集整个GCP组织的数据，以识别威胁并采取行动，以免它们出现在《纽约时报》的头版。CSCC为您的组织中存在的一切提供资产清单，向您显示PII在您的GCP环境中的位置，并与第三方工具(如Redlock、凡赛堤和Chef)集成，以检测实例漏洞和合规性政策违规。</p><p id="3756" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">什么是Data Studio？</strong></p><p id="983e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Data Studio提供了利用来自许多不同来源的数据轻松构建交互式仪表板的能力。尽管DLP API会向云安全指挥中心报告调查结果，但您很可能不会让每个副总裁或主管都可以访问GCP控制台。Data Studio允许您构建信息仪表板，您可以向更广泛的受众展示这些仪表板，让他们了解云环境中PII的当前状态。</p><p id="bae1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">检查和报告管道</strong></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ku"><img src="../Images/69f79c95e63e48a69cab6d8578556b41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iKGJdljggXFRflrW"/></div></div><figcaption class="kv kw et er es kx ky bd b be z dx translated">检查/报告管道示例</figcaption></figure><ol class=""><li id="c6ed" class="kg kh hi ih b ii ij im in iq ki iu kj iy kk jc kz km kn ko bi translated">您将数据上传到云存储、BigQuery或云数据存储等解决方案。现在，我们将关注云存储</li><li id="a73a" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kz km kn ko bi translated">我们调用数据丢失防护API，通过云调度器作业或每当新数据通过云功能被推送到GCP时，按计划检查数据</li><li id="3665" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kz km kn ko bi translated">DLP API将其发现发送给云安全指挥中心和BigQuery</li><li id="1033" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kz km kn ko bi translated">我们在Data Studio中构建了一个仪表板来展示我们在BigQuery中的发现</li></ol><p id="1a31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">配置云安全指挥中心以查看调查结果和资产</strong></p><ul class=""><li id="bd48" class="kg kh hi ih b ii ij im in iq ki iu kj iy kk jc kl km kn ko bi translated">按照以下说明<a class="ae kf" href="https://cloud.google.com/security-command-center/docs/quickstart-scc#cloud-scc-org-setup" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">此处</strong> </a>为您的组织启用云安全指挥中心</li></ul><p id="e5c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="la">注意:为了调配CSCC，您需要加入GCP组织。您可以在此处</em>  <em class="la">找到创建组织资源</em> <a class="ae kf" href="https://cloud.google.com/resource-manager/docs/quickstart-organizations" rel="noopener ugc nofollow" target="_blank"> <em class="la">的更多信息，但是如果您对设置组织资源不感兴趣，请随意跳到下一节。</em></a></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lb"><img src="../Images/00955845e55ff0d86c2c88cb16e4338b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*ws3cQ00AmaH2CNMenF7rJQ.png"/></div><figcaption class="kv kw et er es kx ky bd b be z dx translated">CSCC DLP概述示例</figcaption></figure><p id="7f96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">创建BigQuery数据集以存储所有DLP结果</strong></p><ul class=""><li id="5653" class="kg kh hi ih b ii ij im in iq ki iu kj iy kk jc kl km kn ko bi translated">打开<a class="ae kf" href="https://console.cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> BigQuery UI </strong> </a></li><li id="f0c2" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">在<em class="la">资源</em>下，选择您的项目ID，然后选择<em class="la">创建数据集</em></li><li id="fde6" class="kg kh hi ih b ii kp im kq iq kr iu ks iy kt jc kl km kn ko bi translated">将数据集ID设置为<strong class="ih hj"> dlp_findings </strong>，保留其他默认设置，并点击<em class="la">创建数据集</em></li></ul><p id="6bd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="la">注意:默认情况下，BigQuery将在美国创建数据集</em>。</p><p id="258c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">DLP API会将所有结果发送到该数据集中的表中。对于这个例子，我们将为每个GCP项目使用一个BigQuery表，但是为每个文件夹使用一个表也是有意义的。</p><p id="9339" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">更新您在</strong> <a class="ae kf" href="https://cloud.google.com/solutions/automating-classification-of-data-uploaded-to-cloud-storage" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">中创建的云函数分类解决方案</strong> </a> <strong class="ih hj">推送到CSCC和BigQuery </strong></p><p id="f9a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦您完成了分类解决方案，请重新访问您创建的云函数，并用这个更新的<a class="ae kf" href="https://github.com/zsais/gcp-dlp/blob/master/classify_dlp.py" rel="noopener ugc nofollow" target="_blank">版本</a>替换代码。让我们浏览一下我的更新:</p><pre class="ju jv jw jx fd lc ld le lf aw lg bi"><span id="23a8" class="lh li hi ld b fi lj lk l ll lm">PROJECT_ID = ‘[PROJECT_ID_FOR_DLP_FINDINGS]’</span><span id="9e1f" class="lh li hi ld b fi ln lk l ll lm">DATASET_ID = ‘[DATASET_ID_FOR_DLP_FINDINGS]’</span><span id="3aaa" class="lh li hi ld b fi ln lk l ll lm">TABLE_ID = ‘[TABLE_ID_FOR_DLP_FINDINGS]’</span></pre><p id="e79a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将在这里设置在上一节中创建的BigQuery数据集和表的位置。我们所有的发现都会放在这里。</p><pre class="ju jv jw jx fd lc ld le lf aw lg bi"><span id="e461" class="lh li hi ld b fi lj lk l ll lm">{ <br/>  ‘save_findings’: { <br/>    ‘output_config’: { <br/>      ‘table’: { <br/>        ‘project_id’: PROJECT_ID,<br/>        ‘dataset_id’: DATASET_ID, <br/>        ‘table_id’: TABLE_ID <br/>      }<br/>    }<br/>  }<br/>}, { <br/>  ‘publish_summary_to_cscc’: {} <br/>}</span></pre><p id="1573" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们添加新操作的地方，以将我们的DLP发现推送到CSCC和BigQuery。</p><p id="5c45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以选择自己进行的其他更新可能是扩大我们的搜索半径，并在<em class="la"> INFO_TYPES中添加类型<em class="la">'</em><strong class="ih hj"><em class="la">ALL _ BASIC '</em></strong><em class="la"/>。</em></p><p id="3f3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">保存更新后，让我们将相同的文件发送到隔离区，以启动云功能触发器。</p><p id="ffe5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">创建Data Studio仪表盘，展示BigQuery的DLP调查结果</strong></p><p id="5a2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">既然我们已经扫描了我们的数据并将我们的发现存储在BigQuery中，那么最好能够可视化我们环境中存在的东西。我们可以在Data Studio中创建一个仪表板来实现这一点。</p><ul class=""><li id="8b80" class="kg kh hi ih b ii ij im in iq ki iu kj iy kk jc kl km kn ko bi translated">导航到<a class="ae kf" href="https://datastudio.google.com/open/1apyxLx38mMtYqfed68QOA95g-ZFrG6CQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="la">此链接</em> </strong> </a>以查看我的示例仪表板。从工具栏中选择复制图标，如下所示。</li></ul><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lo"><img src="../Images/bbde80338fa59ffe6eecb9fa31caa398.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/0*hfjtNXjDDU0TXX8Y"/></div></figure><p id="f953" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="la">注意:如果这是你第一次使用Data Studio，你会被要求在继续之前点击一个协议。</em></p><p id="7d72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将选择新的数据源，即新创建的包含DLP结果的BigQuery表。</p><p id="1332" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击下拉菜单并选择<em class="la">创建新的数据源</em>。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lp"><img src="../Images/90e3ce70ce255caa5115df1c034ef622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xKoO6niCXRzQZsxGLlW7wg.png"/></div></div></figure><p id="649e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">搜索<em class="la"> BigQuery </em>并授权连接器。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lq"><img src="../Images/3c25ac7bc9a8471254e873894a686612.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bzMKvKfQl5ggBNafyE34ig.png"/></div></div></figure><p id="1dd5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选择存储DLP结果的BigQuery <em class="la">项目、数据集、</em>和<em class="la">表</em>。点击<em class="la">连接，添加到报告，</em>和<em class="la">复制报告</em>完成仪表板的创建。</p><p id="00f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在应该有一个DLP结果的漂亮图形表示，我们可以随意编辑。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lr"><img src="../Images/00c7dfcc46a5d14de247486bd22817db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jpvqXXmgicQppDRZdsSwLQ.png"/></div></div><figcaption class="kv kw et er es kx ky bd b be z dx translated">谁知道寻找PII会如此有趣？</figcaption></figure></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="4574" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">概括地说，我们讨论了发现环境中的PII/PHI为何如此重要，比较了CSCC和Data Studio仪表盘之间的差异，并修改了用于自动分类数据的<a class="ae kf" href="https://cloud.google.com/solutions/automating-classification-of-data-uploaded-to-cloud-storage" rel="noopener ugc nofollow" target="_blank">解决方案指南</a>代码，以将DLP发现发送给BigQuery和云安全指挥中心。请记住，这只是企业在云中保护数据所必须做的一点尝试。为了扩展这一功能，我们不得不加入管道自动化(通过Terraform、Ansible等)、IAM/资源策略管理(通过凡赛堤、Redlock等)等，以确保整个组织有一个安全且可重复的流程，并使用混淆技术来掩饰我们可能存储在云中的PII。视察愉快！</p></div></div>    
</body>
</html>