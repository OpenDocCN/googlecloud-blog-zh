<html>
<head>
<title>Deploying Service or Ingress on GKE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在GKE部署服务或入口</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/deploying-service-or-ingress-on-gke-59a49b134e3b?source=collection_archive---------0-----------------------#2020-06-29">https://medium.com/google-cloud/deploying-service-or-ingress-on-gke-59a49b134e3b?source=collection_archive---------0-----------------------#2020-06-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/6cb8fdfd525b6dfc2331bc3de3cfa60c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JVcNFs5vVVEVA76V5l-zew.png"/></div></div></figure><div class=""/><div class=""><h2 id="005d" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">GKE入门:具有服务和入口的端点</h2></div><p id="f0b3" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">在使用<a class="ae ke" href="https://cloud.google.com/kubernetes-engine" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu"/></a>(<a class="ae ke" href="https://cloud.google.com/kubernetes-engine" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">Google Kubernetes引擎</strong> </a>)提供了一个<a class="ae ke" href="https://kubernetes.io" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu"/></a>集群并部署了一个web应用程序(如<code class="du kf kg kh ki b">hello-kubernetes</code>)之后，我们希望通过一个<a class="ae ke" href="https://en.wikipedia.org/wiki/Web_API#Endpoints" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">端点</strong> </a>来访问它们。</p><p id="d070" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">在<a class="ae ke" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Kubernetes </strong> </a>上有两个公共路径可以用于<a class="ae ke" href="https://en.wikipedia.org/wiki/Web_API#Endpoints" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">端点</strong> </a>:</p><ul class=""><li id="80f3" class="kj kk ht jk b jl jm jo jp jr kl jv km jz kn kd ko kp kq kr bi translated">一个<code class="du kf kg kh ki b">LoadBalancer</code>类型的<a class="ae ke" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">服务</strong> </a>资源(<a class="ae ke" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> svc </strong> </a>)，它将提供一个外部<a class="ae ke" href="https://cloud.google.com/load-balancing/docs/network" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">网络负载平衡器</strong> </a>。</li><li id="2d2a" class="kj kk ht jk b jl ks jo kt jr ku jv kv jz kw kd ko kp kq kr bi translated">一个<a class="ae ke" href="https://kubernetes.io/docs/concepts/services-networking/ingress/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">入口</strong> </a>资源(<a class="ae ke" href="https://kubernetes.io/docs/concepts/services-networking/ingress/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> ing </strong> </a>)，将web流量路由到服务。</li></ul><h1 id="350d" class="kx ky ht bd kz la lb lc ld le lf lg lh iz li ja lj jc lk jd ll jf lm jg ln lo bi translated">以前的文章</h1><p id="bb5c" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">在以前的文章中，我们讨论了构建或供应<a class="ae ke" href="https://cloud.google.com/kubernetes-engine" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> GKE </strong> </a>集群。</p><h2 id="1e81" class="lu ky ht bd kz lv lw lx ld ly lz ma lh jr mb mc lj jv md me ll jz mf mg ln mh bi translated">使用云SDK进行资源调配</h2><div class="hh hi ez fb hj mi"><a rel="noopener follow" target="_blank" href="/@Joachim8675309/building-a-gke-with-cloud-sdk-99fee12bf0a6"><div class="mj ab dw"><div class="mk ab ml cl cj mm"><h2 class="bd hu fi z dy mn ea eb mo ed ef hs bi translated">使用云SDK构建GKE</h2><div class="mp l"><h3 class="bd b fi z dy mn ea eb mo ed ef dx translated">为Google Kubernetes引擎提供Google Cloud SDK</h3></div><div class="mq l"><p class="bd b fp z dy mn ea eb mo ed ef dx translated">medium.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw hp mi"/></div></div></a></div><h2 id="a343" class="lu ky ht bd kz lv lw lx ld ly lz ma lh jr mb mc lj jv md me ll jz mf mg ln mh bi translated">使用Terraform进行供应</h2><div class="hh hi ez fb hj mi"><a rel="noopener follow" target="_blank" href="/@Joachim8675309/building-gke-with-terraform-869df1cd3f41"><div class="mj ab dw"><div class="mk ab ml cl cj mm"><h2 class="bd hu fi z dy mn ea eb mo ed ef hs bi translated">用地形建造GKE</h2><div class="mp l"><h3 class="bd b fi z dy mn ea eb mo ed ef dx translated">用Terraform提供Google Kubernetes引擎</h3></div><div class="mq l"><p class="bd b fp z dy mn ea eb mo ed ef dx translated">medium.com</p></div></div><div class="mr l"><div class="mx l mt mu mv mr mw hp mi"/></div></div></a></div><h1 id="fbd1" class="kx ky ht bd kz la lb lc ld le lf lg lh iz li ja lj jc lk jd ll jf lm jg ln lo bi translated">先决条件</h1><p id="d041" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">您将需要以下工具要求:</p><ul class=""><li id="e6f5" class="kj kk ht jk b jl jm jo jp jr kl jv km jz kn kd ko kp kq kr bi translated"><a class="ae ke" href="https://cloud.google.com/sdk/install" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Google Cloud SDK </strong> </a>授权给你的谷歌账户，注册谷歌项目。在本文中，我们将使用虚构的项目<code class="du kf kg kh ki b">acme-quality-team</code>。</li><li id="f089" class="kj kk ht jk b jl ks jo kt jr ku jv kv jz kw kd ko kp kq kr bi translated"><a class="ae ke" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu"/></a>(读作<em class="my"> koob-cuttle </em>)是Kubernetes客户端cli工具，用于与集群交互并安装Kubernetes清单。</li></ul></div><div class="ab cl mz na gp nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="hb hc hd he hf"><h1 id="6030" class="kx ky ht bd kz la ng lc ld le nh lg lh iz ni ja lj jc nj jd ll jf nk jg ln lo bi translated">建设GKE集群</h1><p id="fea0" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">在之前的文章中(见上文)，有关于如何使用<a class="ae ke" href="https://cloud.google.com/sdk/install" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">Google Cloud SDK</strong></a>或<a class="ae ke" href="https://www.terraform.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Terraform </strong> </a>来配置集群的教程。你可以用它们来做这个练习。</p><p id="a97c" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">如果您想在这个练习中快速上手，可以运行下面的代码:</p><pre class="nl nm nn no fd np ki nq nr aw ns bi"><span id="38dd" class="lu ky ht ki b fi nt nu l nv nw"><strong class="ki hu">gcloud </strong>container clusters create \<br/>  <strong class="ki hu">--num-nodes</strong> 1 \<br/>  <strong class="ki hu">--region us-central1</strong> \<br/>  "a-simple-cluster"</span></pre><p id="83be" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">对于一个三节点集群，此过程大约需要3分钟，其中一个节点位于<code class="du kf kg kh ki b">us-central1</code>中的唯一可用性区域。</p><p id="6f79" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">您可以看到使用以下命令创建的集群和节点:</p><pre class="nl nm nn no fd np ki nq nr aw ns bi"><span id="69df" class="lu ky ht ki b fi nt nu l nv nw"><strong class="ki hu">gcloud</strong> container clusters list <strong class="ki hu">--filter</strong> "a-simple-cluster"<br/><strong class="ki hu">gcloud</strong> compute instances list <strong class="ki hu">--filter</strong> "a-simple-cluster"</span></pre></div><div class="ab cl mz na gp nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="hb hc hd he hf"><h1 id="1687" class="kx ky ht bd kz la ng lc ld le nh lg lh iz ni ja lj jc nj jd ll jf nk jg ln lo bi translated">具有服务资源的端点</h1><p id="8332" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">服务资源充当代理，路由部署在<a class="ae ke" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Kubernetes </strong> </a>集群内工作节点上的流量指定pod。为了创建一个<a class="ae ke" href="https://en.wikipedia.org/wiki/Web_API#Endpoints" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">端点</strong> </a>，我们将使用一个特定的服务类型<code class="du kf kg kh ki b">LoadBalancer</code>。这将在<a class="ae ke" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">谷歌云</strong> </a>中提供一个第4层负载均衡器。</p><figure class="nl nm nn no fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nx"><img src="../Images/1afaa70d580d8f9c1a45f30c2885ebff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*531E99qa7V2nDeIWdiTOxg.png"/></div></div><figcaption class="ny nz et er es oa ob bd b be z dx translated"><strong class="bd kz">负载平衡器服务类型为</strong>的服务资源</figcaption></figure><h2 id="1d1b" class="lu ky ht bd kz lv lw lx ld ly lz ma lh jr mb mc lj jv md me ll jz mf mg ln mh bi translated">部署部署控制器</h2><p id="64d2" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">我们首先需要使用<a class="ae ke" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">部署控制器</strong> </a>来部署应用程序，以便在我们的集群中部署三个pod。创建一个名为<code class="du kf kg kh ki b">hello_gke_extlb_deploy.yaml</code>的文件，内容如下:</p><figure class="nl nm nn no fd hk"><div class="bz dy l di"><div class="oc od l"/></div></figure><p id="c946" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">使用以下命令进行部署:</p><pre class="nl nm nn no fd np ki nq nr aw ns bi"><span id="0e10" class="lu ky ht ki b fi nt nu l nv nw"><strong class="ki hu">kubectl</strong> apply <strong class="ki hu">--filename</strong> hello_gke_extlb_deploy.yaml</span></pre><h2 id="3e0a" class="lu ky ht bd kz lv lw lx ld ly lz ma lh jr mb mc lj jv md me ll jz mf mg ln mh bi translated">部署服务负载平衡器类型</h2><p id="44ec" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">现在，我们部署一项服务，将流量连接到其中一个pod。</p><p id="32b8" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">创建一个名为<code class="du kf kg kh ki b">hello_gke_extlb_svc.yaml</code>的文件，内容如下:</p><figure class="nl nm nn no fd hk"><div class="bz dy l di"><div class="oc od l"/></div></figure><p id="6957" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">使用以下命令进行部署:</p><pre class="nl nm nn no fd np ki nq nr aw ns bi"><span id="95dd" class="lu ky ht ki b fi nt nu l nv nw"><strong class="ki hu">kubectl</strong> apply <strong class="ki hu">--filename</strong> hello_gke_extlb_svc.yaml</span></pre><h2 id="39a7" class="lu ky ht bd kz lv lw lx ld ly lz ma lh jr mb mc lj jv md me ll jz mf mg ln mh bi translated">测试连接</h2><p id="b2db" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">您可以通过以下方式检查服务的状态:</p><pre class="nl nm nn no fd np ki nq nr aw ns bi"><span id="0334" class="lu ky ht ki b fi nt nu l nv nw"><strong class="ki hu">kubectl</strong> get services <strong class="ki hu">--field-selector</strong> metadata.name=hello-gke-extlb</span></pre><p id="254a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">最初，您可能会在<code class="du kf kg kh ki b">EXTERNAL-IP</code>列下看到pending。这意味着<a class="ae ke" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">谷歌云</strong> </a>正在提供网络负载平衡器。几分钟后，您应该会看到类似这样的内容:</p><figure class="nl nm nn no fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es oe"><img src="../Images/d25bf80b4b7e6b944f77dc8f6d53b1e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ee-UydpnCGxDefgHD0R8iQ.png"/></div></div><figcaption class="ny nz et er es oa ob bd b be z dx translated"><strong class="bd kz">ku bectl get服务的输出</strong></figcaption></figure><p id="d8ac" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我们还可以在集群外的相应网络负载平衡器处达到峰值:</p><pre class="nl nm nn no fd np ki nq nr aw ns bi"><span id="e693" class="lu ky ht ki b fi nt nu l nv nw"><strong class="ki hu">gcloud</strong> compute forwarding-rules list \<br/>  <strong class="ki hu">--filter</strong> description~hello-gke-extlb \<br/>  <strong class="ki hu">--format </strong>\<br/>  "table[box](name,IPAddress,target.segment(-2):label=TARGET_TYPE)"</span></pre><p id="532d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">它应该会显示如下内容:</p><figure class="nl nm nn no fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es of"><img src="../Images/9587b298cc1c3398051f5ccc4bf614bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zq0nz5rkl7Y3RTD4y3LzNQ.png"/></div></div></figure><p id="6772" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">将IP地址复制到web浏览器中。使用上面的输出，您可以在web浏览器中键入:<code class="du kf kg kh ki b"><a class="ae ke" href="http://104.198.141.152.in" rel="noopener ugc nofollow" target="_blank">http://104.198.141.152</a></code>,然后看到类似这样的内容:</p><figure class="nl nm nn no fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es og"><img src="../Images/9d6135e76f8dfe8378a294111b24c739.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vE3LazNepyFADzLjXzmHDQ.png"/></div></div><figcaption class="ny nz et er es oa ob bd b be z dx translated"><strong class="bd kz">通过NLB的网络浏览器显示</strong></figcaption></figure><h2 id="e438" class="lu ky ht bd kz lv lw lx ld ly lz ma lh jr mb mc lj jv md me ll jz mf mg ln mh bi translated">清除</h2><p id="b658" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">您可以通过以下方式删除这些资源:</p><pre class="nl nm nn no fd np ki nq nr aw ns bi"><span id="1006" class="lu ky ht ki b fi nt nu l nv nw"><strong class="ki hu">cat</strong> hello_gke_extlb_*.yaml | <strong class="ki hu">kubectl</strong> delete <strong class="ki hu">--filename</strong> -</span></pre></div><div class="ab cl mz na gp nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="hb hc hd he hf"><h1 id="043e" class="kx ky ht bd kz la ng lc ld le nh lg lh iz ni ja lj jc nj jd ll jf nk jg ln lo bi translated">具有入口资源的端点</h1><p id="2393" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">入口本质上是一个<a class="ae ke" href="https://en.wikipedia.org/wiki/Reverse_proxy" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">反向代理</strong> </a>，使用公共声明语言(入口资源)来配置规则以将web流量路由回服务。实现方式取决于您希望安装的ingress控制器，例如<a class="ae ke" href="https://github.com/kubernetes/ingress-nginx" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">ingress-nginx</strong></a>、<a class="ae ke" href="https://github.com/jcmoraisjr/haproxy-ingress" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">ha proxy-ingress</strong></a>、<a class="ae ke" href="https://github.com/containous/traefik" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> traefik </strong> </a>或<a class="ae ke" href="https://github.com/datawire/ambassador" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> ambassador </strong> </a>等等。</p><p id="69e7" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated"><a class="ae ke" href="https://cloud.google.com/kubernetes-engine" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> GKE </strong> </a>与<a class="ae ke" href="https://github.com/kubernetes/ingress-gce" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> ingress-gce </strong> </a>捆绑在一起，或者被描述为:</p><blockquote class="oh oi oj"><p id="3544" class="ji jj my jk b jl jm iu jn jo jp ix jq ok js jt ju ol jw jx jy om ka kb kc kd hb bi translated">GCE L7负载平衡器控制器，管理通过Kubernetes Ingress API配置的外部负载平衡器。</p></blockquote><figure class="nl nm nn no fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nx"><img src="../Images/b40886d4b46c6b59fb535c764d0b92ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FTkw7bCKp9Wuor70VNd0ng.png"/></div></div><figcaption class="ny nz et er es oa ob bd b be z dx translated"><strong class="bd kz">节点端口类型的入口资源和服务资源</strong></figcaption></figure><h2 id="6cc7" class="lu ky ht bd kz lv lw lx ld ly lz ma lh jr mb mc lj jv md me ll jz mf mg ln mh bi translated">部署部署控制器</h2><p id="c344" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">使用部署控制器部署web应用程序。创建一个名为<code class="du kf kg kh ki b">hello_gke_ing_deploy.yaml</code>的文件，内容如下:</p><figure class="nl nm nn no fd hk"><div class="bz dy l di"><div class="oc od l"/></div></figure><p id="ca69" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">使用以下命令进行部署:</p><pre class="nl nm nn no fd np ki nq nr aw ns bi"><span id="e923" class="lu ky ht ki b fi nt nu l nv nw"><strong class="ki hu">kubectl</strong> apply <strong class="ki hu">--filename</strong> hello_gke_ing_deploy.yaml</span></pre><h2 id="1431" class="lu ky ht bd kz lv lw lx ld ly lz ma lh jr mb mc lj jv md me ll jz mf mg ln mh bi translated">部署服务节点端口类型</h2><p id="fcb9" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">默认的<a class="ae ke" href="https://cloud.google.com/kubernetes-engine" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> GKE </strong> </a>入口(<code class="du kf kg kh ki b">gce</code>)仅适用于<code class="du kf kg kh ki b">NodePort</code>或<code class="du kf kg kh ki b">LoadBalancer</code>服务类型。由于我们只需要一个<a class="ae ke" href="https://en.wikipedia.org/wiki/Web_API#Endpoints" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">端点</strong> </a>通过入口，我们将选择<code class="du kf kg kh ki b">NodePort</code>。</p><p id="f1bf" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">创建一个名为<code class="du kf kg kh ki b">hello_gke_ing_svc.yaml</code>的文件，内容如下:</p><figure class="nl nm nn no fd hk"><div class="bz dy l di"><div class="oc od l"/></div></figure><p id="8c82" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">使用以下命令进行部署:</p><pre class="nl nm nn no fd np ki nq nr aw ns bi"><span id="aa60" class="lu ky ht ki b fi nt nu l nv nw"><strong class="ki hu">kubectl</strong> apply <strong class="ki hu">--filename</strong> hello_gke_ing_svc.yaml</span></pre><h2 id="570f" class="lu ky ht bd kz lv lw lx ld ly lz ma lh jr mb mc lj jv md me ll jz mf mg ln mh bi translated">部署入口</h2><p id="bdf9" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">入口可以根据主机名和URL路径路由web流量。在我们的简单实现中，我们将把所有东西(<code class="du kf kg kh ki b">/*</code>)路由到我们指定的服务。然后，该服务会将流量进一步路由到三个可用pod中的一个。</p><p id="4eef" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">创建一个名为<code class="du kf kg kh ki b">hello_gke_ing_ing.yaml</code>的文件，内容如下:</p><figure class="nl nm nn no fd hk"><div class="bz dy l di"><div class="oc od l"/></div></figure><p id="41c3" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">使用以下命令进行部署:</p><pre class="nl nm nn no fd np ki nq nr aw ns bi"><span id="c635" class="lu ky ht ki b fi nt nu l nv nw"><strong class="ki hu">kubectl</strong> apply <strong class="ki hu">--filename</strong> hello_gke_ing_ing.yaml</span></pre><h2 id="cd69" class="lu ky ht bd kz lv lw lx ld ly lz ma lh jr mb mc lj jv md me ll jz mf mg ln mh bi translated">测试连接</h2><p id="5f3a" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">您可以运行这个命令来查看入口的运行情况:</p><pre class="nl nm nn no fd np ki nq nr aw ns bi"><span id="58a0" class="lu ky ht ki b fi nt nu l nv nw"><strong class="ki hu">kubectl </strong>get ingress</span></pre><p id="fb1c" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">您应该会看到类似这样的内容:</p><figure class="nl nm nn no fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es on"><img src="../Images/5204067aecd1a6e5a859d40fcec1d843.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q4k7deZs2w8uKhrao0OGNA.png"/></div></div></figure><p id="af47" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我们还可以在相应的http代理上看到<a class="ae ke" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">谷歌云</strong> </a>规定:</p><pre class="nl nm nn no fd np ki nq nr aw ns bi"><span id="e2e4" class="lu ky ht ki b fi nt nu l nv nw"><strong class="ki hu">gcloud</strong> compute forwarding-rules list \<br/>  <strong class="ki hu">--filter</strong> description~hello-gke-ing \<br/>  <strong class="ki hu">--format</strong> \<br/>  "table[box](name,IPAddress,target.segment(-2):label=TARGET_TYPE)"</span></pre><p id="0e1e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">该输出应该类似于以下内容:</p><figure class="nl nm nn no fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es oe"><img src="../Images/f0a308f2b392c77ee6d957118ad1e0f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sC1GAMEv4vrV7DJtgs01mQ.png"/></div></div></figure><p id="4028" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">复制IP地址并将其输入到浏览器中，例如:web浏览器中的<code class="du kf kg kh ki b">http://34.98.86.241</code>。最初，as可能会看到一个404错误，这可能意味着谷歌仍在设置。</p><figure class="nl nm nn no fd hk er es paragraph-image"><div class="er es oo"><img src="../Images/5873afdc82294a826a1f82c3223960b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*34z4IfxCynyEKjaWtLCXkw.png"/></div><figcaption class="ny nz et er es oa ob bd b be z dx translated">来自GLBC的谷歌404错误</figcaption></figure><p id="f04d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">几分钟后，该URL最终应该可以工作了:</p><figure class="nl nm nn no fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es og"><img src="../Images/c401288345fbac468fbeda512149178c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*50ucwNy5J_bJvD6px81U6A.png"/></div></div><figcaption class="ny nz et er es oa ob bd b be z dx translated"><strong class="bd kz">通过GLBC的网络浏览器显示</strong></figcaption></figure><h2 id="3e56" class="lu ky ht bd kz lv lw lx ld ly lz ma lh jr mb mc lj jv md me ll jz mf mg ln mh bi translated">清除</h2><p id="8512" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">您可以通过以下方式删除这些资源:</p><pre class="nl nm nn no fd np ki nq nr aw ns bi"><span id="deb9" class="lu ky ht ki b fi nt nu l nv nw"><strong class="ki hu">cat</strong> hello_gke_ing_*.yaml | <strong class="ki hu">kubectl</strong> delete <strong class="ki hu">--filename</strong> -</span></pre><h1 id="a663" class="kx ky ht bd kz la lb lc ld le lf lg lh iz li ja lj jc lk jd ll jf lm jg ln lo bi translated">资源</h1><p id="3e40" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">这里有一些与本文所涉及的内容相关的文档的参考资料。</p><h2 id="38ed" class="lu ky ht bd kz lv lw lx ld ly lz ma lh jr mb mc lj jv md me ll jz mf mg ln mh bi translated">博客源代码</h2><p id="d2f3" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">我把这篇博客中使用的源代码放在这里:</p><ul class=""><li id="4dae" class="kj kk ht jk b jl jm jo jp jr kl jv km jz kn kd ko kp kq kr bi translated"><a class="ae ke" href="https://github.com/darkn3rd/blog_tutorials/tree/master/kubernetes/gke_3_service_ingress" rel="noopener ugc nofollow" target="_blank">https://github . com/darkn 3 rd/blog _ tutorials/tree/master/kubernetes/gke _ 3 _ service _ ingress</a></li></ul><h2 id="aaa7" class="lu ky ht bd kz lv lw lx ld ly lz ma lh jr mb mc lj jv md me ll jz mf mg ln mh bi translated">库伯内特斯</h2><p id="3ddd" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">这些是Kubernetes概念的概述。</p><ul class=""><li id="5482" class="kj kk ht jk b jl jm jo jp jr kl jv km jz kn kd ko kp kq kr bi translated"><strong class="jk hu">服务资源</strong>:<a class="ae ke" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/concepts/services-networking/Service/</a></li><li id="89f7" class="kj kk ht jk b jl ks jo kt jr ku jv kv jz kw kd ko kp kq kr bi translated"><strong class="jk hu">入口资源</strong>:<a class="ae ke" href="https://kubernetes.io/docs/concepts/services-networking/ingress/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/concepts/services-networking/Ingress/</a></li><li id="8190" class="kj kk ht jk b jl ks jo kt jr ku jv kv jz kw kd ko kp kq kr bi translated"><strong class="jk hu">部署控制器</strong>:<a class="ae ke" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/concepts/workloads/controllers/Deployment/</a></li></ul><h2 id="aae7" class="lu ky ht bd kz lv lw lx ld ly lz ma lh jr mb mc lj jv md me ll jz mf mg ln mh bi translated">GKE(谷歌Kubernetes引擎)</h2><p id="561e" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">这些是特定于实施的文档。</p><ul class=""><li id="25bf" class="kj kk ht jk b jl jm jo jp jr kl jv km jz kn kd ko kp kq kr bi translated"><strong class="jk hu">服务类型负载平衡器</strong>:<a class="ae ke" href="https://cloud.google.com/kubernetes-engine/docs/concepts/service#services_of_type_loadbalancer" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/kubernetes-engine/docs/concepts/Service # services _ of _ Type _ load balancer</a></li><li id="6557" class="kj kk ht jk b jl ks jo kt jr ku jv kv jz kw kd ko kp kq kr bi translated"><strong class="jk hu">入口</strong>:<a class="ae ke" href="https://cloud.google.com/kubernetes-engine/docs/concepts/ingress" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/kubernetes-engine/docs/concepts/Ingress</a></li></ul><h2 id="353a" class="lu ky ht bd kz lv lw lx ld ly lz ma lh jr mb mc lj jv md me ll jz mf mg ln mh bi translated">谷歌云</h2><ul class=""><li id="5461" class="kj kk ht jk b jl lp jo lq jr op jv oq jz or kd ko kp kq kr bi translated"><strong class="jk hu">云负载均衡</strong>:<a class="ae ke" href="https://cloud.google.com/load-balancing" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/load-balancing</a></li><li id="2c4c" class="kj kk ht jk b jl ks jo kt jr ku jv kv jz kw kd ko kp kq kr bi translated"><strong class="jk hu">网络负载均衡</strong>:<a class="ae ke" href="https://cloud.google.com/load-balancing/docs/network" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/load-balancing/docs/network</a></li><li id="c696" class="kj kk ht jk b jl ks jo kt jr ku jv kv jz kw kd ko kp kq kr bi translated"><strong class="jk hu"> HTTPS负载均衡</strong>:<a class="ae ke" href="https://cloud.google.com/load-balancing/docs/https/setting-up-https" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/Load-Balancing/docs/https/setting-up-https</a></li><li id="d398" class="kj kk ht jk b jl ks jo kt jr ku jv kv jz kw kd ko kp kq kr bi translated"><strong class="jk hu">设置网络负载平衡</strong>:<a class="ae ke" href="https://cloud.google.com/load-balancing/docs/network/setting-up-network" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/Load-Balancing/docs/Network/setting-up-Network</a></li><li id="c460" class="kj kk ht jk b jl ks jo kt jr ku jv kv jz kw kd ko kp kq kr bi translated"><strong class="jk hu">目标池(L4 LB)</strong>:<a class="ae ke" href="https://cloud.google.com/load-balancing/docs/target-pools" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/load-balancing/docs/target-pools</a></li><li id="907d" class="kj kk ht jk b jl ks jo kt jr ku jv kv jz kw kd ko kp kq kr bi translated"><strong class="jk hu">目标代理(L7磅)</strong>:<a class="ae ke" href="https://cloud.google.com/load-balancing/docs/target-proxies" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/load-balancing/docs/target-proxies</a></li></ul><h1 id="91e9" class="kx ky ht bd kz la lb lc ld le lf lg lh iz li ja lj jc lk jd ll jf lm jg ln lo bi translated">结论</h1><p id="e7c7" class="pw-post-body-paragraph ji jj ht jk b jl lp iu jn jo lq ix jq jr lr jt ju jv ls jx jy jz lt kb kc kd hb bi translated">本文的目标是演示如何在<a class="ae ke" href="https://kubernetes.io" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Kubernetes </strong> </a>上为您的web应用程序添加一个<a class="ae ke" href="https://en.wikipedia.org/wiki/Web_API#Endpoints" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">端点</strong> </a>，并展示如何将<a class="ae ke" href="https://cloud.google.com/kubernetes-engine" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">【GKE】</strong></a>与<a class="ae ke" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Google Cloud </strong> </a>集成以提供这些<a class="ae ke" href="https://en.wikipedia.org/wiki/Web_API#Endpoints" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu">端点</strong> </a>。</p><p id="54ca" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我希望这在你的<a class="ae ke" href="https://kubernetes.io" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu"/></a>与<a class="ae ke" href="https://cloud.google.com/kubernetes-engine" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> GKE </strong> </a>的冒险中有用。在以后的文章中，我将进一步扩展这一点，展示如何集成来自<a class="ae ke" href="https://kubernetes.io" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> Kubernetes </strong> </a>的DNS名称和TLS证书的管理。</p></div></div>    
</body>
</html>