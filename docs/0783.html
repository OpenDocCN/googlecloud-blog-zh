<html>
<head>
<title>Deploying a Python serverless function in minutes with GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GCP在几分钟内部署Python无服务器功能</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/deploying-a-python-serverless-function-in-minutes-with-gcp-19dd07e19824?source=collection_archive---------0-----------------------#2018-09-30">https://medium.com/google-cloud/deploying-a-python-serverless-function-in-minutes-with-gcp-19dd07e19824?source=collection_archive---------0-----------------------#2018-09-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bfe9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">女(☁️、🐍 ) = 🌈🌤️🐍🐍🐍…</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/a25f18adb175a49feb187d3cb631c814.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*txTmKRON9wWSlwwXbeuk9Q.gif"/></div></div></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="4025" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">嘿Pythonistas，w <strong class="ak"> e可以部署Python函数！</strong></h1><p id="d448" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">维基百科是我列出作者参考书目、电影记录的真实来源……不幸的是，并不是所有东西都可以以数字形式获得。例如，我想列出电子书形式的书籍。这是一个非常简单的任务，实际上是一个微服务。GCP的云功能看起来非常适合这个。让我们从头开始检查一下。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="fb3f" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">几个问题</h1><h2 id="3b70" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">什么是云函数？</h2><p id="3560" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">云功能是针对无服务器功能的托管服务。描述这种服务的首字母缩写词是FaaS(功能为服务)。</p><h2 id="1874" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">什么是托管服务？</h2><p id="4dd9" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">这是一项我不必管理的服务。我只是用它。</p><h2 id="ef86" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">什么是无服务器功能？</h2><p id="72fd" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">像程序中的函数一样，无服务器(或云)函数是一个独立的单元，可以自然地隔离在app架构中。</p><h2 id="f8b9" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">它是如何工作的？</h2><p id="9057" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">该功能是事件驱动的:代码将在触发时被调用，例如HTTP请求、上传到云存储的文件、发布的消息…</p><h2 id="d886" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">无服务器功能有什么好处？</h2><ul class=""><li id="962a" class="ln lo hi ih b ii ku im kv iq lp iu lq iy lr jc ls lt lu lv bi translated">代码本身可以直接部署在隔离的云功能中。</li><li id="0ca3" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">随着流量的发展，函数资源会自动伸缩(infra为我处理这个问题)。</li><li id="6488" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">该功能高度可用(使用托管服务的一个好处)。</li><li id="1228" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">我只为我使用的东西付费:如果不使用功能，成本为零。</li></ul><h2 id="b07e" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">作为一名开发人员，我为什么喜欢serverless？</h2><ul class=""><li id="25df" class="ln lo hi ih b ii ku im kv iq lp iu lq iy lr jc ls lt lu lv bi translated">我可以<strong class="ih hj">专注于代码</strong>。</li><li id="a395" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">我有一个<strong class="ih hj">更清晰的</strong>，还有<strong class="ih hj">健壮和高性能的</strong>、<strong class="ih hj">架构</strong>。</li><li id="6e70" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">我可以睡在两只耳朵上。如果凌晨2点出现服务中断，可靠性工程师会处理这个问题。</li></ul><h2 id="ac9f" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">我如何开始？</h2><p id="26bb" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">我只需要一个GCP账户。GCP提供了慷慨的<a class="ae mb" href="https://cloud.google.com/free/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">免费等级</strong> </a>让您开始尝试不同的产品:</p><ul class=""><li id="35f3" class="ln lo hi ih b ii ij im in iq mc iu md iy me jc ls lt lu lv bi translated">第一次使用的用户可以获得300美元的免费积分，使用时间超过12个月。</li><li id="bcd0" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">此外，每个月，云功能的前200万次调用是免费的(低于其他高容量阈值)。</li></ul><p id="eef0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，除非我部署一个非常成功的函数，每个月调用几百万次，否则这不会花费任何成本。我说过我喜欢无服务器吗？</p><h2 id="b252" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">我的工具箱里有什么？</h2><p id="2419" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">我可以通过三种方式使用云函数(或者一般的GCP):</p><ol class=""><li id="2114" class="ln lo hi ih b ii ij im in iq mc iu md iy me jc mf lt lu lv bi translated">从<strong class="ih hj">图形用户界面(GUI) </strong>:我可以直接从浏览器部署云功能，无需安装任何工具。这非常适合于监控或发现服务，也适合于快速原型化或调试。</li><li id="7146" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc mf lt lu lv bi translated">从<strong class="ih hj">命令行界面(CLI) </strong>:在一个合适的开发工作流中，我通常会编写所有的脚本并使用<code class="du mg mh mi mj b">gcloud</code> (GCP的主要命令行工具)。</li><li id="2772" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc mf lt lu lv bi translated">来自<strong class="ih hj">应用编程接口(API) </strong>:所有的GCP服务都是基于API的，允许完全工业化的开发。当我使用GUI或CLI时，我实际上发起了对REST API的web请求。</li></ol><h2 id="0bbe" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">我的作战计划是什么？</h2><p id="a737" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">让我们部署一个简单的HTTP触发的云功能，首先从GUI，然后从CLI。不过还是先准备代码吧。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="aca4" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">给我看看代码！</h1><h2 id="eecf" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">“你好世界！”</h2><p id="9f63" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">Flask是用于处理传入HTTP请求的底层框架。一个典型的“hello world”云函数就像这样简单:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="4db7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这给出了，没有参数:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mm"><img src="../Images/1fa6a57d91bdcc59c152cda14f865947.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PQLZmGQ8EiKls63d5iuY7w.png"/></div></div></figure><p id="cda3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者，使用参数:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mm"><img src="../Images/72a7452c45e11f0afd60ea822ea1938b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qbAAnRyaIeuQM0wa0eeTJA.png"/></div></div></figure><h2 id="a2ca" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">定义HTTP入口点</h2><p id="81d8" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">我想用给定的语言打印出给定作者的可用电子书列表。基于上面的hello world示例，我可以定义这个简单的Python函数:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mk ml l"/></div></figure><h2 id="b72a" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">从Google Books API获取数据</h2><p id="ab79" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated"><code class="du mg mh mi mj b">Requests</code>是“一个优雅而简单的Python HTTP库，为人类而建”(<a class="ae mb" href="http://docs.python-requests.org" rel="noopener ugc nofollow" target="_blank">docs.python-requests.org</a>)，的确如此。这使得查询一个API(比如<a class="ae mb" href="https://developers.google.com/books/docs/v1/reference/volumes/list" rel="noopener ugc nofollow" target="_blank"> Google Books API </a>)变得非常容易:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mk ml l"/></div></figure><h2 id="68ba" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">以纯文本格式打印结果</h2><p id="6eed" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">Flask自然会处理HTML模板，但是为了简单起见，让我们定义这个基本函数来返回一个纯文本结果:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mk ml l"/></div></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="9560" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">从GUI部署云功能</h1><p id="aa86" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">GCP提供了一个网络控制台，一个可以在任何浏览器上工作的图形用户界面，不需要预先安装。web控制台非常适合测试一个功能(这就是我现在的情况)，快速构建概念验证，当然还有监控我的服务。</p><h2 id="cce2" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">打开web控制台</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mn"><img src="../Images/72791c58f8ac7bb3918b7a2250ab16fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5K9l6HG5B9HpKXurzrHSrQ.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated">前往<a class="ae mb" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com</a></figcaption></figure><h2 id="c8b9" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">创建新项目</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/510b31674966bb0138f0d18a3b4bd1d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*e9XIHU3qG-ewwvtBTuZXXQ.gif"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated">定义项目名称和ID</figcaption></figure><h2 id="e194" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">从仪表板监控我的项目</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/d11a79078609a83d27fc037806e34081.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B8NBYLx9TqW5l-b4-GnhLA.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated">我的项目准备好了</figcaption></figure><h2 id="750d" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">使用“入门”快捷方式</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mt"><img src="../Images/ad2cbd64cdeabaeef278bcaaf29f805c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MDKtYFy8aTQ4ykYq3b2GnA.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated">“入门”列出了最常见的任务</figcaption></figure><h2 id="9d90" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">创建我的云功能</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mu"><img src="../Images/6feb4aef7e70f5b8697f085d8c3b01f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ylTeDCyIxlPleDrJ8EvA-Q.gif"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated">首先启用云函数API(一个安全控件)</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/3f4b617823609eed0b2173bff0d9c884.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h9sMXiPDu5hZHlNjY95VUw.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated">将运行时值从默认的“Node.js”切换到“Python”</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mv"><img src="../Images/22d577c8e4ddefce1bf035f9cc79fcda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TOZBy73C8otsR8bJrjW9dw.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated">新:你现在可以指定函数是私有的还是公共的。因为我们的用例是关于公开一个公共API，所以确保选中了选项“允许未经身份验证的调用”。</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/fa93c260506c372adde01590505fae88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HHcQDQ8n1LwQKr4sNG4PWw.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated">输入功能名称，<a class="ae mb" href="https://raw.githubusercontent.com/PicardParis/cloud-snippets/master/python/gcf-get-ebooks/main.py" rel="noopener ugc nofollow" target="_blank">代码</a>，入口点&amp;区域，然后创建/部署功能</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/6119ff237c1134cdd36830e6273445f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fcyngc9El1mPKLJo0eAAHA.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated">该功能已部署。一个简单的HTTP请求现在可以触发这个函数。</figcaption></figure><h2 id="6dcb" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">检查功能</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/98b425b4714b5605e3a3550fe05a35d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SZn1_iQmX59w69TuNbovGQ.png"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated">这个管用。对于实际的API，结果当然是json格式，而不是纯文本格式。</figcaption></figure><h2 id="e8c2" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">删除项目</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/709c2b90019ff81e63f8453a4a814d29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YtjYq6ibJu6w2ZDjJzi6HA.gif"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated">打开项目设置，然后关闭项目(实际上将在30天后删除)</figcaption></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="9d22" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">从CLI部署云功能</h1><p id="643b" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">如果您经常管理云项目，命令行界面(CLI)是首选工具。GCP提供了Cloud Shell，这是一个标准的bash环境，无需预先安装，直接在浏览器上运行。它背后的神奇之处在于，它自动处理到一个小虚拟机的SSH连接，在那里我需要的一切都是预先安装好的。主要的命令行实用程序是<code class="du mg mh mi mj b">gcloud</code>。让我们对每一步进行计时(⌛)</p><h2 id="eada" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">打开云壳(⌛15”)</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/f9b555704333809b9aef298458f799b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*y7T0aK4lSDoh2fmM1eiL_w.gif"/></div></div><figcaption class="mo mp et er es mq mr bd b be z dx translated">去<a class="ae mb" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com</a>打开云壳</figcaption></figure><h2 id="c1f8" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">创建新项目(+11" → ⌛26 ")</h2><pre class="je jf jg jh fd mw mj mx my aw mz bi"><span id="88be" class="kz jx hi mj b fi na nb l nc nd"><strong class="mj hj">PROJECT_ID="MY-PROJECT-ID"</strong><br/><strong class="mj hj">PROJECT_NAME="Get Ebooks PyGCF"</strong></span><span id="b1cc" class="kz jx hi mj b fi ne nb l nc nd"><strong class="mj hj">gcloud projects create $PROJECT_ID \<br/>  --name="$PROJECT_NAME" \<br/>  --set-as-default</strong></span><span id="9027" class="kz jx hi mj b fi ne nb l nc nd">Create in progress for [https://cloudresourcemanager.googleapis.com/v1/projects/...].<br/>Waiting for [operations/cp...] to finish...done.<br/>Updated property [core/project] to [PROJECT_ID].</span></pre><p id="6775" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注:项目标识在GCP是唯一的。我用了<code class="du mg mh mi mj b">get-ebooks-pygcf</code>，但是你应该自己定义。</p><h2 id="6fd5" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">将项目链接到我的账单账户(+5" → ⌛31 ")</h2><pre class="je jf jg jh fd mw mj mx my aw mz bi"><span id="cbe7" class="kz jx hi mj b fi na nb l nc nd"><strong class="mj hj">BILLING_ACCOUNT=$(gcloud beta billing accounts list \<br/>  --format 'value(name)')</strong></span><span id="5a38" class="kz jx hi mj b fi ne nb l nc nd"><strong class="mj hj">gcloud beta billing projects link $PROJECT_ID \<br/>  --billing-account $BILLING_ACCOUNT</strong></span><span id="d4e5" class="kz jx hi mj b fi ne nb l nc nd">billingAccountName: billingAccounts/XXXXXX-YYYYYY-ZZZZZZ<br/>billingEnabled: true<br/>name: projects/PROJECT_ID/billingInfo<br/>projectId: PROJECT_ID</span></pre><h2 id="fb8f" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">启用云功能API (+11" → ⌛42 ")</h2><pre class="je jf jg jh fd mw mj mx my aw mz bi"><span id="a01b" class="kz jx hi mj b fi na nb l nc nd"><strong class="mj hj">gcloud services enable cloudfunctions.googleapis.com</strong></span><span id="92ae" class="kz jx hi mj b fi ne nb l nc nd">Operation "operations/acf..." finished successfully.</span></pre><h2 id="64ac" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">获取代码(+3" → ⌛45 ")</h2><pre class="je jf jg jh fd mw mj mx my aw mz bi"><span id="2402" class="kz jx hi mj b fi na nb l nc nd"><strong class="mj hj">git clone </strong><a class="ae mb" href="https://github.com/PicardParis/cloud-snippets.git" rel="noopener ugc nofollow" target="_blank"><strong class="mj hj">https://github.com/PicardParis/cloud-snippets.git</strong></a></span><span id="43a2" class="kz jx hi mj b fi ne nb l nc nd">Cloning into 'cloud-snippets'...<br/>remote: Counting objects: 8, done.<br/>remote: Compressing objects: 100% (6/6), done.<br/>remote: Total 8 (delta 0), reused 8 (delta 0), pack-reused 0<br/>Unpacking objects: 100% (8/8), done.</span><span id="1752" class="kz jx hi mj b fi ne nb l nc nd"><strong class="mj hj">cd cloud-snippets/python/gcf-get-ebooks/</strong><br/><strong class="mj hj">ls</strong></span><span id="775b" class="kz jx hi mj b fi ne nb l nc nd">main.py</span></pre><h2 id="c042" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">部署功能(+1'42" → ⌛2'27)</h2><pre class="je jf jg jh fd mw mj mx my aw mz bi"><span id="bfdd" class="kz jx hi mj b fi na nb l nc nd"><strong class="mj hj">GCF_NAME="get-ebooks"</strong><br/><strong class="mj hj">GCF_ENTRY="get_ebooks_by_author"</strong><br/><strong class="mj hj">GCF_REGION="europe-west1"</strong></span><span id="5be3" class="kz jx hi mj b fi ne nb l nc nd"><strong class="mj hj">gcloud functions deploy $GCF_NAME \<br/>  --entry-point $GCF_ENTRY \<br/>  --region $GCF_REGION \<br/>  --runtime python37 \<br/>  --trigger-http \<br/>  --allow-unauthenticated</strong></span><span id="35c5" class="kz jx hi mj b fi ne nb l nc nd">Deploying function (may take a while - up to 2 minutes)...done.<br/>availableMemoryMb: 256<br/>entryPoint: get_ebooks_by_author<br/>httpsTrigger:<br/>  url: https://GCF_REGION-PROJECT_ID.cloudfunctions.net/GCF_NAME<br/>labels:<br/>  deployment-tool: cli-gcloud<br/>name: projects/PROJECT_ID/locations/GCF_REGION/functions/GCF_NAME<br/>runtime: python37<br/>serviceAccountEmail: ...<br/>sourceUploadUrl: ...<br/>status: ACTIVE<br/>timeout: 60s<br/>updateTime: 'YYYY-MM-DDThh:mm:ssZ'<br/>versionId: '1'</span></pre><p id="a2c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意事项:</p><ul class=""><li id="951b" class="ln lo hi ih b ii ij im in iq mc iu md iy me jc ls lt lu lv bi translated">第一次部署时间较长(设置环境)。如果我更新<code class="du mg mh mi mj b">main.py</code>并重新部署，更新需要大约25秒。</li><li id="fbc5" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">默认情况下，部署的功能是私有的(只能由Google云平台内的授权服务调用)。标志<code class="du mg mh mi mj b">--allow-unauthenticated</code>公开了这个函数(这样我们可以用下面的<code class="du mg mh mi mj b">curl</code>命令调用它)。除非您正在创建公共API或网站，否则通常不会在生产中使用此标志。</li></ul><h2 id="a6d6" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">调用函数(+1" → ⌛2'28 ")</h2><pre class="je jf jg jh fd mw mj mx my aw mz bi"><span id="e212" class="kz jx hi mj b fi na nb l nc nd"><strong class="mj hj">GCF_URL=https://$GCF_REGION</strong><a class="ae mb" href="https://europe-west1-get-ebooks-pygcftest2.cloudfunctions.net/get-ebooks" rel="noopener ugc nofollow" target="_blank"><strong class="mj hj">-</strong></a><strong class="mj hj">$PROJECT_ID.cloudfunctions.net/$GCF_NAME</strong></span><span id="8dc9" class="kz jx hi mj b fi ne nb l nc nd"><strong class="mj hj">curl "$GCF_URL?author=saint+exupery&amp;lang=fr"</strong></span><span id="6d4f" class="kz jx hi mj b fi ne nb l nc nd">====================================================================<br/>                  "saint exupery" ebooks (lang=fr)<br/>====================================================================<br/>   # | Pages | Title<br/>   1 |   528 | Écrits de guerre (1939-1944)<br/>   2 |   384 | Carnets<br/>   3 |   240 | Lettres à sa mère<br/>   5 |   180 | Les plus belles pensées d'Antoine de Saint-Exupéry<br/>   6 |    48 | Saint-Exupéry - / Le Royaume des étoiles<br/>   7 |    36 | Le Petit Prince raconté aux enfants<br/>...</span><span id="7a0e" class="kz jx hi mj b fi ne nb l nc nd"><strong class="mj hj">curl "$GCF_URL?author=jrr+tolkien&amp;lang=de"</strong></span><span id="3e11" class="kz jx hi mj b fi ne nb l nc nd">====================================================================<br/>                   "jrr tolkien" ebooks (lang=de)<br/>====================================================================<br/>   # | Pages | Title<br/>   1 | 1,568 | Der Herr der Ringe / Sonderausgabe<br/>   2 |   964 | Das Buch der verschollenen Geschichten / 1. &amp; 2. Teil<br/>   3 |   720 | Nachrichten aus Mittelerde<br/>   4 |   608 | Der Herr der Ringe - Die Gefährten / Neuüberarbeitung<br/>   5 |   560 | Die Legende von Sigurd und Gudrún<br/>   6 |   558 | Das Silmarillion<br/>   7 |   444 | Der Herr der Ringe - Die Rückkehr des Königs / <br/>...</span></pre><h2 id="acac" class="kz jx hi bd jy la lb lc kc ld le lf kg iq lg lh kk iu li lj ko iy lk ll ks lm bi translated">删除项目(+5" → ⌛2'33 ")</h2><pre class="je jf jg jh fd mw mj mx my aw mz bi"><span id="cfe2" class="kz jx hi mj b fi na nb l nc nd"><strong class="mj hj">gcloud projects delete $PROJECT_ID</strong></span></pre></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="04a5" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">向上爬！</h1><ul class=""><li id="355e" class="ln lo hi ih b ii ku im kv iq lp iu lq iy lr jc ls lt lu lv bi translated">女(☁️、🐍 ) = 🌈🌤️🐍🐍🐍…</li><li id="a448" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">函数可以从:<br/><a class="ae mb" href="https://europe-west1-get-ebooks-pygcf.cloudfunctions.net/get-ebooks?lang=en&amp;author=jrr%20tolkien" rel="noopener ugc nofollow" target="_blank">https://Europe-west 1-get-ebooks-py GCF . cloud functions . net/get-ebooks？lang = en&amp;author = jrr % 20 Tolkien</a></li><li id="62f8" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">代码片段可从本报告获得:<br/><a class="ae mb" href="https://github.com/PicardParis/cloud-snippets/tree/master/python/gcf-get-ebooks" rel="noopener ugc nofollow" target="_blank">https://github . com/Picard Paris/cloud-snippets/tree/master/python/GCF-get-ebooks</a></li><li id="6d9a" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">从头开始部署一个简单的云功能不到3分钟。</li><li id="111c" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">更新现有云功能只需不到30秒。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/a25f18adb175a49feb187d3cb631c814.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*txTmKRON9wWSlwwXbeuk9Q.gif"/></div></div></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="12c4" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">更新</h1><ul class=""><li id="301c" class="ln lo hi ih b ii ku im kv iq lp iu lq iy lr jc ls lt lu lv bi translated">2019.12.16:增加标志<code class="du mg mh mi mj b">--allow-unauthenticated</code>显式部署公共函数。</li></ul><h1 id="fcd4" class="jw jx hi bd jy jz nf kb kc kd ng kf kg kh nh kj kk kl ni kn ko kp nj kr ks kt bi translated">下一步是什么？</h1><p id="0ff3" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">在几分钟内部署Python无服务器应用程序(敬请关注)…</p></div></div>    
</body>
</html>