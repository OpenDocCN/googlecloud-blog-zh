<html>
<head>
<title>Using Cloud Dataflow to index documents into Elasticsearch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用云数据流将文档索引到弹性搜索中</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/using-cloud-dataflow-to-index-documents-into-elasticsearch-b3a31e999dfc?source=collection_archive---------0-----------------------#2018-08-17">https://medium.com/google-cloud/using-cloud-dataflow-to-index-documents-into-elasticsearch-b3a31e999dfc?source=collection_archive---------0-----------------------#2018-08-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8dba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您的系统中有大量数据，但您的客户仍然抱怨他们找不到任何东西！听起来很熟悉？如果是这样，也许是时候给你的技术堆栈添加一个可扩展的分布式搜索引擎了，比如<a class="ae je" href="https://www.elastic.co/blog/found-uses-of-elasticsearch#you-know-for-search-and-counting" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Elasticsearch </strong> </a>。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es jf"><img src="../Images/bc118e4965e4bdbea76734536c260106.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/1*r3-yb6xWYC5nI7W9yOGQBg.gif"/></div></figure><p id="88f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Elasticsearch <a class="ae je" href="https://www.elastic.co/about/partners/google-cloud-platform" rel="noopener ugc nofollow" target="_blank">很容易部署在谷歌云平台</a>上，你可以很快地设置它。下一步是弄清楚如何对您添加到环境中的所有这些数据进行索引，或使其可搜索。</p><p id="21c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">进入<strong class="ih hj">云数据流</strong>！</p><p id="fab9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae je" href="https://cloud.google.com/dataflow/" rel="noopener ugc nofollow" target="_blank">云数据流(Cloud Dataflow)是一个完全托管的服务</a>来执行用<em class="jd"/><a class="ae je" href="https://beam.apache.org/" rel="noopener ugc nofollow" target="_blank"><em class="jd">Apache Beam</em></a>编写的数据管道(批处理或流式)。幸运的是，Apache Beam的Java SDK提供了一个<a class="ae je" href="https://beam.apache.org/documentation/sdks/javadoc/2.6.0/org/apache/beam/sdk/io/elasticsearch/ElasticsearchIO.html" rel="noopener ugc nofollow" target="_blank">便捷的连接器，用于向Elasticsearch </a>写入(和读取)文档。您可以做一些事情，比如验证您想要索引的数据，甚至用一些外部数据集增强它——所有这些都是同一个数据管道的一部分。</p><p id="9167" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇博客和Github 上附带的样本代码<a class="ae je" href="https://github.com/GoogleCloudPlatform/professional-services/tree/master/examples/dataflow-elasticsearch-indexer" rel="noopener ugc nofollow" target="_blank">将试图把拼图拼在一起，并演示所有这些如何作为运行在云数据流上的单一管道的一部分工作。</a></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es jn"><img src="../Images/1ff67b7f3b9794ff08681aeec1297ee3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OaVwGy1MNotrx3Oi6a9Zeg.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">将文档索引到Elasticsearch的数据流管道</figcaption></figure><p id="4b12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上图中进行了大量工作，因此以下步骤深入研究了所有这些组件如何协同工作:</p><ol class=""><li id="56b0" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated">云发布/订阅是将数据传输到环境中的一种极佳方式，云数据流可以轻松地从云发布/订阅中读取，这使其成为这种方法中的首选数据流工具。</li><li id="4c78" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">云Bigtable非常适合专门的低延迟查找，并且非常适合存储增强动态文档所需的任何外部数据。</li><li id="8cfe" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">使用Apache Beam的ElasticsearchIO Java连接器可以非常容易地将文档写入(索引)到Elasticsearch中。</li><li id="6ef2" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">未通过验证的文档在重新处理之前可能需要一些手动(或自动)干预。在这种方法中，这些文档被发布到不同的云发布/订阅主题。</li><li id="f07f" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">可选地，纠正错误并使失败的文档可用于重新处理的过程可以自动化——当然是使用云数据流！</li></ol><p id="e38d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另外一个好处是，<a class="ae je" href="https://cloud.google.com/dataflow/service/dataflow-service-desc#autoscaling" rel="noopener ugc nofollow" target="_blank">通过设置几个标志，可以轻松地为流式管道</a>启用自动缩放:</p><pre class="jg jh ji jj fd kk kl km kn aw ko bi"><span id="9786" class="kp kq hi kl b fi kr ks l kt ku">--autoscalingAlgorithm=THROUGHPUT_BASED<br/>--maxNumWorkers=&lt;N&gt;</span></pre><p id="eee1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这使得Cloud Dataflow可以根据需要处理的积压量来调整工作人员的数量——仅在需要时使用资源！</p><p id="9559" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">太棒了！但是我们如何处理系统中已经存在的数据呢？</em> </strong></p><p id="eb23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对管道进行简单的修改，从Google云存储桶<em class="jd">而不是云发布/订阅的</em>读取输入应该是管道中唯一需要改变的事情。</p><p id="8229" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">那么，我们能否将这种方法用于最新最棒的Elasticsearch版本呢？</em>T11】</strong></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es kv"><img src="../Images/e39d7657e71ce0245c8e56906332001f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*iz0zf4y_Du5NJwYu14sEBw.jpeg"/></div><figcaption class="js jt et er es ju jv bd b be z dx translated">几乎…不完全是..</figcaption></figure><p id="4495" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯— <em class="jd">差不多</em>:)目前Apache Beam的ElasticsearchIO支持Elasticsearch v5.x(和v2.x)开箱即用。然而，Apache Beam社区也在积极支持Elasticsearch v6.x。一个临时的解决方案是使用一个定制的转换，通过他们的Java高级REST客户端与Elasticsearch 6.x对话。</p><p id="09fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">准备好工作样品了吗？</strong></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es kw"><img src="../Images/d351d46def75fb02ff473ed985ad064b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*AmI9wRbXrfIWGESx6eEiTw.gif"/></div></figure><p id="7d60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开始使用此管道和示例数据进行快速演示(谁不喜欢演示呢！)再简单不过了——把你的浏览器指向伴随Github repo的<a class="ae je" href="https://github.com/GoogleCloudPlatform/professional-services/tree/master/examples/dataflow-elasticsearch-indexer" rel="noopener ugc nofollow" target="_blank"/>并跟随它吧！</p></div></div>    
</body>
</html>