<html>
<head>
<title>Knative + Buildpacks: Source code to container image without Dockerfile</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Knative + Buildpacks:不带Dockerfile的容器映像的源代码</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/knative-buildpacks-source-code-to-container-image-without-dockerfile-34cb2dbfc49c?source=collection_archive---------1-----------------------#2019-05-16">https://medium.com/google-cloud/knative-buildpacks-source-code-to-container-image-without-dockerfile-34cb2dbfc49c?source=collection_archive---------1-----------------------#2019-05-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class="ev ex if ig ih ab cb"><figure class="ii ij ik il im in io paragraph-image"><img src="../Images/5a3647e1945046d7027a568aa7a7ec27.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*Sj53JniX4gStXhMQ5MkEcQ.png"/></figure><figure class="ii ij ir il im in io paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><img src="../Images/d1ed933eafa12b00ec80d08941a6ae70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*hUr6dlRbTCHwoGbVZg3Ivg.png"/></div></figure></div><p id="039c" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">我之前<a class="ae ju" rel="noopener" href="/google-cloud/hands-on-knative-part-3-d8731ad2f23d">谈到过</a> <a class="ae ju" href="https://github.com/knative/build" rel="noopener ugc nofollow" target="_blank"> Knative Build </a>以及它如何让你从源代码到存储库中的容器映像。您可以从头开始编写您的构建，也可以依赖Knative已经提供的许多<a class="ae ju" href="https://github.com/knative/build-templates" rel="noopener ugc nofollow" target="_blank"> BuildTemplates </a>。例如，在我的<a class="ae ju" href="https://github.com/meteatamel/knative-tutorial" rel="noopener ugc nofollow" target="_blank"> Knative教程</a>中，我<a class="ae ju" href="https://github.com/meteatamel/knative-tutorial/blob/master/docs/10.5-kanikobuildtemplate.md" rel="noopener ugc nofollow" target="_blank">向</a>展示了如何安装<a class="ae ju" href="https://github.com/knative/build-templates/tree/master/kaniko" rel="noopener ugc nofollow" target="_blank"> Kaniko BuildTemplate </a>并使用Kaniko构建容器图像。</p><p id="9675" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">您通常需要编写一个<code class="du jv jw jx jy b">Dockerfile</code>，这样Knative Build(或者更准确地说是Kaniko)就知道如何构建容器映像。如果有一种不用定义<code class="du jv jw jx jy b">Dockerfile</code>就能自动构建应用程序的方法，那不是很好吗？嗯，有！</p></div><div class="ab cl jz ka gp kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hb hc hd he hf"><p id="784f" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated"><a class="ae ju" href="https://buildpacks.io/" rel="noopener ugc nofollow" target="_blank"> Cloud Native Buildpacks </a>是一个为构建应用提供比Dockerfiles更高层次抽象的项目。<a class="ae ju" href="https://buildpacks.io/" rel="noopener ugc nofollow" target="_blank">云原生构建包</a>允许你从源代码到容器映像，而不必定义<code class="du jv jw jx jy b">Dockerfile</code>。它通过一些自动检测功能来判断你的代码是用什么语言写的，以及它有什么样的依赖关系。最终，您得到了一个可运行的应用程序映像，而不必担心创作和优化一个<code class="du jv jw jx jy b">Dockerfile</code>的细节。</p><p id="9e14" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">好消息是Knative有一个<a class="ae ju" href="https://github.com/knative/build-templates/tree/master/buildpacks" rel="noopener ugc nofollow" target="_blank"> Buildpacks模板</a>，使得在Knative构建中使用Buildpacks变得非常容易。我在我的Knative Buildpacks构建模板教程<a class="ae ju" href="https://github.com/meteatamel/knative-tutorial/blob/master/docs/10.7-buildpacksbuildtemplate.md" rel="noopener ugc nofollow" target="_blank">中详细展示了如何做到这一点，但让我们在这里重述一下。</a></p><h1 id="1098" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">安装Buildpacks模板</h1><p id="f17a" class="pw-post-body-paragraph iw ix hi iy b iz le jb jc jd lf jf jg jh lg jj jk jl lh jn jo jp li jr js jt hb bi translated">首先，您需要安装Buildpacks模板:</p><pre class="lj lk ll lm fd ln jy lo lp aw lq bi"><span id="9ef1" class="lr kh hi jy b fi ls lt l lu lv">kubectl apply -f https://raw.githubusercontent.com/knative/build-templates/master/buildpacks/cnb.yaml</span></pre><p id="709d" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">并检查模板是否已安装:</p><pre class="lj lk ll lm fd ln jy lo lp aw lq bi"><span id="a5e3" class="lr kh hi jy b fi ls lt l lu lv">kubectl get buildtemplate<br/><br/>NAME             AGE<br/>buildpacks-cnb   1m</span></pre><h1 id="287b" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">设计构建</h1><p id="fb06" class="pw-post-body-paragraph iw ix hi iy b iz le jb jc jd lf jf jg jh lg jj jk jl lh jn jo jp li jr js jt hb bi translated">接下来，让我们创建一个构建，使用构建模板在GitHub ( <a class="ae ju" href="https://github.com/buildpack/sample-java-app.git" rel="noopener ugc nofollow" target="_blank"> sample-java-app </a>)上构建一个示例Java应用程序。创建<code class="du jv jw jx jy b">build.yaml</code>文件:</p><pre class="lj lk ll lm fd ln jy lo lp aw lq bi"><span id="7f5b" class="lr kh hi jy b fi ls lt l lu lv">apiVersion: build.knative.dev/v1alpha1<br/>kind: Build<br/>metadata:<br/>  name: buildtemplate-buildpack-sample-java-app-gcr<br/>spec:<br/>  source:<br/>    git:<br/>      url: <a class="ae ju" href="https://github.com/buildpack/sample-java-app.git" rel="noopener ugc nofollow" target="_blank">https://github.com/buildpack/sample-java-app.git</a><br/>      revision: master<br/>  template:<br/>      name: buildpacks-cnb<br/>      arguments:<br/>      - name: IMAGE<br/>        value: gcr.io/knative-atamel/sample-java-app:buildpack</span></pre><p id="3b71" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">你会注意到的一件事是<code class="du jv jw jx jy b">sample-java-app</code>没有定义<code class="du jv jw jx jy b">Dockerfile</code>。Buildpacks将使用它的自动检测来构建图像，Knative将把它推到在<code class="du jv jw jx jy b">IMAGE</code>参数中指定的位置(在本例中是Google容器注册表)。</p><h1 id="f228" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">运行构建</h1><p id="df01" class="pw-post-body-paragraph iw ix hi iy b iz le jb jc jd lf jf jg jh lg jj jk jl lh jn jo jp li jr js jt hb bi translated">我们终于可以运行构建了:</p><pre class="lj lk ll lm fd ln jy lo lp aw lq bi"><span id="31af" class="lr kh hi jy b fi ls lt l lu lv">kubectl apply -f build.yaml</span></pre><p id="54fb" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">几分钟后，检查构建是否成功:</p><pre class="lj lk ll lm fd ln jy lo lp aw lq bi"><span id="4835" class="lr kh hi jy b fi ls lt l lu lv">kubectl get build</span><span id="7711" class="lr kh hi jy b fi lw lt l lu lv">NAME                                          SUCCEEDED   <br/>buildtemplate-buildpack-sample-java-app-gcr    True</span></pre><p id="5fb9" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">此时，您应该看到图像被推送到Google容器注册表:</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es lx"><img src="../Images/16b17195c5c5c247fea8886c20598c86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xGUemtlwcFlXCgvneo3OOg.png"/></div></div></figure></div><div class="ab cl jz ka gp kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hb hc hd he hf"><p id="e36c" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">与Dockerfiles相比，Knative Build和Buildpacks是在更高抽象层次上构建应用程序的一个很好的组合！</p></div></div>    
</body>
</html>