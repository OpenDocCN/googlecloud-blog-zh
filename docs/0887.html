<html>
<head>
<title>A Clearer Vue in Google Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云中更清晰的Vue</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/a-clearer-vue-in-google-cloud-2370a4b048cd?source=collection_archive---------1-----------------------#2019-01-23">https://medium.com/google-cloud/a-clearer-vue-in-google-cloud-2370a4b048cd?source=collection_archive---------1-----------------------#2019-01-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="5516" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated"><strong class="ak">在几分钟内将Vue.js应用部署到谷歌云平台</strong></h2></div><p id="f8bd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">在本文中，我们将使用</em> <strong class="iz hj"> <em class="jt"> Vue.js </em> </strong> <em class="jt">，</em> <strong class="iz hj"> <em class="jt">节点</em> </strong> <em class="jt">，</em><strong class="iz hj"><em class="jt">Docker</em></strong><em class="jt">和</em> <strong class="iz hj"> <em class="jt">谷歌云平台</em> </strong> <em class="jt">来部署到谷歌计算引擎(GCE)。</em></p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es ju"><img src="../Images/5c2fbb8c2644810ff48af8ad29fe8501.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*GrnZQhGidCAjnfE7CUyzcA.png"/></div></figure><p id="a5b3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae kc" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank">T29】vue . js</a>T32】。一个直观的Javascript前端开发框架，用于构建简单、干净的用户界面、组件等等。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es ju"><img src="../Images/1c0f9b6c8c01f52f8aae683dd8b5887e.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/0*0yV4nqFgfSnrfeaa.png"/></div></figure><p id="fa41" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae kc" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj">谷歌云平台</strong> </a> <strong class="iz hj">。</strong>提供广泛服务的云计算平台。在本文中，GCP将用于部署和托管Vue应用程序。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="daa2" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">我们开始吧</h1><p id="4fb8" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">如果你还没有使用过谷歌云，你可以前往https://console.cloud.google.com注册一个免费账户，起点是300美元。</p><h1 id="3ddc" class="kk kl hi bd km kn lh kp kq kr li kt ku io lj ip kw ir lk is ky iu ll iv la lb bi translated">先决条件</h1><ul class=""><li id="e2d4" class="lm ln hi iz b ja lc jd ld jg lo jk lp jo lq js lr ls lt lu bi translated">一个谷歌云平台账户和谷歌云项目</li><li id="8add" class="lm ln hi iz b ja lv jd lw jg lx jk ly jo lz js lr ls lt lu bi translated">Node.js (v10.x)</li><li id="4649" class="lm ln hi iz b ja lv jd lw jg lx jk ly jo lz js lr ls lt lu bi translated">npm(版本5.6.0)</li><li id="031f" class="lm ln hi iz b ja lv jd lw jg lx jk ly jo lz js lr ls lt lu bi translated">Docker (v18.x)</li><li id="cdc5" class="lm ln hi iz b ja lv jd lw jg lx jk ly jo lz js lr ls lt lu bi translated"><a class="ae kc" href="https://cloud.google.com/sdk/" rel="noopener ugc nofollow" target="_blank"> gcloud </a> (v219.0.1)</li></ul><p id="323e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">作为参考，我在上面包含了库和SDK的版本。我也是在MacOS Mojave上运行，但是也用云壳(Google Cloud的内置终端)验证了这些步骤。</p><h1 id="3526" class="kk kl hi bd km kn lh kp kq kr li kt ku io lj ip kw ir lk is ky iu ll iv la lb bi translated">1)创建并运行Vue应用程序</h1><p id="4140" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">如果您在Mac上，请打开终端并开始。或者，您也可以使用Google Cloud Shell，它是Google Cloud的集成终端。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="er es ma"><img src="../Images/f51d3c72e13e05eac81cc91bbaa4a722.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FMZZjY7nEmlSV8Xu8D01QQ.png"/></div></div><figcaption class="mf mg et er es mh mi bd b be z dx translated">谷歌云控制台</figcaption></figure><ol class=""><li id="d24b" class="lm ln hi iz b ja jb jd je jg mj jk mk jo ml js mm ls lt lu bi translated">设置本地文件夹</li><li id="2c97" class="lm ln hi iz b ja lv jd lw jg lx jk ly jo lz js mm ls lt lu bi translated">创建我们的vue应用</li><li id="e0d7" class="lm ln hi iz b ja lv jd lw jg lx jk ly jo lz js mm ls lt lu bi translated">向vue应用添加vue化</li><li id="10c8" class="lm ln hi iz b ja lv jd lw jg lx jk ly jo lz js mm ls lt lu bi translated">运行应用程序</li></ol><pre class="jv jw jx jy fd mn mo mp mq aw mr bi"><span id="bd9b" class="ms kl hi mo b fi mt mu l mv mw"># let's create our workspace<br/>mkdir vue-google-cloud</span><span id="456b" class="ms kl hi mo b fi mx mu l mv mw">cd vue-google-cloud/</span><span id="792e" class="ms kl hi mo b fi mx mu l mv mw"># install vue<br/>npm install @vue/cli -g</span><span id="433a" class="ms kl hi mo b fi mx mu l mv mw"># create the vue-app (select default settings)<br/>vue create vue-app</span><span id="e312" class="ms kl hi mo b fi mx mu l mv mw">cd vue-app/</span><span id="4f58" class="ms kl hi mo b fi mx mu l mv mw"># add vuetify (select default settings)<br/>vue add vuetify</span><span id="bf99" class="ms kl hi mo b fi mx mu l mv mw"># let's test out the app locally<br/>npm run serve</span></pre><p id="fc69" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">基本的vue app应该在本地托管在<a class="ae kc" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080/ </a>。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="er es my"><img src="../Images/0068fb1e1bbd96041c38f293240b7d0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v5wvxtr33dD0hGKR8yehAA.png"/></div></div><figcaption class="mf mg et er es mh mi bd b be z dx translated"><a class="ae kc" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank">上的vue app http://localhost:8080/</a></figcaption></figure><h1 id="aeaa" class="kk kl hi bd km kn lh kp kq kr li kt ku io lj ip kw ir lk is ky iu ll iv la lb bi translated">2)使用Docker在本地运行我们的应用程序</h1><p id="a320" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">让我们配置一个简单的Dockerfile文件</p><p id="2bd9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">[参考来自Vue网站的<a class="ae kc" href="https://vuejs.org/v2/cookbook/dockerize-vuejs-app.html" rel="noopener ugc nofollow" target="_blank">简单示例的修改]</a></p><p id="7194" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，我们将:</p><ol class=""><li id="5394" class="lm ln hi iz b ja jb jd je jg mj jk mk jo ml js mm ls lt lu bi translated">创建Dockerfile文件</li><li id="d974" class="lm ln hi iz b ja lv jd lw jg lx jk ly jo lz js mm ls lt lu bi translated">建立Docker形象</li><li id="0c39" class="lm ln hi iz b ja lv jd lw jg lx jk ly jo lz js mm ls lt lu bi translated">运行Docker映像</li><li id="289a" class="lm ln hi iz b ja lv jd lw jg lx jk ly jo lz js mm ls lt lu bi translated">测试我们的应用程序正在运行</li><li id="41eb" class="lm ln hi iz b ja lv jd lw jg lx jk ly jo lz js mm ls lt lu bi translated">停止本地Docker映像</li></ol><pre class="jv jw jx jy fd mn mo mp mq aw mr bi"><span id="2cac" class="ms kl hi mo b fi mt mu l mv mw">cat &gt; Dockerfile &lt;&lt; EOF<br/>FROM node:9.11.1-alpine</span><span id="121a" class="ms kl hi mo b fi mx mu l mv mw"># install simple http server for serving static content</span><span id="d768" class="ms kl hi mo b fi mx mu l mv mw">RUN npm install -g http-server</span><span id="e5eb" class="ms kl hi mo b fi mx mu l mv mw">WORKDIR .</span><span id="ce6a" class="ms kl hi mo b fi mx mu l mv mw"># copy both 'package.json' and 'package-lock.json' (if available)</span><span id="12be" class="ms kl hi mo b fi mx mu l mv mw">COPY package*.json ./</span><span id="a927" class="ms kl hi mo b fi mx mu l mv mw"># install project dependencies</span><span id="dee8" class="ms kl hi mo b fi mx mu l mv mw">RUN npm install</span><span id="4c6e" class="ms kl hi mo b fi mx mu l mv mw"># copy project files and folders to the current working directory (i.e. 'app' folder)</span><span id="1deb" class="ms kl hi mo b fi mx mu l mv mw">COPY . .</span><span id="1e79" class="ms kl hi mo b fi mx mu l mv mw"># build app for production with minification</span><span id="3e77" class="ms kl hi mo b fi mx mu l mv mw">RUN npm run build</span><span id="d4f2" class="ms kl hi mo b fi mx mu l mv mw">EXPOSE 8080</span><span id="c54b" class="ms kl hi mo b fi mx mu l mv mw">CMD [ "http-server", "dist" ]</span><span id="8104" class="ms kl hi mo b fi mx mu l mv mw">EOF</span><span id="5b0e" class="ms kl hi mo b fi mx mu l mv mw"># now let's use docker to build a docker image<br/>docker build -t vue-google-cloud/vue-app .</span><span id="bf44" class="ms kl hi mo b fi mx mu l mv mw"># let's run it to verify it all works.  <br/>docker run -d -p 8080:8080 --rm vue-google-cloud/vue-app</span><span id="ac66" class="ms kl hi mo b fi mx mu l mv mw"># check to see that it's working<br/>open localhost:8080</span><span id="159f" class="ms kl hi mo b fi mx mu l mv mw"># get the running docker containers<br/>docker ps</span><span id="ceb7" class="ms kl hi mo b fi mx mu l mv mw"># stop the container.  the id will look similar to 386ab1e23ecd<br/>docker stop [YOUR_CONTAINER_ID from docker ps here]</span></pre><h1 id="1104" class="kk kl hi bd km kn lh kp kq kr li kt ku io lj ip kw ir lk is ky iu ll iv la lb bi translated">3)从Docker到Google容器注册表</h1><p id="c203" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">Google Cloud通过Google Container Registry (gcr.io)内置了对图像的注册表支持。</p><p id="5c8b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将把docker图像的标签推送到gcr.io。</p><pre class="jv jw jx jy fd mn mo mp mq aw mr bi"><span id="126c" class="ms kl hi mo b fi mt mu l mv mw"># set the current project id<br/>PROJECT_ID=$(gcloud config get-value core/project)<br/>echo $PROJECT_ID # just so you know which project you're pushing to</span><span id="8ef4" class="ms kl hi mo b fi mx mu l mv mw"># configure gcloud docker auth, if this hasn't been configured<br/>gcloud auth configure-docker</span><span id="05ae" class="ms kl hi mo b fi mx mu l mv mw"># create a tag<br/>docker tag vue-google-cloud/vue-app gcr.io/$PROJECT_ID/vue-app:v1</span><span id="5ed0" class="ms kl hi mo b fi mx mu l mv mw"># enable the containerregistry.googleapis.com service<br/>gcloud services enable containerregistry.googleapis.com</span><span id="24b4" class="ms kl hi mo b fi mx mu l mv mw"># push our docker image to gcr.io<br/>docker push gcr.io/$PROJECT_ID/vue-app:v1</span></pre><h1 id="ea70" class="kk kl hi bd km kn lh kp kq kr li kt ku io lj ip kw ir lk is ky iu ll iv la lb bi translated">4)部署到GCE(谷歌计算引擎)</h1><p id="a441" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">现在让我们将gcr.io映像部署到Google Cloud GCE虚拟机。</p><p id="5a65" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本节中，我们将:</p><ol class=""><li id="4f2e" class="lm ln hi iz b ja jb jd je jg mj jk mk jo ml js mm ls lt lu bi translated">创建防火墙规则以允许流量流向端口8080</li><li id="0d6d" class="lm ln hi iz b ja lv jd lw jg lx jk ly jo lz js mm ls lt lu bi translated">为默认计算服务帐户添加IAM策略绑定</li><li id="98e1" class="lm ln hi iz b ja lv jd lw jg lx jk ly jo lz js mm ls lt lu bi translated">使用“使用容器创建”部署标志创建一个GCE VM</li><li id="7193" class="lm ln hi iz b ja lv jd lw jg lx jk ly jo lz js mm ls lt lu bi translated">打开端口8080上的外部IP地址</li></ol><pre class="jv jw jx jy fd mn mo mp mq aw mr bi"><span id="4d05" class="ms kl hi mo b fi mt mu l mv mw"># set the current project id<br/>PROJECT_ID=$(gcloud config get-value core/project)</span><span id="7718" class="ms kl hi mo b fi mx mu l mv mw"># create a new service account to be run with the VM<br/>SA_NAME="vue-app-sa"<br/>SA_EMAIL="$SA_NAME@$PROJECT_ID.iam.gserviceaccount.com"<br/>gcloud iam service-accounts create $SA_NAME \<br/> --display-name $SA_NAME \<br/> --project $PROJECT_ID</span><span id="881f" class="ms kl hi mo b fi mx mu l mv mw"># we will need a FW rule to expose tcp:8080<br/>gcloud compute firewall-rules create vue-fw --allow tcp:8080,icmp</span><span id="0a0e" class="ms kl hi mo b fi mx mu l mv mw"># grant the default compute service account view permission to the project to pull the gcr.io image<br/>gcloud projects add-iam-policy-binding $PROJECT_ID \<br/> --member=serviceAccount:$SA_EMAIL \<br/> --role='roles/viewer'</span><span id="a3ad" class="ms kl hi mo b fi mx mu l mv mw"># create the VM with create-with-container<br/>gcloud compute instances create-with-container vue-app-vm \<br/> --container-image=gcr.io/$PROJECT_ID/vue-app:v1 \<br/> --service-account=$SA_EMAIL \<br/> --scopes=https://www.googleapis.com/auth/cloud-platform \<br/> --zone us-west1-a</span><span id="56c8" class="ms kl hi mo b fi mx mu l mv mw"># to see the VMs in our project<br/>gcloud compute instances list</span><span id="e9ed" class="ms kl hi mo b fi mx mu l mv mw"># get the external ip<br/>EXTERNAL_IP=$(gcloud compute instances list --format="get(networkInterfaces[0].accessConfigs[0].natIP)" --filter="name='vue-app-vm'")</span><span id="da87" class="ms kl hi mo b fi mx mu l mv mw"># in your browser, navigate to the echoed address.  NOTE: the deployment may take about a minute.<br/>echo http://$EXTERNAL_IP:8080</span></pre><p id="f707" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">希望万岁！这些步骤应该已经起作用了(部署可能需要一分钟，所以您可能需要刷新页面几次)。</p><p id="f3ca" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过Docker运行我们的Vue应用程序的浏览器窗口应该已经弹出，并且可以在互联网上公开访问。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="er es mz"><img src="../Images/f3476f2fcd76e7dfd21af76fe6dcd3f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6uXUoE-VoTJmltQExeAyGQ.png"/></div></div><figcaption class="mf mg et er es mh mi bd b be z dx translated">托管在外部IP地址上的Vue应用程序</figcaption></figure><h1 id="1c23" class="kk kl hi bd km kn lh kp kq kr li kt ku io lj ip kw ir lk is ky iu ll iv la lb bi translated">5)清理</h1><p id="a527" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">我们可以清理实例，以节省继续运行虚拟机的成本。</p><pre class="jv jw jx jy fd mn mo mp mq aw mr bi"><span id="fbcc" class="ms kl hi mo b fi mt mu l mv mw">gcloud compute firewall-rules delete vue-fw<br/>gcloud compute instances delete vue-app-vm --zone=us-west1-a<br/>gcloud iam service-accounts delete $SA_EMAIL</span></pre><h1 id="6cb7" class="kk kl hi bd km kn lh kp kq kr li kt ku io lj ip kw ir lk is ky iu ll iv la lb bi translated">结论</h1><p id="e7af" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">我们已经介绍了使用Docker、Google Container Registry和Google Compute Engine将Vue.js应用程序简单部署到Google Cloud中托管的外部IP地址。Google Cloud提供了一些补充服务，可以将我们的应用推向生产就绪状态。(即<a class="ae kc" href="https://cloud.google.com/dns/" rel="noopener ugc nofollow" target="_blank">云DNS </a>、<a class="ae kc" href="https://cloud.google.com/load-balancing/" rel="noopener ugc nofollow" target="_blank">云负载均衡</a>、<a class="ae kc" href="https://cloud.google.com/stackdriver/" rel="noopener ugc nofollow" target="_blank"> Stackdriver </a>等。).</p></div></div>    
</body>
</html>