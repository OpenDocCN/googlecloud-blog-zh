<html>
<head>
<title>Change Streams in Cloud Spanner | Replication to BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将云扳手|复制中的流更改为BigQuery</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/change-streams-in-cloud-spanner-replication-to-bigquery-61b20b78118a?source=collection_archive---------0-----------------------#2022-06-29">https://medium.com/google-cloud/change-streams-in-cloud-spanner-replication-to-bigquery-61b20b78118a?source=collection_archive---------0-----------------------#2022-06-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="be56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">谷歌云扳手</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/1068542b4acd41ebfc53e36869f2e57a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PGfq-8n4B31oT7zAMkYnGA.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">由<a class="ae jt" href="https://unsplash.com/@purzlbaum?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">克劳迪奥·施瓦茨</a>在<a class="ae jt" href="https://unsplash.com/s/photos/data-analysis?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="493d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Cloud Spanner是Google高度可扩展和完全托管的关系数据库服务。它是传统数据库结构的复制品，结合了水平扩展、ACID事务和SQL语义的附加功能。它还提供了跨多个区域的强大一致性，并且仍然可以在低延迟的情况下使用。它的可用性SLA为99.999%，将每月停机时间缩短至23秒。简而言之，这是一个不折不扣的数据库。最初，Cloud Spanner没有捕捉数据更改的功能，因此，为了克服这一缺陷，Google现在引入了Cloud Spanner更改流。借助这一新功能，用户可以从Spanner到不同的云服务观察和传输近乎实时的数据变化。这里，我们将专门讨论将spanner数据更改复制到BigQuery以用于分析目的。</p><p id="25c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">读取变更流的方法</strong></p><ul class=""><li id="e9a5" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated">通过数据流—使用Apache Beam SpannerIO连接器，这是读取变更流的推荐方法。谷歌还提供了数据流模板，为常见用例构建数据流管道，如将数据流更改到BigQuery和谷歌云存储。我们可以预期在不久的将来会出现更多这样的模板来集成不同的服务。在本文中，我们将讨论这种方法。</li><li id="aa96" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">通过API —使用变更流查询API。该方法允许灵活地编写使用Spanner API读取变更流的定制代码/查询。必须使用ExecuteStreamingSql API执行查询。一个特殊的表值函数(TVF)会随着变更流自动创建。这提供了对更改流记录的访问，并且对返回结果集的大小没有限制。</li></ul><p id="8bf3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">技术架构</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ki"><img src="../Images/1270f02e3a184afafd9250ad5c14d8cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_wZj5txIR4-MiQ1tEITRBQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图1:架构流程</figcaption></figure><p id="e8fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">先决条件</strong></p><ul class=""><li id="7826" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated">使用数据库和表在Cloud Spanner中创建一个实例</li><li id="40a3" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">为读取而创建的更改流</li><li id="e899" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">在BigQuery中创建的数据集</li><li id="241f" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">必须创建一个服务帐户，并授予其以下IAM权限</li></ul><ol class=""><li id="3a59" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc kj ka kb kc bi translated">访问数据库、表格和索引(spanner.databases.select)</li><li id="27e2" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc kj ka kb kc bi translated">用于模式更改(spanner.databases.updateDdl)</li><li id="4ef8" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc kj ka kb kc bi translated">对GCS存储桶的读/写权限(存储管理员角色)</li><li id="2963" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc kj ka kb kc bi translated">启动和执行数据流作业(数据流工作者)</li><li id="2d48" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc kj ka kb kc bi translated">对BigQuery数据集(bigquery.dataEditor)的读/写/查询权限。</li></ol><p id="fe7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">创建变更流</strong></p><p id="42e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一步是创建一个变更流，假设已经在Cloud Spanner中创建了数据库和表。Spanner像对待其他模式对象一样对待变更流，因此可以使用DDL语句对其执行创建、修改、挂起和删除等操作。在创建变更流的同时，我们还可以灵活地跟踪各种选项的变更。它可以针对特定的表或特定的列，也可以针对数据库中的整个对象。我们可以在一个数据库中有一个或多个变更流。我们还可以选择为特定变更流所跟踪的数据定义保留期。该值的范围从最小24小时/1天到最大7天。默认情况下，更改流将24小时作为retention_period。一旦创建了变更流，您就可以返回到数据库概述，并检查变更流正在跟踪哪些对象。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kk"><img src="../Images/f9b364802a15a88259bf454da023cc1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GfRzHbriOFknKM5Q"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图2:创建变更流</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kk"><img src="../Images/14b9cf2e50eec5eb2a4aea445b683adf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IfvGflkJgaAHbIgD4XS51Q.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图3:扳手数据库概述</figcaption></figure><p id="234f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">创建数据流管道</strong></p><p id="2e92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第二步是用现有模板创建一个数据流作业。目前，我们只有两个变更流模板。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kl"><img src="../Images/aa18fd16c4efbf2c7e1cce5e1f071370.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NpmZFSdRy-R1lj3u"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图4:创建数据流作业</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es km"><img src="../Images/db7bed2b2af6c179bdb5ff4338a350d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XGODWNXEHKZ-6hiJRFl6dw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图5:作业模板参数</figcaption></figure><p id="4e8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦创建了作业，需要一段时间才能达到运行状态，因为数据流作业在apache beam上运行。资源按需从头开始旋转，并在作业完成后删除。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kn"><img src="../Images/814ab59985fc3100818671e9cfd440a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mU_yObc-uXjRhJgAU-wUzg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图6:工作概述</figcaption></figure><p id="5742" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦作业开始运行，我们就可以从作业页面跟踪作业图表、执行细节</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ko"><img src="../Images/e9d0100d12f697e6935d865f4dd5ad49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DB-4Z3hpQLFhfyeaUQRreA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图7:工作图表</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ko"><img src="../Images/2fcbc22203b618857ecf78ccbf8efabe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3leP1DY-5kfSlzrpXyVRFA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图8工作图表</figcaption></figure><p id="455d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">数据变更—插入</strong></p><p id="0c4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">各种DML操作都可以通过控制台执行。从insert操作开始，该操作已成功地将数据推入现有表中(student)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ko"><img src="../Images/f423afe31e62a5c47440b087055420fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FkIPbKRnr4mxDQC7en4s1Q.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图9:扳手中的插入操作</figcaption></figure><p id="4775" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">处理完数据后，在BigQuery中自动创建相应的表，命名约定为<strong class="ih hj"> tablename_changelog </strong>。在本例中，它是student_changelog。管道具有这样的功能，它将根据BigQuery映射数据类型，然后复制Cloud Spanner中定义的模式。还创建了一些附加字段作为元数据表的一部分，元数据表在处理数据时自行创建。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ko"><img src="../Images/567040dd6e77625d5b5dfabab1ce7225.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6kysQefeHSIR5cNX-1D7Yw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图10:大查询表</figcaption></figure><p id="c635" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Cloud Spanner中插入的数据被捕获并显示在BigQuery表中。为了验证获取的操作的类型，我们可以检查<strong class="ih hj">_ metadata _ spanner _ mod _ type _</strong>列</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ko"><img src="../Images/8f8c9ecdfd43a2cee4a783df924d08fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7doDYTcE0dFsxmYI0mK2jg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图11:big query表中插入的记录</figcaption></figure><p id="2ed3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">数据变更—更新</strong></p><p id="66b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新云扳手中的一个或多个字段记录</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ko"><img src="../Images/1d837f8c550e64442f440be605d72938.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rk0lji_ZzyBEj1DAYkIgag.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图12:更新扳手中的记录</figcaption></figure><p id="ccd4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">被更新的字段可以在BigQuery表中看到，带有更新的记录，而不改变其他列的值。尽管可以使用变更流来跟踪更新，但是我们必须意识到，在BigQuery中，现有的记录不会被更新。相反，一条新记录被插入到表中，所有更新和<strong class="ih hj"> mod_type </strong>值被更新。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ko"><img src="../Images/2b6a9777e8f85c654e25ba3eaf46a68e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sH-3_gEeYXQZZcicYFdb7A.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图13:big query表中更新的记录</figcaption></figure><p id="e6ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">数据变更—删除</strong></p><p id="1b13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除云扳手中的一条或多条字段记录</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ko"><img src="../Images/5733a6f1d931ce6722f72f645966c52c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*836toX3XMj9SvtI2KTrv5w.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图14:删除扳手中的记录</figcaption></figure><p id="f46d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据被删除，并在BigQuery表中显示为空记录</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kp"><img src="../Images/69916aa6b85bcd41754e8e87d9ff40df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qgvs3FVigTczMifce2sRjA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图15:在Bigquery表中作为null输入的已删除记录</figcaption></figure><p id="32b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">数据变更—添加表</strong></p><p id="74c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在流作业仍在运行时添加一个表，该表显示在Spanner中，由于更改流设置为“全部”，它会自动开始监视创建的附加表。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kq"><img src="../Images/a8bcb223c960fd6035b1c2993242d74d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QG9uaIFA1LSXhqQzlDKvVg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图16:在扳手中添加新表</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kq"><img src="../Images/735190409825964270b321f6e003f29a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qhQW8MtXOiOru97xzXFnIw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图17:被变更流监视的添加的表</figcaption></figure><p id="9864" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还可以对创建的附加表执行DDL操作。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kr"><img src="../Images/daf9e07adcc5aca9eeb578ca86ac3c2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tRQF27_ww382UWxZuNf2Gw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图18:在新表上执行DDL</figcaption></figure><p id="05b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">即使数据被插入到Cloud Spanner的表中，它也无法到达BigQuery，并作为失败的记录被复制到云存储桶中。发生这种情况的原因是，当管道运行时，模板不具备捕获在架构级别或表级别发生的更改的功能。要捕获任何其他更改，必须创建新的管道。</p><p id="085c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:一旦建立了管道，存储桶就会自动创建，以存储临时数据、暂存数据和失败数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kr"><img src="../Images/91967f0ed429f099ec264f91f2ae6e53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rjb_V43Y0NKweaTCKhzHHg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图19 : GCS存储桶捕获失败记录</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ks"><img src="../Images/5444fa3e0fad57c26d443fd6bbf3f6a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YcvHj25o574rUlcxaJhjAg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图20:JSON格式的失败记录</figcaption></figure><p id="960d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">数据更改—从现有表中删除列</strong></p><p id="a0d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Cloud Spanner中修改现有表的模式。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es km"><img src="../Images/aa91a8aff2b54a7fe8912e0be7e68fb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z8rnrdsMxtywttMDO4o-tA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图21:表列上的DDL操作</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es km"><img src="../Images/b37dfe7ab4fe31cc44450c88c298259a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pu7Kqw27-B-XukwFsB5L5A.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图22:删除一列</figcaption></figure><p id="3116" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">修改的模式反映在扳手中，但是变更流无法捕获它。在BigQuery中，既不会改变表模式，也不会创建具有已更改模式的新表。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es km"><img src="../Images/d16ec47cc1e7cde0cd480c91a7c7c68d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SCGKeAU9x_VpmLMYKngsUw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图23:删除列后更新的模式</figcaption></figure><p id="b845" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">变更流的限制</strong></p><ul class=""><li id="5fd5" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated">每个数据库只能创建10个变更流。</li><li id="6842" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">像JSON和STRUCT这样的字段类型无法复制到BigQuery中。</li><li id="835d" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">如果定义为“all ”,它可以监视表和列发生的所有变化。</li><li id="dc7b" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">它只能捕获由于在创建更改流之前对定义的对象执行插入、更新和删除操作而发生的更改。</li><li id="87fa" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">它只能监视用户创建的列和表的数据更改。</li><li id="797b" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">它不捕获发生在数据库级别的任何修改，例如添加/删除表、向现有表添加/删除列。</li><li id="85aa" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">一个变更流不会观察其他的变更流。</li><li id="10a6" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">到目前为止，我们在数据流中只有两个用于变更流的模板。</li></ul><p id="d1ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结论</strong></p><p id="7ca6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更改流支持数据无缝流入BigQuery，以确保来自Cloud Spanner的最新数据可用于分析和其他下游用例。</p><p id="84ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请关注此空间，获取更多此类文章。欢迎任何意见或反馈。</p><p id="5cc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我要特别感谢Sekhar Mandapati，Sagar Chavan鼓励我完成这件作品，也感谢T2 Sushant Nigudkar在遇到阻碍时给予我的支持。</p><p id="1c6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参考资料:<a class="ae jt" href="https://cloud.google.com/blog/products/databases/track-and-integrate-change-data-with-spanner-change-streams" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/blog/products/databases/track-and-integrate-change-data-with-spanner-change-streams</a></p></div></div>    
</body>
</html>