<html>
<head>
<title>Cost Analysis of GKE Cluster using Kube Cost</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Kube成本的GKE集群成本分析</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/cost-analysis-of-gke-cluster-using-kube-cost-ea8e9dba9c81?source=collection_archive---------4-----------------------#2022-11-17">https://medium.com/google-cloud/cost-analysis-of-gke-cluster-using-kube-cost-ea8e9dba9c81?source=collection_archive---------4-----------------------#2022-11-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c4fdccce18d71a71e48803daa9ee9d2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B95tLtambsq6TCWXic2hKA.png"/></div></div></figure></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><p id="c9ba" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">客户多次要求详细了解Kubernetes在多个集群的多个pod上托管的所有工作负载的成本。当大型企业涉及多个业务部门时，分析K'8成本对于成功实施按存储容量使用计费模型至关重要。</p><p id="ed9a" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">虽然市场上包括云原生成本分析在内的工具很少，但Kubecost是提供最全面视图的工具之一。</p><p id="2d25" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">期望值设置</strong></p><p id="50fd" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">到本博客结束时，你将能够在GKE集群上安装Kubecost，分析与所有Pod相关的成本，命名空间，在任何后端存储数据。</p><p id="addd" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">先决条件</strong></p><p id="0658" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">对于此演示，我们将使用托管在GCP的GKE集群。假设我们拥有在GCP集群上执行操作的管理员权限。</p><p id="1c46" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">什么是Kubecost？</strong></p><p id="7f34" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">Kubecost是一个分析本地托管集群或任何云提供商的K'8成本的工具。Kubecost提供了多种集成选项，并提供了成本和集群运行状况的详细视图。Kubecost功能可以进一步扩展，集成到Prometheus、Grafana和其他多种工具中。它还提供了关于成本节约和成本优化的建议。详细的文档可以在<a class="ae jv" href="https://guide.kubecost.com/hc/en-us/articles/4407595947799-Getting-Started" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="2e98" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">安装Kubecost </strong></p><p id="381c" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">Kubecost可以使用Kubecost提供的舵图进行安装。</p><ol class=""><li id="5773" class="jw jx hi iz b ja jb je jf ji jy jm jz jq ka ju kb kc kd ke bi translated">登录到您的Kubernetes集群后，按照以下步骤操作。</li></ol><p id="dec6" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><em class="kf"> kubectl创建命名空间kube cost<br/>helm repo add kube cost</em><a class="ae jv" href="https://kubecost.github.io/cost-analyzer/" rel="noopener ugc nofollow" target="_blank"><em class="kf">https://kubecost.github.io/cost-analyzer/</em></a><em class="kf"><br/>helm install kube cost kube cost/cost-analyzer—命名空间kube cost—set kube cost token = " ymhhdmlzahlz 3 vwdge 1 mubnbwfpbc 5 JB 20 = XM 343 yadf 98 "</em></p><figure class="kh ki kj kk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kg"><img src="../Images/e30abe5118f79b3410e79801bd4b960b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J087aTPKQF7z9OpngW6y8g.png"/></div></div></figure><p id="0ef0" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">2.启用端口转发(您可以使用入口重定向到控制台)</p><p id="a46a" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><em class="kf"> kubectl port-forward —名称空间kube cost deployment/kube cost-cost-analyzer 9090</em></p><figure class="kh ki kj kk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kg"><img src="../Images/70200c8db79374249084c9fa2ef09f2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UW_pTwIFvB-6bTr8K23uLw.png"/></div></div></figure><p id="bf07" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">3.使用<ipaddress> :9090登录控制台并查看数据。在我们的例子中，我们已经转发到localhost，因此它的localhost:9090</ipaddress></p><figure class="kh ki kj kk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kg"><img src="../Images/b46c872e7d41751f2938e36e41589130.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iskApl8Ai-E0vRx46Ntc_g.png"/></div></div></figure><h1 id="f9b9" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">成本分析</h1><ol class=""><li id="5f33" class="jw jx hi iz b ja lj je lk ji ll jm lm jq ln ju kb kc kd ke bi translated">您可以基于窗格、名称空间、标签或您希望创建的任何自定义过滤器来查看成本。下面，我们基于名称空间汇总了过去7天的数据。我们可以聚合多达90天的数据，并将其存储在任何自定义位置，如GCS bucket。</li></ol><figure class="kh ki kj kk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/06898f54bc770ba1dbf9c1f9a20182e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QQUFSLxuP_QHnUgOXo8Qdg.png"/></div></div></figure><p id="799b" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">2.Kubecost根据pod的利用率数据提出了节约和成本优化的机会。它根据利用率提供有关调整pod、本地磁盘和集群节点大小的报告。下面是储蓄选项的片段。</p><figure class="kh ki kj kk fd ij er es paragraph-image"><div class="er es lp"><img src="../Images/e369c0a5a0f3849e0c786b0d7d50a119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*7Eh3iFDGOna6FHGRGJ978w.png"/></div></figure><p id="04d3" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">3.Kubecost还提供了K'8集群的整体运行状况和范围。</p><figure class="kh ki kj kk fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/ec799833c00d1f5ed8aadb2657534818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*P6Hphym2yDq0xsR0UWT1ZQ.png"/></div></figure><p id="a031" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">4.Kubecost还提供了带有高级过滤器的详细报告选项。这些报告可以保存在外部存储桶中，也可以通过电子邮件发送。</p><figure class="kh ki kj kk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/04d7f2a9ed97fc9d3b56a67eda56cdca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EWt2Oda2CX4enCCc55XpCg.png"/></div></div></figure><p id="cc26" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">5.它还可以与Prometheus，Grafana集成，以进一步扩展功能，并具有根据位置设置货币的选项。</p><figure class="kh ki kj kk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kg"><img src="../Images/1cb2082d6f6fdb9a4e3e08493f5e1c0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fus4Wc2KfSNUKFwgtAM_8Q.png"/></div></div></figure><h1 id="63f3" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">结论</h1><p id="bff9" class="pw-post-body-paragraph ix iy hi iz b ja lj jc jd je lk jg jh ji ls jk jl jm lt jo jp jq lu js jt ju hb bi translated">Kubecost的一个最好的特性是，它允许分摊一些常见名称空间的成本，如Kube system、kube public，并平等地添加到所有其他名称空间。Kubecost还允许根据标签进一步降低成本，以增加粒度。总的来说，这是一个很好的工具，可以可视化企业中多个Kubernetes集群的成本。根据不同Kubecost计划中涵盖的集群数量，它有一些相关的成本，请参见<a class="ae jv" href="https://www.kubecost.com/pricing" rel="noopener ugc nofollow" target="_blank">此处的</a>。</p></div></div>    
</body>
</html>