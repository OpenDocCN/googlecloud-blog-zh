<html>
<head>
<title>Stream Twitter Data into BigQuery with Cloud Dataprep</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用云Dataprep将Twitter数据流入BigQuery</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/stream-twitter-data-into-bigquery-with-cloud-dataprep-73aa8998fcc1?source=collection_archive---------0-----------------------#2018-01-30">https://medium.com/google-cloud/stream-twitter-data-into-bigquery-with-cloud-dataprep-73aa8998fcc1?source=collection_archive---------0-----------------------#2018-01-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/c06d953baae90c90bf6ac423510f00e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KbR3sE6WRNsUqJGV_-wKIg.png"/></div></div></figure><div class=""/><div class=""><h2 id="f557" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">受<a class="ji jj ge" href="https://medium.com/u/247b0630b5d6?source=post_page-----73aa8998fcc1--------------------------------" rel="noopener" target="_blank">拉克什马南V </a>的<a class="ae jk" rel="noopener" href="/google-cloud/how-to-schedule-a-bigquery-etl-job-with-dataprep-b1c314883ab9">文章</a>的启发，展示了几个额外的特性</h2></div><blockquote class="jl jm jn"><p id="2999" class="jo jp jq jr b js jt iu ju jv jw ix jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">这里提到的所有代码都可以在我的<a class="ae jk" href="https://github.com/jeremylorino/gcp-dataprep-bigquery-twitter-stream" rel="noopener ugc nofollow" target="_blank"> git repo </a>中找到。贡献，偷窃，或者什么都不做——你的选择；)</p></blockquote><p id="6bb9" class="pw-post-body-paragraph jo jp ht jr b js jt iu ju jv jw ix jx kl jz ka kb km kd ke kf kn kh ki kj kk hb bi translated">让我们看看通过监听<a class="ae jk" href="https://developer.twitter.com/en/docs/tweets/filter-realtime/overview" rel="noopener ugc nofollow" target="_blank"> Twitter的流媒体API </a>可以获得多少数据。我将把代码分成几块来解释，但是所有这些都包含在<a class="ae jk" href="https://github.com/jeremylorino/gcp-dataprep-bigquery-twitter-stream" rel="noopener ugc nofollow" target="_blank"> git repo </a>中。</p><h2 id="4924" class="ko kp ht bd kq kr ks kt ku kv kw kx ky kl kz la lb km lc ld le kn lf lg lh li bi translated">听流媒体Twitter数据</h2><p id="1f8c" class="pw-post-body-paragraph jo jp ht jr b js lj iu ju jv lk ix jx kl ll ka kb km lm ke kf kn ln ki kj kk hb bi translated">下面我们将利用一个<em class="jq"> TwitterStream </em>助手类，它接受一组关键字来过滤实时tweet流。</p><figure class="lo lp lq lr fd hk"><div class="bz dy l di"><div class="ls lt l"/></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">用Twitter关键字过滤器配置流监听器</figcaption></figure><p id="3571" class="pw-post-body-paragraph jo jp ht jr b js jt iu ju jv jw ix jx kl jz ka kb km kd ke kf kn kh ki kj kk hb bi translated">然后，我们将一个事件监听器绑定到从上面的<em class="jq"> TwitterStream </em>实例发出的数据事件。这个侦听器将捕获所有以JSON形式发出的tweets，并将它们缓冲到一个工作数组中。一旦缓冲区满了，通过<em class="jq"> StorageProvider </em>将工作数组的副本保存到配置好的Google云存储桶中；并且工作数组被清空以允许更多的tweets。</p><figure class="lo lp lq lr fd hk"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="f319" class="pw-post-body-paragraph jo jp ht jr b js jt iu ju jv jw ix jx kl jz ka kb km kd ke kf kn kh ki kj kk hb bi translated">还有别忘了你的<em class="jq"> config.json </em>。填写您的GCP项目id、默认应用程序凭据的位置、twitter应用程序凭据和存储桶名称。</p><figure class="lo lp lq lr fd hk"><div class="bz dy l di"><div class="ls lt l"/></div></figure><h2 id="6fa0" class="ko kp ht bd kq kr ks kt ku kv kw kx ky kl kz la lb km lc ld le kn lf lg lh li bi translated">将云存储文件夹导入到Dataprep</h2><p id="114b" class="pw-post-body-paragraph jo jp ht jr b js lj iu ju jv lk ix jx kl ll ka kb km lm ke kf kn ln ki kj kk hb bi translated">打开<a class="ae jk" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">谷歌云平台仪表盘</a> —从左上角菜单中选择；数据准备。</p><blockquote class="jl jm jn"><p id="105b" class="jo jp jq jr b js jt iu ju jv jw ix jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">它出现在列表的最底部是很正常的——除非你把它钉在了你的最爱上。</p></blockquote><figure class="lo lp lq lr fd hk er es paragraph-image"><div class="er es ly"><img src="../Images/c8f72aec923cebb92cd4c90aeba2b1e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*3JLO3y2zBibEG3DnmHSDnQ.png"/></div></figure><p id="5d75" class="pw-post-body-paragraph jo jp ht jr b js jt iu ju jv jw ix jx kl jz ka kb km kd ke kf kn kh ki kj kk hb bi translated">导入数据集的快速视频。说真的，很快。</p><figure class="lo lp lq lr fd hk"><div class="bz dy l di"><div class="lz lt l"/></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">导入数据集</figcaption></figure><h2 id="62f1" class="ko kp ht bd kq kr ks kt ku kv kw kx ky kl kz la lb km lc ld le kn lf lg lh li bi translated">争论新导入的数据集</h2><p id="48c1" class="pw-post-body-paragraph jo jp ht jr b js lj iu ju jv lk ix jx kl ll ka kb km lm ke kf kn ln ki kj kk hb bi translated">Cloud Dataprep的出色之处在于它希望您“争论”您的数据。对身为德州人的我特别有吸引力。</p><p id="c788" class="pw-post-body-paragraph jo jp ht jr b js jt iu ju jv jw ix jx kl jz ka kb km kd ke kf kn kh ki kj kk hb bi translated">至少有10，000篇深入的云数据准备文章，我将坚持基本的。</p><figure class="lo lp lq lr fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ma"><img src="../Images/e1ddf3879d7ad7db9150371a0932bcc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cjuDzO2aUEm0-1l0iAb1xg.png"/></div></div></figure><p id="3e3d" class="pw-post-body-paragraph jo jp ht jr b js jt iu ju jv jw ix jx kl jz ka kb km kd ke kf kn kh ki kj kk hb bi translated">现在运行作业哟。(右上)</p><figure class="lo lp lq lr fd hk er es paragraph-image"><div class="er es mb"><img src="../Images/14dcdf97b432eeda00e7683a84382369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*QqBd8sVf3Di6--Q184IWiA.png"/></div></figure></div><div class="ab cl mc md gp me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hb hc hd he hf"><h2 id="7108" class="ko kp ht bd kq kr ks kt ku kv kw kx ky kl kz la lb km lc ld le kn lf lg lh li bi translated">将Dataprep ETL调度到BigQuery</h2><p id="cbf8" class="pw-post-body-paragraph jo jp ht jr b js lj iu ju jv lk ix jx kl ll ka kb km lm ke kf kn ln ki kj kk hb bi translated">我们将要经历的这个小场景最棒的部分是:我们在云存储空间中选择一个“文件夹”。每次运行该流时，它都会提取文件夹中的所有文件，并将这些文件视为要争论的数据集。因此，当TwitterStream收集器运行并将文件转储到云存储中时，Dataprep将能够持续获得最新和最好的。</p><figure class="lo lp lq lr fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ma"><img src="../Images/62b59fdda21c24dec1670f3e70fe1cb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jQkX8tFaX3Sk0mw1qSEX4A.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">向您的流程添加计划</figcaption></figure><figure class="lo lp lq lr fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ma"><img src="../Images/2ca68a140348e0a9079122dfd0399d29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8T9wCNtsZXIjwMj2l8OcxQ.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">每小时；整点过15分钟</figcaption></figure><figure class="lo lp lq lr fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ma"><img src="../Images/65495be3647adada033a52d013c82cc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9lL-pHRVWY3o68T6RL4qsg.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">选择一个大查询数据集</figcaption></figure><figure class="lo lp lq lr fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ma"><img src="../Images/2634016e6080d45548ece9122ec5eb62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6xGI_LxmkT4N4pq75EDvjA.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">选择“创建新表”</figcaption></figure><figure class="lo lp lq lr fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ma"><img src="../Images/1368b6dec3376680839a5094b0026f84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sv_hvURYFAWTA5_wEffm6g.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">选择“每次运行时创建新表”</figcaption></figure><figure class="lo lp lq lr fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ma"><img src="../Images/84be429ecb72709c5d53ce077df30299.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1kKwFK34XaxeVgj5dFC2KA.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">最终结果</figcaption></figure></div><div class="ab cl mc md gp me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hb hc hd he hf"><blockquote class="mj"><p id="4e51" class="mk ml ht bd mm mn mo mp mq mr ms kk dx translated">下次…用Datastudio可视化</p></blockquote><figure class="mt mu mv mw mx hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/c06d953baae90c90bf6ac423510f00e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KbR3sE6WRNsUqJGV_-wKIg.png"/></div></div></figure></div></div>    
</body>
</html>