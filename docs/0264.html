<html>
<head>
<title>Analyze your Google Cloud Platform Bills w/BigQuery &amp; Data Studio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用BigQuery &amp; Data Studio分析您的Google云平台账单</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/analyze-your-google-cloud-platform-bills-w-bigquery-data-studio-7c9ebeb31b56?source=collection_archive---------0-----------------------#2017-04-22">https://medium.com/google-cloud/analyze-your-google-cloud-platform-bills-w-bigquery-data-studio-7c9ebeb31b56?source=collection_archive---------0-----------------------#2017-04-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="05ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">至少可以说，目前谷歌云平台(GCP)的详细账单交易视图还处于起步阶段。它可以使用一些改进来帮助你了解你的钱去了哪里，这个指南告诉你如何解决这个问题。</p><p id="aecc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将构建这个(或更好的东西):</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/7534a8585e6fe32634f54d3ed06e9d91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2862tC6TeiZEWxM2fKwABw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">谷歌数据工作室成本分析</figcaption></figure><p id="f382" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由此可知:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jt"><img src="../Images/b436db733bb66187f9d452f1ee6ab316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ELLO8xKTyvVaTTK5x7JVHg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">详细交易视图</figcaption></figure><p id="aaff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你读过我以前在GCP的帖子(这里是<a class="ae ju" rel="noopener" href="/@mediocrity/from-idea-to-deployed-on-gcp-in-24hrs-927eaf8a5939"/>和<a class="ae ju" rel="noopener" href="/@mediocrity/scaling-google-app-engine-to-no-instances-or-maybe-just-1-37be4e8d4230">这里是</a>)，你会注意到我已经开始在他们的服务上花一些小额美元了。如果你选择做同样的事情(或者花大笔的钱)，你可能会想要比你收到的账单所提供的更多的数据，而当前的界面可以提供更多的数据。本操作指南将引导您设置Data Studio，开始用BigQuery中导出的数据分析您的账单。</p><h1 id="5775" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">费用</h1><p id="33ab" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">在我们进入BigQuery和Data Studio之前，先简单说一下成本。<em class="ky">数据工作室</em>的费用目前<strong class="ih hj">免费</strong>，甜！<em class="ky"> BigQuery </em>的成本稍微复杂一点(见<a class="ae ju" href="https://cloud.google.com/bigquery/pricing" rel="noopener ugc nofollow" target="_blank">此处</a>)。</p><p id="0bfd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">截至撰写本文时，BigQuery 存储了0.02美元/克，插入了0.05美元/克的流，查询了5美元/吨。我目前的GCP账单大约是MB/m，这将使我每月花费几分钱(如果不是免费的话)。即使您运行数千个实例，并利用GCP的几个产品，您的账单仍可能只是低阶GB/m(但请计算一下！).在这种情况下，存储数据、检索数据、甚至查询数据仍然非常便宜(假设您不是每秒都在查询，只是每天或每周查看报告)。</p><h1 id="7ebc" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">演员表</h1><p id="e585" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">在<strong class="ih hj">计费</strong> &gt; <strong class="ih hj">交易</strong>下，您将可以访问所使用的资源类型、时间段总计(到目前为止的第一个月)、总使用量以及总成本。从下面的截图中，您可以立即看到如何限制您的账单视图。</p><p id="ec00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，如果您运行<em class="ky">多个</em> App Engine应用程序，您将无法进一步分解它。</p><p id="4082" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在GCP界面中，您可以看到的最详细的账单是详细交易视图:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jt"><img src="../Images/b436db733bb66187f9d452f1ee6ab316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ELLO8xKTyvVaTTK5x7JVHg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">详细交易视图</figcaption></figure><p id="9eaf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么接下来该怎么办呢？有几个选择。大多数人会希望启用<strong class="ih hj">账单导出</strong>，这样他们就可以获得每日的详细账单(文件),可以像在MS Excel或他们熟悉的任何工具中进行传统分析那样进行更详细的分析。要启用，只需从计费菜单跳到<strong class="ih hj">计费导出</strong>项，点击对话框。</p><p id="c0b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有一个<strong class="ih hj"> BigQuery导出</strong>，这是我们将关注的地方，因为它更容易/更简单，更可持续，并且有了Data Studio，更符合逻辑。</p><p id="5137" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于<strong class="ih hj">文件导出</strong>，需要一天时间才能出现在您设置/指定的存储桶中(必须提前创建)。一旦有了，你就可以下载来查看。</p><p id="967d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于<strong class="ih hj"> BigQuery导出</strong>，您需要首先创建一个数据集。遵循对话框，在BigQuery UI中，单击您的<strong class="ih hj">项目名称</strong> &gt; <strong class="ih hj">右侧的小向下箭头，创建新数据集</strong>。给它一个名称、位置和数据有效期。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kz"><img src="../Images/27242b5f088f22d4e90ac55e30b711be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*My6RMNIBAVzYjz9xkUrBZg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">创建新数据集</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es la"><img src="../Images/0a89e572ae5f6ddd11993f8562b7bb14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9nj3Kbd6xRXH7lcDd726Qw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">创建数据集</figcaption></figure><p id="1e93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成后，返回计费界面并<strong class="ih hj">启用BigQuery导出</strong>。</p><blockquote class="lb lc ld"><p id="7f59" class="if ig ky ih b ii ij ik il im in io ip le ir is it lf iv iw ix lg iz ja jb jc hb bi translated">当您启用这两个选项中的任何一个时，显然会有与GCS(存储)和BigQuery相关联的成本，并且您可能希望在启用之前查看这些成本，如上面的成本一节中所讨论的。</p></blockquote><p id="4073" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">几个小时后，您将开始看到BigQuery表，而对于文件导出，您可能需要等待一夜。两个导出都没有回填，因为这是<strong class="ih hj">严格前移</strong>。如果你想分析以前的成本，不幸的是你无能为力。</p><h1 id="5187" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">分析成本:BigQuery w/Data Studio</h1><p id="0863" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">在BigQuery中，你可以对你的成本数据做很多事情，我相信大公司有一套他们在某个时间间隔参考的视图。至于我的用例，我想了解两个项目:</p><ol class=""><li id="1c0a" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lm ln lo lp bi translated">我一天的费用是多少？</li><li id="3ba4" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">每个GAE应用程序的成本是多少？</li></ol><blockquote class="lb lc ld"><p id="79ff" class="if ig ky ih b ii ij ik il im in io ip le ir is it lf iv iw ix lg iz ja jb jc hb bi translated">这些问题大部分的副文是“你能在哪里省钱？你能关什么？”我不打算在这个指南中讨论这个问题。</p></blockquote><p id="a13f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在查看工具来回答这个问题以确保我没有重新创建轮子时，我遇到了Google Data Studio ( <a class="ae ju" href="https://www.google.com/analytics/data-studio/" rel="noopener ugc nofollow" target="_blank">链接</a>)。这看起来像是一个测试版产品，有一个用于可视化数据的BigQuery连接器。本教程的开头也很好地记录在谷歌的例子(<a class="ae ju" href="https://cloud.google.com/bigquery/docs/visualize-data-studio" rel="noopener ugc nofollow" target="_blank">链接</a>)中，你更喜欢在那里跟随它。</p><p id="3486" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<strong class="ih hj">注册</strong>按钮后，你会进入一个有点熟悉的Google Drive界面，尽管还有一些选项。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lv"><img src="../Images/e33a6ef76c04e6d9575732de72767e35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SPm9PZ3EC0gTGrf8V3LcdQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Google Data Studio登录页面</figcaption></figure><p id="e0a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要创建我们的第一个报告，请单击右下角的+按钮，并回答入门提示。完成后，您必须再次单击它。</p><p id="6656" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">右下方:<strong class="ih hj">新建数据源&gt; BigQuery &gt;授权&gt;我的项目&gt;YOUR _ PROJECT&gt;YOUR _ DATASET(billing)&gt;GCP _ billing _ export _ FOO&gt;Connect</strong>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lv"><img src="../Images/8a2a0eb4815a1ad98791cb9ca8ba267d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O0EbcnFujzLsFqYZGahULw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">创建新数据源</figcaption></figure><p id="39e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦选择了Connect，字段名应该以正确的<em class="ky">类型</em>和<em class="ky">聚合</em>显示出来。选择右上角的<strong class="ih hj">添加到报告</strong>，您应该不需要做任何更改。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/0b23e64de46c86335822269ee4e0c5b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NXvNwc-n_NkKMOsElkZF_g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">连接编辑屏幕</figcaption></figure><p id="a99f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你需要授权<strong class="ih hj"> Google Drive </strong>，然后它会让你继续。</p><p id="2bb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此时你的面前将会出现一张空白的画布，多么令人兴奋！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lx"><img src="../Images/1bf0a0f266d23dd0e44b4db30fb9fd6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LiJUZDN_ks0VxSxZkNHWOw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">空白画布</figcaption></figure><p id="9094" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从做三件事开始:</p><ol class=""><li id="2aa7" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lm ln lo lp bi translated">给报表起一个名字:<strong class="ih hj"> GCP成本汇总</strong></li><li id="c4f0" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">将主题更改为<strong class="ih hj">简单暗</strong></li><li id="9ed6" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">创建您的第一个元素，一个<strong class="ih hj">按天计算的成本时间序列</strong></li></ol><p id="4758" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于名称，点击左上方的<strong class="ih hj">无标题报告</strong>并将其更新为<strong class="ih hj"> GCP成本汇总</strong>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ly"><img src="../Images/2018e70b6ad1dddfb2bf68e4a2797e43.png" data-original-src="https://miro.medium.com/v2/resize:fit:414/format:webp/1*AezZTOihmWxq8fEhBvuaxQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">报表名称</figcaption></figure><p id="dd62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于主题，在右边栏中选择主题，并将其从<strong class="ih hj">简单</strong>更改为<strong class="ih hj">简单暗</strong>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lz"><img src="../Images/7e9feb6230dd92dd0856a0aef6f51cac.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/format:webp/1*vhIw8J_UezyFRK0QpEfc-Q.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">主题选择</figcaption></figure><p id="8042" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于第一个元素，单击菜单栏中的<strong class="ih hj">时间序列</strong>按钮，然后单击报告画布的左上角，并拖动到中间偏右的位置，在画布的上半部分创建一个图表。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ma"><img src="../Images/ca4626b07940b0d1b68e0c4559f60082.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*FJvq2KoJAs-8lrUMYOO1Vg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">时间序列</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mb"><img src="../Images/3c334f9214f98a3943fe668f573e3e4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R9jgvdbICifm2QbpOf0D2Q.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">第一时间序列</figcaption></figure><p id="4429" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你跟我有点像，你的脑子可能刚刚爆炸了一点点[插入烦人的GIF]。正如你所看到的，刚刚发生了很多奇迹。不知何故，选择了正确的<strong class="ih hj">尺寸</strong>和<strong class="ih hj">公制</strong>来绘制该元素。这显然是未来。哇哦。印象深刻。&lt;/end赞&gt;</p><p id="d70f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在右边的栏中，注意已经为您选择了时间维度和成本指标/字段！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mc"><img src="../Images/15820a7121f8a00837a94a1b39dff6fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*O2Wb5H6NWlFJfSh8l8yARA.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">右侧栏</figcaption></figure><p id="b745" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里没有太多需要修改的地方，因为您现在有了一个按天计算的<strong class="ih hj">成本时间序列</strong>。您可以浏览右边栏上的选项，将日期范围调整为自定义或以前的时间段，添加额外的过滤，如果您愿意，还可以在Style选项卡上疯狂一点。对我来说，我会让它保持原样，因为这对我来说已经足够好了。</p></div><div class="ab cl md me gp mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="hb hc hd he hf"><p id="7387" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经实现了第一个目标，让我们添加一个每项服务的成本图表，以便直观地显示我们在GAE和GCE上的花费。为此，我们将选择一个条形图，因为我认为这样看起来最好。并单击/拖动以在左下四分之一面板中创建它。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mk"><img src="../Images/208a317ae56ca93a5c2aec48568de0f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:556/format:webp/1*I7nI8IfCq1oB7w5jdNMKzQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">条形图</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ml"><img src="../Images/b11513098cc96b8370ac439443230155.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*ejnFZK-Jm3BXNJ3mc4fcBA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">完整条形图</figcaption></figure><p id="1337" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">喔，刚刚发生了什么？它是否完全按照我的意图选择了维度和度量，而不必手动选择它们？魔法。绝对神奇。</p><p id="1feb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同样，您可以使用“样式”选项卡对此进行进一步的更改，但此时这对我来说没问题。</p><p id="9baa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的画布/报告在这一点上看起来非常棒:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mm"><img src="../Images/87f6fe9a89d6540af1ccf92060b7ebe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hMkMCJrtIDWJoqgI7rhv0A.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">帆布</figcaption></figure><p id="f127" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是现在我们看到我们在GAE的花费是GCE的5倍，所以我们需要更多关于GAE的信息，让我们对我们的钱的去向感到温暖和模糊。要做到这一点，还需要一个要素。</p></div><div class="ab cl md me gp mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="hb hc hd he hf"><h1 id="ba98" class="jv jw hi bd jx jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko mr kq kr ks bi translated">通过GAE应用程序过滤</h1><p id="e861" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">如果您在单个项目和单个计费协议下运行多个GAE应用程序，您最终会希望将它们拆分到您的账单上。这可能最容易通过使用单独的项目和/或计费协议来完成，但是最终，由于各种原因(网络配置、开发人员的易用性等)，将它们移动到单独的项目可能没有意义或者可能太困难。</p><p id="9622" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了能够按应用程序进行过滤，我们需要查看哪些数据可用于过滤。这需要查看自动导出的字段中的数据。</p><p id="c4b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前往BigQuery界面(看起来像2010年，不要害怕):<a class="ae ju" href="https://bigquery.cloud.google.com" rel="noopener ugc nofollow" target="_blank">https://bigquery.cloud.google.com</a>。</p><p id="a445" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在左侧选择您的<strong class="ih hj">账单</strong>表和<strong class="ih hj">数据集</strong>:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ms"><img src="../Images/d0b87522f655a92fb4b45de79a8b3db3.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*oXZP-rWr3OCOFvv-CfcnMg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">左栏</figcaption></figure><p id="f911" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在页面顶部，选择<strong class="ih hj">预览</strong>:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mt"><img src="../Images/88df3744d2e3a70a6d2f4ed579a0dd84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*gH59p55nxD5fHQaGDQunIQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">试映</figcaption></figure><p id="5659" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您现在看到的原始表格是您的账单数据。您将看到以1小时开始/结束时间为增量的每项服务的条目。因为我们只关注App Engine，所以让我们编写一个查询来过滤这些条目。您可能已经注意到，字段名是<strong class="ih hj">产品</strong>。</p><p id="0cd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在右上角，选择<strong class="ih hj">查询表</strong>并尝试如下查询:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="e4f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于成本和结束时间没有同时排序，因此可能有点难以理解，所以让我们添加更多排序:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="6769" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">非常酷，所以您现在可以以某种易于理解的方式查看原始账单数据。对我来说，可能还有其他人，这有点启发性。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mw"><img src="../Images/ecebaf40f8e01962091468eb9739a14c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mSdR6Us-SbrMIGbYams4yA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">费用数据</figcaption></figure><p id="2227" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如<strong class="ih hj"> labels_key </strong>列所示，我最大的成本是单个应用的灵活实例核心小时数。成本减半的原因是因为我在这里<a class="ae ju" rel="noopener" href="/@mediocrity/scaling-google-app-engine-to-no-instances-or-maybe-just-1-37be4e8d4230">写的帖子</a>，我将它从两个实例缩减为一个实例，因为这是这个应用程序所需要的。</p><p id="29dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您使用底部的“下一步”按钮向前滚动您的账单，如果您运行标准环境实例，您会注意到一些有趣的事情..没有<strong class="ih hj">标签_键值</strong>。这似乎是个问题。我已经向<a class="mx my ge" href="https://medium.com/u/4f3f4ee0f977?source=post_page-----7c9ebeb31b56--------------------------------" rel="noopener" target="_blank">谷歌云</a>评论了这件事(<a class="ae ju" href="https://twitter.com/mediocrity/status/855839890105188352" rel="noopener ugc nofollow" target="_blank">推特</a>)。我们现在不会解决这个问题。</p><p id="e587" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">即使没有标准环境标签，我们的大部分成本也是在灵活实例核心时间内，所以(对我来说)没多大关系。</p><p id="1c64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经了解了这些列，我们可以回到画布上再构建一个图表，给出每个GAE灵活环境应用程序的成本。因为我们还没有使用面积图，所以让我们使用它(稍后当我们想要堆叠每个应用程序的成本时，它可能也会有所帮助)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mz"><img src="../Images/81fa2b7cc1392b2561a42bb26f44bc89.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*xazmpsogbuwkVuZlJiQJ_Q.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">对比图</figcaption></figure><p id="6e72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在右下方的剩余空间绘制图表，但在图表下方留出约1英寸，因为我们将添加一个控件。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es na"><img src="../Images/8fceb31a94e25629f941cccdc723f4b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*ptsmay1-YJOFFAkSDc-_fQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">全面积图</figcaption></figure><p id="ce0b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们首先添加一个过滤器，只显示应用引擎成本。选择图表后，选择右边栏中的<strong class="ih hj">添加过滤器</strong>按钮。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es nb"><img src="../Images/7d5af93322aa334f6f2cc8a9d4806bc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*qDOeZ6qJJWkc0bsXYO53dQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">添加过滤器</figcaption></figure><p id="1b45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在底部创建一个过滤器</strong>按钮。为过滤器创建一个名称(仅应用引擎)，设置为<strong class="ih hj">包含</strong>、<strong class="ih hj">产品</strong>、<strong class="ih hj">等于</strong>和<strong class="ih hj">应用引擎</strong>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nc"><img src="../Images/1b992aed7478875123778bf6bc8e7ad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0jr3rHCnqMTcZFZPJn5iCg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">创建过滤器</figcaption></figure><p id="9cbe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成后，单击右下角的保存。它会自动将过滤器应用到图表中，您现在只会看到每天的<strong class="ih hj">应用引擎</strong>成本。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nd"><img src="../Images/f5aa9cbc17e38840f9b257d873c4a71d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*b5Baae39wk2011geR92PMg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">每天的应用引擎成本</figcaption></figure><p id="19d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么每个GAE应用程序的查看呢？为此，我们将添加一个<strong class="ih hj">滤镜控件</strong>。从菜单栏中选择它(一直到右边)，并将其放在画布的右下角。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ne"><img src="../Images/5b58124d473478afefed9136751746ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/format:webp/1*U63P0U-li24jZW3S5JjYDA.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">过滤控制</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es nf"><img src="../Images/e26f127c19a4575e21ddc423291c3797.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*JgV4VKsM2IwDbda0UAARDg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">过滤器控制放置</figcaption></figure><p id="4d4b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选择过滤器控件，取消选择右边栏中的<strong class="ih hj">显示值</strong>，将尺寸从<strong class="ih hj">产品</strong>更改为<strong class="ih hj">标签。另外，在样式选项卡中，选择<strong class="ih hj">可展开</strong>。</strong></p><p id="c609" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此时，它应该看起来像这样:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ng"><img src="../Images/3719f34e3f9a3ddc6d31a58716dfe7c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*7snEqgSTGbajjJ2xp04eow.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">过滤控制</figcaption></figure><p id="66ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此时，您可能会注意到，到目前为止，您一直处于<strong class="ih hj">编辑</strong>视图中。我们将切换到非编辑视图，看看这个控件是如何工作的。在右上角，选择<strong class="ih hj">视图</strong>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es nh"><img src="../Images/798bc411fd3e6651518d14d5f451dc90.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/1*6P70KHixNMVBiJf0NXTQBw.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">视角</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ni"><img src="../Images/f904aa3b0cb0daea1cf70f5e066c5cb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4fAKW9fZe9xZntFhVTI8xw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">视角</figcaption></figure><p id="ee47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您单击右下角的可扩展过滤器控件，您可以选择/取消选择您的灵活环境GAE应用程序。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es nj"><img src="../Images/415f37e8ea6ea631993f119af724d420.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/format:webp/1*jLzoH2qz8v_jqE-07859Ng.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">过滤控制</figcaption></figure><p id="133b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是你会很快注意到一个问题，它改变了所有的图表，而不仅仅是右下角。要解决这个问题，我们需要将控件设置为*only* control右下角的图形。为此，返回到<strong class="ih hj">编辑</strong>视图。</p><p id="3791" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选择<strong class="ih hj">和</strong>过滤控件和右下方的面积图。进入菜单栏中的<strong class="ih hj">排列</strong>菜单，选择<strong class="ih hj">组</strong>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es nk"><img src="../Images/9ff1ed572e2e30f9d598d93367a14893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*2aJSm6rUkQBKeFkc8R8KyQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">选择两者</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es nl"><img src="../Images/ec93e852d5405d66d6e2409439d58122.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*i5BLcikN3eHtddWpfXeztw.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">排列&gt;群组</figcaption></figure><p id="e62c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在回到<strong class="ih hj">视图</strong>模式，注意它现在像预期的那样*只*控制右下角的面积图。</p><blockquote class="lb lc ld"><p id="6330" class="if ig ky ih b ii ij ik il im in io ip le ir is it lf iv iw ix lg iz ja jb jc hb bi translated">如果您想对面积图进行任何样式更改，这有点烦人，您需要<strong class="ih hj">取消</strong> / <strong class="ih hj">组</strong>的组合。一开始就选择你的风格来避免这种烦恼。</p></blockquote><h1 id="2fab" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">总结</h1><p id="7718" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">您可以非常容易、快速、廉价地从GCP账单中的详细交易视图转到对您个人或您的企业更有用、更有价值的视图。只需点击几次，每月花费几便士，你就可以创建一份人们可以查看的报告。我希望这是有趣的、有见地的和/或有帮助的，请随时在<a class="ae ju" href="https://twitter.com/mediocrity" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上告诉我。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nm"><img src="../Images/996e8d68a344290d4873cb4cf138af49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C3Tsf7MOrGj72TbCK9KwvA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">疯狂的颜色</figcaption></figure><h1 id="9060" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">可选评论</h1><p id="d63c" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated"><em class="ky"/></p><blockquote class="lb lc ld"><p id="d915" class="if ig ky ih b ii ij ik il im in io ip le ir is it lf iv iw ix lg iz ja jb jc hb bi translated">对我来说，公共云提供商花在计费界面、可见性和数据可用性上的时间如此之少，实在令人震惊。这显然不是他们的核心产品，而且显然存在反向激励(想想吧:邪恶)，但更道德的做法是提供更好的可见性，让人们知道你的钱去了哪里:如何去以及为什么去。</p><p id="5873" class="if ig ky ih b ii ij ik il im in io ip le ir is it lf iv iw ix lg iz ja jb jc hb bi translated">当您购买物理服务器时，成本是显而易见的。运输、机架安装/堆叠及其插入的设备都有明确的成本。另外，电力、暖通等等也给你发账单。</p><p id="b9f7" class="if ig ky ih b ii ij ik il im in io ip le ir is it lf iv iw ix lg iz ja jb jc hb bi translated">AWS Cost Explorer于2014年左右在IIRC推出，此前几年毫无用处，不幸的是，GCP在没有初始成本探索工具的情况下延续了这一趋势。</p><p id="b9e2" class="if ig ky ih b ii ij ik il im in io ip le ir is it lf iv iw ix lg iz ja jb jc hb bi translated">你可以为每个项目建立一个单独的计费协议，但这在一个到处都有数百个node.js和mongos的微服务架构中没有意义。从逻辑上来说，如果一个人(或团队)有几个组成单个堆栈的服务，他们想在一个地方查看，这几乎是不可能的。</p></blockquote><p id="f7f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ky">&lt;/自以为是的公有云计费评论&gt; </em></p></div></div>    
</body>
</html>