<html>
<head>
<title>Deno on Cloud Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云运行中的Deno</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/deno-on-cloud-run-89ae64d1664d?source=collection_archive---------1-----------------------#2020-05-13">https://medium.com/google-cloud/deno-on-cloud-run-89ae64d1664d?source=collection_archive---------1-----------------------#2020-05-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/053e5232a289f62b28e4fd7823039fed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8G5uUY1zQ6rehmmhK0-4xg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Deno +云运行</figcaption></figure><p id="61d3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">🦕<strong class="iw hj">Deno</strong>(<a class="ae js" href="http://deno.land" rel="noopener ugc nofollow" target="_blank">Deno . land</a>)是一个基于V8和Rust构建的安全的TypeScript运行时，由Node.js的创建者Ryan Dahl创建。</p><p id="ceb5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">🏃<strong class="iw hj">Cloud Run</strong>(<a class="ae js" href="http://cloud.run" rel="noopener ugc nofollow" target="_blank">Cloud . Run</a>)是一个完全托管的计算平台，可以自动扩展您的无状态容器。</p><p id="65df" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这篇博文中，我们将向您展示如何在Cloud Run上封装和部署一个简单的Deno应用程序，运行一个无服务器的HTTPS TypeScript服务。</p><h1 id="d168" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">创建Deno应用程序</h1><p id="04b4" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">让我们用TypeScript为Deno创建一个web应用程序:</p><h2 id="6714" class="kw ju hi bd jv kx ky kz jz la lb lc kd jf ld le kh jj lf lg kl jn lh li kp lj bi translated">安装Deno</h2><p id="51d3" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">使用官方网站上的<a class="ae js" href="https://deno.land/x/install/" rel="noopener ugc nofollow" target="_blank">说明在您的系统上安装Deno:</a></p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="78f6" class="kw ju hi lp b fi lt lu l lv lw">curl -fsSL https:<em class="lx">//deno.land/x/install/install.sh | sh</em></span></pre><h2 id="3740" class="kw ju hi bd jv kx ky kz jz la lb lc kd jf ld le kh jj lf lg kl jn lh li kp lj bi translated">创建main.ts文件</h2><p id="83dc" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">使用Deno的标准库创建一个简单的HTTP服务器:</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="ly lz l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">主页面</figcaption></figure><p id="c471" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您会注意到像<code class="du ma mb mc lp b">import</code>和顶级<code class="du ma mb mc lp b">for await</code>这样的非节点特性。整洁！</p><blockquote class="md me mf"><p id="b270" class="iu iv lx iw b ix iy iz ja jb jc jd je mg jg jh ji mh jk jl jm mi jo jp jq jr hb bi translated">你可能会注意到一些代码编辑器，比如VS Code对Deno特性发出警告，比如顶级await或TS imports ( <a class="ae js" href="https://github.com/Microsoft/TypeScript/issues/27481" rel="noopener ugc nofollow" target="_blank"> GitHub issue </a>)。它们可以被忽略。</p></blockquote><h2 id="bfe5" class="kw ju hi bd jv kx ky kz jz la lb lc kd jf ld le kh jj lf lg kl jn lh li kp lj bi translated">本地运行</h2><p id="d0c4" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">在继续之前，让我们确保我们的服务器在本地运行:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="751c" class="kw ju hi lp b fi lt lu l lv lw">deno run --allow-env --allow-net main.ts</span></pre><p id="c86d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">点击<code class="du ma mb mc lp b">localhost:8080</code>看<code class="du ma mb mc lp b">Hello, Deno!</code></p><h2 id="779c" class="kw ju hi bd jv kx ky kz jz la lb lc kd jf ld le kh jj lf lg kl jn lh li kp lj bi translated">创建Dockerfile文件</h2><p id="15eb" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">让我们将这个应用程序容器化。</p><p id="a099" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">通过简单的<code class="du ma mb mc lp b">Dockerfile</code>向码头工人说明如何创建我们的形象:</p><figure class="lk ll lm ln fd ij"><div class="bz dy l di"><div class="ly lz l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">Dockerfile文件</figcaption></figure><p id="b030" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了测试这个<code class="du ma mb mc lp b">Dockerfile</code>，我们可以用这个命令在本地运行我们的服务:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="7bbf" class="kw ju hi lp b fi lt lu l lv lw">docker build -t app . &amp;&amp; docker run -it --init -p 8080:8080 app</span></pre><h1 id="171d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">部署到云运行</h1><p id="3d22" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">现在我们已经创建了我们的<code class="du ma mb mc lp b">main.ts</code>和<code class="du ma mb mc lp b">Dockerfile</code>文件，我们准备好部署到云运行。</p><p id="85b0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">构建容器(<code class="du ma mb mc lp b">hellodeno</code>)并部署到云运行(完全托管):</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="c8e0" class="kw ju hi lp b fi lt lu l lv lw">GCP_PROJECT=$(gcloud config list --format 'value(core.project)' 2&gt;/dev/null)<br/>gcloud builds submit --tag gcr.io/$GCP_PROJECT/hellodeno<br/>gcloud run deploy hellodeno --image gcr.io/$GCP_PROJECT/hellodeno --platform managed --allow-unauthenticated</span></pre><p id="a521" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您将从部署的服务中获得一个URL:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="9faa" class="kw ju hi lp b fi lt lu l lv lw"><a class="ae js" href="https://deno-ff-q7vieseilq-ue.a.run.app" rel="noopener ugc nofollow" target="_blank">https://deno-ff-q7vieseilq-ue.a.run.app</a></span></pre><p id="8cee" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi">Voila! 棒棒的！</p><blockquote class="md me mf"><p id="7e4d" class="iu iv lx iw b ix iy iz ja jb jc jd je mg jg jh ji mh jk jl jm mi jo jp jq jr hb bi translated">这个示例应用程序也是Knative Docs 中的<a class="ae js" href="https://github.com/knative/docs/tree/master/community/samples/serving/helloworld-deno" rel="noopener ugc nofollow" target="_blank"> Github示例。</a></p></blockquote><h1 id="aa78" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">后续步骤</h1><p id="5fb2" class="pw-post-body-paragraph iu iv hi iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr hb bi translated">感谢阅读！看看这些相关的帖子:</p><ul class=""><li id="37ee" class="mj mk hi iw b ix iy jb jc jf ml jj mm jn mn jr mo mp mq mr bi translated"><a class="ae js" rel="noopener" href="/google-cloud/node-12-functions-on-cloud-run-d891dd93c7c8">云上运行的⚡节点12功能</a></li><li id="4090" class="mj mk hi iw b ix ms jb mt jf mu jj mv jn mw jr mo mp mq mr bi translated"><a class="ae js" rel="noopener" href="/google-cloud/debugging-node-google-cloud-functions-locally-in-vs-code-e6b912eb3f84">🐛VS代码本地调试节点Google Cloud函数！</a></li><li id="0dda" class="mj mk hi iw b ix ms jb mt jf mu jj mv jn mw jr mo mp mq mr bi translated"><a class="ae js" href="https://www.youtube.com/watch?v=AoAXcW2-LNA" rel="noopener ugc nofollow" target="_blank">🎥视频:Deno介绍</a></li><li id="c7e0" class="mj mk hi iw b ix ms jb mt jf mu jj mv jn mw jr mo mp mq mr bi translated"><a class="ae js" href="http://deno.land/x" rel="noopener ugc nofollow" target="_blank">🌐Deno第三方模块(deno.land/x)</a></li></ul></div></div>    
</body>
</html>