<html>
<head>
<title>Managing and Executing gcloud Commands in JupyterLab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在JupyterLab中管理和执行gcloud命令</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/managing-and-executing-gcloud-commands-in-jupyterlab-c614c9a79db1?source=collection_archive---------0-----------------------#2021-04-26">https://medium.com/google-cloud/managing-and-executing-gcloud-commands-in-jupyterlab-c614c9a79db1?source=collection_archive---------0-----------------------#2021-04-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f952" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">TL；我在文档或文本文件中管理<a class="ae jd" href="https://cloud.google.com/sdk/gcloud" rel="noopener ugc nofollow" target="_blank"> gcloud </a>命令的时间最长，尤其是在原型开发或初始研究期间。从那里我将它们一个接一个地或成块地复制粘贴到终端或<a class="ae jd" href="https://cloud.google.com/shell" rel="noopener ugc nofollow" target="_blank">云外壳</a>上以供执行。这很乏味，容易出错，而且效率很低——所以我改变了我的方法:在这篇博客中，我简要地向你展示如何在JupyterLab中结合这两者。你可以在笔记本上管理和执行gcloud命令。除了我遇到的一些安装注意事项之外，我还列出了一些有趣的用例。</strong></p><h1 id="97fa" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">示例:云扳手—从零到5个命令中的查询</h1><p id="9aec" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">下面您将看到一个在JupyterLab bash笔记本中使用gcloud命令的例子。这需要在JupyterLab中安装bash内核(参见下面的安装部分)。</p><p id="2e0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的笔记本有三个部分:</p><ul class=""><li id="0b34" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated"><strong class="ih hj">设置</strong>。本节包含设置笔记本所需的命令</li><li id="ce6a" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated"><strong class="ih hj">演示</strong>。本节展示了五个gcloud命令来设置一个<a class="ae jd" href="https://cloud.google.com/spanner" rel="noopener ugc nofollow" target="_blank">云扳手</a>实例、设置一个数据库、创建表和运行一个查询。</li><li id="009f" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated"><strong class="ih hj">拆卸</strong>。此部分删除笔记本中创建的所有资源。</li></ul><h2 id="ea32" class="kv jf hi bd jg kw kx ky jk kz la lb jo iq lc ld js iu le lf jw iy lg lh ka li bi translated">第节:设置</h2><p id="2aa0" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">以下屏幕截图显示了设置部分:</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div class="er es lj"><img src="../Images/0f4ae17ea759deabca0232b3398e2942.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/0*H0igd5FH70wwUaxC"/></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">笔记本中的设置部分</figcaption></figure><p id="d21c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些命令执行以下内容(按从上到下的顺序):</p><ol class=""><li id="232c" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc lv kn ko kp bi translated">对用户进行身份验证和授权</li><li id="3643" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc lv kn ko kp bi translated">设置执行命令的项目</li><li id="6782" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc lv kn ko kp bi translated">禁用所有gcloud命令提示，并使用默认设置</li><li id="2387" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc lv kn ko kp bi translated">启用云扳手API</li></ol><p id="4171" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">至此，所有必要的设置都已完成。</p><h2 id="37f1" class="kv jf hi bd jg kw kx ky jk kz la lb jo iq lc ld js iu le lf jw iy lg lh ka li bi translated">部分:演示</h2><p id="52f3" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">下一个屏幕截图显示了笔记本的演示部分:</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div class="er es lw"><img src="../Images/1ca49b81672121fc5f1d4cd965b183d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/0*LsmvHgAJm9zDfwth"/></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">笔记本中的演示部分</figcaption></figure><p id="1f43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个演示部分是不言自明的。一些shell变量被设置并在后续命令中使用。这些命令通过一个简单的云扳手用例。如您所见，每个命令的输出在运行后都会自动显示在笔记本中。</p><h2 id="4e05" class="kv jf hi bd jg kw kx ky jk kz la lb jo iq lc ld js iu le lf jw iy lg lh ka li bi translated">部分:拆卸</h2><p id="464d" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">下一个屏幕截图显示了笔记本的拆卸部分:</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div class="er es lx"><img src="../Images/176b264ea3aede128f0fec4783d14d16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/0*gWo4o0mhJG3Qa48g"/></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">笔记本中的拆卸部分</figcaption></figure><p id="6db7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">one命令删除Cloud Spanner实例及其所有数据库。</p><h1 id="1ede" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">工作流程和最佳实践</h1><p id="3139" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">总体工作流程如下:</p><ol class=""><li id="bc5c" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc lv kn ko kp bi translated"><strong class="ih hj">创建一个bash笔记本</strong>。这可以通过点击JupyterLab中的<strong class="ih hj"> Bash </strong>图标来完成。</li></ol><figure class="lk ll lm ln fd lo er es paragraph-image"><div class="er es ly"><img src="../Images/66e8365ba1fd4e5340289511c26590fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/0*GABldHUs_Z8GFEIB"/></div></figure><p id="1152" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.将笔记本命名为。为笔记本提供一个合适的名称。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div class="er es lz"><img src="../Images/e0d3be1b1f2a71e17c0ccdb59e6aff9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/0*ePl8nRr-bFAglPB1"/></div></figure><p id="30bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.<strong class="ih hj">添加第一个命令</strong>。单击“+”创建一个笔记本单元格，并将命令写入其中。在右边的下拉菜单中，您可以选择该命令是原始文本、遵循<a class="ae jd" href="https://daringfireball.net/projects/markdown/" rel="noopener ugc nofollow" target="_blank"> markdown </a>符号的文本还是类似gcloud的代码命令。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div class="er es ma"><img src="../Images/192d0d7a97bd4952ae49dbbf1ffc24a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:54/0*eX_vaov1bYb4k0kG"/></div></figure><figure class="lk ll lm ln fd lo er es paragraph-image"><div class="er es mb"><img src="../Images/ec4da44b031ad6b849399639816053e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:178/0*Fuz3wDC4i8JHK-NJ"/></div></figure><p id="fecd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.<strong class="ih hj">执行命令</strong>。将光标放在单元格中，单击向右箭头执行命令。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div class="er es mc"><img src="../Images/0860ca393bd70457302c19e055bd0355.png" data-original-src="https://miro.medium.com/v2/resize:fit:58/0*crvfP5DefVggit3D"/></div></figure><p id="0625" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.<strong class="ih hj">继续添加命令</strong>。根据您的需要，通过添加笔记本单元格来创建额外的raw、markdown或code命令。</p><p id="79c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.<strong class="ih hj">从头执行</strong>。可以通过选择“删除所有输出”来删除所有输出，这将只在笔记本中保留命令。您可以重新执行所有命令，新的输出将动态添加到笔记本中。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div class="er es md"><img src="../Images/57684b56c2aaa431a005f104a9fc2aa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/0*ek5zv8h8V4ENvCde"/></div></figure><p id="9270" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从最佳实践的角度考虑以下建议</p><ul class=""><li id="5665" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated">使用专用设置部分启动笔记本</li><li id="e93c" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">通过设置shell变量来参数化命令</li><li id="3afc" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">根据需要记录命令</li><li id="d505" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated">提供一个清理或拆卸部分来清理所有创建的资源</li></ul><p id="6956" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些基本的最佳实践是一个良好的开端，您可以随着时间的推移根据自己的需要对其进行改进。</p><h1 id="1bc8" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">用例</h1><p id="3011" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在笔记本电脑中使用JupyterLab管理和执行gcloud命令的这种方法有很多用例。一些重要的使用案例包括:</p><ul class=""><li id="859b" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated"><strong class="ih hj">客户支持</strong>。使用JupyterLab，客户可以在笔记本上交流执行的gcloud命令，并描述遇到的问题，而不必分享他们的Google Cloud项目。您可以在项目中重新运行这些命令进行调查。</li><li id="d990" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated"><strong class="ih hj">迭代开发</strong>。当您试验、创建POC或对云资源进行初步研究时，笔记本电脑让您能够轻松修改gcloud命令，跟踪成功(和失败)的gcloud命令及其输出。</li><li id="6df0" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated"><strong class="ih hj">演示</strong>。笔记本可以作为演示脚本，让您不仅能够列出和执行命令，还能够记录值得注意的细节。</li><li id="8e55" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated"><strong class="ih hj">文档</strong>。您可以创建一个或多个笔记本，为自己或他人记录gcloud命令，其中包含官方产品文档之外的详细信息。</li><li id="e974" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated"><strong class="ih hj">协作</strong>。当签入源代码控制时，笔记本可以作为团队内部和团队之间协作的基础。</li><li id="51ae" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated"><strong class="ih hj">教学</strong>。笔记本可以用来教授一门或多门关于云资源和与之配套的gcloud命令的课程。</li><li id="14a2" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated"><strong class="ih hj">学习</strong>。当遵循指令时，您可以将gcloud命令收集在一个笔记本中，以记录您已经执行的命令，并用于可能的重复执行。</li></ul><p id="3104" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些是gcloud命令如何在笔记本中使用的一些示例。随着时间的推移，你肯定会发现更多重要的用例。</p><h1 id="5baa" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">装置</h1><p id="9514" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">这些是我在Linux笔记本上安装JupyterLabs时发现的安装注意事项和一些警告。具体情况可能会有所不同；以下只是针对我的情况做的体验报告。</p><p id="7fba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">安装木星实验室</strong>。对我来说，最好的体验是使用<code class="du me mf mg mh b">pip</code>进行安装，如这里的<a class="ae jd" href="https://jupyter.org/install" rel="noopener ugc nofollow" target="_blank">所述</a>。你可能必须先安装<code class="du me mf mg mh b">pip</code>。</p><p id="44c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">安装echo和bash内核</strong>。内核提供了笔记本中可用的功能，我安装了两个:用于测试的<a class="ae jd" href="https://github.com/jupyter/echo_kernel" rel="noopener ugc nofollow" target="_blank"> echo </a>内核，以及之后的<a class="ae jd" href="https://github.com/takluyver/bash_kernel" rel="noopener ugc nofollow" target="_blank"> bash </a>内核。bash内核是用于运行gcloud命令的内核(上面的例子是使用bash内核实现的)。</p><p id="5359" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">启动JupyterLab </strong>。在控制台上运行JupyterLab命令，jupyter lab就会启动。</p><p id="eb87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据我的经验，有一些警告:</p><ul class=""><li id="b598" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated"><strong class="ih hj">括号粘贴</strong>。在某一点上，意外的字符序列出现在一些环境变量中，如这里的<a class="ae jd" href="https://cirw.in/blog/bracketed-paste" rel="noopener ugc nofollow" target="_blank">所示</a>。这非常令人沮丧，因为我不确定它是从哪里来的。经过一番搜索，我发现这来自于括号粘贴的概念。一旦我<a class="ae jd" href="https://askubuntu.com/questions/662222/why-bracketed-paste-mode-is-enabled-sporadically-in-my-terminal-screen" rel="noopener ugc nofollow" target="_blank">关闭括号粘贴</a>，我就再也没有遇到这个问题。我的方法是将这一行添加到<code class="du me mf mg mh b">.bashrc</code>文件中:</li></ul><pre class="lk ll lm ln fd mi mh mj mk aw ml bi"><span id="b306" class="kv jf hi mh b fi mm mn l mo mp">bind ‘set enable-bracketed-paste off’</span></pre><ul class=""><li id="d03f" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated"><strong class="ih hj">提示</strong>。如果命令在执行过程中要求输入，则该提示不会传播到笔记本。从笔记本的角度来看，该命令看似挂起，但实际上是在等待用户输入。这就是关闭设置部分提示的原因。</li></ul><h1 id="510c" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">你的想象力</h1><p id="6bb9" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">尝试在JupyterLab笔记本中管理和执行gcloud命令，并查看您可能会想到的其他用例、功能和特性。</p><p id="b234" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我从Gopinath得到的一个建议是指向这篇解释如何在远程机器上运行JupyterLab的文章(我没有尝试过，但对你来说可能有帮助):<a class="ae jd" href="https://ljvmiranda921.github.io/notebook/2018/01/31/running-a-jupyter-notebook/" rel="noopener ugc nofollow" target="_blank">https://ljvmiranda 921 . github . io/notebook/2018/01/31/running-a-jupyter-notebook/</a></p><h1 id="0c43" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">承认</h1><p id="ec5e" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我要感谢Anibal Santiago的彻底审查和许多意见，以提高这一内容的准确性。</p><h1 id="6217" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">放弃</h1><p id="d73e" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">Christoph Bussler是谷歌公司(Google Cloud)的解决方案架构师。这里陈述的观点是我自己的，而不是谷歌公司的。</p></div></div>    
</body>
</html>