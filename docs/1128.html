<html>
<head>
<title>Hosting a website on Google Cloud using Cloud Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Cloud Run在Google Cloud上托管网站</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/hosting-a-website-on-google-cloud-using-cloud-run-a65343a98fce?source=collection_archive---------1-----------------------#2019-08-27">https://medium.com/google-cloud/hosting-a-website-on-google-cloud-using-cloud-run-a65343a98fce?source=collection_archive---------1-----------------------#2019-08-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="13b8" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在云中烹饪</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/45a8d5fd49666e66f84d6ce3637a1b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1P8iKVplTnMgQa8b.png"/></div></div></figure><h1 id="f09e" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">介绍</h1><p id="9ddb" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">在这个迷你系列中，我们将介绍如何在谷歌云上创建网站。这是该系列的第三篇文章。</p><ol class=""><li id="7739" class="kx ky hi kd b ke kz kh la kk lb ko lc ks ld kw le lf lg lh bi translated"><a class="ae li" rel="noopener" href="/@pvergadia/hosting-web-applications-on-google-cloud-an-overview-46f5605eb3a6">在谷歌云上托管网络应用:概述</a></li><li id="36bc" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw le lf lg lh bi translated"><a class="ae li" rel="noopener" href="/google-cloud/hosting-a-static-website-on-google-cloud-using-google-cloud-storage-ddebcdcc8d5b">使用谷歌云存储在谷歌云上托管网络应用</a></li><li id="200e" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw le lf lg lh bi translated">使用Cloud Run在Google Cloud上托管web应用程序(此博客)</li><li id="de96" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw le lf lg lh bi translated"><a class="ae li" rel="noopener" href="/@pvergadia/hosting-a-website-on-google-cloud-using-google-compute-engine-c6fe84d76f51">使用谷歌计算引擎在谷歌云上托管网络应用</a></li><li id="b16d" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw le lf lg lh bi translated"><a class="ae li" rel="noopener" href="/p/d21d6ce3e837/">在谷歌计算引擎上缩放web应用。</a></li><li id="8015" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw le lf lg lh bi translated"><a class="ae li" rel="noopener" href="/faun/case-study-hosting-scalable-web-apps-on-google-cloud-c0bb675812c8">案例研究</a></li></ol><p id="2948" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated">假设您是一家小公司，发展非常迅速，现在您的简单网站流量很大，但是当您可以专注于核心业务时，您不想处理基础架构设置和维护！</p><h1 id="2cbd" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">你会学到什么</h1><ul class=""><li id="e05e" class="kx ky hi kd b ke kf kh ki kk lr ko ls ks lt kw lu lf lg lh bi translated">用五个简单的步骤创建一个网站。</li></ul><h1 id="9276" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">先决条件</h1><ul class=""><li id="438c" class="kx ky hi kd b ke kf kh ki kk lr ko ls ks lt kw lu lf lg lh bi translated">阅读<a class="ae li" rel="noopener" href="/@pvergadia/hosting-web-applications-on-google-cloud-an-overview-46f5605eb3a6">第一篇文章</a>，它涵盖了关于在Google Cloud上建立网站的高级概念。</li></ul><h1 id="6d50" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">看看这个视频</h1><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lv lw l"/></div></figure><h1 id="0bb4" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">什么是云跑？</h1><p id="644b" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated"><a class="ae li" href="https://cloud.google.com/run/" rel="noopener ugc nofollow" target="_blank">云运行</a>是一个可自动扩展无状态容器的托管计算平台。“无状态”在这里很重要，因为容器实例可以随时启动或停止。web请求或发布/订阅事件可以调用这些容器。</p><p id="3909" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated">它建立在Knative的基础上，让你可以选择轻松地运行你的容器，要么完全由Cloud Run管理，要么在GKE的Google Kubernetes引擎集群中运行Cloud Run。</p><p id="0969" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated">云运行也是无服务器的:它抽象了所有的基础设施管理，因此您可以专注于最重要的事情——构建优秀的应用程序。</p><h1 id="5bcd" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">如何在云上创建网站</h1><p id="1401" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">在我们开始之前，我们需要确保我们在谷歌云控制台中设置正确。以下是一些设置逻辑:</p><ul class=""><li id="2372" class="kx ky hi kd b ke kz kh la kk lb ko lc ks ld kw lu lf lg lh bi translated">您已经创建了一个GCP项目</li><li id="0325" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw lu lf lg lh bi translated">建立一个记帐帐户</li><li id="e3b3" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw lu lf lg lh bi translated">启用云运行和云构建API。</li><li id="8a99" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw lu lf lg lh bi translated">如果你还没有安装Google Cloud SDK，请按照这里的说明<a class="ae li" href="https://cloud.google.com/sdk/install" rel="noopener ugc nofollow" target="_blank">进行安装。</a></li></ul><p id="8fce" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated">现在我们已经讨论了物流，在Cloud Run上设置web应用程序有五个步骤。</p><h1 id="6049" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">步骤1:安装gcloud SDK的测试版组件</h1><p id="68e6" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">注意:在这篇博文发表的时候，Cloud Run还在测试阶段。</p><p id="de7c" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated">这要求我们使用以下命令安装gcloud SDK的测试版组件。</p><blockquote class="lx ly lz"><p id="524c" class="kb kc ma kd b ke kz ij kg kh la im kj mb lo km kn mc lp kq kr md lq ku kv kw hb bi translated">“gcloud组件安装测试版”——安装测试版功能</p><p id="007e" class="kb kc ma kd b ke kz ij kg kh la im kj mb lo km kn mc lp kq kr md lq ku kv kw hb bi translated">“gcloud组件更新”——更新组件</p></blockquote><h1 id="dde0" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">步骤2:创建要部署的示例web应用程序</h1><p id="3fb6" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">如果您已经有一个web应用程序，并希望在这些步骤中进一步使用，则可以跳过此步骤。如果您选择跟随我的示例，那么让我们使用以下步骤用python创建一个“hello world”web应用程序:</p><ul class=""><li id="49b7" class="kx ky hi kd b ke kz kh la kk lb ko lc ks ld kw lu lf lg lh bi translated">“mkdir hello world-python”——创建一个目录</li><li id="22b6" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw lu lf lg lh bi translated">“CD hello world-python”——更改到创建的目录</li><li id="0b67" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw lu lf lg lh bi translated">“VI app . py”—创建一个文件并粘贴以下代码。这将创建一个基本的web服务器，它监听由port环境变量定义的端口。</li></ul><pre class="iy iz ja jb fd me mf mg mh aw mi bi"><span id="fd06" class="mj jk hi mf b fi mk ml l mm mn">import os<br/><br/>from flask import Flask<br/><br/>app = Flask(__name__)<br/><br/>@app.route('/')<br/>def hello_world():<br/>    target = os.environ.get('TARGET', 'World')<br/>    return 'Hello {}!\n'.format(target)<br/><br/>if __name__ == "__main__":<br/>    app.run(debug=True,host='0.0.0.0',port=int(os.environ.get('PORT', 8080)))</span></pre><p id="8355" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated">现在，我们准备容器化我们的应用程序，并上传到容器注册！</p><h1 id="5cde" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">步骤3:将应用程序容器化，并上传到容器注册表</h1><p id="6c14" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">在与源文件相同的目录下创建一个名为<strong class="kd hj"> Dockerfile </strong>的新文件。一个<strong class="kd hj"> Dockerfile </strong>是一个文本文档，它包含用户可以在命令行上调用的所有命令，以组装一个容器映像。</p><p id="3d28" class="pw-post-body-paragraph kb kc hi kd b ke kz ij kg kh la im kj kk lo km kn ko lp kq kr ks lq ku kv kw hb bi translated">您可以使用以下命令:</p><ul class=""><li id="e8b5" class="kx ky hi kd b ke kz kh la kk lb ko lc ks ld kw lu lf lg lh bi translated">“pwd”——检查你在哪个目录。如果您不在“helloworld-python”目录中，请转到该目录。</li><li id="1407" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw lu lf lg lh bi translated">“CD hello world-python”——更改到创建的目录</li><li id="8ae6" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw lu lf lg lh bi translated">“VI docker file”——在同一目录中创建文件的命令。将下面的代码粘贴到该文件中，以创建容器图像。</li></ul><pre class="iy iz ja jb fd me mf mg mh aw mi bi"><span id="a732" class="mj jk hi mf b fi mk ml l mm mn"># Use the official Python image.<br/># https://hub.docker.com/_/python<br/>FROM python:3.7<br/><br/># Copy local code to the container image.<br/>ENV APP_HOME /app<br/>WORKDIR $APP_HOME<br/>COPY . .<br/><br/># Install production dependencies.<br/>RUN pip install Flask gunicorn<br/><br/># Run the web service on container startup. Here we use the gunicorn<br/># webserver, with one worker process and 8 threads.<br/># For environments with multiple CPU cores, increase the number of workers<br/># to be equal to the cores available.<br/>CMD exec gunicorn --bind :$PORT --workers 1 --threads 8 app:app</span></pre><h1 id="6152" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">第四步:构建</h1><p id="f95a" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">现在，我们通过从包含<strong class="kd hj"> Dockerfile </strong>的目录中运行build命令，准备使用<a class="ae li" href="https://cloud.google.com/cloud-build/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd hj">云构建</strong> </a>进行构建。</p><ul class=""><li id="c904" class="kx ky hi kd b ke kz kh la kk lb ko lc ks ld kw lu lf lg lh bi translated">“gcloud构建提交—标记gcr.io/<strong class="kd hj">gcic-web</strong>/hello world”——这将提交构建。当构建成功时，您将看到“成功”。</li></ul><h1 id="9f01" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">步骤5:在云上部署</h1><p id="805d" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">为了在云运行上部署容器映像，我们现在需要执行以下命令。确保将<strong class="kd hj">项目ID </strong>和<strong class="kd hj">服务名称</strong>替换为您自己的项目ID和服务名称。</p><ul class=""><li id="c8aa" class="kx ky hi kd b ke kz kh la kk lb ko lc ks ld kw lu lf lg lh bi translated">“gcloud测试版运行部署—映像gcr.io/<strong class="kd hj">项目ID </strong> / <strong class="kd hj">服务名称</strong> —平台托管”</li><li id="2a8d" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw lu lf lg lh bi translated">当提示选择区域时，选择您所选择的区域。</li><li id="25e6" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw lu lf lg lh bi translated">提供您选择的服务名</li><li id="270f" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw lu lf lg lh bi translated">用<strong class="kd hj"> Yes </strong>来响应，以允许未经身份验证的调用。</li><li id="2e4b" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw lu lf lg lh bi translated">如果成功，我们会看到服务URL。您可以使用URL打开我们刚刚部署的web应用程序。</li></ul><h1 id="6f56" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">恭喜你！！</h1><p id="4aec" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">您刚刚在Cloud Run上部署了一个打包在容器映像中的web应用程序。</p><h1 id="5b7c" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">结论</h1><p id="6ee0" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">我们在Cloud Run上创建并部署了一个动态web应用程序，并了解到如果您在Cloud Run上托管一个网站，您可以依赖google cloud来根据需求进行扩展。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mo"><img src="../Images/f1910ee54fa45f909c2909b119684e90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CQATjcYo_2QKSCcynKbCzQ.png"/></div></div><figcaption class="mp mq et er es mr ms bd b be z dx translated">部署在云上的Web应用程序</figcaption></figure><h1 id="4169" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">后续步骤</h1><ul class=""><li id="fcc8" class="kx ky hi kd b ke kf kh ki kk lr ko ls ks lt kw lu lf lg lh bi translated">在<a class="ae li" href="https://medium.com/google-cloud" rel="noopener">谷歌云平台媒体</a>上关注这个博客系列。</li><li id="299f" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw lu lf lg lh bi translated">关注<a class="ae li" href="https://www.youtube.com/watch?v=pxp7uYUjH_M" rel="noopener ugc nofollow" target="_blank">获取云端烹饪</a>视频系列，订阅谷歌云平台YouTube频道</li><li id="6f8e" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw lu lf lg lh bi translated">想要更多的故事？查看我的<a class="ae li" rel="noopener" href="/@pvergadia/">媒体</a>，<a class="ae li" href="https://twitter.com/pvergadia" rel="noopener ugc nofollow" target="_blank">在twitter上关注我</a>。</li><li id="50fb" class="kx ky hi kd b ke lj kh lk kk ll ko lm ks ln kw lu lf lg lh bi translated">与我们一起享受这个系列的旅程，并了解更多关于Google Cloud的信息:)</li></ul></div></div>    
</body>
</html>