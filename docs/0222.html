<html>
<head>
<title>Restarting/Update Cloud Dataflow in-flight</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">正在重新启动/更新云数据流</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/restarting-cloud-dataflow-in-flight-9c688c49adfd?source=collection_archive---------0-----------------------#2017-03-02">https://medium.com/google-cloud/restarting-cloud-dataflow-in-flight-9c688c49adfd?source=collection_archive---------0-----------------------#2017-03-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="492b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不容易被魔术打动…当你每天用谷歌云平台工作时，你会习惯魔术。但今天，我对云数据流服务印象深刻，它能够在不停止工作的情况下更新您的工作。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/e293d04fa56373a0fd5c04f47c65b291.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rYPiSFxE_xZ1Ycx4YGA5VQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><a class="ae jt" href="https://unsplash.com/search/stream?photo=8X1-pcDF8l0" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/search/stream?photo=8X1-pcDF8l0</a></figcaption></figure><p id="4b60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Cloud Dataflow是Google的托管执行引擎，用于运行用<a class="ae jt" href="https://beam.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Beam </a>编写的数据处理工作流。我们使用Beam模型的主要原因是能够编写一次管道，然后运行<strong class="ih hj">流</strong>或<strong class="ih hj">批处理</strong>。但是当你深入研究这个模型时，真正的力量在于它处理事件时间和不同类型窗口的能力。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ju jv l"/></div></figure><p id="3a7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“会话窗口”就是一个例子:通过管道中的一行代码，您可以从您的数据创建会话。上面的代码以20分钟的间隔将您的数据分组。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jw"><img src="../Images/26be8b95fe641805e25fba911f303cac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5BfYOHKDeAYm1UcmYAb0Ug.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><a class="ae jt" href="https://unsplash.com/search/dam?photo=DMfSpSrhF-k" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/search/dam?photo=DMfSpSrhF-k</a></figcaption></figure><p id="e743" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有了这样一个定义窗口的强大模型，你可以想象更新一个正在运行的"<strong class="ih hj"> streaming </strong>"数据流，甚至恢复故障都不是一件小事。你就是不能拔掉插头重新启动…你如何处理所有已经确认但尚未写入的运行中的数据？！事实证明，云数据流支持更新。</p><p id="4b3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是今天，我们使用这种机制给了一个失败的数据流一脚，这样它就可以从由于BigQuery表没有及时创建而导致的故障中恢复过来。数据流的缓冲区中有大约8小时的数据，我们不想丢失。事件得到了确认，所以它们来自PubSub，但也没有写入BigQuery，它们在数据流管道中。</p><pre class="je jf jg jh fd jx jy jz ka aw kb bi"><span id="4896" class="kc kd hi jy b fi ke kf l kg kh">java -jar pipeline/build/libs/pipeline-ingress-1.0.jar \<br/>        --project=my-project \<br/>        --zone=us-central1-f \<br/>        --streaming=true \<br/>        --stagingLocation=gs://my-bucket/tmp/dataflow/staging/ \<br/>        --runner=DataflowPipelineRunner \<br/>        --numWorkers=1 \<br/>        --workerMachineType=n1-standard-2 \<br/>        --jobName=<strong class="jy hj">ingresspipeline-1216151020</strong> \<br/>        <strong class="jy hj">--update</strong></span></pre><p id="5ab0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在数据流上使用update标志可以将配置切换到特殊模式，确保没有数据丢失。它停止正在运行的数据流，确保已经被确认的和在管道中的数据被持久化到磁盘(例如未完成的会话)并将磁盘重新连接到新数据流并继续运行。</p><p id="28de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">没有什么比一次真正的紧急事件带来的好结果更能提高人们对产品的信心了。唯一的缺点是:正常运行时间计数器从200多天重置为0。但这对于不丢失任何数据来说是一个很小的代价。</p><div class="ki kj ez fb kk kl"><a href="https://cloud.google.com/dataflow/pipelines/updating-a-pipeline" rel="noopener  ugc nofollow" target="_blank"><div class="km ab dw"><div class="kn ab ko cl cj kp"><h2 class="bd hj fi z dy kq ea eb kr ed ef hh bi translated">更新现有管道|云数据流文档|谷歌云平台</h2><div class="ks l"><h3 class="bd b fi z dy kq ea eb kr ed ef dx translated">“运行中”的数据仍将由新管道中的转换进行处理；但是，其他转换…</h3></div><div class="kt l"><p class="bd b fp z dy kq ea eb kr ed ef dx translated">cloud.google.com</p></div></div><div class="ku l"><div class="kv l kw kx ky ku kz jn kl"/></div></div></a></div></div></div>    
</body>
</html>