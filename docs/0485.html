<html>
<head>
<title>A handy tip for local development of PHP on App Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在App Engine上本地开发PHP的一个便利技巧</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/a-handy-tip-for-local-development-of-php-on-app-engine-4a54b8d8ed61?source=collection_archive---------1-----------------------#2018-01-04">https://medium.com/google-cloud/a-handy-tip-for-local-development-of-php-on-app-engine-4a54b8d8ed61?source=collection_archive---------1-----------------------#2018-01-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="0125" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将概述这个技巧背后的背景知识，然后告诉你它是什么以及如何使用它。</p><h1 id="4127" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">背景故事</h1><p id="5266" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我的团队在我们的PHP应用程序中广泛使用Google App Engine，直到最近，我们还在使用Google的<a class="ae kh" href="https://github.com/GoogleCloudPlatform/php-docker" rel="noopener ugc nofollow" target="_blank"> php-docker </a> docker映像的定制版本(阅读旧版本),我们在生产和本地测试环境中都使用了它。</p><p id="dbfa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们最近的一个需求意味着我必须触摸php-docker图像，在触摸图像时，像许多旧代码项目一样，事情开始变得糟糕。图像的过时导致了一系列需要进行排序的故障。</p><p id="629d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我研究并咨询了我的团队，选择回到Google当前的php-docker图像，因为我们觉得它有足够的稳定性和功能来取代我们的自定义图像。在做了几次测试后，我发现:</p><h2 id="03ef" class="ki jf hi bd jg kj kk kl jk km kn ko jo iq kp kq js iu kr ks jw iy kt ku ka kv bi translated">php-docker默认图像不能很好地处理卷</h2><p id="cfb8" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">原因是，正好在docker镜像运行web服务器之前运行的<code class="du kw kx ky kz b">entrypoint.sh</code>脚本喜欢将所有东西都分配给一些核心权限。这可能意味着，如果您使用的是卷，您在本地将没有权限访问自己的文件，而在我们的应用程序中，我们的缓存文件夹变得不可写。</p><p id="acfa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了解决这个问题，我<a class="ae kh" href="https://github.com/GoogleCloudPlatform/php-docker/pull/390" rel="noopener ugc nofollow" target="_blank">与GCP团队</a>合作，在php-docker映像中引入了一个新特性，如果你正在进行本地开发，这个特性可以让你跳过这个锁定过程。</p><h1 id="0d45" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">跳过本地锁定</h1><p id="d79e" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">现在跳过本地锁定是一件非常简单的事情。考虑下面的docker命令，它将使用您的本地目录作为一个卷和您的<code class="du kw kx ky kz b">index.php</code>文件所在的<code class="du kw kx ky kz b">/app/public</code>:<br/><code class="du kw kx ky kz b">docker run -v /home/daniel/Repositories/my-project:/app -e DOCUMENT_ROOT=/app/public --name my-project gcr.io/google_appengine/php:latest</code></p><p id="ee8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要修改这个命令来停止锁定，只需添加一个新的设置为true的env变量:<code class="du kw kx ky kz b">SKIP_LOCKDOWN_DOCUMENT_ROOT=true</code>，就像这样:<br/> <code class="du kw kx ky kz b">docker run -v /home/daniel/Repositories/my-project:/app -e DOCUMENT_ROOT=/app/public -e SKIP_LOCKDOWN_DOCUMENT_ROOT=true --name my-project gcr.io/google_appengine/php:latest</code></p><p id="2a40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样！没有更多的chmod时，本地工作，让您在一个应用程序引擎一样的环境中工作！</p><p id="e037" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果这个技巧对你有帮助，我很乐意收到你的来信。如果您有任何反馈或编辑，请在下面评论。</p></div></div>    
</body>
</html>