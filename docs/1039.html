<html>
<head>
<title>Analyzing sentiment of text with domain-specific vocabulary and topics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用特定领域词汇和主题分析文本情感</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/analyzing-sentiment-of-text-with-domain-specific-vocabulary-and-topics-bdcca7ac8c3e?source=collection_archive---------1-----------------------#2019-06-18">https://medium.com/google-cloud/analyzing-sentiment-of-text-with-domain-specific-vocabulary-and-topics-bdcca7ac8c3e?source=collection_archive---------1-----------------------#2019-06-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bff9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第二部分:用AutoML从Google Sheets进行情感预测</strong></p><p id="1942" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的<a class="ae jd" rel="noopener" href="/google-cloud/analyzing-sentiment-of-text-with-domain-specific-vocabulary-and-topics-726b8f287aef">上一篇博文</a>中，我快速演示了为什么以及如何创建你自己的定制模型来分析文本情感。谷歌云的<a class="ae jd" href="https://cloud.google.com/natural-language/#natural-language-api-demo" rel="noopener ugc nofollow" target="_blank">预先训练的情感分析模型</a>在许多情况下都很好，但当短语包含特定领域的术语时，它不一定经过训练来分析情感。幸运的是，<a class="ae jd" href="https://cloud.google.com/natural-language/#how-automl-natural-language-works" rel="noopener ugc nofollow" target="_blank"> AutoML自然语言</a>允许你定制一个情感模型，不需要ML专业知识或者开发背景；对我这样的数据分析师来说是个好消息！</p><p id="8bb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">帖子结束时，定制模型已经建立并运行，你可以在AutoML的web用户界面上预测新的、与航空公司相关的推文的情感得分。但是，由于大量数据存在于电子表格中，我将向您展示如何访问AutoML自定义模型来直接从Google Sheets预测文本的情感。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/fc54ce5c1524974c4f9dafe53461d564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_pY0KjOSiuo3u9Q8mfgwaw.png"/></div></div></figure><p id="f9d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将从您离开的地方继续:在您的手中有一个闪亮的，新的AutoML定制模型！这篇文章的其余部分将带你了解如何:</p><ul class=""><li id="81f2" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">在谷歌表单中收集你的预测数据</li><li id="caab" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">编写一个函数来调用AutoML API</li><li id="6269" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">配置OAuth和服务帐户以访问您的AutoML模型</li><li id="ce94" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">让你的谷歌表单自动预测新推文的情绪，以及</li><li id="ce7f" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">设置触发器以处理更大的数据集</li></ul><h2 id="fb87" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated"><strong class="ak">在谷歌表单中收集你的预测数据</strong></h2><p id="06b5" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">根据谷歌表单进行预测只是众多选项中的一个，但我发现它是介于“使用AutoML web UI进行手动复制粘贴”和“构建一个成熟的应用程序”之间的一个不错的选择。所以首先，你需要准备一个新的谷歌表单，里面有你想要进行情绪预测的数据。</p><ol class=""><li id="3af8" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc le jw jx jy bi translated">创建一个新的Google工作表:<a class="ae jd" href="https://sheet.new" rel="noopener ugc nofollow" target="_blank"> sheet.new </a></li><li id="bf8f" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc le jw jx jy bi translated">将选项卡重命名为“Tweet Data”。</li><li id="af64" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc le jw jx jy bi translated">在第1行添加一个标题，其中A列为“tweet_text”，B列为“automl _情操_输出”。</li><li id="1815" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc le jw jx jy bi translated">添加一些示例推文。我是从原始数据集中提取的，但理想情况下，你应该获取一些新的推文！</li></ol><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lf"><img src="../Images/44ff9ade225e4283c2a5506339f77ba4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZzkqvXMMpU46ZO2l25nbhw.png"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">您的电子表格应该看起来像这样…</figcaption></figure><h2 id="f8cd" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated"><strong class="ak">编写一个函数来调用AutoML API </strong></h2><p id="a94f" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">现在是时候连接Google Sheets和AutoML了，为此你需要<a class="ae jd" href="https://developers.google.com/apps-script/" rel="noopener ugc nofollow" target="_blank"> Apps脚本</a>。如果您以前没有使用过，Apps Script是一种基于JavaScript的语言，它的增强使得在G Suite中进行定制和自动化变得很容易。首先，您将编写一个应用程序脚本函数，该函数将一行文本作为输入，将该文本传递给AutoML服务，并接收来自AutoML的响应，该响应包含基于自定义模型的预测情感得分。</p><ol class=""><li id="1a90" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc le jw jx jy bi translated">从你的电子表格中，从<strong class="ih hj">工具</strong>菜单访问<strong class="ih hj">脚本编辑器</strong>。</li><li id="20f4" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc le jw jx jy bi translated">将以下代码复制并粘贴到code.gs文件中。</li></ol><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="f657" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.用您唯一的项目标识和型号标识替换第2行和第3行中的项目标识和型号标识。您可以在<a class="ae jd" href="https://console.cloud.google.com/natural-language" rel="noopener ugc nofollow" target="_blank"> AutoML自然语言UI </a>的预测选项卡上找到它们，方法是向下滚动到<strong class="ih hj">使用您的定制模型</strong>部分并选择<strong class="ih hj"> REST API。</strong>代码块中列出的URL包含这两种格式的项目:<a class="ae jd" href="https://automl.googleapis.com/v1beta1/projects/YOUR_PROJECT_ID/locations/us-central1/models/YOUR_MODEL_ID:predict." rel="noopener ugc nofollow" target="_blank">https://automl.googleapis.com/v1beta1/projects/<strong class="ih hj">你的项目ID</strong>/locations/us-central 1/models/<strong class="ih hj">你的项目ID </strong>:预测。</a></p><h2 id="823d" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated"><strong class="ak">配置OAuth和服务帐户以访问您的AutoML模型</strong></h2><p id="bb1f" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">从应用程序脚本访问我们的自定义模型需要一个服务帐户。这是您在Google云平台项目中创建的一组凭证，以便AutoML可以确保只有授权用户才能访问模型。这些凭据包含在您的应用程序脚本代码中。</p><ol class=""><li id="0ccc" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc le jw jx jy bi translated">在<a class="ae jd" href="https://console.cloud.google.com/home/dashboard" rel="noopener ugc nofollow" target="_blank">云控制台</a>中，导航到<strong class="ih hj">API&amp;服务</strong>，然后<strong class="ih hj">凭证</strong>。在<strong class="ih hj">创建凭证</strong>下，选择<strong class="ih hj">服务账号密钥</strong>。</li><li id="4228" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc le jw jx jy bi translated">创建一个新的服务帐户，提供一个名称(如“automl-sheets”)，并选择一个AutoML Predictor角色。点击<strong class="ih hj">创建</strong>。一个文件将自动下载到您的计算机上。</li><li id="b8b6" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc le jw jx jy bi translated">在Google Sheets中打开您的脚本编辑器，进入菜单<strong class="ih hj">文件→新建→脚本文件</strong>创建一个新文件。将新文件命名为<strong class="ih hj"> auth.gs </strong>。</li><li id="8ba7" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc le jw jx jy bi translated">将以下代码复制并粘贴到auth.gs文件中。</li></ol><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="2b33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.打开创建服务帐户时下载的文件。找到“客户端电子邮件”。复制并粘贴它以替换auth.gs的第8行中的YOUR_SVCACCT_EMAIL。保留单引号。</p><p id="cf03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.现在找到并复制以“———BEGIN PRIVATE KEY”开头的“private_key”旁边的文本。这是一个非常长的密钥，您需要确保完整地复制它。粘贴此内容以替换auth.gs第6行中的YOUR_PRIVATE_KEY。保留单引号。</p><p id="97b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码需要<a class="ae jd" href="https://github.com/gsuitedevs/apps-script-oauth2" rel="noopener ugc nofollow" target="_blank"> OAuth2库</a>，这是一个具有可以在您自己的脚本中使用的功能的项目。要添加库，请按照下列步骤操作:</p><ol class=""><li id="0159" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc le jw jx jy bi translated">单击菜单项“资源&gt;库…”</li><li id="b453" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc le jw jx jy bi translated">在“查找库”文本框中，输入脚本ID <code class="du lm ln lo lp b">1B7FSrk5Zi6L1rSxxTDgDEUsPzlukDsi4KGuTMorsTQHhGBzBkMun4iDF</code>并点击“选择”按钮。</li><li id="a932" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc le jw jx jy bi translated">在下拉框中选择一个版本(通常最好选择最新版本)。</li><li id="d50a" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc le jw jx jy bi translated">点击“保存”按钮。</li></ol><h2 id="b70b" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated"><strong class="ak">让你的谷歌表单自动预测新推文的情绪</strong></h2><p id="36be" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">目前的代码包含一个需要文本块作为输入的函数。该文本将来自您的电子表格。您可以编写第二个函数，该函数将遍历电子表格的每一行，将tweet文本发送到AutoML，并将情感评分响应粘贴到电子表格中tweet的旁边。</p><ol class=""><li id="2718" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc le jw jx jy bi translated">将以下代码复制并粘贴到code.gs文件中，将其插入到已经存在的代码之上。</li></ol><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="ff2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.在编辑器中保存代码，然后导航回Google工作表。</p><p id="4af9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您已经准备好在您的Google Sheet中测试预测了。在写这篇文章的时候，你可以<a class="ae jd" href="https://cloud.google.com/natural-language/automl/pricing" rel="noopener ugc nofollow" target="_blank">免费预测一个月多达30k的文本记录</a>，所以只要你保持在这个阈值之下，这部分将是免费的。</p><p id="06fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.在浏览器中重新加载Google工作表。你会看到一个名为<strong class="ih hj"> AutoML Tools </strong>的新菜单出现在<strong class="ih hj"> Help </strong>菜单旁边。</p><p id="7b7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.在<strong class="ih hj"> AutoML Tools </strong>菜单下，点击<strong class="ih hj">标记自定义情绪</strong>。</p><p id="daca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.在弹出的对话框中点击<strong class="ih hj">继续</strong>，登录你的谷歌账户，点击“此应用未验证”屏幕底部的<strong class="ih hj">高级</strong>，最后检查权限并点击<strong class="ih hj">允许</strong>，授权代码运行。你可以在<a class="ae jd" href="https://www.benlcollins.com/apps-script/beginner-guide-to-google-apps-script/" rel="noopener ugc nofollow" target="_blank">本·柯林斯的博客</a>的这张gif 上看到非常相似的流程。</p><p id="9ee9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.授权后，代码将开始运行，您将会看到情感得分出现在automl _ perspective _ output列中。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lf"><img src="../Images/08e71d19b96ad3f6726e6f10276320dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8vu3t0S8ncip_RI_VEwPfw.png"/></div></div><figcaption class="lg lh et er es li lj bd b be z dx translated">automl _ perspective _ output列现在有情绪预测了！</figcaption></figure><h2 id="2d3e" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated"><strong class="ak">设置触发器以处理更大的数据集</strong></h2><p id="dff4" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">为了安全地遵守每个项目每分钟600个预测请求的<a class="ae jd" href="https://cloud.google.com/natural-language/automl/quotas" rel="noopener ugc nofollow" target="_blank">使用配额</a>，代码被设置为处理多达400行推文。如果您想要处理400条以上的tweet，您可以设置一个触发器来每分钟运行代码，每次运行时脚本将自动处理400条额外的tweet。下面是设置触发器的方法:</p><ol class=""><li id="3c49" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc le jw jx jy bi translated">打开脚本编辑器，点击<strong class="ih hj">编辑→当前项目的触发器</strong>。这将在G Suite Developer Hub中打开这个特定脚本的触发器配置页面。</li><li id="d194" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc le jw jx jy bi translated">点击右下角的<strong class="ih hj"> +添加触发器</strong>。</li><li id="7d17" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc le jw jx jy bi translated">完成以下选项，为您的mark perspective函数创建一个时间驱动的触发器:</li></ol><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lf"><img src="../Images/f7b1a87f570451877836a866f75cc57b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yu0H5Xniu0weENWpkCx8KA.png"/></div></div></figure><p id="0852" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.一旦你点击保存，你的脚本将开始每分钟运行一次，每次执行处理多达400条推文。</p><p id="a4dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 5。重要提示:</strong>完成整个数据集的预测后，<strong class="ih hj">您需要删除触发器。</strong>你可以在G Suite开发者中心点击触发器旁边的三个点，然后选择<strong class="ih hj">删除</strong>来完成。</p><p id="d98e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">如果不删除触发器</strong>，脚本将继续每分钟运行一次。虽然代码被编写为跳过所有已处理的行，但仍然存在问题可能导致代码调用API的风险，因此会产生超出自由层的预测费用。此外，触发器运行时间和执行时间等持续活动将计入您的<a class="ae jd" href="https://developers.google.com/apps-script/guides/services/quotas" rel="noopener ugc nofollow" target="_blank">应用程序脚本配额</a>。</p><h1 id="504c" class="lq kf hi bd kg lr ls lt kk lu lv lw ko lx ly lz kr ma mb mc ku md me mf kx mg bi translated"><strong class="ak">接下来的步骤</strong></h1><p id="9cc5" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">我对<a class="ae jd" href="https://cloud.google.com/products/ai/building-blocks/" rel="noopener ugc nofollow" target="_blank"> Google Cloud AI构建模块</a>(包括预先训练的ML APIs和AutoML产品)给Sheets用户带来的可能性感到非常兴奋！如果你还没有尝试过遵循这个教程，我建议你尝试一下。你需要的所有代码都链接在这篇文章里。</p><p id="216d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过Twitter <a class="ae jd" href="https://twitter.com/presactlyalicia" rel="noopener ugc nofollow" target="_blank"> @presactlyalicia </a>，或者在下面的评论区，分享你的经验，以及你对从工作表中使用ML的其他方法的想法。</p></div></div>    
</body>
</html>