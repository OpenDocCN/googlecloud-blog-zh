<html>
<head>
<title>MLOps — Productionising ML Models at Google Scale</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MLOps——以谷歌的规模生产ML模型</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/mlops-productionising-ml-models-at-google-scale-e78949c20e0a?source=collection_archive---------4-----------------------#2022-12-21">https://medium.com/google-cloud/mlops-productionising-ml-models-at-google-scale-e78949c20e0a?source=collection_archive---------4-----------------------#2022-12-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c95a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在已经在常规软件开发中使用DevOps有一段时间了，但我们也可以将它用于机器学习和人工智能。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/bdd22f863fb1c5344076bba83e0e5e90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tAKQgUzg_p4DxYkcbixSVw.png"/></div></div></figure><p id="9d44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们为什么需要DevOps？在DevOps之上分层机器学习和人工智能背后的原因是什么？ML Ops和AI Ops有什么区别？继续阅读这篇博客找出答案。</p><h1 id="1cef" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">什么是MLOps？</h1><p id="9ec0" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">许多行业将机器学习系统集成到他们现有的产品和服务中，因为ML对底线有好处，它可以增强你的竞争优势。</p><p id="e1cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">MLOps是数据科学家和运营专业人员之间进行协作和沟通的一套实践。应用这些实践可以提高质量，简化管理流程，并在大规模生产环境中自动部署机器学习和深度学习模型。更容易将模型与业务需求以及法规要求结合起来。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ks"><img src="../Images/5241665f1eb87ce7e77ae654db0ba5a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WMNKOWbBRPn8nObhX4FLIw.png"/></div></div></figure><p id="43b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">MLOps的关键阶段是:</p><ul class=""><li id="f4a7" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ky kz la lb bi translated">数据采集</li><li id="4057" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">数据分析</li><li id="7c32" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">数据转换/准备</li><li id="8a54" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">模型培训和开发</li><li id="15ad" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">模型验证</li><li id="e16c" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">模型服务</li><li id="6662" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">模型监控</li><li id="bf0f" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">模型再训练</li></ul><h1 id="b29a" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">DevOps与MLOps</h1><p id="8197" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">DevOps和MLOps有基本的相似之处，因为MLOps是从DevOps原理派生出来的。但是它们在执行上有很大的不同:</p><ol class=""><li id="eab8" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc lh kz la lb bi translated">与DevOps不同，<strong class="ih hj"> MLOps本质上更具实验性</strong>。数据科学家和ML/DL工程师必须调整各种功能，包括超参数、参数和模型，同时还要跟踪和管理数据和代码库，以获得可重现的结果。</li><li id="1e69" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lh kz la lb bi translated"><strong class="ih hj">混合团队组成:</strong>在产品中构建和部署模型所需的团队将不会只由软件工程师组成。在ML项目中，团队通常包括数据科学家或ML研究人员，他们专注于探索性数据分析、模型开发和实验。他们可能不是有经验的软件工程师，无法构建产品级的服务。</li><li id="8511" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lh kz la lb bi translated">测试:测试一个ML系统包括模型验证、模型训练等等——除了传统的代码测试，比如单元测试和集成测试。</li><li id="d7ac" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lh kz la lb bi translated"><strong class="ih hj">自动化部署</strong>:你不能仅仅将离线训练的ML模型作为预测服务来部署。您将需要一个多步骤的管道来自动重新训练和部署模型。这种管道增加了复杂性，因为您需要在部署之前自动执行数据科学家手动执行的步骤，以训练和验证新模型。</li><li id="5fe0" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lh kz la lb bi translated"><strong class="ih hj">由于不断发展的数据配置文件或简单的培训服务偏差导致的系统生产性能下降</strong>:生产中的ML模型可能会降低性能，这不仅是因为次优编码，还因为不断<strong class="ih hj">发展的数据配置文件</strong>。与传统的软件系统相比，模型会以更多的方式衰退，您需要为此做好计划。</li><li id="1697" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc lh kz la lb bi translated"><strong class="ih hj">监控</strong>:生产中的机型需要监控。类似地，需要监控构建模型的数据的汇总统计，以便您可以在需要时刷新模型。这些统计数据会随着时间的推移而改变，当值偏离您的预期时，您需要通知或回滚过程。</li></ol><p id="5203" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">MLOps和DevOps 在持续集成源代码控制、单元测试、集成测试以及持续交付软件模块或软件包方面是相似的。</p><p id="3448" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，在ML中有一些显著的区别:</p><ul class=""><li id="99bb" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ky kz la lb bi translated"><strong class="ih hj">持续集成</strong> (CI)不再仅仅是测试和验证代码和组件，还包括测试和验证数据、数据模式和模型。</li><li id="7b89" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">持续部署</strong> (CD)不再是关于一个单独的软件包或服务，而是一个系统(一个ML训练管道)，它应该自动部署另一个服务(模型预测服务)或从一个模型回滚变更。</li><li id="3d81" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">连续测试</strong> (CT)是一个新的特性，是ML系统独有的，它涉及自动重新训练和服务模型。</li></ul><h1 id="ea38" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">如何实现MLOps</h1><p id="be7c" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">有三种方法可以实现MLOps。本节描述了MLOps的三个级别，从最常见的级别(不涉及自动化)开始，一直到ML和CI/CD管道的自动化。</p><h1 id="8573" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">MLOps级别0:手动流程</h1><p id="9304" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">在第0级，构建和部署ML模型的过程完全是手工的。这对于刚刚开始ML的公司来说是典型的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lj"><img src="../Images/f3b6c75157a5af94556f7e9cf17ac9f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fBl6vWhXjUs0pG2RsQV4YQ.png"/></div></div></figure><p id="578e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">特性</strong></p><ul class=""><li id="78e8" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ky kz la lb bi translated"><strong class="ih hj">手动、脚本驱动、交互流程:</strong>每一步都是手动的，包括数据分析、数据准备、模型训练、验证。它需要手动执行每个步骤，并从一个步骤手动转换到另一个步骤<strong class="ih hj">。</strong></li><li id="79b7" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">ML和运营之间的脱节:</strong>这个过程把创建模型的数据科学家和为模型提供预测服务的工程师分开了。数据科学家将一个经过训练的模型作为工件交给工程团队部署到他们的API基础设施上。</li><li id="b651" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">不频繁的发布迭代:</strong>假设您的数据科学团队管理一些不经常更改的模型，要么更改模型实现，要么用新数据重新训练模型。新的模型版本每年只部署几次。</li><li id="2db1" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">没有持续集成(CI): </strong>因为很少假设实现变化，所以您忽略了CI。通常，测试代码是笔记本或脚本执行的一部分。</li><li id="df4a" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">无持续部署(CD): </strong>因为没有频繁的模型版本部署，所以不考虑CD。</li><li id="0152" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">部署是指预测服务</strong>(即带有REST API的微服务)</li><li id="77ae" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">缺乏主动的性能监控:</strong>流程没有跟踪或记录模型预测和行动。</li></ul><p id="4945" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">工程团队可能有自己复杂的API配置、测试和部署设置，包括安全性、回归和load + canary测试。</p><p id="a53f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">挑战</strong></p><p id="9eaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实际上，模型在现实世界中部署时经常会崩溃。模型无法适应环境动态的变化或描述环境的数据的变化。</p><p id="ddac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了应对这一手动流程的挑战，最好对CI/CD和CT使用MLOps实践。通过部署ML培训管道，您可以启用CT，并且可以设置CI/CD系统来快速测试、构建和部署ML管道的新实现</p><h1 id="3a49" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">MLOps一级:ML管道自动化</h1><p id="f41e" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">MLOps级的目标是通过自动化ML管道来执行模型的连续训练(CT)。为了自动化使用新数据在生产中重新训练模型的过程，您需要向管道中引入自动化的数据和模型验证步骤，以及管道触发器和元数据管理。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lk"><img src="../Images/5adc3d3ad1bbaab6d1f610d94c592ada.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jccLMwjCFfmLJQ5YviO4rw.png"/></div></div></figure><p id="d376" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">特性</strong></p><ul class=""><li id="0828" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ky kz la lb bi translated"><strong class="ih hj">快速实验</strong> : ML实验步骤被编排并自动完成。</li><li id="5832" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">生产中模型的CT</strong>:模型在生产中自动训练，使用基于实时管道触发器的新数据。</li><li id="0c3b" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">实验-操作对称</strong>:在开发或实验环境中使用的流水线实现在预生产和生产环境中使用，这是统一开发运维的MLOps实践的一个关键方面。</li><li id="ac76" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">组件和管道的模块化代码:</strong>为了构建ML管道，组件需要可重用、可组合，并且可以跨ML管道共享(即使用容器)。</li><li id="ee5b" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">模型的连续交付</strong>:模型部署步骤是自动化的，该步骤将经过训练和验证的模型作为在线预测的预测服务。</li><li id="8376" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">管道部署:</strong>在第0级中，您将一个经过训练的模型作为预测服务部署到生产中。对于级别1，您将部署一个完整的训练管道，该管道会自动循环运行，以作为预测服务为已训练的模型提供服务。</li></ul><h1 id="de5a" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">挑战</h1><p id="ff59" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">假设不经常部署管道的新实现，并且您只管理几个管道，那么您通常手工测试管道及其组件。此外，您需要手动部署新的管道实现。您还将管道的测试源代码提交给it团队，以便部署到目标环境中。当您基于新数据而不是基于新的ML思想部署新模型时，这种设置是合适的。</p><p id="c8a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，您需要尝试新的ML思想，并快速部署ML组件的新实现。如果您在生产中管理许多ML管道，那么您需要一个CI/CD设置来自动化ML管道的构建、测试和部署。</p><h1 id="6c67" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">MLOps第2级:CI/CD管道自动化</h1><p id="8b1e" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">为了快速可靠地更新生产中的管道，您需要一个强大的自动化CI/CD系统。这个自动化的CI/CD系统使您的数据科学家能够快速探索关于特征工程、模型架构和超参数的新想法。他们可以实现这些想法，并自动构建、测试和部署新的管道组件到目标环境中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ll"><img src="../Images/a3ed96296979ef69900035c9f032df73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Ld15nY2cGnjVGBB_r3f9A.png"/></div></div></figure><p id="c405" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该MLOps设置包括以下组件:</p><ul class=""><li id="b60c" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ky kz la lb bi translated">源代码控制</li><li id="058a" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">测试和构建服务</li><li id="95cf" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">部署服务</li><li id="b9f7" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">模型注册表</li><li id="789a" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">功能存储</li><li id="68e2" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">ML元数据存储</li><li id="2edb" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">ML管道编排器</li></ul><h1 id="6032" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">特征</h1><p id="63b8" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">下图显示了ML CI/CD自动化流程的各个阶段:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/a71262656189badece3a5b118efd00d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*46Lry_0fbzcUZ09LNjFZrg.png"/></div></div></figure><ul class=""><li id="5d07" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ky kz la lb bi translated"><strong class="ih hj">开发和实验:</strong>你迭代地尝试新的ML算法和新的建模，其中实验步骤被编排。这个阶段的输出是ML管道步骤的源代码，然后这些源代码被推送到源存储库。</li><li id="4190" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">流水线持续集成</strong>:你构建源代码并运行各种测试。这个阶段的输出是将在后面阶段部署的管道组件(包、可执行文件和工件)。</li><li id="e4b8" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">管道连续交付:</strong>您将CI阶段产生的工件部署到目标环境中。这个阶段的输出是一个部署了模型的新实现的管道。</li><li id="b321" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">自动触发:</strong>流水线在生产中根据时间表或响应触发自动执行。这一阶段的输出是新训练的模型，该模型被推送到<a class="ae li" href="https://neptune.ai/blog/ml-model-registry" rel="noopener ugc nofollow" target="_blank">模型注册表</a>。</li><li id="1517" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">模型连续交付:</strong>您将训练好的模型作为预测的预测服务。此阶段的输出是一个已部署的模型预测服务。</li><li id="445e" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated"><strong class="ih hj">监控</strong>:您基于实时数据收集模型性能的统计数据。这个阶段的输出是执行流水线或执行新的实验周期的触发器。</li></ul><h1 id="8c54" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="84e8" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">总而言之，在生产环境中实现ML并不仅仅意味着将您的模型部署为预测的API。相反，这意味着部署一个ML管道，它可以自动化新模型的再训练和部署。设置CI/CD系统使您能够自动测试和部署新的管道实现。该系统让您能够应对数据和业务环境的快速变化。</p></div></div>    
</body>
</html>