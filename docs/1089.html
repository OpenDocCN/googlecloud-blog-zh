<html>
<head>
<title>Efficient spatial matching in BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">BigQuery中高效的空间匹配</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/efficient-spatial-matching-in-bigquery-c4ddc6fb9f69?source=collection_archive---------1-----------------------#2019-07-23">https://medium.com/google-cloud/efficient-spatial-matching-in-bigquery-c4ddc6fb9f69?source=collection_archive---------1-----------------------#2019-07-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="6567" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">使用空间连接-带有ST_*条件的SQL连接</h2></div><p id="051a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是一个问题(适当匿名):</p><p id="6ce9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">“我有一个巨大的点数据集和另一个巨大的多边形数据集。我必须一个接一个地遍历多边形，找到每个多边形内部的所有点。BigQuery能做到这一点吗？”</p><p id="eb6d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">答案？是的，BigQuery可以做到这一点，但您不必遍历多边形。如果您的经验主要是函数式/面向对象编程，SQL可能看起来很奇怪。这是一种用空间连接执行起来非常有效的事情。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es ju"><img src="../Images/8fe173e0481e12dc0da2a8cd66168aca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_wjZpqjNwr30ymdnRn1j1g.jpeg"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">BigQuery中的连接是根据空间范围关联两个实体的有效方式。<a class="ae kk" href="https://unsplash.com/@pepitaphotos?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> kgrkz </a>在<a class="ae kk" href="https://unsplash.com/search/photos/association?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="5009" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">空间连接适用于任意两个几何和各种空间函数。例如，让我们查找覆盖一个城市区域的所有邮政编码:</p><pre class="jv jw jx jy fd kl km kn ko aw kp bi"><span id="5b70" class="kq kr hi km b fi ks kt l ku kv">WITH city AS (<br/>SELECT<br/>  name,<br/>  urban_area_geom AS geom<br/>FROM `bigquery-public-data`.geo_us_boundaries.urban_areas<br/>),</span><span id="99c6" class="kq kr hi km b fi kw kt l ku kv">zip AS (<br/>SELECT<br/>  zip_code,<br/>  zcta_geom AS geom<br/>FROM `bigquery-public-data`.geo_us_boundaries.zip_codes<br/>)</span><span id="4898" class="kq kr hi km b fi kw kt l ku kv">SELECT<br/>  city.name, TO_JSON_STRING(ARRAY_AGG(zip_code)) AS zipcodes<br/><strong class="km hj">FROM<br/>  city<br/>JOIN<br/>  zip<br/>ON<br/>  ST_INTERSECTS(city.geom, zip.geom)</strong><br/>GROUP BY city.name</span></pre><p id="21e0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">关键的一点是，在城市几何与邮政编码几何相交的情况下，我们将城市表连接到邮政编码表。</p><p id="c500" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当然，您还可以使用其他功能。您可以检查点与面的距离是否小于100 km。或者一个地理位置完全包含另一个地理位置。</p><p id="cbf2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在BigQuery中尝试一下吧！</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es kx"><img src="../Images/aadc9a95e8248e85e31704bfebb8d50f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*rVJ24HJ40uyS9lJ7GiqgmQ.png"/></div></figure><p id="f5de" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我的许多博客帖子来自客户的问题，即使我并不总是提到促使帖子的对话。因此，如果你有关于在GCP做数据分析或ML的问题，请发推特给我，地址是@lak_gcp。</p></div></div>    
</body>
</html>