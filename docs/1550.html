<html>
<head>
<title>Yet another way to generate fake datasets in BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在BigQuery中生成假数据集的另一种方法是</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/yet-another-way-to-generate-fake-datasets-in-bigquery-93ee87c1008f?source=collection_archive---------0-----------------------#2020-08-07">https://medium.com/google-cloud/yet-another-way-to-generate-fake-datasets-in-bigquery-93ee87c1008f?source=collection_archive---------0-----------------------#2020-08-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="d90d" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">用Javascript UDF包装faker.js</h2></div><p id="8bda" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">(2020年11月20日更新:示例现在使用生成的序列表，而不是使用wise_all_sky公共数据集作为基表)</p><p id="16fa" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在创建演示和概念证明时，我经常遇到这样的问题:如何找到合适的样本数据来开始。BigQuery的<a class="ae jt" href="https://cloud.google.com/bigquery/public-data" rel="noopener ugc nofollow" target="_blank">公共数据集</a>是一个很好的资源，但很少拥有构建一个合适环境所需的一切。</p><p id="2221" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于许多项目来说，创建初始样本数据已经成为一个必要而繁琐的过程。因此，近年来，像<a class="ae jt" href="https://github.com/marak/Faker.js/" rel="noopener ugc nofollow" target="_blank"> faker.js </a>或<a class="ae jt" href="https://github.com/joke2k/faker" rel="noopener ugc nofollow" target="_blank"> python </a>这样的假数据库变得流行起来。在使用这些库时，我发现自己在验证BigQuery中生成的数据和调整用于导入数据的代码之间的上下文切换会降低速度。</p><p id="b305" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里有一个快速教程，介绍如何使用一个<a class="ae jt" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions#javascript-udf-structure" rel="noopener ugc nofollow" target="_blank"> Javascript UDF </a>和faker.js库在几分钟内生成数十亿行虚假数据，而无需离开BigQuery控制台。</p><h2 id="56e3" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">生成第一条记录</h2><p id="ba91" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">下面的例子通过使用返回一个<a class="ae jt" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types#declaring_a_struct_type" rel="noopener ugc nofollow" target="_blank">结构类型</a>的临时UDF来最大化灵活性。在select语句末尾使用的通配符“*”将函数返回的结构类型转换为普通的表行。可以快速重新定义临时UDF，以返回faker.js库范围内的任何数据。</p><figure class="ku kv kw kx fd ky"><div class="bz dy l di"><div class="kz la l"/></div></figure><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es lb"><img src="../Images/e396a379bda4188e06d5177efbc8a91d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wsM8vPA_UKvaMFbkcapBsg.png"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx translated">单记录输出</figcaption></figure><p id="edb0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="lm"> BigQuery与大型Javacript库的兼容性可能很挑剔；一个为UDF库手工打包的webpack输出可以在GitHub </em>  <em class="lm">上找到</em> <a class="ae jt" href="https://github.com/pdunn/bq_fake_data/tree/master/udf_lib" rel="noopener ugc nofollow" target="_blank"> <em class="lm">。</em></a></p><h2 id="4014" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated"><strong class="ak">生成任意数量的唯一行</strong></h2><p id="c2ce" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">为了创建许多行，SQL select语句需要一个表来进行选择；结果集的行数将与所选表中的行数相匹配。</p><p id="b897" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了促进这一功能，您将生成一个包含增量值序列的表，它可以作为faker产生唯一值的随机种子。</p><p id="9d60" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建和使用包含数十亿条记录的表会产生明显的费用。查看我的<a class="ae jt" rel="noopener" href="/google-cloud/optimize-bigquery-costs-with-flex-slots-e06ec5e4aa90">早先的帖子，关于使用弹性槽</a>在处理大桌子时大幅减少你的账单。</p><figure class="ku kv kw kx fd ky"><div class="bz dy l di"><div class="kz la l"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">在大约2分钟内生成10亿个顺序编号的行</figcaption></figure><p id="3c7e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du ln lo lp lq b">row_seq</code>表可以有选择地播种数十亿条记录，足以满足任何用例。此外，通过使用行号，生成的结果既可重复又是唯一的。</p><figure class="ku kv kw kx fd ky"><div class="bz dy l di"><div class="kz la l"/></div><figcaption class="li lj et er es lk ll bd b be z dx translated">在大约4分钟内生成1亿个实体</figcaption></figure><p id="57ba" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">dataset.fake_accounts表的预览显示了与生成它的种子配对的每个实体。任何一行都可以通过重新调用<code class="du ln lo lp lq b">entity()</code>函数来重现，即<code class="du ln lo lp lq b">select entity(30048188).*</code>将重现Tiara Zulauf。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es lr"><img src="../Images/ea733bcb744c4607ac533da688e292e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xTTvI4MII117LWjzp7GYXA.png"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx translated">可由row_num复制的伪实体</figcaption></figure><h2 id="4ea8" class="ju jv hi bd jw jx jy jz ka kb kc kd ke jg kf kg kh jk ki kj kk jo kl km kn ko bi translated">额外资源</h2><p id="5f4d" class="pw-post-body-paragraph ix iy hi iz b ja kp ij jc jd kq im jf jg kr ji jj jk ks jm jn jo kt jq jr js hb bi translated">这里有一些额外的资源可以帮助你。</p><ul class=""><li id="0f92" class="ls lt hi iz b ja jb jd je jg lu jk lv jo lw js lx ly lz ma bi translated">Google PSO团队的全功能数据生成器</li><li id="ad31" class="ls lt hi iz b ja mb jd mc jg md jk me jo mf js lx ly lz ma bi translated">我的同事Salmaan Rashid关于用webpack打包UDF的一篇文章</li><li id="2fc4" class="ls lt hi iz b ja mb jd mc jg md jk me jo mf js lx ly lz ma bi translated">BigQuery <a class="ae jt" href="https://github.com/GoogleCloudPlatform/bigquery-utils/tree/master/udfs/community" rel="noopener ugc nofollow" target="_blank">社区UDF</a></li></ul></div></div>    
</body>
</html>