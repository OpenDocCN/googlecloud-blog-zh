<html>
<head>
<title>Event Driven Transfers from Amazon S3 to Google Cloud Storage using Storage Transfer Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用存储传输服务从亚马逊S3到谷歌云存储的事件驱动传输</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/event-driven-transfers-from-amazon-s3-to-google-cloud-storage-using-storage-transfer-service-81e7abae3c1a?source=collection_archive---------1-----------------------#2022-12-13">https://medium.com/google-cloud/event-driven-transfers-from-amazon-s3-to-google-cloud-storage-using-storage-transfer-service-81e7abae3c1a?source=collection_archive---------1-----------------------#2022-12-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/da4faee2184edc4c7412ce56d94092c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Iax0FeSxRIk22L_TbmVWXQ.jpeg"/></div></div></figure><p id="98b8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi jo translated">oogle云平台正式发布了由事件驱动传输发起的存储传输服务的公开预览。这将帮助我们将对象从亚马逊S3转移到谷歌云存储(GCS)桶，或者将一个GCS桶转移到其他GCS桶，以响应在源中创建新对象时发生的事件。</p><p id="0ffc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">当前场景</strong></p><p id="e21c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最初，Storage Transfer Service只有按特定计划运行对象的选项。虽然这有助于重复传输数据的最小时间表为1小时，但对于需要在亚马逊S3和GCS之间持续同步数据的客户来说，这可能不够快。拥有多云生态系统的客户需要在创建或修改对象后立即转移到GCS，但这并不存在。</p><p id="7e60" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">事件驱动传输是如何工作的？</strong></p><p id="84f6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">存储传输服务可以侦听AWS或Google Cloud中的事件通知，以自动传输在源位置添加或更新的数据。</p><p id="e6b9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">事件驱动传输的优势</strong></p><p id="ee84" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为事件驱动的传输会侦听源存储桶的更改，所以更新会近乎实时地复制到目标存储桶。存储转移服务不需要对源执行列表操作，节省了时间和金钱。</p><p id="711e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用案例包括:</p><ul class=""><li id="55b9" class="jx jy hi is b it iu ix iy jb jz jf ka jj kb jn kc kd ke kf bi translated"><strong class="is hj">事件驱动分析</strong>:将数据从AWS复制到云存储，以执行分析和处理。</li><li id="521f" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated"><strong class="is hj">云存储复制</strong>:在云存储桶之间实现自动、异步的对象复制。</li><li id="8ef6" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated"><strong class="is hj">灾难恢复/高可用性设置</strong>:以分钟为单位将对象从源复制到备份目标。</li><li id="01c3" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated"><strong class="is hj">实时迁移</strong>:事件驱动的迁移可以支持低停机时间迁移，停机时间大约为几分钟，作为一次性批量迁移的后续步骤。</li></ul><p id="b265" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">在亚马逊S3和GCS之间设置事件驱动转账的步骤:</strong></p><p id="5a30" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">先决条件包括:</strong></p><ol class=""><li id="4110" class="jx jy hi is b it iu ix iy jb jz jf ka jj kb jn kl kd ke kf bi translated">一个亚马逊S3桶作为来源</li><li id="b6db" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kl kd ke kf bi translated">谷歌云存储桶作为目的地</li></ol><p id="7c32" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤:</strong></p><ol class=""><li id="0bbe" class="jx jy hi is b it iu ix iy jb jz jf ka jj kb jn kl kd ke kf bi translated">在AWS部分，转到简单队列服务并单击<strong class="is hj">创建队列。</strong></li></ol><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es km"><img src="../Images/a6fbae7da2889ab63ad9b0a2b122eb5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CZSEdfRxiYA4X6kdIzConw.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">SQS的AWS页面</figcaption></figure><p id="b673" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.输入队列的<strong class="is hj">名称</strong>，向下滚动至<strong class="is hj">访问策略</strong>部分，点击<strong class="is hj">高级</strong>。您应该会看到一个类似下面的<strong class="is hj"> JSON </strong>对象。注意<strong class="is hj">本金。来自JSON的AWS </strong>和<strong class="is hj">资源</strong>。</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/922cf58ddeb9dbdb0fc9fb3ac818e1bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ZUKrFceC4UGRTxSSe9SGQ.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">创建SQS队列时访问策略部分</figcaption></figure><p id="63ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.更换<strong class="is hj">主体。AWS </strong>和<strong class="is hj">资源</strong>与<strong class="is hj">负责人。下面JSON代码中的AWS </strong>和<strong class="is hj"> RESOURCE_ARN </strong>。另外，将<strong class="is hj">S3 _木桶_ARN </strong>替换为您的源S3木桶的亚马逊资源名称或ARN(您可以在S3木桶的<strong class="is hj">属性</strong>部分找到S3木桶的ARN)。将访问策略部分中的JSON替换为下面的JSON，并单击<strong class="is hj">创建队列</strong>。</p><pre class="kn ko kp kq fd kw kx ky bn kz la bi"><span id="c6ab" class="lb lc hi kx b be ld le l lf lg">{<br/>  "Version": "2012-10-17",<br/>  "Id": "example-ID",<br/>  "Statement": [<br/>    {<br/>      "Sid": "example-statement-ID",<br/>      "Effect": "Allow",<br/>      "Principal": {<br/>        "Service": "s3.amazonaws.com"<br/>      },<br/>      "Action": "SQS:SendMessage",<br/>      "Resource": "RESOURCE_ARN",<br/>      "Condition": {<br/>        "StringEquals": {<br/>          "aws:SourceAccount": "PRINCIPAL.AWS"<br/>        },<br/>        "ArnLike": {<br/>          "aws:SourceArn": "S3_BUCKET_ARN"<br/>        }<br/>      }<br/>    }<br/>  ]<br/>}</span></pre><p id="f123" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每当在源S3存储桶中创建或修改对象时，该队列都会做出响应。</p><p id="8fc1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.一旦创建了SQS队列，请注意该队列的ARN，其格式如下所示:</p><pre class="kn ko kp kq fd kw kx ky bn kz la bi"><span id="fd35" class="lb lc hi kx b be ld le l lf lg">arn:aws:sqs:us-east-1:1234567890:event-queue"</span></pre><p id="13fa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.下一步是在亚马逊S3上启用通知，转到源S3桶并转到<strong class="is hj">属性</strong>。向下滚动到<strong class="is hj">事件通知</strong>并点击<strong class="is hj">创建事件通知</strong>。</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/97e977af5a325cf58e32ac7cda7d72a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_pdN2joG3be2E0Unj_hxMA.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">在来源S3时段中创建事件通知</figcaption></figure><p id="f8c0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.为此事件指定一个名称。在<strong class="is hj">事件类型</strong>部分，选择<strong class="is hj">所有对象创建事件</strong>。选择<strong class="is hj"> SQS队列</strong>作为<strong class="is hj">目的地</strong>，并选择您为此次转移创建的队列。点击<strong class="is hj">保存更改</strong>。</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/764a4fb6e7ddbf0234822c8f9dabcc12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9LC-WJLpfz1c43Lq9gNNPw.png"/></div></div></figure><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/304d944798ca0c3f13cea2246b6320ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*APkvZ43T2TErBkzkIXpvTQ.png"/></div></div></figure><p id="9698" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.要创建一个AWS访问密钥ID和秘密访问密钥或一个有足够权限运行该作业的联合身份ARN，您可以遵循这里的步骤<a class="ae lk" href="https://cloud.google.com/storage-transfer/docs/source-amazon-s3" rel="noopener ugc nofollow" target="_blank">和</a>。您还可以使用下面的JSON设置运行作业所需的自定义权限。您可以用源S3桶和SQS队列ARN替换<strong class="is hj"> AWS_BUCKET_NAME </strong>和<strong class="is hj"> AWS_QUEUE_ARN </strong>。</p><pre class="kn ko kp kq fd kw kx ky bn kz la bi"><span id="3075" class="lb lc hi kx b be ld le l lf lg">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Effect": "Allow",<br/>            "Action": [<br/>                "sqs:DeleteMessage",<br/>                "sqs:ChangeMessageVisibility",<br/>                "sqs:ReceiveMessage",<br/>                "s3:GetObject",<br/>                "s3:ListBucket",<br/>                "s3:GetBucketLocation"<br/>            ],<br/>            "Resource": [<br/>                "arn:aws:s3:::AWS_BUCKET_NAME",<br/>                "arn:aws:s3:::AWS_BUCKET_NAME/*",<br/>                "AWS_QUEUE_ARN"<br/>            ]<br/>        }<br/>    ]<br/>}</span></pre><p id="9131" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建后，请注意以下信息:</p><ul class=""><li id="15df" class="jx jy hi is b it iu ix iy jb jz jf ka jj kb jn kc kd ke kf bi translated">对于用户，记下访问密钥ID和秘密密钥。</li><li id="b2a1" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">对于联合身份角色，请注意Amazon资源名称(ARN)，其格式为<code class="du ll lm ln kx b">arn:aws:iam::AWS_ACCOUNT:role/ROLE_NAME</code>。</li></ul><p id="4258" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">6.在GCP控制台中，创建一个以<strong class="is hj">亚马逊S3 </strong>为<strong class="is hj">源</strong>和<strong class="is hj">谷歌云存储</strong>为<strong class="is hj">目的</strong>的传输作业，点击<strong class="is hj">进入下一步。</strong></p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/f34273a10e647c8ad264cd969872bcd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fp1hTrzjWEePG1nUwyZGCA.png"/></div></div></figure><p id="472f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">7.在<strong class="is hj">源</strong>中，键入桶路径或带有路径的桶名称(如果有)源S3桶以及访问密钥ID和秘密访问密钥或联合身份角色，然后单击<strong class="is hj">下一步</strong>。</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/132af4c68cd3837bb5ff2767513b8518.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-6oSbvv60hy0GlVHyxC7mw.png"/></div></div></figure><p id="dabd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">8.在<strong class="is hj">目的地中，</strong>选择目的地<strong class="is hj"> GCS桶</strong>并点击<strong class="is hj">下一步</strong>。</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/3d138f23889db525a2a0194aa0f711ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aky0-nR-OltMJ7u6SYTOWQ.png"/></div></div></figure><p id="d457" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">9.在<strong class="is hj">中选择如何以及何时运行作业</strong>，将传输类型切换到<strong class="is hj">事件驱动</strong>，并进入<strong class="is hj"> SQS队列ARN。</strong>您还可以安排传输何时开始监听SQS队列，以及何时停止监听。或者，单击<strong class="is hj">下一步</strong>修改Storage Transfer Service提供的任何附加设置，或者单击<strong class="is hj"> Create </strong>创建作业。</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/a36493c97c2d2d470b41297c8ddb1cb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gMOs-z0MBMt5PZ0YwObdwQ.png"/></div></div></figure><p id="2f2d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">10.存储传送服务现在将侦听SQS对象。无论何时，在亚马逊S3存储桶中创建/修改任何对象，都会立即与目标GCS存储桶同步，并将新创建/修改的S3对象传输到GCS。</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/58615286d52ad935a56c9466e13cc4e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2x2d665yHMv-M4S0MgWxAA.png"/></div></div></figure><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/ef402e5b4fc15e7c529f84851f839c42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9zhm_xfMG7WpDsiMamNQFg.png"/></div></div></figure><p id="6c36" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重要说明<strong class="is hj"> : </strong>目前该服务处于公开预览阶段，仅支持S3到GCS和GCS到GCS的转账</p><p id="96b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢阅读！😊</p><p id="48bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">参考文献:</strong></p><p id="5021" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以在官方文档中读到关于事件驱动的转移</p><div class="lu lv ez fb lw lx"><a href="https://cloud.google.com/storage-transfer/docs/event-driven-transfers" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hj fi z dy mc ea eb md ed ef hh bi translated">事件驱动的传输|云存储传输服务文档| Google Cloud</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">预览Google Cloud服务条款中的预发布产品条款涵盖了此功能。正式发布前的功能…</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">cloud.google.com</p></div></div><div class="mg l"><div class="mh l mi mj mk mg ml io lx"/></div></div></a></div><p id="517b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">存储转移服务发行说明</p><div class="lu lv ez fb lw lx"><a href="https://cloud.google.com/storage-transfer/docs/release-notes#September_07_2022" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hj fi z dy mc ea eb md ed ef hh bi translated">存储转移服务发行说明|云存储转移服务文档| Google…</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">针对源自文件系统的传输的多部分上传现已普遍提供(GA ),并且默认启用…</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">cloud.google.com</p></div></div><div class="mg l"><div class="mm l mi mj mk mg ml io lx"/></div></div></a></div></div></div>    
</body>
</html>