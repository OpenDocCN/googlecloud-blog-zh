<html>
<head>
<title>Using Google’s Private Container Registry with Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Docker使用Google的私有容器注册表</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/using-googles-private-container-registry-with-docker-1b470cf3f50a?source=collection_archive---------0-----------------------#2017-07-31">https://medium.com/google-cloud/using-googles-private-container-registry-with-docker-1b470cf3f50a?source=collection_archive---------0-----------------------#2017-07-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="9547" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated"><strong class="ak">概述</strong></h1><p id="3b46" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">通过Docker使用Google的私有容器注册表</p><p id="7400" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">Google的Container Registry为存储Docker图像提供了一个托管的私有存储库。只需一个简单的gcloud命令，你就可以推送和拉取你的私有google项目库。</p><p id="97b7" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">示例:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="0e40" class="kp ig hi kl b fi kq kr l ks kt">gcloud docker — push [HOSTNAME]/[YOUR-PROJECT-ID]/[IMAGE]</span></pre><p id="6a9d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">但是，您可能会发现需要在没有gcloud的情况下使用本机docker命令。这在CI流程或其他自动化中可能是需要的。</p><p id="93eb" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">示例:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="d1de" class="kp ig hi kl b fi kq kr l ks kt">docker push [HOSTNAME]/[YOUR-PROJECT-ID]/[IMAGE]</span></pre><p id="b9e6" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在这个简短的教程中，我将通过几个简单的步骤来允许通过本地docker命令进行访问。</p><h1 id="503f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">创建一个帐户来访问注册表</h1><p id="ddf6" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">设置一些变量来简化命令</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="1030" class="kp ig hi kl b fi kq kr l ks kt">export PROJECT=my-project<br/>export KEY_NAME=key-name<br/>export KEY_DISPLAY_NAME=”My Key Name”</span></pre><p id="4288" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">创建并获取密钥</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="224a" class="kp ig hi kl b fi kq kr l ks kt">gcloud iam service-accounts create ${KEY_NAME} — display-name ${KEY_DISPLAY_NAME}<br/>gcloud iam service-accounts list<br/>gcloud iam service-accounts keys create — iam-account ${KEY_NAME}@${PROJECT}.iam.gserviceaccount.com key.json</span></pre><blockquote class="ku kv kw"><p id="0cfb" class="jd je kx jf b jg kb ji jj jk kc jm jn ky kd jq jr kz ke ju jv la kf jy jz ka hb bi translated">注意:上一个命令的输出是一个名为key.json的json文件。这个文件将被用作docker登录命令的输入，应该被移动到任何需要的系统或位置。</p></blockquote><p id="6ec2" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">为其提供适当的权限</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="d95b" class="kp ig hi kl b fi kq kr l ks kt">gcloud projects add-iam-policy-binding ${PROJECT} — member serviceAccount:${KEY_NAME}@${PROJECT}.iam.gserviceaccount.com — role roles/storage.admin</span></pre><h1 id="8079" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">使用凭据访问注册表</h1><p id="232f" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">登录</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="b8c4" class="kp ig hi kl b fi kq kr l ks kt">docker login -u _json_key -p “$(cat key.json)” <a class="ae lb" href="https://gcr.io" rel="noopener ugc nofollow" target="_blank">https://gcr.io</a></span></pre><p id="e73c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">提升你的形象</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="263f" class="kp ig hi kl b fi kq kr l ks kt">docker push gcr.io/${PROJECT}/example-image</span></pre><p id="9f31" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">也就是说，对于服务帐户json文件，您只需调用login，就可以在您的CI或自动化工作中使用docker</p></div></div>    
</body>
</html>