<html>
<head>
<title>Federate your User Accounts in Microsoft Azure AD to Google Cloud Identity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将您在Microsoft Azure AD中的用户帐户联合到Google Cloud Identity</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/federate-your-user-accounts-in-microsoft-azure-ad-to-google-cloud-identity-fe29ef639553?source=collection_archive---------1-----------------------#2022-08-15">https://medium.com/google-cloud/federate-your-user-accounts-in-microsoft-azure-ad-to-google-cloud-identity-fe29ef639553?source=collection_archive---------1-----------------------#2022-08-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9661" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://cloud.google.com/identity" rel="noopener ugc nofollow" target="_blank"> Google Cloud Identity </a>是IDaaS(身份即服务)，为Google Cloud和Google Workspace管理用户和组。用户和组的生命周期可以在云身份中管理。可以创建用户帐户和组，在身份中对其进行控制，以实现访问管理和合规性。有多种方法可以在Cloud Identity中创建用户—手动创建或通过CSV批量上传。</p><p id="9085" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于大型组织，用户帐户可能已经在另一个身份提供商(例如微软Azure广告。</p><p id="c263" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Microsoft Azure AD是基于云的身份和访问管理服务，有助于控制用户对外部和内部资源的访问。它有助于集中管理用户生命周期，并允许集成云应用程序以获得统一的用户体验。</p><p id="3be5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，在Microsoft Azure AD中维护用户帐户和组的情况下，它们可以在Google Cloud identity中联合，支持Azure AD中的单一真实和维护来源，同时扩展它们在Google Cloud Identity中的使用。下面是Google Cloud Identity和Microsoft Azure AD之间的联合架构设置示例。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/e0363596db39264c2671e6d91302e11f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*W6ZqWh-eIOiRTO_k"/></div></div></figure><p id="bc14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要在Google Cloud identity中使用用户帐户和组，我们<strong class="ih hj">首先需要从Microsoft Azure AD提供用户，然后在他们之间设置单点登录</strong>，以便对Google Cloud的请求可以重定向到Microsoft Azure AD进行身份验证。</p><p id="a5d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于本文档中的联合设置，我们将:</p><ul class=""><li id="2cc9" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">使用域名<strong class="ih hj"> demodata.info </strong></li><li id="8ba4" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">使用提供用户配置和单点登录配置的连接器— <a class="ae jd" href="https://azuremarketplace.microsoft.com/en-us/marketplace/apps/aad.googleapps" rel="noopener ugc nofollow" target="_blank">微软的Google Cloud / G Suite连接器</a></li></ul><p id="8b14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Google Cloud Identity和Microsoft Azure AD之间建立联盟所需的先决条件是:</p><ol class=""><li id="ece6" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc ke jw jx jy bi translated"><a class="ae jd" href="https://workspace.google.com/signup/gcpidentity/welcome#0" rel="noopener ugc nofollow" target="_blank"> Google Cloud Identity设置</a>完成-创建第一个云身份帐户，指定超级管理员用户名，并使用Google Cloud Identity验证您的组织域。</li></ol><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kf"><img src="../Images/ca38d4088d585e4f322379f0436919c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*r7ph5nBcUAhTRc8d"/></div></div></figure><p id="65da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.<a class="ae jd" href="https://portal.azure.com/#home" rel="noopener ugc nofollow" target="_blank"> Microsoft AzureAD </a>帐户和管理权限，用于设置配置和单点登录</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kg"><img src="../Images/fd67a9d98a8d59bffd842a7a39e82346.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nP-ZueQ1golpu1PG"/></div></div></figure><p id="eb35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.从Microsoft Azure AD联盟的用户的域在Google Cloud Identity中注册为主要或辅助域。所有域都必须注册，否则用户将不会被提供，并将在设置过程中抛出错误。</p><p id="b5e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.将用于Google cloud Identity和Microsoft Azure AD之间的连接的用户— <a class="ae jd" href="https://cloud.google.com/architecture/identity/federating-gcp-with-azure-ad-configuring-provisioning-and-single-sign-on#creating_a_cloud_identity_user_account_for_synchronization" rel="noopener ugc nofollow" target="_blank">为Microsoft Azure AD </a>创建用户。我们可以使用超级管理员用户，但为了简化维护和所有权，我们始终建议使用专用用户。<a class="ae jd" href="https://cloud.google.com/architecture/identity/federating-gcp-with-azure-ad-configuring-provisioning-and-single-sign-on#delegated-admin" rel="noopener ugc nofollow" target="_blank">授予该用户所需的权限</a>，以便可以通过Azure AD创建、删除和列出新用户。在我们的例子中，用户是azuread-provisioning</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kh"><img src="../Images/9489b149939c607ec662a84782ed3fe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hn2pdBB5whIA2oz1"/></div></div></figure><p id="7fef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.要联合的用户存在于Microsoft Azure AD中</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ki"><img src="../Images/3a1852b8cf911696833d37fcae2bdd69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*d8zuh3pyrjUxvTTq"/></div></div></figure><p id="0de7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们开始联合谷歌云身份和微软Azure AD之间的用户帐户</p><ol class=""><li id="eabc" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc ke jw jx jy bi translated">将Azure AD连接到Google Cloud Platform Cloud Identity并供应用户。使用<strong class="ih hj">谷歌云/微软G套件连接器</strong>创建新的企业应用</li></ol><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kj"><img src="../Images/681cd1273856dbf5840119f8e1adc6eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0U_J7dQrZMVEx5wX"/></div></div></figure><p id="1a95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.选择新应用程序，搜索微软Google Cloud/G Suite Connector<strong class="ih hj">。选择连接器，然后选择“创建”</strong></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kk"><img src="../Images/3dd05be59876639fd92b2519df13db4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/0*pEpWxXiIcKX5kX_9"/></div></figure><p id="1bd3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.在新应用程序中，选择“管理”下的“属性”,按如下方式更改并保存:</p><ul class=""><li id="2f0c" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">为登录为否的用户启用</li><li id="b42c" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">将其重命名为连接器应用程序的名称，以描述为连接和供应</li><li id="5a80" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">要求分配为否</li><li id="6269" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">对用户可见为否</li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kl"><img src="../Images/8f82446f6f19b4129caa0ccbb35eee4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/0*l22jaXYZ4afrOJRl"/></div></figure><p id="c685" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.在“管理和入门”下选择“资源调配”</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es km"><img src="../Images/51f09219d6d279431146a033064968f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*H9aaDqIqDPr8CNSE"/></div></div></figure><ul class=""><li id="9cd1" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">选择配置模式-&gt;自动，并在管理员凭据中提供具有所需管理员权限的用户。在我们的例子中，用户是azuread-provisioning</li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kn"><img src="../Images/0f5f62c93351c6a9fbc6f46731344dd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*V3Bp05KPKOAx7fcx"/></div></div></figure><ul class=""><li id="46b2" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">在“映射”部分，选择“设置Azure Active Directory用户”。在属性映射中，选择“姓氏”行来编辑属性。</li><li id="4865" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">在“编辑属性”部分，将null参数的默认值编辑为“_”，如下所示。选择确定。</li><li id="4390" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">为“givenName”属性报告相同的步骤。</li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ko"><img src="../Images/839157f8e839838bb31c62948b69a9b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eD0PhLhfffnty9Ia"/></div></div></figure><ul class=""><li id="1de3" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">由于我们仅调配用户，因此我们不会启用组调配。如果需要，它可以在同一个连接器中与用户配置一起完成。可以使用在<a class="ae jd" href="https://cloud.google.com/architecture/identity/federating-gcp-with-azure-ad-configuring-provisioning-and-single-sign-on#name" rel="noopener ugc nofollow" target="_blank">按名称或电子邮件地址配置组</a>中提到的步骤。</li><li id="121b" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">在设置部分的范围中，选择仅同步分配的用户和组。这将使用户和组的配置成为可能，从而提供更多的控制。另一个选项是同步所有用户和组，可以根据业务需求选择。</li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ki"><img src="../Images/cae98c6bd95e9f50220368039ed27082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MaE4zwgb19ur-cJj"/></div></div></figure><ul class=""><li id="0af7" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">保存更改并关闭设置窗口。</li><li id="fb25" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">在管理中选择用户和组，并添加用户/组。应提供在此选择和分配的用户和组。</li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ki"><img src="../Images/9313d821536ffee71bd02155b91dcdec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-c5yAEid_GwaeMWI"/></div></div></figure><ul class=""><li id="96ae" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">在“用户”部分中，选择“未选择”超链接，然后选择要设置的用户。对于我们的示例，我们选择两个用户Chris和John，而不选择Tom Doe，如下所示:</li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ki"><img src="../Images/13f2c7868fd5376de8bb3c93c57eaacb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MxagkScPa3SUfu4F"/></div></div></figure><ul class=""><li id="3473" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">选择并分配用户</li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ki"><img src="../Images/27e7661b70309997afe08bf272281baa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oSlBKYRlKTiCyvXm"/></div></div></figure><p id="ea35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.调配用户—在“管理”中选择“调配”，选择“编辑调配”，并按调配状态启用调配，然后保存更改。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ki"><img src="../Images/920432f7dd80efc45014c9bfa4020152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ewGs2vG1oJBrcb2x"/></div></div></figure><ul class=""><li id="13a8" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">关闭设置窗口</li><li id="1506" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">供应按如下方式开始</li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ki"><img src="../Images/aaa5e5a845db886130c336354234c533.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HfPdfDi8QhW2Ig8F"/></div></div></figure><ul class=""><li id="dbb9" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">置备时间基于所选用户的数量，周期状态在置备窗口中更新</li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ki"><img src="../Images/1d651b31a7dea772c1e20f140fd7b609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*woWtoyN_ElQ2_zsa"/></div></div></figure><p id="f0bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.在“活动”部分中选择“预配日志”以查看详细的日志</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ki"><img src="../Images/33874a18a4b854eaa241341b3bfaa8f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aaApLv6kobcIsB2V"/></div></div></figure><p id="05de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.在Google Cloud管理控制台中验证提供的用户。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ki"><img src="../Images/db56e8f3f2044767d46dd205bef50ce0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XkrbUOpdHbECVDlk"/></div></div></figure><ul class=""><li id="6553" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">在<a class="ae jd" href="https://admin.google.com/" rel="noopener ugc nofollow" target="_blank"> Google Cloud管理控制台</a>的目录中，转到Users并验证创建的用户。在我们的示例中，必须创建两个用户，Chris和John是在Azure AD中选择的用于供应的用户。</li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ki"><img src="../Images/2079be9c7b31343059b2a3d9816c0838.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KCDsq8An940PUwXE"/></div></div></figure><p id="36ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以从<a class="ae jd" href="https://admin.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云平台管理控制台</a>和<a class="ae jd" href="https://portal.azure.com/#home" rel="noopener ugc nofollow" target="_blank">微软Azure </a> AD开始设置云身份。</p><p id="53fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在就执行，现在为用户设置的单点登录将在文档的第2部分中执行。</p></div></div>    
</body>
</html>