<html>
<head>
<title>Building a Dashboard for a data processing pipeline with the Stackdriver Dashboard API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Stackdriver Dashboard API为数据处理管道构建仪表板</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/part-2-building-a-dashboard-for-a-data-processing-pipeline-with-the-stackdriver-dashboard-api-69e3260b5ec3?source=collection_archive---------1-----------------------#2019-12-26">https://medium.com/google-cloud/part-2-building-a-dashboard-for-a-data-processing-pipeline-with-the-stackdriver-dashboard-api-69e3260b5ec3?source=collection_archive---------1-----------------------#2019-12-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ecfa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是2部分系列的第2部分。</p><ul class=""><li id="89b5" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><a class="ae jm" rel="noopener" href="/@charles.baer/part-1-building-a-dashboard-for-a-data-processing-pipeline-with-the-stackdriver-dashboard-api-3cb14a27cd59">第1部分</a>:包括识别推荐的堆栈驱动程序监控指标，用于数据处理管道</li><li id="1fa5" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">第2部分:介绍如何使用Stackdriver Dashboards API 从JSON模板中实现第1部分中描述的图表和仪表板。</li></ul><h1 id="ec99" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">首先，为什么要自动化？</h1><p id="a37b" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">我从使用Stackdriver Monitoring的DevOps和SRE团队那里听到的一个常见请求是，他们希望像对大多数基础架构或环境设置那样自动部署仪表板。这是减少人类<a class="ae jm" href="https://landing.google.com/sre/sre-book/chapters/eliminating-toil/" rel="noopener ugc nofollow" target="_blank">辛劳</a>的流行配置代码方法！我听到的另一个常见请求(这次是来自仪表板用户)是，用户希望能够共享他们开发的仪表板的配置，以便同事可以将仪表板用作模板。最近发布的<a class="ae jm" href="https://cloud.google.com/monitoring/api/ref_v3/rest/v1/projects.dashboards" rel="noopener ugc nofollow" target="_blank"> Stackdriver Dashboards API </a>为这两种用例提供了解决方案。</p><h1 id="0fbe" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">堆栈驱动仪表板API</h1><p id="a3b4" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">Stackdriver监控API提供了一个名为<em class="kv"> projects.dashboards </em>的资源，它提供了一组熟悉的方法:<em class="kv">创建</em>、<em class="kv">删除</em>、<em class="kv">获取</em>、<em class="kv">列表</em>和<em class="kv">补丁</em>。这些方法遵循REST语义，接受JSON有效负载，并与其他基于Google Cloud REST的API保持一致。</p><p id="090c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章的其余部分要求理解如何在Stackdriver监控控制台中使用仪表板、图表和指标的细节。你可以阅读文档中的<a class="ae jm" href="https://cloud.google.com/monitoring/charts/" rel="noopener ugc nofollow" target="_blank">创建图表</a>部分来找到所有细节。</p><h1 id="6ff9" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">以最简单的方式构建dashboard JSON有效负载</h1><p id="14dc" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">我提到仪表板API提供了一个<em class="kv">创建</em>和一个<em class="kv">获取</em>方法。因为从头开始在JSON中构建仪表板需要详细了解API数据模型和相应的JSON语法，所以更简单的方法是在Stackdriver Monitoring的仪表板部分构建仪表板，然后使用API来展示仪表板的JSON表示。一旦有了JSON，就可以使用<em class="kv"> create </em>方法创建另一个基于JSON的仪表板。我强烈推荐这种方法，作为一种简单的开始方式。</p><h1 id="dd62" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">仪表板JSON有效负载</h1><p id="ea61" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">为了让您通过Dashboards API创建仪表板，您需要定义几个JSON有效负载数据，您可以使用这些数据来调用<a class="ae jm" href="https://cloud.google.com/monitoring/api/ref_v3/rest/v1/projects.dashboards/create" rel="noopener ugc nofollow" target="_blank">projects . Dashboards . create</a>方法。下面是一个JSON有效负载的例子:</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="lb lc l"/></div></figure><ul class=""><li id="3af7" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">显示名称—仪表板的可读名称</li><li id="d265" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">gridLayout —小部件的容器</li><li id="1566" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">小部件—图表项目的容器</li><li id="e14f" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">数据集—这包括用于在timeSeriesFilter对象中收集特定数据的详细信息，包括指标名称、指标过滤器以及指标的聚合方式。</li><li id="13bc" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">xAxis，yAxis影响轴表示的定义</li><li id="e5e1" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">图表选项—影响图表模式的定义</li></ul><h1 id="24ad" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">使用项目.仪表板.创建</h1><p id="b4bd" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">有许多方法可以调用projects.dashboards.create方法。在本例中，您可以直接在API文档中轻松使用“尝试此API”功能来测试API调用*。</p><p id="05de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">*请注意，您应该已经定义了一个Stackdriver监控工作区，并且已经为包含该工作区的项目定义了GCP项目id。</p><p id="4d4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经创建了一个<a class="ae jm" href="https://gist.github.com/charlesbaer/d4f29e73684facc6c53d90ae9ba7f55f" rel="noopener ugc nofollow" target="_blank"> JSON dashboard模板</a>，其中包含了本系列第1部分中描述的所有6个图表。您可以将这个JSON有效负载用作您自己的仪表板的模板。</p><ol class=""><li id="61f1" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ld jj jk jl bi translated">要创建仪表板，请单击蓝色的“试试看！”按钮打开<a class="ae jm" href="https://cloud.google.com/monitoring/api/ref_v3/rest/v1/projects.dashboards/create" rel="noopener ugc nofollow" target="_blank">projects . dashboards . create</a>方法右侧的“尝试这个API”特性。</li><li id="f97e" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ld jj jk jl bi translated">以“projects/<em class="kv">YOUR _ PROJECT _ id</em>”模式为父输入表单输入一个值，替换您自己的GCP项目ID，该项目ID包含您要为“<em class="kv"> YOUR_PROJECT_ID </em>”字符串值创建仪表板的Stackdriver工作区。</li><li id="ff18" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ld jj jk jl bi translated">突出显示请求正文输入表单中的默认值，然后复制/粘贴JSON仪表板模板</li></ol><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es le"><img src="../Images/ef0e6d7991bfe64fe4277ff8cbc66c3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*du5caoQXcn6RMsIIPYHFKQ.png"/></div></div></figure><p id="8526" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.点击页面底部的“执行”按钮。如果一切顺利，您应该会看到一个绿色的HTTP“200”响应代码，以及您刚刚创建的仪表板的JSON描述。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es ll"><img src="../Images/3fb0ec5b606b5552a33792688e74a1d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*m033x-2ntRhss1eCaxh2qw.png"/></div></figure><p id="60b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.在Stackdriver监控控制台中打开<a class="ae jm" href="https://console.cloud.google.com/monitoring/dashboards" rel="noopener ugc nofollow" target="_blank">仪表板部分</a>以查看您新创建的仪表板。找到“数据处理仪表板模板”,单击名称打开仪表板。</p><p id="3b79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您已经部署了Pub/Sub、Dataflow和BigQuery资源，您应该已经在仪表板中看到了值。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es lm"><img src="../Images/86b9fd49b6daab252f85ca5d17b73dfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AHnZpALu8YpPUDct7JcHmw.png"/></div></div></figure><h1 id="cfb0" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">仪表板模板的实际使用案例</h1><p id="f748" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">我从两个常见的用例开始了这个系列:</p><ol class=""><li id="cc92" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ld jj jk jl bi translated">开发运维团队/SRE团队成员创建或更新仪表板</li><li id="ed43" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ld jj jk jl bi translated">用户共享仪表板模板</li></ol><p id="1077" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，如何将仪表板API用于用例呢？</p><p id="520c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在第一种情况下，可以通过从Stackdriver监控控制台导出现有仪表板来构建仪表板JSON模板，然后可以将JSON签入github或Cloud Source Repos之类的源存储库。从那里，您可以通过调用Dashboards API来部署dashboard，这是您的标准部署过程的一部分，从repo中提取JSON模板文件。</p><p id="d047" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在第二种情况下，您可以从Stackdriver监控控制台的现有仪表板创建一个仪表板，然后使用Dashoards API导出JSON模板。然后，您可以通过repo或通常与同事共享文件的方式共享该模板。</p><p id="8806" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这两种情况下，有一个预构建的模板仪表板开始应该更容易构建和共享Stackdriver监控仪表板。</p><h1 id="0169" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">结论</h1><p id="cef9" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">在本系列中，我详细介绍了数据处理管道的一组合理的指标和图表，然后描述了使用Dashboards API部署dashboard模板的详细方法。</p><h1 id="1e43" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">有用的资源</h1><ul class=""><li id="7c90" class="jd je hi ih b ii kq im kr iq ln iu lo iy lp jc ji jj jk jl bi translated"><a class="ae jm" href="https://cloud.google.com/monitoring/docs/" rel="noopener ugc nofollow" target="_blank">堆栈驱动监控文件</a></li><li id="2a02" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated"><a class="ae jm" href="https://cloud.google.com/monitoring/docs/apis" rel="noopener ugc nofollow" target="_blank">堆栈驱动监控API </a></li><li id="b33b" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated"><a class="ae jm" href="https://landing.google.com/sre/books/" rel="noopener ugc nofollow" target="_blank">网站可靠性工程书籍</a></li></ul></div></div>    
</body>
</html>