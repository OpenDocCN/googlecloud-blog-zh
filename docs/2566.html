<html>
<head>
<title>Google Cloud Storage — Object Life Cycle Management — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google云存储—对象生命周期管理—第1部分</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-cloud-storage-object-life-cycle-management-part-1-5da48da8854a?source=collection_archive---------2-----------------------#2022-11-28">https://medium.com/google-cloud/google-cloud-storage-object-life-cycle-management-part-1-5da48da8854a?source=collection_archive---------2-----------------------#2022-11-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="91ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随着组织将数据转移到云中，制定一个管理数据生命周期的策略是非常必要的。与不需要额外成本来保存数据的内部环境相比，云环境对存储在存储环境中的任何数据收费。</p><p id="bd85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于使用内部资源的组织，管理生命周期甚至可能不是他们战略的一部分，因为一般没有直接的成本影响。但是，随着他们向云的迁移，如果他们没有达成数据生命周期战略并实施它，这可能会变成巨大的成本影响。</p><p id="a9de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，在这两部分系列中，我们将探讨如何</p><ul class=""><li id="4f8a" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">对象生命周期管理简介(第1部分)</li><li id="cf3c" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">通过控制台设置OLM策略(第1部分)</li><li id="647c" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">了解何时执行OLM策略(第1部分)</li><li id="a9f6" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">可以应用的各种生命周期规则是什么(第1部分)</li><li id="3bc7" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">如何以编程方式设置OLM策略(第2部分)</li><li id="46eb" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">OLM行动监控-方法。(第二部分)</li></ul><h1 id="a1d6" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">对象生命周期管理策略简介:</h1><p id="790a" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">Google云存储提供了为存储桶定义对象生命周期规则的功能，通过它我们可以控制如何以最具成本效益的方式存储或删除对象。</p><h1 id="35f8" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">通过控制台设置OLM策略:</h1><p id="9577" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">为了举例说明，我们假设有一家音乐公司“MyMusic”使用谷歌云平台来管理他们所有的音乐文件。MyMusic公司根据音乐文件的来源定义了单独的存储桶。他们从特定的乐队获得音乐文件。他们为每一个他们来源的乐队创造桶。当他们从乐队接收歌曲时，他们将文件存储到各自的桶中。一旦接收到文件，他们就对这些文件进行编辑，以准备发布给最终用户。在这个过程中，他们在桶中创建临时文件。</p><p id="b34e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最初，他们是一家小公司，从他们采购的地方有最少的乐队。他们没有对此存储桶应用任何生命周期策略。开始时，他们没有为这些文件设置任何生命周期规则。他们把所有的数据都保存在标准存储器里。他们没有意识到临时文件的成本，因为文件很小，数据量也很少。</p><p id="8d82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">后来，随着我的音乐出名，他们开始从多个乐队采购，他们开始看到成本急剧增加。他们发现他们没有对存储桶中的音乐文件应用生命周期策略，所有文件都保存在标准存储中。</p><p id="36dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在分析过程中，他们发现每个存储桶都有不同类型的文件:</p><ol class=""><li id="7d44" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ku jj jk jl bi translated">每天都会被访问的音乐文件</li><li id="76b4" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ku jj jk jl bi translated">从乐队接收的音乐文件</li><li id="c0ba" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ku jj jk jl bi translated">为编辑而临时创建的音乐文件。</li></ol><p id="f3df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于这些类型或场景，他们提出了以下生命周期行动。</p><p id="fa6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">场景—标准:</strong></p><blockquote class="kv kw kx"><p id="aff2" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><strong class="ih hj">文件/对象类型:</strong>每天都会被访问的音乐文件</p><p id="95fc" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><strong class="ih hj">要采取的生命周期措施:</strong>将文件保存在标准存储中</p></blockquote><p id="a736" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">场景——cold line:</strong></p><blockquote class="kv kw kx"><p id="37f0" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><strong class="ih hj">文件/对象类型:</strong>从乐队接收的音乐文件</p><p id="04c6" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><strong class="ih hj">要采取的生命周期措施:</strong>在收到文件1个月后，将该文件移至存档</p></blockquote><p id="4673" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">场景—删除:</strong></p><blockquote class="kv kw kx"><p id="06f9" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><strong class="ih hj">文件/对象类型:</strong>为编辑而临时创建的音乐文件。</p><p id="e90e" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><strong class="ih hj">要采取的生命周期操作:</strong>创建5天后删除这些文件</p></blockquote><h1 id="6c13" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">应用生命周期策略:</h1><p id="75a0" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">我们现在来看看每一种情况，以及如何设置生命周期操作:</p><h2 id="8366" class="lc js hi bd jt ld le lf jx lg lh li kb iq lj lk kf iu ll lm kj iy ln lo kn lp bi translated">场景—标准:</h2><p id="0479" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">在这种情况下，发布的文件需要永远作为标准存储。MyMusic公司的客户随时都想收听这些文件。因此，我的音乐应该总是让这些文件为客户所用。因此，从生命周期策略来看，这种情况下不需要采取任何措施。</p><h2 id="a30f" class="lc js hi bd jt ld le lf jx lg lh li kb iq lj lk kf iu ll lm kj iy ln lo kn lp bi translated">场景—存档:</h2><p id="41c6" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">在这种情况下，虽然原件以后不会被引用，但MyMusic作为一家负责任的公司需要保留原件以供将来参考。但是在歌曲出版之前，他们会引用这个文件进行编辑。一旦歌曲发布，他们将不会引用该文件。另外，估计出版一首歌最多需要20天的时间。一旦一首歌曲被发布，原始文件将至少每个季度被访问一次。对于这种情况，成本最低的最佳存储是冷线存储。因此，使用下面设置的OLM策略，他们在收到文件一个月后完成了将原始文件移动到冷线存储的任务。</p><p id="d8c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">他们如何组织铲斗的示例结构:</p><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es lq"><img src="../Images/10dca5f92249474bedea3c5a6cfa4a75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*n46bXArdTQ5_vUZ4"/></div></div></figure><p id="88e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为方案应用生命周期规则—归档</p><p id="8080" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导航到“生命周期”选项卡，并选择“添加规则”。</p><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mc"><img src="../Images/785c7960f09e1ee83ff0c81a79f15e1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sSLW3RiSz69anBmj"/></div></div></figure><p id="bbc7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于此场景，将存储类别设置为Cold Line。</p><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es md"><img src="../Images/6d75c36a3ca4ea966705be364548706d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cJhmRPqyn7RPp21z"/></div></div></figure><p id="f9ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击选择对象条件，您将看到以下页面:</p><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es me"><img src="../Images/50331a9288517020d9ae323e6af339fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*t4_vkVoa3Ja5plNT"/></div></div></figure><p id="7400" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们正在尝试创建以下规则:</p><p id="5a69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">规则:</p><ol class=""><li id="771e" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ku jj jk jl bi translated">年龄:30天</li><li id="e196" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ku jj jk jl bi translated">前缀:原始</li></ol><p id="af63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">行动:移至冷线</p><p id="e5ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过配置上述条件，所有前缀为“原始”的对象将在创建30天后被移动到冷线存储。让我们继续设置OLM策略。</p><figure class="lr ls lt lu fd lv er es paragraph-image"><div class="er es mf"><img src="../Images/90c9d0f8bf95381e564337557e6eec63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/0*EpZrBkHXCROC47Um"/></div></figure><p id="ce3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置完成后，单击“create ”,您会看到它已被添加。</p><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mg"><img src="../Images/3ae94fbc1ed93dc0c95b21deb6debb5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1LsGEq4G4vNRDBr5"/></div></div></figure><p id="0019" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们已经成功地设置了OLM策略，用于在创建30天后将原始音乐文件移动到冷线存储。</p><h2 id="c2c0" class="lc js hi bd jt ld le lf jx lg lh li kb iq lj lk kf iu ll lm kj iy ln lo kn lp bi translated">场景—删除:</h2><p id="c420" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">接下来，我们将添加一个规则来删除超过5天的临时对象。与前面创建OLM策略的方式类似，让我们在下面的同一个桶中创建另一个规则。</p><p id="27be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">规则:</p><p id="d331" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">年龄:5天</p><p id="38bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前缀:临时编辑</p><p id="736f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">操作:删除</p><p id="77de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该规则已创建如下:</p><figure class="lr ls lt lu fd lv er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es mh"><img src="../Images/9fc39c68ac220fcbd55649c739da5d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tKoJ8OAG8_ZllafF"/></div></div></figure><p id="1cda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，MyMusic实现了生命周期策略，通过这些策略，他们可以根据使用情况高效地存储数据。</p><h1 id="cdc9" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">了解何时执行OLM策略:</h1><p id="9fd4" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">现在，他们已经设置了OLM生命周期策略，让我们来了解一下在条件满足后，这些策略将在何时生效。</p><p id="04f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Google云存储在后台管理所有这些，用户不知道这些操作。GCS对为其配置了生命周期规则的存储桶中的所有对象进行定期检查。当它确定特定对象满足生命周期规则的条件时，它会将该对象标记为有资格执行规则中指定的操作。操作可以是将对象移动到冷线或删除。</p><p id="116e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦对象被标记为执行某个动作，GCS就会异步执行该动作。虽然可能已经满足了条件，但是动作可能没有以正确的方式执行。在满足条件的时间和执行动作的时间之间可能存在延迟。您的应用程序不应该依赖于在满足生命周期条件后的一定时间内发生的生命周期操作。</p><h1 id="7a8e" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">可以应用的各种生命周期条件是什么:</h1><p id="1b8a" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">虽然在示例场景中我们使用了2个规则，但是可以使用多个其他规则来配置生命周期规则。请参考此链接，了解可应用的所有生命周期管理条件:</p><p id="61c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae mi" href="https://cloud.google.com/storage/docs/lifecycle#conditions" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/storage/docs/lifecycle#conditions</a></p><p id="9713" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些条件的组合使用户能够创建强大而灵活的选项，从而根据使用情况创建对象生命周期策略。</p><p id="115b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好的云存储现在还提供了一个自动分类功能，可以根据每个对象的访问模式，自动将您的存储桶中的对象转移到适当的<a class="ae mi" href="https://cloud.google.com/storage/docs/storage-classes" rel="noopener ugc nofollow" target="_blank">存储类别</a>。Autoclass类可以从此链接引用:【https://cloud.google.com/storage/docs/autoclass<a class="ae mi" href="https://cloud.google.com/storage/docs/autoclass" rel="noopener ugc nofollow" target="_blank"/></p><p id="58a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总结:</p><p id="4046" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，MyMusic能够为他们的数据建立数据生命周期，从而节省大量成本。但是随着公司的发展，他们面临着为大量存储桶手动设置OLM策略的进一步挑战。他们还需要监控OLM行动的能力。我们将在本博客的第二部分讨论他们是如何解决这些挑战的。</p></div></div>    
</body>
</html>