<html>
<head>
<title>Google Kubernetes Engine (GKE) Security Best Practices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google Kubernetes引擎(GKE)安全最佳实践</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-kubernetes-engine-gke-security-best-practices-d11a230f8e49?source=collection_archive---------0-----------------------#2021-08-16">https://medium.com/google-cloud/google-kubernetes-engine-gke-security-best-practices-d11a230f8e49?source=collection_archive---------0-----------------------#2021-08-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/01e814fd53d9e1494f8b74da00005aa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:456/format:webp/1*uwQ90gPwX1ifWOUDayTMuw.png"/></div></figure><p id="13ac" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在云提供商争夺最佳管理的Kubernetes服务的战斗中，谷歌Kubernetes引擎(GKE)作为他们最喜欢的选择领先于许多人。Kubernetes在不断发展，GKE也在快速创新。毕竟，Kubernetes在被云计算原生计算基金会(CNCF)采用之前就诞生于谷歌。</p><p id="7034" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">随着Kubernetes的发展，它的安全环境也在变化。例如，最近发布的Kubernetes 1.21带来了对PodSecurityPolicies  (PSP)的<a class="ae jk" href="https://kubernetes.io/blog/2021/04/06/podsecuritypolicy-deprecation-past-present-and-future/" rel="noopener ugc nofollow" target="_blank">反对。鉴于这种不断变化的性质，这篇博文旨在回答<strong class="io hj">当今GKE的最佳安全实践是什么？</strong></a></p><h1 id="5269" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">GKE安全概述</h1><p id="77bf" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">安全是个复杂的问题，没有十全十美的东西，也没有放之四海而皆准的办法。GKE和谷歌云平台提供了许多功能和服务来增强堆栈每一层的安全性。您应该始终应用最小特权原则，并在与应用程序功能共存的地方应用安全性最佳实践。</p><p id="49c8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">默认情况下，GKE上的许多配置是安全的，但重要的是要知道什么是不安全的，以及在配置GKE时有哪些选项。Kubernetes安全注意事项的完整列表超出了这篇博客的范围，但是将讨论一些GKE安全注意事项的高级概述。</p><h1 id="40e3" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">自动化CIS基准测试</h1><p id="ef34" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">互联网安全中心(CIS)为Kubernetes提供安全配置基准。理解GKE的共享安全模型很重要，因为一些kubernetes配置，例如控制平面的大部分配置，是由GKE管理的。因此，最好使用特定的CIS GKE基准。</p><p id="67fa" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">有许多工具可以自动执行Kubernetes CIS基准审计。GKE文档引用了使用开源<code class="du ko kp kq kr b">kube-bench</code>工具。Kube-bench扫描可以构建到您的基础设施即代码管道中。</p><p id="f7fb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在Google云平台上，可以启用安全健康分析来监控GKE CIS的一些基准并发出警报。失败的检查将通过云安全指挥中心通知。</p><div class="ks kt ez fb ku kv"><a href="https://cloud.google.com/kubernetes-engine/docs/concepts/cis-benchmarks" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab dw"><div class="kx ab ky cl cj kz"><h2 class="bd hj fi z dy la ea eb lb ed ef hh bi translated">CIS基准测试| Kubernetes引擎文档|谷歌云</h2><div class="lc l"><h3 class="bd b fi z dy la ea eb lb ed ef dx translated">本文档解释了什么是CIS Kubernetes和Google Kubernetes引擎(GKE)基准，如何审计您的…</h3></div><div class="ld l"><p class="bd b fp z dy la ea eb lb ed ef dx translated">cloud.google.com</p></div></div><div class="le l"><div class="lf l lg lh li le lj ik kv"/></div></div></a></div><h1 id="902f" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">认证和授权</h1><p id="d907" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">使用<a class="ae jk" href="https://cloud.google.com/kubernetes-engine/docs/how-to/role-based-access-control#google-groups-for-gke" rel="noopener ugc nofollow" target="_blank"> <strong class="io hj">谷歌群搜索</strong> </a>。这个相对较新的特性允许在google workspace级别进行细粒度的许可。</p><p id="6c13" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用<strong class="io hj">最低权限</strong>服务账户。默认情况下，GKE工作节点将使用默认的计算引擎服务帐户。默认情况下，默认计算引擎服务帐户拥有编辑者级别的权限。应配置对必要的日志记录角色(monitoring.viewer、monitoring.metricWriter、logging.logWriter和stack driver . resource metadata . write)具有受限访问权限的自定义服务帐户。此外，工作负载应该配置为使用<strong class="io hj">工作负载标识</strong>，而不是直接使用工作节点的服务帐户。</p><div class="ks kt ez fb ku kv"><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab dw"><div class="kx ab ky cl cj kz"><h2 class="bd hj fi z dy la ea eb lb ed ef hh bi translated">使用工作负载标识| Kubernetes引擎文档</h2><div class="lc l"><h3 class="bd b fi z dy la ea eb lb ed ef dx translated">本页解释了推荐您的Google Kubernetes引擎(GKE)应用程序使用服务的方式…</h3></div><div class="ld l"><p class="bd b fp z dy la ea eb lb ed ef dx translated">cloud.google.com</p></div></div><div class="le l"><div class="lk l lg lh li le lj ik kv"/></div></div></a></div><h1 id="ee2e" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">控制平面安全</h1><p id="9a72" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">虽然GKE控制平面由Google管理，但有一些配置设置需要由客户决定。kubernetes API服务器应该配置为只允许<a class="ae jk" href="https://cloud.google.com/kubernetes-engine/docs/concepts/private-cluster-concept" rel="noopener ugc nofollow" target="_blank"> <strong class="io hj">私人访问</strong> </a>。对kubernetes api的认证应该通过<strong class="io hj"> Google Cloud IAM </strong>，同时确保禁用基本认证和客户端证书认证。</p><h1 id="9fdd" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">节点安全性</h1><p id="5b2b" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">确保GKE工作节点使用谷歌的<a class="ae jk" href="https://cloud.google.com/container-optimized-os/docs/concepts/features-and-benefits" rel="noopener ugc nofollow" target="_blank"> <strong class="io hj">容器优化操作系统</strong> </a>。Google专门为运行容器开发和维护这个操作系统，并将安全性放在设计的最前面。它拥有:最小的操作系统占用空间、不可变的根文件系统和经验证的引导、无状态配置、安全加固的内核、自动更新等等。安全特性的完整列表可以在<a class="ae jk" href="https://cloud.google.com/container-optimized-os/docs/concepts/security" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="47f0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">启用<a class="ae jk" href="https://cloud.google.com/kubernetes-engine/docs/how-to/shielded-gke-nodes" rel="noopener ugc nofollow" target="_blank"> <strong class="io hj">屏蔽GKE节点</strong> </a>。这可以防止攻击者试图模拟您的GKE工作节点之一。它通过加密验证几种配置来实现这一点。</p><h1 id="ced4" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">网络安全性</h1><p id="c1fb" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">重申一下控制平面安全部分提到的一点，对您的kubernetes资源的访问应该仅限于<strong class="io hj">私有网络访问</strong>。专用GKE集群将只有内部IP地址，这意味着默认情况下它们与互联网隔离。</p><div class="ks kt ez fb ku kv"><a href="https://cloud.google.com/kubernetes-engine/docs/concepts/private-cluster-concept" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab dw"><div class="kx ab ky cl cj kz"><h2 class="bd hj fi z dy la ea eb lb ed ef hh bi translated">私有集群| Kubernetes引擎文档|谷歌云</h2><div class="lc l"><h3 class="bd b fi z dy la ea eb lb ed ef dx translated">本页解释了私有集群如何在Google Kubernetes引擎(GKE)中工作。你还可以学习如何创造和…</h3></div><div class="ld l"><p class="bd b fp z dy la ea eb lb ed ef dx translated">cloud.google.com</p></div></div><div class="le l"><div class="ll l lg lh li le lj ik kv"/></div></div></a></div><p id="e56f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了访问您的私有GKE集群，您应该有一个<strong class="io hj">堡垒主机</strong>。关于如何配置现代云堡垒主机的信息，请查看我在<a class="ae jk" href="https://eng.sigmacomputing.com/modern-bastion-hosts-abed8c7c7c63" rel="noopener ugc nofollow" target="_blank">之前的博文</a>。</p><p id="0b73" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用<a class="ae jk" href="https://cloud.google.com/kubernetes-engine/docs/how-to/network-policy" rel="noopener ugc nofollow" target="_blank"> <strong class="io hj">网络策略执行</strong> </a>。Kubernetes网络策略支持控制集群中的pod和实体的流量。您的生产服务pod后端应该能够与一个刚刚意外启动的hello-world pod通信吗？大概不会。用网络策略锁定它。</p><h1 id="aa8c" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">保护您的工作负载</h1><p id="9a54" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">用<a class="ae jk" href="https://cloud.google.com/kubernetes-engine/docs/concepts/sandbox-pods" rel="noopener ugc nofollow" target="_blank"> <strong class="io hj"> GKE沙盒</strong> </a>强化工作负载隔离。GKE沙盒防止不受信任的代码恶意影响主机内核。此外，沙盒豆荚被禁止访问其他谷歌云服务或集群元数据。</p><p id="3a5f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><a class="ae jk" href="https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity" rel="noopener ugc nofollow" target="_blank"> <strong class="io hj">工作负载标识</strong> </a>应用于容器工作负载认证。这使得Kubernetes服务帐户能够作为Google服务帐户进行身份验证。这允许您为各个工作负载创建细粒度的身份和授权，同时消除对静态服务帐户凭证的需求。</p><h1 id="b2c8" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">审核日志记录</h1><p id="2c32" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">默认情况下，<strong class="io hj">云日志</strong>和<strong class="io hj">云监控</strong>处于启用状态。这包括写入STDOUT/STDERR的群集审核日志、工作节点日志和应用程序日志。这些日志默认存储30天。我建议将这些日志发送到云数据仓库，比如Snowflake，以便经济高效地长期存储和高效查询。<br/>最近的一篇<a class="ae jk" href="https://www.lacework.com/blog/hiding-in-plaintext-sight-abusing-the-lack-of-kubernetes-auditing-policies/" rel="noopener ugc nofollow" target="_blank"> Lacework博客文章</a>强调了不启用Kubernetes审计日志记录的一些有趣的危险。</p><div class="ks kt ez fb ku kv"><a href="https://cloud.google.com/blog/products/management-tools/finding-your-gke-logs" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab dw"><div class="kx ab ky cl cj kz"><h2 class="bd hj fi z dy la ea eb lb ed ef hh bi translated">寻找你的GKE日志|谷歌云博客</h2><div class="lc l"><h3 class="bd b fi z dy la ea eb lb ed ef dx translated">如果未启用GKE集成，您可以通过在…中编辑集群来启用集群的日志收集</h3></div><div class="ld l"><p class="bd b fp z dy la ea eb lb ed ef dx translated">cloud.google.com</p></div></div><div class="le l"><div class="lm l lg lh li le lj ik kv"/></div></div></a></div><h1 id="af47" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">供应链安全</h1><p id="accf" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">启用并执行<a class="ae jk" href="https://cloud.google.com/binary-authorization" rel="noopener ugc nofollow" target="_blank"> <strong class="io hj">二进制授权</strong> </a>。这可以确保只能够部署受信任的容器映像。考虑到运行受损的容器映像是最常见的攻击媒介，签名和验证您的映像是确保安全性的重要步骤。</p><div class="ks kt ez fb ku kv"><a href="https://cloud.google.com/binary-authorization" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab dw"><div class="kx ab ky cl cj kz"><h2 class="bd hj fi z dy la ea eb lb ed ef hh bi translated">二进制授权|谷歌云</h2><div class="lc l"><h3 class="bd b fi z dy la ea eb lb ed ef dx translated">只为容器和无服务器部署可信工作负载。查看该产品的文档。二进制授权…</h3></div><div class="ld l"><p class="bd b fp z dy la ea eb lb ed ef dx translated">cloud.google.com</p></div></div><div class="le l"><div class="ln l lg lh li le lj ik kv"/></div></div></a></div><p id="316f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">扫描容器图像中的已知漏洞和恶意软件。如果你正在使用谷歌的容器注册表，你可以启用<strong class="io hj">漏洞扫描</strong>。这不仅会在上传期间扫描图像，还会持续监控图像的元数据以发现新的漏洞。</p><div class="ks kt ez fb ku kv"><a href="https://cloud.google.com/container-analysis/docs/container-scanning-overview" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab dw"><div class="kx ab ky cl cj kz"><h2 class="bd hj fi z dy la ea eb lb ed ef hh bi translated">容器扫描|容器分析文档|谷歌云</h2><div class="lc l"><h3 class="bd b fi z dy la ea eb lb ed ef dx translated">软件漏洞是一种弱点，可能会导致意外的系统故障，也可能是故意的…</h3></div><div class="ld l"><p class="bd b fp z dy la ea eb lb ed ef dx translated">cloud.google.com</p></div></div><div class="le l"><div class="lo l lg lh li le lj ik kv"/></div></div></a></div><h1 id="7682" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">GKE自动驾驶仪</h1><p id="ec74" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">如果上述所有内容开始听起来像是一项艰巨的任务，不要担心，GKE自动驾驶仪可以扭转局面。这个新的Google托管服务负责Kubernetes工作节点的管理。当然，默认情况下，它是以安全的方式做到这一点的。</p><blockquote class="lp lq lr"><p id="d033" class="im in ls io b ip iq ir is it iu iv iw lt iy iz ja lu jc jd je lv jg jh ji jj hb bi translated">在自动驾驶模式下创建的集群已经处于强化配置中。</p></blockquote><p id="57d4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">自动驾驶实现了<a class="ae jk" href="https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster" rel="noopener ugc nofollow" target="_blank"> GKE强化准则</a>和如上所述的安全最佳实践。</p><div class="ks kt ez fb ku kv"><a href="https://cloud.google.com/kubernetes-engine/docs/concepts/autopilot-overview" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab dw"><div class="kx ab ky cl cj kz"><h2 class="bd hj fi z dy la ea eb lb ed ef hh bi translated">自动驾驶概述| Kubernetes引擎文档|谷歌云</h2><div class="lc l"><h3 class="bd b fi z dy la ea eb lb ed ef dx translated">自动驾驶是谷歌Kubernetes引擎(GKE)的一种新的操作模式，旨在降低运营成本…</h3></div><div class="ld l"><p class="bd b fp z dy la ea eb lb ed ef dx translated">cloud.google.com</p></div></div><div class="le l"><div class="lw l lg lh li le lj ik kv"/></div></div></a></div><h1 id="9a21" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">结论</h1><p id="c966" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">希望现在已经很清楚Google Kubernetes引擎是安全领域的行业领导者。由于默认情况下内置了许多安全特性，以及大量额外的可配置选项，确保您的Kubernetes集群的安全在GKE上变得更加容易。</p></div></div>    
</body>
</html>