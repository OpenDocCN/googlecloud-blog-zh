<html>
<head>
<title>Running a MEAN stack on Google Cloud Platform with App Engine and MongoLab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用App Engine和MongoLab在Google云平台上运行平均堆栈</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/running-a-mean-stack-on-google-cloud-platform-with-app-engine-and-mongolab-4bbd2040ea75?source=collection_archive---------0-----------------------#2015-11-12">https://medium.com/google-cloud/running-a-mean-stack-on-google-cloud-platform-with-app-engine-and-mongolab-4bbd2040ea75?source=collection_archive---------0-----------------------#2015-11-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/faabcc5c68792c65d9b787e431ff727f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3C094z8oNueryXPdWrGXSA.png"/></div></div></figure><p id="96d9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我之前的两篇文章中，我谈到了用Docker 运行一个<a class="ae jo" href="http://blog.sandeepdinesh.com/2015/07/running-mean-web-application-in-docker.html" rel="noopener ugc nofollow" target="_blank"> MEAN stack，然后通过使用Kubernetes </a>的<a class="ae jo" rel="noopener" href="/google-cloud/running-a-mean-stack-on-google-cloud-platform-with-kubernetes-149ca81c2b5d">使它更加健壮。</a></p><p id="7c89" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我将偏离主题，采取不同的方法。假设您不关心所有这些复杂的东西，您只想让您的应用程序运行和扩展，而不用担心虚拟机、pod、Docker等等…</p><p id="365b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要做到这一点，使用平台即服务(PaaS)是有意义的，这是一种有趣的说法，即您编写代码，我们运行代码。不需要服务器或数据库管理，这让您可以专注于构建一个伟大的产品！</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h2 id="5fad" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jb kh ki kj jf kk kl km jj kn ko kp kq bi translated">工具</h2><p id="4ed6" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">谷歌的PaaS被称为<a class="ae jo" href="https://cloud.google.com/appengine/" rel="noopener ugc nofollow" target="_blank">应用引擎</a>。App Engine可以<a class="ae jo" href="https://cloud.google.com/nodejs/getting-started/hello-world" rel="noopener ugc nofollow" target="_blank">运行Node.js </a>并处理所有的扩展和维护，所以你不必这么做。</p><p id="13f3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于数据库，我将使用<a class="ae jo" href="https://mongolab.com/google/" rel="noopener ugc nofollow" target="_blank"> MongoLab </a>。它是你所知道和喜爱的MongoDB，但你不需要担心托管它。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="3a30" class="kw jx hi bd jy kx ky kz kc la lb lc kg ld le lf kj lg lh li km lj lk ll kp lm bi translated">步骤1:创建数据库</h1><p id="5661" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated"><a class="ae jo" href="https://mlab.com/google/" rel="noopener ugc nofollow" target="_blank">报名MongoLab </a>。</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/9fa05e47e5340a71ed1b3c3f398e5b4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0_S-rVwNjBOwK9m6pedG9A.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx translated">点击橙色按钮！</figcaption></figure><p id="d4e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建帐户后，您应该会看到一个控制面板。</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/0e6922b1d2f1ae10f963b183016a6710.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qe8n2vkGliBkAxLHmxRfqg.png"/></div></div></figure><p id="c8ac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击“新建”。</p><p id="a276" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我在使用谷歌云平台的免费计划。</p><p id="6d67" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，确保<strong class="is hj">数据库名称为<em class="lx">mean-demo</em>T15】，因为这是我们的示例应用程序所期望的。</strong></p><p id="5d92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您的配置应该如下所示:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/9179be447020bf4776ee9971291b01ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ETwFK8sp07WZMXDnaRFQbg.png"/></div></div></figure><p id="8930" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">单击“创建新的MongoDB部署”后，您应该会看到新的数据库启动并运行:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/74ef1a0f27b83b27d12e4f47aa160805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J2NckLDV5w1FQUPtkI8Aiw.png"/></div></div></figure><p id="b173" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">单击数据库，并注意连接URI。</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ma"><img src="../Images/d8f6330d759c7a17fd9e0c910e040e19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hEdTp10RAlEkngxuv95rLQ.png"/></div></div></figure><p id="0114" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，创建一个用户，以便应用程序可以连接到数据库:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/d8f76ed1e4db321d909fef4e3aa64dae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oJgFdsdF91PfiDb40lt0JQ.png"/></div></div></figure><figure class="lo lp lq lr fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/d33da05dbb17f045a798b26f280c64e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*NhQX-DoiK_UtOLnttk6THw.png"/></div></figure><p id="1f8c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完成了。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="952a" class="kw jx hi bd jy kx ky kz kc la lb lc kg ld le lf kj lg lh li km lj lk ll kp lm bi translated">第二步:获取代码</h1><p id="4e2d" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">前往<a class="ae jo" href="http://console.developers.google.com" rel="noopener ugc nofollow" target="_blank">console.developers.google.com</a>并选择(或创建)您的项目。对于本教程的其余部分，我将使用<a class="ae jo" href="https://www.youtube.com/watch?v=hBMcAKzGt3w" rel="noopener ugc nofollow" target="_blank">云外壳</a>，它基本上是浏览器中的命令行，已经安装了您需要的所有工具。真的很酷！</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/8b7239e46b636fb730ec64fdfb8809de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DYuFkvm8TyZX85gmGVLZow.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx translated">激活你的云壳</figcaption></figure><p id="79f4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，引入示例代码:</p><pre class="lo lp lq lr fd me mf mg mh aw mi bi"><span id="8016" class="jw jx hi mf b fi mj mk l ml mm">$ git clone <a class="ae jo" href="https://github.com/thesandlord/mean-demo" rel="noopener ugc nofollow" target="_blank">https://github.com/thesandlord/mean-demo.git</a> app<br/>$ cd app</span></pre><p id="cd29" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并修复配置，以便可以连接到MongoLab实例:</p><pre class="lo lp lq lr fd me mf mg mh aw mi bi"><span id="2553" class="jw jx hi mf b fi mj mk l ml mm">$ URI=&lt;dbuser&gt;:&lt;dbpassword&gt;@XXXXX.mongolab.com<br/>$ DBPORT=####<br/>$ sed -i -- "s/localhost:27017/$URI:$DBPORT/g" app.js</span></pre><p id="ec25" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将<em class="lx"> &lt; dbuser &gt; </em>和<em class="lx"> &lt; dbpassword &gt; </em>替换为您在步骤1中指定的内容。</p><p id="f08e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用您的数据库ID替换XXXXX(在我的例子中，是<em class="lx"> ds049624 </em>)。</p><p id="c303" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用您的数据库端口替换####(在我的例子中，是<em class="lx"> 49624 </em>)。</p><p id="3eb3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您在这里所做的只是将MongoDB客户端更改为使用您的MongoLab实例。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="a7df" class="kw jx hi bd jy kx ky kz kc la lb lc kg ld le lf kj lg lh li km lj lk ll kp lm bi translated">步骤3:测试代码</h1><p id="d9d2" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">使用Cloud Shell，您可以轻松地测试您的代码，就像它在本地机器上运行一样。</p><pre class="lo lp lq lr fd me mf mg mh aw mi bi"><span id="549c" class="jw jx hi mf b fi mj mk l ml mm">$ npm install</span><span id="8da6" class="jw jx hi mf b fi mn mk l ml mm">$ npm start</span></pre><p id="645e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您应该看到这个:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/a451e0a6c614853e040990ffe2ff71c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EMOTYkRJiwifcUcfpqE9_g.png"/></div></div></figure><p id="84c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，启动Web预览(单击云外壳上的小按钮):</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div class="er es mp"><img src="../Images/204433f16c543f54303d55b115403299.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/1*78IjORAdSi6MIHviX2j0Dw.png"/></div></figure><p id="ffaa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">哒哒，成功了！</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div class="er es mq"><img src="../Images/d9c2aef84a04858270985f1f05e30b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*A_RUVoJHfku_MJ8w3X5A7w.png"/></div></figure><p id="577b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您添加一些数据，它会将其添加到您的MongoLab数据库中。试试看！</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="f4af" class="kw jx hi bd jy kx ky kz kc la lb lc kg ld le lf kj lg lh li km lj lk ll kp lm bi translated">步骤4:部署代码</h1><p id="05c5" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">虽然云壳非常适合测试，但它不能托管您的应用程序！是时候部署到生产环境了！</p><p id="d53f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在代码中，有一个名为<strong class="is hj"> app.yaml，</strong>的文件包含了所有的部署细节。让我们来看看:</p><pre class="lo lp lq lr fd me mf mg mh aw mi bi"><span id="b517" class="jw jx hi mf b fi mj mk l ml mm">runtime: nodejs<br/>vm: true</span></pre><p id="7f5d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不言自明。<strong class="is hj"> <em class="lx"> vm: true </em> </strong>选项让App Engine知道它应该使用<a class="ae jo" href="https://cloud.google.com/appengine/docs/managed-vms/" rel="noopener ugc nofollow" target="_blank">托管vm运行时</a>(即Docker)。</p><p id="b93c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要部署，请运行:</p><pre class="lo lp lq lr fd me mf mg mh aw mi bi"><span id="65dd" class="jw jx hi mf b fi mj mk l ml mm">$ gcloud preview app deploy app.yaml --promote</span></pre><p id="3436" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">或者你可以使用简写(感谢<strong class="is hj"> package.json </strong>文件):</p><pre class="lo lp lq lr fd me mf mg mh aw mi bi"><span id="5666" class="jw jx hi mf b fi mj mk l ml mm">$ npm run deploy</span></pre><p id="ae84" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">部署将开始。</p><p id="d311" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lx"> gcloud </em>会从云壳环境和你的<strong class="is hj"> app.yaml </strong>文件中拉取项目配置。</p><p id="c27a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">App Engine将复制您的代码，创建Docker容器，启动虚拟机和负载平衡器，并启动您的代码。你只要坐下来放松。</p><p id="a9ea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦你看到这个:</p><pre class="lo lp lq lr fd me mf mg mh aw mi bi"><span id="2d59" class="jw jx hi mf b fi mj mk l ml mm">$ Deployed module [default] to [https://XXXX.appspot.com]</span></pre><p id="c42e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你完了。去网址看看你的意思是应用程序运行！</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/8e0566fd4c5069092f13c1aed6052ac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zc9qmUFl8F0yTofIg3SFmg.png"/></div></div></figure><p id="1363" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就是这样！现在，您不需要担心服务器崩溃或数据库管理。当然，你失去了一些灵活性，因为你不是吹毛求疵每一个小细节，但对大多数应用程序来说，应用引擎工作得很好！</p><p id="ce2d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更多信息，请查看<a class="ae jo" href="https://cloud.google.com/nodejs/" rel="noopener ugc nofollow" target="_blank"> Node.js入门指南</a>和<a class="ae jo" href="http://docs.mongolab.com/" rel="noopener ugc nofollow" target="_blank"> MongoLab文档</a>。</p></div></div>    
</body>
</html>