<html>
<head>
<title>Achieving global reliability with AlloyDB Cross-Region Replication</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用AlloyDB跨区域复制实现全球可靠性</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/achieving-global-reliability-with-alloydb-cross-region-replication-3a67c6130c27?source=collection_archive---------3-----------------------#2022-12-11">https://medium.com/google-cloud/achieving-global-reliability-with-alloydb-cross-region-replication-3a67c6130c27?source=collection_archive---------3-----------------------#2022-12-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b77d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi jd translated">最近，lloyDB for PostgreSQL宣布支持跨区域复制，以便跨区域复制主集群数据和资源。跨区域复制支持在主区域停机时为灾难恢复做准备。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="er es jm"><img src="../Images/101ad45d0b4f8ed1bf6e9123f5d87efa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fSd3GXiexREYqDks-pHd8A.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">Alloy DB —初级次级跨区域复制</figcaption></figure><p id="14cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">AlloyDB的快照，带有二级跨区域集群和实例。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="er es kc"><img src="../Images/346bc845c56672e7e03b10b03b04ea03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-2XfM08LRKH6piue9f8q9A.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">AlloyDB跨区域复制。</figcaption></figure><p id="32d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">跨区域复制是在主区域停机时确保业务连续性的一项关键功能。通过支持将数据移动到更靠近区域的位置，它有助于减少网络延迟并提高性能。跨区域复制控制着克服区域中断和跨区域优化性能的设计原则。</p><p id="0591" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kd">请注意，AlloyDB仍处于预览阶段，所有观察都是为了支持，不应该用于生产。</em></p><h2 id="696b" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated">创建次级跨区域集群。</h2><p id="2b00" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">让我们看一下跨区域创建次级群集的步骤。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="er es le"><img src="../Images/517b3c0f393a46f25822276a9feafd69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*xExsSSDV80V1SZakwrap5g.gif"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">创建AlloyDB —跨区域复制。</figcaption></figure><p id="1158" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi jd translated"><span class="l je jf jg bm jh ji jj jk jl di"> H </span>尝试创建多个辅助集群将导致错误或异常。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="er es lf"><img src="../Images/58b5c1d274f50a83e9cb1adf4f5d6551.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AILsh0IJPYsyERDnZWkJ6A.png"/></div></div></figure><p id="7421" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">启用跨区域复制时，它将使用主区域中所有相似的数据库标志创建新的集群和实例。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="er es lg"><img src="../Images/ea4daba2f9984f6ba8b2622bc1c37959.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jDOvbmbLknAzJfcAKmw79A.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">查看-创建次级区域。</figcaption></figure><p id="bcd4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它在新的区域中以单独的二级存储开始初始回填过程。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="er es lh"><img src="../Images/c5b0b0f8de652b747fe08631ac9da17d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F0AmTLRQHQJ9NmZIZ1z-SA.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">二级区域存储—回填</figcaption></figure><h2 id="4d65" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated">具有复制延迟的写/读。</h2><p id="f2cb" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">辅助群集和实例用于只读操作。不允许写入这些实例。</p><pre class="jn jo jp jq fd li lj lk bn ll lm bi"><span id="5552" class="ln kf hi lj b be lo lp l lq lr">postgres=&gt; create table test1 (col1 integer);<br/>ERROR: cannot execute CREATE TABLE in a read-only transaction</span></pre><p id="80ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们考虑一下向主节点写入数据并从辅助节点读取数据的场景。我们将创建一个新表，用示例数据填充它，然后从辅助实例查询该表。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="er es le"><img src="../Images/7176cbdb24f827fddf2e3ebe9c666ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MdOPkp4wlDR_CzldeuBHgw.gif"/></div></div></figure><p id="9e8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与辅助群集相关联的辅助实例可以通过使数据更靠近区域来加速跨区域读取并减少总体网络延迟。</p><p id="13c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于跨区域复制，一个关键指标是复制延迟。它主要意味着</p><blockquote class="ls lt lu"><p id="85ca" class="if ig kd ih b ii ij ik il im in io ip lv ir is it lw iv iw ix lx iz ja jb jc hb bi translated">辅助群集中的辅助实例和关联主群集中的主实例之间的复制滞后。</p></blockquote><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="er es lh"><img src="../Images/10b9f690180aa00e34b597bb728d502f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wp1gFzcEUB4g6ei0cLLjtA.png"/></div></div></figure><p id="f9bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过监视复制延迟，您可以测量当前的延迟，并决定是否应将跨区域辅助群集提升为主群集。</p><h2 id="ad25" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated">提升辅助集群。</h2><p id="3486" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">让我们看看如何从控制台将辅助集群提升为其所在区域内的主集群。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="er es le"><img src="../Images/b6cae9d3728097ed6bef8660a7ce1f5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*pETVuHDqQcxc2NWvJUf0mw.gif"/></div></div></figure><p id="b327" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">辅助群集将在其区域内升级为主群集，但以前的主群集及其实例不会降级为辅助群集。如果我们需要为新升级的群集重新定义辅助跨区域复制，我们将需要根据区域首选项创建它。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="er es ly"><img src="../Images/dd0b3197e30dc0172a78a70a9009f3ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1xtFMdHCJ5puBDyDD5G2HQ.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">升级后-辅助集群及其资源。</figcaption></figure><h2 id="9c47" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated">主群集的故障转移及其对辅助群集的影响。</h2><p id="2f50" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">为了演示辅助集群在主集群的故障转移情况下的行为，我们将设置一个演示，连接到主和辅助实例，并从psql客户端每隔1秒运行一次SQL查询。</p><p id="2baa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将使我们能够了解在主集群出现故障时，辅助集群如何接管主集群。</p><blockquote class="ls lt lu"><p id="14fa" class="if ig kd ih b ii ij ik il im in io ip lv ir is it lw iv iw ix lx iz ja jb jc hb bi translated">select clock _ timestamp()；<br/>\手表1</p></blockquote><p id="57bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在两个实例上运行sql后，我们将在主实例上启动故障切换。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="er es lz"><img src="../Images/bd5e6e22219a0298a6fdec446dff2ee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jvOMQS6yTpGeSj6DUIXhlQ.gif"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">主实例上的故障转移— AlloyDB。</figcaption></figure><p id="8243" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在主群集的故障转移期间，对主实例的连接中断最少。但是，到辅助群集资源的连接不会受到影响。</p><h2 id="62b5" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated">摘要</h2><p id="8de2" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">AlloyDB跨区域复制允许用户从不同区域的主集群创建辅助集群和实例，以便在主区域发生故障时提供资源。辅助群集和实例是主群集及其资源的只读副本。如果主群集出现故障，辅助群集可以升级为主群集。</p></div></div>    
</body>
</html>