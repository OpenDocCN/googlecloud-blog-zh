<html>
<head>
<title>Streaming with Redis — BigQuery Part-II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Redis流— BigQuery第二部分</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/streaming-with-redis-bigquery-part-ii-763cdec9a9ec?source=collection_archive---------0-----------------------#2017-11-02">https://medium.com/google-cloud/streaming-with-redis-bigquery-part-ii-763cdec9a9ec?source=collection_archive---------0-----------------------#2017-11-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ac00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">最初出版。在一些需要解释的主题中添加了更多的单词。</em></p><p id="cace" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi je translated"><span class="l jf jg jh bm ji jj jk jl jm di"> D </span> aemon博客:<a class="ae jn" href="https://sunnykrgupta.github.io/streaming-with-redis-bigquery-part-ii.html" rel="noopener ugc nofollow" target="_blank">https://sunnykrgupta . github . io/streaming-with-redis-big query-part-ii . html</a></p><p id="bacb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">系列其他帖子:</strong></p><ul class=""><li id="ca6e" class="jo jp hi ih b ii ij im in iq jq iu jr iy js jc jt ju jv jw bi translated"><a class="ae jn" rel="noopener" href="/google-cloud/export-load-job-with-mongodb-bigquery-part-i-64a00eb5266b">导出&amp;用MongoDB-big query Part-I加载作业|由Sunny Gupta | Google Cloud-Community | Medium</a></li><li id="f765" class="jo jp hi ih b ii jx im jy iq jz iu ka iy kb jc jt ju jv jw bi translated"><a class="ae jn" rel="noopener" href="/google-cloud/patch-and-update-table-bigquery-part-iii-7f2547021926">补丁和更新表— BigQuery Part-III |作者Sunny Gupta | Google Cloud—Community | Medium</a></li></ul></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="9a98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是三贴系列的第二部分。在之前的帖子中，我们了解了使用MongoDB-big query Part-I加载作业<a class="ae jn" href="https://sunnykrgupta.github.io/export-load-job-with-mongodb-bigquery-part-i.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">导出&amp;的基本原理。</strong></a></p><p id="c629" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将深入探讨BigQuery的流特性。</p><h1 id="8034" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated"><a class="ae jn" href="https://cloud.google.com/bigquery/streaming-data-into-bigquery" rel="noopener ugc nofollow" target="_blank">流媒体</a></h1><p id="e987" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated"><strong class="ih hj">为什么？</strong> —流有助于将我们的数据推送到BigQuery(简称BQ)中，并有助于使数据可用于查询，而不会延迟运行加载作业。</p><blockquote class="lm ln lo"><p id="0214" class="if ig jd ih b ii ij ik il im in io ip lp ir is it lq iv iw ix lr iz ja jb jc hb bi translated">选择流媒体有一些权衡。下面是一些例子:</p></blockquote><ul class=""><li id="6251" class="jo jp hi ih b ii ij im in iq jq iu jr iy js jc jt ju jv jw bi translated">在进行流API调用时，我们需要遵循一些配额，如http主体大小、最大行数/请求数等。</li><li id="0699" class="jo jp hi ih b ii jx im jy iq jz iu ka iy kb jc jt ju jv jw bi translated">表中的写入数据不能立即用于bigquery中的复制或导出作业，需要90分钟才能完成，而基于负载的表可以立即使用。</li><li id="ae17" class="jo jp hi ih b ii jx im jy iq jz iu ka iy kb jc jt ju jv jw bi translated">在写这篇文章的时候，在流中发生的费用，而加载作业是免费的。</li></ul><p id="80b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">记住以上内容，我们需要在BigQuery中选择流式作业还是负载作业。</p><p id="10ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">配额:【https://cloud.google.com/bigquery/quotas#streaminginserts】<a class="ae jn" href="https://cloud.google.com/bigquery/quotas#streaminginserts" rel="noopener ugc nofollow" target="_blank"/></strong></p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h1 id="d7d7" class="kj kk hi bd kl km ls ko kp kq lt ks kt ku lu kw kx ky lv la lb lc lw le lf lg bi translated">将数据流式传输到BigQuery</h1><p id="7ac2" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">在本文中，我们将使用一个<a class="ae jn" href="https://redis.io/" rel="noopener ugc nofollow" target="_blank"> redis服务器</a>作为消息代理来保存我们的数据。</p><p id="3697" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将准备数据，数据的框架将是任何人的基本信息(用户名、姓名、生日、性别、地址、电子邮件)。根据这些信息，我们需要在流式传输之前预先创建bigquery中的模式和表。创建表后，我们将运行流程序来批量接收我们的数据，这些数据将从redis中读取，并实时写入bigquery表。我们将使用<code class="du lx ly lz ma b">python</code>作为我们的编程语言。</p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h2 id="021a" class="mb kk hi bd kl mc md me kp mf mg mh kt iq mi mj kx iu mk ml lb iy mm mn lf mo bi translated">1.在Redis中准备数据</h2><p id="be0a" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">我们将编写一个小的python脚本来预准备<a class="ae jn" href="https://redis.io/topics/data-types" rel="noopener ugc nofollow" target="_blank"> redis列表</a>中的数据。</p><p id="81cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Redis安装:</strong><a class="ae jn" href="https://redis.io/download" rel="noopener ugc nofollow" target="_blank">https://redis.io/download</a></p><pre class="mp mq mr ms fd mt ma mu mv aw mw bi"><span id="7f93" class="mb kk hi ma b fi mx my l mz na"><em class="jd">#!/usr/bin/env python</em></span><span id="76b6" class="mb kk hi ma b fi nb my l mz na"><strong class="ma hj">import</strong> <strong class="ma hj">redis</strong><br/><strong class="ma hj">import</strong> <strong class="ma hj">json</strong>, <strong class="ma hj">time</strong><br/><em class="jd">#Faker : </em><a class="ae jn" href="https://github.com/joke2k/faker" rel="noopener ugc nofollow" target="_blank"><em class="jd">https://github.com/joke2k/faker</em></a><br/><strong class="ma hj">from</strong> <strong class="ma hj">faker</strong> <strong class="ma hj">import</strong> Faker</span><span id="e52f" class="mb kk hi ma b fi nb my l mz na">streamRedis = redis.Redis(host='127.0.0.1',<br/>             port='6379',<br/>            password='')</span><span id="8f48" class="mb kk hi ma b fi nb my l mz na">fake = Faker()</span><span id="2219" class="mb kk hi ma b fi nb my l mz na"><strong class="ma hj">def</strong> profile_generator():<br/>    <strong class="ma hj">return</strong> fake.simple_profile(sex=None)</span><span id="8a0c" class="mb kk hi ma b fi nb my l mz na"><strong class="ma hj">def</strong> main():<br/>    <strong class="ma hj">while</strong> True:<br/>        streamRedis.lpush("redisList", json.dumps(profile_generator()) )<br/>        <em class="jd">#sleep 200ms</em><br/>        time.sleep(0.2)</span><span id="14e8" class="mb kk hi ma b fi nb my l mz na"><strong class="ma hj">if</strong> __name__ == "__main__":<br/>    main()</span></pre></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h2 id="e451" class="mb kk hi bd kl mc md me kp mf mg mh kt iq mi mj kx iu mk ml lb iy mm mn lf mo bi translated">2.检查数据并为表准备模式</h2><p id="ba28" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">我们的数据看起来像:</p><pre class="mp mq mr ms fd mt ma mu mv aw mw bi"><span id="261a" class="mb kk hi ma b fi mx my l mz na">{<br/>    'username': u'tarawade',<br/>    'name': u'Jennifer Lewis',<br/>    'birthdate': '2005-06-14',<br/>    'sex': 'F',<br/>    'address': u'7134 Robinson Club Apt. 530\nPort Andreachester, GA 19011-6162',<br/>    'mail': u'tmorgan@yahoo.com'<br/>}</span></pre><p id="201f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于上面格式化的数据，下面的模式将起作用</p><pre class="mp mq mr ms fd mt ma mu mv aw mw bi"><span id="e58b" class="mb kk hi ma b fi mx my l mz na">[<br/>    {<br/>        "name": "username", "type": "STRING", "mode": "NULLABLE"<br/>    },<br/>    {<br/>        "name": "name", "type": "STRING", "mode": "NULLABLE"<br/>    },<br/>    {<br/>        "name": "birthdate", "type": "STRING", "mode": "NULLABLE"<br/>    },<br/>    {<br/>        "name": "sex", "type": "STRING", "mode": "NULLABLE"<br/>    },<br/>    {<br/>        "name": "address", "type": "STRING", "mode": "NULLABLE"<br/>    },<br/>    {<br/>        "name": "mail", "type": "STRING", "mode": "NULLABLE"<br/>    }<br/>]</span></pre></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h2 id="9bbb" class="mb kk hi bd kl mc md me kp mf mg mh kt iq mi mj kx iu mk ml lb iy mm mn lf mo bi translated">3.在BigQuery中创建一个表</h2><p id="1b36" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">我们将创建两个python文件，即保存模式配置的<code class="du lx ly lz ma b"><strong class="ih hj">createConfig.py</strong></code>和执行对bigquery的表创建API调用的<code class="du lx ly lz ma b"><strong class="ih hj">tableCreate.py</strong></code>。我们将使用<code class="du lx ly lz ma b"><strong class="ih hj">Google Application Default Credentials</strong></code>来授权我们的python应用程序与bigquery APIs对话。</p><pre class="mp mq mr ms fd mt ma mu mv aw mw bi"><span id="2b4c" class="mb kk hi ma b fi mx my l mz na">$ cat createConfig.py</span><span id="536a" class="mb kk hi ma b fi nb my l mz na">TableObject = {<br/>    "tableReference": {<br/>      "projectId": "mimetic-slate",<br/>      "tableId": "StreamTable",<br/>      "datasetId": "BQ_Dataset",<br/>    },</span><span id="7716" class="mb kk hi ma b fi nb my l mz na">    "schema": {<br/>      "fields": [<br/>          {<br/>              "name": "username",<br/>              "type": "STRING",<br/>              "mode": "NULLABLE"<br/>          },<br/>          {<br/>              "name": "name",<br/>              "type": "STRING",<br/>              "mode": "NULLABLE"<br/>          },<br/>          {<br/>              "name": "birthdate",<br/>              "type": "STRING",<br/>              "mode": "NULLABLE"<br/>          },<br/>          {<br/>              "name": "sex",<br/>              "type": "STRING",<br/>              "mode": "NULLABLE"<br/>          },<br/>          {<br/>              "name": "address",<br/>              "type": "STRING",<br/>              "mode": "NULLABLE"<br/>          },<br/>          {<br/>              "name": "mail",<br/>              "type": "STRING",<br/>              "mode": "NULLABLE"<br/>          }<br/>      ],<br/>  },<br/>}</span></pre><p id="9f8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用<a class="ae jn" href="https://developers.google.com/api-client-library/python/" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">Google-API-python-client</strong></a>库与我们的bigquery APIs进行交互。</p><pre class="mp mq mr ms fd mt ma mu mv aw mw bi"><span id="8f63" class="mb kk hi ma b fi mx my l mz na"><em class="jd">#!/usr/bin/env python</em></span><span id="3067" class="mb kk hi ma b fi nb my l mz na"><strong class="ma hj">from</strong> <strong class="ma hj">googleapiclient</strong> <strong class="ma hj">import</strong> discovery<br/><strong class="ma hj">from</strong> <strong class="ma hj">oauth2client.client</strong> <strong class="ma hj">import</strong> GoogleCredentials<br/><strong class="ma hj">from</strong> <strong class="ma hj">tableCreate</strong> <strong class="ma hj">import</strong> TableObject<br/></span><span id="6590" class="mb kk hi ma b fi nb my l mz na"><strong class="ma hj">def</strong> createTable(bigquery):<br/>    tables = bigquery.tables()</span><span id="f134" class="mb kk hi ma b fi nb my l mz na">    <em class="jd">#insert utility make call to BQ API with payload \</em><br/>    <em class="jd">#(TableObject) contains schema and table-name information</em><br/>    tableStatusObject = tables.insert( projectId='mimetic-slate', \<br/>     datasetId='BQ_Dataset', body=TableObject).execute()<br/><em class="jd"># [END]</em></span><span id="c8e8" class="mb kk hi ma b fi nb my l mz na"><strong class="ma hj">def</strong> main():<br/>    <em class="jd">#to get credentials from my laptop</em><br/>    credentials = GoogleCredentials.get_application_default()<br/>    <em class="jd"># Construct the service object for interacting with the BigQuery API.</em><br/>    bigquery = discovery.build('bigquery', 'v2', credentials=credentials)<br/>    createTable(bigquery)</span><span id="484c" class="mb kk hi ma b fi nb my l mz na"><strong class="ma hj">if</strong> __name__ == '__main__':<br/>    main()<br/>    <strong class="ma hj">print</strong> "BQ Table Creator !!"</span></pre><p id="a3be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行上述程序，在bigquery数据集<code class="du lx ly lz ma b"><strong class="ih hj">BQ_Dataset</strong></code>中创建名为<strong class="ih hj"> StreamTable </strong>的表。确保您已经创建了数据集。</p><p id="b57e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以通过访问bigquery UI来验证创建的表。参观:<a class="ae jn" href="https://bigquery.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">https://bigquery.cloud.google.com</a></p><p id="9b3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考</strong>:</p><ul class=""><li id="b3b2" class="jo jp hi ih b ii ij im in iq jq iu jr iy js jc jt ju jv jw bi translated"><strong class="ih hj">表创建:</strong><a class="ae jn" href="https://developers.google.com/resources/api-libraries/documentation/bigquery/v2/python/latest/bigquery_v2.tables.html" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/resources/API-libraries/documentation/big query/v2/python/latest/big query _ v2 . tables . html</a></li><li id="6982" class="jo jp hi ih b ii jx im jy iq jz iu ka iy kb jc jt ju jv jw bi translated"><strong class="ih hj">谷歌应用默认凭证:</strong><a class="ae jn" href="https://developers.google.com/identity/protocols/application-default-credentials" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/identity/protocols/Application-Default-Credentials</a></li><li id="e016" class="jo jp hi ih b ii jx im jy iq jz iu ka iy kb jc jt ju jv jw bi translated"><strong class="ih hj">构建服务对象:</strong><a class="ae jn" href="https://developers.google.com/api-client-library/python/start/get_started#build-the-service-object" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/API-client-library/python/start/get _ started # Build-the-service-object</a></li></ul></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h2 id="9a8c" class="mb kk hi bd kl mc md me kp mf mg mh kt iq mi mj kx iu mk ml lb iy mm mn lf mo bi translated">4.流入Bigquery</h2><p id="e593" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">现在，我们已经创建了表，并将数据排队到redis列表中，我们已经准备好通过运行python脚本进行流式传输，让我们将这个脚本称为<code class="du lx ly lz ma b"><strong class="ih hj">bq-streamer.py</strong></code></p><pre class="mp mq mr ms fd mt ma mu mv aw mw bi"><span id="cc59" class="mb kk hi ma b fi mx my l mz na"><em class="jd">#!/usr/bin/env python</em></span><span id="2b8b" class="mb kk hi ma b fi nb my l mz na"><strong class="ma hj">from</strong> <strong class="ma hj">googleapiclient</strong> <strong class="ma hj">import</strong> discovery<br/><strong class="ma hj">from</strong> <strong class="ma hj">oauth2client.client</strong> <strong class="ma hj">import</strong> GoogleCredentials</span><span id="1fd4" class="mb kk hi ma b fi nb my l mz na"><strong class="ma hj">import</strong> <strong class="ma hj">json</strong>, <strong class="ma hj">time</strong>, <strong class="ma hj">copy</strong><br/><strong class="ma hj">import</strong> <strong class="ma hj">redis</strong><br/></span><span id="74fb" class="mb kk hi ma b fi nb my l mz na">batchCount = 100</span><span id="adfc" class="mb kk hi ma b fi nb my l mz na">redisStream = redis.Redis(host='127.0.0.1',<br/>             port='6379',<br/>            password='')</span><span id="460b" class="mb kk hi ma b fi nb my l mz na">streamObject = {<br/>    "rows": [<br/>      <em class="jd">#{ "json": {# Represents a single JSON object. } }</em><br/>    ],<br/> }</span><span id="7b5e" class="mb kk hi ma b fi nb my l mz na"><em class="jd">#[START Streaming batcher]</em><br/><strong class="ma hj">def</strong> streamBuilder():<br/>    <em class="jd">#Every API needs a refresh copy of dict</em><br/>    newStreamObject = copy.deepcopy(streamObject)</span><span id="0aa8" class="mb kk hi ma b fi nb my l mz na">    currentCounter = 0<br/>    <strong class="ma hj">while</strong> currentCounter &lt; batchCount:<br/>        packet = redisStream.brpop("redisList",  timeout=0)[1]<br/>        newStreamObject["rows"].append({"json":json.loads(packet)})<br/>        currentCounter +=  1</span><span id="e202" class="mb kk hi ma b fi nb my l mz na">    <strong class="ma hj">return</strong> newStreamObject<br/><em class="jd">#[END]</em><br/></span><span id="9ea1" class="mb kk hi ma b fi nb my l mz na"><em class="jd"># [START Streaming Utility]</em><br/><strong class="ma hj">def</strong> streamUtils(bigquery):<br/>    tabledata = bigquery.tabledata()</span><span id="62f4" class="mb kk hi ma b fi nb my l mz na">    <em class="jd">#Run infinitely</em><br/>    <strong class="ma hj">while</strong> True:<br/>        streamBuildBatch = streamBuilder()</span><span id="970f" class="mb kk hi ma b fi nb my l mz na">        <em class="jd">#BQ API to insert bulk data into table</em><br/>        insertStatusObject= tabledata.insertAll( \<br/>                   projectId='mimetic-slate', \<br/>                   datasetId='BQ_Dataset', tableId='StreamTable', \<br/>                   body=streamBuildBatch).execute()<br/></span><span id="5596" class="mb kk hi ma b fi nb my l mz na"><em class="jd"># [ MAIN]</em><br/><strong class="ma hj">def</strong> main():<br/>    credentials = GoogleCredentials.get_application_default()<br/>    <em class="jd"># Construct the service object for interacting with the BigQuery API.</em><br/>    bigquery = discovery.build('bigquery', 'v2', credentials=credentials)</span><span id="3a45" class="mb kk hi ma b fi nb my l mz na">    <em class="jd">#Stream utility</em><br/>    streamUtils(bigquery)<br/><em class="jd"># [END]</em><br/></span><span id="21d1" class="mb kk hi ma b fi nb my l mz na"><strong class="ma hj">if</strong> __name__ == '__main__':<br/>    main()</span></pre><p id="9b1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的程序将从列表名<code class="du lx ly lz ma b"><strong class="ih hj">redisList</strong></code>中读取运行在<code class="du lx ly lz ma b">127.0.0.1:6379</code>上的redis，并构建一个被bq流API接受的dict对象<code class="du lx ly lz ma b"><strong class="ih hj">streamObject</strong></code>。我们调用<code class="du lx ly lz ma b"><strong class="ih hj">insertAll</strong></code>实用程序向bigquery API提交我们的流请求。</p><p id="7737" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lx ly lz ma b"><strong class="ih hj">insertAll</strong></code>将<code class="du lx ly lz ma b"><strong class="ih hj">projectId, datasetId, tableId</strong></code>作为参数，而<code class="du lx ly lz ma b"><strong class="ih hj">body</strong></code>包含您要传输的数据。</p><p id="17c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">脚本已配置为<a class="ae jn" href="https://redis.io/commands/brpop" rel="noopener ugc nofollow" target="_blank">从redis列表中弹出</a> <code class="du lx ly lz ma b">100 entries</code>，并准备将其推入表中。运行<code class="du lx ly lz ma b"><strong class="ih hj">bq-streamer.py</strong></code>脚本，开始将数据传输到bigquery表中。</p><p id="64bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考</strong>:</p><ul class=""><li id="d1e0" class="jo jp hi ih b ii ij im in iq jq iu jr iy js jc jt ju jv jw bi translated"><strong class="ih hj">流媒体insertAll:</strong><a class="ae jn" href="https://developers.google.com/resources/api-libraries/documentation/bigquery/v2/python/latest/bigquery_v2.tabledata.html" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/resources/API-libraries/documentation/big query/v2/python/latest/big query _ v2 . table data . html</a></li></ul></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h2 id="78e7" class="mb kk hi bd kl mc md me kp mf mg mh kt iq mi mj kx iu mk ml lb iy mm mn lf mo bi translated">5.验证BigQuery表中的数据</h2><p id="f562" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">运行流后，当您单击表信息时，您将开始看到类似如下所示的内容。单击预览将不会显示任何流数据，需要一段时间才会显示，但它会在缓冲区中，可供立即查询。</p><p id="1e4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">缓冲区统计</strong></p><figure class="mp mq mr ms fd nd er es paragraph-image"><div class="er es nc"><img src="../Images/76357c4f9420b603329dcfcb07e6a1c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*wo2MLplXNvJb6xvVxcxo1A.png"/></div></figure><p id="269d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">表格预览</strong></p><figure class="mp mq mr ms fd nd er es paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="er es ng"><img src="../Images/9a8be674b12b17e2f51b028844d87674.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uFtCcXhX0tyQ3WWVszCNUw.png"/></div></div></figure></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h1 id="5c1f" class="kj kk hi bd kl km ls ko kp kq lt ks kt ku lu kw kx ky lv la lb lc lw le lf lg bi translated">BQ表中的SQL查询</h1><p id="178f" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">我们将运行一个简单的查询来显示显示您的流数据的输出。</p><pre class="mp mq mr ms fd mt ma mu mv aw mw bi"><span id="de9b" class="mb kk hi ma b fi mx my l mz na">SELECT * FROM [mimetic-slate:BQ_Dataset.StreamTable]</span></pre><p id="c971" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">查询结果</strong></p><figure class="mp mq mr ms fd nd er es paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="er es nl"><img src="../Images/2233561631e5553e3fac9d2d9c031784.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2WUi4e0x0cSkK1G4Y26n3A.png"/></div></div></figure></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="a317" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Github参考</strong>:<a class="ae jn" href="https://github.com/sunnykrGupta/Bigquery-series" rel="noopener ugc nofollow" target="_blank">https://github.com/sunnykrGupta/Bigquery-series</a></p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h1 id="976e" class="kj kk hi bd kl km ls ko kp kq lt ks kt ku lu kw kx ky lv la lb lc lw le lf lg bi translated">结论</h1><p id="4979" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">以上就是这个<strong class="ih hj">系列第二部</strong>的全部内容。希望你能从这篇文章中对BigQuery中的流有基本的了解。在您希望数据立即可供查询的情况下，流式处理很有帮助，在您需要构建实时分析的情况下，流式处理也很有帮助。</p><p id="148d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望通过评论得到反馈。在本系列的下一篇博客中，我将介绍在BigQuery  中修补和更新表模式的<a class="ae jn" rel="noopener" href="/google-cloud/patch-and-update-table-bigquery-part-iii-7f2547021926"> <strong class="ih hj">，这在您想要添加或更新表的字段时非常重要。</strong></a></p></div></div>    
</body>
</html>