<html>
<head>
<title>Building API Services: A Beginner’s Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建API服务:初学者指南</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/building-api-services-a-beginners-guide-7274ae4c547f?source=collection_archive---------0-----------------------#2019-02-25">https://medium.com/google-cloud/building-api-services-a-beginners-guide-7274ae4c547f?source=collection_archive---------0-----------------------#2019-02-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="57aa" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">最后更新:2019年2月25日</p></blockquote><p id="4515" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">本文概述了构建HTTP RESTful和/或gRPC API服务的一般实践和技术。它是<a class="ae jk" rel="noopener" href="/@ratrosy/building-api-services-a-beginners-guide-7274ae4c547f">构建API服务:初学者指南</a>教程系列的开篇。</p><h1 id="871c" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">入门指南</h1><p id="9737" class="pw-post-body-paragraph ii ij hi il b im kj io ip iq kk is it jh kl iw ix ji km ja jb jj kn je jf jg hb bi translated"><em class="ik">API</em>是一组促进软件组件之间通信的方法，允许系统检索信息或指示另一个软件执行某些操作。例如，当您打开此页面时，您正在使用的浏览器会调用大量操作系统API，以便它可以连接到网络，处理HTML源代码并将其显示在屏幕上。由于移动计算和云技术的日益普及，如今当人们谈论API时，他们通常指的是<em class="ik">联网API</em>，即跨设备网络运行的API，如<a class="ae jk" href="https://developers.google.com/custom-search/docs/tutorial/introduction" rel="noopener ugc nofollow" target="_blank">谷歌定制搜索</a>。在本教程系列中，术语<em class="ik"> API </em>和<em class="ik">网络API </em>可以互换使用。</p><p id="5b24" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">听起来可能很复杂，但创建一个基本的API服务实际上非常容易。下面的代码片段使用<a class="ae jk" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a>和<a class="ae jk" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> Flask </a>定义了一个API服务，允许每个人检索预定义的用户列表:</p><figure class="ko kp kq kr fd ks"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="639e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">如果您只是在进行原型开发，这样一个基本的API服务就足够了。然而，构建一个生产就绪的API服务需要更多的工程工作。一般来说，您需要:</p><ul class=""><li id="3b2e" class="kv kw hi il b im in iq ir jh kx ji ky jj kz jg la lb lc ld bi translated">设计API时要考虑简单性、一致性、可发现性和可用性</li><li id="6816" class="kv kw hi il b im le iq lf jh lg ji lh jj li jg la lb lc ld bi translated">准备服务器端(和客户端)应用程序和库，最好使用自动化工作流</li><li id="2ff6" class="kv kw hi il b im le iq lf jh lg ji lh jj li jg la lb lc ld bi translated">设置授权和身份验证</li></ul><p id="b12a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">此外，您应该:</p><ul class=""><li id="182f" class="kv kw hi il b im in iq ir jh kx ji ky jj kz jg la lb lc ld bi translated">将您的API服务部署到一个安全、可伸缩且高度可用的平台上</li><li id="8e33" class="kv kw hi il b im le iq lf jh lg ji lh jj li jg la lb lc ld bi translated">设置日志记录、监控和跟踪，以保持API服务正常运行</li><li id="5d45" class="kv kw hi il b im le iq lf jh lg ji lh jj li jg la lb lc ld bi translated">设置配额和流量管理策略来控制溢出</li><li id="55b3" class="kv kw hi il b im le iq lf jh lg ji lh jj li jg la lb lc ld bi translated">设置数据分析以收集使用情况洞察</li><li id="abfd" class="kv kw hi il b im le iq lf jh lg ji lh jj li jg la lb lc ld bi translated">提供易于理解的文档和支持材料</li></ul><p id="4f23" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">本系列教程主要关注构建API服务。我们将在另一个时间更多地讨论API服务部署和管理。</p><h1 id="ec58" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">技术</h1><p id="5444" class="pw-post-body-paragraph ii ij hi il b im kj io ip iq kk is it jh kl iw ix ji km ja jb jj kn je jf jg hb bi translated">有许多协议、工具和框架可以用来创建API服务。在本系列教程中，您将了解两种主要类型的API，HTTP REST APIs和gPRC APIs，以及可以帮助您构建它们的工具。</p><h2 id="5e05" class="lj jm hi bd jn lk ll lm jr ln lo lp jv jh lq lr jz ji ls lt kd jj lu lv kh lw bi translated">REST、HTTP RESTful APIs和OpenAPI</h2><p id="421d" class="pw-post-body-paragraph ii ij hi il b im kj io ip iq kk is it jh kl iw ix ji km ja jb jj kn je jf jg hb bi translated"><em class="ik">具象状态转移</em> (REST)是一种描述web交互模型的架构风格。它遵循<em class="ik">面向资源的设计</em>，将服务分解为一组资源和一组可用于操作资源的方法(动词)。每个资源都被分配了一个资源名称，并以开发人员选择的格式表示。例如，要检索一张照片，客户机可以在请求中指定一个资源名称和一个方法(GET ),并将请求发送给服务器；然后，服务器将以指定的格式将请求的资源返回给客户端:</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es lx"><img src="../Images/c96b9e23fd5aff072f4d1e38fa5d51f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yhj2S5SAqtJ4EYQjGlt8Mw.png"/></div></div></figure><p id="8567" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">符合<em class="ik"> REST </em>并使用HTTP协议(通常是HTTP/1.1)的API是HTTP RESTful APIs。开发人员经常使用数据格式<a class="ae jk" href="https://www.json.org/" rel="noopener ugc nofollow" target="_blank"> JSON </a> (JavaScript对象符号)和/或<a class="ae jk" href="https://en.wikipedia.org/wiki/XML" rel="noopener ugc nofollow" target="_blank"> XML </a>(可扩展标记语言)在HTTP REST APIs中传输数据。你可以使用任何web框架来构建HTTP REST API服务，流行的选择包括<a class="ae jk" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> flask </a> (Python)和<a class="ae jk" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank">express . js</a>(Javascript/node . js)。</p><p id="9fa0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">您可以像开发web应用程序一样一点一点地构建HTTP RESTful API服务；然而，许多开发人员发现将任务留给计算机更容易。有了API服务的规范，许多工具可以自动为您准备服务器端和客户端代码。这种方法极大地减少了开发工作量，也有助于客户更好地使用您的API。在本教程中，您将使用<a class="ae jk" href="https://www.openapis.org/" rel="noopener ugc nofollow" target="_blank"> OpenAPI 3.0 </a>来指定您的API，并使用<a class="ae jk" href="https://github.com/OpenAPITools/openapi-generator" rel="noopener ugc nofollow" target="_blank"> OpenAPI生成器</a>来准备代码。</p><p id="ed1b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">OpenAPI是机器可读的HTTP RESTful APIs的规范，允许开发者用YAML或JSON描述他们的API。它由<a class="ae jk" href="https://www.openapis.org/about" rel="noopener ugc nofollow" target="_blank"> OpenAPI Initiative </a>管理，这是Linux基金会下的一个开源合作项目。OpenAPI Generator是一个社区驱动的开源工具，它读取您的OpenAPI规范，并为您准备服务器端和客户端工件。</p><h2 id="a542" class="lj jm hi bd jn lk ll lm jr ln lo lp jv jh lq lr jz ji ls lt kd jj lu lv kh lw bi translated">gRPC和协议缓冲区</h2><p id="51d0" class="pw-post-body-paragraph ii ij hi il b im kj io ip iq kk is it jh kl iw ix ji km ja jb jj kn je jf jg hb bi translated"><a class="ae jk" href="https://grpc.io/" rel="noopener ugc nofollow" target="_blank"> gRPC </a>是Google开发的开源RPC框架。它使用HTTP/2进行传输，并提供许多有用的功能，如双向流和集成认证。使用gRPC框架的API就是gRPC APIs。建议gRPC APIs也采用面向资源的设计作为架构风格。</p><p id="12e2" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">gRPC APIs通常利用<a class="ae jk" href="https://developers.google.com/protocol-buffers/" rel="noopener ugc nofollow" target="_blank">协议缓冲区</a>来交换数据。Protocol Buffers类似于JSON和XML，是Google开发的用于数据序列化的开源机制。序列化过程要求您首先使用协议缓冲语言(<code class="du me mf mg mh b">.proto</code>文件语法)在<code class="du me mf mg mh b">.proto</code>文件中指定数据的结构；这一步也称为定义协议缓冲区消息类型。Protocol Buffers compiler然后可以读取<code class="du me mf mg mh b">.proto</code>文件，并用您选择的语言将您的数据结构编译成一个类，您可以用它来以编程方式操作您的数据。</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mi"><img src="../Images/ee2de30a764b2bee972ca85015f0b78e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JhUwj3rucT3gscGDqsS5ng.png"/></div></div></figure><p id="52e1" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">gRPC为Protocol Buffers compiler提供了一个特殊的插件，除了数据类之外，它还可以进一步将<code class="du me mf mg mh b">.proto</code>文件编译成gRPC API服务的服务器端和客户端构件。要使用这个插件，您需要将服务定义添加到您的<code class="du me mf mg mh b">.proto</code>文件中，它描述了您的gRPC APIs。每个gRPC API将一种协议缓冲区消息类型作为输入(请求)，将另一种协议缓冲区消息类型作为输出(响应)。</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mj"><img src="../Images/291ef17d169729a737f30678b6549ad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9LbN_ztjmkCle-sycoCDjQ.png"/></div></div></figure></div><div class="ab cl mk ml gp mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hb hc hd he hf"><figure class="ko kp kq kr fd ks"><div class="bz dy l di"><div class="kt ku l"/></div></figure></div><div class="ab cl mk ml gp mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hb hc hd he hf"><h2 id="57b0" class="lj jm hi bd jn lk ll lm jr ln lo lp jv jh lq lr jz ji ls lt kd jj lu lv kh lw bi translated">我应该使用哪些技术？</h2><p id="863c" class="pw-post-body-paragraph ii ij hi il b im kj io ip iq kk is it jh kl iw ix ji km ja jb jj kn je jf jg hb bi translated">HTTP RESTful API非常受欢迎，因为它几乎可以在所有环境中很好地工作:只要环境能够连接到API端点并发出HTTP请求，它就可以使用API服务。然而，HTTP/1.1的特性严重限制了HTTP RESTful APIs的性能:如果您计划流式传输一些媒体内容，HTTP REST API几乎不是一个好的选择。</p><p id="7773" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">另一方面，gRPC APIs通常比HTTP RESTful APIs性能好得多，并且提供了许多附加特性，比如流和可扩展认证。但是，gRPC框架可能无法在您的目标环境中工作，并且运行API服务的平台可能不支持传入的gRPC连接。</p><p id="5475" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">如果您选择在您的项目中使用gRPC，只需付出一点额外的努力，您就可以享受gRPC APIs的高性能和HTTP RESTful APIs的兼容性。gRPC社区提供了一个网关解决方案，能够同时将标准的HTTP RESTful API请求转换为gRPC请求。启用<a class="ae jk" href="https://github.com/grpc-ecosystem/grpc-gateway" rel="noopener ugc nofollow" target="_blank"> gRPC网关</a>后，您可以在服务中提供对HTTP RESTful APIs和gRPC APIs的支持。</p><h1 id="35d6" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">下一步是什么</h1><p id="8d15" class="pw-post-body-paragraph ii ij hi il b im kj io ip iq kk is it jh kl iw ix ji km ja jb jj kn je jf jg hb bi translated">本系列包含一系列指南和教程。请参见下面的主题列表:</p><ul class=""><li id="826d" class="kv kw hi il b im in iq ir jh kx ji ky jj kz jg la lb lc ld bi translated"><a class="ae jk" rel="noopener" href="/@ratrosy/designing-apis-4eed43409f93">设计API</a></li><li id="a3b3" class="kv kw hi il b im le iq lf jh lg ji lh jj li jg la lb lc ld bi translated"><a class="ae jk" rel="noopener" href="/@ratrosy/authorization-and-authentication-in-api-services-9b4db295a35b">API服务中的授权和认证</a></li></ul><h2 id="fe0b" class="lj jm hi bd jn lk ll lm jr ln lo lp jv jh lq lr jz ji ls lt kd jj lu lv kh lw bi translated">带OpenAPI的HTTP RESTful APIs</h2><ul class=""><li id="eba8" class="kv kw hi il b im kj iq kk jh mr ji ms jj mt jg la lb lc ld bi translated"><a class="ae jk" rel="noopener" href="/@ratrosy/building-apis-with-openapi-ac3c24e33ee3">用OpenAPI构建API </a></li><li id="d2d2" class="kv kw hi il b im le iq lf jh lg ji lh jj li jg la lb lc ld bi translated"><a class="ae jk" rel="noopener" href="/@ratrosy/building-apis-with-openapi-continued-5d0faaed32eb">使用OpenAPI构建API:续</a></li><li id="c295" class="kv kw hi il b im le iq lf jh lg ji lh jj li jg la lb lc ld bi translated">用OpenAPI构建API:认证<em class="ik">(进行中)</em></li><li id="41b5" class="kv kw hi il b im le iq lf jh lg ji lh jj li jg la lb lc ld bi translated">用OpenAPI构建API:版本控制<em class="ik">(进行中)</em></li></ul><h2 id="2b3a" class="lj jm hi bd jn lk ll lm jr ln lo lp jv jh lq lr jz ji ls lt kd jj lu lv kh lw bi translated">gRPC APIs</h2><ul class=""><li id="577d" class="kv kw hi il b im kj iq kk jh mr ji ms jj mt jg la lb lc ld bi translated"><a class="ae jk" rel="noopener" href="/@ratrosy/building-apis-with-grpc-50842234aec8">使用gRPC构建API</a></li><li id="b0ca" class="kv kw hi il b im le iq lf jh lg ji lh jj li jg la lb lc ld bi translated"><a class="ae jk" rel="noopener" href="/@ratrosy/building-apis-with-grpc-continued-f53b5a5ab850">使用gRPC构建API:续</a></li><li id="6702" class="kv kw hi il b im le iq lf jh lg ji lh jj li jg la lb lc ld bi translated">使用gRPC构建API:认证<em class="ik">(进行中)</em></li><li id="1587" class="kv kw hi il b im le iq lf jh lg ji lh jj li jg la lb lc ld bi translated">用gRPC构建API:版本控制<em class="ik">(进行中)</em></li></ul></div></div>    
</body>
</html>