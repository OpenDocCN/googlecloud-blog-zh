<html>
<head>
<title>Importing data from Kafka to GCS using Dataproc Serverless</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Dataproc无服务器将数据从Kafka导入GCS</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/importing-data-from-kafka-to-gcs-using-dataproc-serverless-38e449d559f9?source=collection_archive---------7-----------------------#2022-12-27">https://medium.com/google-cloud/importing-data-from-kafka-to-gcs-using-dataproc-serverless-38e449d559f9?source=collection_archive---------7-----------------------#2022-12-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="06f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据，现代每个行业都在说的新语言。</p><p id="f4e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">问:数据为什么或如何在任何业务中发挥重要作用？</em></p><p id="8c9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">答:因为数据有助于你做出决策，了解你的业务健康状况，推动你的业务等等。</em></p><p id="fbee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，在形成有意义的状态之前，数据在数据管道中经历了不同的阶段。</p><p id="41d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">今天我们将讨论如何将数据从Apache kafka传输到GCS。</em></p><p id="b4d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了实现这一点，我们在GCP上运行了一个dataproc模板。就这样，简单？没错。现在，让我们简单了解一下所有组件的构成，让它看起来简单而强大。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/cc98425f8bb294f87182e36f878b4738.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gRgjB22Kfc7rFd7QYNGzBQ.png"/></div></div></figure><blockquote class="jq jr js"><p id="3d5b" class="if ig jd ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">Dataproc是一个完全托管和高度可伸缩的服务，用于运行Apache Hadoop、Spark、Flink、Presto和30多个开源工具和框架。</p></blockquote><p id="b314" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天我们将在Dataproc上运行Apache spark，现在让我们看看什么是Apache Spark。</p><blockquote class="jq jr js"><p id="d34f" class="if ig jd ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">Apache Spark是一个用于大规模数据处理的开源统一分析引擎。Spark提供了一个接口，用于编程具有隐式数据并行和容错的集群</p></blockquote><p id="c52a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我们已经定义并理解了我们的处理引擎，现在让我们看看源和目的地。我们的消息来源是阿帕奇卡夫卡。</p><blockquote class="jq jr js"><p id="6f4f" class="if ig jd ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">Apache Kafka是一个分布式事件存储和流处理平台。它是由Apache软件基金会开发的开源系统，用Java和Scala编写。该项目旨在为处理实时数据馈送提供一个统一的、高吞吐量、低延迟的平台</p></blockquote><p id="e1bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的目的地是谷歌云存储(GCS)</p><blockquote class="jq jr js"><p id="9861" class="if ig jd ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">GCS是一个RESTful在线文件存储web服务，用于在Google云平台基础设施上存储和访问数据。该服务将谷歌云的性能和可扩展性与先进的安全和共享功能结合在一起</p></blockquote><p id="d0ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，要将数据从kafka转移到GCS，只需运行一个模板，它已经就位。<a class="ae jw" href="https://github.com/GoogleCloudPlatform/dataproc-templates/blob/main/java/src/main/java/com/google/cloud/dataproc/templates/kafka/KafkaToGCS.java" rel="noopener ugc nofollow" target="_blank">Google云平台开发的Dataproc模板</a>。</p><h1 id="ab7f" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">执行Dataproc模板的步骤</h1><p id="10fe" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">1.克隆Dataproc模板库并导航到java模板文件夹。</p><pre class="jf jg jh ji fd la lb lc bn ld le bi"><span id="da7a" class="lf jy hi lb b be lg lh l li lj">git clone https://github.com/GoogleCloudPlatform/dataproc-templates.git<br/>cd dataproc-templates/java</span></pre><p id="ae52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.获取身份验证凭据以提交作业。</p><pre class="jf jg jh ji fd la lb lc bn ld le bi"><span id="73bd" class="lf jy hi lb b be lg lh l li lj">gcloud auth application-default login</span></pre><p id="9843" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.请确保您已经启用了带有专用Google访问的子网。如果您使用的是GCP创建的“默认”VPC，您仍然需要启用如下的私人访问。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lk"><img src="../Images/7e9333e925bce4241a1b970b638b5e80.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*D9QGWVETFWiMOVYFYMJGuA.png"/></div></figure><p id="1d10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.通过导出提交所需的变量来配置Dataproc无服务器作业—</p><p id="481f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ll lm ln lb b">GCP_PROJECT</code>:运行Dataproc无服务器的GCP项目id</p><p id="e29b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ll lm ln lb b">REGION</code>:运行Dataproc无服务器的区域</p><p id="a6bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ll lm ln lb b">GCS_STAGING_LOCATION</code> : GCS暂存桶位置，在步骤3中创建</p><p id="2e3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ll lm ln lb b">SUBNET</code>:运行Dataproc无服务器的VPC子网，如果不使用默认子网的话(格式:<em class="jd">projects/&lt;project _ id&gt;/regions/&lt;region&gt;/subnetworks/&lt;子网&gt; ) </em></p><p id="a288" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ll lm ln lb b">HISTORY_SERVER_CLUSTER</code>:作为Spark历史服务器的现有Dataproc集群。该属性可用于指定专用服务器，您可以在其中查看正在运行和已完成的Spark作业的状态</p><pre class="jf jg jh ji fd la lb lc bn ld le bi"><span id="e384" class="lf jy hi lb b be lg lh l li lj">export GCP_PROJECT=&lt;project_id&gt;<br/>export REGION=&lt;region&gt;<br/>export GCS_STAGING_LOCATION=&lt;gcs-staging-bucket-folder&gt;<br/>export SUBNET=&lt;vpc-subnet&gt;<br/>export HISTORY_SERVER_CLUSER=projects/&lt;project_id&gt;/regions/&lt;region&gt;/clusters/&lt;cluster_name&gt;</span></pre><p id="970b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.现在运行KafkaToGCS模板</p><p id="8be9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">示例执行命令:</p><pre class="jf jg jh ji fd la lb lc bn ld le bi"><span id="088f" class="lf jy hi lb b be lg lh l li lj">export GCP_PROJECT=dp-test-project<br/>export REGION=us-central1<br/>export SUBNET=test-subnet<br/>export GCS_STAGING_LOCATION=gs://dp-templates-kakfatogcs/stg<br/>export GCS_SCHEMA_FILE=gs://dp-templates-kafkatogcs/schema/msg_schema.json<br/>export GCS_OUTPUT_PATH=gs://dp-templates-kafkatogcs/output/<br/>bin/start.sh \<br/>-- --template KAFKATOGCS \<br/>--templateProperty project.id=$GCP_PROJECT \<br/>--templateProperty kafka.bootstrap.servers=102.1.1.20:9092 \<br/>--templateProperty kafka.topic=events-topic \<br/>--templateProperty kafka.starting.offset=latest \<br/>--templateProperty kafka.schema.url=$GCS_SCHEMA_FILE \<br/>--templateProperty kafka.gcs.await.termination.timeout.ms=1200000 \<br/>--templateProperty kafka.gcs.output.location=$GCS_OUTPUT_PATH \<br/>--templateProperty kafka.gcs.output.format=parquet</span></pre><p id="d882" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jw" href="https://github.com/GoogleCloudPlatform/dataproc-templates/blob/main/java/src/main/java/com/google/cloud/dataproc/templates/kafka/README.md#2-kafka-to-gcs" rel="noopener ugc nofollow" target="_blank">更多</a>信息运行模板</p><p id="33e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.监控Spark批处理作业</p><p id="4a73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提交作业后，您将能够在Dataproc批处理UI中查看作业。从那里，我们可以查看作业的指标和日志。</p><h1 id="88a2" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">参考</h1><ul class=""><li id="35c1" class="lo lp hi ih b ii kv im kw iq lq iu lr iy ls jc lt lu lv lw bi translated"><a class="ae jw" href="https://cloud.google.com/dataproc-serverless/docs/overview" rel="noopener ugc nofollow" target="_blank"> Dataproc无服务器文档</a></li><li id="2498" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated"><a class="ae jw" href="https://github.com/GoogleCloudPlatform/dataproc-templates" rel="noopener ugc nofollow" target="_blank"> Dataproc模板GitHub库</a></li><li id="94fa" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated"><a class="ae jw" href="https://spark.apache.org/docs/2.2.0/structured-streaming-kafka-integration.html#structured-streaming-kafka-integration-guide-kafka-broker-versio" rel="noopener ugc nofollow" target="_blank">结构化流媒体+ Kafka集成指南</a></li></ul></div></div>    
</body>
</html>