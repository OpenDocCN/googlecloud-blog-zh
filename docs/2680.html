<html>
<head>
<title>Automation VM instance tasks and configurations using Startup-scripts in GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在GCP使用启动脚本自动化虚拟机实例任务和配置</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/automation-vm-instance-tasks-and-configurations-using-startup-scripts-in-gcp-ca66f7c9afc?source=collection_archive---------3-----------------------#2022-12-26">https://medium.com/google-cloud/automation-vm-instance-tasks-and-configurations-using-startup-scripts-in-gcp-ca66f7c9afc?source=collection_archive---------3-----------------------#2022-12-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/93bd115af97c9809edf8f092f9362c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ytw-_ir2ZBKsLt4zxPemKw.png"/></div></div></figure><p id="8d9b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">简介</strong></p><p id="347a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我们将了解如何使用启动脚本在GCP虚拟机或GCE实例中自动执行磁盘装载、分配驱动器号和标签、下载文件和软件包、安装软件、插件、证书以及编辑配置等任务。</p><p id="b770" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">什么是启动脚本？</strong></p><p id="fd6b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">启动脚本是包含虚拟机(VM)实例启动时运行的命令的文件。计算引擎支持在<strong class="is hj"> Linux虚拟机和【Windows虚拟机上运行启动脚本。</strong></p><h1 id="c594" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">【Linux虚拟机的启动脚本</h1><p id="9450" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">可以在虚拟机创建过程中使用自动化部分或使用元数据键将启动脚本添加到Linux虚拟机中。您可以使用多个启动脚本。存储在本地或直接添加的启动脚本在存储在云存储中的启动脚本之前执行。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/efd48708c16437a6f5635d48fc6b45da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HSW89aicihZVaibhSVoPRQ.png"/></div></div></figure><p id="ea98" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以在GCS桶中添加一个脚本，并使用GCS url和元数据，或者我们可以直接传递命令，如下图所示。如果将脚本存储在GCS存储桶中，请确保VM服务帐户至少具有从存储桶读取文件的读取权限和范围。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kw"><img src="../Images/600419dc5c3afb05bdfe2c69b5b9110c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9j1BOzuxk8gmwDyENTm2Gg.png"/></div></div></figure><p id="0ead" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以在云控制台串行输出日志中查看启动脚本执行日志</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/cc9e9543b69add3bf8380830640b0764.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I1mEnSEQNy8nobU0gPIPCg.png"/></div></div></figure><p id="4ad4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以在下面看到日志和执行顺序</p><p id="7646" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将执行第一个<strong class="is hj">启动脚本</strong>元数据项</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ky"><img src="../Images/9d2878cbb4298793a1eda6e86f15d7cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ZJTieFGmKadeRGKDcx6pA.png"/></div></div></figure><p id="7e45" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">之后<strong class="is hj">启动脚本url </strong>元数据文件将执行</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kz"><img src="../Images/42baa27f40f1bd7f7c654815f550bda0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8hxFEYdrcdhPdLAgfNHz8A.png"/></div></div></figure><h1 id="3f18" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">Windows虚拟机的启动脚本</h1><p id="e7c4" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">Windows启动脚本必须是命令shell ( <code class="du la lb lc ld b">.cmd</code>)、PowerShell ( <code class="du la lb lc ld b">.ps1</code>)或批处理文件脚本(<code class="du la lb lc ld b">.bat</code>)，并且必须具有适当的文件扩展名。</p><p id="d832" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下表显示了可用于Windows启动脚本的元数据项，并根据启动脚本的存储位置、大小和文件类型提供了有关使用哪个项的信息。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es le"><img src="../Images/c7642364ea59391603d7ec21aec29d5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pM8jLZEI3IGeAw5JmS_FIg.png"/></div></div></figure><p id="1f69" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">在启动脚本中访问虚拟机元数据</strong></p><p id="7f8f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在执行启动脚本时，可以使用虚拟机元数据，如下例所示，获取网络标记并将其保存为启动脚本中的变量，然后在脚本执行中使用。</p><pre class="ks kt ku kv fd lf ld lg bn lh li bi"><span id="a1aa" class="lj jp hi ld b be lk ll l lm ln">$tags = (Invoke-RestMethod -Headers @{'Metadata-Flavor' = 'Google'} -Uri "http://metadata.google.internal/computeMetadata/v1/instance/tags")<br/></span></pre><p id="be5a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用上述方法，我们可以使用启动脚本和自动化windows和Linux虚拟机任务。</p><p id="4d27" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有关演示，请参见下面的视频</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="lo lp l"/></div></figure><p id="edac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更多关于谷歌云的视频，请在下面免费找到我的谷歌云播放列表。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="lq lp l"/></div></figure></div></div>    
</body>
</html>