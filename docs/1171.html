<html>
<head>
<title>Managing VPC Networks? No Problem! Make sure your teams use the right subnetwork in a Shared-VPC architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">管理VPC网络？没问题！确保您的团队在共享VPC架构中使用正确的子网</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-make-sure-your-teams-always-use-the-right-subnetwork-in-a-shared-vpc-architecture-eef3dc581a04?source=collection_archive---------1-----------------------#2019-10-15">https://medium.com/google-cloud/how-to-make-sure-your-teams-always-use-the-right-subnetwork-in-a-shared-vpc-architecture-eef3dc581a04?source=collection_archive---------1-----------------------#2019-10-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="957f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在GCP，在一个组织中使用一个或几个共享的VPC网络来简化项目/团队和内部的交流是一个最佳实践。</p><p id="55d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于共享VPC如何工作的一个有趣的事实是，你给<em class="je">特定用户(或组)</em>在VPC内的哪些<em class="je">子网</em>上的权限，他们可以使用这些权限来创建他们的资源(例如计算引擎虚拟机实例)</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/0d3b9b28521b61ce653ed079ed9cef86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3B3O76CSKIRkEsfWqLOskQ.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">共享VPC网络，主机和服务项目连接到内部</figcaption></figure><p id="f35e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想象一个场景，一个组织在一个共享的VPC 中指定<em class="je">一个项目和一个子网，供组织中的每个团队使用。我们还假设一个用户是多个团队的一部分，因此能够登录到多个项目中。给定共享VPC子网共享的工作方式，该用户将能够在已经与她/他共享的任何子网中部署工作负载；而不管她/他登录的具体项目。因此，当在一个项目中创建资源时，用户可能会意外地使用不正确的子网:这可能会导致混乱，并可能由于防火墙规则的不匹配部署而导致连接问题。</em></p><p id="3a07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然存在其他方法来应对这种情况，但GCP客户现在可以利用一种新的完全基于平台的解决方案，该解决方案基于新的<a class="ae jd" href="https://cloud.google.com/resource-manager/docs/organization-policy/understanding-constraints" rel="noopener ugc nofollow" target="_blank">组织策略约束</a>，称为<strong class="ih hj">限制共享VPC子网</strong>(有关其他您可能不知道的好处，请参见<a class="ae jd" href="https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints" rel="noopener ugc nofollow" target="_blank">可用约束列表</a>)。尽管名称如此，许多约束可以应用于组织级别，也可以应用于特定的<a class="ae jd" href="https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy#folders" rel="noopener ugc nofollow" target="_blank">文件夹</a>或项目级别。这是一件大事，因为它符合IAM层次结构的整体性，并且策略可以被继承。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jv"><img src="../Images/1829e5fdd370e339f2e31d87e448c3aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gNrcRkVmdVZXfvGy.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">典型的组织资源层级</figcaption></figure><p id="de94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，在实践中如何应用这个约束，并在上述情况下提供帮助呢？</p><p id="932a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设名为<strong class="ih hj"> "Team Orange" </strong>的数据库管理团队被分配了一个名为(惊喜！)橙色，而名为<strong class="ih hj">“蓝色团队”</strong>的活动目录管理团队被分配了一个名为(另一个惊喜！)蓝色。用于这些项目的文件夹结构很简单，此处显示供参考。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jw"><img src="../Images/0b90ebad5d73a1abad50870c3fdb7fec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rweOrX630swutmyq"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">使用的组织资源层次结构</figcaption></figure><p id="ea95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个名为<strong class="ih hj">橙</strong>的用户是一个超级英雄，他不仅是自己<em class="je">原生</em>T8】团队(橙队)的一部分，而且<em class="je">也是另一个</em> <em class="je">团队</em>(蓝队)的一部分。</p><p id="be9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后<em class="je">用户orange </em>已经获得了主机项目VPC的两个子网络的用户权限:</p><ul class=""><li id="24df" class="jx jy hi ih b ii ij im in iq jz iu ka iy kb jc kc kd ke kf bi translated"><strong class="ih hj">子192–168–2–48-m28-eu w3</strong></li><li id="6e38" class="jx jy hi ih b ii kg im kh iq ki iu kj iy kk jc kc kd ke kf bi translated"><strong class="ih hj">子192–168–2–0-m28-euw 4</strong></li></ul><p id="415b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当不应用组织策略约束“<strong class="ih hj">限制共享VPC子网</strong>”时，用户orange可以登录两个项目中的任何一个，并查看与他/她共享的子网:例如，这是登录Orange项目时的视图(蓝色项目的视图将是相同的)</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jw"><img src="../Images/55e4c6ae4ac0dc4cf05e363f5de27655.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QdGzQmOvvDS9OAzr"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">事实上，这些子网可以有更好的名字</figcaption></figure><p id="ccd5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，如果将适当的策略约束应用于Orange项目，该用户将只能使用两个子网中的<strong class="ih hj">一个</strong>来部署资源，如计算实例:在本例中，他/她只能使用<strong class="ih hj">子192–168–2–0-m28-euw4</strong></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es kl"><img src="../Images/f9b7fa7f36c8f1bcc3027cd3e652976c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1eqkDtz1K5lEdSC7mYDCzA.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">你没有用对！</figcaption></figure><p id="7b7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来看看所使用的组织策略约束:正如您所看到的，该策略通过继承被强制到项目“Orange ”(它被应用于文件夹Orange-SP级别),并且只允许两个子网络中的一个。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es km"><img src="../Images/69ceb6ec1f30196539baa3f569ff01f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iTuoQ_BPfs4DxaqVNFf1bA.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">这不是您以前使用的子网！</figcaption></figure><p id="52b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了完成设置，对称策略约束被应用到Blue-SP文件夹，并通过继承应用到Blue项目:这次只允许子网<strong class="ih hj">子192–168–2–48-m28-eu w3</strong></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es kn"><img src="../Images/a1db62e4fac6dab9d351a56132f7d75a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jyi0KxZeEH0Cwmi8FStE8A.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">有道理，对吧？</figcaption></figure><p id="55c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么当用户orange登录project Blue并尝试在之前部署失败的子网中进行部署时会发生什么呢？</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es ko"><img src="../Images/2a1c9ffd583db87ca08055dba84e2f85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YB0NfH9vDWp-XVcn0j8oyw.png"/></div></div></figure><p id="9ba0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总之，在共享VPC设置中，新的组织策略约束“<strong class="ih hj">限制共享VPC子网</strong>”允许指定从主机项目共享的哪些子网可以在每个服务项目中使用。如前面的示例所示，它可以用来避免用户错误地将计算实例部署在错误的子网或错误的项目中，这取决于您如何看待它。</p><p id="fc00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您通过团队、应用程序或工作负载指定特定的项目和子网，那么现在为正确的子网激活每个项目或文件夹的约束无疑是最佳实践的一部分。</p><p id="f835" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢<a class="ae jd" href="https://profile.emazza.net" rel="noopener ugc nofollow" target="_blank">伊曼纽</a>为本帖贡献图片和用户故事。</p></div></div>    
</body>
</html>