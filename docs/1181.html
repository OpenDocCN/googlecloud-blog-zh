<html>
<head>
<title>Connecting Cloud SQL - Public IP + IP Allowlist</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">连接云SQL -公共IP + IP允许列表</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/cloud-sql-public-ip-allowlist-e2e375b4432d?source=collection_archive---------2-----------------------#2019-10-25">https://medium.com/google-cloud/cloud-sql-public-ip-allowlist-e2e375b4432d?source=collection_archive---------2-----------------------#2019-10-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/23ae89e680f61cca63c0c7af884f9bfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*efvnGXZbvpu0ib5qBdUfuQ.png"/></div></div></figure><p id="87df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">嗨，朋友们！</p><p id="a2e6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇博客将带您一步步了解如何使用公共IP选项连接到您的云SQL实例，并且只允许<em class="jo">特定的</em>IP地址连接。这可能是创建和使用云SQL实例最不安全的方式。每个人都有自己的容忍度，他们可能会发现做什么是安全的，对我来说，我永远不会在生产中这样做。测试、概念验证、原型制作，所有这些，当然，绝对…只要数据库中没有敏感数据。对于生产，您肯定希望使用Google SQL代理来转移到更安全的选项，比如<a class="ae jp" rel="noopener" href="/@GabeWeiss/cloud-sql-public-ip-proxy-5513f59e5a9e">。</a></p><p id="6f38" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想了解更多关于云SQL连接的背景知识，请查看我的<a class="ae jp" rel="noopener" href="/@GabeWeiss/connecting-google-cloud-sql-94025ba27071">连接介绍</a>博客文章。这篇文章还链接到更多关于不同用例和方法的分步文章，以及为什么您可能想要选择一种方法而不是另一种方法。所有这些帖子都假设你已经有了自己的谷歌云平台(GCP)项目，并设置了计费。如果没有，点击此处的<a class="ae jp" href="https://console.cloud.google.com/freetrial" rel="noopener ugc nofollow" target="_blank">按钮</a>开始项目，或点击此处的<a class="ae jp" href="https://console.cloud.google.com/billing" rel="noopener ugc nofollow" target="_blank">按钮</a>为项目设置账单。</p><h1 id="2ea4" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">指南:</h1><p id="d30d" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">创建云SQL实例。我会在控制台上演示一下，但是如果你知道如何使用<code class="du kt ku kv kw b">gcloud</code>那也很酷。</p><p id="dca1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">到这里<a class="ae jp" href="https://console.cloud.google.com/sql/instances" rel="noopener ugc nofollow" target="_blank">去</a>。如果您已经有了实例，那么点击顶部导航栏中的<code class="du kt ku kv kw b">CREATE INSTANCE</code>按钮:</p><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/a60e678e4fe75b9c3493e5db52dc241b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*p_SiH6i59RiL9cn-"/></div></div></figure><p id="9606" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你还没有，那么点击对话框中蓝色的<code class="du kt ku kv kw b">Create instance</code>按钮。</p><p id="6872" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">选择您的数据库风格，对于本教程来说，选择哪种类型并不重要。</p><p id="7207" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">设置一个实例ID，一个root密码，然后展开<code class="du kt ku kv kw b">Show configuration options</code></p><figure class="ky kz la lb fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/d24e36b002fee1f5822c132ffbe705f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:436/0*VzOZP0pO3DyAtCPD"/></div></figure><p id="e6b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">展开<code class="du kt ku kv kw b">Connectivity</code>部分</p><ul class=""><li id="8187" class="ld le hi is b it iu ix iy jb lf jf lg jj lh jn li lj lk ll bi translated">确认<code class="du kt ku kv kw b">Public IP</code>已勾选</li><li id="1410" class="ld le hi is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated">点击公共IP部分的<code class="du kt ku kv kw b">Add network</code>按钮</li></ul><figure class="ky kz la lb fd ij er es paragraph-image"><div class="er es lr"><img src="../Images/69940cde7870cc82a2e4b133fddd9fab.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/0*h04wnv7o6wznkHUj"/></div></figure><p id="b1b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你需要找到你要连接的IP地址。对于本教程，可能是你所在机器的IP地址(除非你雄心勃勃，想从云机器上做这件事)。</p><ul class=""><li id="07c1" class="ld le hi is b it iu ix iy jb lf jf lg jj lh jn li lj lk ll bi translated">最简单的方法是从机器上打开浏览器，进入<a class="ae jp" href="https://www.whatsmyip.org/" rel="noopener ugc nofollow" target="_blank">whatsmyip.org</a></li><li id="27fa" class="ld le hi is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated">如果你不能，因为它是一个无头机器，或者你被SSH-d进入，使用类似于<code class="du kt ku kv kw b">dig</code>的DNS查找也是一个好方法</li><li id="7045" class="ld le hi is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated"><code class="du kt ku kv kw b">dig @resolver1.opendns.com ANY myip.opendns.com +short -4</code></li></ul><p id="61af" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦您有了IP地址，就把它放入网络框中，将该特定连接列入白名单</p><p id="76b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">关于CIDR符号的快速克里夫笔记(这里有一个<a class="ae jp" href="http://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing#CIDR_notation" rel="noopener ugc nofollow" target="_blank">链接</a>，但是我发现这个链接对你需要放入什么来让事情运转起来的细节帮助不大，因为你不想了解很多关于网络的细节):</p><ul class=""><li id="bdab" class="ld le hi is b it iu ix iy jb lf jf lg jj lh jn li lj lk ll bi translated">要只允许一个IP地址，只需输入地址，或者使用以下格式:<code class="du kt ku kv kw b">&lt;ip address&gt;/32</code></li><li id="f473" class="ld le hi is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated">例如<code class="du kt ku kv kw b">104.132.11.92</code>或<code class="du kt ku kv kw b">104.132.11.92/32</code>都是等效的，并且只允许特定的IP地址</li><li id="7a20" class="ld le hi is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated">要允许一定范围的IP地址:</li><li id="bcb2" class="ld le hi is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated"><code class="du kt ku kv kw b">104.132.11.0/24</code>表示允许<code class="du kt ku kv kw b">104.132.11.0</code>到<code class="du kt ku kv kw b">104.132.11.255</code></li><li id="938f" class="ld le hi is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated">斜线后面的数字表示IP地址中有多少用作过滤器。IP地址的每个数字都是二进制数的八位字节，因此24意味着使用前三个数字，第四个数字可以是任何值。8表示仅使用第一个数字作为过滤器，允许IP中带有第一个数字的任何内容通过。例如，<code class="du kt ku kv kw b">104.132.0.0/16</code>表示允许任何以<code class="du kt ku kv kw b">104.132.xxx.xxx</code>开头的IP地址，<code class="du kt ku kv kw b">104.0.0.0/8</code>表示允许任何以<code class="du kt ku kv kw b">104.xxx.xxx.xxx</code>开头的IP地址。大开<code class="du kt ku kv kw b">0.0.0.0/0</code>意味着允许来自任何地方的任何东西(请不要这样做)。注意这一点，因为您可能会无意中允许比预期更多的访问。</li></ul><p id="e959" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">添加任何您想要允许的IP地址后，单击<code class="du kt ku kv kw b">Done</code></p><p id="9f35" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击<code class="du kt ku kv kw b">Create</code>按钮，您将返回到实例列表，并应看到您的实例</p><ul class=""><li id="cd10" class="ld le hi is b it iu ix iy jb lf jf lg jj lh jn li lj lk ll bi translated">您可以点击进入实例，并看到横幅说它还没有准备好。</li></ul><figure class="ky kz la lb fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/e3b147f7074ffa54838ae6101b38fb11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sN3iIDwVDugaLPP4"/></div></div></figure><ul class=""><li id="b35a" class="ld le hi is b it iu ix iy jb lf jf lg jj lh jn li lj lk ll bi translated">这可能需要几分钟时间</li></ul><p id="0c1b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">验证连通性</strong></p><p id="e979" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从实例详细信息概览页面获取连接IP地址</p><ul class=""><li id="ed95" class="ld le hi is b it iu ix iy jb lf jf lg jj lh jn li lj lk ll bi translated">它在公共IP地址的<code class="du kt ku kv kw b">Connect to this instance</code>部分</li></ul><p id="af3f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">验证连通性最简单的方法是使用psql:</p><ul class=""><li id="943b" class="ld le hi is b it iu ix iy jb lf jf lg jj lh jn li lj lk ll bi translated"><code class="du kt ku kv kw b">psql “host=&lt;connection IP from above step&gt; port=5432 sslmode=disable user=postgres”</code>然后输入您在数据库创建时指定的密码</li><li id="1ee8" class="ld le hi is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated">请注意，即使设置了<code class="du kt ku kv kw b">sslmode=disable</code>，谷歌SQL代理也提供了加密连接</li></ul><p id="0863" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">总结</strong></p><p id="52f3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了解决这个问题，您需要做的就是删除云SQL实例。遇到什么问题了吗？请让我知道！回复下面的评论，或者在<a class="ae jp" href="https://twitter.com/GabeWeiss_" rel="noopener ugc nofollow" target="_blank">推特</a>上联系我。我的DMs打开了！</p></div></div>    
</body>
</html>