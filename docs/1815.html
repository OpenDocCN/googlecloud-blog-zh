<html>
<head>
<title>Private Service Connect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">专用服务连接</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/private-service-connect-c99e3e94537b?source=collection_archive---------0-----------------------#2021-03-01">https://medium.com/google-cloud/private-service-connect-c99e3e94537b?source=collection_archive---------0-----------------------#2021-03-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8761e47b1c800a6ae5bb366353c5c814.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Kn-Ww9qRpbtR5QBV"/></div></div></figure><p id="7033" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当我们建立VPC网络时，我们可能不希望通过该网络连接互联网。这可能意味着连接到该网络的应用程序可能无法访问Google托管的服务，如云存储、Pubsub、BigQuery和许多其他服务。这些服务通过公共(互联网)IP地址公开。此外，如果有内部应用程序希望利用Google托管服务，我们也可能希望通过VPN或其他互连解决方案将内部流量路由到我们的GCP网络，我们似乎也有同样的问题。</p><p id="60df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是GCP专用业务连接功能发挥作用的地方。在本文中，我们将讨论使用私有服务连接来专门访问Google托管服务，但似乎私有服务连接(可以/将会有额外的用途)。</p><p id="44b8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">私有服务连接的最高概念是我们在VPC网络中保留一个RFC1918 IP地址。当配置正确时(我们将很快介绍)，发送到我们选择的IP地址的请求会透明地自动路由到正确的Google托管服务。这意味着我们现在可以在没有任何人看到的公共IP地址的情况下与这些服务进行交互。我们现在考虑的所有IP地址都是基于RFC1918的，没有任何东西接近互联网。</p><p id="6883" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">设置私有服务连接环境非常简单。在这里，我们将从头开始进行完整的设置:</p><ul class=""><li id="0d35" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">从一个空的GCP项目开始。</li><li id="4778" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">创建一个新的VPC网络。我们称我们的为<code class="du kd ke kf kg b">my-network</code>。请特别注意，我们<strong class="is hj">必须</strong>启用私人谷歌访问。</li></ul><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kh"><img src="../Images/084f800ecd1659c693afb787228bf627.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jg4NKjBx-L23SNn6"/></div></div></figure><ul class=""><li id="50e2" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">在网络服务下，选择专用服务连接。</li></ul><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kh"><img src="../Images/baeee36c7cdcca553a8237457d42bfbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_KPs_NfXbWyFjScf"/></div></div></figure><ul class=""><li id="775f" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">单击连接服务链接。这是我们将在网络中创建私有服务连接端点的地方，这将是我们用来连接到GCP托管服务的路径。</li></ul><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es km"><img src="../Images/e0290dded06e52b17dac1422a604e7ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*I32VpftH9jrizq7c"/></div></div></figure><p id="e735" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们创建了一个名为<code class="du kd ke kf kg b">endpoint1</code>的静态IP地址。</p><ul class=""><li id="eaa5" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">完成后，我们会发现我们有一个如下所示的条目:</li></ul><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/3fbded6fda62cf42542815e6dbb1faa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GqmtIpQcpBvUs85N"/></div></div></figure><ul class=""><li id="1e17" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">创建云DNS区域。</li></ul><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/9d101f1a3bc4dc51a4f40b588ebdc8a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JZFAv8zvVDACHpsh"/></div></div></figure><ul class=""><li id="d704" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">添加记录集</li></ul><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/9df3ded9948f28ea48664accdda2a09b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mdvCAn0i4RStXm0E"/></div></div></figure><ul class=""><li id="282c" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">创建一个新的虚拟机，用于在我们的网络上进行测试。确保它没有公共IP地址。</li><li id="f85f" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">设置防火墙规则以允许进入。</li><li id="79ae" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">通过SSH登录到我们的虚拟机。</li><li id="f7c1" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">创建新的GCS存储桶。</li></ul><pre class="ki kj kk kl fd kp kg kq kr aw ks bi"><span id="810b" class="kt ku hi kg b fi kv kw l kx ky">gsutil mb gs://kolban-psc-test2</span></pre><ul class=""><li id="c0c2" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">证明我们可以通过互联网访问谷歌托管服务。</li></ul><pre class="ki kj kk kl fd kp kg kq kr aw ks bi"><span id="fc6b" class="kt ku hi kg b fi kv kw l kx ky">curl -X GET -H "Authorization: Bearer $(gcloud auth print-access-token)" "https://storage.googleapis.com/storage/v1/b?project=$(gcloud config get-value project)"</span></pre><ul class=""><li id="a793" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">演示我们可以通过私有服务连接访问Google托管服务:</li></ul><pre class="ki kj kk kl fd kp kg kq kr aw ks bi"><span id="c97a" class="kt ku hi kg b fi kv kw l kx ky">curl -X GET -H "Authorization: Bearer $(gcloud auth print-access-token)" "https://storage-endpoint1.p.googleapis.com/storage/v1/b?project=$(gcloud config get-value project)"</span></pre><ul class=""><li id="8203" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">删除我们网络的默认Internet出口路由。</li><li id="0713" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">重新运行<code class="du kd ke kf kg b">curl</code>测试，我们将看到互联网路径路由失败。</li></ul><p id="7332" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">除了本文之外，这里还有一个YouTube视频，演示了创建私有服务连接环境的步骤:</p><figure class="ki kj kk kl fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><h1 id="6df8" class="lb ku hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">参考资料:</h1><ul class=""><li id="9fe2" class="jp jq hi is b it ly ix lz jb ma jf mb jj mc jn ju jv jw jx bi translated"><a class="ae md" href="https://cloud.google.com/vpc/docs/private-service-connect" rel="noopener ugc nofollow" target="_blank">文档:私有服务连接</a></li><li id="0553" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><a class="ae md" href="https://cloud.google.com/vpc/docs/configure-private-service-connect-consumer" rel="noopener ugc nofollow" target="_blank">文档:配置私有服务连接</a></li><li id="4dfc" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><a class="ae md" href="https://cloud.google.com/blog/products/networking/introducing-private-service-connect" rel="noopener ugc nofollow" target="_blank">博客:新的私有服务连接简化服务的安全访问—2020–07</a></li><li id="f62a" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><a class="ae md" href="https://www.youtube.com/watch?v=TksQGwXIl1A" rel="noopener ugc nofollow" target="_blank"> YouTube:谷歌新的私有服务连接简化了云服务的安全访问规模2:13–2020–07</a></li><li id="e0a2" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><a class="ae md" href="https://www.youtube.com/watch?v=TYumathiFRI" rel="noopener ugc nofollow" target="_blank"> YouTube:私有服务连接和服务目录:在云中连接应用程序的革命—22:22–2020–09</a></li></ul></div></div>    
</body>
</html>