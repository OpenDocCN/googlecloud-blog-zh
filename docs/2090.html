<html>
<head>
<title>Version Control of BigQuery schema changes with Liquibase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Liquibase对BigQuery模式更改的版本控制</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/version-control-of-bigquery-schema-changes-with-liquibase-ddc7092d6d1d?source=collection_archive---------0-----------------------#2022-02-04">https://medium.com/google-cloud/version-control-of-bigquery-schema-changes-with-liquibase-ddc7092d6d1d?source=collection_archive---------0-----------------------#2022-02-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="a2b4" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">万事万物都在变化，唯独没有改变自己。一切都在流动，没有什么是一成不变的……(<strong class="il hj">赫拉克利特</strong>)。</p></blockquote><p id="4573" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">这种说法非常普遍，即使对于软件应用程序也是如此。实际上，应用程序团队实现并发布了满足最终用户期望的新特性。新功能需要额外的代码，因此软件工程师已经掌握了版本控制，即跟踪和管理软件代码变更的实践。当变更得到适当管理时，持续集成和持续部署等DevOps流程将标准化和自动化新版本的部署，从而大大加快实现价值的时间。有些公司能够随时交付新版本(技术能力+发布过程灵活性)，这被称为持续交付。</p><blockquote class="if ig ih"><p id="d0ae" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">一切都在变化，没有什么是失去的(<strong class="il hj">毕达哥拉斯)</strong></p></blockquote><p id="f183" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">好吧，但那是关于代码的。数据怎么样？毫不奇怪，数据从业者试图转移这些技术和过程来跟踪和管理对数据库代码(用户定义的函数、存储过程……)、数据结构(表、视图……)和内容(数据)的更改。我想澄清的是，这里的“数据从业者”一词相当宽泛，既包括那些从事传统web应用程序后端工作的人，也包括那些从事数据仓库、分析项目工作的人，在这些项目中，最终应用程序通常被称为“数据产品”。后一种情况与本文更加相关，因为对于如何操作这些产品和以自动化的方式处理变更，绝对没有标准。最常见的方法是编写自定义框架，处理脚本排序、支持协作的约定(这样团队成员就不会覆盖彼此的更改)、等幂(您可以多次运行脚本，只有在尚未应用更改时才会应用更改)等。替代方法是重用开源社区中已经可用的内容。一个很好的例子就是叫做Liquibase的项目。</p><p id="752e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">在本文中，我将展示如何将<strong class="il hj"> Liquibase </strong>与来自<strong class="il hj"> Google </strong>的<strong class="il hj"> BigQuery - </strong>完全托管的无服务器数据仓库结合使用，该数据仓库能够对Pb级数据进行可扩展的<strong class="il hj">分析</strong>(<a class="ae jk" href="https://cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/bigquery</a>)。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jl"><img src="../Images/fed6c18185841ac91ad551b842c8b40e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SmO8NJN95Fb-6XNWf9Rr2w.png"/></div></div></figure><h1 id="f7ec" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">Liquibase —工作原理</h1><p id="4407" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it jh kx iw ix ji ky ja jb jj kz je jf jg hb bi translated">在Liquibase中，数据库的更改由一个名为<strong class="il hj">的分类帐管理，即changelog </strong>。对数据库的单个更改称为变更集，因此changelog是变更集的集合。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es la"><img src="../Images/7ef7b85f865c3b0cca62de121f0c166b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*zNv9W5BxqbDKQ9sxzPjZuQ.png"/></div></figure><p id="3405" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">Liquibase跟踪哪些变更集已经或者还没有在<a class="ae jk" href="https://docs.liquibase.com/concepts/databasechangelog-table.html?__hstc=94692481.9079d0f405f55159f55c8b6a827b8214.1643615966600.1643615966600.1643615966600.1&amp;__hssc=94692481.1.1643615966601&amp;__hsfp=1918197977" rel="noopener ugc nofollow" target="_blank">跟踪表</a>中部署。因此，他们知道哪些更改已经部署到数据库中，哪些更改尚未部署。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es lb"><img src="../Images/cec1ddfe1068d38a6e13bccaea183dfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yB27sWBfZRH1pR_u3Mu0-Q.png"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx translated">具有8个已部署变更集的辅助跟踪表(DATABASECHANGELOG)</figcaption></figure><p id="aef4" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">Liquibase将当前的changelog与其辅助跟踪表进行比较，并且只部署尚未部署到数据库的更改——这使得部署变得幂等。<a class="ae jk" href="https://www.liquibase.org/" rel="noopener ugc nofollow" target="_blank"> Liquibase </a>还将支持应用团队撤销已部署的变更，或者自动撤销，或者通过定制的回滚SQL。</p><p id="509a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">所有这些将帮助您将数据库代码放入版本控制系统，并为您的应用程序/数据产品实施完整的端到端CI/CD流程，这需要所有代码(我们应用程序的所有组件，包括数据库代码)可用。Liquibase可以帮助处理这种CI/CD管道中数据库模式更改的部署。</strong></p><h1 id="6795" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak"> 2。准备好把手弄脏了吗？</strong></h1><p id="baf0" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it jh kx iw ix ji ky ja jb jj kz je jf jg hb bi translated">开始烹饪前，我们需要配料。以下是我们应该收集的物品清单:</p><ol class=""><li id="c1ad" class="lg lh hi il b im in iq ir jh li ji lj jj lk jg ll lm ln lo bi translated"><strong class="il hj"> Liquibase </strong> —您可以从<a class="ae jk" href="https://www.liquibase.org/download" rel="noopener ugc nofollow" target="_blank">https://www.liquibase.org/download</a>下载并安装liquibase-cli:</li></ol><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es lp"><img src="../Images/38449dce14420c54bfade9bbe4e18bbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*eIdrxeZFhd87DVKU2s-D9A.png"/></div></figure><p id="f2be" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">然而，在我们的演示中，我们将使用普通的Liquibase jar文件，它可以从<a class="ae jk" href="https://mvnrepository.com/artifact/org.liquibase/liquibase-core/4.6.2" rel="noopener ugc nofollow" target="_blank">https://mvnrepository . com/artifact/org . liqui base/liqui base-core/4 . 6 . 2</a>下载</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es lq"><img src="../Images/f9e8947e0f5faaaa14a11608ea608194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oyo3uspVWDBL-6pNyamiKw.png"/></div></div></figure><p id="cb8d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">在我们的工作目录中有<strong class="il hj">liqui base-core-4 . 6 . 2 . jar</strong>jar文件将满足第一个要求。</p><p id="3d20" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj"> 2。BigQuery的JDBC驱动程序</strong></p><p id="915f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">您还需要BigQuery的JDBC驱动程序。BigQuery文档会将您重定向到可以下载受支持的JDBC/ODBC驱动程序的位置:</p><div class="lr ls ez fb lt lu"><a href="https://cloud.google.com/bigquery/docs/reference/odbc-jdbc-drivers" rel="noopener  ugc nofollow" target="_blank"><div class="lv ab dw"><div class="lw ab lx cl cj ly"><h2 class="bd hj fi z dy lz ea eb ma ed ef hh bi translated">BigQuery |谷歌云的ODBC和JDBC驱动程序</h2><div class="mb l"><h3 class="bd b fi z dy lz ea eb ma ed ef dx translated">Google与Magnitude Simba合作提供ODBC和JDBC驱动程序，这些驱动程序利用了BigQuery的强大功能…</h3></div><div class="mc l"><p class="bd b fp z dy lz ea eb ma ed ef dx translated">cloud.google.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi jv lu"/></div></div></a></div><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es mj"><img src="../Images/8bd8f1ad43a1b41a192d275d84f6f9f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*nbJ6l7xAS51tTQOCJlmPOA.png"/></div></figure><p id="4027" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">点击<strong class="il hj">兼容JDBC 4.2的</strong>开始下载相应的zip文件。当你解压它时，你会发现相当多的jar，其中一个名为GoogleBigQueryJDBC42.jar的jar将代表我们的BigQueryJDBC驱动程序。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es mk"><img src="../Images/d32bfddd69356450c1b2fa28665a27ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jXWAiaxiqhVeTjq1b-PyzQ.png"/></div></div></figure><p id="6538" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">3.BigQuery的Liquibase 扩展</p><p id="4406" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">Liquibase通过所谓的扩展支持不同的数据库。可用扩展的完整列表可以在以下位置找到:<a class="ae jk" href="https://liquibase.jira.com/wiki/spaces/CONTRIB/pages/1998865/Available+Extensions" rel="noopener ugc nofollow" target="_blank">https://liqui base . jira . com/wiki/spaces/CONTRIB/pages/1998865/Available+Extensions</a>。</p><p id="9b0d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">您可能会感到惊讶，BigQuery不在这个列表中。然而，如果你使用谷歌搜索，你会很容易地在Liquibase组织中找到git存储库，它对应于liquibase-bigquery扩展:【https://github.com/liquibase/liquibase-bigquery T2】</p><p id="7a5f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">您应该能够下载与最新版本(<strong class="il hj">liqui base-big query-4 . 7 . 0 . jar</strong>)相对应的jar文件，并将其放入上一步中下载的liquibase-core jar文件旁边的工作目录中。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es ml"><img src="../Images/5936a12b98106f20d24c2ba636e6d342.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NWyC5YpjkxX1W5rEQv0vmQ.png"/></div></div></figure><blockquote class="if ig ih"><p id="d887" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated"><strong class="il hj">liqui base-big query-4 . 7 . 0 . jar</strong>扩展以及打包到BigQuery JDBC zip存档中的所有jar必须位于liquibase-core的java类路径中。然而，将所有这些jar添加到类路径中可能会非常痛苦。为了帮助您完成本教程，而不面临主要的配置问题，我分叉了liquibase-bigquery扩展存储库，并修改了它的打包方式，以便已经包括来自BigQuery JDBC zip的所有jar文件，除了BigQuery JDBC驱动程序(GoogleBigQueryJDBC42.jar)本身。相应的git库可以在<a class="ae jk" href="https://github.com/lolejniczak-shared/liquibase-bigquery" rel="noopener ugc nofollow" target="_blank">https://github.com/lolejniczak-shared/liquibase-bigquery</a>上获得，而生成的名为<strong class="il hj">liqui base-big query-0 . 0 . 1 . jar</strong>的uber-jar文件可以从<a class="ae jk" href="https://github.com/lolejniczak-shared/liquibase-bigquery/releases/download/0.0.1/liquibase-bigquery-0.0.1.jar" rel="noopener ugc nofollow" target="_blank">这里</a>下载:</p></blockquote><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es mm"><img src="../Images/02b76a626142d564a48a1f21a0664002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aqoYunKZGk4LahwFlEYxzA.png"/></div></div></figure><p id="c885" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">在我的演示中，我将使用<strong class="il hj">liqui base-biq query-0 . 0 . 1 . jar</strong>文件，而不是<strong class="il hj">liqui base-big query-4 . 7 . 0 . jar(后者因此不需要继续演示步骤)。</strong></p><p id="206d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">收集完所有三个组件后，工作目录中应该有以下文件:</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es mn"><img src="../Images/1f3637168cf545bfba99d0e912b0e1c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*4qxfAGZRAOoRG6icl4U_uQ.png"/></div></figure><p id="0a7a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">我们准备好出发了。为了更新数据库模式，liquibase使用<strong class="il hj">更新</strong>命令:</p><p id="bb8d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">Java-jar liqui base-core-4 . 6 . 2 . jar—change log file =<db_change_log>—URL =<jdbc_connection_string><strong class="il hj">更新</strong></jdbc_connection_string></db_change_log></p><p id="112a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">changeLogFile是changelog的一个位置，它包含了对BigQuery数据集的所有更改。Liquibase支持XML、YAML、JSON和SQL格式的变更日志。对于前三种格式，liquibase将生成与声明的更改相对应的SQL代码(用于更新和回滚)。在SQL格式中，所有更改都用普通SQL声明。</p><p id="1f95" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">3.1 <strong class="il hj">创建配置文件</strong></p><p id="b34c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">我们将从命令行执行Liquibase，这意味着每次我们想要运行新命令时，我们必须提供代表所有必需的数据库连接细节的命令行参数。这可能是典型错误的来源，并使我们的命令冗长，因此难以处理。</p><p id="e7a4" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">另一种方法是定义名为<strong class="il hj"> liquibase.properties </strong>的基于文本的配置文件，它聚集了所有不经常改变的属性。</p><p id="8379" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">如果您想了解Liquibase配置文件的可能属性，请查看以下链接:</p><p id="1729" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><a class="ae jk" href="https://docs.liquibase.com/workflows/liquibase-community/creating-config-properties.html" rel="noopener ugc nofollow" target="_blank">https://docs . liqui base . com/workflows/liqui base-community/creating-config-properties . html</a></p><p id="574b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">我们的配置文件将包括以下属性:</p></div><div class="ab cl mo mp gp mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hb hc hd he hf"><p id="7a9f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">网址:</strong></p><p id="efd0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">驱动程序:</strong></p><p id="1f6d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">liqui base . liquibaseschemaname:</strong></p><p id="f4c7" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">类路径:</strong></p></div><div class="ab cl mo mp gp mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hb hc hd he hf"><p id="e265" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj"> 3.1.1网址</strong></p><p id="8bf0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">url表示JDBC连接字符串。在官方文档之后，下面是Simba Google BigQuery JDBC连接器的连接URL的格式:</p><p id="7220" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">JDBC:big query://[Host]:[Port]；ProjectId =[Project]；OAuthType =[auth value]；[属性1]=[值1]；[属性2]=[值2]；…</p><p id="d1a9" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">其中:</p><ul class=""><li id="9168" class="lg lh hi il b im in iq ir jh li ji lj jj lk jg mv lm ln lo bi translated">[主机]是服务器的DNS或IP地址。将其设置为<a class="ae jk" href="https://www.googleapis.com/bigquery/v2" rel="noopener ugc nofollow" target="_blank"><strong class="il hj">https://www.googleapis.com/bigquery/v2</strong></a></li><li id="4cb9" class="lg lh hi il b im mw iq mx jh my ji mz jj na jg mv lm ln lo bi translated">[Port]是要连接的TCP端口号。将其设置为<strong class="il hj"> 443。</strong></li><li id="d0b8" class="lg lh hi il b im mw iq mx jh my ji mz jj na jg mv lm ln lo bi translated">[Project]是您的BigQuery项目的id。</li><li id="4f17" class="lg lh hi il b im mw iq mx jh my ji mz jj na jg mv lm ln lo bi translated">[AuthValue]是指定连接器使用的身份验证类型的数字。</li></ul><p id="e5b9" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">Simba Google BigQuery JDBC连接器使用OAuth 2.0协议进行身份验证和授权。它通过Google OAuth APIs验证您的连接。您可以使用以下方法之一配置连接器，以提供您的凭据并验证与数据库的连接:</p><ul class=""><li id="34e4" class="lg lh hi il b im in iq ir jh li ji lj jj lk jg mv lm ln lo bi translated">使用谷歌用户账户</li><li id="7754" class="lg lh hi il b im mw iq mx jh my ji mz jj na jg mv lm ln lo bi translated"><strong class="il hj">使用谷歌服务账户</strong></li><li id="964b" class="lg lh hi il b im mw iq mx jh my ji mz jj na jg mv lm ln lo bi translated">使用预先生成的访问和刷新令牌</li><li id="d1f0" class="lg lh hi il b im mw iq mx jh my ji mz jj na jg mv lm ln lo bi translated">使用应用程序默认凭据</li></ul><p id="362c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">我们将使用Google服务帐户进行身份验证，因此我们需要将<strong class="il hj"> OAuthType属性设置为0 </strong>。我们还必须提供Google服务帐户的电子邮件地址和服务帐户私钥文件的完整路径:</p><p id="1a20" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">JDBC:big query://[Host]:[Port]；ProjectId =[Project]；<strong class="il hj">OAuthType = 0</strong>；OAuthServiceAcctEmail =sa-liquibase@bigquerydemos-337515.iam.gserviceaccount.com；<strong class="il hj">OAuthPvtKeyPath =</strong>saliquibase-2 CAD 75b 60187 . p12；</p><p id="9919" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">[属性1..N]和[值1..N]是连接器支持的附加连接属性。</p><p id="5ea6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">我们将使用连接属性来定义要应用更改的默认BigQuery数据集。</p><p id="22f6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">default dataset = liqui base demo；</strong></p></div><div class="ab cl mo mp gp mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hb hc hd he hf"><p id="d47d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">鉴于上述情况，在我们的演示中，我们将url设置为:</p><p id="9c89" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">JDBC:big query://https://www . Google APIs . com/big query/v2:443；ProjectId = bigquerydemos-337515；OAuthType = 0；OAuthServiceAcctEmail = sa-liqui base @ bigquerydemos-337515 . iam . gserviceaccount . com；OAuthPvtKeyPath = saliquibase-2 CAD 75b 60187 . p12；DefaultDataset = liquibasedemo</p><p id="5bd0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj"> 3.1.2司机</strong></p><p id="273c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">Simba JDBC BigQuery连接器支持以下独立于JDBC版本的全限定类名(FQCNs):<strong class="il hj">com . Simba . Google big query . JDBC . driver</strong></p><p id="14b3" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">3 . 1 . 3 liqui base . liquibaseschemaname</p><p id="1ec9" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">Liquibase模式名称属性将允许用户为Liquibase辅助表指定BigQuery数据集，该表跟踪已经安装了哪些更改集。它不同于DefaultDataset JDBC连接字符串属性，该属性表示我们要在其中安装更改集的BigQuery数据集(如果在更改集定义中未指定)。</p><p id="e1d1" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">我们将该属性设置为:</p><p id="b3bb" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">liqui base . liqui base schemaname:liqui base demo _ aux</strong></p><p id="0050" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj"> 3.1.4 classpath属性</strong>用于指定liquibase将在哪里找到以下jar文件:</p><ul class=""><li id="e77c" class="lg lh hi il b im in iq ir jh li ji lj jj lk jg mv lm ln lo bi translated">BigQuery JBDC驱动程序jar</li><li id="7e06" class="lg lh hi il b im mw iq mx jh my ji mz jj na jg mv lm ln lo bi translated">Liquibase BigQuery扩展jar</li></ul><p id="d85b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">最后，我们的<strong class="il hj"> liquibase.properties </strong>文件将会是这样的:</p></div><div class="ab cl mo mp gp mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hb hc hd he hf"><p id="28e1" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">驱动:</strong>com . Simba . Google big query . JDBC . driver<br/><strong class="il hj">URL:</strong>JDBC:big query://https://www . Google APIs . com/big query/v2:443；ProjectId = bigquerydemos-337515；OAuthType = 0；OAuthServiceAcctEmail = sa-liqui base @ bigquerydemos-337515 . iam . gserviceaccount . com；OAuthPvtKeyPath = saliquibase-2 CAD 75b 60187 . p12；DefaultDataset = liquibasedemo<br/> <strong class="il hj">类路径:</strong>。/simbajdbcdriverforgogooglebigquery 42 _ 1 . 2 . 21 . 1025/googlebigqueryjdbc 42 . jar:。/liqui base-big query-0 . 0 . 1 . jar<br/><strong class="il hj">log level:</strong>DEBUG<br/><strong class="il hj">liqui base . liquibaseschemaname:</strong>liquibasedemo _ aux</p></div><div class="ab cl mo mp gp mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hb hc hd he hf"><p id="6d4e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">此时，我们已经具备了Liquibase能够与BigQuery通信所需的一切。</p><h1 id="b1cf" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">4.演示</h1><p id="2cce" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it jh kx iw ix ji ky ja jb jj kz je jf jg hb bi translated">我们在这里遗漏了最重要的元素，即我们的变更日志文件，它列出了对我们数据集的所有变更(变更集)。</p><p id="ef7e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">让我们建造它！</p><p id="a467" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">假设你是一个新项目的成员，这个项目的目标是建立分析客户满意度的分析能力。您的团队在sprint中工作，第一个sprint的目标是构建代表客户的维度。</p><p id="592b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">您必须了解您的源系统，构建ETL(或ELT)管道，而且您还要设计数据结构来持久存储客户数据。</p><p id="d288" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">冲刺1 </strong></p><p id="62a1" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">Sprint很短，所以您决定有一个名为stg_customer的临时表，最后一个名为dim_customer。</p><p id="64b9" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">现在您需要做的就是将这两个表的定义放入sql文件中。然而，要使这个文件与Liquibase一起工作，您需要用一些元数据来修饰几乎每个DDL，这将把DDL语句变成Liquibase变更集。显然，我们需要记住三件事:</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es nb"><img src="../Images/08f90c692086d23b2ae6e075810b03cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qzhvcx1S0SFz7ssFNwsAng.png"/></div></div></figure><p id="2502" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">来源:<a class="ae jk" href="https://docs.liquibase.com/concepts/changelogs/sql-format.html" rel="noopener ugc nofollow" target="_blank">https://docs . liqui base . com/concepts/changelogs/SQL-format . html</a></p><ol class=""><li id="cdf0" class="lg lh hi il b im in iq ir jh li ji lj jj lk jg ll lm ln lo bi translated"><strong class="il hj">用</strong>开始您的变更日志文件</li></ol><p id="a05b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">— liquibase格式的sql</p><p id="3e92" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj"> 2。单个变更集可以包含任意多的数据集变更</strong>。出于演示的目的，我们将把每个表声明为一个不同的变更集。</p><p id="2bb8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj"> 3。(可选)每个变更集还可能包括任意数字键:值属性、标签和标记</strong>，当将我们的应用程序部署到不同的环境时，它们可以用作过滤器(例如，我们可能需要开发环境中的附加表来进行单元测试等)。)</p><p id="ab76" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">因此，我们的sprint 1的变更日志文件应该是这样的(请注意，每个变更集必须有惟一的标识符。在我们的例子中，我们使用简单的整数，并且对于每个新的变更集v0.0.1: <strong class="il hj"> 1 </strong>，v0.0.1: <strong class="il hj"> 2 </strong> …，递增它。)</p><p id="825c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">— liquibase格式化sql <br/> —变更集v0.0.1:1 ctx:customer <br/>创建表stg _ CUSTOMER(<br/>CUSTOMER _ ID INTEGER，<br/> FIRST_NAME STRING，<br/> LAST_NAME STRING <br/>)</p><p id="566f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">—变更集v0.0.1:2 ctx:customer <br/>创建表dim_customer ( <br/> DWH_UUID字符串，<br/>客户_服务标识整数，<br/>客户_名字字符串，<br/>客户_姓氏字符串<br/>)</p><p id="6d2f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">好了，我们准备好运行更新命令了。这里，我们将假设我们的平台管理员完成了他们的工作，并为我们的应用程序创建了:</p><ul class=""><li id="eb04" class="lg lh hi il b im in iq ir jh li ji lj jj lk jg mv lm ln lo bi translated">我们的模式对象和辅助Liquibase跟踪表的“容器”,即liquibasedemo(在JDBC连接字符串中配置为<strong class="il hj"> DefaultDataset </strong>)和liquibasedemo_aux(用<strong class="il hj">liqui base . liqui base schemaname</strong>属性配置)BigQuery数据集。</li><li id="a447" class="lg lh hi il b im mw iq mx jh my ji mz jj na jg mv lm ln lo bi translated">我们将用来与BigQuery通信的服务帐户。该帐户还应该具有创建和编辑数据集对象所需的权限。</li></ul><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es nc"><img src="../Images/2835ca1675d2fabfe3e3f0ca187952f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zcivWMc_0LWST8FSKVhmyQ.png"/></div></div></figure><p id="c38d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">然后使用您的终端并执行以下命令:</p><p id="4591" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">Java-jar liqui base-core-4 . 6 . 2 . jar—changelolog file changelog . SQL<strong class="il hj">更新</strong></p><blockquote class="if ig ih"><p id="4fc9" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated"><strong class="il hj">该步骤通常是您的应用程序的CICD管道的一部分，而更改日志文件将只是git中版本化的文件之一，以及使您的应用程序/数据产品正常运行所必需的其他内容(例如，对应于ETL/ELT管道的代码等)。</strong></p></blockquote><p id="cdc1" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">当您的命令被执行时，您应该会看到类似这样的内容:</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es nd"><img src="../Images/8635ca5f013abfc0a5dc5d7fcc280715.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NlNXt0aQYJXPwbApjTEDtw.png"/></div></div></figure><p id="c8b7" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">这里需要注意一些事情:</p><ol class=""><li id="8ef6" class="lg lh hi il b im in iq ir jh li ji lj jj lk jg ll lm ln lo bi translated">Liquibase使用liquibasedemo BigQuery数据集作为默认数据集，这符合我们的需求。</li></ol><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es ne"><img src="../Images/011b4cbb6424cc938d22aa0c9c27a204.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*wQzsUBHoYKfKBPD-hvM0-w.png"/></div></figure><p id="10d9" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">2.Liquibase检测到liquibase_aux BigQuery数据集中没有跟踪已安装的更改集所需的辅助表。因此，Liquibase创建了它们:</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es nf"><img src="../Images/66e728ff1d07b41436a363bf283ef2d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*sUHeJD42PttPgMmzm-qQ2A.png"/></div></figure><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es ng"><img src="../Images/5655bb1e5226f1a82d15def2d34507d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y49DfK3G5KSLlICoMRvucQ.png"/></div></div></figure><p id="f579" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">3.Liquibase能够部署我们的变更集:</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es nh"><img src="../Images/913745b63e8d5e94ee59548d56292f4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*8bEmoUHZO6suVNxFpIdi5Q.png"/></div></figure><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es ni"><img src="../Images/4830e540b4940a01a6949e6874ef73c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Hzxw63sH_CguVv_Ar2ksg.png"/></div></div></figure><p id="1a88" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">当我们检查Liquibase DATABASECHANGELOG表时，我们会发现其中有两个新条目:</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es nj"><img src="../Images/aa8d3b4eede663df9a416175c2b7ec30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GMFS0vZJ6tsdHP1Vj6QrQA.png"/></div></div></figure><p id="2965" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">为了显示这些条目的值，让我们再次运行update命令。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es nk"><img src="../Images/b0589a68c2354af67094fa4fbc0183ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ecoIARHIaEgcxLKNGOs4lQ.png"/></div></div></figure><p id="3264" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">Liquibase检查了DATABASECHANGELOG表，并推断所有的更改集都已经安装，因此这里不需要做什么。<strong class="il hj">这意味着得益于Liquibase，我们的部署是幂等的，因此即使您需要重启CI/CD管道，您仍然是安全的，因为Liquibase不会尝试应用已经部署的更改</strong></p><p id="3940" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">冲刺2: </strong></p><p id="e6b3" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">在Sprint 1中，我们让数据分析师能够处理基本的客户数据。例如，他们能够了解有多少顾客购买了他们的产品，这只会刺激更多顾客的欲望。</p><p id="70af" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">在Sprint 2中，他们希望:</p><ul class=""><li id="36cb" class="lg lh hi il b im in iq ir jh li ji lj jj lk jg mv lm ln lo bi translated">了解每天有多少客户注册</li><li id="2a98" class="lg lh hi il b im mw iq mx jh my ji mz jj na jg mv lm ln lo bi translated">能够计算每天登录应用程序的客户数量</li><li id="e93b" class="lg lh hi il b im mw iq mx jh my ji mz jj na jg mv lm ln lo bi translated">有用户定义的功能，计算从上次登录的天数。</li><li id="81d0" class="lg lh hi il b im mw iq mx jh my ji mz jj na jg mv lm ln lo bi translated">除此之外，一位分析师要求添加一个表，他可以在这个表中进行一些试验，并构建支持服务的字典。</li></ul><p id="33c5" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">我们需要做的就是更新我们的changelog文件(新的变更集以粗体显示):</p><p id="bb82" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">— liquibase格式化sql <br/> —变更集v0.0.1:1 ctx:customer <br/>创建表stg _ CUSTOMER(<br/>CUSTOMER _ ID INTEGER，<br/> FIRST_NAME STRING，<br/> LAST_NAME STRING <br/>)</p><p id="c483" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">—变更集v0.0.1:2 ctx:customer <br/>创建表dim_customer ( <br/> DWH_UUID字符串，<br/>客户_服务标识整数，<br/>客户_名字字符串，<br/>客户_姓氏字符串<br/>)</p><p id="b87d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj"> —变更集v 0 . 0 . 2:3 CTX:customer<br/></strong>ALTER TABLE stg _ customer ADD COLUMN REGISTRATION _ DATE DATE；</p><p id="43a7" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj"> —变更集v0.0.2:4 ctx:客户</strong></p><p id="8628" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">ALTER TABLE stg_customer添加列LASTLOGIN _ DATE</p><p id="723a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj"> —变更集v0.0.2:5 ctx:客户</strong></p><p id="d70b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">ALTER TABLE dim_customer ADD列CUSTOMER _ REGISTRATION _ DATE DATE；</p><p id="3ac6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj"> —变更集v0.0.2:6 ctx:客户</strong></p><p id="d009" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">ALTER TABLE dim _ CUSTOMER ADD COLUMN CUSTOMER _ last log in _ DATE；</p><p id="6196" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj"> —变更集v0.0.2:7 ctx:客户</strong></p><p id="a364" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">创建函数udfdaysfromlastlog in(lastLoginDate Date)</p><p id="23c9" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">返回INT64</p><p id="f798" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">AS (DATE_DIFF(CURRENT_DATE()，lastLoginDate，DAY))</p><p id="d292" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj"> —变更集v0.0.2:8 ctx:字典</strong></p><p id="be1e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">创建表ref_services ( <br/> DWH_UUID字符串，<br/>服务名字符串，<br/> SLA十进制<br/>)；</p><p id="805f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">运行update命令后，Liquibase应用了新的更改集。我们有了新的用户定义函数，更新了与客户相关的表定义，以包括新的列…</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es nl"><img src="../Images/88a5e17a8524d30c392d4a8487325403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iPVoFv0bEZHylyuIMewWmQ.png"/></div></div></figure><h1 id="3091" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">总结:</h1><p id="c8f8" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it jh kx iw ix ji ky ja jb jj kz je jf jg hb bi translated">本文解释了如何设置Liquibase，并使用它对BigQuery中的模式更改进行版本控制。将这一步骤嵌入您的CICD管道将有助于标准化和自动化您的数据产品的部署，并缩短价值实现时间。我们介绍了Liquibase的基本功能，还有许多值得一试的功能(例如回滚、从数据库生成更改日志等)。Liquibase BigQuery扩展目前并不支持所有这些功能，因此非常欢迎您将您的拉取请求贡献给<a class="ae jk" href="https://github.com/liquibase/liquibase-bigquery" rel="noopener ugc nofollow" target="_blank"><strong class="il hj">【https://github.com/liquibase/liquibase-bigquery】</strong></a><strong class="il hj">项目。</strong></p><p id="9e85" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">请注意，Liquibase只是BigQuery中模式管理的可能选项之一。其他值得检查的是:</p><ul class=""><li id="a44d" class="lg lh hi il b im in iq ir jh li ji lj jj lk jg mv lm ln lo bi translated">用数据形式进行模式管理(<a class="ae jk" href="https://dataform.co/" rel="noopener ugc nofollow" target="_blank">https://dataform.co/</a>)</li><li id="35dd" class="lg lh hi il b im mw iq mx jh my ji mz jj na jg mv lm ln lo bi translated">使用terraform进行模式管理(<a class="ae jk" href="https://registry.terraform.io/modules/terraform-google-modules/bigquery/google/latest" rel="noopener ugc nofollow" target="_blank">https://registry . terra form . io/modules/terra form-Google-modules/big query/Google/latest</a>)</li><li id="06df" class="lg lh hi il b im mw iq mx jh my ji mz jj na jg mv lm ln lo bi translated">使用BQMan进行模式管理(<a class="ae jk" href="https://github.com/GoogleCloudPlatform/professional-services/tree/main/tools/bqman" rel="noopener ugc nofollow" target="_blank">https://github . com/Google cloud platform/professional-services/tree/main/tools/bq man</a>)</li></ul></div><div class="ab cl mo mp gp mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hb hc hd he hf"><blockquote class="if ig ih"><p id="716e" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated"><strong class="il hj"> <em class="hi">本文由</em> </strong> <a class="ae jk" href="https://www.linkedin.com/in/lukasz-olejniczak-1a75a613/" rel="noopener ugc nofollow" target="_blank"> <strong class="il hj"> <em class="hi">卢卡什</em> </strong> </a> <strong class="il hj"> <em class="hi">和</em></strong><a class="ae jk" href="https://www.linkedin.com/in/stanis%C5%82aw-magierski-1258507/" rel="noopener ugc nofollow" target="_blank"><em class="hi">斯坦尼斯劳【马吉尔斯基】</em>  </a> <strong class="il hj"> <em class="hi">合著。所表达的观点是作者的观点，不一定反映谷歌的观点。</em> </strong></p></blockquote><p id="7756" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">如果你喜欢这篇文章，请为它鼓掌。更多google云端数据科学、数据工程、AI/ML关注我<a class="ae jk" href="https://www.linkedin.com/in/lukasz-olejniczak-1a75a613/" rel="noopener ugc nofollow" target="_blank"><strong class="il hj"><em class="ik">LinkedIn</em></strong></a><strong class="il hj"><em class="ik">。</em>T51】</strong></p></div></div>    
</body>
</html>