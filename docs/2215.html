<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/google-cloud/tutorial-4-setup-web-application-security-protection-and-detection-lab-in-google-cloud-data-ecfb6b1f5053?source=collection_archive---------3-----------------------#2022-06-06">https://medium.com/google-cloud/tutorial-4-setup-web-application-security-protection-and-detection-lab-in-google-cloud-data-ecfb6b1f5053?source=collection_archive---------3-----------------------#2022-06-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="0847" class="hg hh hi bd hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie bi translated">教程4:在Google Cloud中设置Web应用程序安全保护和检测实验室——数据泄露和渗透行动手册</h2><p id="1189" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip hs iq ir is hw it iu iv ia iw ix iy iz hb bi translated">这个实验总共涵盖了4个博客，以下是参考链接</p><p id="8035" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated"><strong class="ih jf"> Part-1 </strong> : <a class="ae jg" rel="noopener" href="/@neelampawar/tutorial-1-setup-web-application-security-protection-and-detection-lab-in-google-cloud-waf-53ae96052301">晶圆调整</a></p><p id="70e7" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated"><strong class="ih jf">第二部</strong> : <a class="ae jg" rel="noopener" href="/@neelampawar/tutorial-2-setup-web-application-security-protection-and-detection-lab-in-google-cloud-2292c14276d0">侦察剧本</a></p><p id="b281" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated"><strong class="ih jf"> Part-3 </strong> : <a class="ae jg" rel="noopener" href="/@neelampawar/tutorial-3-setup-web-application-security-protection-and-detection-lab-in-google-cloud-8d40962dd756">漏洞利用</a></p><p id="3fa1" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated"><strong class="ih jf">第四部分</strong>:数据泄露和泄密(本博客)</p><p id="d6e3" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">这个关于云装甲WAF保护的四部分系列的最后一个教程是数据渗透行动手册。Google cloud WAF安全防护实验室的目的是展示<strong class="ih jf"> Google WAF </strong>在识别和防范针对您的web应用的可疑活动和潜在攻击方面的能力。本行动手册解释了如何测试云装甲WAF对<strong class="ih jf"> SQL注入(SQLi) </strong> <strong class="ih jf">攻击</strong>的防护。</p><p id="9ff1" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">在本教程中，您将:</p><ol class=""><li id="bfd2" class="jh ji hi ih b ii ja im jb hs jj hw jk ia jl iz jm jn jo jp bi translated">模拟直接针对目标OWASP Juice Shop应用程序的SQL注入(SQLi)攻击，然后攻击通过Cloud armor保护的web应用程序的同一个实例。</li><li id="a974" class="jh ji hi ih b ii jq im jr hs js hw jt ia ju iz jm jn jo jp bi translated">观察两种场景中web应用程序行为的差异</li></ol><h1 id="11f3" class="jv hh hi bd hj jw jx jy hn jz ka kb hr kc kd ke hv kf kg kh hz ki kj kk id kl bi translated">配置Burp套件和Firefox</h1><p id="63ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip hs iq ir is hw it iu iv ia iw ix iy iz hb bi translated">在开始之前，请参考之前教程<a class="ae jg" rel="noopener" href="/@neelampawar/tutorial-3-setup-web-application-security-protection-and-detection-lab-in-google-cloud-8d40962dd756">漏洞利用剧本</a>中的<strong class="ih jf">配置Burp套件和Firefox </strong>部分，在Kali虚拟机上设置Burp套件和Firefox web浏览器。</p><h2 id="243d" class="hg hh hi bd hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie bi translated">敏感数据暴露和泄露</h2><p id="1234" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip hs iq ir is hw it iu iv ia iw ix iy iz hb bi translated">在这一阶段，攻击者准备利用他们以前发现、测试和进一步开发的漏洞来实现他们访问和泄露数据的目标。在本行动手册中，我们将执行一次SQL注入攻击，以泄漏OWASP Juice Shop应用程序中所有产品的列表。</p><h2 id="c1ac" class="hg hh hi bd hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie bi translated">对目标Web应用程序执行SQL注入</h2><p id="d474" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip hs iq ir is hw it iu iv ia iw ix iy iz hb bi translated">在本教程中，您将对OWASP Juice Shop应用程序执行两次SQL注入(SQLi)攻击。</p><ol class=""><li id="6c0b" class="jh ji hi ih b ii ja im jb hs jj hw jk ia jl iz jm jn jo jp bi translated"><strong class="ih jf">场景1 </strong>:直接在目标web应用中执行SQL注入</li><li id="ccdd" class="jh ji hi ih b ii jq im jr hs js hw jt ia ju iz jm jn jo jp bi translated"><strong class="ih jf">场景2 </strong>:在Https负载均衡器上受Cloud armor保护的同一个目标web应用中执行相同的注入</li></ol><h2 id="faf1" class="hg hh hi bd hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie bi translated">场景1:在直接进入OWASP Juice Shop应用程序时执行SQL注入</h2><ol class=""><li id="99a7" class="jh ji hi ih b ii ij im in hs km hw kn ia ko iz jm jn jo jp bi translated">使用您的凭据登录Kali虚拟机</li><li id="f393" class="jh ji hi ih b ii jq im jr hs js hw jt ia ju iz jm jn jo jp bi translated">启动Burp Suite并确保您已经按照<a class="ae jg" rel="noopener" href="/@neelampawar/tutorial-3-setup-web-application-security-protection-and-detection-lab-in-google-cloud-8d40962dd756">漏洞利用行动手册</a>的<strong class="ih jf">配置Burp Suite和Firefox </strong>部分所述配置并运行了Burp Suite</li><li id="4209" class="jh ji hi ih b ii jq im jr hs js hw jt ia ju iz jm jn jo jp bi translated">使用Firefox，直接浏览果汁店网站，方法是</li></ol><p id="3cae" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">http:// &lt;<app engine="" public="" ip=""> &gt;:3000</app></p><p id="1d97" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">4.在Burp Suite中，检查<strong class="ih jf">代理→ HTTP历史</strong>选项卡，获取该网站的请求和响应数据</p><p id="dae5" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">5.在Juice Shop网站的搜索栏中，键入“apple ”,并在Burp Suite中检查请求和响应</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es kp"><img src="../Images/76f5bd233ff13bb69821ef2025b84373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VYvqBq9VRY7cfVhI"/></div></div></figure><p id="bb07" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">6.我们看到，在搜索时，客户端连接到<strong class="ih jf"> /rest/products/search </strong>端点</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div class="er es lb"><img src="../Images/e07e111fdb4acad06ded4c601672da17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/0*7sj69kofECf1n6ve"/></div></figure><p id="1a9e" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">7.<strong class="ih jf"> OWASP Juice Shop </strong>应用程序的<strong class="ih jf"> /rest/products/search </strong>端点易受SQL注入攻击。在本教程中，我们将利用此端点中的SQLi漏洞</p><p id="a7c7" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">8.为了利用<strong class="ih jf"> /rest/products/search </strong>端点中的SQLi漏洞，我们将使用Burp Suite的Repeater功能在对此端点的请求中注入一个特制的SQL查询</p><p id="2c05" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">9.为此，右键单击对<strong class="ih jf"> /rest/products/search </strong>端点的GET请求之一，然后单击<strong class="ih jf"> Send to Repeater </strong></p><p id="8973" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated"><strong class="ih jf">图1 —打嗝中继器中的请求</strong></p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es lc"><img src="../Images/1d683cb0e4c2a979a676b063c6f1ed36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_a-8ZV-1rVrI-S5X"/></div></div></figure><p id="be8e" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">10.当准备好执行注入时，我们将复制/粘贴以下编码的SQL查询并将其附加到请求URI <strong class="ih jf"> /rest/products/search？在打嗝重复器窗口中的q= </strong>(作为查询参数的值)</p><p id="b116" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">a.URL编码的SQL查询</p><p id="25d7" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">% 71% 77% 65% 72% 74% 27% 29% 29% 20% 55% 4e % 49% 4f % 4e % 20% 53% 45% 4c % 45% 43% 54% 20% 69% 64% 2c % 20% 65% 6d % 61% 69% 6c % 2c % 20% 70% 61% 73% 73% 77% 6f % 72% 64% 2c % 20% 27% 34%</p><p id="9182" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">11.将编码后的查询附加到请求URI后，作为查询参数的值，单击<strong class="ih jf">Go</strong>T25】(或发送按钮)</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es ld"><img src="../Images/405b2519487eb8bcb5c274c2c7dca52e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ddfzN0x_tsvA16BE"/></div></div></figure><p id="5cd7" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">12.您应该看到来自OWASP Juice Shop应用程序的成功响应，其中包含所有用户的详细信息以及web应用程序公开的他们的详细信息。这表明我们对SQL注入的攻击是成功的</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es le"><img src="../Images/4547a061da816c1accdcf5a78e674ab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hQHH_yooJkEr1my4"/></div></div></figure><p id="cc98" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">JSON数据显示所有产品细节</p><ul class=""><li id="c1f6" class="jh ji hi ih b ii ja im jb hs jj hw jk ia jl iz lf jn jo jp bi translated"><strong class="ih jf">提示</strong>:服务器响应中的“描述”字段中的数据是用户的密码散列，可以使用互联网上的免费工具进行还原</li></ul><h2 id="957b" class="hg hh hi bd hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie bi translated">场景2:通过Cloud armor protected访问OWASP Juice Shop应用程序时执行SQL注入</h2><p id="2c0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip hs iq ir is hw it iu iv ia iw ix iy iz hb bi translated">现在，当您通过Cloud armor安全策略访问OWASP Juice Shop站点时，您将尝试使用相同的查询执行SQL注入。</p><ol class=""><li id="3f2d" class="jh ji hi ih b ii ja im jb hs jj hw jk ia jl iz jm jn jo jp bi translated">在Kali VM上，启动一个新的Burp Suite实例和Firefox浏览器</li><li id="44cb" class="jh ji hi ih b ii jq im jr hs js hw jt ia ju iz jm jn jo jp bi translated">使用Firefox，浏览到https:// &lt;<public ip="" of="" global="" loadbalancer=""> &gt;.nip.io，并在Burp Suite中检查<strong class="ih jf">代理→ HTTP历史</strong>选项卡以获取该网站的请求和响应数据</public></li></ol><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es kp"><img src="../Images/64b414982ce55bafdf0357f640b8f20b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OwGE0TkdU_L46aMd"/></div></div></figure><p id="e5f1" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">3.在搜索栏中搜索“apple”，找到对易受攻击的<strong class="ih jf"> /rest/products/search </strong>端点的请求，并将其发送到Burp中继器</p><p id="2cd6" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated"><strong class="ih jf">打嗝中继器中的请求</strong></p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es lg"><img src="../Images/af4d45e7a369f250aaf8ae07d524dafb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*D4nsBp02enlf13vJ"/></div></div></figure><p id="50a3" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">4.将编码的SQL查询(来自上面场景1中的步骤10)作为值附加到Burp Repeater中的查询参数，然后单击<strong class="ih jf"> Go(或Send) </strong></p><p id="1d75" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">5.在检查响应时，我们发现请求被https负载平衡器上的Cloud Armor阻止了</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es lh"><img src="../Images/77afd7dd057d8b45a5c21563e2627b3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ltfbwx7820w-uR3x"/></div></div></figure><h1 id="741a" class="jv hh hi bd hj jw jx jy hn jz ka kb hr kc kd ke hv kf kg kh hz ki kj kk id kl bi translated">了解发生了什么</h1><p id="bdf0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip hs iq ir is hw it iu iv ia iw ix iy iz hb bi translated">回顾在Juice Shop应用程序的同一个实例中执行SQL注入的两次尝试的HTTP请求和响应，我们看到如下表所示的模式。这清楚地表明，原本可能存储在应用中的潜在恶意有效载荷是不被云装甲安全策略允许通过的</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es li"><img src="../Images/79ebfd1bce5e1e4566483573e15bd1ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zBG8TIk55ONgBu7iJsu0OA.png"/></div></div></figure><h2 id="c2ca" class="hg hh hi bd hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie bi translated">查看日志和指标中的WAF日志</h2><h2 id="6034" class="hg hh hi bd hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie bi translated">转到云装甲安全策略并选择日志记录。它将引导您进入写有查询的日志资源管理器，运行查询。您可以根据需要更改时间窗口。默认情况下，启用6周日志记录数据</h2><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es kp"><img src="../Images/a1bcc1bcc7a9c97915ef1fedc54736fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*G8RUUFgxvnkW7yBG"/></div></div></figure><p id="d92b" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated">打开任意条目并单击展开嵌套字段。它将给出所采取的操作以及策略中的哪个规则拒绝了此请求。</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es kp"><img src="../Images/d963a6e8eb9d14f009de7ddedad01b9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mYBvTkULy_Ze_HiS"/></div></div></figure><h2 id="55d7" class="hg hh hi bd hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie bi translated">关键外卖</h2><p id="4db3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip hs iq ir is hw it iu iv ia iw ix iy iz hb bi translated">SQL注入(SQLi)是最常见的应用程序安全漏洞类型之一，它允许外部对手利用易受攻击的应用程序来泄露应用程序中的敏感信息。</p><p id="c373" class="pw-post-body-paragraph if ig hi ih b ii ja ik il im jb io ip hs jc ir is hw jd iu iv ia je ix iy iz hb bi translated"><strong class="ih jf">对于使用它保护的web应用程序，Cloud armor可以通过其开箱即用的规则集，在网络边缘检测和阻止可疑的SQL查询，从而防范SQL注入(SQLi)攻击。</strong></p></div></div>    
</body>
</html>