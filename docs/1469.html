<html>
<head>
<title>A Look at the Open Source Exposure Notification Reference Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">看一下开源暴露通知参考服务器</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/a-look-at-the-open-source-exposure-notification-reference-server-44fe53f4e8d2?source=collection_archive---------1-----------------------#2020-06-10">https://medium.com/google-cloud/a-look-at-the-open-source-exposure-notification-reference-server-44fe53f4e8d2?source=collection_archive---------1-----------------------#2020-06-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="eba5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今年4月，谷歌和苹果宣布联合开发应用编程接口，利用蓝牙低能耗(ble)技术帮助减少导致新冠肺炎病毒的传播。作为这一更广泛努力的一部分<a class="ae jd" href="https://www.google.com/covid19/exposurenotifications/" rel="noopener ugc nofollow" target="_blank">多种资源</a>已被用于协助卫生保健当局迅速采取行动。例如，Google发布了一个参考Android应用程序、使用暴露通知API的附加服务条款、加密方法的规范等等。我，<a class="ae jd" href="https://github.com/google/exposure-notifications-server/graphs/contributors" rel="noopener ugc nofollow" target="_blank">和谷歌</a>的许多其他人一起，一直在创建一个曝光通知服务器的开源参考实现，并想详细说明这是如何工作的。</p><p id="c714" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与Android和iOS客户端一起工作的参考服务器向实施者展示了如何创作和部署后端，以利用新添加的BLE接口与移动应用程序配对。<a class="ae jd" href="https://github.com/google/exposure-notifications-server" rel="noopener ugc nofollow" target="_blank">参考服务器源代码</a>可在GitHub上与Android应用程序的现有<a class="ae jd" href="https://github.com/google/exposure-notifications-android" rel="noopener ugc nofollow" target="_blank">参考设计一起获得，两者都在Apache 2.0许可下获得许可。</a></p><p id="0359" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参考服务器实施由多个组件组成，这些组件一起用于接受、验证和存储来自经验证的移动设备的临时暴露密钥(tek)。它定期生成并签署增量文件，这些文件稍后将由客户端下载，以执行设备上的密钥匹配算法，该算法确定两个设备是否非常接近。服务器组件是无状态的，因此它们可以根据需求独立扩展。</p><p id="f442" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该存储库还包含一组<a class="ae jd" href="https://github.com/google/exposure-notifications-server/blob/master/docs/deploying.md" rel="noopener ugc nofollow" target="_blank">terra form配置</a>，以便于部署。虽然我们一直在使用Google云服务，但参考服务器通过本机使用Kubernetes或与Anthos结合使用，被设计为与平台无关，因此它可以部署在任何云提供商或内部基础架构上。</p><h2 id="2800" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">服务概述</h2><p id="a614" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">仔细看一下实现，参考服务器由几个高级组件组成。每个组件都是一个Google Cloud Run容器，数据存储在Google Cloud SQL上托管的PostgreSQL数据库中。为了浏览这些组件，我将按照用户交互来分组，从自愿共享临时暴露密钥(tek)开始。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ke"><img src="../Images/7de610c56c462972e80ecf3610378609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VWRi3zvF3lfC7HMh.png"/></div></div></figure><p id="4ca0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kq">曝光通知服务器架构图</em></p><h2 id="723a" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">临时曝光密钥接受</h2><p id="aef5" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">暴露通知服务器的主要工作是接受来自移动设备的确诊用户的tek，通过设备证明API验证来自移动应用的那些密钥，并将那些密钥存储在数据库中。当手机应用程序的用户接受测试并被告知诊断结果为阳性时，他们可以选择通过应用程序共享他们的暴露密钥。当这完成时，服务器接受用户的tek并短时间存储它们，以便其他设备可以下载它们并确认它们是否与这些键进行了交互。</p><h2 id="a39e" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">生成供移动设备下载的批量密钥</h2><p id="0c7a" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">下载TEKs的用户数量将超过上传密钥的用户数量。虽然不是每个用户都需要上传tek，但该应用程序的每个用户都需要接收自愿上传的tek。由于每个用户都将下载完整的tek集，我们可以进一步优化这一流程，以实现更好的规模。</p><p id="1f51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">服务器不是频繁地查询数据库，而是周期性地生成供客户端设备下载的增量文件，以执行在移动设备上运行的密钥匹配算法。增量文件必须用私钥进行数字签名，以便可以验证它们是否来自服务器。相应的公钥被单独推送到移动设备以用于该验证。</p><p id="8cd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参考设计使用CDN进行公钥分发，并由blob存储提供支持，以便更好地扩展。将下载放在CDN后面，而不是通过数据库查询来访问，这大大降低了数据库的负载。</p><h2 id="3918" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">清理旧的临时曝光密钥和批次</h2><p id="aa0d" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">参考服务器的最后一个必要功能是清理陈旧数据。由于该系统的存在有助于通知用户可能暴露于导致新冠肺炎的病毒，因此没有必要长时间维护这些数据。14天后，钥匙和批次被清理。这有几个目的。</p><ol class=""><li id="ba08" class="kr ks hi ih b ii ij im in iq kt iu ku iy kv jc kw kx ky kz bi translated">它确保了即使持有的密钥不能被个人识别，服务器也能保存本服务所需的最少量的信息。</li><li id="a99a" class="kr ks hi ih b ii la im lb iq lc iu ld iy le jc kw kx ky kz bi translated">它有助于控制数据的总体大小。随着时间的推移，这应该有助于保持查询性能和所需的存储相当一致。</li></ol><h2 id="e7ef" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">附加组件和增强功能</h2><p id="842e" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">我们使用参考服务器的目标是为卫生当局提供一个起点。虽然参考服务器本身是一个完整的实现，但我们小心地使其易于扩展。事实上，已经存在许多组件的附加提供者。例如，如果您无法使用Google Cloud services，如Google Cloud Storage，<a class="ae jd" href="https://github.com/google/exposure-notifications-server/blob/master/internal/storage/filesystem_storage.go" rel="noopener ugc nofollow" target="_blank">会提供blob存储接口的附加实现</a>。</p><h2 id="410b" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">验证阳性诊断</h2><p id="e451" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">当前的暴露通知服务器发布协议不验证请求。为确保请求来自已暴露的个人，应使用验证服务器来证明诊断来自管辖区内的公共卫生机构。虽然我们还没有公布验证测试的参考资料，但可以在<a class="ae jd" href="https://github.com/google/exposure-notifications-server/blob/master/docs/design/verification_protocol.md" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>中找到设计和协议。</p><h2 id="10bf" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">部署秘密管理</h2><p id="9092" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">虽然tek是匿名的，但是仍然需要秘密来操作暴露服务，例如控制数据库访问、提供授权凭证以及管理用于签名下载内容的私钥。</p><p id="a89b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这不是必需的，但强烈建议这样做。默认情况下，我们利用谷歌云秘密管理器。参考服务器包括额外的<a class="ae jd" href="https://github.com/google/exposure-notifications-server/tree/master/internal/secrets" rel="noopener ugc nofollow" target="_blank">秘密管理系统</a>的实现。</p><h2 id="170b" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">联盟</h2><p id="511e" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">我们投入时间的另外一个组件是联合的概念。很有可能，邻近的卫生保健当局可能希望共享他们从用户那里收集的tek。</p><p id="03d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，想象一组相邻的州、省或国家，它们之间的旅行很常见。通过共享TEKs，它让用户更好地理解他们的交互。虽然这在人们不跨越司法管辖区的环境中是不必要的，但至少在某种程度上，这是许多人不旅行所不可避免的。</p><h2 id="8614" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">作为一个全球社区走到一起</h2><p id="18e9" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">从来没有像现在这样重要的时刻来作为一个全球社区走到一起。这就是为什么我们将这种保护隐私的服务器实现提供给卫生当局、政府、审计人员和研究人员。在发布这个开源代码的过程中，我们的目标是让开发人员能够利用这个参考实现快速入门，并减缓新冠肺炎的传播。工作仍在进行中，并正在添加更多的功能。随着这项工作的继续发展，您可以<a class="ae jd" href="https://github.com/google/exposure-notifications-server/" rel="noopener ugc nofollow" target="_blank">跟踪项目</a>并阅读<a class="ae jd" href="https://google.github.io/exposure-notifications-server" rel="noopener ugc nofollow" target="_blank">参考文档</a>以获取最新信息。</p><p id="9122" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kq">原载于2020年6月10日</em><a class="ae jd" href="https://chriswilcox.dev/blog/2020/06/10/A-look-at-the-open-source-Exposure-Notification-reference-server.html" rel="noopener ugc nofollow" target="_blank"><em class="kq">https://chriswilcox . dev</em></a><em class="kq"/></p></div></div>    
</body>
</html>