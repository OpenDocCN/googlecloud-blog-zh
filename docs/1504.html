<html>
<head>
<title>Migrating a cPanel Web Hosting Server to Google Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将cPanel Web托管服务器迁移到Google Cloud</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/migrating-a-cpanel-web-hosting-server-to-google-cloud-acdcf7c95768?source=collection_archive---------0-----------------------#2020-07-09">https://medium.com/google-cloud/migrating-a-cpanel-web-hosting-server-to-google-cloud-acdcf7c95768?source=collection_archive---------0-----------------------#2020-07-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4c76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">使用Google云存储、Google计算引擎和云DNS从旧的cPanel托管服务器托管静态和动态网站。</em></p><p id="634d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将展示如何将cPanel服务器上的静态网站和动态应用程序迁移到谷歌云平台(GCP)。我的目标是降低我的个人托管成本，将网站迁移到一个安全、更新的环境中，并从我目前的Linode cPanel VPS迁移到GCP。</p><h1 id="b961" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">盘货</h1><p id="b28a" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">因为从cPanel迁移通常是一项手动任务，所以我将关注域public_html目录，并手动迁移任何数据库。在这一步，我将决定哪些留下，哪些离开。在我的源cPanel服务器上，我将查找所有活动的域。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="3694" class="kq jf hi km b fi kr ks l kt ku">cat /etc/userdomains<br/>&lt;lines intentionally omitted&gt;</span><span id="4399" class="kq jf hi km b fi kv ks l kt ku">ls -al<br/>&lt;lines intentionally omitted&gt;<br/></span><span id="c9d9" class="kq jf hi km b fi kv ks l kt ku">mysql&gt; show databases;<br/>&lt;lines intentionally omitted&gt;</span></pre><p id="f9b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在是开始考虑关闭网站或者你可以存档和停止的好时机。就我而言，这些网站都没有产生任何收入，但它们是我拥有多年的网站，我还不准备摆脱它们。</p><h1 id="8c9c" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">确定迁移的目的地、服务和优先级</h1><p id="698e" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">这个练习可以帮助您确定迁移的优先级和组织迁移。我正在评估这些网站的用途，确定我想保留的网站，以及它们最适合GCP的什么地方。我使用了如下所示的模板来帮助我完成并规划我的迁移:</p><figure class="kh ki kj kk fd kx er es paragraph-image"><div class="er es kw"><img src="../Images/efdf59b31c3a90e575014115e83879f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*D889dloMRANkW9D-lwialQ.png"/></div></figure><h1 id="d192" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">源服务器准备</h1><h2 id="b3a1" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">gcloud SDK安装在源cPanel服务器上</h2><p id="1c84" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我将使用Google Cloud SDK安全地传输文件，所以首先我需要在我的源cPanel服务器上安装SDK。<br/> <a class="ae ln" href="https://cloud.google.com/sdk/install" rel="noopener ugc nofollow" target="_blank">安装谷歌云SDK </a>。</p><p id="71de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在安装过时的cPanel服务器和gcloud SDK时遇到了一些问题。由于gcloud SDK需要Python 2.7或3+版本，而我只有2.6版本，所以我必须修复以下问题:</p><p id="2165" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">过时的python (2.6) <br/> </strong>修复:<a class="ae ln" href="https://tecadmin.net/install-python-2-7-on-centos-rhel/" rel="noopener ugc nofollow" target="_blank">安装python27 </a></p><p id="201a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">无法gcloud auth登录sqlite的问题</strong></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="bdc6" class="kq jf hi km b fi kr ks l kt ku">gcloud auth login<br/>Go to the following link in your browser:</span><span id="7d15" class="kq jf hi km b fi kv ks l kt ku">&lt;omitted&gt;</span><span id="98a8" class="kq jf hi km b fi kv ks l kt ku">Enter verification code:</span><span id="6352" class="kq jf hi km b fi kv ks l kt ku">&lt;omitted&gt;</span><span id="9d0e" class="kq jf hi km b fi kv ks l kt ku">ERROR: gcloud crashed (OperationalError): unable to open database file</span></pre><p id="0069" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">修复:<a class="ae ln" href="https://stackoverflow.com/questions/48349205/how-to-install-sqlite3-for-python-2-7-if-not-installed-by-default" rel="noopener ugc nofollow" target="_blank">安装sqlite并重新编译python2.7 </a></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="10f3" class="kq jf hi km b fi kr ks l kt ku">yum install sqlite-devel<br/>cd /usr/src/Python-2.7.18</span><span id="0e71" class="kq jf hi km b fi kv ks l kt ku">./configure — prefix=/usr/local/bin; make; make install</span></pre><p id="1545" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的python2.7位于/usr/local/bin中</p><p id="b121" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">设置env变量，让cloud SDK知道Python 2.7的位置</strong></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="63ee" class="kq jf hi km b fi kr ks l kt ku">export CLOUDSDK_PYTHON=/usr/local/bin/python2.7</span></pre><p id="6a0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">修复上述问题后，我能够成功地通过gcloud auth登录和gcloud init对GCP进行身份验证，并选择我要用于此次迁移的项目。</p><h1 id="6959" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">检查源服务器目录</h1><p id="f4df" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">因为我只从我的Linode cPanel服务器转移了6个站点，所以我可以很容易地检查每个主目录，看看我在处理什么。我将首先检查public_html目录有多大，如果有什么我可以清除的，以使传输更快。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="f5b4" class="kq jf hi km b fi kr ks l kt ku">du -sh<br/>166M .</span></pre><p id="7981" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我正在寻找任何是GBs+的，可能需要一段时间来转移。</p><h1 id="4e70" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">现场验证</h1><p id="a77f" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">对于我们计划在谷歌云存储桶上托管的每个网站，我需要通过修改DNS区域来验证域所有权。如果在创建名为bucket的域之前没有验证您的域，您将收到以下错误:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="9e08" class="kq jf hi km b fi kr ks l kt ku">gsutil mb gs://www.jordanaandmike.us<br/>Creating gs://www.jordanaandmike.us/...</span><span id="ab7c" class="kq jf hi km b fi kv ks l kt ku">AccessDeniedException: 403 The bucket you tried to create requires domain ownership verification. Please see <a class="ae ln" href="https://cloud.google.com/storage/docs/naming?hl=en#verification" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/storage/docs/naming?hl=en#verification</a> for more details.</span></pre><p id="b305" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">遵循此处的文档<a class="ae ln" href="https://cloud.google.com/storage/docs/domain-name-verification" rel="noopener ugc nofollow" target="_blank">域名桶验证</a>。您可以提前或在迁移过程中完成这项工作。如果您以前从未这样做过，您需要访问您的域名的DNS托管位置来添加TXT记录，或者您需要将文件上传到根目录。</p><p id="2386" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你打算在谷歌服务中使用域名，请确保你是<a class="ae ln" href="https://www.google.com/webmasters/verification/home?hl=en" rel="noopener ugc nofollow" target="_blank">网站管理员中心</a>的网站所有者。在您通过HTML文件上传或TXT文件DNS区域编辑验证您的域名后，您可以将该域名用于Google服务，如云存储。</p><p id="e239" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您正在使用名称服务器(可能当前指向cPanel服务器)，您将需要将DNS服务器设置从自定义更改为注册服务器，以便您可以修改DNS区域或修改托管服务器上的区域。</p><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lo"><img src="../Images/9c611cfd89979c70b322467fd7a3aff0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X6y-HIKOp7SLKXcJ"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated"><em class="lx">将网站从自定义域名服务器改为注册域名服务器，该网站将托管在谷歌云存储桶上，这样我就可以修改DNS区域</em></figcaption></figure><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es ly"><img src="../Images/8dab3ea4967a2dd10e07b46904ddfaee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VY6YKYxxCogtryWQ"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">这里是您验证域名所有权的替代选项。推荐的方法是HTML文件上传。我将在我的域名提供商处选择TXT记录编辑，因为我已经更新了DNS区域以指向云存储。</figcaption></figure><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lz"><img src="../Images/c385a3a682acd1148468c48df5946d3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oc16dXdqRLEYCvLp"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated"><em class="lx">用TXT DNS主机记录验证我的域名</em></figcaption></figure><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es ma"><img src="../Images/295a6a3cd53f102bf2aca808ea434a45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*G7QzI05tJ41Ea_Ot"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated"><em class="lx">在我的注册处设置用于谷歌域名验证的TXT记录</em></figcaption></figure><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mb"><img src="../Images/308abe5ac8614dc5351589e3b08fbe7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JkMyqGLHiivR5rV8"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated"><em class="lx">确认TXT记录后，您将收到如下消息。现在你可以用谷歌服务来使用你的域名了。</em></figcaption></figure><h1 id="7933" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">为您的迁移打开的选项卡/会话</h1><ol class=""><li id="8f26" class="mc md hi ih b ii kc im kd iq me iu mf iy mg jc mh mi mj mk bi translated">你的注册商(在我的情况下是eNom)对你来说可能是name price，Godaddy等</li><li id="efbd" class="mc md hi ih b ii ml im mm iq mn iu mo iy mp jc mh mi mj mk bi translated"><a class="ae ln" href="https://www.google.com/webmasters/verification/home?hl=en&amp;authuser=1" rel="noopener ugc nofollow" target="_blank">谷歌站长中心</a></li><li id="121e" class="mc md hi ih b ii ml im mm iq mn iu mo iy mp jc mh mi mj mk bi translated"><a class="ae ln" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云控制台</a>和云壳</li><li id="d46f" class="mc md hi ih b ii ml im mm iq mn iu mo iy mp jc mh mi mj mk bi translated">到源cPanel服务器的SSH会话</li></ol><h1 id="2e73" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">将静态网站迁移到谷歌云存储</h1><h2 id="0bb2" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">环境差异和限制</h2><p id="78c6" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">谷歌云存储桶是静态基本HTML网站的一个很好的解决方案，因为它的低成本和轻松扩展。请注意，您正在将web服务器上的托管网站转移到Google云存储服务中。我注意到一些不同的事情:</p><p id="e1d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">问题</strong>:没有HTTPS支持</p><p id="9380" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">解决方案</strong>:云存储只支持通过CNAME的HTTP。如果你想通过HTTPS为你提供内容，你需要使用负载均衡器或者使用Firebase主机而不是云存储。</p><p id="2d93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">问题</strong> : Web服务器可以在没有索引页面的情况下提供目录内容，例如:<a class="ae ln" href="http://www.website.com/files/" rel="noopener ugc nofollow" target="_blank">www.website.com/files/</a>会从Web服务器返回一个页面，列出/files/中的所有文件。</p><p id="2550" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，其中之一:</p><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mq"><img src="../Images/e236973add5bbd04a3fc311de6c54740.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FB3qUq1X2nUiVL8l"/></div></div></figure><p id="5127" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">云存储不支持公共目录列表。</p><p id="7f85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">解决方案</strong>:我发现的所有目录列表脚本都是用PHP编写的，它们不能使用GCS托管。请改用云存储浏览器来浏览您的文件。</p><p id="ffe9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">解决方案二</strong>:使用<a class="ae ln" href="https://cloud.google.com/storage/docs/gcs-fuse" rel="noopener ugc nofollow" target="_blank">云存储Fuse </a>挂载你的桶作为文件系统浏览你的文件。现在，您可以在本地查看/上传/下载bucket中的文件，而不是通过web服务器目录。</p><p id="e5b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">PHP和动态网站将需要在谷歌云服务与网络服务器托管。</p><p id="cf58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从一个优先级较低的非关键域开始迁移会让您熟悉迁移过程。由于我的6个域中有5个我计划登陆谷歌云存储，我将先测试移动一个静态站点。我将使用这个文档<a class="ae ln" href="https://cloud.google.com/storage/docs/hosting-static-website" rel="noopener ugc nofollow" target="_blank">托管一个静态网站</a>。</p><h1 id="b99f" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">静态网站向云存储的转移过程</h1><h2 id="946c" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">1: DNS配置—将我的注册服务商托管的DNS区域指向云存储</h2><p id="1962" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">根据站点的重要程度，您可能希望先设置云存储空间并移动文件。在企业/商业环境中，您可能会首先移动文件。我将遵循本演练的文档，因为我要移动的站点是低优先级的。</p><p id="c076" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为您的域名在注册域名系统区域创建一个CNAME，指向c.storage.googleapis.com。</p><p id="61b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以我的一个域名为例:<br/>主机名:<a class="ae ln" href="http://www.jordanaandmike.us" rel="noopener ugc nofollow" target="_blank">www . jordanaandmike . us</a><br/>记录类型:c.storage.googleapis.com<br/>地址:CNAME。</p><p id="75f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是我的DNS区域在CNAME更新、URL重定向(针对根域)和域所有权TXT记录添加验证后的样子。</p><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mr"><img src="../Images/4ab28b41bb0f79b34bec1224497ed1fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Nai03Fo8Hp0bcw1G"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">我的注册商的DNS配置指向云存储</figcaption></figure><p id="73c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:您的域名需要www主机CNAME和URL重定向才能通过<a class="ae ln" href="http://www.yourdomain.com" rel="noopener ugc nofollow" target="_blank">www.yourdomain.com</a>(CNAME)和yourdomain.com(URL重定向)进行解析。如果您希望根域解析(非www，仅domain.com ),请确保您设置了根域别名，有时也称为名称或别名。更多关于根域和CNAME的可爱文章来自<a class="ms mt ge" href="https://medium.com/u/7ca0743c1c3b?source=post_page-----acdcf7c95768--------------------------------" rel="noopener" target="_blank">多米尼克·弗雷泽</a>T4。</p><h2 id="bff0" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">2.为匹配CNAME主机名的站点创建一个存储桶。</h2><p id="1c73" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">假设您已经验证了您的域名，您可以创建一个域名存储桶。如果没有，请遵循此处的<a class="ae ln" href="https://cloud.google.com/storage/docs/domain-name-verification?hl=en#verification" rel="noopener ugc nofollow" target="_blank">域名所有权验证文档。</a></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="4793" class="kq jf hi km b fi kr ks l kt ku">gsutil mb gs://www.jordanaandmike.us<br/>Creating gs://www.jordanaandmike.us/...</span></pre><h2 id="cfa3" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">3.复制网站文件和目录</h2><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="fd7d" class="kq jf hi km b fi kr ks l kt ku">gsutil rsync -R . gs://<a class="ae ln" href="http://www.jordanaandmike.us" rel="noopener ugc nofollow" target="_blank">www.jordanaandmike.us</a></span></pre><h2 id="479c" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">4.使文件可公开访问</h2><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="aff5" class="kq jf hi km b fi kr ks l kt ku"> gsutil iam ch allUsers:objectViewer gs://<a class="ae ln" href="http://www.jordanaandmike.us" rel="noopener ugc nofollow" target="_blank">www.jordanaandmike.us</a></span></pre><h2 id="e886" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">5.设置主页后缀和404页</h2><p id="3218" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">这部分设置您的索引页面文件，以及当有人到达域名时提供什么。如果没有这个gsutil web set命令，访问域时将只返回一个xml文件。我们还将设置404页面，以备找不到页面时使用。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="b0cb" class="kq jf hi km b fi kr ks l kt ku">gsutil web set -m index.html -e 404.html gs://www.jordanaandmike.us<br/>Setting website configuration on gs://www.jordanaandmike.us/...</span></pre><h2 id="f10b" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">6.请稍等片刻，等待DNS传播。这可能需要几分钟到几个小时。</h2><h2 id="5db5" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">7.使用您最喜欢的dns查找工具验证您的DNS更改是否已传播。G Suite工具箱中有一个dig工具来验证您的更改。</h2><p id="f604" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated"><a class="ae ln" href="https://toolbox.googleapps.com/apps/dig/#CNAME/" rel="noopener ugc nofollow" target="_blank">https://toolbox.googleapps.com/apps/dig/#CNAME/</a></p><p id="f30d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果在您这边没有看到变化，请检查另一个工作站/位置。不要惊慌，给它时间。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="c393" class="kq jf hi km b fi kr ks l kt ku">ping jordanaandmike.us<br/>PING jordanaandmike.us (98.124.199.121) 56(84) bytes of data.</span><span id="2c31" class="kq jf hi km b fi kv ks l kt ku">64 bytes from 98.124.199.121 (98.124.199.121): icmp_seq=1 ttl=231 time=91.6 ms</span></pre><h2 id="6096" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">8.检查您的域，验证它从云存储中加载正常</h2><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lz"><img src="../Images/1250840663dbecee95bb17dbb8589b7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8ncPciML0ndDBCUp"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">我美丽婚礼的网站托管在谷歌云存储上</figcaption></figure><p id="b50b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通读<a class="ae ln" href="https://cloud.google.com/storage/docs/static-website#top_of_page" rel="noopener ugc nofollow" target="_blank">静态网站示例和提示</a>了解更多配置选项。</p><p id="81df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，云存储会缓存文件，因此如果您在html页面上进行快速更改，可能需要一些时间来反映这些更改。</p><h2 id="7dce" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">9.清理源服务器</h2><p id="4a7f" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">一旦域解析为云存储，使用cPanel script /script/removeacct用户名删除源服务器上的帐户。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="6296" class="kq jf hi km b fi kr ks l kt ku">/scripts/removeacct jordanaandmike<br/>Are you sure you want to remove the account “jordanaandmike”, and DNS zone files for the user? [y/N]? y</span><span id="7eb6" class="kq jf hi km b fi kv ks l kt ku">Running pre removal script (/usr/local/cpanel/scripts/prekillacct)……Done</span><span id="86a4" class="kq jf hi km b fi kv ks l kt ku">Collecting Domain Name and IP……Done</span><span id="8d37" class="kq jf hi km b fi kv ks l kt ku">Locking account and setting shell to nologin……Done</span><span id="8985" class="kq jf hi km b fi kv ks l kt ku">Killing all processes owned by user……Done</span><span id="172f" class="kq jf hi km b fi kv ks l kt ku">Removing Sessions………Done</span><span id="d99b" class="kq jf hi km b fi kv ks l kt ku">Removing Suspended Info………Done</span></pre><p id="55b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将为谷歌云存储计划的其他域重复步骤1-9。</p><h1 id="2255" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">将动态网站和应用迁移到计算引擎</h1><p id="17e3" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">所以我的目标是以尽可能低的成本将我的cPanel服务器迁移到Google Cloud。对于我的php低流量网站，我将转移到计算引擎实例上的web服务器和mysql服务器。我可以在云SQL等其他服务上托管数据库，但我希望成本尽可能低。</p><h2 id="410b" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">制作转移的暂存桶</h2><p id="c156" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我会把GCS作为我转移的集结地。因此，我将从源-&gt; GCS -&gt;目的地进行传输。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="80b1" class="kq jf hi km b fi kr ks l kt ku">gsutil mb gs://virtualgoldstar<br/>Creating gs://virtualgoldstar/…</span></pre><p id="b6e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，我在这里没有创建域名bucket(就像我对静态站点所做的那样),因为我只是在两次转移之间将域名作为中间层转移到GCS。我可以用SFTP或者其他方式转会，但是因为我已经用了GCS，我想我会继续。此外，这还会给我一个网站的备份，我可以把它放在冷线存储层，并支付一年的费用。</p><h2 id="bf31" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">将文件从源复制到暂存桶</h2><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="9dd8" class="kq jf hi km b fi kr ks l kt ku">gsutil rsync -R . gs://virtualgoldstar<br/>Operation completed over 1.5k objects/103.8 MiB.</span></pre><p id="1800" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">备份源数据库并复制到暂存桶</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="931e" class="kq jf hi km b fi kr ks l kt ku">mysqldump virtual_funingimage &gt; virtual_funingimage.sql<br/>gsutil cp virtual_funingimage.sql gs://virtualgoldstar<br/>Copying file://virtual_funingimage.sql [Content-Type=text/x-sql]…<br/>/ [1 files][ 84.3 KiB/ 84.3 KiB]<br/>Operation completed over 1 objects/84.3 KiB.</span></pre><h2 id="8d54" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">设置目标服务器</h2><p id="cb96" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我将使用<a class="ae ln" href="https://console.cloud.google.com/marketplace/details/click-to-deploy-images/lamp?q=lamp%20stack&amp;id=5416d651-ffa7-4d30-ac18-06be7dba905e&amp;project=mike-kahn-personal&amp;authuser=1&amp;cloudshell=true" rel="noopener ugc nofollow" target="_blank"> LAMP stack Google click来部署图像</a>,因为它将预先配置好我需要的一切并准备就绪。这是谷歌从市场上点击部署图像，所以我可以信任它。</p><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mu"><img src="../Images/543b31abc1f7b1e73b2f57dc5aa2bc3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*C-Rd9znHoS_RaQTa"/></div></div></figure><h2 id="a82f" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">将文件从我的暂存桶复制到目标服务器</h2><p id="99bd" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在这个debian映像中，httpd根目录是/var/www/html/</p><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mv"><img src="../Images/63375769450ea94afd6d991f70ac63ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IwU0RqyyXIm86Gkb"/></div></div></figure><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="fc23" class="kq jf hi km b fi kr ks l kt ku">sudo gsutil cp -r gs://virtualgoldstar/* /var/www/html/</span></pre><p id="aa2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保在您的bucket名称后面添加一个*来将文件复制到您的源目录。如果您不使用*号，它将创建一个带有bucket名称的目录，您必须手动移动所有文件和目录。</p><h2 id="31fa" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">创建数据库、数据库用户、授予权限和导入数据库</h2><p id="e6a6" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">LAMP Google click to deploy image的mysql root密码可以在Google Cloud控制台的<a class="ae ln" href="https://console.cloud.google.com/dm/deployments" rel="noopener ugc nofollow" target="_blank">部署管理器部署</a>中找到。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="45fe" class="kq jf hi km b fi kr ks l kt ku">sudo mysql -u root -p<br/>mysql&gt; CREATE DATABASE virtual_funingimage;<br/>Query OK, 1 row affected (0.00 sec)<br/>mysql&gt; CREATE USER ‘virtual_root’@’localhost’ IDENTIFIED BY ‘password’;<br/>mysql&gt; GRANT ALL PRIVILEGES ON * . * TO ‘virtual_root’@’localhost’;<br/>Query OK, 0 rows affected (0.00 sec)<br/></span><span id="9f9e" class="kq jf hi km b fi kv ks l kt ku">mysql -u root -p virtual_funingimage &lt; virtual_funingimage.sql<br/>Enter password:<br/>$</span></pre><h2 id="393d" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">与我的目标服务器php配置战斗了一天</h2><p id="ddfb" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">所以我的源服务器是php5.4，而我的目标服务器是php7。我想移动的网站不能在php7上运行，需要做很多改动才能运行。我是一个不错的系统管理员，但不是一个不错的php开发人员。我现在正处于十字路口——我可以修改我的php7网站代码，或者降级我的Debian click上的默认php版本，以部署LAMP server并让php5启动和运行。因为我试图在尽可能短的时间和成本内完成这项工作，所以我将在我的目标服务器上运行php5.6，即使它已经停产。我知道这样做的风险，也知道这样做是为了让我的网站尽快运行起来。</p><p id="4e02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我关注了<a class="ae ln" href="https://cloudwafer.com/blog/installing-multiple-versions-of-php-on-debian/" rel="noopener ugc nofollow" target="_blank">这篇关于<a class="ae ln" href="https://cloudwafer.com/blog/installing-multiple-versions-of-php-on-debian/" rel="noopener ugc nofollow" target="_blank">如何在Debian </a>上运行多个php版本的</a> <a class="ms mt ge" href="https://medium.com/u/5113fa353dc2?source=post_page-----acdcf7c95768--------------------------------" rel="noopener" target="_blank"> Cloudwafer </a>文章。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="0efd" class="kq jf hi km b fi kr ks l kt ku">php -v<br/>PHP 5.6.40–29+0~20200514.35+debian9~1.gbpcc49a4 (cli)<br/>Copyright © 1997–2016 The PHP Group<br/>Zend Engine v2.6.0, Copyright © 1998–2016 Zend Technologies</span></pre><p id="621a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的目标服务器上降级php后，我仍然无法加载php页面。</p><p id="5af4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查/var/log/apache2/error.log和GCP日志中的apache2错误日志，每当试图加载php页面时，我总是看到分段错误:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="e44f" class="kq jf hi km b fi kr ks l kt ku">[Tue Jun 09 13:01:22.821130 2020] [core:notice] [pid 25665] AH00052: child pid 25667 exit signal Segmentation fault (11)</span><span id="1f0e" class="kq jf hi km b fi kv ks l kt ku">[Tue Jun 09 13:01:22.822031 2020] [core:notice] [pid 25665] AH00052: child pid 25668 exit signal Segmentation fault (11)</span></pre><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lz"><img src="../Images/12745b099b2853c7d8f1ed9d1768a3b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yOevnyqleRN53xJM"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">云控制台日志中的Apache错误日志</figcaption></figure><p id="8749" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在搜索之后，php中的分段错误通常与php模块有关。所以我决定最好比较一下我的源和目的地的php模块和php.ini设置。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="af7a" class="kq jf hi km b fi kr ks l kt ku">php -m<br/>[PHP Modules]<br/>bcmath<br/>calendar<br/>Core<br/>ctype<br/>curl<br/>date<br/>dom<br/>ereg<br/>filter<br/>ftp<br/>...</span></pre><p id="dfd3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在Google sheets中快速比较了我的源和目的地的php -m输出:</p><figure class="kh ki kj kk fd kx er es paragraph-image"><div class="er es mw"><img src="../Images/ae68d84d3962a8dc60121d126d66ccbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/0*GCPKfjqEMwZFyq4A"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated"><em class="lx">比较我的源服务器和目的服务器中的php模块</em></figcaption></figure><p id="fcfb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用phpdismod，我删除了不在我的源服务器上的所有模块:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="9435" class="kq jf hi km b fi kr ks l kt ku">sudo phpdismod exif fileinfo gettext igbinary imagick memcached mhash msgpack mysqli pcntl PDO pdo_mysql pdo_sqlite readline shmop sysvmsg sysvsem sysvshm wddx xdebug xsl Zend Opcache</span></pre><p id="c33a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在确保php -m在我的源和目标上匹配之后，我继续监控error_log并进行故障排除。我正准备用这篇文章回到php7并修改我的应用程序代码，然后在试图禁用php5.6时遇到了这个错误:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="eba4" class="kq jf hi km b fi kr ks l kt ku">sudo a2dismod php5.6<br/>Module php5.6 disabled.<br/>Processing triggers for systemd (232–25+deb9u12) …<br/>Processing triggers for php5.6-fpm (5.6.40–29+0~20200514.35+debian9~1.gbpcc49a4) …<br/>NOTICE: Not enabling PHP 5.6 FPM by default.<br/>NOTICE: To enable PHP 5.6 FPM in Apache2 do:<br/>NOTICE: a2enmod proxy_fcgi setenvif<br/>NOTICE: a2enconf php5.6-fpm<br/>NOTICE: You are seeing this message because you have apache2 package installed.</span><span id="2c71" class="kq jf hi km b fi kv ks l kt ku">sudo a2enmod proxy_fcgi setenvif<br/>Considering dependency proxy for proxy_fcgi:<br/>Enabling module proxy.<br/>Enabling module proxy_fcgi.<br/>Module setenvif already enabled<br/>To activate the new configuration, you need to run:<br/>systemctl restart apache2</span><span id="7c4c" class="kq jf hi km b fi kv ks l kt ku">sudo a2enconf php5.6-fpm<br/>Enabling conf php5.6-fpm.</span><span id="2a26" class="kq jf hi km b fi kv ks l kt ku">To activate the new configuration, you need to run:<br/>systemctl reload apache2</span><span id="5188" class="kq jf hi km b fi kv ks l kt ku">sudo systemctl reload apache2</span></pre><p id="8f52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">修改完我的模块后，我可能忘记了重新加载apache2配置。错误消息提醒我重新加载apache2。在systemctl重新加载apache2之后，我的php5.6配置就可以用于我的php应用程序了。霍雷。呵！</p><h2 id="7c03" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">拍摄工作实例的快照</h2><p id="af64" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">这是对我的工作实例配置进行备份(快照)的好时机。这样，如果这个服务器有任何问题，我可以恢复这个最新的工作版本。</p><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mx"><img src="../Images/c44e13b6c8577c43d4e01ebe947537e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L2uktvgAFI8Dyy5t"/></div></div></figure><h2 id="be5b" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">为实例创建警报策略</h2><p id="7f79" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">当我们创建备份时，让我们设置警报。因为这个站点托管在一台服务器上，没有冗余的GLB或托管实例组，所以如果它宕机，我想知道。</p><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lz"><img src="../Images/b8e9dfbbb13a5728af14fd1e71ff00aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sUla1TOHzp4OMaL1"/></div></div></figure><h2 id="310b" class="kq jf hi bd jg la lb lc jk ld le lf jo iq lg lh js iu li lj jw iy lk ll ka lm bi translated">DNS配置—设置云DNS</h2><p id="1019" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">对于我现有的DNS区域，云DNS的每个区域成本约为0.21美元，因此我将我的域名指向云DNS，并设置该区域通过a记录指向我的计算引擎实例。</p><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es my"><img src="../Images/bb22b3426732d530a2fcd45f55b098a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UuvMQtXOX-9iClcJ"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">将我的注册器设置为指向云DNS</figcaption></figure><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lz"><img src="../Images/d89d8d230a01a96f30f6d20147f45e09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*maFzVmgYX1nF43Iz"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">在云DNS上配置我的区域文件</figcaption></figure><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lz"><img src="../Images/d4f3649024bcbf7096697ace41aea856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ysM6EsxiPb3ZW8Ib"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">我五年前建立的virtualgoldstar.com迷因基因网站托管在谷歌计算引擎上，使用云域名系统</figcaption></figure><h1 id="2194" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">我错过的事情..</h1><p id="10f9" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">。htpasswd</p><p id="a318" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的2015 php站点有一个使用. passwd文件进行身份验证的管理区。由于只迁移了public_html目录，我错过了这个。所以我需要重新创建我的管理区工作。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="c82c" class="kq jf hi km b fi kr ks l kt ku">mkdir /home/virtual/.htpasswds/public_html/admin/</span><span id="41f7" class="kq jf hi km b fi kv ks l kt ku">sudo htpasswd -c /home/virtual/.htpasswds/public_html/admin/passwd mike</span></pre><p id="781f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">目录所有权</p><p id="07b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的应用程序使用用户输入创建文件。在我的迁移过程中，我所有的应用程序文件都是由root创建的。为了让我的应用程序工作，我需要将两个目录更改为www-data所有</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="88c9" class="kq jf hi km b fi kr ks l kt ku">sudo chown www-data creating_image/</span></pre><h1 id="3479" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">成本比较</h1><p id="1546" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我在利诺德的费用是:每月38.50美元</p><p id="a52e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">附加IPv4地址MK _ Personal(144500)2020–05–01 04:00:00 2020–06–01 03:59 0.0015美元1.00美元0.00美元1.00美元Li node 6GB MK _ Personal(144500)2020–05–01 04:00:00 2020–06–01 03:59:</p><p id="1523" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我决定不再更新我的cPanel执照，它是<a class="ae ln" href="https://cpanel.net/pricing/" rel="noopener ugc nofollow" target="_blank">5个域名</a>每月20美元。</p><p id="cae5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，要在VPS上运行这几个网站，我每月支付大约58美元。</p><p id="d459" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将在一个月后更新这篇文章，以比较在GCP运行一个月的成本。我估计大约是40美元/月或者少20美元/月。</p><p id="738e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢阅读！</p><p id="2539" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">更新:2022年11月1日</strong></p><p id="f7e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在GCP运行2个迁移的cPanel站点(在GCS和GCE上运行1个静态站点)成本表如下:</p><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mz"><img src="../Images/533c2238c7f622b5f07187942bdcc0e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kh7SFK6af4zYIh3H31UHBw.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">我个人GCP账户的费用表</figcaption></figure><p id="7050" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在谷歌云上运行我的两个主要网站每月21.67美元。计算引擎支出的大部分是实例费(E2实例核心-8.03美元，E2实例ram-4.31美元)和静态IP费用(7.38美元/月)。PD快照很便宜。我在云存储上运行的婚礼网站是&lt; $1/month. I have a bunch of other backups in GCS in the cost table above.</p><p id="cf93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">I powered down one of the instances earlier this year that I had the DB running on Cloud SQL and another instance for web. When I was running those 2 instances + the site on GCS my expense was around $45/month.</p><p id="7125" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Conclusion: GCP can be cost effective for individual users sites such as static websites with basic configuration requirements that do not require much maintenance or end user interaction. For end users looking to stop using cPanel, consider Google Cloud Storage for extremely low cost hosting for sites that do not require a DB or much web server configuration.</p><p id="a70f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">For operators and hosting providers considering moving to GCP it will be more challenging specifically for their clients that operate many sites. End users will lose access to a UI to manage site and domain configuration and more responsibility will be placed on the hosting provider for management. Consider looking into the <a class="ae ln" href="https://cloud.google.com/partners/become-a-partner" rel="noopener ugc nofollow" target="_blank">Google Cloud Partner Program</a>并在Google Cloud Storage上提供静态网站托管服务。</p></div></div>    
</body>
</html>