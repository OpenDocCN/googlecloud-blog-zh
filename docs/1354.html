<html>
<head>
<title>Define New Paths with Routing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用路由定义新路径</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/define-new-paths-with-routing-39a7d8eb4356?source=collection_archive---------0-----------------------#2020-04-03">https://medium.com/google-cloud/define-new-paths-with-routing-39a7d8eb4356?source=collection_archive---------0-----------------------#2020-04-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/024fdd9d2298365137d2822d93137891.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*52MDRsmqaKCIgHfdkWuH1A.gif"/></div></div></figure><div class=""/><div class=""><h2 id="9493" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">为什么路由是网络成功的基础，以及如何在Google Cloud上设置路由</h2></div><h1 id="4c33" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">你的网络是战略性的</h1><p id="422f" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">从本系列文章开始，我就清楚地表明，数据和应用程序与它们运行的网络是不可分的。您的数字基础设施的可靠性直接取决于这个网络。坦率地说，这就是为什么您应该投资使用正确的构建模块来构建它。</p><p id="8d15" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">问题是，试图将现有的网络技术应用到云是行不通的——无论你是连接来自不同数据中心的资源还是分支机构之间的资源。无论您的内部网络环境设计得多么好或多么复杂，将硬件虚拟化到云中都会保留太多的复杂性。它带来了配置、管理和故障排除，而这些往往忽略了云网络带给您的好处。您的开发运维团队将受到处理这种云连接的支配，不得不改造网络硬件，以试图保持原有的连接和性能预期。</p><h1 id="fb78" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">一种新的路由方式</h1><p id="fa5d" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">云路由不仅是强制性的，而且是从头开始构建强大网络架构的基础部分。把它想象成邮政服务、UPS或联邦快递。数据包来自世界各地，在本地分拣中心(路由器)着陆，可能在到达目的地之前在其他中心着陆。它们会因为天气、卡车故障和自然灾害而改道。这是物流的惊人壮举。</p><blockquote class="lb"><p id="9951" class="lc ld ht bd le lf lg lh li lj lk kv dx translated">现在想象一下，你不是有10个邮局，而是有数千个——同时携带数千倍的包裹。</p></blockquote><p id="eab9" class="pw-post-body-paragraph ka kb ht kc b kd ll iu kf kg lm ix ki kj ln kl km kn lo kp kq kr lp kt ku kv hb bi translated">路由协议是您的系统让网络知道他们在和谁通话以及如何有效地向那里发送信息的一种方式。当网络条件发生变化或设备出现故障时，路由协议可以更改通告给其它网络的路由以进行补偿。</p><p id="6a27" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">最重要的是，您需要能够将网络连接在一起，而不允许数据被任何位置的任何用户看到。例如，假设A &amp; B公司在一栋建筑中共用一面墙，每个公司都有自己的专用网络，但他们希望在不放弃当前网络配置的情况下将这些网络连接在一起。这将意味着让两个网络使用不同的IP地址范围，并设置一个连接到这两个网络的路由器，以便在它们之间传递流量。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lq"><img src="../Images/38e3b758074835224e4eb967ed2f1ed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JmXIryBNAPxcZLFq"/></div></div></figure><p id="7700" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">传统上，为内部网络设置路由器需要相当繁重的工作。这包括物理组装设备，如路由器、交换机、网桥、集线器和防火墙，以在用户和他们使用的应用程序之间建立互连。实施可能需要几天甚至几周的时间，而且随着网络的增长，相关的管理和运营成本也会不成比例地增加。</p><p id="c190" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">然而，软件定义的网络旨在消除对硬件管理的需求，并通过更简单的配置提供可扩展性和安全性优势。谷歌云的软件定义路由是围绕一个使用可扩展的分布式虚拟路由机制的<a class="ae lv" href="https://cloud.google.com/vpc" rel="noopener ugc nofollow" target="_blank"> VPC网络</a>设计的。路由定义了网络流量从虚拟机实例到其他目的地的路径。这些目的地可以在您的VPC网络内部(例如，在另一个虚拟机中)或外部。</p><h1 id="8089" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">引擎盖下的云路由</h1><p id="55d6" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">让我们仔细看看:</p><p id="1bb0" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">每条路由都由目的地和下一跳组成，它们是IP地址或IP地址范围。其目的地IP在目的地范围内的流量被发送到下一跳进行传递。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lw"><img src="../Images/075e65ec98bffbe81adc171e29dc7433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*b0myOzmoCFpFhThH"/></div></div></figure><p id="bba5" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">每个虚拟机实例都有一个控制器，该控制器从网络路由表中获知其所有路由。您可能还记得，路由通常是针对每个虚拟机有选择地应用的，但GCP的路由表实际上是在全球VPC网络级别定义的。基于路由顺序，离开VM的每个分组被发送到适用路由的下一跳。当您添加或删除一个路由时，使用<a class="ae lv" href="https://cloud.google.com/vpc/docs/using-routes#order_of_operations" rel="noopener ugc nofollow" target="_blank">最终一致设计</a>将更改集传播到VM控制器。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lx"><img src="../Images/4d12d31042fdb8a7cb9368f88cd7d981.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GQslawbmchWfG_eE"/></div></div></figure><h1 id="3a87" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">路线类型</h1><p id="1428" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">现在，GCP VPC上有两种类型的路线:系统生成的路线或自定义路线。</p><p id="1a9d" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">系统生成的路由给你<em class="ly">子网路由</em>和<em class="ly">默认路由</em>。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lz"><img src="../Images/e2094762ec070031cdf079387e4618f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XTAX5nTKqH1yAJBp"/></div></div></figure><p id="4c40" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">子网路由(红色)定义了进入VPC的流量到每个子网的路径。这些应用于VPC网络，并被编程到VPC网络中的所有端点。将子网添加到VPC时，会自动创建子网路由，以允许虚拟机与同一VPC中的其他虚拟机进行通信。只要知道这些路线是不能删除或更改的。子网路由是<a class="ae lv" href="https://cloud.google.com/vpc/docs/vpc-peering" rel="noopener ugc nofollow" target="_blank"> VPC对等</a>的工作方式(VPC对等总是交换所有子网路由)。</p><p id="9cdc" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">默认路径(蓝色)定义了从您的VPC到Google服务和公共互联网的流量路径。它包括一个到互联网网关的预编程0.0.0.0/0路由。与子网路由不同，这些路由<em class="ly">可以</em>更改。</p><p id="664d" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">另一方面，定制路线包括定义你自己的静态路线，或者使用<a class="ae lv" href="https://cloud.google.com/router/docs/concepts/overview" rel="noopener ugc nofollow" target="_blank">谷歌云路由器</a>定义动态路线。</p><h1 id="14e6" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">静态路由设置</h1><p id="ca82" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">让我们以VPN为例，演示如何创建自定义静态路由:</p><figure class="lr ls lt lu fd hk"><div class="bz dy l di"><div class="ma mb l"/></div></figure><ol class=""><li id="d7cf" class="mc md ht kc b kd kw kg kx kj me kn mf kr mg kv mh mi mj mk bi translated">设置您的项目ID。</li></ol><pre class="lr ls lt lu fd ml mm mn mo aw mp bi"><span id="cff2" class="mq jj ht mm b fi mr ms l mt mu">gcloud config set project [PROJECT_ID]</span></pre><p id="3e52" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">2.在不同地区创建2个VPC。</p><pre class="lr ls lt lu fd ml mm mn mo aw mp bi"><span id="5543" class="mq jj ht mm b fi mr ms l mt mu">gcloud compute networks create ohio --subnet-mode=custom</span><span id="2511" class="mq jj ht mm b fi mv ms l mt mu">gcloud compute networks create texas --subnet-mode=custom</span><span id="1e6f" class="mq jj ht mm b fi mv ms l mt mu">gcloud compute networks subnets create subnet1 --network=ohio — region us-east1 --range=10.0.0.0/24</span><span id="26ed" class="mq jj ht mm b fi mv ms l mt mu">gcloud compute networks subnets create subnet2 --network=texas — region us-central1 --range=10.8.0.0/24</span></pre><p id="e6cf" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">3.在每个VPC中创建一个计算引擎实例。</p><pre class="lr ls lt lu fd ml mm mn mo aw mp bi"><span id="d963" class="mq jj ht mm b fi mr ms l mt mu">gcloud compute instances create ohio-server --subnet subnet1 --zone us-east1-b</span><span id="f737" class="mq jj ht mm b fi mv ms l mt mu">gcloud compute instances create texas-server --subnet subnet2 --zone us-central1-a</span></pre><p id="b128" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">4.创建防火墙规则，以支持对实例的访问和网络之间的访问。</p><pre class="lr ls lt lu fd ml mm mn mo aw mp bi"><span id="db4f" class="mq jj ht mm b fi mr ms l mt mu">gcloud compute firewall-rules create allow-ssh-ohio --network ohio --allow tcp:22 --source-ranges 0.0.0.0/0</span><span id="81ef" class="mq jj ht mm b fi mv ms l mt mu">gcloud compute firewall-rules create allow-ohio-texas --network ohio --allow tcp:3306,icmp --source-ranges 10.8.0.0/24</span><span id="5cfd" class="mq jj ht mm b fi mv ms l mt mu">gcloud compute firewall-rules create allow-texas-ohio --network texas --allow tcp:3306,icmp --source-ranges 10.0.0.0/24</span></pre><p id="3258" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">5.使用以下配置在每个区域创建2个VPN网关:</p><pre class="lr ls lt lu fd ml mm mn mo aw mp bi"><span id="d105" class="mq jj ht mm b fi mr ms l mt mu">gcloud compute target-vpn-gateways create evpn \<br/>--network ohio \<br/>--region us-east1</span><span id="27f0" class="mq jj ht mm b fi mv ms l mt mu">gcloud compute target-vpn-gateways create cvpn \<br/>--network texas \<br/>--region us-central1</span></pre><p id="ef90" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">6.为每个VPN网关保留一个区域外部(静态)IP地址:</p><pre class="lr ls lt lu fd ml mm mn mo aw mp bi"><span id="e31c" class="mq jj ht mm b fi mr ms l mt mu">gcloud compute addresses create east-ip \<br/>--region us-east1</span><span id="77d8" class="mq jj ht mm b fi mv ms l mt mu">gcloud compute addresses create central-ip \<br/>--region us-central1</span></pre><p id="b158" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">7.为中央网关创建三个转发规则。这些规则指示Google Cloud向网关发送ESP (IPsec)、UDP 500和UDP 4500流量。</p><pre class="lr ls lt lu fd ml mm mn mo aw mp bi"><span id="9bbf" class="mq jj ht mm b fi mr ms l mt mu">gcloud compute forwarding-rules create fr-cvpn-esp \<br/>--ip-protocol ESP \<br/>--address central-ip \<br/>--target-vpn-gateway cvpn \<br/>--region us-central1</span><span id="b723" class="mq jj ht mm b fi mv ms l mt mu">gcloud compute forwarding-rules create fr-cvpn-udp500 \<br/>--ip-protocol UDP \<br/>--ports 500 \<br/>--address central-ip \<br/>--target-vpn-gateway cvpn \<br/>--region us-central1</span><span id="88a8" class="mq jj ht mm b fi mv ms l mt mu">gcloud compute forwarding-rules create fr-cvpn-udp4500 \<br/>--ip-protocol UDP \<br/>--ports 4500 \<br/>--address central-ip \<br/>--target-vpn-gateway cvpn \<br/>--region us-central1</span></pre><p id="5e1f" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">8.为东部网关创建3个转发规则。</p><pre class="lr ls lt lu fd ml mm mn mo aw mp bi"><span id="7ddf" class="mq jj ht mm b fi mr ms l mt mu">gcloud compute forwarding-rules create fr-evpn-esp \<br/>--ip-protocol ESP \<br/>--address east-ip \<br/>--target-vpn-gateway evpn \<br/>--region us-east1</span><span id="0c65" class="mq jj ht mm b fi mv ms l mt mu">gcloud compute forwarding-rules create fr-evpn-udp500 \<br/>--ip-protocol UDP \<br/>--ports 500 \<br/>--address east-ip \<br/>--target-vpn-gateway evpn \<br/>--region us-east1</span><span id="777d" class="mq jj ht mm b fi mv ms l mt mu">gcloud compute forwarding-rules create fr-evpn-udp4500 \<br/>--ip-protocol UDP \<br/>--ports 4500 \<br/>--address east-ip \<br/>--target-vpn-gateway evpn \<br/>--region us-east1</span></pre><p id="c3ad" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">9.接下来<a class="ae lv" href="https://cloud.google.com/vpn/docs/how-to/generating-pre-shared-key" rel="noopener ugc nofollow" target="_blank">生成一个共享秘密</a>，你将需要它来创建VPN隧道。记下它。</p><p id="2d26" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">10.创建从东部网关到中央网关的基于静态路由的VPN隧道。首先从vpn网关页面复制cvpn的central-ip地址。对于基于路由的VPN，本地和远程流量选择器都是0.0.0.0/0。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lx"><img src="../Images/def96baf570acc6aaf1361f2860fc509.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jFTQMDWtbySPhWYs"/></div></div></figure><pre class="lr ls lt lu fd ml mm mn mo aw mp bi"><span id="c66c" class="mq jj ht mm b fi mr ms l mt mu">gcloud compute vpn-tunnels create tunnele2c \<br/>--peer-address [CVPN_IP] \<br/>--ike-version 1 \<br/>--shared-secret [SHARED_SECRET] \<br/>--local-traffic-selector=0.0.0.0/0 \<br/>--remote-traffic-selector=0.0.0.0/0 \<br/>--target-vpn-gateway evpn \<br/>--region us-east1</span></pre><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mw"><img src="../Images/5c44c2d686abc0a67f2f8f046cb9d16b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7aLjw48ful-A54oU"/></div></div></figure><p id="e264" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">11.创建从中央网关到东部网关的基于静态路由的VPN隧道。首先从vpn网关页面复制evpn的east-ip地址。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lx"><img src="../Images/875685a13e61ba871e5ba283e2fc9bdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8iVyNMeVEcAYx29A"/></div></div></figure><pre class="lr ls lt lu fd ml mm mn mo aw mp bi"><span id="1932" class="mq jj ht mm b fi mr ms l mt mu">gcloud compute vpn-tunnels create tunnelc2e \<br/>--peer-address [EVPN-IP] \<br/>--ike-version 1 \<br/>--shared-secret [SHARED_SECRET] \<br/>--local-traffic-selector=0.0.0.0/0 \<br/>--remote-traffic-selector=0.0.0.0/0 \<br/>--target-vpn-gateway cvpn \<br/>--region us-central1</span></pre><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mx"><img src="../Images/e836e9011478b555f35cdd27e3e8c3cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dTXd42Yu0c8HIEwj"/></div></div></figure><p id="eeab" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">在VPN通道页面上，您应该首先看到分配资源的状态，并尝试在VPN通道状态列下建立第一次握手。然后，在网关之间建立VPN连接后，会出现一个绿色复选标记。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lx"><img src="../Images/5f44228133f02b9bf5fea9f64ad52d24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*27zVszx4z_V22H3v"/></div></div></figure><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lx"><img src="../Images/c612eeb2fd8bdfc5454c329cec7956ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9sUAoGJoM2zbljha"/></div></div></figure><p id="cb6f" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">12.试着从俄亥俄服务器pinging德克萨斯服务器。从计算引擎实例页面获取texas-server的内部IP。然后从计算引擎实例页面SSH进入ohio-server，并输入以下命令。</p><pre class="lr ls lt lu fd ml mm mn mo aw mp bi"><span id="9500" class="mq jj ht mm b fi mr ms l mt mu">ping [TEXAS_INTERNAL_IP]</span></pre><p id="7d55" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">它将挂起，因为没有指定通过VPN隧道从俄亥俄服务器到德克萨斯服务器的路由。</p><p id="dd94" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">13.接下来，为从东VPC到VPC中部的流量创建一条静态路由。目标范围是中心子网的内部IP范围。下一跳是东到中央的VPN隧道。</p><pre class="lr ls lt lu fd ml mm mn mo aw mp bi"><span id="a841" class="mq jj ht mm b fi mr ms l mt mu">gcloud compute routes create tunnele2c \<br/>--destination-range 10.8.0.0/24 \<br/>--next-hop-vpn-tunnel tunnele2c \<br/>--network ohio \<br/>--next-hop-vpn-tunnel-region us-east1</span></pre><p id="48e1" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">14.现在用同样的方法创建一条从VPC中部到东部的路线。</p><pre class="lr ls lt lu fd ml mm mn mo aw mp bi"><span id="eb3d" class="mq jj ht mm b fi mr ms l mt mu">gcloud compute routes create tunnelc2e \<br/>--destination-range 10.0.0.0/24 \<br/>--next-hop-vpn-tunnel tunnelc2e \<br/>--network texas \<br/>--next-hop-vpn-tunnel-region us-central1</span></pre><p id="52e1" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">检查Routes页面，您应该会看到创建的新静态路由。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lx"><img src="../Images/f367651cd89d755be4943c02002921f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g9MoCMym2Y_Ra9LQ"/></div></div></figure><p id="081e" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">15.让我们再一次试着从俄亥俄服务器pinging德克萨斯服务器。</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es my"><img src="../Images/a40e32359b821a872380014b8b81545d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*elWCR6Fmf-GeXrdO"/></div></div></figure><p id="76c9" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">您应该会看到一个响应，因为路由允许流量通过VPN隧道作为下一跳发送！</p><p id="e730" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">使用网络情报中心的<a class="ae lv" href="https://cloud.google.com/network-intelligence-center/docs/connectivity-tests/concepts/overview" rel="noopener ugc nofollow" target="_blank">连接测试</a>，我为从俄亥俄州服务器到得克萨斯州服务器的流量创建了一个ICMP测试，它确认流量通过了我们的VPN和静态路由设置:</p><figure class="lr ls lt lu fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mz"><img src="../Images/29a9dbac860303570a08603f38e50330.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kN0tervPPWc8ri8M"/></div></div><figcaption class="na nb et er es nc nd bd b be z dx translated">*在本系列的后面，我们将讨论如何设置这个测试，以及如何使用网络智能中心来监控网络配置。</figcaption></figure><h1 id="a327" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">利弊</h1><p id="2ea7" class="pw-post-body-paragraph ka kb ht kc b kd ke iu kf kg kh ix ki kj kk kl km kn ko kp kq kr ks kt ku kv hb bi translated">请记住，对于静态路由，您必须创建或维护路由表。源网络或目的网络的拓扑变化要求您手动更新静态路由。换句话说，如果一条链路出现故障，静态路由不能自动重新路由流量(与动态路由相反，动态路由可以自动重新路由，我将在下一篇文章中详细介绍)。然而，静态路由对于具有稳定拓扑的小型网络来说是完美的，并且您还可以保持对路由表的严格控制，如上面的VPN示例所示。</p><p id="a28a" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">总而言之，谷歌的软件定义路由为您提供了:</p><ul class=""><li id="7413" class="mc md ht kc b kd kw kg kx kj me kn mf kr mg kv ne mi mj mk bi translated">集中化控制带来的简单性</li><li id="cb27" class="mc md ht kc b kd nf kg ng kj nh kn ni kr nj kv ne mi mj mk bi translated">高度自动化</li><li id="4a24" class="mc md ht kc b kd nf kg ng kj nh kn ni kr nj kv ne mi mj mk bi translated">内置安全性和加密</li><li id="beb0" class="mc md ht kc b kd nf kg ng kj nh kn ni kr nj kv ne mi mj mk bi translated">和高性能</li></ul><p id="9344" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">软件定义的路由连接子网和子网，并在VPC之间定向流量，甚至定向到您的本地网络。通过路由接口，您将开始看到它是如何改变的，您可以多么容易地开始构建一个高度可扩展的网络。</p><h1 id="e4de" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">现在怎么办？</h1><ol class=""><li id="91f7" class="mc md ht kc b kd ke kg kh kj nk kn nl kr nm kv mh mi mj mk bi translated">在此深入探讨路由<a class="ae lv" href="https://cloud.google.com/vpc/docs/routes" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="6fad" class="mc md ht kc b kd nf kg ng kj nh kn ni kr nj kv mh mi mj mk bi translated">订阅<a class="ae lv" href="https://www.youtube.com/user/googlecloudplatform" rel="noopener ugc nofollow" target="_blank"> GCP Youtube频道</a>，关注我的视频系列<a class="ae lv" href="https://www.youtube.com/playlist?list=PLIivdWyY5sqJ0oXcnZYqOnuNRsLF9H48u" rel="noopener ugc nofollow" target="_blank">端到端联网</a>。</li><li id="dd86" class="mc md ht kc b kd nf kg ng kj nh kn ni kr nj kv mh mi mj mk bi translated">查看<a class="ae lv" href="https://www.youtube.com/watch?v=jQc9P7xA_wU" rel="noopener ugc nofollow" target="_blank">网络102 </a>，在这里我与网络专家Ryan Pryzbl讨论路由问题。</li><li id="8de4" class="mc md ht kc b kd nf kg ng kj nh kn ni kr nj kv mh mi mj mk bi translated">想要更多内容？在<a class="ae lv" href="https://twitter.com/swongful" rel="noopener ugc nofollow" target="_blank">推特</a> @swongful上关注我。</li><li id="f0ba" class="mc md ht kc b kd nf kg ng kj nh kn ni kr nj kv mh mi mj mk bi translated">看看你身边的<a class="ae lv" href="https://cloud.google.com/events/" rel="noopener ugc nofollow" target="_blank">谷歌云事件</a>。</li></ol><p id="9c33" class="pw-post-body-paragraph ka kb ht kc b kd kw iu kf kg kx ix ki kj ky kl km kn kz kp kq kr la kt ku kv hb bi translated">请继续关注本系列的更多内容，并感谢您和我一起开启这场揭开云网络神秘面纱的旅程。</p></div></div>    
</body>
</html>