<html>
<head>
<title>Google Data Catalog and Qlik Sense metadata integration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google数据目录和Qlik Sense元数据集成</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-data-catalog-and-qlik-sense-metadata-integration-23b67d88b8d2?source=collection_archive---------2-----------------------#2021-01-14">https://medium.com/google-cloud/google-data-catalog-and-qlik-sense-metadata-integration-23b67d88b8d2?source=collection_archive---------2-----------------------#2021-01-14</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><div class=""><h2 id="17ef" class="pw-subtitle-paragraph ig hi hj bd b ih ii ij ik il im in io ip iq ir is it iu iv iw ix dy translated">利用数据目录发现和注释Qlik感知资产</h2></div><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et iy"><img src="../Images/70bf2ddf601f8c4f13a63493c64200c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E3i1ItWQ76LrV80Fo2VAmA.png"/></div></div><figcaption class="jk jl eu es et jm jn bd b be z dy translated">背景照片由<a class="ae jo" href="https://unsplash.com/@laurenmancke?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">劳伦·曼克</a>在<a class="ae jo" href="https://unsplash.com/s/photos/computer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="7ccf" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">在这篇博文中，我将分享推动为<a class="ae jo" href="https://cloud.google.com/data-catalog" rel="noopener ugc nofollow" target="_blank">谷歌数据目录</a>开发新样本连接器的想法和知识:<a class="ae jo" href="https://pypi.org/project/google-datacatalog-qlik-connector" rel="noopener ugc nofollow" target="_blank"> Qlik Sense连接器</a>。</p><p id="a69f" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">这是第三个开源连接器，允许客户将BI系统中的元数据接收到数据目录中:用于<a class="ae jo" rel="noopener" href="/google-cloud/google-cloud-data-catalog-and-looker-integration-4ebefdef6a34"> Looker </a>和<a class="ae jo" rel="noopener" href="/google-cloud/google-cloud-data-catalog-and-tableau-integration-204c1d17cc62"> Tableau </a>的连接器已经有一段时间了。</p><blockquote class="kl km kn"><p id="344f" class="jp jq ko jr b js jt ik ju jv jw in jx kp jz ka kb kq kd ke kf kr kh ki kj kk hc bi translated"><strong class="jr hk">免责声明:在本文撰写之时(2021年1月)，谷歌和/或谷歌云不正式支持任何将数据目录连接到非GCP系统的工具。您将在这里发现的仅仅是我作为数据目录采纳者的经验的结果。</strong></p></blockquote></div><div class="ab cl ks kt gq ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hc hd he hf hg"><h1 id="7bc6" class="kz la hj bd lb lc ld le lf lg lh li lj ip lk iq ll is lm it ln iv lo iw lp lq bi translated">概述</h1><p id="3a2a" class="pw-post-body-paragraph jp jq hj jr b js lr ik ju jv ls in jx jy lt ka kb kc lu ke kf kg lv ki kj kk hc bi translated">连接器由一个Python包组成，该包与命令行界面捆绑在一起。源代码可在<a class="ae jo" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-bi/tree/master/google-datacatalog-qlik-connector" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。那里也有安装和运行它的说明。</p><p id="c973" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">长话短说，它:</p><ol class=""><li id="d4f1" class="lw lx hj jr b js jt jv jw jy ly kc lz kg ma kk mb mc md me bi translated">通过使用它们的REST和Websocket APIs从Qlik Sense抓取元数据。</li><li id="5a69" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mb mc md me bi translated">准备信息以适应目录实体模型。</li><li id="5d5a" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mb mc md me bi translated">使用API将准备好的元数据吸收到数据目录中。</li></ol><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et mk"><img src="../Images/133a89e405562b4cf065cc20e0e6caea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3W4thDmbFrST86ecZfWH2g.png"/></div></div><figcaption class="jk jl eu es et jm jn bd b be z dy translated"><strong class="bd lb">图片1 </strong>。架构概述:Google数据目录和Qlik Sense元数据集成</figcaption></figure><p id="4813" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">运行连接器的最低要求如下:</p><ol class=""><li id="8230" class="lw lx hj jr b js jt jv jw jy ly kc lz kg ma kk mb mc md me bi translated"><strong class="jr hk"> Qlik Sense </strong>:对给定站点上的<a class="ae jo" href="https://help.qlik.com/en-US/sense-developer/September2020/Subsystems/RepositoryServiceAPI/Content/Sense_RepositoryServiceAPI/RepositoryServiceAPI-Introduction.htm" rel="noopener ugc nofollow" target="_blank">Qlik Sense Repository Service(QRS)</a>和<a class="ae jo" href="https://help.qlik.com/en-US/sense-developer/September2020/Subsystems/EngineAPI/Content/Sense_EngineAPI/introducing-engine-API.htm" rel="noopener ugc nofollow" target="_blank">Qlik Engine JSON</a>API具有读取权限的登录/密码对。</li><li id="dbe1" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mb mc md me bi translated"><strong class="jr hk">数据目录</strong>:允许创建条目组、条目、标记模板和标记的服务帐户(<a class="ae jo" href="https://cloud.google.com/iam/docs/understanding-roles#datacatalog" rel="noopener ugc nofollow" target="_blank">如果您不熟悉数据目录角色</a>，请参考文档)。</li><li id="54dd" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mb mc md me bi translated"><strong class="jr hk">连接器</strong>:Python 3.6+或Docker环境。</li></ol></div><div class="ab cl ks kt gq ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hc hd he hf hg"><h1 id="c9ba" class="kz la hj bd lb lc ld le lf lg lh li lj ip lk iq ll is lm it ln iv lo iw lp lq bi translated">QLIK资产类型</h1><p id="e8b1" class="pw-post-body-paragraph jp jq hj jr b js lr ik ju jv ls in jx jy lt ka kb kc lu ke kf kg lv ki kj kk hc bi translated">让我简单描述一下Qlik网站上通常提供的一些资源。正确理解它们的含义以及它们之间的关系将有助于您跟上后面的章节。</p><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et ml"><img src="../Images/4bea78c66ff19260d6e3c73e753aa193.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XtUTQmpsU2T6fJgPlzG72w.png"/></div></div><figcaption class="jk jl eu es et jm jn bd b be z dy translated"><strong class="bd lb">图二</strong>。Qlik感知资产关系</figcaption></figure><ul class=""><li id="7804" class="lw lx hj jr b js jt jv jw jy ly kc lz kg ma kk mm mc md me bi translated"><em class="ko">流</em>是顶级元素；它们是<em class="ko">应用程序的集合——</em>也称为文档<em class="ko">。</em></li><li id="703d" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mm mc md me bi translated">应用程序是用来装载、处理和显示数据的组件的容器。示例组件包括连接数据源和将数据提取到文档中所执行的脚本，以及<em class="ko">工作表</em>。</li><li id="9295" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mm mc md me bi translated"><em class="ko"> Streams </em>和<em class="ko"> Apps </em>都有标准属性，如<strong class="jr hk"> Name </strong>、<strong class="jr hk"> Id </strong>、<strong class="jr hk"> Owner </strong>和<strong class="jr hk"> Description </strong>，但是用户可以利用所谓的<em class="ko">自定义属性定义</em>来根据自己的需要扩展标准元数据集合。当管理<em class="ko">自定义属性定义</em>时，用户给它们一个可接受值列表的名称。</li><li id="9ef7" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mm mc md me bi translated"><em class="ko">自定义属性</em>是<em class="ko">自定义属性定义</em>、<em class="ko">流、</em>或<em class="ko">应用</em>之间的关联。它们具体化了用户扩展的元数据。</li><li id="463f" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mm mc md me bi translated"><em class="ko">工作表</em>是各种图表对象的容器。</li><li id="94f1" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mm mc md me bi translated">用于填充<em class="ko">表单</em>的对象可以单独构建(因此在单个<em class="ko">表单</em>中使用)或来自<em class="ko">应用</em>中的库。属于这样一个库的那些被称为<em class="ko">主项目</em>，并被分成三种类型:<em class="ko">尺寸</em>、<em class="ko">尺寸</em>和<em class="ko">可视化</em>。</li></ul></div><div class="ab cl ks kt gq ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hc hd he hf hg"><h1 id="2f72" class="kz la hj bd lb lc ld le lf lg lh li lj ip lk iq ll is lm it ln iv lo iw lp lq bi translated">设计工作</h1><p id="5d98" class="pw-post-body-paragraph jp jq hj jr b js lr ik ju jv ls in jx jy lt ka kb kc lu ke kf kg lv ki kj kk hc bi translated">当谈到系统集成时，最初的步骤之一是设计工作。我们需要理解每个系统中的概念和实体，以及它们如何适应另一端。Qlik资产类型在上一节中进行了描述。我假设读者对谷歌数据目录有一个初步的了解，但是如果你没有的话，请看看<a class="ae jo" rel="noopener" href="/google-cloud/data-catalog-hands-on-guide-a-mental-model-dae7f6dd49e">这篇博文</a>。</p><p id="a1ff" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">连接器在其初始版本中处理7种Qlik资产类型:</p><ol class=""><li id="86ec" class="lw lx hj jr b js jt jv jw jy ly kc lz kg ma kk mb mc md me bi translated">自定义属性定义</li><li id="7f25" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mb mc md me bi translated">流</li><li id="74c0" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mb mc md me bi translated">应用程序(仅限已发布的应用程序)</li><li id="aa67" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mb mc md me bi translated">主项目:尺寸</li><li id="ceca" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mb mc md me bi translated">主项目:衡量标准</li><li id="72d7" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mb mc md me bi translated">主项目:可视化效果</li><li id="732d" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mb mc md me bi translated">图纸(仅发布的图纸)</li></ol><p id="0efb" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">另一方面，数据目录使用三个主要的类来完成工作:</p><figure class="iz ja jb jc fe jd es et paragraph-image"><div class="es et mn"><img src="../Images/57dde4e47bff661d2c5140c06ac8ccc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*-mseshtROYcrciStuyMxDA.png"/></div><figcaption class="jk jl eu es et jm jn bd b be z dy translated"><strong class="bd lb">图片3 </strong>。条目、标签模板和标签:主要的Google数据目录类</figcaption></figure><p id="5174" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">每个Qlik资产将有一个单独的目录<em class="ko">条目</em>。它将捕获描述资产的最相关的元数据，例如一个<strong class="jr hk">显示名称</strong>，<strong class="jr hk">描述</strong>，<strong class="jr hk">创建和最后修改的日期</strong>，用于管理它的<strong class="jr hk">系统</strong>(<code class="dv mo mp mq mr b">entry.user_specified_system = 'qlik'</code>，以及它的<strong class="jr hk">类型</strong> : <code class="dv mo mp mq mr b">entry.user_specified_type = 'sheet'</code>或<code class="dv mo mp mq mr b">entry.user_specified_type = 'dimension'</code>。</p><p id="93f7" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated"><em class="ko">条目</em>的标准字段无法从各种Qlik资产中获取所有元数据。这里<em class="ko">标签</em>来帮助我们:它们是灵活的结构，我们可以用它们来注释目录条目，从而扩展标准的<em class="ko">条目</em>字段集。例如，<em class="ko">应用程序</em>有一个布尔字段，指示它们是否已发布，这不包含在任何<em class="ko">条目</em>字段中。然后，我们可以将带有<code class="dv mo mp mq mr b">published</code>字段的<em class="ko">标签</em>附加到与<em class="ko"> App </em>相关的<em class="ko">条目</em>上，以便保存这些元数据；集成Qlik和数据目录时避免丢失相关信息的简单方法。同样的推理适用于通过Qlik APIs可读的各种字段。</p><p id="8394" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated"><em class="ko">标签</em>是从模板中创建的，模板可以被认为是它们的定义元素。<em class="ko">标签模板</em>用于指定将实际保存元数据的<em class="ko">标签</em>字段的名称和类型。下面的代码片段(简化以提高可读性)带来了一个<em class="ko">标签模板</em>，用于捕获<em class="ko">应用的</em>元数据:</p><figure class="iz ja jb jc fe jd"><div class="bz dz l di"><div class="ms mt l"/></div><figcaption class="jk jl eu es et jm jn bd b be z dy translated"><strong class="ak">代码片段1 </strong>。在Google Data Catalog中制作一个标签模板来注释Qlik应用程序相关的条目</figcaption></figure><p id="922d" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">创建连接器当前使用的<em class="ko">标记模板</em>的代码可以在<a class="ae jo" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-bi/blob/master/google-datacatalog-qlik-connector/src/google/datacatalog_connectors/qlik/prepare/datacatalog_tag_template_factory.py" rel="noopener ugc nofollow" target="_blank">这里</a>找到。您会注意到每个Qlik资产类型都有一个模板。</p><p id="6188" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">为每个<em class="ko">自定义属性定义</em>的<strong class="jr hk">选择值</strong>创建附加模板，只要它们被分配给至少一个<em class="ko">流</em>或<em class="ko">应用</em>:</p><blockquote class="mu"><p id="d45e" class="mv mw hj bd mx my mz na nb nc nd kk dy translated">这一决定背后的基本原理包括允许连接器同步从每个自定义属性收集的所有元数据，同时它使Qlik资产能够通过它们的自定义属性轻松找到——使用查询字符串，如<code class="dv mo mp mq mr b">tag:property_name:"&lt;PROPERTY-NAME&gt;"</code>和<code class="dv mo mp mq mr b">tag:value:"&lt;SOME-VALUE&gt;"</code>。</p><p id="8568" class="mv mw hj bd mx my mz na nb nc nd kk dy translated"><a class="ae jo" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-bi/tree/master/google-datacatalog-qlik-connector#41-tag-templates-for-custom-property-choice-values" rel="noopener ugc nofollow" target="_blank"> —连接器文档</a></p></blockquote><p id="10ee" class="pw-post-body-paragraph jp jq hj jr b js ne ik ju jv nf in jx jy ng ka kb kc nh ke kf kg ni ki kj kk hc bi translated">最后，Qlik资产之间存在关系—最明显的是:父子、关联和合成。虽然数据目录目前还不支持<em class="ko">实体</em>之间的关系，但是连接器通过<em class="ko">标签</em>对其中一些实体进行寻址。总而言之:</p><ul class=""><li id="29c0" class="lw lx hj jr b js jt jv jw jy ly kc lz kg ma kk mm mc md me bi translated">三个<em class="ko">标签</em>字段通常将资产<em class="ko"> </em>链接到它们的父资产(即上游资产):父资产的<strong class="jr hk"> Id </strong>、<strong class="jr hk">名称</strong>，以及一个<strong class="jr hk"> URL </strong>，该URL允许用户使用数据目录UI导航到相关的<em class="ko">条目</em>。以上面的<em class="ko">标签模板</em>为例:一个<em class="ko">流</em>是<em class="ko"> App </em>的父，由<code class="dv mo mp mq mr b">stream_id</code>、<code class="dv mo mp mq mr b">stream_name</code>和<code class="dv mo mp mq mr b">stream_entry</code>字段标识。如果您查看源代码或运行连接器，您会注意到在其他模板中使用了相同的模式来模拟类似的父子关系。</li><li id="9199" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mm mc md me bi translated"><em class="ko">自定义属性</em>可以被视为它们的定义和它们帮助分类的<em class="ko">流</em>或<em class="ko">应用</em>之间的关联。这种关联由特定的<em class="ko">标签</em>表示。</li><li id="5f2c" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mm mc md me bi translated">连接器还没有处理组合，例如，哪些<em class="ko">尺寸</em>、<em class="ko">度量</em>和<em class="ko">可视化</em>用于构建给定的<em class="ko">表</em>。不过，这值得注意:我们在Qlik引擎API方面的经验让我们相信，在未来版本中添加这种支持是可行的。</li></ul></div><div class="ab cl ks kt gq ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hc hd he hf hg"><h1 id="bffe" class="kz la hj bd lb lc ld le lf lg lh li lj ip lk iq ll is lm it ln iv lo iw lp lq bi translated">样本连接器</h1><p id="e7cd" class="pw-post-body-paragraph jp jq hj jr b js lr ik ju jv ls in jx jy lt ka kb kc lu ke kf kg lv ki kj kk hc bi translated">现在是时候看看一些技术特征了。源代码应该足够清晰，以便任何人都能理解。然而，我们正在谈论软件，有些事情仍然值得澄清。在接下来的段落中，你会发现一些Qlik特有的怪癖；我将尝试添加尽可能多的上下文和有意义的链接，但人们可能仍然需要参考<a class="ae jo" href="https://help.qlik.com/en-US/sense-developer/September2020/Content/Sense_Helpsites/Home-developer.htm" rel="noopener ugc nofollow" target="_blank">Qlik Sense for Developers Help</a>进行更深入的阅读。</p><h2 id="afbb" class="nj la hj bd lb nk nl nm lf nn no np lj jy nq nr ll kc ns nt ln kg nu nv lp nw bi translated">组件架构</h2><p id="fa9e" class="pw-post-body-paragraph jp jq hj jr b js lr ik ju jv ls in jx jy lt ka kb kc lu ke kf kg lv ki kj kk hc bi translated">六个主要组件用于解决方案，如下图所示。绿色方框代表Qlik资源；灰色框，连接器特定资源；蓝盒子，一个数据目录资源。</p><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et nx"><img src="../Images/3daaa95a8bb19995602598c8a4392c54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kfRPECRD3n73E8IV4Yxu1w.png"/></div></div><figcaption class="jk jl eu es et jm jn bd b be z dy translated"><strong class="bd lb">图片4 </strong>。用于Google数据目录的Qlik Sense连接器的组件</figcaption></figure><ol class=""><li id="d46b" class="lw lx hj jr b js jt jv jw jy ly kc lz kg ma kk mb mc md me bi translated"><a class="ae jo" href="https://help.qlik.com/en-US/sense-developer/September2020/Subsystems/ProxyServiceAPI/Content/Sense_ProxyServiceAPI/ProxyServiceAPI-Introduction.htm" rel="noopener ugc nofollow" target="_blank"> Qlik Sense代理服务</a><a class="ae jo" href="https://help.qlik.com/en-US/sense-developer/September2020/Subsystems/ProxyServiceAPI/Content/Sense_ProxyServiceAPI/ProxyServiceAPI-Introduction.htm" rel="noopener ugc nofollow" target="_blank">(QPS)</a><a class="ae jo" href="https://help.qlik.com/en-US/sense-developer/September2020/Subsystems/ProxyServiceAPI/Content/Sense_ProxyServiceAPI/ProxyServiceAPI-Introduction.htm" rel="noopener ugc nofollow" target="_blank">API</a>:一个用于认证目的的REST API。它发出可用作HTTP cookies或报头的票证，以验证对QRS和引擎API的后续请求。</li><li id="9ed5" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mb mc md me bi translated"><a class="ae jo" href="https://help.qlik.com/en-US/sense-developer/September2020/Subsystems/RepositoryServiceAPI/Content/Sense_RepositoryServiceAPI/RepositoryServiceAPI-Introduction.htm" rel="noopener ugc nofollow" target="_blank">Qlik Sense Repository Service(QRS)API</a>:连接器从这个REST API中读取<em class="ko">流</em>、<em class="ko">应用</em>、<em class="ko">自定义属性定义</em>和<em class="ko">自定义属性</em>元数据。</li><li id="0991" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mb mc md me bi translated"><a class="ae jo" href="https://help.qlik.com/en-US/sense-developer/September2020/Subsystems/EngineAPI/Content/Sense_EngineAPI/introducing-engine-API.htm" rel="noopener ugc nofollow" target="_blank"> Qlik Engine JSON API </a>:一个WebSockets API，允许连接器读取与<em class="ko">工作表</em>和主项目相关的元数据— <em class="ko">尺寸</em>、<em class="ko">度量</em>和<em class="ko">可视化</em>。</li><li id="da2b" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mb mc md me bi translated"><a class="ae jo" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-bi/tree/master/google-datacatalog-qlik-connector" rel="noopener ugc nofollow" target="_blank">Google-data catalog-qlik-connector</a>:作为本文开头提到的<strong class="jr hk">scrape</strong>→<strong class="jr hk">prepare</strong>→<strong class="jr hk">ingest</strong>工作流的协调者。它包含允许用户使用命令行界面启动连接器的代码。除此之外，还有处理身份验证、元数据读取(抓取阶段)和Qlik到数据目录实体转换(准备阶段)的代码。元数据接收(接收阶段)被委托给<code class="dv mo mp mq mr b">google-datacatalog-connectors-commons</code>组件。</li><li id="dda5" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mb mc md me bi translated"><a class="ae jo" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors/tree/master/google-datacatalog-connectors-commons" rel="noopener ugc nofollow" target="_blank">Google-Data Catalog-connectors-commons</a>:所有数据目录开源连接器共享的代码，包括完整的元数据摄取支持和执行监控工具。</li><li id="eea3" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mb mc md me bi translated"><a class="ae jo" href="https://cloud.google.com/data-catalog/docs/how-to/custom-entries" rel="noopener ugc nofollow" target="_blank">数据目录API </a>:允许用户创建和管理自定义数据资源类型的<em class="ko">条目</em>，以及<em class="ko">标签模板</em>和<em class="ko">标签</em>。</li></ol><h2 id="21fb" class="nj la hj bd lb nk nl nm lf nn no np lj jy nq nr ll kc ns nt ln kg nu nv lp nw bi translated">用户认证</h2><p id="633d" class="pw-post-body-paragraph jp jq hj jr b js lr ik ju jv ls in jx jy lt ka kb kc lu ke kf kg lv ki kj kk hc bi translated">连接器目前使用NTLM对Qlik用户进行身份验证，这是Windows上Qlik Sense Enterprise的默认身份验证模块<a class="ae jo" href="https://help.qlik.com/en-US/sense-admin/September2020/Subsystems/DeployAdministerQSE/Content/Sense_DeployAdminister/QSEoW/Deploy_QSEoW/Server-Security-Authentication-MS-Windows-Environment.htm" rel="noopener ugc nofollow" target="_blank">。NTLM还允许用户从可信区域之外进行连接。因此，从NTLM开始是一个设计决定，以达到更高的观众，因为最初的版本。</a></p><blockquote class="kl km kn"><p id="9a6a" class="jp jq ko jr b js jt ik ju jv jw in jx kp jz ka kb kq kd ke kf kr kh ki kj kk hc bi translated">对于那些寻找实现细节的人来说:主要的认证逻辑由<code class="dv mo mp mq mr b">Authenticator</code> <a class="ae jo" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-bi/blob/master/google-datacatalog-qlik-connector/src/google/datacatalog_connectors/qlik/scrape/authenticator.py" rel="noopener ugc nofollow" target="_blank">类</a>处理，包括<code class="dv mo mp mq mr b">x-Qlik-Xrfkey</code>头设置。</p></blockquote><p id="f10a" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">不过，还有其他选择。在阅读了社区论坛中的许多内容后，我们注意到Windows <em class="ko"> </em>上与Qlik <em class="ko"> </em> Sense Enterprise的大多数编程交互似乎都是在<a class="ae jo" href="https://help.qlik.com/en-US/sense-developer/September2020/Subsystems/EngineAPI/Content/Sense_EngineAPI/GettingStarted/connecting-to-engine-api.htm" rel="noopener ugc nofollow" target="_blank">基于证书的身份验证</a>下进行的，而不是登录/通过。基于JWT的身份验证似乎也是可以实现的，但是这两种方法都需要进一步的研究和测试。</p><h2 id="40a3" class="nj la hj bd lb nk nl nm lf nn no np lj jy nq nr ll kc ns nt ln kg nu nv lp nw bi translated">REST与WebSocket APIs</h2><p id="c89b" class="pw-post-body-paragraph jp jq hj jr b js lr ik ju jv ls in jx jy lt ka kb kc lu ke kf kg lv ki kj kk hc bi translated">上面列表中编号为2和3的组件清楚地表明，我们使用两个API在整个抓取阶段读取元数据。</p><p id="54b3" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">我们试图从<a class="ae jo" href="https://help.qlik.com/en-US/sense-developer/September2020/Subsystems/RepositoryServiceAPI/Content/Sense_RepositoryServiceAPI/RepositoryServiceAPI-Introduction.htm" rel="noopener ugc nofollow" target="_blank">Qlik Sense Repository Service(QRS)API</a>中获取尽可能多的元数据。它实现了一个REST协议，这个协议被开发人员广为人知并且易于使用。</p><blockquote class="kl km kn"><p id="7342" class="jp jq ko jr b js jt ik ju jv jw in jx kp jz ka kb kq kd ke kf kr kh ki kj kk hc bi translated">请参考<code class="dv mo mp mq mr b">RepositoryServicesAPIHelper</code> <a class="ae jo" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-bi/blob/master/google-datacatalog-qlik-connector/src/google/datacatalog_connectors/qlik/scrape/repository_services_api_helper.py" rel="noopener ugc nofollow" target="_blank">类</a>来更好的理解我所说的“容易消费”是什么意思。</p></blockquote><p id="d3f2" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">另一方面，<a class="ae jo" href="https://help.qlik.com/en-US/sense-developer/September2020/Subsystems/EngineAPI/Content/Sense_EngineAPI/introducing-engine-API.htm" rel="noopener ugc nofollow" target="_blank"> Qlik引擎JSON API </a>实现了WebSockets协议，需要异步编程。在早期，我们花了一段时间来加快速度，但后来我们找到了一个解决方案，这个方案显示出了很高的效率:<code class="dv mo mp mq mr b">BaseEngineAPIHelper</code>是所有引擎API交互的<a class="ae jo" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-bi/blob/master/google-datacatalog-qlik-connector/src/google/datacatalog_connectors/qlik/scrape/base_engine_api_helper.py" rel="noopener ugc nofollow" target="_blank">基类</a>；它的方法促进代码重用，将处理特定内容的责任留给子类，正如你在<code class="dv mo mp mq mr b">EngineAPISheetsHelper</code>、<code class="dv mo mp mq mr b">EngineAPIDimensionsHelper</code>、<code class="dv mo mp mq mr b">EngineAPIMeasuresHelper</code>和<code class="dv mo mp mq mr b">EngineAPIVisualizationsHelper</code> <a class="ae jo" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-bi/tree/master/google-datacatalog-qlik-connector/src/google/datacatalog_connectors/qlik/scrape" rel="noopener ugc nofollow" target="_blank">类</a>中看到的。</p></div><div class="ab cl ks kt gq ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hc hd he hf hg"><h1 id="e6ea" class="kz la hj bd lb lc ld le lf lg lh li lj ip lk iq ll is lm it ln iv lo iw lp lq bi translated">结果</h1><p id="1f3a" class="pw-post-body-paragraph jp jq hj jr b js lr ik ju jv ls in jx jy lt ka kb kc lu ke kf kg lv ki kj kk hc bi translated">在下图中，您可以看到运行连接器后执行目录搜索的结果。在我们的测试环境中，我使用了<code class="dv mo mp mq mr b">system=qlik type=stream</code>查询来查找Qlik站点中所有可用的<em class="ko">流</em>。</p><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et ny"><img src="../Images/5939ef8aa57f08827f001dc40439aace.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vr061u-IunoM_qinEKYVMg.png"/></div></div><figcaption class="jk jl eu es et jm jn bd b be z dy translated"><strong class="bd lb">图片5 </strong>。使用谷歌数据目录搜索所有Qlik <em class="nz">流</em></figcaption></figure><p id="05b2" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">类似的查询可用于寻找其他资产类型:</p><ul class=""><li id="afdf" class="lw lx hj jr b js jt jv jw jy ly kc lz kg ma kk mm mc md me bi translated"><code class="dv mo mp mq mr b">system=qlik type=app</code></li><li id="0a02" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mm mc md me bi translated"><code class="dv mo mp mq mr b">system=qlik type=custom_property_definition</code></li><li id="fe7d" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mm mc md me bi translated"><code class="dv mo mp mq mr b">system=qlik type=sheet</code></li><li id="166a" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mm mc md me bi translated"><code class="dv mo mp mq mr b">type=dimension</code></li><li id="e6b4" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mm mc md me bi translated"><code class="dv mo mp mq mr b">type=measure</code></li><li id="018d" class="lw lx hj jr b js mf jv mg jy mh kc mi kg mj kk mm mc md me bi translated"><code class="dv mo mp mq mr b">type=visualization</code></li></ul><p id="8272" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">点击其中一个<em class="ko">条目</em>将调出其元数据:</p><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et oa"><img src="../Images/32eb032a97d61cadc9a0abe0c130c665.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vRPniKqgaxNLGbbr2HbgOw.png"/></div></div><figcaption class="jk jl eu es et jm jn bd b be z dy translated"><strong class="bd lb">图片6 </strong>。在 Google数据目录中查看Qlik <em class="nz">流元数据(一些字段被编辑以保护隐私)</em></figcaption></figure><p id="aebf" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">请注意，在Qlik意义上，示例<em class="ko">流</em>标有<code class="dv mo mp mq mr b">GCPUser</code> <em class="ko">自定义属性</em>；因此，它的目录<em class="ko">条目</em>也在数据目录中标注了与<code class="dv mo mp mq mr b">GCPUser</code>相关的<em class="ko">标签</em>(图6中折叠)。<strong class="jr hk">我们甚至可以查找标有相同<em class="ko">自定义属性</em>的所有资产，这是用户仅使用Qlik Sense特性</strong>无法实现的。让我将查询字符串改为<code class="dv mo mp mq mr b">tag:property_name:GCPUser</code>来展示它是如何工作的:</p><figure class="iz ja jb jc fe jd es et paragraph-image"><div role="button" tabindex="0" class="je jf di jg bf jh"><div class="es et ob"><img src="../Images/95fceee40597ee564406bf0d112b1001.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JeKVa4jwdMEBFmgifCCykw.png"/></div></div><figcaption class="jk jl eu es et jm jn bd b be z dy translated"><strong class="bd lb">图7 </strong>。搜索所有标有给定自定义属性的Qlik资产</figcaption></figure><p id="3dc1" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">我也可以通过<em class="ko">自定义属性</em>值进行搜索，例如<code class="dv mo mp mq mr b">tag:value:true</code>。顺便说一下，在数据目录中有各种各样的搜索可能性。详情请参考<a class="ae jo" href="https://cloud.google.com/data-catalog/docs/how-to/search-reference" rel="noopener ugc nofollow" target="_blank">搜索语法文档</a>。</p><p id="6c5a" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">在结束本部分之前，值得一提的是，用户可以使用自己的<em class="ko">标记模板</em>和<em class="ko">标记</em>来注释Qlik资产，例如，利用数据目录来加强公司数据治理策略。</p></div><div class="ab cl ks kt gq ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hc hd he hf hg"><h1 id="884e" class="kz la hj bd lb lc ld le lf lg lh li lj ip lk iq ll is lm it ln iv lo iw lp lq bi translated">包扎</h1><p id="7c36" class="pw-post-body-paragraph jp jq hj jr b js lr ik ju jv ls in jx jy lt ka kb kc lu ke kf kg lv ki kj kk hc bi translated">我描述了我的团队在过去几个月中在开发集成Qlik Sense和Google Data Catalog的解决方案时面临的挑战和决策。我们开发了一个示例连接器，可用于从Qlik Sense读取元数据并将其存储在数据目录中，使Qlik资产在Google Cloud中完全可发现。</p><p id="8ce4" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">初始版本处理7种常规Qlik资产类型，但总有改进的空间。例如，我们研究了从脚本及其底层连接解析元数据的可能性；这可能导致基本的数据沿袭支持，连接器将有助于快速回答诸如“这个<em class="ko">应用</em>使用了哪些数据源？”之类的问题或者“如果我们删除这个数据库表，哪些Qlik <em class="ko">应用程序</em>会崩溃？”。此外，我认为值得概括一下处理<em class="ko">主项目</em>和<em class="ko">表</em> : <em class="ko"> </em>之间的组合的可能性。所需的元数据似乎在Qlik引擎API中可用，但仍需要进一步研究。到目前为止，我们还没有时间研究这些话题…</p><p id="47fa" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">顺便说一句，如果您有建议或在运行连接器时发现错误，请不要犹豫<a class="ae jo" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-bi/issues" rel="noopener ugc nofollow" target="_blank">提出功能请求或发出</a>。随时欢迎反馈！</p><p id="e246" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">最后，在这篇博文中，我并没有探索可能的部署解决方案，但是可以很容易地安排定期执行，因为连接器附带了命令行界面。</p><p id="d96c" class="pw-post-body-paragraph jp jq hj jr b js jt ik ju jv jw in jx jy jz ka kb kc kd ke kf kg kh ki kj kk hc bi translated">我希望你喜欢阅读。非常感谢！</p></div></div>    
</body>
</html>