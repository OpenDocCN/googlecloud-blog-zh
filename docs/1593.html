<html>
<head>
<title>BigQuery Explained: Data Ingestion</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">BigQuery解释:数据摄取</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/bigquery-explained-data-ingestion-cdc26a588d0?source=collection_archive---------0-----------------------#2020-09-16">https://medium.com/google-cloud/bigquery-explained-data-ingestion-cdc26a588d0?source=collection_archive---------0-----------------------#2020-09-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><blockquote class="im in io"><p id="f5c4" class="ip iq ir is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在谷歌云博客上关注BigQuery解释系列<a class="ae jo" href="https://cloud.google.com/blog/topics/developers-practitioners/bigquery-explained-blog-series" rel="noopener ugc nofollow" target="_blank">。有问题或者想聊天？在</a><a class="ae jo" href="https://twitter.com/rajesh_thallam" rel="noopener ugc nofollow" target="_blank">推特</a>或<a class="ae jo" href="https://www.linkedin.com/in/rajeshthallam/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系。</p></blockquote></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="085d" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated">在之前的BigQuery解释系列中，我们已经回顾了<a class="ae jo" rel="noopener" href="/google-cloud/bigquery-explained-overview-357055ecfda3">解耦存储和计算架构</a>如何帮助BigQuery无缝扩展。我们研究了<a class="ae jo" rel="noopener" href="/google-cloud/bigquery-explained-storage-overview-70cac32251fa"> BigQuery的存储管理、分区和集群</a>表，以提高查询性能和优化成本。到目前为止，我们只查询或使用了BigQuery中已经存在的数据集。在这篇文章中，我们将看到如何将数据加载或接收到BigQuery中并对其进行分析。让我们开始吧！</p><p id="85f3" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated">在开始之前，让我们看看将数据加载到BigQuery和不加载到BigQuery而直接从外部数据源查询之间的区别。</p><ul class=""><li id="d04d" class="js jt hi is b it iu ix iy jp ju jq jv jr jw jn jx jy jz ka bi translated"><strong class="is hj">直接导入(托管表):</strong> BigQuery可以将各种不同格式的数据集直接摄取到其<a class="ae jo" rel="noopener" href="/google-cloud/bigquery-explained-storage-overview-70cac32251fa">本机存储中</a>。BigQuery原生存储完全由Google管理，包括复制、备份、扩展大小等等。</li><li id="38fc" class="js jt hi is b it kb ix kc jp kd jq ke jr kf jn jx jy jz ka bi translated"><strong class="is hj">不加载查询(外部表)</strong>:使用<a class="ae jo" href="https://cloud.google.com/bigquery/external-data-sources" rel="noopener ugc nofollow" target="_blank">联邦查询</a>是直接查询外部数据源而不加载到BigQuery存储的选项之一。你可以在Google Sheets、Google Drive、Google Cloud Storage、Cloud SQL或Cloud BigTable等Google服务之间进行查询，而不必将数据导入BigQuery。</li></ul><p id="3c49" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated">一个关键区别是查询外部数据源的性能可能不等同于查询本地BigQuery表中的数据。如果优先考虑查询速度，那么将数据装载到BigQuery中。联邦查询的性能取决于实际保存数据的外部存储引擎的性能。</p><h1 id="ddd3" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">将数据加载到BigQuery</h1><p id="45c9" class="pw-post-body-paragraph ip iq hi is b it le iv iw ix lf iz ja jp lg jd je jq lh jh ji jr li jl jm jn hb bi translated">有多种方法可以将数据加载到BigQuery中，具体取决于数据源、数据格式、加载方法和用例，如批处理、流或数据传输。概括地说，以下是将数据导入BigQuery的方法:</p><ul class=""><li id="65f0" class="js jt hi is b it iu ix iy jp ju jq jv jr jw jn jx jy jz ka bi translated">批量摄入</li><li id="f02c" class="js jt hi is b it kb ix kc jp kd jq ke jr kf jn jx jy jz ka bi translated">流式摄取</li><li id="5825" class="js jt hi is b it kb ix kc jp kd jq ke jr kf jn jx jy jz ka bi translated">数据传输服务</li><li id="73b3" class="js jt hi is b it kb ix kc jp kd jq ke jr kf jn jx jy jz ka bi translated">查询具体化</li><li id="05df" class="js jt hi is b it kb ix kc jp kd jq ke jr kf jn jx jy jz ka bi translated">合作伙伴集成</li></ul><p id="7500" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated">这里是一个快速地图，带有将数据导入BigQuery的选项(<em class="ir">不是一个详尽的列表</em>)。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lj"><img src="../Images/32280db7539bf696541c80010c8fb5c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qebOoCTw_tbEcRvw_YW5bg.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">将数据加载到BigQuery中(单击图像以获得更好的分辨率)</figcaption></figure><p id="1a0a" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated"><strong class="is hj"> <em class="ir">在本帖中，我们将深入探讨批量摄取，并在较高层次上介绍其他方法。我们将来会有关于其他摄入机制的专门博客文章。</em> </strong></p><h1 id="f5a2" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">批量摄入</h1><p id="4ba3" class="pw-post-body-paragraph ip iq hi is b it le iv iw ix lf iz ja jp lg jd je jq lh jh ji jr li jl jm jn hb bi translated">批量接收包括加载大型的、有限的、不需要实时处理的数据集。它们通常以特定的规则频率被摄取，所有数据要么立即到达，要么根本不到达。然后查询摄取的数据以创建报告，或者与包括实时数据在内的其他来源相结合。</p><blockquote class="im in io"><p id="24f6" class="ip iq ir is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="hi"> BigQuery批量加载作业是免费的。您只需为存储和查询数据付费，而无需为加载数据付费。</em></p></blockquote><p id="c30e" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated">对于批量用例，云存储是存放传入数据的推荐位置。这是一种持久、高度可用且经济高效的对象存储服务。从云存储加载到BigQuery支持<a class="ae jo" href="https://cloud.google.com/bigquery/docs/loading-data-cloud-storage#next_steps" rel="noopener ugc nofollow" target="_blank">多种文件格式</a> — CSV、JSON、Avro、Parquet、ORC。</p><h2 id="bf37" class="lz kh hi bd ki ma mb mc km md me mf kq jp mg mh ku jq mi mj ky jr mk ml lc mm bi translated">加载压缩或未压缩的文件？</h2><p id="ce79" class="pw-post-body-paragraph ip iq hi is b it le iv iw ix lf iz ja jp lg jd je jq lh jh ji jr li jl jm jn hb bi translated">BigQuery可以从云存储中接收压缩(GZIP)和未压缩的文件。高度并行的加载操作使得未压缩文件的加载速度明显快于压缩文件。由于未压缩文件更大，可能会有带宽限制，存储它们的成本也更高。另一方面，压缩文件传输更快，存储更便宜，但加载到BigQuery时速度较慢。根据您的使用情况权衡压缩选项—当客户受到网络速度的限制时，他们通常会选择压缩文件。</p><h2 id="006a" class="lz kh hi bd ki ma mb mc km md me mf kq jp mg mh ku jq mi mj ky jr mk ml lc mm bi translated">选择加载数据的文件格式</h2><p id="677c" class="pw-post-body-paragraph ip iq hi is b it le iv iw ix lf iz ja jp lg jd je jq lh jh ji jr li jl jm jn hb bi translated">由于支持多种多样的数据摄取文件格式，有些文件格式自然比其他文件格式更快。以下是将数据加载到BigQuery时的文件格式建议:</p><ul class=""><li id="bdc6" class="js jt hi is b it iu ix iy jp ju jq jv jr jw jn jx jy jz ka bi translated">当优化加载速度时，Avro文件格式是首选。Avro是一种基于行的二进制格式，可以由包括压缩文件在内的多个插槽并行拆分和读取。</li><li id="6f7d" class="js jt hi is b it kb ix kc jp kd jq ke jr kf jn jx jy jz ka bi translated">拼花地板和ORC是二进制和柱形格式。当将数据接收到BigQuery中时，需要读取整个记录，因为它们是列格式，所以加载速度比Avro慢。</li><li id="f553" class="js jt hi is b it kb ix kc jp kd jq ke jr kf jn jx jy jz ka bi translated">压缩的CSV和JSON的执行速度相对较慢，因为Gzip压缩是不可分割的，因此每个压缩文件必须先解压缩，然后才能进行并行处理。</li></ul><p id="e679" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated">下图根据负载性能对不同格式进行了排名</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mn"><img src="../Images/2e15015cec90ece255e7e447c54bb3a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DRhPvsMumBaL-7ki"/></div></div></figure><h2 id="b0b6" class="lz kh hi bd ki ma mb mc km md me mf kq jp mg mh ku jq mi mj ky jr mk ml lc mm bi translated">加载方法</h2><p id="0a45" class="pw-post-body-paragraph ip iq hi is b it le iv iw ix lf iz ja jp lg jd je jq lh jh ji jr li jl jm jn hb bi translated">将数据加载到BigQuery时，可以创建一个新表，或者追加或覆盖现有表。您需要指定表或分区模式，或者，对于支持的数据格式，您可以使用模式<a class="ae jo" href="https://cloud.google.com/bigquery/docs/schema-detect" rel="noopener ugc nofollow" target="_blank">自动检测</a>。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es mo"><img src="../Images/a1cf460d5381932408e827665cf0c0c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X9LjEWZTt-af8KvG"/></div></div></figure><p id="50c1" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated">BigQuery支持从各种来源以各种格式加载数据。除了云存储等谷歌服务，BigQuery还支持从亚马逊S3等外部存储加载。让我们看看从不同数据源加载这些批处理文件的选项。</p><h2 id="9549" class="lz kh hi bd ki ma mb mc km md me mf kq jp mg mh ku jq mi mj ky jr mk ml lc mm bi translated">使用BigQuery UI加载</h2><p id="bace" class="pw-post-body-paragraph ip iq hi is b it le iv iw ix lf iz ja jp lg jd je jq lh jh ji jr li jl jm jn hb bi translated">正如您之前看到的，您也可以使用用于检查表和构建查询以加载数据的相同web UI。一旦有了可以加载到本地机器或云存储上的数据，就可以使用web UI将数据加载到目标表中。在UI中，您可以启用<a class="ae jo" href="https://cloud.google.com/bigquery/docs/schema-detect" rel="noopener ugc nofollow" target="_blank">模式自动检测</a>或者明确指定它。更多详情，请参考<a class="ae jo" href="https://cloud.google.com/bigquery/docs/quickstarts/quickstart-web-ui#load_data_into_a_table" rel="noopener ugc nofollow" target="_blank">快速入门指南</a>。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div class="er es mp"><img src="../Images/211accf86d8e19c98fec8e3356cccd7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/0*44PrTiEEETpxGF4f"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">使用BigQuery UI将数据加载到BigQuery中</figcaption></figure><h2 id="65c7" class="lz kh hi bd ki ma mb mc km md me mf kq jp mg mh ku jq mi mj ky jr mk ml lc mm bi translated">使用CLI — bq加载</h2><p id="9eec" class="pw-post-body-paragraph ip iq hi is b it le iv iw ix lf iz ja jp lg jd je jq lh jh ji jr li jl jm jn hb bi translated">要使用CLI 将数据加载到<a class="ae jo" href="https://cloud.google.com/bigquery/docs/loading-data-cloud-storage-csv#bq" rel="noopener ugc nofollow" target="_blank"> BigQuery中，可以使用<code class="du mq mr ms mt b">bq load</code>命令。例如，要将CSV文件从云存储导入到BigQuery，请为指向CSV文件的多个URIs指定云存储URI或逗号分隔列表。CLI支持您在web UI中看到的相同选项——模式检测或手动</a><a class="ae jo" href="https://cloud.google.com/bigquery/docs/schemas" rel="noopener ugc nofollow" target="_blank">指定模式</a>，追加或覆盖，以及从本地机器接收文件都是可用的。</p><pre class="lk ll lm ln fd mu mt mv mw aw mx bi"><span id="f47f" class="lz kh hi mt b fi my mz l na nb">bq load \<br/> — source_format=CSV \<br/> myproject.mydataset.mytable \<br/> gs://mybucket/mydata.csv \<br/> ./myschema.json</span></pre><h2 id="12b6" class="lz kh hi bd ki ma mb mc km md me mf kq jp mg mh ku jq mi mj ky jr mk ml lc mm bi translated">使用REST API加载</h2><p id="ffb7" class="pw-post-body-paragraph ip iq hi is b it le iv iw ix lf iz ja jp lg jd je jq lh jh ji jr li jl jm jn hb bi translated">可以从Java或Python等运行时环境中使用REST API与BigQuery进行通信。该服务接收HTTP请求并返回JSON响应。web UI和CLI都使用这个API与BigQuery通信。例如，看看如何使用<a class="ae jo" href="https://cloud.google.com/bigquery/docs/loading-data-cloud-storage-csv#loading_csv_data_into_a_table" rel="noopener ugc nofollow" target="_blank"> Python API将数据</a>从云存储加载到BigQuery表中:</p><figure class="lk ll lm ln fd lo"><div class="bz dy l di"><div class="nc nd l"/></div></figure><p id="548a" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated">除了使用上述工具，您还可以使用以下数据管道选项将数据加载到BigQuery中:</p><blockquote class="im in io"><p id="c4bb" class="ip iq ir is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://cloud.google.com/dataflow" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> <em class="hi">云数据流</em> </strong> </a></p></blockquote><ul class=""><li id="1503" class="js jt hi is b it iu ix iy jp ju jq jv jr jw jn jx jy jz ka bi translated">Dataflow是GCP上的一项完全托管的服务，使用开源的Apache Beam API构建，支持各种数据源 —文件、数据库、基于消息等。使用Dataflow，您可以使用相同的代码在批处理和流模式下转换和丰富数据。谷歌为批处理作业提供<a class="ae jo" href="https://cloud.google.com/dataflow/docs/guides/templates/provided-templates" rel="noopener ugc nofollow" target="_blank">预建数据流模板</a>。</li></ul><blockquote class="im in io"><p id="0835" class="ip iq ir is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://cloud.google.com/dataproc" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> <em class="hi">云数据报</em> </strong> </a></p></blockquote><ul class=""><li id="0e2c" class="js jt hi is b it iu ix iy jp ju jq jv jr jw jn jx jy jz ka bi translated">Dataproc是在GCP上为Apache Spark和Apache Hadoop服务提供的完全托管的服务。Dataproc提供了<a class="ae jo" href="https://cloud.google.com/dataproc/docs/concepts/connectors/bigquery" rel="noopener ugc nofollow" target="_blank"> BigQuery连接器</a>，使Spark和Hadoop应用程序能够处理来自BigQuery的数据，并使用其本地术语将数据写入BigQuery。</li></ul><blockquote class="im in io"><p id="41a1" class="ip iq ir is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://cloud.google.com/logging" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> <em class="hi">云日志</em> </strong> </a></p></blockquote><ul class=""><li id="3d57" class="js jt hi is b it iu ix iy jp ju jq jv jr jw jn jx jy jz ka bi translated">这不是一个数据管道选项，但是云日志(以前称为Stackdriver)提供了一个将日志文件导出到BigQuery的选项。请参见<a class="ae jo" href="https://cloud.google.com/logging/docs/export/configure_export" rel="noopener ugc nofollow" target="_blank">使用日志查看器导出</a>了解更多信息，并参考<a class="ae jo" href="https://cloud.google.com/solutions/exporting-stackdriver-logging-for-security-and-access-analytics" rel="noopener ugc nofollow" target="_blank">指南</a>关于将日志导出到BigQuery进行安全性和访问分析。</li></ul><h2 id="49c9" class="lz kh hi bd ki ma mb mc km md me mf kq jp mg mh ku jq mi mj ky jr mk ml lc mm bi translated">在幕后</h2><p id="da10" class="pw-post-body-paragraph ip iq hi is b it le iv iw ix lf iz ja jp lg jd je jq lh jh ji jr li jl jm jn hb bi translated">在后台，当BigQuery收到将文件加载到其托管存储中的请求时，它会执行以下操作:</p><ul class=""><li id="1941" class="js jt hi is b it iu ix iy jp ju jq jv jr jw jn jx jy jz ka bi translated"><strong class="is hj">编码、压缩和统计:</strong> BigQuery在分析数据类型、取值频率后，对数据进行最优编码，并以读取大量结构化数据的最优方式对数据进行压缩。</li><li id="d2ac" class="js jt hi is b it kb ix kc jp kd jq ke jr kf jn jx jy jz ka bi translated"><strong class="is hj">分片:</strong> BigQuery将数据分配到最佳分片中，并根据表的定义方式将数据加载到特定的分区、集群和重新集群。</li></ul><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es ne"><img src="../Images/213b1c2d871192d88aa808047a39a9e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iJCw8KCYaji1--4l"/></div></div></figure><ul class=""><li id="a076" class="js jt hi is b it iu ix iy jp ju jq jv jr jw jn jx jy jz ka bi translated"><strong class="is hj">加密:</strong>默认情况下，BigQuery总是在数据写入磁盘之前对其进行加密，不需要您执行任何额外的操作。当被授权用户读取时，数据被自动解密。对于传输中的数据，当它在机器之间传输时，您的数据在Google数据中心内是加密的。</li><li id="d392" class="js jt hi is b it kb ix kc jp kd jq ke jr kf jn jx jy jz ka bi translated"><strong class="is hj">地理复制:</strong> BigQuery自动跨多个数据中心复制数据，这取决于您如何定义您的<a class="ae jo" href="https://cloud.google.com/bigquery/docs/locations#data-locations" rel="noopener ugc nofollow" target="_blank">数据集位置</a> —区域或多区域。</li></ul><p id="2d4b" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated">BigQuery用户受益于性能、耐用性、效率和可伸缩性的持续改进，而无需停机和升级，因为BigQuery不断优化其后端。</p><h1 id="8fca" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">BigQuery加载作业的要点</h1><blockquote class="im in io"><p id="b920" class="ip iq ir is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="hi">批量摄取免费</em> </strong></p></blockquote><ul class=""><li id="6177" class="js jt hi is b it iu ix iy jp ju jq jv jr jw jn jx jy jz ka bi translated">使用提到的批处理摄取选项将数据加载到BigQuery是免费的。然而，<a class="ae jo" href="https://cloud.google.com/bigquery/quotas#load_jobs" rel="noopener ugc nofollow" target="_blank">配额和限制</a>适用。</li></ul><blockquote class="im in io"><p id="2537" class="ip iq ir is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="hi">负载性能最佳</em> </strong></p></blockquote><ul class=""><li id="afc6" class="js jt hi is b it iu ix iy jp ju jq jv jr jw jn jx jy jz ka bi translated">由于用于加载数据的计算是从共享池中免费提供给用户的，因此BigQuery不保证该共享池的性能和可用容量。这由<a class="ae jo" href="https://cloud.google.com/bigquery/docs/slots#fair_scheduling_in_bigquery" rel="noopener ugc nofollow" target="_blank">公平调度器</a>管理，在可能与其他用户或项目的负载竞争的负载作业之间分配资源。装载作业的配额已经到位，以将影响降至最低。</li></ul><p id="2be0" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated"><strong class="is hj">提示:</strong>为了保证任何关键负载的摄取速度，您可能想要购买专用的插槽(预留)，并<a class="ae jo" href="https://cloud.google.com/bigquery/docs/reservations-intro#assignments" rel="noopener ugc nofollow" target="_blank">将管道作业</a>分配给它们。更多关于预订的信息将在以后的博客中发布。</p><blockquote class="im in io"><p id="9903" class="ip iq ir is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="hi">加载作业不消耗查询能力</em> </strong></p></blockquote><ul class=""><li id="dfe2" class="js jt hi is b it iu ix iy jp ju jq jv jr jw jn jx jy jz ka bi translated">用于查询数据的插槽不同于用于接收的插槽。因此，数据接收不会影响查询性能。</li></ul><blockquote class="im in io"><p id="64c8" class="ip iq ir is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://en.wikipedia.org/wiki/ACID" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> <em class="hi">酸</em> </strong> </a> <strong class="is hj"> <em class="hi">语义</em> </strong></p></blockquote><ul class=""><li id="b8c7" class="js jt hi is b it iu ix iy jp ju jq jv jr jw jn jx jy jz ka bi translated">对于通过<code class="du mq mr ms mt b">bq load</code>命令加载的数据，查询要么反映所有数据的存在，要么不反映任何数据。查询从不扫描部分数据。</li></ul><h1 id="8459" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">流式摄取</h1><p id="8851" class="pw-post-body-paragraph ip iq hi is b it le iv iw ix lf iz ja jp lg jd je jq lh jh ji jr li jl jm jn hb bi translated">流接收支持需要使用接近实时的控制面板和查询来分析大量连续到达的数据的使用情形。跟踪移动应用事件就是这种模式的一个例子。应用程序本身或支持其后端的服务器可以记录用户与事件摄取系统(如<a class="ae jo" href="https://cloud.google.com/pubsub" rel="noopener ugc nofollow" target="_blank"> Cloud Pub/Sub </a>)的交互，并使用数据管道工具(如Cloud Dataflow)将它们传输到BigQuery，或者您可以使用云功能来处理少量事件。然后，您可以分析这些数据以确定总体趋势，例如高交互或问题区域，并实时监控错误情况。</p><p id="8a12" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated">BigQuery流接收允许您通过使用<code class="du mq mr ms mt b"><a class="ae jo" href="https://cloud.google.com/bigquery/docs/reference/rest/v2/tabledata/insertAll" rel="noopener ugc nofollow" target="_blank">tabledata.insertAll</a></code>方法将数据一次一条记录地传输到BigQuery中。API允许来自多个生产者的不协调的插入。在第一个流插入的几秒钟内，就可以立即从流缓冲区查询摄取的数据。但是，数据可能需要90分钟才能用于拷贝和导出操作。你可以阅读我们关于<a class="ae jo" href="https://cloud.google.com/blog/products/gcp/life-of-a-bigquery-streaming-insert" rel="noopener ugc nofollow" target="_blank">流插入</a>如何工作的博客文章和我们的<a class="ae jo" href="https://cloud.google.com/bigquery/streaming-data-into-bigquery" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多信息。</p><p id="7e08" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated">在Google云平台上摄取实时数据的一种常见模式是使用云数据流管道从云发布/订阅主题中读取消息，该管道以流模式运行，并在所需的处理完成后写入BigQuery表。云数据流管道最好的部分是，你也可以重用相同的代码进行流处理和批处理，谷歌将管理启动、运行和停止计算资源的工作，以并行处理你的管道。这个<a class="ae jo" href="https://cloud.google.com/solutions/mobile/mobile-gaming-analysis-telemetry#streaming_pipeline" rel="noopener ugc nofollow" target="_blank">参考架构</a>非常详细地涵盖了用例。</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es nf"><img src="../Images/ef303de64509cbd92b8f5349a9a5b916.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vL23Nzx1p2bUhqHV"/></div></div></figure><p id="7a98" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated">请注意，除了云数据流，您还可以选择将数据传输到BigQuery。例如，您可以在Apache Spark中编写流管道，并使用<a class="ae jo" href="https://github.com/GoogleCloudDataproc/spark-bigquery-connector" rel="noopener ugc nofollow" target="_blank">Apache Spark big query Connector</a>在Hadoop集群(如Cloud Dataproc)上运行。您还可以在任何客户端库中调用<a class="ae jo" href="https://cloud.google.com/bigquery/streaming-data-into-bigquery#streaminginsertexamples" rel="noopener ugc nofollow" target="_blank">流API </a>将数据流式传输到BigQuery。</p><h1 id="c37b" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">数据传输服务</h1><p id="4a02" class="pw-post-body-paragraph ip iq hi is b it le iv iw ix lf iz ja jp lg jd je jq lh jh ji jr li jl jm jn hb bi translated">BigQuery <a class="ae jo" href="https://cloud.google.com/bigquery-transfer/docs/transfer-service-overview" rel="noopener ugc nofollow" target="_blank">数据传输服务</a> (DTS)是一项完全托管的服务，可从谷歌广告等谷歌SaaS应用、亚马逊S3等外部云存储提供商接收数据，并从Teradata和亚马逊Redshift等数据仓库技术传输数据。DTS在计划和管理的基础上自动将数据移入BigQuery。DTS可用于数据回填，以从任何中断或间隙中恢复。</p><p id="56c7" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated">可以将数据传输服务看作是一种轻松的数据交付服务，可以将数据从应用程序导入到BigQuery。</p><h1 id="298b" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">查询具体化</h1><p id="4829" class="pw-post-body-paragraph ip iq hi is b it le iv iw ix lf iz ja jp lg jd je jq lh jh ji jr li jl jm jn hb bi translated">当您在BigQuery中运行查询时，它们的结果集可以被物化以创建新表。在关于分区和集群的<a class="ae jo" rel="noopener" href="/google-cloud/bigquery-explained-storage-overview-70cac32251fa">上一篇文章</a>中，我们已经看到了这种模式，我们从栈溢出公共数据集的查询结果中创建了新表。</p><p id="44c6" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated">查询结果物化是简化BigQuery中的<a class="ae jo" href="https://en.wikipedia.org/wiki/Extract,_transform,_load" rel="noopener ugc nofollow" target="_blank"> ETL </a>(提取、转换和加载)或<a class="ae jo" href="https://en.wikipedia.org/wiki/Extract,_load,_transform" rel="noopener ugc nofollow" target="_blank"> ELT </a>(提取、加载和转换)模式的一个很好的方法。例如，当使用BigQuery 中的<a class="ae jo" href="https://cloud.google.com/bigquery/external-data-cloud-storage" rel="noopener ugc nofollow" target="_blank">联邦查询对云存储中的文件执行探索性工作或原型制作时，您可以将这些分析结果保存在BigQuery中以获得任何见解。请注意，您需要为查询读取的字节数和表写入后存储在BigQuery存储中的字节数付费。</a></p><h1 id="f020" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">不加载数据的查询</h1><p id="728c" class="pw-post-body-paragraph ip iq hi is b it le iv iw ix lf iz ja jp lg jd je jq lh jh ji jr li jl jm jn hb bi translated">正如本文开头所提到的，在以下情况下，您不需要在运行查询之前将数据加载到BigQuery中:</p><ul class=""><li id="4400" class="js jt hi is b it iu ix iy jp ju jq jv jr jw jn jx jy jz ka bi translated"><strong class="is hj">公共数据集:</strong>公共数据集是存储在BigQuery中并与公众共享的数据集。更多信息请参见<a class="ae jo" href="https://cloud.google.com/bigquery/public-data" rel="noopener ugc nofollow" target="_blank"> BigQuery公共数据集</a>。</li><li id="036e" class="js jt hi is b it kb ix kc jp kd jq ke jr kf jn jx jy jz ka bi translated"><strong class="is hj">共享数据集:</strong>可以共享存储在BigQuery中的数据集。如果有人与您共享数据集，您可以在该数据集上运行查询，而无需加载数据。</li><li id="db71" class="js jt hi is b it kb ix kc jp kd jq ke jr kf jn jx jy jz ka bi translated"><strong class="is hj">外部数据源(联邦):</strong>您可以通过基于<a class="ae jo" href="https://cloud.google.com/bigquery/external-data-sources" rel="noopener ugc nofollow" target="_blank">外部数据源</a>创建一个表来跳过数据加载过程。</li></ul><h1 id="d293" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">合作伙伴集成</h1><p id="7d3a" class="pw-post-body-paragraph ip iq hi is b it le iv iw ix lf iz ja jp lg jd je jq lh jh ji jr li jl jm jn hb bi translated">除了BigQuery自带的解决方案之外，您还可以查看来自<a class="ae jo" href="https://cloud.google.com/bigquery#section-11" rel="noopener ugc nofollow" target="_blank"> Google Cloud partners </a>的数据集成选项，他们已经将其业界领先的工具与BigQuery进行了集成。</p><h1 id="c694" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">接下来呢？</h1><p id="6f9b" class="pw-post-body-paragraph ip iq hi is b it le iv iw ix lf iz ja jp lg jd je jq lh jh ji jr li jl jm jn hb bi translated">在本文中，我们学习了基于您的用例将数据放入BigQuery的不同方法。具体来说，我们深入研究了将批量数据源和格式摄取到BigQuery中，粗略了解了流摄取、数据传输服务和查询外部数据源，而无需将数据加载到BigQuery中。</p><ul class=""><li id="ffa7" class="js jt hi is b it iu ix iy jp ju jq jv jr jw jn jx jy jz ka bi translated">查看<a class="ae jo" href="https://www.youtube.com/watch?v=Abzj-Vyhi74" rel="noopener ugc nofollow" target="_blank">视频</a>批量加载CSV数据，并在BigQuery中分析数据。</li><li id="d931" class="js jt hi is b it kb ix kc jp kd jq ke jr kf jn jx jy jz ka bi translated">了解关于将数据加载到BigQuery的更多信息</li><li id="1b73" class="js jt hi is b it kb ix kc jp kd jq ke jr kf jn jx jy jz ka bi translated">尝试这个<a class="ae jo" href="https://codelabs.developers.google.com/codelabs/gcp-aws-bigquery/index.html" rel="noopener ugc nofollow" target="_blank"> codelab </a>将文件从Google云存储摄取到您的<a class="ae jo" href="https://cloud.google.com/bigquery/docs/sandbox" rel="noopener ugc nofollow" target="_blank"> BigQuery沙箱</a>上的BigQuery</li></ul><figure class="lk ll lm ln fd lo"><div class="bz dy l di"><div class="ng nd l"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">BigQuery聚焦:将数据加载到BigQuery</figcaption></figure><p id="5726" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated">在下一篇文章中，我们将研究在BigQuery和模式设计中查询数据。在接下来的文章中，我们将深入探讨其他摄取机制——流媒体和数据传输服务。</p><p id="efc0" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated">敬请关注。感谢您的阅读！有问题或者想聊天？在推特或LinkedIn 上找到我。</p><p id="5f49" class="pw-post-body-paragraph ip iq hi is b it iu iv iw ix iy iz ja jp jc jd je jq jg jh ji jr jk jl jm jn hb bi translated"><em class="ir">感谢</em> <a class="ae jo" rel="noopener" href="/@thegrinch"> <em class="ir">尤里</em> </a> <em class="ir">和</em> <a class="ae jo" rel="noopener" href="/@presactlyalicia"> <em class="ir">艾丽西娅·威廉姆斯</em> </a> <em class="ir">对帖子的帮助。</em></p></div></div>    
</body>
</html>