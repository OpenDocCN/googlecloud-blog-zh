<html>
<head>
<title>From phone screen to console — Using Google Cloud Vision to read text from your phone.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从手机屏幕到控制台——使用谷歌云视觉阅读手机中的文本。</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/from-phone-screen-to-console-using-google-cloud-vision-to-read-text-from-your-phone-59b1cacb1c71?source=collection_archive---------0-----------------------#2018-05-27">https://medium.com/google-cloud/from-phone-screen-to-console-using-google-cloud-vision-to-read-text-from-your-phone-59b1cacb1c71?source=collection_archive---------0-----------------------#2018-05-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="ab fe cl ij"><img src="../Images/8f814cfdbafcb1afff750739215083c1.png" data-original-src="https://miro.medium.com/v2/format:webp/1*WE-EQFubMHMnMv-bPIW5SA.png"/></div></figure><p id="691c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我想知道我是否能做些什么来帮我做到这一点？这个常见的问题通常是我一个新爱好项目的前奏。</p><p id="3326" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">几个月前，我发现自己手动从手机上复制文本，而且很繁琐。这让我想知道我是否可以建立一个系统来加速这个过程。</p><p id="eee5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">本指南将概述我从手机中截取屏幕截图、准备图像以及设置/使用谷歌云平台的vision API客户端的步骤。我将使用Python 3.x和Macbook。</p><p id="ce9a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果你需要从手机上获取文本，这是一种方法。</p><h1 id="84b4" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">镜像你的手机。</h1><p id="078f" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">首先，让我们把你的手机屏幕镜像到你的电脑上。</p><p id="690f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为此，我使用QuickTime。将手机插入电脑，启动QuickTime。</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div class="er es kn"><img src="../Images/aa5b3b2a6bfafced6e60059ea2427828.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*MwuSWI9vn8cT0KuZd87zQg.png"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">在dock上右击QuickTime应用程序并选择“新电影录制”。</figcaption></figure><p id="b72e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">确保手机解锁，否则下一部分会说无法进行。</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div class="er es kw"><img src="../Images/86caefc2141116c7d3857ef92a9b8193.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*dq7O23D9T-gETrTFoAwBpg.png"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">从下拉列表中选择您的手机。</figcaption></figure><figure class="ko kp kq kr fd ii er es paragraph-image"><div class="er es kn"><img src="../Images/58a748746415b91b54df9d1d5af86d3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*blTMfMuo2CNtd9oZhYSVwg.png"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">你的手机现在应该镜像，有时这需要一分钟。</figcaption></figure><p id="a11a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我总是将镜子放在屏幕的左上角，以确保我们稍后进行的裁剪能够正确对齐。</p><h1 id="9ab2" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">获取你的截图。</h1><p id="cf05" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">为了截图，我使用了<a class="ae kx" href="https://pypi.org/project/pyscreenshot/" rel="noopener ugc nofollow" target="_blank"> pyscreenshot </a>模块。</p><pre class="ko kp kq kr fd ky kz la lb aw lc bi"><span id="8273" class="ld jl hi kz b fi le lf l lg lh">pip3 install pyscreenshot</span></pre><p id="781e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下面演示了如何截屏并裁剪图像以提取感兴趣的文本。在我的例子中，文本总是出现在屏幕的同一个位置，所以我只需要找出在哪里裁剪它一次。</p><pre class="ko kp kq kr fd ky kz la lb aw lc bi"><span id="95e1" class="ld jl hi kz b fi le lf l lg lh">import pyscreenshot as ImageGrab</span><span id="7d8e" class="ld jl hi kz b fi li lf l lg lh"># I found these values through lots of trial and error</span><span id="336b" class="ld jl hi kz b fi li lf l lg lh">x1 = ...  # top left corner x<br/>y1 = ...  # top left corner y<br/>x2 = ...  # bottom right corner x<br/>y2 = ...  # bottom right corner y</span><span id="fd77" class="ld jl hi kz b fi li lf l lg lh">image = ImageGrab.grab()<br/>cropped_image = image.crop((x1, y1, x2, y2))</span><span id="be56" class="ld jl hi kz b fi li lf l lg lh"># Save the image to a file to be used later<br/>cropped_image.save("current_image.bmp")</span></pre><h1 id="42f1" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">正在准备谷歌云平台。</h1><p id="0091" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">我假设你已经有了一个GCP账户。如果没有，你可以在这里注册<a class="ae kx" href="https://cloud.google.com/free/" rel="noopener ugc nofollow" target="_blank">获得300美元的免费积分</a>。</p><p id="5b79" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">登录后，<a class="ae kx" href="https://console.cloud.google.com/flows/enableapi?apiid=vision.googleapis.com&amp;redirect=https://console.cloud.google.com&amp;_ga=2.215477203.-510096860.1516326627" rel="noopener ugc nofollow" target="_blank">点击此链接</a>,从下拉列表中选择“创建项目”,然后继续。这将创建一个名为“我的项目”的新项目，并在这个项目上启用Google Cloud Vision API。</p><p id="748e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，您需要设置身份验证。按照<a class="ae kx" href="https://console.cloud.google.com/apis/credentials/serviceaccountkey?_ga=2.214830803.-510096860.1516326627" rel="noopener ugc nofollow" target="_blank">这个链接</a>创建一个密钥。</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div class="er es lj"><img src="../Images/66863a824e0933eda2740d422fab2e85.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*b5qFmP4z-lFYc_XXmk9fgA.png"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">设置密钥时，不需要指定角色。出现提示时，选择“继续，无需角色”。</figcaption></figure><p id="a2df" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">确保在底部选择JSON，然后单击继续，将开始下载JSON文件。您需要将该文件存储在安全的地方。</p><blockquote class="lk ll lm"><p id="bec5" class="im in ln io b ip iq ir is it iu iv iw lo iy iz ja lp jc jd je lq jg jh ji jj hb bi translated">小心！这个JSON文件包含敏感信息。如果您选择将它放在与项目相同的目录中，请确保将它包含在您的。如果你计划将你的项目上传到一个公共库，gitignore file。</p></blockquote><h1 id="52c8" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">执行我们的API调用。</h1><p id="a0c3" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">我们从获取所需的依赖项开始。</p><pre class="ko kp kq kr fd ky kz la lb aw lc bi"><span id="fba9" class="ld jl hi kz b fi le lf l lg lh">pip3 install --upgrade google-api-python-client<br/>pip3 install --upgrade google-cloud<br/>pip3 install --upgrade google-cloud-vision</span></pre><p id="2013" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，我们要设置一个环境变量，指示我们刚刚生成的身份验证文件的位置。</p><pre class="ko kp kq kr fd ky kz la lb aw lc bi"><span id="6344" class="ld jl hi kz b fi le lf l lg lh">import os</span><span id="9fb7" class="ld jl hi kz b fi li lf l lg lh">os.environ["GOOGLE_APPLICATION_CREDENTIALS"] = "/path/to/json/file"</span></pre><p id="ab01" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，我们加载之前从截图中保存的裁剪后的图像，并在我们的API调用中使用它。</p><pre class="ko kp kq kr fd ky kz la lb aw lc bi"><span id="5a0b" class="ld jl hi kz b fi le lf l lg lh">import io<br/>import os</span><span id="d969" class="ld jl hi kz b fi li lf l lg lh">from google.cloud import vision<br/>from google.cloud.vision import types</span><span id="8569" class="ld jl hi kz b fi li lf l lg lh"># Instantiates a client<br/>client = vision.ImageAnnotatorClient()<br/><br/># The name of the image file<br/>file_name = os.path.join(os.path.dirname(__file__),   <br/>      'current_image.bmp')<br/><br/># Loads the image into memory<br/>with io.open(file_name, 'rb') as image_file:<br/>    content = image_file.read()<br/><br/>image = types.Image(content=content)<br/><br/>response = client.text_detection(image=image)</span></pre><blockquote class="lk ll lm"><p id="baac" class="im in ln io b ip iq ir is it iu iv iw lo iy iz ja lp jc jd je lq jg jh ji jj hb bi translated">注意:您可能会收到以下错误，“403此API方法要求启用计费”</p><p id="ed59" class="im in ln io b ip iq ir is it iu iv iw lo iy iz ja lp jc jd je lq jg jh ji jj hb bi translated">如果是这样，请按照提供的链接操作，在出现提示时单击确定，然后等待几分钟。然后再次运行脚本。</p></blockquote><h1 id="396f" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">回应呢？</h1><p id="3eea" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">从我们的vision API响应中获取文本很简单。</p><pre class="ko kp kq kr fd ky kz la lb aw lc bi"><span id="9a37" class="ld jl hi kz b fi le lf l lg lh">entire_text = response.text_annotations[0].description</span></pre><p id="3a66" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这将把从左到右和从上到下读取的文本存储在整个_text变量中，您可以随意使用。</p><h1 id="9845" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">把这些放在一起。</h1><p id="20cd" class="pw-post-body-paragraph im in hi io b ip ki ir is it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj hb bi translated">现在你需要做的就是在镜像手机旁边打开一个终端窗口，只要你想抓取屏幕上的文本，就运行这个脚本。</p><pre class="ko kp kq kr fd ky kz la lb aw lc bi"><span id="4fef" class="ld jl hi kz b fi le lf l lg lh">import io<br/>import os<br/><br/>import pyscreenshot as ImageGrab</span><span id="030f" class="ld jl hi kz b fi li lf l lg lh">from google.cloud import vision<br/>from google.cloud.vision import types<br/><br/>os.environ["GOOGLE_APPLICATION_CREDENTIALS"] = "/path/to/your/json"</span><span id="4213" class="ld jl hi kz b fi li lf l lg lh">x1 = ...  # top left corner x<br/>y1 = ...  # top left corner y<br/>x2 = ...  # bottom right corner x<br/>y2 = ...  # bottom right corner y</span><span id="a77e" class="ld jl hi kz b fi li lf l lg lh">image = ImageGrab.grab()<br/>cropped_image = image.crop((x1, y1, x2, y2))</span><span id="1634" class="ld jl hi kz b fi li lf l lg lh"># Save the image to a file to be used later<br/>cropped_image.save("current_image.bmp")</span><span id="6a02" class="ld jl hi kz b fi li lf l lg lh"># Instantiates a client<br/>client = vision.ImageAnnotatorClient()<br/><br/># The name of the image file<br/>file_name = os.path.join(os.path.dirname(__file__), 'current_image.bmp')<br/><br/># Loads the image into memory<br/>with io.open(file_name, 'rb') as image_file:<br/>    content = image_file.read()<br/><br/>image = types.Image(content=content)<br/><br/>response = client.text_detection(image=image)<br/>entire_text = response.text_annotations[0].description<br/>print(entire_text)</span></pre><blockquote class="lk ll lm"><p id="3e94" class="im in ln io b ip iq ir is it iu iv iw lo iy iz ja lp jc jd je lq jg jh ji jj hb bi translated">我希望这份指南能提供丰富的信息，并能在自动化过程中为您节省一些时间！</p></blockquote></div></div>    
</body>
</html>