<html>
<head>
<title>How to use Google API Gateway with Cloud Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Google API Gateway与云运行结合使用</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-use-google-api-gateway-with-cloud-run-60698959b342?source=collection_archive---------0-----------------------#2020-12-27">https://medium.com/google-cloud/how-to-use-google-api-gateway-with-cloud-run-60698959b342?source=collection_archive---------0-----------------------#2020-12-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/e91fc77db0a6f07f608a3fb7ffc92809.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sJtGLoYkVIRfwNAacW9Z4A.png"/></div></div></figure><div class=""/><div class=""><h2 id="37dc" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">创建一个API网关，与您的云运行后端服务进行交互。</h2></div><blockquote class="ji jj jk"><p id="2ae0" class="jl jm jn jo b jp jq iu jr js jt ix ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><strong class="jo hu"> <em class="ht">声明:</em> </strong> <em class="ht">所表达观点仅代表作者本人。</em></p></blockquote><h1 id="9e02" class="ki kj ht bd kk kl km kn ko kp kq kr ks iz kt ja ku jc kv jd kw jf kx jg ky kz bi translated">介绍</h1><p id="487c" class="pw-post-body-paragraph jl jm ht jo b jp la iu jr js lb ix ju lc ld jx jy le lf kb kc lg lh kf kg kh hb bi translated">在本文中，您将看到API Gateway是如何工作的，了解它的所有组件，以及如何创建您的第一个与云运行服务集成的部署。</p><h1 id="a7b9" class="ki kj ht bd kk kl km kn ko kp kq kr ks iz kt ja ku jc kv jd kw jf kx jg ky kz bi translated">TLDR；</h1><p id="1485" class="pw-post-body-paragraph jl jm ht jo b jp la iu jr js lb ix ju lc ld jx jy le lf kb kc lg lh kf kg kh hb bi translated">您可以查看这个报告，了解如何使用Terraform创建API网关和部署云运行hello world实例。</p><h1 id="5173" class="ki kj ht bd kk kl km kn ko kp kq kr ks iz kt ja ku jc kv jd kw jf kx jg ky kz bi translated">为什么我应该使用API网关？</h1><p id="2e3e" class="pw-post-body-paragraph jl jm ht jo b jp la iu jr js lb ix ju lc ld jx jy le lf kb kc lg lh kf kg kh hb bi translated">在这里你可以找到一些你应该使用它的理由:</p><ul class=""><li id="5374" class="lj lk ht jo b jp jq js jt lc ll le lm lg ln kh lo lp lq lr bi translated">这是将前端和后端分离的好方法。</li><li id="2fbb" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh lo lp lq lr bi translated">它可以将前端请求分成几个服务。</li><li id="942c" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh lo lp lq lr bi translated">它可以帮助您将monolith后端迁移到微服务架构中。</li><li id="ca42" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh lo lp lq lr bi translated">为您的API集中认证访问。</li><li id="d918" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh lo lp lq lr bi translated">API监控、指标、配额和分析</li><li id="9888" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh lo lp lq lr bi translated">集中管理API版本</li></ul><h1 id="a69d" class="ki kj ht bd kk kl km kn ko kp kq kr ks iz kt ja ku jc kv jd kw jf kx jg ky kz bi translated">要求</h1><ol class=""><li id="d265" class="lj lk ht jo b jp la js lb lc lx le ly lg lz kh ma lp lq lr bi translated">已激活计费的GCP帐户。如果你还没有，你可以用300美元的<a class="ae li" href="https://cloud.google.com/free" rel="noopener ugc nofollow" target="_blank">免费层创建一个新的。</a></li></ol><h2 id="3dee" class="mb kj ht bd kk mc md me ko mf mg mh ks lc mi mj ku le mk ml kw lg mm mn ky mo bi translated">开始之前:创建你的GCP项目</h2><p id="5656" class="pw-post-body-paragraph jl jm ht jo b jp la iu jr js lb ix ju lc ld jx jy le lf kb kc lg lh kf kg kh hb bi translated">你将需要一个GCP项目，所以如果你还没有创建，你可以按照以下步骤:</p><ol class=""><li id="b32f" class="lj lk ht jo b jp jq js jt lc ll le lm lg ln kh ma lp lq lr bi translated">转到云控制台中的<strong class="jo hu">管理资源</strong>页面。<br/> <a class="ae li" href="https://console.cloud.google.com/cloud-resource-manager" rel="noopener ugc nofollow" target="_blank">转到管理资源页面</a></li><li id="cd60" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh ma lp lq lr bi translated">在页面顶部的<strong class="jo hu">选择组织</strong>下拉列表中，选择您想要在其中创建项目的组织。如果您是免费试用用户，请跳过这一步，因为此列表不会出现。</li><li id="92aa" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh ma lp lq lr bi translated">点击<strong class="jo hu">创建项目</strong>。</li><li id="365d" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh ma lp lq lr bi translated">在出现的<strong class="jo hu">新项目</strong>窗口中，输入项目名称并选择适用的计费账户。项目名称只能包含字母、数字、单引号、连字符、空格或感叹号，并且必须在4到30个字符之间。</li><li id="9359" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh ma lp lq lr bi translated">在<strong class="jo hu">位置</strong>框中输入上级组织或文件夹。该资源将成为新项目的分层父项目。</li><li id="b0ef" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh ma lp lq lr bi translated">当您输入完新项目的详细信息后，点击<strong class="jo hu">创建</strong>。</li></ol><h1 id="62f8" class="ki kj ht bd kk kl km kn ko kp kq kr ks iz kt ja ku jc kv jd kw jf kx jg ky kz bi translated">启用所需的API</h1><p id="2c45" class="pw-post-body-paragraph jl jm ht jo b jp la iu jr js lb ix ju lc ld jx jy le lf kb kc lg lh kf kg kh hb bi translated">API Gateway要求您启用以下Google服务。你可以通过菜单-&gt; API &amp; Services-&gt; Library来启用它们。</p><figure class="mq mr ms mt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mp"><img src="../Images/3388e3c4161643798abb6461f832ec87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V6JEmNVxAZKoAOfwmHEYxQ.png"/></div></div></figure><figure class="mq mr ms mt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mu"><img src="../Images/950e856874ae97b035864d675ccf70ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Ua5v43_BxX9tYiQNmvQgw.png"/></div></div></figure><figure class="mq mr ms mt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mv"><img src="../Images/b6aed7523a42c5de78d7696ddeef7804.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n-Ba8JKLkbulQlw51cc11g.png"/></div></div></figure><h1 id="652d" class="ki kj ht bd kk kl km kn ko kp kq kr ks iz kt ja ku jc kv jd kw jf kx jg ky kz bi translated">API网关</h1><p id="45ba" class="pw-post-body-paragraph jl jm ht jo b jp la iu jr js lb ix ju lc ld jx jy le lf kb kc lg lh kf kg kh hb bi translated">Google Cloud API Gateway仍处于<em class="jn"> Beta </em>阶段，但我相信它已经足够成熟，可以进行简单的使用/调查。</p><p id="3b86" class="pw-post-body-paragraph jl jm ht jo b jp jq iu jr js jt ix ju lc jw jx jy le ka kb kc lg ke kf kg kh hb bi translated">作为一项托管服务，它可以与云运行、AppEngine、计算引擎和GKE轻松集成。它还可以使用API_KEY、OAuth2和JWT来管理身份验证。</p><blockquote class="ji jj jk"><p id="d32a" class="jl jm jn jo b jp jq iu jr js jt ix ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">API Gateway使您能够通过定义良好的REST API提供对服务的安全访问，该API在您的所有服务中都是一致的，与服务实现无关。一致的API:</p><p id="8bd8" class="jl jm jn jo b jp jq iu jr js jt ix ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">—让应用程序开发人员能够轻松使用您的服务</p><p id="74e4" class="jl jm jn jo b jp jq iu jr js jt ix ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">—使您能够在不影响公共API的情况下更改后端服务实现</p><p id="1f92" class="jl jm jn jo b jp jq iu jr js jt ix ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">—使您能够利用谷歌云平台(GCP)内置的扩展、监控和安全功能</p></blockquote><figure class="mq mr ms mt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mw"><img src="../Images/d69285ec47633dd8141bdb806082519f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eEMQjMMM24mye8oQYVRsHQ.png"/></div></div><figcaption class="mx my et er es mz na bd b be z dx translated">此图显示了一些客户端向不同的后端服务源发出请求:<a class="ae li" href="https://cloud.google.com/api-gateway/docs/about-api-gateway" rel="noopener ugc nofollow" target="_blank">此处</a></figcaption></figure><figure class="mq mr ms mt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mv"><img src="../Images/3514638cde6a9697da48691054897155.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s_lrkY5Mt_QwYs-xMLXLQw.png"/></div></div><figcaption class="mx my et er es mz na bd b be z dx translated">这张图片显示了一些客户端通过API网关向您的后端服务发出请求。来源:<a class="ae li" href="https://cloud.google.com/api-gateway/docs/about-api-gateway" rel="noopener ugc nofollow" target="_blank">此处</a></figcaption></figure><h2 id="a6aa" class="mb kj ht bd kk mc md me ko mf mg mh ks lc mi mj ku le mk ml kw lg mm mn ky mo bi translated">规格</h2><p id="cb56" class="pw-post-body-paragraph jl jm ht jo b jp la iu jr js lb ix ju lc ld jx jy le lf kb kc lg lh kf kg kh hb bi translated">API网关是使用OpenAPI spec 2.0配置的。下面您将看到启动和运行所需的最小版本。</p><figure class="mq mr ms mt fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><p id="0225" class="pw-post-body-paragraph jl jm ht jo b jp jq iu jr js jt ix ju lc jw jx jy le ka kb kc lg ke kf kg kh hb bi translated">你可以查看完整的OpenApi 2.0规范<a class="ae li" href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md" rel="noopener ugc nofollow" target="_blank">这里</a>和<a class="ae li" href="https://cloud.google.com/endpoints/docs/openapi/openapi-overview" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><h2 id="2ee1" class="mb kj ht bd kk mc md me ko mf mg mh ks lc mi mj ku le mk ml kw lg mm mn ky mo bi translated">组件</h2><blockquote class="ji jj jk"><p id="357f" class="jl jm jn jo b jp jq iu jr js jt ix ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">API Gateway上定义的API由两个主要组件组成:</p><p id="321c" class="jl jm jn jo b jp jq iu jr js jt ix ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><strong class="jo hu"> API配置</strong>:上传<strong class="jo hu"> API定义</strong>时创建的API配置。对于测试版，您将API定义创建为OpenAPI规范。每次上传API定义时，API Gateway都会创建一个新的API配置。也就是说，您可以创建API配置，但不能在以后修改它。如果您稍后在OpenAPI规范中编辑API定义，然后上传编辑后的API定义，您将创建一个新的API配置。</p><p id="3450" class="jl jm jn jo b jp jq iu jr js jt ix ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated"><strong class="jo hu">网关</strong>:基于<a class="ae li" href="https://www.envoyproxy.io/docs/envoy/latest/" rel="noopener ugc nofollow" target="_blank">特使</a>的高性能、可伸缩代理，托管已部署的API配置。将API配置部署到网关会创建面向外部的URL，您的API客户端使用该URL来访问API。</p><p id="de55" class="jl jm jn jo b jp jq iu jr js jt ix ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">被部署到特定的GCP <a class="ae li" href="https://cloud.google.com/about/locations/" rel="noopener ugc nofollow" target="_blank">地区</a>。区域是GCP上可以部署资源的特定地理区域。</p><p id="e8ba" class="jl jm jn jo b jp jq iu jr js jt ix ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">必须承载API配置。您不能创建空网关，即没有API配置的网关。但是，创建网关后，您可以更新网关，用一个API配置替换另一个API配置。</p><p id="250d" class="jl jm jn jo b jp jq iu jr js jt ix ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">只能承载一个API配置。您不能将多个API配置部署到同一个网关。</p></blockquote><h1 id="a6ab" class="ki kj ht bd kk kl km kn ko kp kq kr ks iz kt ja ku jc kv jd kw jf kx jg ky kz bi translated">使用地形</h1><p id="ede3" class="pw-post-body-paragraph jl jm ht jo b jp la iu jr js lb ix ju lc ld jx jy le lf kb kc lg lh kf kg kh hb bi translated">首先，您需要确保Terraform会接收您的凭证。有几种方法可以做到这一点，最简单的方法是使用<a class="ae li" href="https://cloud.google.com/sdk/gcloud/reference/auth/application-default/login" rel="noopener ugc nofollow" target="_blank"> <em class="jn">应用程序的默认凭证</em> </a>。您可以使用下面的命令轻松设置它:</p><pre class="mq mr ms mt fd nd ne nf ng aw nh bi"><span id="4074" class="mb kj ht ne b fi ni nj l nk nl">gcloud auth application-default login</span></pre><p id="898a" class="pw-post-body-paragraph jl jm ht jo b jp jq iu jr js jt ix ju lc jw jx jy le ka kb kc lg ke kf kg kh hb bi translated">该命令将创建<em class="jn">。config/g cloud/application _ default _ credentials . JSON</em>terra form无需任何额外配置即可自动读取。</p><p id="b2ba" class="pw-post-body-paragraph jl jm ht jo b jp jq iu jr js jt ix ju lc jw jx jy le ka kb kc lg ke kf kg kh hb bi translated"><em class="jn">我们目前没有使用任何</em> <a class="ae li" href="https://www.terraform.io/docs/backends/index.html" rel="noopener ugc nofollow" target="_blank"> <em class="jn"> Terraform后端</em> </a> <em class="jn">，但是我真心建议你设置一个后端来管理你的TF状态。</em> <a class="ae li" href="https://www.terraform.io/docs/backends/types/gcs.html" rel="noopener ugc nofollow" target="_blank"> <em class="jn">下面是你如何使用谷歌云存储</em> </a> <em class="jn">创建后端。</em></p><h2 id="a746" class="mb kj ht bd kk mc md me ko mf mg mh ks lc mi mj ku le mk ml kw lg mm mn ky mo bi translated">我们的云运行hello world服务</h2><p id="d9eb" class="pw-post-body-paragraph jl jm ht jo b jp la iu jr js lb ix ju lc ld jx jy le lf kb kc lg lh kf kg kh hb bi translated">首先，我们需要创建云运行服务，以便获得URL并在以后更新我们的API网关规范。您可以从terraform完成后打印的输出中获得URL。</p><figure class="mq mr ms mt fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><p id="4e76" class="pw-post-body-paragraph jl jm ht jo b jp jq iu jr js jt ix ju lc jw jx jy le ka kb kc lg ke kf kg kh hb bi translated">您需要从<code class="du nm nn no ne b">terraform/cloud-run</code> <a class="ae li" href="https://github.com/femrtnz/google-cloud-api-gateway/tree/main/terraform/cloud_run" rel="noopener ugc nofollow" target="_blank">文件夹</a>中运行上面的代码。</p><ul class=""><li id="0354" class="lj lk ht jo b jp jq js jt lc ll le lm lg ln kh lo lp lq lr bi translated"><code class="du nm nn no ne b">terraform init</code></li><li id="ac94" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh lo lp lq lr bi translated"><code class="du nm nn no ne b">terraform apply</code></li></ul><h2 id="79c6" class="mb kj ht bd kk mc md me ko mf mg mh ks lc mi mj ku le mk ml kw lg mm mn ky mo bi translated">使用Terraform实现我们的API网关</h2><p id="3420" class="pw-post-body-paragraph jl jm ht jo b jp la iu jr js lb ix ju lc ld jx jy le lf kb kc lg lh kf kg kh hb bi translated">API网关资源最近(2020年11月2日)被添加到谷歌测试版提供商中。API网关包含3个主要资源(与我们刚才看到的不同):</p><ul class=""><li id="9772" class="lj lk ht jo b jp jq js jt lc ll le lm lg ln kh lo lp lq lr bi translated"><code class="du nm nn no ne b">google_api_gateway_api</code>装箱API网关本身。</li><li id="962d" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh lo lp lq lr bi translated"><code class="du nm nn no ne b">google_api_gateway_api_config</code>在上面的API网关中创建开放API规范。</li><li id="9b5f" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh lo lp lq lr bi translated"><code class="du nm nn no ne b">google_api_gateway_gateway</code>创建链接到API配置的网关(特使代理)。</li></ul><figure class="mq mr ms mt fd hk"><div class="bz dy l di"><div class="nb nc l"/></div></figure><p id="502e" class="pw-post-body-paragraph jl jm ht jo b jp jq iu jr js jt ix ju lc jw jx jy le ka kb kc lg ke kf kg kh hb bi translated">您将需要包含来自<code class="du nm nn no ne b">terraform/api-gateway</code> <a class="ae li" href="https://github.com/femrtnz/google-cloud-api-gateway/tree/main/terraform/api-gateway" rel="noopener ugc nofollow" target="_blank">文件夹</a>的云运行Run。</p><ul class=""><li id="6781" class="lj lk ht jo b jp jq js jt lc ll le lm lg ln kh lo lp lq lr bi translated"><code class="du nm nn no ne b">terraform init</code></li><li id="f42d" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh lo lp lq lr bi translated"><code class="du nm nn no ne b">terraform apply</code></li></ul><h2 id="bf1c" class="mb kj ht bd kk mc md me ko mf mg mh ks lc mi mj ku le mk ml kw lg mm mn ky mo bi translated">检查入口</h2><p id="f3ee" class="pw-post-body-paragraph jl jm ht jo b jp la iu jr js lb ix ju lc ld jx jy le lf kb kc lg lh kf kg kh hb bi translated">现在你可以去<a class="ae li" href="https://console.cloud.google.com/api-gateway/api/" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com/api-gateway</a>点击“API网关”…</p><figure class="mq mr ms mt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es np"><img src="../Images/82eda88248cfa951816a5ed61dde6151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hFv6cTb0miH0CHGCuRL-kA.png"/></div></div></figure><p id="a67e" class="pw-post-body-paragraph jl jm ht jo b jp jq iu jr js jt ix ju lc jw jx jy le ka kb kc lg ke kf kg kh hb bi translated">然后，单击网关选项卡…</p><figure class="mq mr ms mt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nq"><img src="../Images/6defeb6d049504935f24c5341e4c3571.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q2Xk9GcbMaXuQThKtBJphA.png"/></div></div></figure><p id="374f" class="pw-post-body-paragraph jl jm ht jo b jp jq iu jr js jt ix ju lc jw jx jy le ka kb kc lg ke kf kg kh hb bi translated">现在，您将看到我们将用来调用API的网关URL。</p><figure class="mq mr ms mt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nr"><img src="../Images/e8a6cf5f2942e5b66bc3f407a37dafb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BMsOzGZI2rszW-JLQd7cbg.png"/></div></div></figure><p id="64b7" class="pw-post-body-paragraph jl jm ht jo b jp jq iu jr js jt ix ju lc jw jx jy le ka kb kc lg ke kf kg kh hb bi translated">您需要在最后将我们创建的API路径包含到API网关规范<code class="du nm nn no ne b">/v1/hello</code>中。它应该类似于:</p><pre class="mq mr ms mt fd nd ne nf ng aw nh bi"><span id="b85d" class="mb kj ht ne b fi ni nj l nk nl">{gatewayId}-{hash}.{region_code}.gateway.dev/v1/hello</span></pre><p id="b5e6" class="pw-post-body-paragraph jl jm ht jo b jp jq iu jr js jt ix ju lc jw jx jy le ka kb kc lg ke kf kg kh hb bi translated">…结束就是这样！</p><figure class="mq mr ms mt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ns"><img src="../Images/54410be6c37f31d53e3a0f36888f9ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5_PDoXgrt1C5wMbunWmxcQ.png"/></div></div></figure><h2 id="5560" class="mb kj ht bd kk mc md me ko mf mg mh ks lc mi mj ku le mk ml kw lg mm mn ky mo bi translated">打扫</h2><ul class=""><li id="8473" class="lj lk ht jo b jp la js lb lc lx le ly lg lz kh lo lp lq lr bi translated">用<code class="du nm nn no ne b">terraform destroy</code>摧毁所有地形资源</li><li id="2832" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh lo lp lq lr bi translated">如果您不再使用该项目，请将其删除。</li></ul></div><div class="ab cl nt nu gp nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="hb hc hd he hf"><h1 id="8583" class="ki kj ht bd kk kl oa kn ko kp ob kr ks iz oc ja ku jc od jd kw jf oe jg ky kz bi translated">结论</h1><p id="249b" class="pw-post-body-paragraph jl jm ht jo b jp la iu jr js lb ix ju lc ld jx jy le lf kb kc lg lh kf kg kh hb bi translated">您可以在几分钟内创建一个API网关，并且很容易与您的GCP产品集成。</p><p id="2e29" class="pw-post-body-paragraph jl jm ht jo b jp jq iu jr js jt ix ju lc jw jx jy le ka kb kc lg ke kf kg kh hb bi translated">一些缺点是:</p><ul class=""><li id="6589" class="lj lk ht jo b jp jq js jt lc ll le lm lg ln kh lo lp lq lr bi translated">对所有产品使用一个API网关可能很难管理和扩展，因为OpenAPI规范非常庞大。</li><li id="e815" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh lo lp lq lr bi translated">您不能在网关中设置自己的域/DNS。</li><li id="193b" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh lo lp lq lr bi translated">在网关更新期间，您将有<strong class="jo hu">停机时间</strong>，因为Terraform将首先尝试删除网关，然后用新配置重新创建它。使用地形<code class="du nm nn no ne b">lifecycle</code>块也没有帮助，因为网关抱怨说<code class="du nm nn no ne b">gateway alreay exists!</code>。一种解决方法是在运行terraform后，使用命令<code class="du nm nn no ne b">gcloud beta api-gateway gateways update</code>强制更新当前网关。</li></ul><h2 id="ad17" class="mb kj ht bd kk mc md me ko mf mg mh ks lc mi mj ku le mk ml kw lg mm mn ky mo bi translated">参考</h2><ul class=""><li id="6fcb" class="lj lk ht jo b jp la js lb lc lx le ly lg lz kh lo lp lq lr bi translated"><a class="ae li" href="https://cloud.google.com/api-gateway/docs/about-api-gateway" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/api-gateway/docs/about-api-gateway</a></li><li id="7d11" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh lo lp lq lr bi translated"><a class="ae li" href="https://cloud.google.com/api-gateway/docs/deployment-model" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/api-gateway/docs/deployment-model</a></li><li id="0daf" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh lo lp lq lr bi translated"><a class="ae li" href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md" rel="noopener ugc nofollow" target="_blank">https://github . com/OAI/open API-Specification/blob/master/versions/2.0 . MD</a></li><li id="6f42" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh lo lp lq lr bi translated"><a class="ae li" href="https://cloud.google.com/endpoints/docs/openapi/openapi-overview" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/endpoints/docs/open API/open API-概述</a></li><li id="134d" class="lj lk ht jo b jp ls js lt lc lu le lv lg lw kh lo lp lq lr bi translated"><a class="ae li" href="https://www.redhat.com/en/topics/api/what-does-an-api-gateway-do" rel="noopener ugc nofollow" target="_blank">https://www . red hat . com/en/topics/API/what-do-an-API-gateway-do</a></li></ul></div></div>    
</body>
</html>