<html>
<head>
<title>BigQuery Sensor in Composer/User defined sensor implementation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Composer/用户定义的传感器实现中的BigQuery传感器</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/bigquery-sensor-in-composer-b526c9a91c26?source=collection_archive---------1-----------------------#2022-12-16">https://medium.com/google-cloud/bigquery-sensor-in-composer-b526c9a91c26?source=collection_archive---------1-----------------------#2022-12-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="660c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想要在源数据库刷新和目标数据库加载作业之间创建依赖关系吗？</p><p id="b27f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想让OLAP加载作业一直等到源OLTP系统更新吗？继续下去，看看这个教程。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/c5cb799fbd750f21b4681c55f5726d21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PZanVJM_L982D9YLlabkrw.png"/></div></div></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="7496" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">准备:</strong>可重用性、博客、社区贡献</p><p id="be6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">假设</strong></p><p id="8449" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本教程假设您熟悉:</p><ul class=""><li id="60c8" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated">Composer，BigQuery，Python</li></ul><h1 id="2f2b" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">示例使用案例:</h1><p id="9cb9" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">只有在指定的时间范围(可修改)内更新源表时，才应该执行一些下游任务。</p><p id="a975" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">源项目限制了元数据查看器权限，它可以通过API调用，但是它们限制了通过Information_schema查询元数据。</p><p id="fc5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">议程是通过bigquery API检查表的lastmodifiedtime，如果表没有在指定的范围内更新，则重新调度DAG。</p><p id="8f99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">poke方法将在上述时间间隔后重试，并在源表更新时自动执行下一个任务。</p><p id="140f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不需要人工干预。</p><p id="34c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不需要在固定的时间间隔安排DAG来检查这一点。</p><p id="8b93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">场景:</strong>有一个OLTP源表‘OLTP _ customer’。有一个OLAP目标表dim_customer。只有当源表在这一小时内被修改时，下一个从源表加载维度表的任务才会执行。在修改源表之前，任务将继续被重新调度。</p><p id="525c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">天空颜色表示重新计划的状态。每当更新源表时，DAG都会自动开始运行以下任务并完成该过程</p><h1 id="9dd5" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated"><strong class="ak">解决方案:</strong></h1><h2 id="8d96" class="li kg hi bd kh lj lk ll kl lm ln lo kp iq lp lq kt iu lr ls kx iy lt lu lb lv bi translated">介绍</h2><p id="fc93" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">气流传感器允许您检查是否满足完成标准。</p><p id="ae37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Bigquery Sensor可以作为气流插件创建，并可以作为python模块导入到气流DAG中。</p><p id="863b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该解决方案基于一个基于BigQuery客户端的用户自定义传感器。</p><p id="34de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Airflow有一个简单的内置插件管理器，可以通过简单地将文件放入$AIRFLOW_HOME/plugins文件夹中，将外部功能集成到其核心中。</p><p id="aa27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">插件文件夹中的python模块被导入，宏和web视图被集成到Airflow的主集合中，可供使用。</p><h2 id="622c" class="li kg hi bd kh lj lk ll kl lm ln lo kp iq lp lq kt iu lr ls kx iy lt lu lb lv bi translated">建筑/设计:</h2><p id="3856" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated"><strong class="ih hj">步骤1: </strong>当源表在最后一个小时没有被修改时。DAG已启动，它检查到源表未更新，因此它重新计划了DAG。任务IsModifiedSource是天空颜色，这意味着它处于重新计划状态。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/901824d1bac13b506dd3b5ade6a68bc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Hya7CqEpeI9zIVq-"/></div></div></figure><p id="adf7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第二步:</strong>修改源表。插入一条记录</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lx"><img src="../Images/a11ff58f54b2a7f8035bf9ee1be91522.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YxVLoypS8ZJYGC0f"/></div></div></figure><p id="1764" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤3: </strong>重新调度的任务“IsSourceModified”开始运行，传感器脚本在每个poke_interval之后检查表修改时间，只要与当前小时相匹配，就执行该任务</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/d07dbb74f0b27c8068468c67240d0ac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OOQVJu23ki6kmX9U"/></div></div></figure><p id="1d71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤4:</strong>DAG完成，维度表从oltp源表加载</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/6b0a50d3c605347aaca062ef35d6063d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0Uqc9BNDPcRF_twL"/></div></div></figure><h2 id="c635" class="li kg hi bd kh lj lk ll kl lm ln lo kp iq lp lq kt iu lr ls kx iy lt lu lb lv bi translated">使用气流传感器的好处:</h2><p id="6c72" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">传感器是一个操作员<strong class="ih hj">在一段时间间隔内评估是否符合标准/条件。</strong>如果是，则成功，否则重试，直到超时。</p><p id="6dd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">气流会带来不同的传感器，以下是最常用的一些传感器:</p><ul class=""><li id="4fd5" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated"><em class="ly">文件传感器</em>:等待文件或文件夹进入文件系统。</li><li id="7b39" class="jw jx hi ih b ii lz im ma iq mb iu mc iy md jc kb kc kd ke bi translated"><em class="ly">s3key sensor</em>:等待一把钥匙出现在S3桶里。</li><li id="6b76" class="jw jx hi ih b ii lz im ma iq mb iu mc iy md jc kb kc kd ke bi translated">SqlSensor :重复运行一条sql语句，直到满足一个标准。</li><li id="d588" class="jw jx hi ih b ii lz im ma iq mb iu mc iy md jc kb kc kd ke bi translated">HivePartitionSensor :等待一个分区出现在Hive中。</li><li id="9430" class="jw jx hi ih b ii lz im ma iq mb iu mc iy md jc kb kc kd ke bi translated"><em class="ly">ExternalTaskSensor</em>:等待不同DAG或不同DAG中的任务在特定执行日期完成。(挺有用的那个🤓)</li><li id="70ed" class="jw jx hi ih b ii lz im ma iq mb iu mc iy md jc kb kc kd ke bi translated"><em class="ly">datetime sensor</em>:等待指定的日期时间(用于为您的Dag添加一些延迟)</li></ul><h2 id="fa3c" class="li kg hi bd kh lj lk ll kl lm ln lo kp iq lp lq kt iu lr ls kx iy lt lu lb lv bi translated">根据业务逻辑创建用户定义传感器，即BigQuery传感器:</h2><p id="db61" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">我们还可以根据我们的业务逻辑创建定制的传感器。</p><p id="0338" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该资产基于用户定义的传感器，该传感器基于BigQuery客户端表ModifiedTime。我们可以在多个Dag中重用同一个传感器来检查这些先决条件。此外，通过使用该脚本作为模板，我们可以轻松创建具有不同业务逻辑的不同BigQuery传感器。</p><ul class=""><li id="f829" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated">这个例子包括如何从BigQuery API访问元数据信息</li><li id="5559" class="jw jx hi ih b ii lz im ma iq mb iu mc iy md jc kb kc kd ke bi translated">该示例还包括使用Google Secret Manager来保护服务帐户凭证。</li></ul><h2 id="ff0b" class="li kg hi bd kh lj lk ll kl lm ln lo kp iq lp lq kt iu lr ls kx iy lt lu lb lv bi translated">脚本:</h2><p id="37bd" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated"><strong class="ih hj">1)bigquerytablemodified sensor . py</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/8afb5561de01c251124511b8e630945b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8Cbq9hYRJedck9-D"/></div></div></figure><pre class="je jf jg jh fd me mf mg bn mh mi bi"><span id="6033" class="mj kg hi mf b be mk ml l mm mn">"""This module contains a Google Bigquery SQL sensor."""<br/>from typing import Optional, Sequence, Union<br/>from airflow.hooks import BaseHook<br/>from airflow.sensors import BaseSensorOperator<br/>from airflow.exceptions import AirflowException<br/>import datetime<br/>from google.cloud import bigquery<br/>from google.oauth2 import service_account<br/>from google.cloud import secretmanager<br/>import pendulum<br/>import logging<br/>import json<br/>class BigQueryTableModifiedSensor(BaseSensorOperator):<br/>"""<br/>Checks for the True or False output in Google Bigquery Query Job output.<br/>:param sql: The query to return True or False as Final output<br/>:type sql: str<br/>:param use_legacy_sql: Option to run legacy SQL<br/>:type use_legacy_sql: Boolean<br/>:param bigquery_conn_id: The connection ID to use when connecting to<br/>Google BigQuery.<br/>:type bigquery_conn_id: str<br/>"""<br/>template_fields = (<br/>'sql',<br/>'use_legacy_sql',<br/>'bigquery_conn_id',<br/>'full_table_identifier',<br/>'secret_manager_project_name',<br/>'secret_name'<br/>)<br/>ui_color = '#f0eee2'<br/># accept table identifiers from main DAG<br/>def __init__(self,*,bigquery_conn_id: str = 'google_cloud_default',<br/>use_legacy_sql: bool = False,sql: str = None,full_table_identifier,secret_manager_project_name,secret_name,**kwargs) -&gt; None:<br/>super().__init__(**kwargs)<br/>self.bigquery_conn_id = bigquery_conn_id<br/>self.sql = None<br/>self.use_legacy_sql = use_legacy_sql<br/>self.full_table_identifier=full_table_identifier<br/>self.secret_manager_project_name=secret_manager_project_name<br/>self.secret_name=secret_name<br/>def access_secret_version(self,project_id, secret_id, version_id):<br/># Create the Secret Manager client.<br/>client = secretmanager.SecretManagerServiceClient()<br/># Build the resource name of the secret version.<br/>name = f"projects/{project_id}/secrets/{secret_id}/versions/{version_id}"<br/>logging.info(name)<br/>logging.info("inside get_table_modified before accessing")<br/># Access the secret version.<br/>response = client.access_secret_version(name)<br/>payload = response.payload.data.decode("UTF-8")<br/>#logging.info(payload)<br/>return payload<br/>def poke(self,context: dict) -&gt; bool:<br/>full_table_identifier=self.full_table_identifier<br/>secret_manager_project_name=self.secret_manager_project_name<br/>secret_name=self.secret_name<br/>key_content=self.access_secret_version(secret_manager_project_name,<br/>secret_name,"1")<br/>service_account_info = json.loads(key_content,strict=False)<br/>logging.info("returned from gsm function")<br/>logging.info(service_account_info)<br/>credentials=<br/>service_account.Credentials.from_service_account_info(service_account_info)<br/>client = bigquery.Client(credentials=credentials,project=credentials.project_id)<br/>table = client.get_table(full_table_identifier)<br/>logging.info(table.modified)<br/>logging.info(table.modified.date())<br/>logging.info(table.modified.hour)<br/>if table.modified.hour == datetime.datetime.now().hour:<br/>logging.info("IsModifiedThisHour TRUE")<br/>else:<br/>logging.info("IsModifiedThisHour False")<br/>return table.modified.hour == datetime.datetime.now().hour</span></pre><p id="3991" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2)样本DAG使用气流插件作为用户定义的传感器</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/cb3b6b4d17ec242a6a0d4a20ab744814.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xAry5q7HWo1q76lf"/></div></div></figure><pre class="je jf jg jh fd me mf mg bn mh mi bi"><span id="88ab" class="mj kg hi mf b be mk ml l mm mn">from sensors.BigQueryTableModifiedSensor import BigQueryTableModifiedSensor<br/>import os<br/>import json<br/>import datetime<br/>import airflow<br/>from airflow import DAG<br/>from airflow import models<br/>from airflow.models import Variable<br/>from airflow.operators import DummyOperator<br/>from airflow.operators import BashOperator<br/>from airflow.contrib.operators import bigquery_to_bigquery<br/>from airflow.contrib.operators import bigquery_to_gcs<br/>from airflow.contrib.operators import gcs_to_bq<br/>from airflow.contrib.operators import bigquery_operator<br/>from airflow.providers.google.cloud.operators.bigquery import BigQueryExecuteQueryOperator<br/>import datetime<br/>from google.cloud import bigquery<br/>from google.oauth2 import service_account<br/>from google.cloud import secretmanager<br/>import pendulum<br/>import logging<br/>import re<br/>from airflow.contrib.operators.bigquery_operator import BigQueryOperator<br/>from airflow.providers.google.cloud.operators.bigquery import BigQueryInsertJobOperator<br/>from airflow.contrib.operators.gcs_list_operator import GoogleCloudStorageListOperator<br/>from airflow.contrib.operators.gcs_to_gcs import GoogleCloudStorageToGoogleCloudStorageOperator<br/>from google.cloud import storage<br/>from airflow.providers.google.cloud.operators.bigquery import BigQueryExecuteQueryOperator<br/>from airflow.operators import DummyOperator<br/>from airflow.operators.python_operator import PythonOperator<br/>logger = logging.getLogger("airflow.task")<br/>local_tz = pendulum.timezone("Europe/Amsterdam")<br/>secret_manager_project_name=Variable.get('secret_manager_project')<br/>secret_name=Variable.get('secret_name')<br/>project_name=Variable.get('project_name')<br/>dataset_name=Variable.get('dataset_name')<br/>source_table_name=Variable.get('source_table_name')<br/>full_table_identifier=project_name+'.'+dataset_name+'.'+source_table_name<br/>target_table_name=Variable.get('target_table_name')<br/>#Default args for the DAG execution<br/>default_args = {<br/>'email_on_failure': True,<br/>'email_on_retry': False<br/>}<br/>#DAG initialization<br/>#DAG initialization<br/>with airflow.DAG(<br/>'load_oltp_table_to_dimension_table',<br/>start_date=datetime.datetime(2021, 1, 1),<br/>schedule_interval=None) as dag:<br/>logging.info("inside DAG")<br/>start = DummyOperator(<br/>task_id='start',<br/>dag=dag)<br/>finish = DummyOperator(<br/>task_id='finish',<br/>dag=dag)<br/>check_precondition = BigQueryTableModifiedSensor(<br/>task_id ='IsSourceModified',<br/>bigquery_conn_id = 'bigquery_default',<br/>use_legacy_sql = False,<br/>sql = None,<br/>full_table_identifier=full_table_identifier,<br/>secret_manager_project_name=secret_manager_project_name,<br/>secret_name=secret_name,<br/>poke_interval = 60,<br/>timeout = 3600,<br/>mode = 'reschedule',<br/>dag=dag<br/>)<br/>run_new_job = BigQueryOperator(<br/>task_id='RunLoadJobWhenSourceModified',<br/>sql='insert into `'+project_name+'.'+dataset_name+'.'+target_table_name+'` select generate_uuid(),c.customer_id,c.customer_name,c.customer_city,current_timestamp(),null,"Yes" from `'+project_name+'.'+dataset_name+'.'+source_table_name+'` c;',<br/>use_legacy_sql=False,<br/>bigquery_conn_id='bigquery_default',<br/>dag=dag)<br/>start&gt;&gt;check_precondition&gt;&gt;run_new_job&gt;&gt;finish</span></pre><h1 id="e6b1" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">传感器脚本的解释:</h1><p id="1231" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">所有传感器都继承自BaseSensorOperator，并具有以下参数:</p><ul class=""><li id="7831" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated">模式:传感器如何工作。有两种模式:</li><li id="888e" class="jw jx hi ih b ii lz im ma iq mb iu mc iy md jc kb kc kd ke bi translated">戳:这是默认模式。使用poke时，传感器会在整个执行时间内占用一个工作插槽，并在两次poke之间休眠。</li><li id="302e" class="jw jx hi ih b ii lz im ma iq mb iu mc iy md jc kb kc kd ke bi translated">重新安排:如果不符合标准，传感器将释放其工作插槽，并重新安排下次检查时间。</li><li id="00b3" class="jw jx hi ih b ii lz im ma iq mb iu mc iy md jc kb kc kd ke bi translated">poke_interval:使用poke模式时，这是传感器在再次检查条件之前等待的时间(秒)。默认值为30秒。</li><li id="ab0a" class="jw jx hi ih b ii lz im ma iq mb iu mc iy md jc kb kc kd ke bi translated">超时:传感器检查状况的最长时间(秒)。如果达到该时间时还没有满足条件，则任务失败。</li></ul><p id="a5cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据给定的业务逻辑，可以在传感器类的__init__方法中传递可变数量的参数。</p><p id="d79c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，可以从任何DAG调用传感器来检查是否满足前提条件。</p><pre class="je jf jg jh fd me mf mg bn mh mi bi"><span id="8117" class="mj kg hi mf b be mk ml l mm mn">check_precondition = BigQueryTableModifiedSensor(<br/>task_id ='IsSourceModified',<br/>bigquery_conn_id = 'bigquery_default',<br/>use_legacy_sql = False,<br/>sql = None,<br/>full_table_identifier=full_table_identifier,<br/>secret_manager_project_name=secret_manager_project_name,<br/>secret_name=secret_name, - - - Only needed if you use Google Secret Manager<br/>poke_interval = 60,<br/>timeout = 3600,<br/>mode = 'reschedule',<br/>dag=dag<br/>)</span></pre><h1 id="297b" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">如何在DAG中使用BigQuery传感器脚本</h1><p id="99ef" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">使用第一个脚本bigquerytablemodifiedssensor . py创建传感器。</p><p id="641d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据业务逻辑修改脚本。</p><p id="bcc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将脚本文件放在气流环境的以下路径中</p><p id="f2a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">气流-环境-桶/插件/传感器/bigquerytablemodified sensor<strong class="ih hj">。</strong> py</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/57e6ca5a28932deb936a4c8d46d21c08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pdeOdHhW5vtp8m27"/></div></div></figure><p id="8c42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将BigQueryTableModifiedSensor模块导入到您想要使用它的DAG中。</p></div></div>    
</body>
</html>