<html>
<head>
<title>.NET 7 on Cloud Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">。云上运行的NET 7</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/net-7-on-cloud-run-d188c984681f?source=collection_archive---------2-----------------------#2022-11-11">https://medium.com/google-cloud/net-7-on-cloud-run-d188c984681f?source=collection_archive---------2-----------------------#2022-11-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/792c943220967f49e73d3f55d60ff165.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dd0bxNPn_yrMVthDI88Itg.png"/></div></div></figure><p id="97fb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">。NET 7在几天前<a class="ae jo" href="https://devblogs.microsoft.com/dotnet/announcing-dotnet-7/" rel="noopener ugc nofollow" target="_blank">发布了</a>，带来了新的特性和性能改进，并且已经在Google Cloud上运行了！</p><p id="b647" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇简短的博文中，我将向您展示如何将. NET 7 web应用程序部署到Cloud Run。</p><h1 id="9bf6" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">创建一个. NET 7 web应用程序</h1><p id="7277" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">首先，确保你开机了。网络7:</p><pre class="ks kt ku kv fd kw kx ky bn kz la bi"><span id="76fd" class="lb jq hi kx b be lc ld l le lf">dotnet --version<br/><br/>7.0.100</span></pre><p id="2d25" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建简单的web应用程序:</p><pre class="ks kt ku kv fd kw kx ky bn kz la bi"><span id="657c" class="lb jq hi kx b be lc ld l le lf">dotnet new web -o helloworld-dotnet7</span></pre><p id="6e61" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将创建包含项目文件的<code class="du lg lh li kx b">helloworld-dotnet7</code>文件夹。我喜欢现在默认的<code class="du lg lh li kx b">Program.cs</code>文件如此简单:</p><pre class="ks kt ku kv fd kw kx ky bn kz la bi"><span id="268f" class="lb jq hi kx b be lc ld l le lf">var builder = WebApplication.CreateBuilder(args);<br/>var app = builder.Build();<br/><br/>app.MapGet("/", () =&gt; "Hello World!");<br/><br/>app.Run();</span></pre><p id="a6bf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于云运行，您需要检查<code class="du lg lh li kx b">PORT</code>并监听<code class="du lg lh li kx b">0.0.0.0</code>。将<code class="du lg lh li kx b">Program.cs</code>改为:</p><pre class="ks kt ku kv fd kw kx ky bn kz la bi"><span id="0c74" class="lb jq hi kx b be lc ld l le lf">var builder = WebApplication.CreateBuilder(args);<br/><br/>// Add the following for Cloud Run<br/>var port = Environment.GetEnvironmentVariable("PORT") ?? "8080";<br/>var url = $"http://0.0.0.0:{port}";<br/>builder.WebHost.UseUrls(url);<br/><br/>var app = builder.Build();<br/><br/>app.MapGet("/", () =&gt; "Hello World from .NET 7.0!");<br/><br/>app.Run();</span></pre><h1 id="d3e3" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">本地测试</h1><p id="51d1" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">让我们在本地运行应用程序进行快速测试。</p><p id="d91e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">启动应用程序:</p><pre class="ks kt ku kv fd kw kx ky bn kz la bi"><span id="2925" class="lb jq hi kx b be lc ld l le lf">dotnet run<br/><br/>Building...<br/>info: Microsoft.Hosting.Lifetime[14]<br/>      Now listening on: http://0.0.0.0:8080<br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Application started. Press Ctrl+C to shut down.<br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Hosting environment: Development<br/>info: Microsoft.Hosting.Lifetime[0]<br/>      Content root path: /Users/atamel/dev/local/helloworld-dotnet7</span></pre><p id="e9d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用curl发送请求:</p><pre class="ks kt ku kv fd kw kx ky bn kz la bi"><span id="ac36" class="lb jq hi kx b be lc ld l le lf">curl http://localhost:8080 <br/><br/>Hello World from .NET 7.0!</span></pre><h1 id="9d01" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">部署到云运行</h1><p id="95a5" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">部署到云运行:</p><pre class="ks kt ku kv fd kw kx ky bn kz la bi"><span id="2e61" class="lb jq hi kx b be lc ld l le lf">gcloud run deploy helloworld-dotnet7 \<br/>    --allow-unauthenticated \<br/>    --region us-central1 \<br/>    --source .</span></pre><p id="a952" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意我们使用了<code class="du lg lh li kx b">--source</code>标志。在幕后，这个命令使用<a class="ae jo" href="https://github.com/GoogleCloudPlatform/buildpacks" rel="noopener ugc nofollow" target="_blank"> Google Cloud buildpacks </a>和Cloud Build从您的源代码自动构建容器映像，而不需要<code class="du lg lh li kx b">Dockerfile</code>或者在您的机器上安装Docker。</p><p id="3c08" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">几分钟后，应用程序就部署到了Cloud Run。</p><h1 id="e0f9" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">针对云运行的测试</h1><p id="a65b" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">为了测试部署的云运行，获取服务url并使用curl:</p><pre class="ks kt ku kv fd kw kx ky bn kz la bi"><span id="8729" class="lb jq hi kx b be lc ld l le lf">SERVICE_URL=$(gcloud run services describe helloworld-dotnet7 --region us-central1 --format 'value(status.url)')<br/>curl $SERVICE_URL<br/><br/>Hello World from .NET 7.0!</span></pre><p id="28bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">瞧啊。。运行在云上的NET 7.0。</p></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><p id="a839" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如有任何问题或反馈，请随时在Twitter <a class="ae jo" href="https://twitter.com/meteatamel" rel="noopener ugc nofollow" target="_blank"> @meteatamel </a>上联系我。<em class="lq">最初发布于</em><a class="ae jo" href="https://atamel.dev/posts/2022/11-11_dotnet7_cloud_run/" rel="noopener ugc nofollow" target="_blank"><em class="lq">https://atamel . dev</em></a><em class="lq">。</em></p></div></div>    
</body>
</html>