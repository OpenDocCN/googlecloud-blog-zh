<html>
<head>
<title>Swift on Cloud Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云运行上的Swift</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/swift-on-cloud-run-b6397a428d?source=collection_archive---------1-----------------------#2020-06-30">https://medium.com/google-cloud/swift-on-cloud-run-b6397a428d?source=collection_archive---------1-----------------------#2020-06-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f92b945e4b975788f5654f67eb649d85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gLK3fkqVqIFlUSRz5OYQjg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Swift云运行。</figcaption></figure><blockquote class="iu iv iw"><p id="bb07" class="ix iy iz ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">Swift徽标是Apple Inc .的商标。Swift徽标的使用根据与Swift编程语言教学相关的技术出版物进行。</p></blockquote><p id="5ecd" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv hb bi translated"><strong class="ja hj"> <em class="iz">迅捷</em> </strong> ( <a class="ae jz" href="https://developer.apple.com/swift/resources/" rel="noopener ugc nofollow" target="_blank">🔗</a> ) <em class="iz"> </em>是一种创新的开源编程语言，由Apple开发，旨在让各地的软件创建起来更安全、更快速、更有趣。</p><p id="5b4b" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv hb bi translated"><strong class="ja hj"><em class="iz">Vapor</em></strong>(<a class="ae jz" href="https://vapor.codes/" rel="noopener ugc nofollow" target="_blank">Vapor . codes</a>)是一个基于苹果<a class="ae jz" href="https://github.com/apple/swift-nio" rel="noopener ugc nofollow" target="_blank"> SwiftNIO </a>之上的非阻塞、事件驱动架构，用Swift编写，关注类型安全。</p><p id="c9a3" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv hb bi translated">总之，您可以构建强大的web服务，这些服务可以托管在云运行之上。这篇博客将会给你一个快速的开始。</p><h1 id="f944" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">先决条件</h1><p id="a9bf" class="pw-post-body-paragraph ix iy hi ja b jb ky jd je jf kz jh ji jw la jl jm jx lb jp jq jy lc jt ju jv hb bi translated">要使用Swift，你需要一个工具，Xcode。</p><ul class=""><li id="9279" class="ld le hi ja b jb jc jf jg jw lf jx lg jy lh jv li lj lk ll bi translated">通过App Store安装Xcode 11.4+(免费)</li><li id="3e0b" class="ld le hi ja b jb lm jf ln jw lo jx lp jy lq jv li lj lk ll bi translated">打开Xcode并安装任何更新。</li><li id="1505" class="ld le hi ja b jb lm jf ln jw lo jx lp jy lq jv li lj lk ll bi translated">确保Swift在您的终端中可用:<code class="du lr ls lt lu b">swift --version</code></li></ul><figure class="lv lw lx ly fd ij"><div class="bz dy l di"><div class="lz ma l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">安装Xcode后，你应该可以访问S <code class="du lr ls lt lu b">wift.</code></figcaption></figure><h1 id="92cc" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">设置蒸汽</h1><p id="948a" class="pw-post-body-paragraph ix iy hi ja b jb ky jd je jf kz jh ji jw la jl jm jx lb jp jq jy lc jt ju jv hb bi translated">对于我们的应用程序，我们将使用开源web框架Vapor。</p><ol class=""><li id="ba5d" class="ld le hi ja b jb jc jf jg jw lf jx lg jy lh jv mb lj lk ll bi translated">通过自制软件安装<code class="du lr ls lt lu b">vapor</code>:</li></ol><pre class="lv lw lx ly fd mc lu md me aw mf bi"><span id="09fa" class="mg kb hi lu b fi mh mi l mj mk">brew install vapor/tap/vapor</span></pre><p id="0a52" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv hb bi translated">2.打开一个新的终端窗口，创建一个新的Vapor项目:<code class="du lr ls lt lu b">vapor</code></p><pre class="lv lw lx ly fd mc lu md me aw mf bi"><span id="3fcb" class="mg kb hi lu b fi mh mi l mj mk">vapor new Hello</span></pre><p id="00ca" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv hb bi translated">3.出现提示时，说出<code class="du lr ls lt lu b">n</code>以使用<code class="du lr ls lt lu b">Fluent</code>。</p><p id="47eb" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv hb bi translated">您的终端应该如下所示:</p><figure class="lv lw lx ly fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/d456ab21334278fd47e9a866a84fa65d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OnWpChJO_PEiDCVIMXLg2g.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">蒸汽CLI</figcaption></figure><p id="cde2" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv hb bi translated">使用Vapor工具箱设置Xcode项目:</p><pre class="lv lw lx ly fd mc lu md me aw mf bi"><span id="c76c" class="mg kb hi lu b fi mh mi l mj mk">cd Hello &amp;&amp; vapor xcode</span></pre><blockquote class="iu iv iw"><p id="a174" class="ix iy iz ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">注意:Xcode是开发Vapor应用程序的好方法，但是可以使用任何你喜欢的编辑器。</p></blockquote><p id="192b" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv hb bi translated">要构建并运行您的Vapor应用程序，请确保您拥有我们创建的<code class="du lr ls lt lu b">Hello</code>方案并选择了<code class="du lr ls lt lu b">My Mac</code>设备:</p><figure class="lv lw lx ly fd ij er es paragraph-image"><div class="er es mm"><img src="../Images/1c826e0ff60c78b36f2eb7e8ef68ee46.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*0IVCwNpvH-XPCJmExKPgWw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">Xcode应该用“我的Mac”方案在工具栏中显示你的“Hello”程序。</figcaption></figure><p id="7be4" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv hb bi translated">选择后，只需点击按钮或按下<code class="du lr ls lt lu b">⌘R</code>。您会注意到日志中写着:<code class="du lr ls lt lu b">Server starting on <a class="ae jz" href="http://127.0.0.1:8080" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8080</a></code>。</p><p id="48c0" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv hb bi translated">转到<a class="ae jz" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080/ </a>来测试您的web服务器。您应该看到:</p><pre class="lv lw lx ly fd mc lu md me aw mf bi"><span id="0b70" class="mg kb hi lu b fi mh mi l mj mk">It works!</span></pre><h2 id="60f3" class="mg kb hi bd kc mn mo mp kg mq mr ms kk jw mt mu ko jx mv mw ks jy mx my kw mz bi translated">检查代码</h2><p id="be64" class="pw-post-body-paragraph ix iy hi ja b jb ky jd je jf kz jh ji jw la jl jm jx lb jp jq jy lc jt ju jv hb bi translated">在Xcode中，您应该能够深入源代码并查看日志:</p><figure class="lv lw lx ly fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es na"><img src="../Images/beb8013b2bac48b5d3a6bf42983a69e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7JgnTTgcaPL7Shmg_eX50A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Xcode工作区窗口的完整屏幕截图。</figcaption></figure><p id="f311" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv hb bi translated">我不会介绍整个应用程序，但是主程序有一个默认路由器用于<code class="du lr ls lt lu b">/</code> <code class="du lr ls lt lu b">GET</code>请求，还有一个路由器用于<code class="du lr ls lt lu b">/hello</code> <code class="du lr ls lt lu b">GET</code>请求:</p><figure class="lv lw lx ly fd ij"><div class="bz dy l di"><div class="lz ma l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">一个简单的蒸汽路由器。</figcaption></figure><h1 id="2e4f" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">使用断点调试</h1><p id="06a2" class="pw-post-body-paragraph ix iy hi ja b jb ky jd je jf kz jh ji jw la jl jm jx lb jp jq jy lc jt ju jv hb bi translated">通过添加断点来调试您的应用程序，并使用调试区域进行检查:</p><figure class="lv lw lx ly fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es na"><img src="../Images/563b1fca08e39c87eabea1c723fbb3f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2S-uoMEYpcJfHFbLXxtJxA.png"/></div></div></figure><h1 id="9944" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">本地测试</h1><p id="82f9" class="pw-post-body-paragraph ix iy hi ja b jb ky jd je jf kz jh ji jw la jl jm jx lb jp jq jy lc jt ju jv hb bi translated">一个样本单元测试正在<code class="du lr ls lt lu b">Tests</code>下进行。要运行您的单元测试，请按<code class="du lr ls lt lu b">Command + U</code>。</p><figure class="lv lw lx ly fd ij er es paragraph-image"><div class="er es nb"><img src="../Images/34ae9104ffd9cf8829936a618ef1eb77.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*ef_UdGyIuqsWE8cbLjYplQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">Xcode中测试成功时的通知。</figcaption></figure><h1 id="5644" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">部署到云运行</h1><p id="c4a1" class="pw-post-body-paragraph ix iy hi ja b jb ky jd je jf kz jh ji jw la jl jm jx lb jp jq jy lc jt ju jv hb bi translated">通过首先构建然后部署Docker容器映像(使用生成的<code class="du lr ls lt lu b">Dockerfile</code>)，轻松地将您的web应用程序部署到Cloud Run:</p><figure class="lv lw lx ly fd ij"><div class="bz dy l di"><div class="lz ma l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">构建并运行您的容器</figcaption></figure><p id="4a1b" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv hb bi translated">在我的例子中，构建容器花费了10m23s。</p><p id="052b" class="pw-post-body-paragraph ix iy hi ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv hb bi translated">这是上面部署在Cloud Run上的Swift/Vapor应用程序:</p><blockquote class="nc"><p id="a29f" class="nd ne hi bd nf ng nh ni nj nk nl jv dx translated"><a class="ae jz" href="https://vapor-q7vieseilq-uc.a.run.app" rel="noopener ugc nofollow" target="_blank"><strong class="ak">https://vapor-Q7 vieseilq-UC . a . run . app</strong></a></p></blockquote><p id="98f5" class="pw-post-body-paragraph ix iy hi ja b jb nm jd je jf nn jh ji jw no jl jm jx np jp jq jy nq jt ju jv hb bi translated">您正在运行用Swift编写的基于容器的自动扩展web服务器！🎉</p><h2 id="c99a" class="mg kb hi bd kc mn mo mp kg mq mr ms kk jw mt mu ko jx mv mw ks jy mx my kw mz bi translated">感谢阅读！</h2><p id="27be" class="pw-post-body-paragraph ix iy hi ja b jb ky jd je jf kz jh ji jw la jl jm jx lb jp jq jy lc jt ju jv hb bi translated">如果你喜欢这篇博客，你可能也会喜欢其他的学习资源:</p><ul class=""><li id="f846" class="ld le hi ja b jb jc jf jg jw lf jx lg jy lh jv li lj lk ll bi translated"><a class="ae jz" rel="noopener" href="/google-cloud/deno-on-cloud-run-89ae64d1664d">🦕云运行时的噪声</a></li><li id="0ca2" class="ld le hi ja b jb lm jf ln jw lo jx lp jy lq jv li lj lk ll bi translated"><a class="ae jz" href="http://vapor.codes" rel="noopener ugc nofollow" target="_blank">💧蒸汽代码</a></li></ul></div></div>    
</body>
</html>