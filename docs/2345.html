<html>
<head>
<title>Dual stack networks IPv4 and IPv6 in Google Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google Cloud中的双栈网络IPv4和IPv6</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/dual-stack-networks-ipv4-and-ipv6-in-google-cloud-914778b2f32d?source=collection_archive---------1-----------------------#2022-09-06">https://medium.com/google-cloud/dual-stack-networks-ipv4-and-ipv6-in-google-cloud-914778b2f32d?source=collection_archive---------1-----------------------#2022-09-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/cdf176713a06b9f7b26388d488247dca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7R7JfifgCmkvJsrW"/></div></div></figure><p id="34f6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">IP地址是网络和主机的唯一标识符。IPv6地址的创建是为了解决IPv4地址耗尽的问题。IPv4是一个32位地址，其最大地址容量为2(32)次方= <a class="ae jo" href="https://www.ripe.net/about-us/press-centre/understanding-ip-addressing#:~:text=Both%20IPv4%20and%20IPv6%20addresses,size%2C%20containing%20340%2C282%2C366%2C920%2C938%2C463%2C463%2C374%2C607%2C431%2C768%2C211%2C456%20IPv6%20addresses." rel="noopener ugc nofollow" target="_blank"> 4，294，967，296 </a>。</p><p id="9428" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">IPV6地址由128位组成，分为16位十六进制字段。该地址的最大地址容量为2(128)次方= <a class="ae jo" href="https://www.ripe.net/about-us/press-centre/understanding-ip-addressing#:~:text=Both%20IPv4%20and%20IPv6%20addresses,size%2C%20containing%20340%2C282%2C366%2C920%2C938%2C463%2C463%2C374%2C607%2C431%2C768%2C211%2C456%20IPv6%20addresses." rel="noopener ugc nofollow" target="_blank"> 340，282，366，920，938，463，463，374，607，431，768，211，456 </a></p><p id="5447" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">IPv6地址格式的示例如下图1所示。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jp"><img src="../Images/18d57ddc7267da7c7f012ae68a0f4831.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rRoEOkUJs20Hdkom"/></div></div></figure><p id="41ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的例子中，我们有一个全球IPV6地址。该地址被子网分成网络和主机两部分。</p><ul class=""><li id="6b4d" class="ju jv hi is b it iu ix iy jb jw jf jx jj jy jn jz ka kb kc bi translated"><strong class="is hj">网络部分</strong> —这代表大的单个识别块空间。把它想象成一条街道。这条街道可以容纳一所或多所房子，这取决于街道的大小。共同的因素是街道的名称，以区别于其他街道。</li><li id="95d0" class="ju jv hi is b it kd ix ke jb kf jf kg jj kh jn jz ka kb kc bi translated"><strong class="is hj">主机部分</strong> —这代表网络上的端点。为主机分配唯一的地址以避免冲突非常重要。想象一下，试图给一个收件人送一封信，但是当投递人到达该位置所在的街道时，有两栋门牌号相同的房子。这对发送者和接收者来说都是一种混乱的体验。</li></ul><h1 id="3077" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">虚拟私有云</h1><p id="92b4" class="pw-post-body-paragraph iq ir hi is b it lg iv iw ix lh iz ja jb li jd je jf lj jh ji jj lk jl jm jn hb bi translated">虚拟私有云是一种全局结构，在逻辑上代表一个本地数据中心。在您的VPC中，您可以为您的环境调配网络、安全、计算和存储资源。VPC被附加到一个项目。创建项目时，会创建一个默认的VPC。</p><p id="4f58" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">VPC的子网<br/> </strong>子网是区域性的，每个子网必须有一个唯一的IP地址范围。自动模式网络(如默认网络和您可以创建的网络)预先填充了每个地区的IPv4专用地址范围。您还可以创建推荐用于生产的自定义VPC，因为您可以控制分配的地址。可以在您的自定义模式VPC上启用IPv6以允许通信。IPv6目前在双栈模式下运行，我们将在本博客的后面进行更详细的讨论。</p><p id="471a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">在Google Cloud支持IPv6的地方<br/> </strong> IPv6可以分配给</p><ul class=""><li id="c626" class="ju jv hi is b it iu ix iy jb jw jf jx jj jy jn jz ka kb kc bi translated">虚拟机</li><li id="a43c" class="ju jv hi is b it kd ix ke jb kf jf kg jj kh jn jz ka kb kc bi translated">负载平衡器</li></ul><h1 id="62f4" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">Google Cloud中IPv6地址的类型</h1><p id="fabf" class="pw-post-body-paragraph iq ir hi is b it lg iv iw ix lh iz ja jb li jd je jf lj jh ji jj lk jl jm jn hb bi translated">在Google Cloud中，您可以为您的子网配置两种IPv6 <strong class="is hj">访问类型</strong>模式。子网只能是其中之一，不能同时是两者。</p><ul class=""><li id="53eb" class="ju jv hi is b it iu ix iy jb jw jf jx jj jy jn jz ka kb kc bi translated"><a class="ae jo" href="https://cloud.google.com/vpc/docs/subnets#external-ipv6" rel="noopener ugc nofollow" target="_blank">全球单播地址(gua)</a>—如果选择<strong class="is hj">外部访问</strong>子网，则会分配gua。这些允许内部和外部通信。</li><li id="72ee" class="ju jv hi is b it kd ix ke jb kf jf kg jj kh jn jz ka kb kc bi translated"><a class="ae jo" href="https://cloud.google.com/vpc/docs/subnets#internal-ipv6" rel="noopener ugc nofollow" target="_blank">唯一本地地址(ula)</a>—如果选择<strong class="is hj">内部访问</strong>子网，则会分配ula。这些只允许内部通信。</li></ul><p id="6d48" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Google Cloud中有几个与IPv6寻址相关的细节。您可以查看<a class="ae jo" href="https://cloud.google.com/vpc/docs/subnets#ipv6-assign" rel="noopener ugc nofollow" target="_blank">范围分配文档</a>了解更多信息。</p><h1 id="d74f" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">在子网上启用双栈</h1><p id="8c53" class="pw-post-body-paragraph iq ir hi is b it lg iv iw ix lh iz ja jb li jd je jf lj jh ji jj lk jl jm jn hb bi translated">启用双栈IPv4/IPv6。</p><ul class=""><li id="eedd" class="ju jv hi is b it iu ix iy jb jw jf jx jj jy jn jz ka kb kc bi translated">使用<a class="ae jo" href="https://cloud.google.com/vpc/docs/create-modify-vpc-networks#create-network-dual" rel="noopener ugc nofollow" target="_blank">双堆栈子网</a>创建自定义VPC。</li></ul><pre class="jq jr js jt fd ll lm ln lo aw lp bi"><span id="3711" class="lq kj hi lm b fi lr ls l lt lu">gcloud compute networks create <strong class="lm hj"><em class="lv">NETWORK </em></strong>\<br/>    --subnet-mode=custom \<br/>    [ --enable-ula-internal-ipv6 [ --internal-ipv6-range=ULA_IPV6_RANGE ]] \<br/>    --bgp-routing-mode=DYNAMIC_ROUTING_MODE \<br/>    --mtu=MTU</span></pre><ul class=""><li id="59e0" class="ju jv hi is b it iu ix iy jb jw jf jx jj jy jn jz ka kb kc bi translated">或者您可以在现有的自定义模式VPC上启用双堆栈。<a class="ae jo" href="https://cloud.google.com/vpc/docs/create-modify-vpc-networks#subnet-enable-ipv6" rel="noopener ugc nofollow" target="_blank">在子网</a>上启用IPv6。</li></ul><pre class="jq jr js jt fd ll lm ln lo aw lp bi"><span id="a17d" class="lq kj hi lm b fi lr ls l lt lu">gcloud compute networks subnets update <strong class="lm hj"><em class="lv">SUBNET </em></strong>\<br/>    --stack-type=IPV4_IPV6 \<br/>    --ipv6-access-type=<strong class="lm hj"><em class="lv">IPv6_ACCESS_TYPE</em></strong> \<br/>    --region=<strong class="lm hj"><em class="lv">REGION</em></strong></span></pre><ul class=""><li id="5d36" class="ju jv hi is b it iu ix iy jb jw jf jx jj jy jn jz ka kb kc bi translated">接下来，您<a class="ae jo" href="https://cloud.google.com/compute/docs/ip-addresses/configure-ipv6-address#create-vm-ipv6" rel="noopener ugc nofollow" target="_blank">在现有虚拟机上创建一个双堆栈虚拟机</a>或<a class="ae jo" href="https://cloud.google.com/compute/docs/ip-addresses/configure-ipv6-address#update-vm-ipv6" rel="noopener ugc nofollow" target="_blank">将堆栈类型更改为IPv6 </a></li><li id="96e2" class="ju jv hi is b it kd ix ke jb kf jf kg jj kh jn jz ka kb kc bi translated">您也可以创建实例模板</li></ul><pre class="jq jr js jt fd ll lm ln lo aw lp bi"><span id="8450" class="lq kj hi lm b fi lr ls l lt lu">gcloud compute instance-templates create <strong class="lm hj"><em class="lv">TEMPLATE_NAME </em></strong>\<br/>    --subnet=<strong class="lm hj"><em class="lv">SUBNET </em></strong>\<br/>    --stack-type=IPV4_IPV6<br/>    --ipv6-network-tier=PREMIUM \<br/>    --region=<strong class="lm hj"><em class="lv">REGION</em></strong><br/>    --tags=<strong class="lm hj"><em class="lv">TAGS</em></strong><br/>    --image=<strong class="lm hj"><em class="lv">IMAGE</em></strong></span></pre><h1 id="221f" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">在负载平衡器上启用IPv6</h1><p id="4044" class="pw-post-body-paragraph iq ir hi is b it lg iv iw ix lh iz ja jb li jd je jf lj jh ji jj lk jl jm jn hb bi translated">负载平衡器向可用资源公开服务和负载平衡流量。除了IPv4，您还可以在外部负载平衡器上使用IPv6 IPs。</p><figure class="jq jr js jt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/58f00491c374a04bd4c6b32653af6e77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rbpbP4JWhTBeoh9P"/></div></div></figure><p id="5d21" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">IPv6负载平衡器终止</p><p id="cfdc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">文档“<a class="ae jo" href="https://cloud.google.com/load-balancing/docs/ipv6" rel="noopener ugc nofollow" target="_blank">外部HTTP、SSL代理和外部TCP代理负载平衡的IPv6终止</a>”为您提供了有关该过程的更多详细信息。</p><p id="6888" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要查看IPv6的配置，请查看<a class="ae jo" href="https://cloud.google.com/load-balancing/docs/https/setting-up-https" rel="noopener ugc nofollow" target="_blank">请求路由到多区域外部HTTPS负载平衡器</a>文档。</p><p id="7a16" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">要了解有关谷歌云IP地址的更多信息，请查看以下链接:</strong></p><ul class=""><li id="5040" class="ju jv hi is b it iu ix iy jb jw jf jx jj jy jn jz ka kb kc bi translated"><a class="ae jo" href="https://cloud.google.com/compute/docs/ip-addresses" rel="noopener ugc nofollow" target="_blank">文档:IP寻址</a></li><li id="2061" class="ju jv hi is b it kd ix ke jb kf jf kg jj kh jn jz ka kb kc bi translated">博客:<a class="ae jo" href="https://cloud.google.com/blog/topics/developers-practitioners/ip-addressing-options-google-cloud-networking-basics" rel="noopener ugc nofollow" target="_blank">谷歌云的IP地址选项:网络基础知识</a></li></ul><p id="9299" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">想问一个问题，了解更多或分享一个想法？请在<a class="ae jo" href="https://twitter.com/ammettw" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae jo" href="https://www.linkedin.com/in/ammett/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>上与我联系，并给我发消息。</p></div></div>    
</body>
</html>