<html>
<head>
<title>Google Container Registry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌容器注册</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-container-registry-4aca1fc6cf74?source=collection_archive---------0-----------------------#2018-01-25">https://medium.com/google-cloud/google-container-registry-4aca1fc6cf74?source=collection_archive---------0-----------------------#2018-01-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="f4af" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">快速命中</h2></div><p id="626c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae jt" href="http://cloud.google.com/container-registry" rel="noopener ugc nofollow" target="_blank">谷歌容器注册中心</a> (GCR)是一个引人注目的私有(安全)容器注册中心(目前也包括免费的——如啤酒— <a class="ae jt" href="https://cloud.google.com/container-registry/docs/vulnerability-scanning#activating_vulnerability_scanning" rel="noopener ugc nofollow" target="_blank">漏洞扫描</a></p><p id="99ce" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你在谷歌云平台计算(<a class="ae jt" href="https://cloud.google.com/appengine/docs/flexible/" rel="noopener ugc nofollow" target="_blank"> App Engine Flex </a>、<a class="ae jt" href="https://cloud.google.com/kubernetes-engine/" rel="noopener ugc nofollow" target="_blank"> Kubernetes Engine </a>)上运行容器化的工作负载，或者在<a class="ae jt" href="https://cloud.google.com/compute/docs/containers/" rel="noopener ugc nofollow" target="_blank">计算引擎</a>上运行你自己的容器，当你可以保持快速和本地时，为什么要离开谷歌的网络去推拉容器呢？</p><p id="2396" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">像所有GCP服务一样，GCR是安全的。这意味着，当您使用它时，您需要对回购进行认证。所以，常见的<a class="ae jt" href="https://cloud.google.com/container-registry/docs/pushing-and-pulling" rel="noopener ugc nofollow" target="_blank">模式</a>是:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="a1e7" class="kd ke hi jz b fi kf kg l kh ki">PROJECT=[[YOUR-PROJECT]]</span><span id="8020" class="kd ke hi jz b fi kj kg l kh ki">docker tag $(whoami)/my-image gcr.io/${PROJECT}/my-image<br/>gcloud docker -- push gcr.io/${PROJECT}/my-image</span></pre><p id="a5fd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">gcloud命令包装docker CLI来为GCR提供身份验证，以便您可以将映像推送到它那里。谷歌服务可以安全地与GCR对话，所以，例如，在Kubernetes，你可以直接通过它的GCR名字来引用图片。</p><p id="f43e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是，如果您不能或不想使用docker的gcloud wrappers，会发生什么呢？如果您使用的库假设docker将直接执行推/拉操作，那该怎么办？GCR有多种方式让你实现这个目标。我将向你展示最简单的:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="2ab9" class="kd ke hi jz b fi kf kg l kh ki">PASSWORD=$(gcloud auth application-default print-access-token)<br/>docker login \<br/>  --username=oauth2accesstoken \<br/>  --password=${PASSWORD} \<br/>  <a class="ae jt" href="https://gcr.io" rel="noopener ugc nofollow" target="_blank">https://gcr.io</a></span></pre><p id="1f44" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">或者，为了避免安全“警告！”，您可能更喜欢:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="2d3d" class="kd ke hi jz b fi kf kg l kh ki">echo $(gcloud auth application-default print-access-token) \<br/>| docker login \<br/>  --username=oauth2accesstoken \<br/>  --password-stdin \<br/>  <a class="ae jt" href="https://gcr.io" rel="noopener ugc nofollow" target="_blank">https://gcr.io</a></span></pre><p id="167e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，虽然您需要继续为GCR适当地标记图像，但是您可以直接对它们使用docker push和pull:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="3f6d" class="kd ke hi jz b fi kf kg l kh ki">docker tag $(whoami)/my-image gcr.io/${PROJECT}/my-image<br/>docker push gcr.io/${PROJECT}/my-image</span></pre><p id="69dd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">而且，如果您有工具或代码采用Docker(而不是<a class="ae jt" href="https://cloud.google.com/sdk/" rel="noopener ugc nofollow" target="_blank">Google Cloud SDK</a>aka g Cloud)，只要您将“docker.io”注册表引用替换为“gcr.io/${PROJECT}”引用，它现在就会按预期运行。</p><blockquote class="kk kl km"><p id="4864" class="ix iy kn iz b ja jb ij jc jd je im jf ko jh ji jj kp jl jm jn kq jp jq jr js hb bi translated"><strong class="iz hj">注意</strong> GCR是GCP项目特定的，因此有${PROJECT}参考。一种常见的做法是将一个项目指定为您的团队、组织或公司的容器注册中心，然后这就成为一个确定的名称。谷歌就是这么做的。例如，Google Container Builder在一个名为“云构建者”的项目中托管了Google提供的“步骤”,这样所有的图片都可以从"gcr.io/cloud-builders"获得。</p></blockquote><h2 id="78d8" class="kd ke hi bd kr ks kt ku kv kw kx ky kz jg la lb lc jk ld le lf jo lg lh li lj bi translated">容器注册表的Docker Hub镜像</h2><p id="8c31" class="pw-post-body-paragraph ix iy hi iz b ja lk ij jc jd ll im jf jg lm ji jj jk ln jm jn jo lo jq jr js hb bi translated">这让我想到了GCR的第二个有用的见解。我今天了解到，谷歌为经常被请求的图片提供了Docker Hub的镜像。您可以配置Docker守护进程在回退到Docker Hub之前检查GCR的映像(节省时间)。</p><p id="4306" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae jt" href="https://cloud.google.com/container-registry/docs/using-dockerhub-mirroring" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/container-registry/docs/using-docker hub-mirroring</a></p><p id="c5bf" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">整洁！</p><h2 id="3be4" class="kd ke hi bd kr ks kt ku kv kw kx ky kz jg la lb lc jk ld le lf jo lg lh li lj bi translated">集装箱脆弱性分析</h2><p id="bc9a" class="pw-post-body-paragraph ix iy hi iz b ja lk ij jc jd ll im jf jg lm ji jj jk ln jm jn jo lo jq jr js hb bi translated">最后，我提到了GCR提供了一个新的漏洞分析功能。文档在这里。这目前还处于Alpha阶段，因此您需要做一些准备工作来让它运行起来:</p><p id="b4c7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae jt" href="https://cloud.google.com/container-registry/docs/vulnerability-scanning#activating_vulnerability_scanning" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/container-registry/docs/vulnerability-scanning # activating _ vulnerability _ scanning</a></p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="2b77" class="kd ke hi jz b fi kf kg l kh ki">PROJECT=[[YOUR-PROJECT]]</span><span id="ef45" class="kd ke hi jz b fi kj kg l kh ki">gcloud services enable containeranalysis.googleapis.com \<br/>--project=$PROJECT<br/></span></pre><p id="ac6e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">并且:</p><figure class="ju jv jw jx fd lq er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es lp"><img src="../Images/e92b06613c1879783384cba756c08e52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_8mcxF5_yZ_X-q9BtqpFbQ.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">漏洞扫描</figcaption></figure><p id="d6b6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后:</p><figure class="ju jv jw jx fd lq er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es lp"><img src="../Images/0eda378b1bf140a409831525502c79a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3GrYwY6oDQLZNF1ein93gQ.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">图像现在包括“漏洞”</figcaption></figure><p id="f04a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，还可以深入细节:</p><figure class="ju jv jw jx fd lq er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es lp"><img src="../Images/4c2a2ceb5ece91eaa87076417199c139.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yuAGPc2vfvBKZGCEX6mdUw.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">有些工作要我做！</figcaption></figure></div></div>    
</body>
</html>