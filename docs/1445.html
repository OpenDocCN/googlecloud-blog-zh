<html>
<head>
<title>Using the Bigtable emulator with Apache Beam and BigtableIO</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Bigtable模拟器与Apache Beam和BigtableIO一起使用</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/using-the-bigtable-emulator-with-apache-beam-and-bigtableio-151d33a12ff4?source=collection_archive---------1-----------------------#2020-05-27">https://medium.com/google-cloud/using-the-bigtable-emulator-with-apache-beam-and-bigtableio-151d33a12ff4?source=collection_archive---------1-----------------------#2020-05-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/62aebc463acf94af832bf02d996daa0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*g39A4u90ZRXPVnCudv61Jg.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">在本地使用Beam + Bigtable，没有云资源</figcaption></figure><p id="4abb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://cloud.google.com/bigtable" rel="noopener ugc nofollow" target="_blank"> Cloud Bigtable </a>是一个非常棒的高性能分布式NoSQL数据库，可以存储数Pb的数据，但有时您可能需要测试它的少量数据。</p><p id="d5fb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">仅仅为了这个而产生一个远程实例是很麻烦的，你将会为了一个小的测试而浪费一些金钱和云资源。</p><p id="a443" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">幸运的是，<a class="ae jo" href="https://cloud.google.com/bigtable/docs/emulator" rel="noopener ugc nofollow" target="_blank"> Bigtable附带了一个模拟器</a>,可以非常方便地用少量数据进行简单测试，因为您可以在本地计算机上运行它。</p><p id="6f7e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">模拟器在内存中工作，公开与Bigtable相同的接口，因此任何能够连接到真实Bigtable实例的系统也应该能够使用模拟器。</p><p id="e6cc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">文档实际上非常清楚如何设置正确的环境变量来使用模拟器，只需首先启动模拟器，然后在您想要使用模拟器的shell会话中执行该操作:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="2cab" class="jy jz hi ju b fi ka kb l kc kd">$(gcloud beta emulators bigtable env-init)</span></pre><p id="92eb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将添加一个名为<code class="du ke kf kg ju b">BIGTABLE_EMULATOR_HOST</code>的环境变量，其中包含连接到模拟器的详细信息。</p><p id="1a10" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">模拟器是一个最初为空的内存数据库。您需要创建表，填充它们，等等。要创建表格，您可以<a class="ae jo" href="https://cloud.google.com/bigtable/docs/quickstart-cbt" rel="noopener ugc nofollow" target="_blank">使用cbt实用程序</a>。您需要用文件<code class="du ke kf kg ju b">~/.cbtrc</code>中的一些设置来配置它，包括项目和实例名。</p><p id="e7ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是您应该为模拟器使用什么项目和实例名称呢？</p><p id="c1c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这很简单:任何。</p><p id="5ab6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">无论您选择什么样的<em class="kh">项目</em>和<em class="kh">实例</em>值，如果您在Bigtable客户端中设置它，模拟器将访问该表，就像它们在那个<em class="kh">项目</em>和<em class="kh">实例</em>下一样。因此，要创建本地表，只需用如下值配置您的<code class="du ke kf kg ju b">~/.cbtrc</code>文件:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="aabf" class="jy jz hi ju b fi ka kb l kc kd">project = fake-project<br/>instance = fake-instance</span></pre><p id="3483" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后使用<code class="du ke kf kg ju b">cbt</code>实用程序创建表格。</p><p id="531c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您想使用BigtableIO从Apache Beam访问模拟器中的一个表，您必须使用与您的<code class="du ke kf kg ju b">~/.cbtrc</code>文件中相同的项目和实例名称。</p><p id="9e8e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您在定义了<code class="du ke kf kg ju b">BIGTABLE_EMULATOR_HOST</code>变量的shell中使用<code class="du ke kf kg ju b">DirectRunner</code>，BigtableIO将尝试连接到模拟器。例如，下面的代码将尝试从模拟器中名为<code class="du ke kf kg ju b">mytable</code>的表中读取数据:</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="c642" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想写而不是读，也是一样的道理。</p><p id="e6da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您使用任何其他客户端，只需确保设置了环境变量<code class="du ke kf kg ju b">BIGTABLE_EMULATOR_HOST</code>，并使用您选择的项目和实例名称。所有的Bigtable库都检查该环境变量，如果它存在，它们将使用它连接到模拟器，而不是连接到远程实例。</p><p id="2b84" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">结合Bigtable模拟器和Apache Beam的DirectRunner，您可以在本地运行任何使用Bigtable的管道，而不必生成实例，也不必花费任何云资源来进行小型测试。</p></div></div>    
</body>
</html>