<html>
<head>
<title>Stackdriver Debugger and New Relic</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Stackdriver调试器和新遗物</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/cloud-debugger-working-with-new-relic-75f8b3eb6c6?source=collection_archive---------1-----------------------#2017-12-06">https://medium.com/google-cloud/cloud-debugger-working-with-new-relic-75f8b3eb6c6?source=collection_archive---------1-----------------------#2017-12-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b612" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以拥有美好的事物！</p><p id="d9e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的一个客户在尝试使用<a class="ae je" href="https://cloud.google.com/appengine/docs/flexible/" rel="noopener ugc nofollow" target="_blank"> App Engine Flex </a>和New Relic的<a class="ae je" href="https://newrelic.com/application-monitoring" rel="noopener ugc nofollow" target="_blank"> APM代理</a>配置<a class="ae je" href="https://cloud.google.com/appengine/docs/flexible/custom-runtimes/build" rel="noopener ugc nofollow" target="_blank">定制运行时</a>时发现了冲突。出现这个问题是因为新的Relic配置正在取代<a class="ae je" href="https://cloud.google.com/debugger/" rel="noopener ugc nofollow" target="_blank"> Stackdriver调试器</a>配置。解决方案是找到一种为两者配置JVM的方法。</p><p id="9565" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是工作文档:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><p id="c360" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用了新的遗留文档(<a class="ae je" href="https://docs.newrelic.com/docs/accounts-partnerships/partnerships/google-cloud-platform-gcp/google-app-engine-environment" rel="noopener ugc nofollow" target="_blank">链接</a>)作为起点，但这并不说明Stackdriver调试器。事实上，一个反复试验的过程解决了上面“JAVA_OPTS”混合版本中出现的问题。然后，我向工程部门确认了解决方案。</p><p id="753c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你需要一个新的遗迹<a class="ae je" href="https://newrelic.com/signup" rel="noopener ugc nofollow" target="_blank">账号</a>来完成这个任务。我假设你已经配置好了，并愉快地使用谷歌云平台(GCP)。对于上面定义的Dockerfile，为了简单起见，我将所有内容都放在一个目录中。如果您重新定位项目，例如“newrelic”目录，请确保在ADD语句中反映这一点。</p><p id="7553" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保新的Relic (newrelic.yml)配置文件是正确的。您需要反映“许可证密钥”和“应用程序名称”的值。为了调试(暂时)，我按照New Relic文档指导，设置了“log_file_name: STDOUT”。</p><p id="7922" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于app.yaml，新的Relic文档建议禁用应用引擎健康检查，但这在Flex中目前是不可能的。不过，您应该添加环境变量建议，它将类似于:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><p id="ae39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从包含app.yaml和Dockerfile文件的目录中，您可以运行:</p><pre class="jf jg jh ji fd jm jn jo jp aw jq bi"><span id="3e29" class="jr js hi jn b fi jt ju l jv jw">gcloud app deploy --project=$PROJECT --quiet</span></pre><p id="8d89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">部署完成后，卷曲端点会产生:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jx"><img src="../Images/ac2d064148406e5828c2948e71fa0c7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*RKbdfJaZyiLDs1WehCEnaA.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">那是我的兄弟！</figcaption></figure><p id="e4b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你的app可能比这个更复杂；-)</p><p id="5d09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Stackdriver调试器中，我在第35行放了一个快照，生成了输出“Hello Henry ”:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es ke"><img src="../Images/a5fff5ca1b86d8e919316193256e2dbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u5x4jrfgkizlymYM0da3yA.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">Stackdriver调试器:正在等待</figcaption></figure><p id="35fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我对着端点发出一个旋度来触发它:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kj"><img src="../Images/8b6448f639c140d8d33caf11b6a12014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3k5lWFMwRwYTgMvjVYVfsg.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">Stackdriver调试器:已捕获！</figcaption></figure><p id="135b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与此同时，衡量标准也被输入到New Relic中:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kk"><img src="../Images/0fd2cfba745ec0cbf2cc360d48f3b84c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PW8-pMmqubSpZAFqsd7S5g.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">App Engine Flex上的新遗留APM报告</figcaption></figure><h2 id="8e7c" class="jr js hi bd kl km kn ko kp kq kr ks kt iq ku kv kw iu kx ky kz iy la lb lc ld bi translated">结论</h2><p id="c545" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">这种方法应该适用于您希望与Stackdriver Debugger结合使用的其他代理。诀窍是确保Java运行时的Stackdriver调试器配置得到保留。</p></div></div>    
</body>
</html>