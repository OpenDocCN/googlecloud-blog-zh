<html>
<head>
<title>How to log your application on Google Compute Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Google计算引擎上登录您的应用程序</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-log-your-application-on-google-compute-engine-6600d81e70e3?source=collection_archive---------0-----------------------#2017-06-15">https://medium.com/google-cloud/how-to-log-your-application-on-google-compute-engine-6600d81e70e3?source=collection_archive---------0-----------------------#2017-06-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="76d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我有一个运行在Google计算引擎实例上的自定义守护进程，我想以某种方式让它的日志进入一个更好的界面。某种方法来记录日志，而不必一直ssh到实例中。</p><p id="11ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我花了一点时间搜索和拼凑，才弄明白如何做到这一点，所以我想我应该分享一下所涉及的内容。</p><p id="b255" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一部分是Stackdriver日志。这是作为谷歌云平台的一部分提供的服务:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/e108473488366d2cf21fefa5b938e579.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*F7xuUy0y41V24qln.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">堆叠驱动测井</figcaption></figure><p id="0834" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它为您记录的事件提供了一个相当好的界面。您可以从Google Cloud控制台进入日志-&gt;日志:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jt"><img src="../Images/6c0a76f653cba01140f4a94b89de82a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BYEIaNaIXjDQC9Ff3nGRQg.png"/></div></div></figure><p id="6b39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很好，那么我们如何将应用程序的日志放入这里呢？首先，您需要在计算引擎实例上安装日志代理。这超级简单，只要按照这里的安装说明:<a class="ae ju" href="https://cloud.google.com/logging/docs/agent/installation" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/logging/docs/agent/installation</a></p><p id="7869" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅供参考:fluentd在我的实例上使用了大约300MB的内存。</p><p id="fb5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装完成后，我们需要添加一个定制的fluentd配置。有了这个配置，fluentd将查看我们的日志文件，并为我们将事件馈送到Stackdriver日志中。以下是我最终使用的配置之一:</p><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="33d5" class="ka kb hi jw b fi kc kd l ke kf">&lt;source&gt;<br/> type tail<br/> format none<br/> path /home/bitcoin/data/debug.log<br/> pos_file /var/lib/google-fluentd/pos/bitcoind.pos<br/> read_from_head true<br/> tag bitcoind<br/>&lt;/source&gt;</span></pre><p id="97cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此配置捕获bitcoind的日志。它告诉fluentd像读<code class="du kg kh ki jw b">tail -f </code>一样读<code class="du kg kh ki jw b">/home/bitcoin/data/debug.log</code>。它应该跟踪它停止的地方，所以重新启动后，它会继续正常运行。行<code class="du kg kh ki jw b">read_from_head true</code>告诉fluentd，当第一次读取文件时，从头开始。如果您的日志中已经有内容，并且希望fluentd“跟上”,这将非常有用。由于位置跟踪，这应该只在fluentd第一次读取文件时有关系。fluentd以root身份运行，所以我不需要对<code class="du kg kh ki jw b">debug.log</code>上的权限做任何特殊的事情。</p><p id="46ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将该配置文件写入<code class="du kg kh ki jw b">/etc/google-fluentd/config.d/bitcoind.conf</code>，或者随意命名。然后调用<code class="du kg kh ki jw b">sudo service google-fluentd reload</code>。应该就是这样！fluentd将查看日志并将条目转储到Stackdriver中。</p><p id="3eea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您返回到Stackdriver日志记录，您应该能够调出您的实例的日志，并看到您的应用程序的所有日志。不错！</p><p id="7270" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，默认情况下，fluentd似乎会在安装后自动捕获您的系统日志。因此，如果您已经设置了您的应用程序来记录syslog，您就不需要做上面的任何配置。在我的例子中，我使用systemd设置了另一个守护进程，所以我只在它的<code class="du kg kh ki jw b">.service</code>文件中设置了<code class="du kg kh ki jw b">StandardOutput=journal</code>，它将其stdout通过管道传输到syslog。<code class="du kg kh ki jw b">systemd</code>在日志条目前添加服务名，这样很容易在Stackdriver中过滤。</p><p id="5523" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">伐木快乐！</p></div></div>    
</body>
</html>