<html>
<head>
<title>Push Notification for React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React Native的推送通知</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/push-notification-for-react-native-bef05ea4d1d0?source=collection_archive---------1-----------------------#2017-03-23">https://medium.com/google-cloud/push-notification-for-react-native-bef05ea4d1d0?source=collection_archive---------1-----------------------#2017-03-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6b2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将向您展示如何使用Firebase数据库、应用服务器(GPC AppEngine)和Firebase Cloud Messaging(FCM)为React Native App实现推送通知，这是一种跨平台的消息传递解决方案，可让您可靠地传递消息。最后，我还将向您展示如何为Firebase实现Google函数来运行无服务器环境。</p><p id="842d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不过，在本文中，我这次只关注iOS for RN应用程序。</p><h1 id="d26d" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">React Native(iOS)的推送通知设置</h1><p id="d2d0" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">我将使用这个库:<a class="ae kg" href="https://github.com/evollu/react-native-fcm" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> react-native-fcm </strong> </a>，它是一个用于firebase云消息传递和本地通知的模块。关于安装和配置，您可以参考此处的<a class="ae kg" href="https://github.com/evollu/react-native-fcm#installation" rel="noopener ugc nofollow" target="_blank">获取详细信息。</a></p><h2 id="b4a6" class="kh je hi bd jf ki kj kk jj kl km kn jn iq ko kp jr iu kq kr jv iy ks kt jz ku bi translated">iOS的配置</h2><ol class=""><li id="a014" class="kv kw hi ih b ii kb im kc iq kx iu ky iy kz jc la lb lc ld bi translated">pod初始化</li></ol><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="2762" class="kh je hi lj b fi ln lo l lp lq">$&gt; cd<!-- --> <!-- -->ios &amp;&amp; pod init</span></pre><p id="99f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.编辑“Podfile”</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="748a" class="kh je hi lj b fi ln lo l lp lq"># Uncomment the next line to define a global platform for your project<br/># platform :ios, '9.0'<br/><br/>target 'ProjecName' do<br/>  # Uncomment the next line if you're using Swift or would like to use dynamic frameworks<br/>  use_frameworks!<br/><br/>  # Pods for ProjecName<br/>  pod 'Firebase/Messaging'<br/><br/>  target 'ProjecName-tvOSTests' do<br/>    inherit! :search_paths<br/>    # Pods for testing<br/>  end<br/><br/>  target 'ProjecNameTests' do<br/>    inherit! :search_paths<br/>    # Pods for testing<br/>  end<br/><br/>end</span></pre><p id="983a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.pod安装</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="c7a2" class="kh je hi lj b fi ln lo l lp lq">$&gt; pod install<!-- --> </span></pre><blockquote class="lr ls lt"><p id="517e" class="if ig lu ih b ii ij ik il im in io ip lv ir is it lw iv iw ix lx iz ja jb jc hb bi translated">当你在xCode上构建时，你必须打开PROJECT_NAME.xcworkspace，而不是<strong class="ih hj"> [***。xcodeproj] </strong></p></blockquote><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="c5f6" class="kh je hi lj b fi ln lo l lp lq">$&gt; open ios/PROJECT_NAME.xcworkspac</span></pre><p id="faad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.认证设置</p><p id="2793" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参见<a class="ae kg" href="https://firebase.google.com/docs/cloud-messaging/ios/certs" rel="noopener ugc nofollow" target="_blank">https://firebase.google.com/docs/cloud-messaging/ios/certs</a></p><blockquote class="lr ls lt"><p id="1a9c" class="if ig lu ih b ii ij ik il im in io ip lv ir is it lw iv iw ix lx iz ja jb jc hb bi translated"><em class="hi">注意:您</em> <strong class="ih hj"> <em class="hi">必须</em> </strong> <em class="hi">拥有一个付费的苹果开发者账户，才能在您的应用中启用推送通知。</em></p></blockquote><p id="f849" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.编辑AppDelegate.h / AppDelegate.m</p><p id="1703" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参见<a class="ae kg" href="https://github.com/evollu/react-native-fcm#shared-steps" rel="noopener ugc nofollow" target="_blank">https://github.com/evollu/react-native-fcm#shared-steps</a></p><p id="ab20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.Xcode构建设置</p><p id="01b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请参考<a class="ae kg" href="https://github.com/evollu/react-native-fcm#xcode-post-installation-steps" rel="noopener ugc nofollow" target="_blank">https://github . com/evollu/react-native-FCM # xcode-安装后步骤</a></p><figure class="le lf lg lh fd lz er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es ly"><img src="../Images/f0994a779f553c8d0ca965c17f6e6060.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ge_Fy4HBw2O91WMBppIRog.png"/></div></div></figure><figure class="le lf lg lh fd lz er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es mg"><img src="../Images/15b791a5136d46c1f28b5e1081095f0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qKe-O-c-xp5SrPItorUbKA.png"/></div></div></figure><p id="37e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.FCM配置</p><p id="49f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">= &gt;在<a class="ae kg" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>中，您可以获取<code class="du mh mi mj lj b">google-services.json</code>文件并将其放入<code class="du mh mi mj lj b">android/app</code>目录，获取<code class="du mh mi mj lj b">GoogleService-Info.plist</code>文件并将其放入<code class="du mh mi mj lj b">/ios/your-project-name</code>目录(在您的<code class="du mh mi mj lj b">Info.plist</code>旁边)</p><p id="09d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8.让我们编写示例代码</p><figure class="le lf lg lh fd lz"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="03dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">9.试验</p><p id="f614" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦您完成了所有这些设置和构建项目，您就可以测试它是否能很好地从Firebase控制台发送测试通知。要从通知控制台发送通知，请转到<a class="ae kg" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>，然后打开您的项目，再打开通知控制台，开始向用户段发送通知。</p><figure class="le lf lg lh fd lz er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es mm"><img src="../Images/0c7acaf36105375e3c83132d27473462.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GrGcXD_u3YzF-ZERQlxAzg.png"/></div></div></figure><h1 id="297d" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">应用服务器(GPC AppEngine)实现</h1><p id="2f6a" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">有两种通过FCM组织用户2用户通知发送的方法:</p><ul class=""><li id="e2b5" class="kv kw hi ih b ii ij im in iq mn iu mo iy mp jc mq lb lc ld bi translated">使用自己的FCM应用服务器实现FCM。</li><li id="8058" class="kv kw hi ih b ii mr im ms iq mt iu mu iy mv jc mq lb lc ld bi translated">没有FCM应用服务器的FCM实施(仅使用React本地应用客户端)。</li></ul><p id="6c80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">考虑到安全性，不建议在没有FCM应用服务器的情况下实施。<strong class="ih hj">为什么是</strong>？它直接从客户端使用FCM连接服务器API <strong class="ih hj">，使用带有授权头的HTTP <code class="du mh mi mj lj b">POST</code>请求，这是您的FCM API密钥。因此，在本文中，我将向您展示如何使用自己的FCM应用服务器(GPC AppEngine)来实现。最好使用Firebase App Server，它将负责与FCM连接服务器进行交互。</strong></p><figure class="le lf lg lh fd lz er es paragraph-image"><div class="er es mw"><img src="../Images/436e69647c447401d9d94fa08b67ecf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*wtYGlFPNRU-rzLu0K0rNKQ.png"/></div><figcaption class="mx my et er es mz na bd b be z dx translated">当用户A向用户B发送消息时</figcaption></figure><p id="5f28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有几种方法可以向目标(或设备)发送消息。<br/> 1。发送到单个设备(<em class="lu">设备的注册令牌</em>)<br/>2。发送到设备组(设备的<em class="lu">注册令牌组</em>)<br/>3。发送到一个话题(<em class="lu">发布/订阅</em>模式)<br/> 4。发送到条件(组合<em class="lu">发布/订阅</em>主题)</p><blockquote class="lr ls lt"><p id="e0a6" class="if ig lu ih b ii ij ik il im in io ip lv ir is it lw iv iw ix lx iz ja jb jc hb bi translated">详情请参考<a class="ae kg" href="https://firebase.google.com/docs/cloud-messaging/admin/send-messages" rel="noopener ugc nofollow" target="_blank">https://firebase . Google . com/docs/cloud-messaging/admin/send-messages</a></p></blockquote><h2 id="96a3" class="kh je hi bd jf ki kj kk jj kl km kn jn iq ko kp jr iu kq kr jv iy ks kt jz ku bi translated">方案</h2><p id="c987" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">1)用户A在列表<br/>中写入了某个<em class="lu">主题</em>2)由于列表中添加了新的主题，其他用户如用户B将收到推送通知</p><blockquote class="lr ls lt"><p id="2e23" class="if ig lu ih b ii ij ik il im in io ip lv ir is it lw iv iw ix lx iz ja jb jc hb bi translated">用户A和用户使用Firebase Auth进行身份验证。</p></blockquote><div class="le lf lg lh fd ab cb"><figure class="nb lz nc nd ne nf ng paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><img src="../Images/3c5140f746f10860fe98071c79f0b298.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*LFT_M6DYnWCDVszW6egnkQ.png"/></div></figure><figure class="nb lz nh nd ne nf ng paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><img src="../Images/5e1cd7da62eb4aa1cc7e6af6b928dff3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*Fogz1obDRhFhkPkpYntMQA.png"/></div><figcaption class="mx my et er es mz na bd b be z dx ni di nj nk translated">左边的用户A/右边的用户B</figcaption></figure></div><p id="1e0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是推送通知在我们的设置中的工作方式:</p><ol class=""><li id="7830" class="kv kw hi ih b ii ij im in iq mn iu mo iy mp jc la lb lc ld bi translated">用户“A”在列表中写下一些<em class="lu">主题</em>以及Firebase数据库上的<em class="lu">通知请求</em></li><li id="cc34" class="kv kw hi ih b ii mr im ms iq mt iu mu iy mv jc la lb lc ld bi translated">应用服务器(GCP AppEngine)在Firebase数据库上跟踪新通知请求的数据</li><li id="2ca5" class="kv kw hi ih b ii mr im ms iq mt iu mu iy mv jc la lb lc ld bi translated">对于列表中添加的新主题，应用服务器通过FCM向特定的<strong class="ih hj">主题</strong>发送消息。[ <a class="ae kg" href="https://firebase.google.com/docs/cloud-messaging/admin/send-messages" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">基于主题的通知</strong> </a> ]</li><li id="ad2e" class="kv kw hi ih b ii mr im ms iq mt iu mu iy mv jc la lb lc ld bi translated">其他用户，如已订阅特定<strong class="ih hj">主题</strong>的用户‘B’，将收到我们从应用服务器发送给FCM的通知<br/>例如，RN应用的用户将订阅<strong class="ih hj"> <em class="lu"> /topics/list </em> </strong></li></ol><h1 id="83ea" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">从RN应用程序发送推送通知</h1><p id="4860" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated"><strong class="ih hj">fire base数据库的数据结构</strong></p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="491e" class="kh je hi lj b fi ln lo l lp lq">- notificationRequests<br/>    $pushid<br/>      from_username: "TJ"<br/>      message: "just posted new topic"</span><span id="9ef5" class="kh je hi lj b fi nl lo l lp lq">- subjects<br/>    $pushid<br/>      author: "TJ"<br/>      title: "sample subject"</span></pre><p id="4f13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当用户“A”将“样本主题”添加到列表中时</p><figure class="le lf lg lh fd lz"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="51aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在这里使用数据库作为队列。RN app将发送通知的请求写入数据库，App Server将获取该请求并通过云消息发送通知。</p><h1 id="6311" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">AppServer代码</h1><p id="c746" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">以下代码向您展示了它如何跟踪新通知的数据并将通知发送到特定的<strong class="ih hj">主题</strong>。这将是一个节点流程，运行在<a class="ae kg" href="https://cloud.google.com/nodejs/" rel="noopener ugc nofollow" target="_blank">谷歌应用引擎</a>上。节点脚本监控我们上面看到的通知队列。对于添加到该队列的每个孩子，它提取必要的信息，然后调用云消息发送来发送通知。如果成功，它将从队列中删除通知请求。</p><figure class="le lf lg lh fd lz"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="311d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要使上面的脚本工作，您必须将Firebase Admin SDK添加到您的服务器中。你可以参考<a class="ae kg" href="https://firebase.google.com/docs/admin/setup" rel="noopener ugc nofollow" target="_blank">这里的</a>了解详情</p><h1 id="25de" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">部署到AppEngine</h1><p id="fe12" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">现在您可以将节点代码部署到AppEngine。具体可以参考<a class="ae kg" href="https://cloud.google.com/nodejs/" rel="noopener ugc nofollow" target="_blank">在谷歌云平台</a> <em class="lu">上运行node.js。</em></p><p id="d3cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将应用程序部署到灵活的环境(如Node)时，默认情况下最少有两个实例。除非另有说明，否则平台将不断产生新的实例，直到满足最低要求。</p><h2 id="bdd9" class="kh je hi bd jf ki kj kk jj kl km kn jn iq ko kp jr iu kq kr jv iy ks kt jz ku bi translated">自动缩放</h2><p id="fbf1" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">您可以在<code class="du mh mi mj lj b">app.yaml</code>文件中设置自动缩放。例如:</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="9e13" class="kh je hi lj b fi ln lo l lp lq">service: my-service</span><span id="ad6b" class="kh je hi lj b fi nl lo l lp lq">runtime: nodejs</span><span id="b72b" class="kh je hi lj b fi nl lo l lp lq">env: flex</span><span id="57c7" class="kh je hi lj b fi nl lo l lp lq">automatic_scaling:</span><span id="2e3c" class="kh je hi lj b fi nl lo l lp lq">min_num_instances: 5</span><span id="2ba2" class="kh je hi lj b fi nl lo l lp lq">max_num_instances: 20</span><span id="a8d4" class="kh je hi lj b fi nl lo l lp lq">cool_down_period_sec: 120 # default value</span><span id="7d46" class="kh je hi lj b fi nl lo l lp lq">cpu_utilization:</span><span id="2389" class="kh je hi lj b fi nl lo l lp lq">target_utilization: 0.5</span></pre><blockquote class="lr ls lt"><p id="02ed" class="if ig lu ih b ii ij ik il im in io ip lv ir is it lw iv iw ix lx iz ja jb jc hb bi translated">详见<a class="ae kg" href="https://cloud.google.com/appengine/docs/flexible/nodejs/configuring-your-app-with-app-yaml#automatic_scaling" rel="noopener ugc nofollow" target="_blank"><em class="hi">https://cloud . Google . com/app engine/docs/flexible/nodejs/configuring-your-app-with-app-YAML # automatic _ scaling</em></a></p></blockquote><h1 id="aa5b" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">在RN应用程序中接收通知</h1><h2 id="b928" class="kh je hi bd jf ki kj kk jj kl km kn jn iq ko kp jr iu kq kr jv iy ks kt jz ku bi translated">订阅主题</h2><p id="6e4e" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">最后，当用户登录时只订阅主题，当用户注销时取消订阅主题</p><figure class="le lf lg lh fd lz"><div class="bz dy l di"><div class="mk ml l"/></div></figure><h1 id="4513" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">更多事情要做</h1><p id="90b1" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">上面的简单脚本中没有自动重试功能，所以当您重新启动脚本时，它只会重试失败的通知。对于一个更具可伸缩性的方法，考虑一下<a class="ae kg" href="https://github.com/firebase/firebase-queue" rel="noopener ugc nofollow" target="_blank"> firebase-queue </a>库。如果您在服务器上使用<a class="ae kg" href="https://github.com/firebase/firebase-queue" rel="noopener ugc nofollow" target="_blank"> firebase-queue </a>，它是一个任务队列，不断监听“<strong class="ih hj">队列/任务</strong>集合中的任务。然后，您可以让客户端设备向该集合添加发送FCM消息的任务，这将由您的服务器自动处理。只需确保为"<strong class="ih hj">队列/任务</strong>"集合设置适当的安全规则。</p><h1 id="f453" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">使用Firebase的云功能发送通知(测试版)</h1><p id="ddcb" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">如果你想像上面那样不运行App Server(AppEngine)就发送通知，可以直接从Firebase使用云功能。Cloud Functions集成了Firebase平台，允许您编写代码来响应事件并调用由其他Firebase功能(如分析、实时数据库、身份验证和存储)公开的功能。是啊！这使得使用Firebase连接和扩展google云服务变得很容易！它刚刚发布，所以现在是测试版。</p><p id="8315" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你进入firebase控制台时，你会看到如下图所示的<strong class="ih hj"> <em class="lu">功能</em> </strong></p><figure class="le lf lg lh fd lz er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es nm"><img src="../Images/567b73be413f07c0c9dcfb4ee4210d18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ykYcjJzW6hXkYQmQyDgEA.png"/></div></div></figure><p id="17d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，为云函数编写一些代码来发送通知。这和你在上面做的场景是一样的。</p><figure class="le lf lg lh fd lz er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es nn"><img src="../Images/82948c4d78055833f45e30cefd2812ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AlsOlcfZEN60mX2axBh0Yw.jpeg"/></div></div></figure><p id="78e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是推送通知在我们的设置中的工作方式:</p><ol class=""><li id="1892" class="kv kw hi ih b ii ij im in iq mn iu mo iy mp jc la lb lc ld bi translated">该函数在写入存储subjectData的实时数据库路径时触发。</li><li id="cb38" class="kv kw hi ih b ii mr im ms iq mt iu mu iy mv jc la lb lc ld bi translated">该函数通过FCM向特定的<strong class="ih hj">主题</strong>发送消息。</li><li id="7bd2" class="kv kw hi ih b ii mr im ms iq mt iu mu iy mv jc la lb lc ld bi translated">FCM向订阅了'<strong class="ih hj"><em class="lu">/topics/list '</em></strong>'的用户设备发送通知消息。</li></ol><p id="a59f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，您必须安装Firebase CLI</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="48e7" class="kh je hi lj b fi ln lo l lp lq">npm install -g firebase-tools</span></pre><p id="7864" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，初始化您的项目</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="1226" class="kh je hi lj b fi ln lo l lp lq">firebase login<br/>cd path/to/yourProject<br/>firebase init functions</span></pre><p id="0d31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦这些命令完全成功，你的项目结构将看起来像这样。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="8d31" class="kh je hi lj b fi ln lo l lp lq">myproject<br/> +- .firebaserc <br/> |<br/> +- firebase.json<br/> |<br/> +- functions/     # Directory containing all your functions code<br/>      |<br/>      +- package.json <br/>      |<br/>      +- index.js<br/>      |<br/>      +- node_modules/</span></pre><p id="7321" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">编辑functions文件夹中的index.js文件</p><figure class="le lf lg lh fd lz"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="8e64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，使用Firebase CLI部署您的功能。您可以使用Firebase控制台查看和搜索日志。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="68af" class="kh je hi lj b fi ln lo l lp lq">firebase deploy --only functions</span></pre><figure class="le lf lg lh fd lz er es paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="er es no"><img src="../Images/ab1f8cf8093b4fc19f93050f38968b7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2SWCoGpL0VntG2dwc2lY4w.png"/></div></div><figcaption class="mx my et er es mz na bd b be z dx translated">日志</figcaption></figure><p id="8e47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这个！我希望这篇文章能帮助你为你的React原生应用实现推送通知！</p><h1 id="7ea8" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">参考</h1><ul class=""><li id="dee8" class="kv kw hi ih b ii kb im kc iq kx iu ky iy kz jc mq lb lc ld bi translated"><a class="ae kg" href="http://blog.techmagic.co/firebase-cloud-messaging-for-push-notifications/" rel="noopener ugc nofollow" target="_blank">http://blog . tech magic . co/firebase-cloud-messaging-for-push-notifications/</a></li><li id="2b51" class="kv kw hi ih b ii mr im ms iq mt iu mu iy mv jc mq lb lc ld bi translated"><a class="ae kg" href="https://firebase.googleblog.com/2016/08/sending-notifications-between-android.html" rel="noopener ugc nofollow" target="_blank">https://firebase . Google blog . com/2016/08/sending-notifications-between-Android . html</a></li><li id="f9f4" class="kv kw hi ih b ii mr im ms iq mt iu mu iy mv jc mq lb lc ld bi translated"><a class="ae kg" href="https://firebase.google.com/docs/functions/" rel="noopener ugc nofollow" target="_blank">https://firebase.google.com/docs/functions/</a></li></ul></div></div>    
</body>
</html>