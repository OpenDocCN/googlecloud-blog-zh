<html>
<head>
<title>How to write a custom function library for Google Sheets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为Google Sheets编写自定义函数库</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-write-a-custom-function-library-for-google-sheets-87f62729e684?source=collection_archive---------1-----------------------#2020-12-09">https://medium.com/google-cloud/how-to-write-a-custom-function-library-for-google-sheets-87f62729e684?source=collection_archive---------1-----------------------#2020-12-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6644" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将展示一种定制Google Workspace环境的方法。我们将在Google Sheets中实现两个自定义函数。以这些函数为例，我将演示如何使用Google Apps脚本库来组织和分发您的解决方案。有多种方法可以在Google Workspace中分发您的应用程序脚本代码，本文将帮助您决定这种库方法是否适合您。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b5487e209fd2a6834bec4acb2e5c387c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9CNRoTTjtNO7-1cT"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Gabriel Sollmann 在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="830c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自定义函数是解决Google Sheets中特定用例的好方法。在这种情况下，我将关注如何维护函数，而不是函数本身，因此我的示例函数基于<a class="ae jt" href="https://developers.google.com/apps-script/quickstart/custom-functions" rel="noopener ugc nofollow" target="_blank">快速入门:菜单和自定义函数|应用程序脚本</a>中的示例。</p><h1 id="33a7" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">容器绑定脚本</h1><p id="6a0a" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">Google Sheets使用<a class="ae jt" href="https://developers.google.com/apps-script/guides/bound" rel="noopener ugc nofollow" target="_blank">容器绑定脚本| Apps脚本</a>。这意味着脚本与工作表一起提供，如果您制作工作表的副本，您将自动获得脚本的副本。这使得在脚本中维护自定义函数变得困难。</p><p id="895a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将函数转移到库中解决了维护问题。然而，它引入了一个新的问题。一旦函数在库中，它们在Google表单上就不可见了。为了解决这个问题，我们需要将函数放回Google Sheet的容器绑定脚本中。</p><h1 id="19fb" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">为什么要使用库来分发你的函数</h1><p id="5fe9" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">通过图书馆，您将获得:</p><ul class=""><li id="a4ea" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">代码的版本控制</li><li id="8300" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">对开发或生产版本的控制</li><li id="476c" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">轻松分发您的代码</li></ul><p id="3e5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于库，你也要在易用性和维护性之间做出权衡。这些解决方案的主要缺点是:</p><ul class=""><li id="d18c" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">不太直观的函数名</li><li id="4cdb" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">帮助信息获取很难实现</li></ul><p id="f83a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jt" href="https://developers.google.com/apps-script/guides/libraries" rel="noopener ugc nofollow" target="_blank">库|应用程序脚本</a>描述了如何创建库。下面的示例代码使用了本文中描述的构造<a class="ae jt" rel="noopener" href="/swlh/structure-and-simplify-your-google-apps-script-with-v8-37e29d3e1edf">结构，并简化了你的Google Apps脚本(用)V8 </a>。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="1005" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本例中，我们将两个自定义函数移动到custom functions对象中。这些函数放在allFunctions对象中。</p><p id="c0b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">getFunctions函数根据名称返回一个函数，并将参数传递给自定义函数。</p><p id="8e3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是添加库。在下面的示例中，库的名称是sheetFunctions。一旦库可用，我们就可以使函数可用。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="b60e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的例子中，我们用两种方式实现了这个功能。第一到第七行支持自定义函数的这种用法:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ln"><img src="../Images/f5093ef2a7ea23075344e71abb5fa2e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/0*Y2v3_NvLUKlFXisW"/></div></figure><p id="31d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第九行到第十八行将提供帮助信息。这消除了使用库的缺点，但是它使得引入新函数或改变函数的参数变得困难。该函数的实现保留在库中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lo"><img src="../Images/3fddda0669f368c71d23ef61f6f4177b.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/0*eMvKF_FE2BzpzjMu"/></div></figure><p id="9e4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我展示了如何将自定义函数移动到库中。</p><p id="d0fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Google Sheet中维护定制功能还有其他方法，实现一个附加组件(<a class="ae jt" href="https://developers.google.com/gsuite/add-ons/overview" rel="noopener ugc nofollow" target="_blank">用附加组件扩展Google Workspace | Google Workspace附加组件</a>)也是维护和分发定制功能的一个好方法。当您不想使用附加组件，但仍然希望能够在发布后维护您的代码时，使用库会有所帮助。</p><p id="0d83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想更深入地了解这些函数和库，请阅读Google Sheets | Apps脚本和<a class="ae jt" href="https://developers.google.com/apps-script/guides/libraries" rel="noopener ugc nofollow" target="_blank">库| Apps脚本</a>中的指南<a class="ae jt" href="https://developers.google.com/apps-script/guides/sheets/functions" rel="noopener ugc nofollow" target="_blank">自定义函数。</a></p><p id="bb83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">资源</strong>:</p><p id="71cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jt" href="https://developers.google.com/apps-script/guides/sheets/functions" rel="noopener ugc nofollow" target="_blank">Google Sheets | Apps脚本中的自定义功能</a></p><p id="5792" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jt" href="https://developers.google.com/apps-script/quickstart/custom-functions" rel="noopener ugc nofollow" target="_blank">快速入门:菜单和自定义功能|应用程序脚本</a></p><p id="d01b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jt" rel="noopener" href="/swlh/structure-and-simplify-your-google-apps-script-with-v8-37e29d3e1edf">使用V8构建并简化您的Google Apps脚本</a></p></div></div>    
</body>
</html>