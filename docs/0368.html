<html>
<head>
<title>How good is Google Cloud’s CDN?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云的CDN到底有多好？</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-good-is-google-clouds-cdn-e181a16f0404?source=collection_archive---------0-----------------------#2017-08-31">https://medium.com/google-cloud/how-good-is-google-clouds-cdn-e181a16f0404?source=collection_archive---------0-----------------------#2017-08-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/d9dc4b6b7d36750855f51f34b01f8003.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i8gFMHNLtQJj-DnrepTSjw.jpeg"/></div></div></figure><div class=""/><p id="2178" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在之前，我们讨论过<a class="ae jo" rel="noopener" href="/@duhroach/removing-the-need-for-caching-servers-with-gcps-load-balancers-ae516497c7fb">如何扩展负载均衡器，以利用</a><a class="ae jo" href="https://cloud.google.com/cdn/" rel="noopener ugc nofollow" target="_blank">谷歌的CDN </a>。其结果是减少了您的麻烦，并为最终用户提供了更快的读取速度。</p><p id="84d8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一些社交媒体朋友伸出手来说“<em class="jp">这很好，但是谷歌的CDN到底有多好呢？</em></p><p id="29e8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那是…...事实上，这是一个很好的问题。让我们来看看如何侧写谷歌的CDN。</p><figure class="jq jr js jt fd hk"><div class="bz dy l di"><div class="ju jv l"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">忙到没时间看书？看看上面的视频！</figcaption></figure><h1 id="7b69" class="ka kb ht bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">CDN传输时间</h1><p id="7fad" class="pw-post-body-paragraph iq ir ht is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">当CDN能够在尽可能靠近请求者的地方缓存所请求的资产时，它工作正常。这有两个主要因素:A)是否有效，B)是否在任何地方都有效？</p><p id="2bd8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jp">有用吗</em>很容易测试。我们简单地在CDN上设置一个资产，带有缓存头，并对它发出500次左右的cURL命令。</p><p id="8247" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当该请求的延迟看起来像下图时，您知道您的CDN工作正常。在时间轴的前端有一堆标准请求，(其中延迟与请求者和服务器之间的物理距离有关)，一旦发生缓存，延迟就会显著下降。在这种情况下，缓存结果几乎是即时的:</p><figure class="jq jr js jt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ld"><img src="../Images/965a479a797721280ba35bd1ae1fe9a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wh1drR5YgkAujkqcRkPkVg.png"/></div></div></figure><p id="30a1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">或许最重要的是，cdn最大限度地减少了地理差异对获取的影响。这就是为什么“它是否在任何地方都有效”部分同样重要，并且对于我们的目的来说，同样容易测试。</p><p id="50e6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，把一个资产放在一个服务器上，比如说，在北美，(可能在一个烧烤餐馆附近)，然后从世界各地的一堆机器上获取这个资产。</p><figure class="jq jr js jt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es le"><img src="../Images/6cdaf5ce3332656ae1169efea71c7386.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hiU3TJrC3Onam0-sov-zlA.png"/></div></div></figure><p id="c344" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下图显示了我们从亚洲、澳大利亚和欧洲的一台机器上获取的资产。</p><figure class="jq jr js jt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lf"><img src="../Images/482f2293d4d38f0b9a7412c9d5126520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gAW_kV7zidBEf7Pc86y46w.png"/></div></div></figure><p id="08e6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这张图显示了谷歌的CDN工作正常，尽管从请求者到服务器的地理距离很远。从这个测试中，我们可以看到性能正在利用<a class="ae jo" href="https://peering.google.com/#/infrastructure" rel="noopener ugc nofollow" target="_blank"> Google的Edge网络</a>的能力，其中资产被移动到更近的存在点，以供以后读取。</p><h1 id="0ed2" class="ka kb ht bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">获取更多详细信息</h1><p id="dcdc" class="pw-post-body-paragraph iq ir ht is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">对于大多数开发者来说，测试可以止步于上述数据。除了功能上的细微差别之外，大多数公司选择CDN是因为它的性能、成本和正常运行时间。但是，由于cdn的行为可能会有所不同，我们希望分解我们的请求延迟，并单独查看每个阶段。具体来说，我希望看到DNS时间、连接时间和等待时间。</p><p id="68c1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为什么这些事情很重要？</p><p id="1de2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> DNS时间</strong>:解析主机名所需的时间。DNS解析对于理解用户性能非常重要，因为最终用户在最后一英里依赖其ISP的DNS解析器。一些cdn的DNs设置比其他cdn更复杂，这意味着等待时间中获得的时间被较慢的DNS响应时间冲淡了。</p><p id="fcb6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">连接时间</strong> : Connect是建立TCP连接所需的时间。这取决于网络(端到端延迟)。对于SSL，还要加上建立加密隧道所需的时间。这里很重要的一点是，如果你的CDN容易受到高峰时段的限制，连接时间会显示出来。</p><p id="4864" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">等待时间</strong>:远程服务器处理请求所花费的时间。如果您的内容位于网络边缘(离您很近)，那么这个时间应该非常短，但是，如果内容需要从源服务器获取，这个时间可能会更长。由于其受欢迎程度，如果资产被缓存，CDN将提供良好的性能。</p><p id="762d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过一个方便的cURL命令，我们可以获得所有这些数据:</p><figure class="jq jr js jt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lg"><img src="../Images/36135c3301842bdc3b88adc18ccc587b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5780kA0YmT2Njbho_zF79g.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated"><em class="lh">(注意，这些时间是从连接开始起的绝对时间。为了计算出每个阶段持续的时间，你需要对它们进行适当的排序，然后减去它们！)</em></figcaption></figure><figure class="jq jr js jt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es li"><img src="../Images/7632df227d7aca7cfb5802e244abf1b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lP3vbmdkToVXzycRuS7CAw.png"/></div></div></figure><p id="f48b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里真正好的是，我们可以看到，首先，时间与非分离版本相当一致(这意味着我们的分离似乎没有给测试增加太多开销)，其次，总体而言，DNS、连接和预迁移阶段非常快，并且非常一致。这正是我们想要的内容分发网络。</p><h1 id="255b" class="ka kb ht bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">我们需要一个更大的测试</h1><p id="c2ae" class="pw-post-body-paragraph iq ir ht is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">现在，一些人指出，我的测试可能不会产生最准确的结果，因为只有一个起始点多次请求相同的资产。没问题，让我们建立一个更大的测试。</p><p id="e14c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为此，一个团队使用了<a class="ae jo" href="https://github.com/tsenart/vegeta" rel="noopener ugc nofollow" target="_blank">贝吉塔</a>，在<a class="ae jo" href="https://cloud.google.com/container-engine/" rel="noopener ugc nofollow" target="_blank">谷歌容器引擎</a>上运行，它允许每个pod每秒创建1000个请求(RPS)，然后迅速扩展到50，000个RPS。以下Stackdriver仪表盘显示了云CDN如何处理负载:</p><ul class=""><li id="a83e" class="lj lk ht is b it iu ix iy jb ll jf lm jj ln jn lo lp lq lr bi translated">缓存命中率图表紧跟请求图表。</li><li id="19c9" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn lo lp lq lr bi translated">延迟持续减少，并在达到其平均后端最小值后保持不变。</li></ul><figure class="jq jr js jt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lx"><img src="../Images/f005d21232de034105a335ad17e7e84b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SML9dj9dlpLnfUPnbO0e1A.png"/></div></div></figure><p id="3c54" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注:参见<a class="ae jo" href="https://github.com/GoogleCloudPlatform/serverless-pixel-tracking" rel="noopener ugc nofollow" target="_blank"> Github </a>上的类似用例，对<a class="ae jo" href="https://cloud.google.com/solutions/serverless-pixel-tracking" rel="noopener ugc nofollow" target="_blank">无服务器像素跟踪解决方案</a>进行负载测试。</p><h1 id="a3a2" class="ka kb ht bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">不，不够大。变大。</h1><p id="5c83" class="pw-post-body-paragraph iq ir ht is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">这很好，但你可能会再次争辩说，这还不够，要真正测试CDN的能力，每天需要有数十亿个请求通过它。遗憾的是，我没有一个这么受欢迎的网站，我也没有访问世界上所有其他网站的权限(还没有)，但谢天谢地，Cedexis的人有。</p><p id="6ad8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://www.cedexis.com/products/radar/" rel="noopener ugc nofollow" target="_blank"> Cedexis雷达社区</a>每天从世界各地的用户那里收集超过140亿次真实用户测量。这些数据被聚合并免费提供给雷达社区的所有成员，他们可以近乎实时地看到互联网的状态:全球cdn、ISP、云的可用性、延迟和吞吐量，以及他们自己的web属性。</p><p id="de53" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">他们的<a class="ae jo" href="https://www.cedexis.com/google-reports/" rel="noopener ugc nofollow" target="_blank">报告</a>让你很容易看到你最喜欢的CDN在延迟、正常运行时间和吞吐量方面的表现</p><figure class="jq jr js jt fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ly"><img src="../Images/567164d89a53f25e6305554cc54f7d7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u5xU6zf8Nq9j5j3WGl5qWw.png"/></div></div></figure><h1 id="448b" class="ka kb ht bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">好了，够大了</h1><p id="bd89" class="pw-post-body-paragraph iq ir ht is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">因此，我们提出了一些方法，你可以向前测试谷歌的CDN。您不仅可以自己用一个小测试来运行它，还可以扩展到一个50k的RPS系统，或者只看几个收集RUM统计数据的不同小组的性能数据。</p><p id="9232" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">找出你的需求，启动测试，看看谷歌的CDN是否能帮助你提高终端用户的性能！</p><h1 id="1d1e" class="ka kb ht bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">嘿！听着！</h1><p id="2128" class="pw-post-body-paragraph iq ir ht is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">有一些很棒的<a class="ae jo" rel="noopener" href="/@duhroach/tools-to-profile-networking-performance-3141870d5233">工具可以帮助你描述你的网络性能</a>。</p><p id="c713" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不要忘记检查您是否为您的GCP实例使用了<a class="ae jo" rel="noopener" href="/@duhroach/fixing-regional-networking-performance-ee069a7ae066">右区域。</a></p><p id="4331" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并确保针对您的网络性能使用正确的<a class="ae jo" rel="noopener" href="/@duhroach/core-count-and-the-egress-problem-607fb6b51fa9"> CPU数量</a>。</p></div></div>    
</body>
</html>