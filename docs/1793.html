<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/google-cloud/dont-fear-the-authentication-google-drive-edition-3759d0b313e4?source=collection_archive---------0-----------------------#2021-02-09">https://medium.com/google-cloud/dont-fear-the-authentication-google-drive-edition-3759d0b313e4?source=collection_archive---------0-----------------------#2021-02-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/9cb81989140bc188145b111a373b1325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lSxfDRYWq0Sjz3qEh2Gbgg.png"/></div></div></figure><p id="e062" class="pw-post-body-paragraph hr hs ht hu b hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip hb bi translated">有时候，当我在GCP上构建应用程序时，我不想使用更传统的数据存储，如云SQL或Bigtable。例如，现在我正在开发一个应用程序，它允许非技术人员轻松地将图标添加到构建系统中。我不打算从头开始编写前端，教他们源代码控制虽然很有价值，但并不是我现在想做的事情。所以一个简单的解决办法就是使用Google Drive。也许你从来没有想到它是一个数据存储…但是让我们在这里讨论一下。超级简单的界面，内置了基本的源代码控制，它有一个API，所以我可以自动将图标从驱动器拖到适当的源代码控制和我们的构建系统中，供每个人使用图标！</p><p id="e06b" class="pw-post-body-paragraph hr hs ht hu b hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip hb bi translated">只有一个问题…我有一件事要坦白。我讨厌OAuth，从表面上看，你似乎需要使用OAuth才能使用Google Drive的API。好吧好吧，恨这个词可能有点过了。我不讨厌它做的事。我认识到这非常重要。我只是不喜欢这样，因为这不是我每天都用的东西，我从来不记得我需要做什么。我需要<strong class="hu iq"> <em class="ir">哪个</em> </strong>令牌从<strong class="hu iq"><em class="ir"/></strong>现在在哪里？我要把它放在标题里吗？标题叫什么？每次我不得不做的时候，我总是在寻找如何正确地实现OAuth。</p><p id="6d56" class="pw-post-body-paragraph hr hs ht hu b hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip hb bi translated">现在，我每天的最佳选择是什么？在GCP与服务帐户和IAM合作进行授权。所以事实证明…如果你想将Google Drive功能集成到已经使用GCP服务的应用程序中，你完全可以使用IAM服务帐户来实现！</p><p id="9cd4" class="pw-post-body-paragraph hr hs ht hu b hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip hb bi translated">这个魔术的关键是理解IAM服务帐户也是用户。用户有电子邮件地址。如果您在控制台的“访问”页面上查看列表中的服务帐户:</p><figure class="it iu iv iw fd hk er es paragraph-image"><div class="er es is"><img src="../Images/69fe6ffa8fb11dd457c309942c7af6f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/0*BWYlaJD978tryWM5"/></div></figure><p id="e045" class="pw-post-body-paragraph hr hs ht hu b hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip hb bi translated">那个电子邮件地址很神奇。正如您可以与其他人共享驱动器文件夹一样，您也可以与IAM服务帐户共享驱动器文件夹。或者一张纸，或者一份文件。无论您想将什么集成到您的GCP应用程序中。</p><p id="a290" class="pw-post-body-paragraph hr hs ht hu b hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip hb bi translated">所以在我的例子中，我需要共享我们的营销人员放置图标的驱动器文件夹。让我们回顾一下我是如何让它工作的。我在控制台<a class="ae ix" href="https://console.cloud.google.com/identity/serviceaccounts" rel="noopener ugc nofollow" target="_blank">这里</a>创建了一个服务账号。单击顶部的“创建服务帐户”按钮。给它一个名称，授予它帐户访问您使用的GCP服务的应用程序所需角色的权限。驱动器本身实际上并不需要特定的权限角色。例如，如果应用程序还需要能够将条目写入云SQL数据库以及访问驱动器内容，那么您需要赋予它云SQL客户端角色。仅添加您需要的权限。请不要授予一揽子“所有者”权限。</p><p id="651d" class="pw-post-body-paragraph hr hs ht hu b hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip hb bi translated">完成后，点击列表中您的服务帐户的详细信息，然后点击“添加密钥”</p><figure class="it iu iv iw fd hk er es paragraph-image"><div class="er es iy"><img src="../Images/8b14e915090b843e89dde49d292598a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/0*WON4pX0pTd4d61Df"/></div></figure><p id="c3ae" class="pw-post-body-paragraph hr hs ht hu b hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip hb bi translated">选择JSON类型，它将为该服务帐户下载不记名令牌。请小心点。这是一个不记名令牌，这意味着任何拥有它的人现在都有权根据您给予服务帐户的权限在您的项目中进行操作。例如，写入或读取数据库(如果您为其提供了云SQL客户端角色)。这就是为什么您只想给它您想要的特定角色，而不是所有者级别的权限。</p><p id="8991" class="pw-post-body-paragraph hr hs ht hu b hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip hb bi translated">Python中的代码如下所示:</p><pre class="it iu iv iw fd iz ja jb jc aw jd bi"><span id="3ee2" class="je jf ht ja b fi jg jh l ji jj">from googleapiclient.discovery import build<br/>from google.oauth2 import service_account<br/>from googleapiclient.errors import HttpError as HTTPError</span><span id="ce5f" class="je jf ht ja b fi jk jh l ji jj">SCOPES = [‘https://www.googleapis.com/auth/drive']</span><span id="a483" class="je jf ht ja b fi jk jh l ji jj">sa_creds = service_account.Credentials.from_service_account_file(‘drive_icons_sa.json’)<br/>scoped_creds = sa_creds.with_scopes(SCOPES)<br/>drive_service = build(‘drive’, ‘v3’, credentials=scoped_creds)</span></pre><p id="adc0" class="pw-post-body-paragraph hr hs ht hu b hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip hb bi translated">如果您不熟悉，发现API是本地语言REST APIs的包装器，比如Python。根据您想做的事情，找到您可以使用API做的所有事情有点难。这里的<a class="ae ix" href="https://developers.google.com/drive/api/v3/about-files" rel="noopener ugc nofollow" target="_blank">是一个很好的起点</a>，它将介绍驱动API的基本知识，比如创建文件夹和文件、下载、搜索等等。例如，抓取驱动器文件夹中的所有文件夹将是:</p><pre class="it iu iv iw fd iz ja jb jc aw jd bi"><span id="7e44" class="je jf ht ja b fi jg jh l ji jj">children = drive_service.files().list(q=f”mimeType = ‘application/vnd.google-apps.folder’ and ‘{marketing_icon_folder_id}’ in parents”, fields=’files(name, id)’).execute()</span></pre><p id="8b20" class="pw-post-body-paragraph hr hs ht hu b hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip hb bi translated">这将在我们的<code class="du jl jm jn ja b">marketing_icon_folder_id</code>中获取前100个文件夹(pageSize默认为100，您可以通过向list调用添加另一个参数<code class="du jl jm jn ja b">pageSize=n</code>来更改它)，给我们这些文件夹的名称和驱动器id。</p><p id="34e3" class="pw-post-body-paragraph hr hs ht hu b hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip hb bi translated">原来如此。当您希望使用Google Drive作为数据存储时，这是一个很好的快速方法，可以避免记住如何设置OAuth，为您的GCP集成应用程序提供简单的UI、基本的版本控制和全功能API。感谢阅读，希望有帮助！如果你在寻找创造的想法，我们有一些代码实验室，可能会激发一些有趣的想法<a class="ae ix" href="https://codelabs.developers.google.com/?cat=g-suite" rel="noopener ugc nofollow" target="_blank">在这里</a>。如果你有问题，或者你想告诉我你和Drive和GCP一起做了什么很酷的事情，请在<a class="ae ix" href="https://twitter.com/GabeWeiss_" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上联系我，我的DMs是开放的。</p></div></div>    
</body>
</html>