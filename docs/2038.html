<html>
<head>
<title>Google Cloud DevOps Series: Agility with Cost Optimization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google Cloud DevOps系列:成本优化的敏捷性</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-devops-agility-with-cost-optimization-930ad77ccc63?source=collection_archive---------0-----------------------#2021-12-21">https://medium.com/google-cloud/google-devops-agility-with-cost-optimization-930ad77ccc63?source=collection_archive---------0-----------------------#2021-12-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="f18d" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">Google Cloud DevOps系列:第6部分</h2></div><p id="35ab" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">欢迎来到Google Cloud DevOps系列的第6部分..你可以从<a class="ae jt" rel="noopener" href="/google-cloud/google-cloud-devops-part-1-introduction-to-google-native-devops-process-bfb55be9e3f3">这里</a>开始阅读该系列的其他部分。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es ju"><img src="../Images/c0556174e3be155ade3c7fa44249cd9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4S7GJuLxlEPNjI9V3bLxow.png"/></div></div></figure><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es kg"><img src="../Images/7b21b2ad047563fbcf6544349236ef4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2pEGkxgJvZgMi4pNMUOBBg.png"/></div></div></figure><p id="7d53" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">GKE环境下的成本优化</strong></p><p id="07d4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在Google Cloud，我们始终认为成本优化应该是每个组织的IT或业务战略的关键支柱之一，我们确保降低成本不会以牺牲用户体验或客户业务风险为代价。</p><p id="b51e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于在云环境中采用创新技术(如Google Kubernetes引擎)进行应用程序开发和托管的客户来说，实施成本优化的最佳实践以防止他们的努力影响其应用程序的性能、稳定性和服务业务的能力也是非常重要和具有挑战性的。</p><p id="efa9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">GKE提供了几个先进的成本优化特性和内置功能。对于需要平衡应用程序性能需求和优化成本的客户来说，这是一个绝佳的选择。</p><p id="d7f8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">GKE环境中成本优化的最佳实践</strong></p><p id="fb35" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">成本优化是<strong class="iz hj"> <em class="kh">成本控制</em> </strong>和<strong class="iz hj"> <em class="kh">成本可见性</em> </strong>的结合，在谷歌云平台中，我们有众多服务来满足这两种需求，以实现预期的结果。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es ki"><img src="../Images/591e894e7abf42f723f121937ef3c022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wMS2jhOf1pQq3vynhoFCzw.png"/></div></div></figure><p id="0bb3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">基于对应用的硬件需求的正确分析，可以为集群节点选择正确的机器类型，并且相应地可以设计应用分组和名称空间。</p><p id="31f0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意，在为任何应用选择正确的节点类型时，使用<strong class="iz hj">可抢占节点</strong>可以进一步降低成本，但这些节点仅适用于对可抢占虚拟机的短暂、无保障特性不太敏感的容错作业。</p><p id="a0cc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> <em class="kh">注:</em> </strong> <em class="kh"> GKE默认使用E2机型。有关可用的不同机器类型的详细信息，请参考此</em> <a class="ae jt" href="https://cloud.google.com/compute/docs/machine-types" rel="noopener ugc nofollow" target="_blank"> <em class="kh">链接</em> </a></p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es kj"><img src="../Images/e2e86f318fc491cac8d7616af2f24efa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J387ZJL8Cxbi0QesytyiSA.png"/></div></div></figure><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es kk"><img src="../Images/56c7f03332452a3b10683f4a09154df7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cBkGx-0fEHt24t6dC7F3Fw.png"/></div></div></figure><p id="03c1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先从集群设置中启用垂直窗格自动缩放，如下所示:</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es kl"><img src="../Images/08db4ce7856191dea5d340e8da1e69d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9BZwt2-GHCai45XCZ63xLQ.png"/></div></div></figure><p id="aa38" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，我们需要为所需的部署创建一个垂直窗格自动缩放对象。通过该对象，当创建单元时，垂直单元自动缩放器分析容器的CPU和内存需求，并在其<em class="kh">状态</em>字段中记录这些建议。根据分析，VPA自动调整集装箱所需的CPU或内存。请执行以下步骤，观看VPA的实际操作:</p><ol class=""><li id="b81b" class="km kn hi iz b ja jb jd je jg ko jk kp jo kq js kr ks kt ku bi translated">将以下<code class="du kv kw kx ky b">Deployment</code>清单另存为名为<code class="du kv kw kx ky b">vpa-demo-deployment.yaml</code>的文件:</li></ol><pre class="jv jw jx jy fd kz ky la lb aw lc bi"><span id="4df2" class="ld le hi ky b fi lf lg l lh li">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: vpa-demo-deployment<br/>spec:<br/>  replicas: 2<br/>  selector:<br/>    matchLabels:<br/>      app: vpa-demo-deployment<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: vpa-demo-deployment<br/>    spec:<br/>      containers:<br/>      - name: vpa-demo-container<br/>        image: k8s.gcr.io/ubuntu-slim:0.1<br/>        resources:<br/>          requests:<br/>            cpu: 100m<br/>            memory: 50Mi<br/>        command: ["/bin/sh"]<br/>        args: ["-c", "while true; do timeout 0.5s yes &gt;/dev/null; sleep 0.5s; done"]</span></pre><p id="3062" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.将部署创建为:</p><pre class="jv jw jx jy fd kz ky la lb aw lc bi"><span id="377e" class="ld le hi ky b fi lf lg l lh li">kubectl create -f vpa-demo-deployment.yaml</span></pre><p id="d23a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您应该会看到如下输出:</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lj"><img src="../Images/dde84e5cae7ee6bbc15d324698ea6343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QOeT0kTgLN8Rykop7kdEyg.png"/></div></div></figure><p id="4619" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.检查跑步记录:</p><pre class="jv jw jx jy fd kz ky la lb aw lc bi"><span id="6a51" class="ld le hi ky b fi lf lg l lh li">kubectl get pods</span></pre><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lj"><img src="../Images/797331ed08017d25f0c68f5320c4427e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Smn78qKaTHWP4IMlwxTyTg.png"/></div></div></figure><p id="1676" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">4.现在，创建一个VPA对象来分析作为vpa-demo-deployment的一部分运行的pod的CPU和内存需求。将下面的<code class="du kv kw kx ky b">VerticalPodAutoscaler</code>保存为一个名为<code class="du kv kw kx ky b">vpa-object.yaml</code>的文件:</p><pre class="jv jw jx jy fd kz ky la lb aw lc bi"><span id="eba3" class="ld le hi ky b fi lf lg l lh li">apiVersion: autoscaling.k8s.io/v1<br/>kind: VerticalPodAutoscaler<br/>metadata:<br/>  name: vpa-object<br/>spec:<br/>  targetRef:<br/>    apiVersion: "apps/v1"<br/>    kind:       Deployment<br/>    name:       vpa-demo-deployment<br/>  updatePolicy:<br/>    updateMode: "Auto"</span></pre><p id="d09d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后创建VPA对象，如下所示:</p><pre class="jv jw jx jy fd kz ky la lb aw lc bi"><span id="e0e7" class="ld le hi ky b fi lf lg l lh li">kubectl create -f vpa-object.yaml</span></pre><p id="2baa" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您应该会收到类似如下的输出:</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lj"><img src="../Images/22e5063f7df95b5e3cb96ed7d5d71f62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FsW0TpJ_EDhW3ArMld2oWA.png"/></div></div></figure><p id="f1f9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">5.检查从vpa-demo-deployment部署的一个Pod的资源要求，如下所示:</p><pre class="jv jw jx jy fd kz ky la lb aw lc bi"><span id="e9b5" class="ld le hi ky b fi lf lg l lh li">kubectl get pod vpa-demo-deployment-d67d96884-tgcxs --output yaml</span></pre><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lk"><img src="../Images/7098d661db1604b78ac8b4e33b81fb20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ei5okC2uks5ZFh_COu4pGg.png"/></div></div></figure><p id="1da9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在输出中，您可以看到垂直窗格自动缩放器增加了内存和CPU请求。您还可以看到记录更新的注释:</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es ll"><img src="../Images/93f7f30a29c5dae437420a59e9d759a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QwuPoSMj-iUaOPHKtet7Pg.png"/></div></div></figure><p id="0605" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">6.检查VPA对象状态以查看更新的建议，如下所示:</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es kk"><img src="../Images/02e388b6f61ad4bf6aaf2af3a551ca0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pdCP7EpsJPcoOjK7hncW4g.png"/></div></div></figure><p id="e277" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du kv kw kx ky b">target</code>建议说，如果容器请求590毫CPU和2097152千字节的内存，它将最佳地运行，这不同于我们作为部署(vpa-demo-deployment)的一部分提供的内存。</p><p id="35d7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">注意:</strong>垂直Pod自动缩放器使用<code class="du kv kw kx ky b">lowerBound</code>和<code class="du kv kw kx ky b">upperBound</code>建议来决定是否删除一个Pod并用新的Pod替换它。如果某个单元的请求小于下限或大于上限，垂直单元自动缩放器会删除该单元，并用符合目标建议的单元替换它</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lm"><img src="../Images/a8e5ceb6a5e61fde5f604e8e1f4283d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jYFYcCBbTYTlivx9YVXfmA.png"/></div></div></figure><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es ln"><img src="../Images/86dc11377cd2aa343a353882fb6d5cb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pibgo9gwxmTRUG0Zkr6GmQ.png"/></div></div></figure><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lm"><img src="../Images/d18ccabc6487c660cf3bff0ee19ad815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iTcO031VRmtJciP2XWTP_A.png"/></div></div></figure><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lo"><img src="../Images/bf32a8eaa3ca96a55c0e06e8ff8fbabb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t8hbGSoAwLUxPNjPJTYUcg.png"/></div></div></figure><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lm"><img src="../Images/bf793878ee91309440c8fb85fef7cc4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vSbr2wd9zl_anWlPXOcfZA.png"/></div></div></figure><p id="dbda" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">简而言之，GKE的成本优化可以归纳为以下五大类:</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lp"><img src="../Images/5737583d6d067534e4fb96f7d7665f8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kaIzc-RlYSPW83KGF4_Snw.png"/></div></div></figure><p id="ca07" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">除了上面提到的成本优化手段，Google Cloud还提供了一些额外的服务:</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lq"><img src="../Images/1378a5d66e2a7c7e5b22b10346083e92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i74tU5OzshnYrXjtYaVhhA.png"/></div></div></figure><p id="c4eb" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">注:</strong>此免费等级仅适用于每小时每组0.10美元的集装箱管理费(以1秒为增量收取)。GKE自由层提供每个计费账户每月74.40美元的信用，适用于区域和自动驾驶集群。有关定价的更多详细信息，请参见此处的链接<a class="ae jt" href="https://cloud.google.com/kubernetes-engine/pricing" rel="noopener ugc nofollow" target="_blank">中的部分- <em class="kh">“集群管理费和免费层”</em></a></p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lm"><img src="../Images/49aab3c23f027243e4120995416cbcfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jxHT036RcEzfRMr7yvGRHw.png"/></div></div></figure><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lq"><img src="../Images/0e4e37a497468aaa9750097c778d1985.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GRNQ4JiKK3KFubtOxjPXVQ.png"/></div></div></figure><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lr"><img src="../Images/09d2af3a7f97d71737dbfca36c5fb884.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GiMop8B7veXt8z9snkhUgQ.png"/></div></div></figure></div><div class="ab cl ls lt gp lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hb hc hd he hf"><p id="971c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个博客系列中，我们讨论了古汉和拉姆之间的对话如何为Samajik提供了一个清晰的路线图，使其能够以一种简单的方式采用带有Google Kubernetes引擎的DevOps流程，从而实现他们所有的战略目标。</p><p id="704f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">除了我们在本系列中讨论的内容，您还可以点击此处的链接<a class="ae jt" href="https://cloud.google.com/blog/products/containers-kubernetes/your-guide-kubernetes-best-practices" rel="noopener ugc nofollow" target="_blank"/>了解更多关于使用Kubernetes和谷歌Kubernetes引擎(GKE)的各种技巧和最佳实践。</p><p id="2ade" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">供稿人:<a class="lz ma ge" href="https://medium.com/u/c79cc28e2999?source=post_page-----930ad77ccc63--------------------------------" rel="noopener" target="_blank">普什卡·科塔瓦德</a> <a class="lz ma ge" href="https://medium.com/u/41b475b881ff?source=post_page-----930ad77ccc63--------------------------------" rel="noopener" target="_blank">施吉莫尔·阿·K</a><a class="lz ma ge" href="https://medium.com/u/2d47f7f3f8e2?source=post_page-----930ad77ccc63--------------------------------" rel="noopener" target="_blank">安其特·尼尚特</a> <a class="lz ma ge" href="https://medium.com/u/71d9487165c6?source=post_page-----930ad77ccc63--------------------------------" rel="noopener" target="_blank">丹杜斯</a></p><p id="8d19" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请关注<a class="ae jt" href="https://medium.com/google-cloud" rel="noopener"> Google Cloud Community </a>了解更多此类见解深刻的博客。</p></div></div>    
</body>
</html>