<html>
<head>
<title>Understanding Firebase Cloud Functions and Triggers 🔥☁️ ⚡</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解Firebase云功能和触发器🔥☁️ ⚡</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/understanding-firebase-cloud-functions-and-triggers-%EF%B8%8F-85a8fe89be3c?source=collection_archive---------2-----------------------#2019-07-29">https://medium.com/google-cloud/understanding-firebase-cloud-functions-and-triggers-%EF%B8%8F-85a8fe89be3c?source=collection_archive---------2-----------------------#2019-07-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/532a8094c7a0d239ba7e1011ab9137d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0a8UZxHW5C7FVx7aQRFOlg.jpeg"/></div></div></figure><p id="4177" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于Firebase开发人员来说，Firebase的云功能提供了一种方式来扩展Firebase的行为，并通过添加服务器端代码来集成Firebase的功能。这也可以称为<a class="ae jo" href="https://en.wikipedia.org/wiki/Mobile_backend_as_a_service" rel="noopener ugc nofollow" target="_blank">后端即服务</a></p><p id="61a6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这扩展了Firebase的用途，使其不仅仅是作为应用程序的数据存储，而是能够执行需要服务器端环境的逻辑。本文提供了一些代码片段，可用于在事件发生时执行功能。</p><p id="95b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，我们将讨论一个最近引入的特性，<a class="ae jo" href="https://firebase.googleblog.com/2019/04/schedule-cloud-functions-firebase-cron.html" rel="noopener ugc nofollow" target="_blank">为Firebase (cron) </a>调度云功能。这允许开发人员安排一个函数定期执行，类似于cron作业。</p><h1 id="8e7f" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Firebase云函数</h1><figure class="kn ko kp kq fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="dcd2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Firebase的Firebase云功能允许您自动运行后端代码，以响应由Firebase特性和HTTPS请求触发的事件。你的代码存储在谷歌的云中，在一个托管的环境中运行。不需要管理和扩展您自己的服务器。</p><p id="dc4c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">谷歌云功能是谷歌的无服务器计算解决方案，用于创建事件驱动的应用程序。它是Google云平台团队和Firebase团队的联合产品。</p><p id="46a6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你是一个开发移动应用或移动网络应用的开发者，你应该为Firebase使用云功能。Firebase为移动开发者提供了一整套全面管理的以移动为中心的服务，包括分析、认证和实时数据库。云功能通过添加服务器端代码，提供了一种扩展和连接Firebase特性行为的方式，从而完善了产品。对于需要更全功能后端的开发者来说，Cloud Functions提供了一个通往Google云平台强大功能的入口。</p><p id="2429" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">函数可以用JavaScript或TypeScript编写。</strong></p><h1 id="cd48" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Firebase云函数触发器和代码片段</h1><p id="45e4" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">要开始使用Firebase上的云功能，您可以按照这里的说明<a class="ae jo" href="https://firebase.google.com/docs/functions/get-started" rel="noopener ugc nofollow" target="_blank">进行设置。如果你也想在本地测试云函数，使用这里的指南</a><a class="ae jo" href="https://firebase.google.com/docs/functions/local-emulator" rel="noopener ugc nofollow" target="_blank">安装模拟器</a></p><h1 id="0803" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">云Firestore触发器</h1><p id="bb3d" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">Firebase SDK的云函数导出一个<em class="ky"> functions.firestore </em>对象，允许您创建与特定云firestore事件相关的处理程序，例如:</p><ul class=""><li id="4c4d" class="kz la hi is b it iu ix iy jb lb jf lc jj ld jn le lf lg lh bi translated"><strong class="is hj"> onCreate </strong>:第一次写入文档时触发。</li><li id="aa3f" class="kz la hi is b it li ix lj jb lk jf ll jj lm jn le lf lg lh bi translated"><strong class="is hj"> onUpdate </strong>:当一张单据已经存在，并且有值发生变化时触发。</li><li id="753e" class="kz la hi is b it li ix lj jb lk jf ll jj lm jn le lf lg lh bi translated"><strong class="is hj"> onDelete </strong>:删除有数据的单据时触发。</li><li id="463d" class="kz la hi is b it li ix lj jb lk jf ll jj lm jn le lf lg lh bi translated"><strong class="is hj"> onWrite </strong>:触发onCreate、onUpdate或onDelete时触发。</li></ul><pre class="kn ko kp kq fd ln lo lp lq aw lr bi"><span id="0ba6" class="ls jq hi lo b fi lt lu l lv lw">// Listens for any document created in the users collection<br/>exports.createUser = functions.firestore<br/>    .document('users/{userId}')<br/>    .onCreate((snap, context) =&gt; {<br/>      // Get an object representing the document<br/>      const newValue = snap.data();<br/>      const name = newValue.name;<br/>      // perform desired operations ...<br/>    });</span></pre><p id="bc83" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击查看更多代码片段<a class="ae jo" href="https://firebase.google.com/docs/functions/firestore-events" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="8b74" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">实时数据库触发器</h1><p id="391f" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">函数允许您在两个特定级别上处理数据库事件；您可以专门监听创建、更新或删除事件，也可以监听对路径的任何类型的更改。云函数支持实时数据库的这些事件处理程序:</p><ul class=""><li id="6fa1" class="kz la hi is b it iu ix iy jb lb jf lc jj ld jn le lf lg lh bi translated"><strong class="is hj"> onWrite() </strong>:在实时数据库中创建、更新或删除数据时触发。</li><li id="d757" class="kz la hi is b it li ix lj jb lk jf ll jj lm jn le lf lg lh bi translated"><strong class="is hj"> onCreate() </strong>:在实时数据库中创建新数据时触发。</li><li id="2e82" class="kz la hi is b it li ix lj jb lk jf ll jj lm jn le lf lg lh bi translated"><strong class="is hj"> onUpdate() </strong>:实时数据库数据更新时触发。</li><li id="541a" class="kz la hi is b it li ix lj jb lk jf ll jj lm jn le lf lg lh bi translated"><strong class="is hj"> onDelete() </strong>:从实时数据库中删除数据时触发。</li></ul><pre class="kn ko kp kq fd ln lo lp lq aw lr bi"><span id="14f5" class="ls jq hi lo b fi lt lu l lv lw">// Listens for new messages added to /messages/:pushId/original and creates an<br/>// uppercase version of the message to /messages/:pushId/uppercase<br/>exports.makeUppercase = functions.database.ref('/messages/{pushId}/original')<br/>    .onCreate((snapshot, context) =&gt; {<br/>      // Grab the current value of what was written to the Realtime Database.<br/>      const original = snapshot.val();<br/>      console.log('Uppercasing', context.params.pushId, original);<br/>      const uppercase = original.toUpperCase();<br/>      // You must return a Promise when performing asynchronous tasks inside a Functions such as<br/>      // writing to the Firebase Realtime Database.<br/>      // Setting an "uppercase" sibling in the Realtime Database returns a Promise.<br/>      return snapshot.ref.parent.child('uppercase').set(uppercase);<br/>    });</span></pre><p id="4866" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击查看更多代码片段<a class="ae jo" href="https://firebase.google.com/docs/functions/database-events" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="2ea1" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Firebase身份验证触发器</h1><p id="4d20" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">您可以触发云功能来响应Firebase用户帐户的创建和删除。</p><pre class="kn ko kp kq fd ln lo lp lq aw lr bi"><span id="4954" class="ls jq hi lo b fi lt lu l lv lw">// Trigger a function on user creation<br/>exports.sendWelcomeEmail = functions.auth.user().onCreate((user) =&gt; {<br/>  // Send the email...<br/>});</span></pre><p id="2849" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击查看更多代码片段</p><h1 id="5772" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">火基触发器的谷歌分析</h1><p id="f69f" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">Google Analytics for Firebase提供事件报告，帮助您了解用户如何与您的应用程序交互。使用云函数，您可以访问您记录的转换事件，并基于这些事件触发函数。</p><pre class="kn ko kp kq fd ln lo lp lq aw lr bi"><span id="f2fe" class="ls jq hi lo b fi lt lu l lv lw">// triggered whenever user activity generates a conversion event.<br/>exports.sendCouponOnPurchase = functions.analytics.event('in_app_purchase').onLog((event) =&gt; {<br/>  // ...<br/>});</span></pre><p id="0bdd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击查看更多代码片段<a class="ae jo" href="https://firebase.google.com/docs/functions/analytics-events" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="9167" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Firebase Crashlytics触发器</h1><p id="4f89" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">您可以触发一个函数来响应Crashlytics问题事件，包括新问题、回归问题和速度警报。</p><p id="3c3a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Crashlytics触发器处理如下事件:</p><ul class=""><li id="da59" class="kz la hi is b it iu ix iy jb lb jf lc jj ld jn le lf lg lh bi translated"><strong class="is hj"> onNew </strong>:当你的app第一次遇到问题。</li><li id="8c35" class="kz la hi is b it li ix lj jb lk jf ll jj lm jn le lf lg lh bi translated"><strong class="is hj"> onRegressed() </strong>:当问题在Crashlytics中关闭后再次出现时</li><li id="d358" class="kz la hi is b it li ix lj jb lk jf ll jj lm jn le lf lg lh bi translated"><strong class="is hj"> onVelocityAlert() </strong>:当给定构建中有大量会话崩溃时</li></ul><pre class="kn ko kp kq fd ln lo lp lq aw lr bi"><span id="3d22" class="ls jq hi lo b fi lt lu l lv lw">exports.sendOnNewIssue = functions.crashlytics.issue().onNew(async (issue) =&gt; {<br/>  // do something...<br/>});</span></pre><p id="9c44" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击查看更多代码片段<a class="ae jo" href="https://firebase.google.com/docs/functions/crashlytics-events" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="08ee" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">云存储触发器</h1><p id="0191" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">您可以触发一个功能来响应云存储中文件和文件夹的上传、更新或删除。</p><ul class=""><li id="a7e6" class="kz la hi is b it iu ix iy jb lb jf lc jj ld jn le lf lg lh bi translated"><strong class="is hj">functions . storage . object()</strong>:监听默认存储桶上的对象变化。</li><li id="a638" class="kz la hi is b it li ix lj jb lk jf ll jj lm jn le lf lg lh bi translated"><strong class="is hj">functions . storage . bucket(' bucket name ')。object() </strong>:监听特定存储桶上的对象变化。</li></ul><pre class="kn ko kp kq fd ln lo lp lq aw lr bi"><span id="b221" class="ls jq hi lo b fi lt lu l lv lw">exports.generateThumbnail = functions.storage.object().onFinalize(async (object) =&gt; {<br/>  // generateThumbnail code...<br/>});</span></pre><p id="8f99" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击查看更多代码片段<a class="ae jo" href="https://firebase.google.com/docs/functions/gcp-storage-events" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="0376" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">远程配置触发器</h1><p id="9b6e" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">您可以触发一个函数来响应Firebase远程配置事件，包括发布新的配置版本或回滚到旧版本。</p><p id="8abf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击查看更多代码片段<a class="ae jo" href="https://firebase.google.com/docs/functions/rc-events" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="d9cd" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">云发布/订阅触发器</h1><p id="cb28" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated"><a class="ae jo" href="https://cloud.google.com/pubsub/docs/" rel="noopener ugc nofollow" target="_blank"> Google Cloud Pub/Sub </a>是一个全球分布式消息总线，可以根据您的需要自动扩展。您可以使用<strong class="is hj"> functions.pubsub </strong>创建一个处理Google Cloud发布/订阅事件的函数。</p><pre class="kn ko kp kq fd ln lo lp lq aw lr bi"><span id="8276" class="ls jq hi lo b fi lt lu l lv lw">// trigger a pub/sub function<br/>exports.helloPubSub = functions.pubsub.topic('topic-name').onPublish((message) =&gt; {<br/>  // ...<br/>});</span></pre><p id="cda8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击查看更多代码片段<a class="ae jo" href="https://firebase.google.com/docs/functions/pubsub-events" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="557f" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">调度Firebase云功能</h1><p id="d212" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">Firebase还支持一种新的Pub/Sub函数，它构建在Cloud Scheduler之上，可以自动配置Cloud Scheduler，以及一个Pub/Sub主题，可以调用您使用Firebase SDK的云函数定义的函数。</p><pre class="kn ko kp kq fd ln lo lp lq aw lr bi"><span id="6cc1" class="ls jq hi lo b fi lt lu l lv lw">export scheduledFunctionCrontab =<br/>functions.pubsub.schedule('every 3 hours').onRun((context) =&gt; {<br/>    console.log('This will be run every 3 hours daily')<br/>})</span></pre><p id="e0a1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">除了云功能的正常成本，该功能的成本与您手动设置底层基础架构的成本相同——有关更多信息，请查看<a class="ae jo" href="https://cloud.google.com/scheduler/pricing" rel="noopener ugc nofollow" target="_blank">云调度器</a>和<a class="ae jo" href="https://cloud.google.com/pubsub/pricing" rel="noopener ugc nofollow" target="_blank">云发布订阅</a>的完整定价信息。</p><h1 id="a3ba" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">云功能成本</h1><p id="6616" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">云函数的定价取决于你的函数运行多长时间、被调用多少次以及你为该函数提供了多少资源。如果您的函数发出出站网络请求，还会产生额外的数据传输费用。</p><p id="5aa7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Cloud Functions包含一个永久免费层，允许您免费试用该平台。请注意，即使是免费使用，谷歌云也需要一个有效的付费账户。您可以在此阅读更多关于定价的信息<a class="ae jo" href="https://cloud.google.com/functions/pricing-summary/" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="7bce" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">附加资源</h1><ul class=""><li id="6f0e" class="kz la hi is b it kt ix ku jb lx jf ly jj lz jn le lf lg lh bi translated"><a class="ae jo" href="https://firebase.google.com/docs/functions" rel="noopener ugc nofollow" target="_blank">火情云函数</a></li><li id="112f" class="kz la hi is b it li ix lj jb lk jf ll jj lm jn le lf lg lh bi translated"><a class="ae jo" href="https://cloud.google.com/functions" rel="noopener ugc nofollow" target="_blank">谷歌云功能</a></li><li id="e28e" class="kz la hi is b it li ix lj jb lk jf ll jj lm jn le lf lg lh bi translated"><a class="ae jo" href="https://cloud.google.com/scheduler" rel="noopener ugc nofollow" target="_blank">谷歌云调度器</a></li><li id="b876" class="kz la hi is b it li ix lj jb lk jf ll jj lm jn le lf lg lh bi translated"><a class="ae jo" href="https://firebase.google.com/docs/functions/schedule-functions" rel="noopener ugc nofollow" target="_blank">预定火情云功能</a></li><li id="7529" class="kz la hi is b it li ix lj jb lk jf ll jj lm jn le lf lg lh bi translated"><a class="ae jo" href="https://github.com/firebase/functions-samples" rel="noopener ugc nofollow" target="_blank">示例应用的集合，展示了使用Firebase云功能的流行用例</a></li></ul><blockquote class="ma mb mc"><p id="ed3c" class="iq ir ky is b it iu iv iw ix iy iz ja md jc jd je me jg jh ji mf jk jl jm jn hb bi translated"><em class="hi">感谢通读！如果我错过了任何步骤，如果有些事情不太适合你，或者如果这个指南有帮助，请告诉我。</em></p></blockquote><p id="31e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你也可以在这里阅读我如何使用谷歌云功能和云调度程序来构建一个松弛提醒应用程序<a class="ae jo" href="https://fullstackgcp.com/building-a-slack-reminder-app-with-google-cloud-functions-high-voltage-and-google-cloud-scheduler-alarm-clock-cjxycufnb001g93s1q6izcvna" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>