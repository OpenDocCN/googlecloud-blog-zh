<html>
<head>
<title>IoT Tank Monitoring Solution Part 1 — Build a Rest API using Cloud Run and Django Rest Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">物联网储罐监控解决方案第1部分—使用Cloud Run和Django Rest框架构建Rest API</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/iot-tank-monitoring-solution-part-1-build-a-rest-api-using-cloud-run-and-django-rest-framework-a8b9770eaa87?source=collection_archive---------0-----------------------#2020-01-06">https://medium.com/google-cloud/iot-tank-monitoring-solution-part-1-build-a-rest-api-using-cloud-run-and-django-rest-framework-a8b9770eaa87?source=collection_archive---------0-----------------------#2020-01-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="54c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">使用云计算跟踪储罐液位的端到端解决方案，无需过多担心基础设施管理。</strong></p><p id="db61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个关于如何在谷歌云上创建一个农场储罐监控解决方案的3部分教程。</p><ul class=""><li id="389f" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">第1部分—使用Cloud Run和Django Rest框架构建Rest API</li><li id="1bc3" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">第二部分— <a class="ae jr" rel="noopener" href="/@alvaroviebrantz/iot-tank-monitoring-solution-part-2-micropython-device-with-esp8266-to-collect-tank-level-data-d74a1b947f60">收集坦克数据的MicroPython装置</a></li><li id="1b10" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">第3部分— <a class="ae jr" rel="noopener" href="/@alvaroviebrantz/iot-tank-monitoring-solution-part-3-visualizing-data-using-cloudsql-federated-queries-bigquery-1a92d1a565a3">使用BigQuery联邦查询和Data Studio可视化数据</a></li></ul><p id="e9d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本教程中，我们将使用Django Rest框架作为项目的基础。Django非常容易上手，可以很好地使用SQL数据库来保存我们的模型数据，还提供了一个很好的管理界面来管理这些模型，而不必花太多时间来构建这些模型。Django Rest Framework是Django之上的一个层，使得从我们的模型构建REST API变得容易。</p><p id="49b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个特定的场景中，我们将保存我们的农场信息，每个农场中的坦克以及与坦克相关的设备。这些数据将被存储在Google Cloud SQL上，而设备遥测将被保存为save BigQuery，以处理物联网设备不时发送的大量数据。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es js"><img src="../Images/87775cee2460c2cc7ac53a6a492f4ad3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EjBwoQhCDZWZ6P8DoFf5tQ.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">项目架构</figcaption></figure><p id="3bbd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了监控我们的数据，我们将在Data Studio上构建一个仪表板，使用联邦查询特性混合来自云SQL和BigQuery的数据。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es ki"><img src="../Images/db771b11f8916662149c5000c04bba44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SINiYcYahhCTPUDM4GGIlQ.png"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">Data Studio仪表板</figcaption></figure><p id="ed1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">创建并设置Django Rest框架项目</strong></p><p id="3c52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于本文，我将使用Python 3.7和Django 2.2。为了引导项目，我只是按照Django Rest框架上的文档来安装依赖项并创建基础项目。您可以跳过这一步并克隆项目，但这只是作为项目如何构建的参考。总之，我使用了以下命令:</p><pre class="jt ju jv jw fd kj kk kl km aw kn bi"><span id="e3a3" class="ko kp hi kk b fi kq kr l ks kt">mkdir myproject<br/>cd myproject</span><span id="6585" class="ko kp hi kk b fi ku kr l ks kt"># Create a virtual environment to isolate our package dependencies locally<br/>python3 -m venv env<br/>source env/bin/activate</span><span id="2efc" class="ko kp hi kk b fi ku kr l ks kt"># Install Django and Django REST framework into the virtual environment<br/>pip install django djangorestframework</span><span id="7c81" class="ko kp hi kk b fi ku kr l ks kt"># Install database specific libraries for the project, in this case PostgresSQL and Bigquery<br/>pip install google-cloud-bigquery psycopg2</span><span id="e555" class="ko kp hi kk b fi ku kr l ks kt"># Additional libraries to run the project and serve static files<br/>pip install gunicorn whitenoise</span><span id="3a46" class="ko kp hi kk b fi ku kr l ks kt"># Set up a new project with a single application<br/>django-admin startproject myproject .  <br/>django-admin startapp tank_monitoring</span><span id="6155" class="ko kp hi kk b fi ku kr l ks kt"># Freeze dependencies to be used on the Docker container<br/>pip freeze &gt; requirements.txt</span></pre><div class="kv kw ez fb kx ky"><a href="https://www.django-rest-framework.org/tutorial/quickstart/" rel="noopener  ugc nofollow" target="_blank"><div class="kz ab dw"><div class="la ab lb cl cj lc"><h2 class="bd hj fi z dy ld ea eb le ed ef hh bi translated">快速入门</h2><div class="lf l"><h3 class="bd b fi z dy ld ea eb le ed ef dx translated">我们将创建一个简单的API，允许管理员用户查看和编辑系统中的用户和组。创建一个…</h3></div><div class="lg l"><p class="bd b fp z dy ld ea eb le ed ef dx translated">www.django-rest-framework.org</p></div></div><div class="lh l"><div class="li l lj lk ll lh lm kc ky"/></div></div></a></div><p id="385d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该应用程序包含农场的3个模型、农场中将要监控的储罐以及将要与储罐关联的设备。这些模型将存储在云SQL上，并且将有一个Rest APIs可用于CRUD操作(创建、读取、更新、删除)。</p><div class="kv kw ez fb kx ky"><a href="https://github.com/alvarowolfx/cloud-run-django-rest-iot/blob/master/tank_monitoring/models.py" rel="noopener  ugc nofollow" target="_blank"><div class="kz ab dw"><div class="la ab lb cl cj lc"><h2 class="bd hj fi z dy ld ea eb le ed ef hh bi translated">alvarowolfx/cloud-run-django-rest-IOT</h2><div class="lf l"><h3 class="bd b fi z dy ld ea eb le ed ef dx translated">让我们使用Django Rest框架作为项目的基础，创建一个农场储罐监控解决方案。拯救农场…</h3></div><div class="lg l"><p class="bd b fp z dy ld ea eb le ed ef dx translated">github.com</p></div></div></div></a></div><p id="3c78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一个重要的端点是设备发送数据。它是一个端点，接受设备ID，检查设备是否存在，如果不存在，则在CloudSQL上创建设备，然后在BigQuery上保存遥测数据。将BigQuery用于物联网设备遥测是有意义的，因为随着项目的增长和更多设备开始频繁报告数据，我们不必担心可扩展性。</p><div class="kv kw ez fb kx ky"><a href="https://github.com/alvarowolfx/cloud-run-django-rest-iot/blob/master/tank_monitoring/services.py" rel="noopener  ugc nofollow" target="_blank"><div class="kz ab dw"><div class="la ab lb cl cj lc"><h2 class="bd hj fi z dy ld ea eb le ed ef hh bi translated">alvarowolfx/cloud-run-django-rest-IOT</h2><div class="lf l"><h3 class="bd b fi z dy ld ea eb le ed ef dx translated">让我们使用Django Rest框架作为项目的基础，创建一个农场储罐监控解决方案。拯救农场…</h3></div><div class="lg l"><p class="bd b fp z dy ld ea eb le ed ef dx translated">github.com</p></div></div></div></a></div><div class="kv kw ez fb kx ky"><a href="https://github.com/alvarowolfx/cloud-run-django-rest-iot/blob/master/tank_monitoring/views.py" rel="noopener  ugc nofollow" target="_blank"><div class="kz ab dw"><div class="la ab lb cl cj lc"><h2 class="bd hj fi z dy ld ea eb le ed ef hh bi translated">alvarowolfx/cloud-run-django-rest-IOT</h2><div class="lf l"><h3 class="bd b fi z dy ld ea eb le ed ef dx translated">让我们使用Django Rest框架作为项目的基础，创建一个农场储罐监控解决方案。拯救农场…</h3></div><div class="lg l"><p class="bd b fp z dy ld ea eb le ed ef dx translated">github.com</p></div></div><div class="lh l"><div class="ln l lj lk ll lh lm kc ky"/></div></div></a></div><p id="ff30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">创建GCP项目、云SQL数据库和BigQuery </strong></p><p id="adca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要开始使用Google Cloud，您可以在云控制台web界面上完成所有操作，但命令行工具是一个更强大的工具，我们稍后需要部署我们的应用程序。要使用gcloud命令行工具，<a class="ae jr" href="https://cloud.google.com/sdk/downloads" rel="noopener ugc nofollow" target="_blank">按照这里的说明下载并安装它</a>。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lo"><img src="../Images/60426d65eb9d5dbdc517607d5dfda297.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-cpRhxiBRJWvUEU4TURw1A.png"/></div></div></figure><div class="kv kw ez fb kx ky"><a href="https://console.cloud.google.com/projectcreate" rel="noopener  ugc nofollow" target="_blank"><div class="kz ab dw"><div class="la ab lb cl cj lc"><h2 class="bd hj fi z dy ld ea eb le ed ef hh bi translated">谷歌云平台</h2><div class="lf l"><h3 class="bd b fi z dy ld ea eb le ed ef dx translated">Google云平台让您可以在同一基础设施上构建、部署和扩展应用程序、网站和服务…</h3></div><div class="lg l"><p class="bd b fp z dy ld ea eb le ed ef dx translated">console.cloud.google.com</p></div></div><div class="lh l"><div class="lp l lj lk ll lh lm kc ky"/></div></div></a></div><p id="6b95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，在此之后，您应该验证并创建一个在本教程中使用的项目，用您想要的名称替换<code class="du lq lr ls kk b">[YOUR_PROJECT_NAME]</code>:</p><pre class="jt ju jv jw fd kj kk kl km aw kn bi"><span id="989f" class="ko kp hi kk b fi kq kr l ks kt"># To install some cloud build tools<br/>gcloud components install beta<br/># Authenticate with Google Cloud:<br/>gcloud auth login<br/>gcloud auth application-default login<br/># Create cloud project — choose your unique project name:<br/>gcloud projects create [YOUR_PROJECT_NAME]<br/># Set current project<br/>gcloud config set project [YOUR_PROJECT_NAME]<br/># Enable SQL admin on gcloud<br/>gcloud services enable sqladmin</span></pre><p id="85b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要创建云SQL实例。这个项目应用程序被设置为使用PostgresSQL，但MySQL也可以通过一些小的更改来使用。我建议按照本页中的步骤创建数据库实例，并安装SQL代理工具，以便连接到本地机器上的远程数据库，这对运行数据库迁移很重要。</p><p id="10c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不幸的是，云SQL没有免费层，但新帐户有300澳元的信用，这对于测试来说绰绰有余，而且我建议如果你刚刚开始学习，创建一个较小的实例。</p><div class="kv kw ez fb kx ky"><a href="https://cloud.google.com/sql/docs/postgres/quickstart-proxy-test" rel="noopener  ugc nofollow" target="_blank"><div class="kz ab dw"><div class="la ab lb cl cj lc"><h2 class="bd hj fi z dy ld ea eb le ed ef hh bi translated">使用代理进行本地测试的快速入门|云SQL for PostgreSQL | Google Cloud</h2><div class="lf l"><h3 class="bd b fi z dy ld ea eb le ed ef dx translated">该页面向您展示了如何使用云SQL代理从本地测试环境连接到云SQL。正在连接…</h3></div><div class="lg l"><p class="bd b fp z dy ld ea eb le ed ef dx translated">cloud.google.com</p></div></div></div></a></div><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lt"><img src="../Images/163ec273d2862cafa740419598cd2ce0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YTNP1MtlxNzvoWSnV22Vrg.png"/></div></div></figure><p id="2be3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建云SQL实例后，通过使用云SQL实例的GCP控制台创建一个<a class="ae jr" href="https://cloud.google.com/sql/docs/mysql/create-manage-databases#create" rel="noopener ugc nofollow" target="_blank">新数据库。比如可以用名字<code class="du lq lr ls kk b">tank_monitoring</code>。还可以使用云SQL实例的GCP控制台</a>创建一个<a class="ae jr" href="https://cloud.google.com/sql/docs/mysql/create-manage-users#creating" rel="noopener ugc nofollow" target="_blank">新用户。</a></p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lo"><img src="../Images/f3116d0ec8486906b79ff72e538acb5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U8GKNvdR1M91i9X3E4yJrA.png"/></div></div></figure><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lu"><img src="../Images/1cd4682cf6e9a924dc1e743cb0474410.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xCcOkQTWI_7DR955p5mswA.png"/></div></div></figure><p id="68dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要下载并设置云SQL代理工具来连接到远程数据库，这样我们就可以运行Django迁移，为管理界面创建数据库和用户。</p><pre class="jt ju jv jw fd kj kk kl km aw kn bi"><span id="5210" class="ko kp hi kk b fi kq kr l ks kt"># Download the Cloud SQL Proxy and give permission locally - this is for macOS<br/>curl -o cloud_sql_proxy <a class="ae jr" href="https://dl.google.com/cloudsql/cloud_sql_proxy.darwin.amd64" rel="noopener ugc nofollow" target="_blank">https://dl.google.com/cloudsql/cloud_sql_proxy.darwin.amd64</a><br/>chmod +x cloud_sql_proxy<br/># After creating the database instance, get the instance connection string<br/>gcloud sql instances describe [YOUR_INSTANCE_NAME]<br/># Run in another tab the proxy<br/>./cloud_sql_proxy -instances=&lt;INSTANCE_CONNECTION_NAME&gt;=tcp:5432</span></pre><p id="6a6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行它将使远程数据库可用，因为它是在本地运行的，这非常棒。现在，让我们运行迁移并创建用户。您需要在创建云SQL数据库时使用您的设置填充环境变量:</p><pre class="jt ju jv jw fd kj kk kl km aw kn bi"><span id="e03a" class="ko kp hi kk b fi kq kr l ks kt">export DJANGO_DEVELOPMENT=True<br/>export DB_USER=[DB_USER]<br/>export DB_PASS=[DB_PASS]<br/>export DB_NAME=[DB_PASS]<br/>python manage.py migrate  <br/>python manage.py createsuperuser  <br/>#  You can run the application locally pointing to the remote database to test things if you want<br/>python manage.py runserver</span></pre><p id="1b4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">既然已经创建了Cloud SQL上的所有结构，让我们在Cloud Run上部署我们的后端。为此，我们需要创建Docker映像，然后将它部署到Cloud Run上。遵循以下步骤:</p><pre class="jt ju jv jw fd kj kk kl km aw kn bi"><span id="6d33" class="ko kp hi kk b fi kq kr l ks kt">gcloud builds submit — -tag gcr.io/[YOUR_PROJECT_NAME]/tank-monitoring .</span></pre><p id="b5cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以检查您的docker映像是否已在Google Cloud Container注册表中成功创建:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lo"><img src="../Images/164e2b9d71d54f70c3abf227e8127ec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q_n-MB-au9zjCYKdQSYkDw.png"/></div></div></figure><p id="34cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">部署容器映像后，运行以下命令将该映像部署到云运行。选择选项1部署为完全托管的服务，我建议选择<code class="du lq lr ls kk b">us-central1</code>区域，因为它是最便宜的区域之一，对于最后一个问题，您可以选择“是”以允许未经身份验证的调用。</p><pre class="jt ju jv jw fd kj kk kl km aw kn bi"><span id="c378" class="ko kp hi kk b fi kq kr l ks kt">export DB_USER=[DB_USER]<br/>export DB_PASS=[DB_PASS]<br/>export DB_NAME=[DB_PASS]<br/>export DB_CONNECTION_NAME=[DB_CONNECTION_NAME]<br/>export GCLOUD_PROJECT=[YOUR_PROJECT_NAME]<br/>gcloud beta run deploy --image gcr.io/[YOUR_PROJECT_NAME]/tank-monitoring \<br/> —add-cloudsql-instances $DB_CONNECTION_NAME \<br/> —set-env-vars GCLOUD_PROJECT=$GCLOUD_PROJECT \<br/> —set-env-vars DB_CONNECTION_NAME=$DB_CONNECTION_NAME \ <br/> —set-env-vars DB_USER=$DB_USER \<br/> —set-env-vars DB_PASS=$DB_PASS \<br/> —set-env-vars DB_NAME=$DB_PASS</span></pre><p id="ed46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还要注意，这些环境变量只需要传递一次，稍后您可以更新版本而不需要提供所有的环境变量，但是如果您需要添加/删除一个新的环境变量，您需要部署并指定所有的环境变量。您可以在云运行页面上检查已部署的服务。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lv"><img src="../Images/d26c1ec9d37979d66cf3bd8a5b90ca6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MZZHcAgvh6Co9c9uDQIJbA.png"/></div></div></figure><p id="893f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要更新服务，只需再次运行gcloud build命令来构建一个新的docker映像，然后运行<code class="du lq lr ls kk b">gcloud beta run tank-monitoring deploy — image gcr.io/[YOUR_PROJECT_NAME]/tank-monitoring</code>来创建一个新的修订版并维护相同的环境变量。</p><p id="c4f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基本上就是这样了！！！您可以访问Django管理界面来管理我们的项目模型。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lw"><img src="../Images/b256a23bbd347ef9bda78b163e1c208f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ht-flL4TZusXylJnAijpWw.png"/></div></div></figure><p id="b265" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，REST API可用于构建一个应用程序，例如访问我们的农场、坦克和设备数据。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lx"><img src="../Images/89b03031f2359595f4c95e3fd093656f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V4xMDTEGsm_ph2zRxP9UAg.png"/></div></div></figure><p id="8869" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与BigQuery相关的有两个独立的端点，一个将被设备用来发送数据，另一个用于查询可以在图表或历史表上使用的历史数据。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es ly"><img src="../Images/21246a7e90948d8ab2a910a3faa0551f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U1CS1iMc84JgBcPX6yPolQ.png"/></div></div></figure><p id="70fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结论</strong></p><p id="7200" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在第一部分中，我们考虑了为我们的农场储罐监控项目部署无服务后端的所有步骤。老实说，这种架构可以通过类似的方法应用于其他物联网项目。总有改进的空间，我添加了一些未来的想法来改进当前的项目，如果您有更多相关的想法，请告诉我:</p><ul class=""><li id="c9b2" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">添加用户认证:API现在是公共的，但是我们可以添加一个Json Web Token (JWT)认证，并且只允许通过认证的用户访问基本的REST APIs。</li><li id="b6b8" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">添加设备身份验证:我们可以限制只有已知的设备才能发送数据，甚至可以增加更多的安全性，要求设备生成JWT令牌，该令牌使用设备和服务器之间的共享密钥。云物联网核心已经做到了这一点，我在其他文章中探讨了这一点，但我想保持这一点非常简单，但重要的是要考虑安全方法，以限制哪些设备可以访问您的后端。</li><li id="a832" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">用Firebase添加一个实时层:不用在BigQuery上运行查询就可以知道每个坦克的当前状态，这样我们就可以把它保存在Firebase上，并在我们的应用程序中使用最新的数据。但我不会涉及这一点，因为我已经在我写的关于物联网架构的其他文章中探讨了这一点。</li><li id="4f77" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">根据规则触发和发送警报:我们可以为每个储罐添加一个低阈值，并在检测到警报条件时发送电子邮件。</li><li id="32ce" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">将遥测数据发送到PubSub并异步处理:当我们谈论可伸缩系统时，这是一个非常重要的概念。这样，我们可以将数据接收从其他逻辑中分离出来，以将数据保存到数据库(或多个数据库)中，还可以添加其他功能，如我之前提到的警报。</li></ul><p id="c767" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请务必查看本教程的其他部分，以了解完整的解决方案。</p><p id="72ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考文献</strong></p><ul class=""><li id="05ab" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">https://www.django-rest-framework.org/tutorial/quickstart/<a class="ae jr" href="https://www.django-rest-framework.org/tutorial/quickstart/" rel="noopener ugc nofollow" target="_blank"/></li><li id="6d0c" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><a class="ae jr" href="https://cloud.google.com/sql/docs/postgres/quickstart-proxy-test" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/SQL/docs/postgres/quick start-proxy-test</a></li><li id="fc6c" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><a class="ae jr" href="https://github.com/GoogleCloudPlatform/python-docs-samples" rel="noopener ugc nofollow" target="_blank">https://github.com/GoogleCloudPlatform/python-docs-samples</a></li><li id="f8c1" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><a class="ae jr" href="https://cloud.google.com/python/django/kubernetes-engine" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/python/django/kubernetes-engine</a></li><li id="e135" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><a class="ae jr" rel="noopener" href="/swlh/say-hello-to-serverless-containers-with-cloud-run-4c32d90330fc">https://medium . com/swlh/say-hello-to-server less-containers-with-cloud-run-4c 32d 90330 fc</a></li><li id="4049" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><a class="ae jr" href="https://cloud.google.com/run/" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/run/</a></li></ul></div></div>    
</body>
</html>