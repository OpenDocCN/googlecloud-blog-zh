<html>
<head>
<title>Fastrack your Homogeneous Database Migration for PostgreSQL to Cloud SQL(PostgreSQL)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快速跟踪PostgreSQL到云SQL(PostgreSQL)的同构数据库迁移</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/fastrack-your-homogeneous-database-migration-for-postgresql-to-cloud-sql-postgresql-53a9259daca1?source=collection_archive---------0-----------------------#2022-03-17">https://medium.com/google-cloud/fastrack-your-homogeneous-database-migration-for-postgresql-to-cloud-sql-postgresql-53a9259daca1?source=collection_archive---------0-----------------------#2022-03-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7430" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇博客更多的是关于将自我管理的PostgreSQL数据库迁移到Google Cloud上的云SQL(PostgreSQL)实例。我们将从零开始，在GCE上设置一个自我管理的PostgreSQL数据库(对于云虚拟机/内部部署也是如此)，然后迁移到CloudSQL副本实例，最终提升到Cloud SQL上的PostgreSQL生产/主实例。</p><p id="bd72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们经常为数据库迁移而苦恼，因为这是一项具有挑战性的活动。这有各种各样的原因，下面重点介绍几个。</p><ul class=""><li id="7df2" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">它很复杂，因为没有基于GUI的简单易用的工具</li><li id="9838" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">网络复杂性导致的摩擦</li><li id="e4ab" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">设置迁移作业和监控迁移活动的手动方法</li><li id="fb96" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">即使使用手动方法备份和恢复数据库也容易出错</li><li id="ec7f" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">依赖于遵循数据库迁移黑盒方法的工具，对用户不透明。</li><li id="d1ae" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">与供应商工具相关的成本</li><li id="2ed4" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">企业承受不起支持生产应用环境的数据库停机</li></ul><p id="259d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了解决我们的数据库管理员和用户的上述挑战，Google Cloud在2021年初推出了<a class="ae jr" href="https://cloud.google.com/database-migration" rel="noopener ugc nofollow" target="_blank">数据库迁移服务(DMS) </a>，从而简化了网络工作流，管理初始快照和持续复制，并提供迁移操作的状态。DMS提供高保真、在线最小停机时间迁移，从而将模式、数据和元数据从源数据库引擎迁移到目标云SQL。它让您开始将MySQL/PostgreSQL/SQL Server(预览版)迁移到<a class="ae jr" href="https://cloud.google.com/sql" rel="noopener ugc nofollow" target="_blank">云SQL</a>(MySQL/PostgreSQL/SQL Server的完全托管关系数据库服务)。DMS目前支持同构数据库迁移。</p><p id="ff71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只有2个元素/步骤需要配置易于使用的图形向导，如下所述。</p><ul class=""><li id="9a05" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><strong class="ih hj">连接配置文件</strong>表示将在迁移作业中使用的特定源的连接信息。</li><li id="589c" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><strong class="ih hj">迁移作业</strong>代表源连接概要文件和目标云SQL实例对，以及特定于迁移的设置。</li></ul><p id="985b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">使用DMS的主要优势</strong></p><ul class=""><li id="c410" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">用户无需支付额外费用。免费的！！！！！</li><li id="62a2" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">完全没有服务器。这对用户意味着什么，即无需调配、管理和监控执行数据库迁移作业所需的资源。</li><li id="9c99" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">它通过高保真迁移提供在线最小停机时间功能。</li><li id="b1be" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">简单易用的图形化步骤/UX开始数据库迁移。</li><li id="dfe9" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">DMS使用数据库引擎的本机复制方法，因此对用户完全透明。</li><li id="3246" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">使用补充策略进行迁移，以升级到具有跨版本迁移的数据库引擎的最新版本。</li></ul><h1 id="4e8c" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">遵循下面提到的步骤！！！！！</h1><h1 id="1c75" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">第一步</strong> —在谷歌云计算引擎(VM)上设置PostgreSQL</h1><p id="c5cf" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">选择您选择的虚拟机配置和操作系统。对于这个设置，我使用了n2-standard-2 ( 2个vCPUs和8 GB RAM)和Ubuntu 20.04 LTS公共映像。</p><ol class=""><li id="3818" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc kv jj jk jl bi translated">更新软件包</li></ol><blockquote class="kw kx ky"><p id="9de2" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">sudo apt-get更新</p></blockquote><p id="2bff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.(安装PostgreSQL，包括PSQL客户端)</p><blockquote class="kw kx ky"><p id="c012" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated"><strong class="ih hj"> sudo apt -y安装PostgreSQL PostgreSQL-client PostgreSQL-contrib</strong></p></blockquote><p id="cdc8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.连接到PSQL以完成设置</p><blockquote class="kw kx ky"><p id="d7a2" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">a &gt;执行<strong class="ih hj"> <em class="hi"> sudo -s </em> </strong></p><p id="f693" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">b&gt; <strong class="ih hj">执行</strong><strong class="ih hj">sudo-u postgres psql postgres</strong></p><p id="ca6d" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated"><strong class="ih hj"> c &gt;使用</strong>设置用户postgres的密码</p><p id="1e7b" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated"><strong class="ih hj">\密码后缀</strong></p></blockquote><p id="e358" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.登录后，检查版本。作为Postgres设置的一部分，我们将使用Postgres版本12，该版本将升级到版本13。截图供大家参考。</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es ld"><img src="../Images/923b4c36ce50a5aa133171d8df5b3163.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ExOOJlQpxv0VESYM"/></div></div></figure><p id="20e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.创建一个样本表</p><blockquote class="kw kx ky"><p id="ca1c" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated"><em class="hi">创建客户表(</em></p><p id="05d4" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated"><em class="hi"> ID INT主键不为空，</em></p><p id="3015" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated"><em class="hi">名称文本不为空，</em></p><p id="2d22" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated"><em class="hi">年龄INT不为空，</em></p><p id="0606" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated"><em class="hi">地址字符(50) </em></p><p id="5185" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated"><em class="hi">)；</em></p></blockquote><h2 id="74bc" class="lp jt hi bd ju lq lr ls jy lt lu lv kc iq lw lx kg iu ly lz kk iy ma mb ko mc bi translated"><strong class="ak"> ***对于PostgreSQL数据库的DMS，没有主键的表将不会被迁移。</strong></h2><p id="f27e" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">6.在上表中插入少量记录，即客户</p><blockquote class="kw kx ky"><p id="e38c" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">插入客户值(1，' Romin '，25，' LONDON ')；</p><p id="9940" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">插入客户值(2，“杰克”，42，“东京”)；</p><p id="3266" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">插入客户价值观(3，' Nigel '，40，' Singapore ')；</p><p id="2441" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">插入客户值(4，“查尔斯”，45，“巴黎”)；</p></blockquote><p id="e04f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.要连接到您的Postgres数据库，您需要在配置文件中进行更改，并在Google Cloud的防火墙中打开一个端口。默认情况下，Postgres不允许远程连接。要更改此设置，您可以更改名为<a class="ae jr" href="https://www.postgresql.org/docs/12/auth-pg-hba-conf.html" rel="noopener ugc nofollow" target="_blank"> pg_hba.conf </a>的文件。这一步主要是“配置PostgreSQL远程访问”。</p><h2 id="6f9d" class="lp jt hi bd ju lq lr ls jy lt lu lv kc iq lw lx kg iu ly lz kk iy ma mb ko mc bi translated"><strong class="ak">警告</strong>:在生产系统或任何具有互联网连接的系统上，使用强身份验证方法，并将流量仅限于您希望连接到每个数据库的那些用户和IP地址。</h2><h2 id="06d9" class="lp jt hi bd ju lq lr ls jy lt lu lv kc iq lw lx kg iu ly lz kk iy ma mb ko mc bi translated">//编辑pg_hba.conf</h2><blockquote class="kw kx ky"><p id="0f68" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">sudo VI/etc/PostgreSQL/12/main/pg _ HBA . conf</p></blockquote><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es md"><img src="../Images/57c2784d128ba9056f0066193f8b07b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rc9026vucADB-dw3ZBEoeQ.jpeg"/></div></div></figure><p id="0e47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> **用您的本地机器IP地址替换[您的IPV4地址]。注意，</strong><a class="ae jr" href="https://wikipedia.org/wiki/Classless_Inter-Domain_Routing" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj"/></a><strong class="ih hj">后缀/32用于单个地址。</strong></p><p id="c433" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成以上步骤后，保存文件并退出编辑器</p><p id="6295" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8.编辑postgresql.conf</p><blockquote class="kw kx ky"><p id="1ed2" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">sudo VI/etc/PostgreSQL/12/main/PostgreSQL . conf</p></blockquote><p id="c5be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">进行以下更改，即将localhost替换为* listen_addresses = '*' </strong></p><figure class="le lf lg lh fd li er es paragraph-image"><div class="er es me"><img src="../Images/92041b5dd22c6c7cbd7ecd99ce92e80c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/0*IeFV_Yz4KvHoF5Va"/></div></figure><p id="f1f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">“*”设置使Postgres能够监听所有IP地址。</strong></p><p id="310a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">9.重新启动数据库服务。执行以下命令</p><blockquote class="kw kx ky"><p id="fc90" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">sudo服务postgresql重新启动</p></blockquote><h1 id="e30b" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">步骤2 —配置源自管理数据库(Postgres)和先决条件。</strong></h1><ol class=""><li id="3213" class="jd je hi ih b ii kq im kr iq mf iu mg iy mh jc kv jj jk jl bi translated"><strong class="ih hj">为postgresql安装</strong><a class="ae jr" href="https://github.com/2ndQuadrant/pglogical" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">pg logical</strong></a><strong class="ih hj">native capability</strong>进行复制。此功能为postgres提供逻辑流复制。使用下面提到的步骤来安装和配置pglogical。</li></ol><blockquote class="kw kx ky"><p id="a8f2" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">sudo su -</p><p id="06ad" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">curl<a class="ae jr" href="https://access.2ndquadrant.com/api/repository/dl/default/release/deb" rel="noopener ugc nofollow" target="_blank">https://access . 2nd quadrant . com/API/repository/dl/default/release/deb</a>| bash</p><p id="f47f" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">sudo apt-get安装curl ca证书gnupg</p><p id="eb02" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">sudo apt-get更新</p><p id="15b0" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">sudo安装postgresql-common</p></blockquote><p id="795e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于PostgreSQL版本12，请使用下面的命令，对于9.6/10等其他版本，请使用适当的命令。</p><blockquote class="kw kx ky"><p id="4cc4" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">sudo apt-get安装PostgreSQL-12-pg logic</p></blockquote><h2 id="9326" class="lp jt hi bd ju lq lr ls jy lt lu lv kc iq lw lx kg iu ly lz kk iy ma mb ko mc bi translated">***对于其他相关版本，请使用以下版本之一，而不是“sudo apt-get install PostgreSQL-12-pg logical”</h2><blockquote class="kw kx ky"><p id="7362" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated"><strong class="ih hj">PostgreSQL 9.4:</strong>sudo apt-get安装postgresql-9.4-pglogical</p><p id="e60b" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated"><strong class="ih hj">PostgreSQL 9.5:</strong>sudo apt-get安装postgresql-9.5-pglogical</p><p id="bcd6" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">PostgreSQL 9.6:  sudo apt-get安装postgresql-9.6-pglogical</p><p id="7f88" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">PostgreSQL 10:  sudo apt-get安装postgresql-10-pglogical</p><p id="2fd6" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">PostgreSQL 11:  sudo apt-get安装postgresql-11-pglogical</p></blockquote><p id="75ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.在<strong class="ih hj">使用Vi/其他编辑器编辑postgresql.conf文件../../etc/PostgreSQL/12/main/PostgreSQL . conf</strong></p><blockquote class="kw kx ky"><p id="c37a" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">shared _ preload _ libraries = pg logic</p></blockquote><p id="a4ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.执行以下命令</p><blockquote class="kw kx ky"><p id="577d" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">sudo服务postgresql重新启动</p></blockquote><p id="61bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.<strong class="ih hj">在源中的每个数据库上安装pglogical扩展</strong></p><p id="1706" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里有一点指导:对于PostgreSQL，您需要为实例中的每个数据库配置pglogical。Pglogical特性在数据库级工作，而不是在实例级。</p><p id="5ed6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">执行以下命令</p><blockquote class="kw kx ky"><p id="cc83" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">sudo -u postgres psql postgres</p><p id="1ccd" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">创建扩展程序逻辑；</p><p id="26b9" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">将架构pglogical上的用法授予postgres</p><p id="e240" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">向postgres授予对SCHEMA public的使用权；</p><p id="b2fe" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">将SCHEMA pglogical中所有表上的SELECT权限授予postgres</p><p id="3de9" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">将SCHEMA public中所有表上的SELECT权限授予postgres</p><p id="9d69" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">将SCHEMA public中所有序列上的SELECT授权给postgres</p><p id="b037" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">输入\q退出PSQL</p></blockquote><p id="68f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.<strong class="ih hj">在源服务器上编辑postgresql.conf文件</strong></p><p id="3fcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">视觉识别系统../../etc/PostgreSQL/12/main/PostgreSQL . conf，并添加/替换以下内容:</p><blockquote class="kw kx ky"><p id="6fa3" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">shared _ preload _ libraries = ' pglogical '</p><p id="be2a" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">wal_level = '逻辑'</p><p id="3aa0" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">最大复制插槽数= 10</p><p id="642d" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">最大发送次数= 10</p><p id="c371" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">最大工作进程数= 10</p></blockquote><p id="f329" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.保存并关闭文件。重新启动主服务器</p><blockquote class="kw kx ky"><p id="1dd5" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">sudo服务postgresql重新启动</p></blockquote><h1 id="d615" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">步骤3 —使用图形向导分两步设置DMS，即连接配置文件和迁移作业。</strong></h1><ol class=""><li id="2a65" class="jd je hi ih b ii kq im kr iq mf iu mg iy mh jc kv jj jk jl bi translated">连接配置文件:导航到数据库迁移服务，然后单击连接配置文件。基本上需要捕获迁移作业将使用的源数据库配置。请参考安装在GCE(VM)上的自我管理的postgres数据库配置。下面截图。</li></ol><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mi"><img src="../Images/d725c06b37c19632ad5cbdae1286fada.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uQWIrmu9XpZX32We"/></div></div></figure><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mj"><img src="../Images/f4f7c60a7e2d300284b4efcf56055f98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*trbLAqVhgH2gaZFP"/></div></div></figure><p id="b647" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.迁移作业——创建连接配置文件后，下一步是开始迁移作业。</p><p id="4d73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a &gt;描述您的迁移工作。这一步基本上你提供迁移作业名称，源数据库引擎细节，谷歌云地区，然后选择迁移作业类型为连续。对于Postgres，DMS只支持写博客时的连续。<strong class="ih hj">连续</strong>负责源数据库的回填或初始快照以及CDC，以捕获源数据库上的增量更新/写入/更改。下面截图。</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mk"><img src="../Images/37c202659ec20bd30ed2cf1d6a39248a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EnWtNtc8yoX8gucs"/></div></div></figure><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es ml"><img src="../Images/d54ffd15e746b912b26ebd7ac2a4127b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Wuvz5T_dJjbM4xFz"/></div></div></figure><p id="b01e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b &gt;定义源—此步骤允许为源数据库选择以前创建的连接配置文件，即在我们的示例中，GCP虚拟机上的自托管PostgreSQL。</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mm"><img src="../Images/7cb80cb6d53843eb577bdb20f855a9ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cjNcloS6LBUny8U3"/></div></div></figure><p id="7e13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">c &gt;创建目的地:根据需要选择云SQL实例配置。如果您以前使用过云SQL创建页面，它是类似的。此步骤将帮助您从云SQL复制副本实例开始，一旦复制延迟最小化，该实例将最终提升到生产/主实例。创建实例预计需要几分钟时间。</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mn"><img src="../Images/31cd1d7fa6818ce1cb245891f14478e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YQsddLmATQP37L6w"/></div></div></figure><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mo"><img src="../Images/20f04342dd1994af219b8a22f7d1ba77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6UoqDn2ZHqLtCLWu"/></div></div></figure><p id="08ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">d &gt;定义连接方法—然后选择连接方法。自从我的PostgreSQL数据库实例托管在Google云计算引擎上以来，我一直使用VPC对等技术。请随意选择其他选项，如反向SSH/VPN等</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mp"><img src="../Images/46b75cffa09b17df584a515160bf2792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wOrjJi9JqUyGTxLv"/></div></div></figure><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mq"><img src="../Images/c82d0bbe454dcdeec37915bb0b5359ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z-MgopXg9m8lVAPU"/></div></div></figure><p id="0a47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在创建了云SQL上的数据库实例之后，您应该会看到上面的消息。</p><p id="b4cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">e &gt;测试和创建迁移作业—当您看到说明已为目标数据库创建实例的警报时，请继续执行迁移作业的最后一步。这一步非常重要，就像在其他工具中一样，您开始迁移，如果出现问题，您可以返回并重新开始。但是DMS的验证是提前完成的，为数据库人员节省了重要的生产时间。如果“<strong class="ih hj">测试迁移作业</strong>成功，请继续执行<strong class="ih hj">“创建作业”或“创建并启动作业”</strong>。如果您在测试作业时看到错误，系统将提示您调试问题。下面截图</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mr"><img src="../Images/3ce76dacbcf1418ee7b5d79a2ce49f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l1tb-olZmcauneak"/></div></div></figure><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es ld"><img src="../Images/ce252111ab08c4b757279a14f4732cf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NZzgbvO591zXXiBZ"/></div></div></figure><h1 id="94c1" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">步骤4:现在您可以看到迁移作业的进度。一旦启动，它应该将状态从“正在进行完全转储”更改为“正在进行CDC”。</strong></h1><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es ld"><img src="../Images/96a1f04c2e45991e5635002923a051e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SusZpmWD9xu50haW"/></div></div></figure><p id="a149" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">使用PSQL登录云SQL副本</strong> —要登录云SQL副本实例，您需要使用Postgres的一个客户端工具。我使用过PSQL命令行终端工具。它基本上是PostgreSQL的基于终端的前端。</p><p id="ba31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用以下命令登录复制副本实例(云SQL)</p><blockquote class="kw kx ky"><p id="222b" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">psql -U postgres -h x.x.x.x -p 5432</p><p id="fc85" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">x.x.x.x —云SQL复制副本实例的IP</p></blockquote><p id="6487" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">登录复制副本实例上的postgres数据库后，运行以下命令检查云SQL实例的版本。在虚拟机上的源自管理postgres数据库上，我们有12.9 <strong class="ih hj">，但在目标上，我们现在已经迁移，并通过版本升级补充了我们的迁移。</strong></p><blockquote class="kw kx ky"><p id="53a5" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">postgres = &gt; select version()；</p></blockquote><p id="f97f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">版本</p><p id="cac5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><p id="baed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">x86 _ 64-PC-Linux-GNU上的PostgreSQL 13.4 </strong>，由Debian clang版本12.0.1编译，64位</p><blockquote class="kw kx ky"><p id="b9da" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated"><strong class="ih hj">运行/dt </strong>列出postgres数据库中的关系。在我们的例子中，postgres数据库中只有一个表，即customers表。</p></blockquote><p id="7e04" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是表格和一些记录的截图。如果您遵循了前面的所有步骤，那么源数据库应该也是如此。</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es ms"><img src="../Images/b606816fea4551847f262983bd4d6433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qb0OCi3CKrrgWL3g"/></div></div></figure><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mt"><img src="../Images/6483b72dea3fd17ebd7cdcec46e2fa69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LAWzaHrAbyArC5VE"/></div></div></figure><blockquote class="kw kx ky"><p id="4133" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">下一部分—让我们检查DMS的CDC功能。</p></blockquote><p id="c492" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在GCP虚拟机(GCE)的源数据库上，添加以下记录供CDC检查</strong></p><blockquote class="kw kx ky"><p id="c4d2" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">postgres = # Insert into customers values(5，“拉斐尔”，45，“BLR”)；</p><p id="951f" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">postgres = # Insert into customers values(6，' Andre '，25，' Mumbai ')；</p><p id="28a6" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">postgres = # Insert into customers values(7，“Steve”，40，“Singapore”)；</p></blockquote><p id="4b53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">检查云SQL副本，您一定会看到总记录数随着新记录的增加而增加。表customers的源和目标数据库实例上的记录总数必须匹配。</strong></p><h1 id="9282" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">第5步</strong>我们知道，在源数据库中可能存在需要将DDL更改传播到目标云SQL实例的场景，pglogical with replicate ddl命令允许您这样做。</h1><p id="ae7d" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">以下命令允许新表的源数据库模式级别更改传播到云SQL副本上的目标实例。</p><p id="3420" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在源数据库上运行以下命令来创建新表。</p><blockquote class="kw kx ky"><p id="c86d" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">select pg logical . replicate _ DDL _ command(command:= ' CREATE TABLE public . company(ID INT PRIMARY KEY NOT NULL，NAME TEXT NOT NULL，AGE INT NOT NULL，ADDRESS CHAR(50)，SALARY REAL)；'，replication _ sets:= ARRAY[' default '])；</p></blockquote><p id="70b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">— — —</p><blockquote class="kw kx ky"><p id="8f14" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">postgres=# \d公司</p></blockquote><p id="341e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">//下面的输出</p><p id="803b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">表“公共公司”</p><p id="3c3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列|类型|排序规则|可空|默认值</p><p id="918c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">— — — — -+ — — — — — — — -+ — — — — — -+ — — — — — + — — — — -</p><p id="20f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">id | integer | | not null |</p><p id="3a6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">名称|文本| |不为空|</p><p id="c536" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">年龄|整数| |非空值|</p><p id="0033" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">地址|字符(50) | | |</p><p id="e881" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">工资|真实| | |</p><p id="8bf1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">索引:</p><p id="1366" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“company_pkey”主键，btree (id)</p><p id="fab2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">执行下面提到的命令。它有助于将数据从源数据库传播到目标数据库，这是必须的。该命令用于一个表</p><blockquote class="kw kx ky"><p id="11d5" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">select pglogical . replication _ set _ add _ table(' default '，' public.company ')</p></blockquote><p id="b6c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> **复制集基本上是表的集合，这些表将用于从源数据库到目标数据库的迁移，并提供一种机制来控制数据库中的哪些表将被复制以及这些表上的哪些操作将被复制。</strong></p><p id="cc0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们在新表中插入一些记录，即源数据库上的公司，即GCP虚拟机上的自我管理Postgres</p><blockquote class="kw kx ky"><p id="04b8" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">postgres=# Insert into公司价值观(1，' Pat '，25，' Newyork '，25000)；</p><p id="6db3" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">postgres = # Insert into company values(2，'里克'，30，'芝加哥'，30000)；</p><p id="74b1" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">postgres = # Insert into company values(3，' Romin '，25，' Sunnyvale '，40000)；</p><p id="649b" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">postgres = # Insert into company values(4，'安德鲁'，45，'芝加哥'，45000)；</p></blockquote><p id="78f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">现在检查云SQL副本，新记录应该显示在新表中，即Company。</strong></p><p id="8ae8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们通过在GCP虚拟机上的源postgres数据库上使用以下命令添加新列(即pincode)作为测试活动来修改该表</p><blockquote class="kw kx ky"><p id="c2bf" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">select pg logical . replicate _ DDL _ command(' ALTER TABLE public . company add column pincode varchar(30)'，' { default } ')；</p><p id="ee75" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">postgres = &gt; select * from company</p></blockquote><p id="bc08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">—输出如下-</p><p id="cd4b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">身份证|姓名|年龄|地址|工资|密码</p><p id="e0fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">— — + — — — — + — — -+ — — — — — — — — — — — — — — — — — — — — — — — — — — + — — — — + — — — — -</p><p id="0df2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1 |帕特| 25 |纽约| 25000 |</p><p id="d078" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2 |里克| 30 |芝加哥| 30000 |</p><p id="667c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3 |罗明| 25 |桑尼维尔| 40000 |</p><p id="ea6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">丹尼尔| 46 |纽约| 25000 |</p><p id="790d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查目标云SQL Postgres数据库上的结果，结果应该匹配，即公司表应该有一个包含pincode的新列</p><p id="32a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过从源数据库中删除同一个表(即company)来测试PostgreSQL数据库。该数据库现在也应该在云SQL复制副本实例上消失。用于删除表格的命令。</p><blockquote class="kw kx ky"><p id="099b" class="if ig kz ih b ii ij ik il im in io ip la ir is it lb iv iw ix lc iz ja jb jc hb bi translated">select pg logical . replicate _ DDL _ command(' DROP table public . company CASCADE '，ARRAY[' default '])；</p></blockquote><h1 id="3f3f" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">第6步</strong>现在，让我们进入迁移作业控制台，在开始升级过程之前检查几项内容，即复制状态和用于迁移的存储大小。</h1><p id="7a6e" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">下面的屏幕截图显示了迁移到副本云sql实例的数据大小</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mu"><img src="../Images/47c2bcb836323c6a7a8d5b0e78c4a2d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uybWmJjQ882vYmy8QuWR4w.jpeg"/></div></div></figure><p id="e1dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">监控“复制延迟”的屏幕截图如下</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mv"><img src="../Images/3656a8cd90f4eb4bf71a8ed211a5226a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b9q1RdVDlW1J_VUxhOKXBA.jpeg"/></div></div></figure><p id="ba6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据屏幕截图，您看到复制延迟最小后，开始“提升”流程，该流程主要是将云SQL复制副本提升到具有读写功能的生产实例。下面截图。</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mw"><img src="../Images/4900c319f7931fcd2e3e412dad06f99f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vmbCtVyDDGsvcGzP4QSXAA.jpeg"/></div></div></figure><p id="1fd9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">几分钟后，您的复制副本实例将与源分离，并转换为读/写生产实例。状态将从“升级进行中”变为“已完成”。</p><p id="0bb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">PostgreSQL的已知限制~<a class="ae jr" href="https://cloud.google.com/database-migration/docs/postgres/known-limitations" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/database-migration/docs/postgres/known-limits</a></p><h1 id="0df3" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">祝贺您完成PostgreSQL的DMS！！！！</h1></div></div>    
</body>
</html>