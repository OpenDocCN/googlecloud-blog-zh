<html>
<head>
<title>Reporting Exceptions in ASP.NET</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在ASP中报告异常。网</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/reporting-exceptions-in-asp-net-d1c0d448d822?source=collection_archive---------1-----------------------#2018-07-11">https://medium.com/google-cloud/reporting-exceptions-in-asp-net-d1c0d448d822?source=collection_archive---------1-----------------------#2018-07-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bdf9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我适度成功的秘诀是掌握调试工具。我在调试器中逐句通过我写的每一行新代码。我写Win32应用的时候，背了几十个<a class="ae jd" href="https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/debugger-download-tools" rel="noopener ugc nofollow" target="_blank"> windbg </a>命令，用了<a class="ae jd" href="https://en.wikipedia.org/wiki/BoundsChecker" rel="noopener ugc nofollow" target="_blank"> BoundsChecker </a>和<a class="ae jd" href="https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/application-verifier" rel="noopener ugc nofollow" target="_blank">应用验证器</a>。我喜欢检查垃圾场。我知道这很奇怪，但我很喜欢，雇主也觉得这很有价值。</p><p id="33f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的技术栈已经更改为在<a class="ae jd" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>容器中运行的<a class="ae jd" href="https://www.asp.net/" rel="noopener ugc nofollow" target="_blank">ASP.NET</a>应用程序，所以我的调试工具也相应地更改了。几乎不可能单步调试运行在实际生产的ASP.NET应用程序中的代码，因此需要一套不同的调试工具。</p><p id="26c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我开始编写ASP.NET应用程序时，我需要解决的第一个问题是如何调试未捕获的异常。</p><h2 id="f0ce" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">在ASP中捕获未捕获的异常。网</h2><p id="29bf" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">默认情况下，当一个异常被抛出并且没有在<a class="ae jd" href="https://docs.microsoft.com/en-us/aspnet/core/?view=aspnetcore-2.1" rel="noopener ugc nofollow" target="_blank">ASP.NET</a>应用程序中被捕获时，用户会看到这样一个页面。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es ke"><img src="../Images/c31835342a0da88c82bac9d4ca8f7430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*fdrspUlgatZDxBxKVDxhbA.png"/></div></figure><p id="b60d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为一名开发人员，当我看到这个错误消息时，很容易将<code class="du km kn ko kp b">ASPNETCORE_ENVIRONMENT</code>标志切换到<code class="du km kn ko kp b">Development</code>，然后重新部署应用程序，只需几分钟，这样我就可以看到堆栈跟踪，然后在<code class="du km kn ko kp b">Production</code>模式下再次重新部署应用程序。</p><p id="660b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是在<code class="du km kn ko kp b">Development</code>模式下临时重新部署应用程序是一个<strong class="ih hj">坏主意</strong>，至少有两个原因:</p><ol class=""><li id="235d" class="kq kr hi ih b ii ij im in iq ks iu kt iy ku jc kv kw kx ky bi translated">一个<code class="du km kn ko kp b">Development</code>模式的应用程序也会向恶意用户显示你的堆栈跟踪。他们可以利用这些信息来攻击你。风险是真实存在的。</li><li id="b9d5" class="kq kr hi ih b ii kz im la iq lb iu lc iy ld jc kv kw kx ky bi translated">您永远不会看到用户没有向您报告的错误。很少有用户经历过实际报告错误的麻烦。更有可能的是，他们会停止使用你的网络应用，而你永远不知道为什么。</li></ol><h2 id="79c2" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">更好的方法</h2><p id="1fcf" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">有更好的方法来查看堆栈跟踪，并且它们使用起来很简单。我最喜欢的是<a class="ae jd" href="https://cloud.google.com/error-reporting/" rel="noopener ugc nofollow" target="_blank"> Stackdriver错误报告</a>。Stackdriver错误报告可以显示应用程序没有捕捉到的每个异常的堆栈跟踪。</p><p id="51b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当抛出异常时，Stackdriver错误报告会显示如下:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es le"><img src="../Images/724d771fbc6fbc0faf1456e611017cce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FQB7rfvxdN7f1GNigMTvZw.png"/></div></div></figure><p id="3688" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如上所示，Stackdriver错误报告显示了一个图表，显示了这个错误发生的频率，它还显示了错误的堆栈跟踪，我用红色圈出了这个错误。在这种情况下，堆栈跟踪只有一级深，因为控制器代码非常简单。有多简单？我单击堆栈跟踪中的蓝色链接来查看源代码:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es lj"><img src="../Images/b7f0b00d04da3280204e5a7c06964867.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KbbPWHswc-cOMryzsDvb_A.png"/></div></div></figure><p id="7d69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看代码，难怪会抛出异常！</p><h2 id="234a" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">将Stackdriver错误报告与ASP.NET核心应用程序集成</h2><p id="ffd7" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">将<a class="ae jd" href="https://cloud.google.com/error-reporting/" rel="noopener ugc nofollow" target="_blank">堆栈驱动错误报告</a>与ASP.NET核心应用程序集成需要添加<a class="ae jd" href="https://www.nuget.org/packages/Google.Cloud.Diagnostics.AspNetCore/" rel="noopener ugc nofollow" target="_blank">一个nuget包</a>:</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="1667" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并将8行代码添加到<code class="du km kn ko kp b">Startup.cs</code>:</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="b267" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样！现在我的应用程序将向Stackdriver报告错误，无论它在哪里运行。</p><h2 id="01cc" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">堆栈驱动程序</h2><p id="9f26" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">Stackdriver是一套<a class="ae jd" href="https://en.wikipedia.org/wiki/Application_performance_management" rel="noopener ugc nofollow" target="_blank">应用性能管理(APM) </a>工具，支持7种编程语言。Stackdriver的工具适用于应用程序运行的任何地方:AWS、Azure、Google云平台或企业网络。Stackdriver错误报告是套件中最简单的工具，老实说，我无法想象开发一个没有它的Web应用程序。</p><p id="e7fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Stackdriver错误报告的完整文档<a class="ae jd" href="https://cloud.google.com/error-reporting/docs/" rel="noopener ugc nofollow" target="_blank">保存在这里</a>。</p></div></div>    
</body>
</html>