<html>
<head>
<title>GCP: Spring To Production With App Engine, Cloud Build And GitHub</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GCP:通过应用引擎、云构建和GitHub进入生产阶段</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/gcp-deploying-to-app-engine-from-github-using-cloud-build-df2582f968c7?source=collection_archive---------0-----------------------#2020-05-20">https://medium.com/google-cloud/gcp-deploying-to-app-engine-from-github-using-cloud-build-df2582f968c7?source=collection_archive---------0-----------------------#2020-05-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ad35f2ebe14fc33aed82ee8d5dca0194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Sy6MknnaTf-ee8QoLgkxQ.jpeg"/></div></div></figure><p id="a7fe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi jo translated"><span class="l jp jq jr bm js jt ju jv jw di">我们</span>正在使用本教程，通过CI/CD(持续集成和持续交付)管道将<a class="ae jx" href="https://github.com/kioie/InventoryManagement" rel="noopener ugc nofollow" target="_blank">库存管理休息</a>应用程序投入生产。我们的目标是在谷歌计算平台(GCP)应用引擎flex环境上构建和部署。</p><p id="8edc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用Spring，Cloud SQL，App Engine，Cloud Secret Manager，Cloud Build和GitHub。</p><h1 id="53eb" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">春天的云</h1><p id="75ea" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated"><a class="ae jx" href="https://spring.io/projects/spring-boot" rel="noopener ugc nofollow" target="_blank">春云</a>旨在缩短代码长度，为您提供最简单的web应用开发方式。通过注释配置和默认代码，Spring Cloud缩短了开发应用程序的时间。它有助于创建一个几乎不需要配置的独立应用程序。</p><h1 id="0381" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">云SQL</h1><p id="d26b" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated"><a class="ae jx" href="https://cloud.google.com/sql" rel="noopener ugc nofollow" target="_blank"> Cloud SQL </a>是一个完全托管的关系数据库服务，适用于MySQL、PostgreSQL和SQL Server，由Google运行，因此可以轻松集成现有应用和Google云服务。</p><h1 id="9e79" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">应用引擎</h1><p id="f372" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated"><a class="ae jx" href="https://cloud.google.com/appengine" rel="noopener ugc nofollow" target="_blank"> App Engine </a>是一个平台即服务，用于在谷歌管理的基础设施上大规模开发和托管网络应用。它允许您从几种流行的语言、库和框架中进行选择，以开发和部署您的应用程序，包括带有Spring的Java。应用程序被沙盒化并部署在整个Google基础设施中，在应用程序的整个生命周期中，不再需要环境配置和管理。使编写可伸缩的应用程序变得容易。</p><h1 id="e840" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">云秘密管理器</h1><blockquote class="lb lc ld"><p id="a240" class="iq ir le is b it iu iv iw ix iy iz ja lf jc jd je lg jg jh ji lh jk jl jm jn hb bi translated"><a class="ae jx" href="https://cloud.google.com/secret-manager" rel="noopener ugc nofollow" target="_blank"> Secret Manager </a>是一个安全便捷的存储系统，用于存储API密钥、密码、证书和其他敏感数据。Secret Manager提供了一个集中的地方和单一的真实来源来管理、访问和审计Google Cloud或其他任何地方的秘密。</p></blockquote><p id="1262" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是谷歌的一个相对较新的功能(截至2020年5月)，旨在弥合围绕GCP生态系统已经存在了相当长一段时间的差距。事实上，我们在这里的部署提供了一个很好的用例:</p><blockquote class="lb lc ld"><p id="5878" class="iq ir le is b it iu iv iw ix iy iz ja lf jc jd je lg jg jh ji lh jk jl jm jn hb bi translated"><strong class="is hj">您如何轻松管理凭证、密码、秘密、api密钥和其他敏感数据，同时将您的应用托管在具有CI/CD管道的公共存储库(又名GitHub)上，这需要成功构建敏感数据？</strong></p></blockquote><p id="8f53" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇<a class="ae jx" rel="noopener" href="/@kioi/gcp-secret-manager-c043e73679d5"> <strong class="is hj">文章</strong> </a>中我会多谈一点秘密经理人。</p><h1 id="3d79" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">云构建</h1><p id="70d3" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">云构建是一项在谷歌云平台基础设施上执行构建的服务。Cloud Build可以从云存储、云资源存储库、GitHub或Bitbucket导入源代码，根据您的规范执行构建，并生成Docker容器或Java归档等工件。</p><h1 id="5c50" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">开源代码库</h1><p id="e549" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">还需要我多说吗？</p><p id="039b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">先决条件</strong>T12】1。在<a class="ae jx" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云平台控制台</a>中创建一个项目。<br/> 2。为您的项目启用计费。<br/> 3。安装<a class="ae jx" href="https://github.com/GoogleCloudPlatform/community/blob/master/sdk" rel="noopener ugc nofollow" target="_blank">谷歌云SDK </a>。<br/> 4。安装maven <br/> 5。创建GitHub帐户</p><h1 id="35bb" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">入门指南</h1><p id="6299" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">1.首先初始化云SDK，创建一个App Engine应用程序，并授权云SDK在您的本地环境中使用GCP API:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="7297" class="lr jz hi ln b fi ls lt l lu lv">gcloud init<br/>gcloud app create<br/>gcloud auth application-default login</span></pre><h1 id="3dbf" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">设置云SQL</h1><p id="63b5" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">1.启用<a class="ae jx" href="https://console.cloud.google.com/flows/enableapi?apiid=sqladmin&amp;_ga=2.97716831.1749283848.1589680102-1322801348.1576371208&amp;_gac=1.250162036.1587192241.CjwKCAjwp-X0BRAFEiwAheRui4GkVAiJEcD-d_dhMaMnTeAmRAMMUBXLV45atuLUiiLinEjPGLLbuhoCzD8QAvD_BwE" rel="noopener ugc nofollow" target="_blank">云SQL API </a>。<br/> 2。按照这些说明创建一个云SQL (MySQL)实例并设置root用户密码<a class="ae jx" href="https://cloud.google.com/sql/docs/mysql/create-instance#create-2nd-gen" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="c821" class="lr jz hi ln b fi ls lt l lu lv">gcloud sql instances create test-instance-inventory-management --tier=db-n1-standard-1 --region=us-central1</span></pre><p id="4061" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.为“root @ %”MySQL用户设置密码</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="a7a3" class="lr jz hi ln b fi ls lt l lu lv">gcloud sql users set-password root --host=% --instance test-instance-inventory-management --password [PASSWORD]</span></pre><p id="fec7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="le">确保用自己的密码</em> </strong>替换  <code class="du lw lx ly ln b"><strong class="is hj"><em class="le">[PASSWORD]</em></strong></code> <strong class="is hj"> <em class="le"/></strong></p><p id="5aee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.设置<code class="du lw lx ly ln b">inventory</code>数据库。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="c2be" class="lr jz hi ln b fi ls lt l lu lv">gcloud sql databases create inventory --instance=test-instance-inventory-management</span></pre><p id="75ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.获取实例的<code class="du lw lx ly ln b">connectionName</code>，格式为<code class="du lw lx ly ln b">project-id:zone-id:instance-id</code>:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="bd52" class="lr jz hi ln b fi ls lt l lu lv">gcloud sql instances describe test-instance-inventory-management | grep connectionName</span></pre><p id="a999" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们测试一下我们的云Sql数据库，看看我们是否能够使用这个数据库。我们将从克隆项目和本地测试开始</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="1a4c" class="lr jz hi ln b fi ls lt l lu lv">git clone <a class="ae jx" href="https://github.com/kioie/InventoryManagement.git" rel="noopener ugc nofollow" target="_blank">https://github.com/kioie/InventoryManagement.git</a><br/>cd InventoryManagement/</span></pre><p id="45d6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将快速更新我们的<code class="du lw lx ly ln b">application-mysql.properties</code>文件。我们将替换实例连接名称、数据库名称、用户名和密码。<br/></p><p id="e5d6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更新<code class="du lw lx ly ln b">src/main/resources/application-mysql.properties</code>:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="8718" class="lr jz hi ln b fi ls lt l lu lv">#CLOUD-SQL-CONFIGURATIONS<br/>spring.cloud.appId=sample-gcp-project<br/>spring.cloud.gcp.sql.instance-connection-name=sample-gcp-project-277704:us-central1:test-instance-inventory-management<br/>spring.cloud.gcp.sql.database-name=inventory<br/>##SQL DB USERNAME/PASSWORD<br/>spring.datasource.username=root<br/>spring.datasource.password=xxxxx</span></pre><p id="2305" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="le">注:用预配置的数据库实例口令</em> </strong> <br/> <br/>替换“xxxxx ”,启动Spring Boot应用程序</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="993e" class="lr jz hi ln b fi ls lt l lu lv">mvn spring-boot:run</span></pre><p id="d64e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">测试应用程序</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="117c" class="lr jz hi ln b fi ls lt l lu lv">curl <a class="ae jx" href="http://localhost:8080/inventory/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/inventory/</a></span></pre><h1 id="ef9f" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">设置机密管理器</h1><ol class=""><li id="dcdb" class="lz ma hi is b it kw ix kx jb mb jf mc jj md jn me mf mg mh bi translated">启用<a class="ae jx" href="https://console.cloud.google.com/flows/enableapi?apiid=secretmanager.googleapis.com&amp;redirect=https://console.cloud.google.com&amp;_ga=2.72503123.1749283848.1589680102-1322801348.1576371208&amp;_gac=1.225110888.1587192241.CjwKCAjwp-X0BRAFEiwAheRui4GkVAiJEcD-d_dhMaMnTeAmRAMMUBXLV45atuLUiiLinEjPGLLbuhoCzD8QAvD_BwE" rel="noopener ugc nofollow" target="_blank">秘密管理器API </a></li></ol><p id="cbf2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">您需要授予应用程序访问权限</strong><br/>——进入<a class="ae jx" href="https://console.cloud.google.com/iam-admin/iam?_ga=2.101936833.1749283848.1589680102-1322801348.1576371208&amp;_gac=1.224978664.1587192241.CjwKCAjwp-X0BRAFEiwAheRui4GkVAiJEcD-d_dhMaMnTeAmRAMMUBXLV45atuLUiiLinEjPGLLbuhoCzD8QAvD_BwE" rel="noopener ugc nofollow" target="_blank"> IAM &amp;管理页面</a><br/>——点击页面顶部的<code class="du lw lx ly ln b"><strong class="is hj">Project selector</strong></code>下拉列表。<br/> -在出现的<code class="du lw lx ly ln b"><strong class="is hj">Select from</strong></code>对话框中，选择您想要启用Secret Manager的组织。<br/> -在<code class="du lw lx ly ln b"><strong class="is hj">IAM</strong></code>页面中，点击<code class="du lw lx ly ln b">app engine service account</code>旁边的<code class="du lw lx ly ln b"><strong class="is hj">Edit</strong></code>。<br/> -在出现的<code class="du lw lx ly ln b"><strong class="is hj">Edit permissions</strong></code>面板上，添加必要的角色。<br/> -点击<code class="du lw lx ly ln b"><strong class="is hj">Add another role</strong></code>。选择<code class="du lw lx ly ln b"><strong class="is hj">Secret Manager Admin</strong></code>。<br/> -添加完角色后，点击<code class="du lw lx ly ln b"><strong class="is hj">Save.</strong></code> <br/> <br/> 2。为我们的数据源配置文件创建新的秘密。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="c4ce" class="lr jz hi ln b fi ls lt l lu lv"><br/>echo -n “sample-gcp-project-277704:us-central1:test-instance-inventory-management” | gcloud secrets create spring_cloud_gcp_sql_instance_connection_name — replication-policy=”automatic” — data-file=-<br/> <br/>echo -n “inventory” | gcloud secrets create spring_cloud_gcp_sql_database_name — replication-policy=”automatic” — data-file=-<br/> <br/>echo -n “root” | gcloud secrets create spring_datasource_username — replication-policy=”automatic” — data-file=-<br/> <br/>echo -n “test123” | gcloud secrets create spring_datasource_password — replication-policy=”automatic” — data-file=-</span></pre><p id="3af4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="le">注:记住在这里使用你自己的凭证进行</em> </strong> <code class="du lw lx ly ln b"><strong class="is hj"><em class="le">spring_cloud_gcp_sql_instance_connection_name</em></strong></code> <strong class="is hj"> <em class="le">和</em> </strong> <code class="du lw lx ly ln b"><strong class="is hj"><em class="le">spring_datasource_password</em></strong></code> <br/> <br/>确认你的秘密已经被运行<code class="du lw lx ly ln b">gcloud secrets list</code>创建</p><p id="35e1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.我们现在用机密url替换<code class="du lw lx ly ln b">application-mysql.properties</code>文件中的值。对于这一步，您将需要GCP上定义的机密的全限定名称。</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="9e7b" class="lr jz hi ln b fi ls lt l lu lv">gcloud secrets describe spring_cloud_gcp_sql_instance_connection_name | grep name<br/> <br/>gcloud secrets describe spring_cloud_gcp_sql_database_name | grep name</span><span id="cdb8" class="lr jz hi ln b fi mi lt l lu lv">gcloud secrets describe spring_datasource_username | grep name</span><span id="f6e0" class="lr jz hi ln b fi mi lt l lu lv">gcloud secrets describe spring_datasource_password | grep name</span></pre><p id="aad7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在将使用这些名称来创建一个secret manager url。url将使用格式<code class="du lw lx ly ln b">${sm://FULLY-QUALIFIED-NAME}</code>，其中<code class="du lw lx ly ln b">FULLY-QUALIFIED-NAME</code>与上面检索的一样。</p><p id="c3d4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以我们更新<code class="du lw lx ly ln b">src/main/resources/application-mysql.properties:</code></p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="ee0a" class="lr jz hi ln b fi ls lt l lu lv">#CLOUD-SQL-CONFIGURATIONS<br/>spring.cloud.appId=sample-gcp-project<br/>spring.cloud.gcp.sql.instance-connection-name=${sm://projects/.../secrets/spring_cloud_gcp_sql_instance_connection_name}<br/>spring.cloud.gcp.sql.database-name=${sm://projects/.../secrets/spring_cloud_gcp_sql_database_name}<br/>##SQL DB USERNAME/PASSWORD<br/>spring.datasource.username=${sm://projects/.../secrets/spring_datasource_username}<br/>spring.datasource.password=${sm://projects/.../secrets/spring_datasource_password}</span></pre><p id="b7a6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重启Spring Boot应用程序:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="49cf" class="lr jz hi ln b fi ls lt l lu lv">mvn spring-boot:run</span></pre><p id="0561" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">测试您的应用:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="16b9" class="lr jz hi ln b fi ls lt l lu lv">curl <a class="ae jx" href="http://localhost:8080/inventory/1" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/inventory/1</a></span></pre><h1 id="e410" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">用源文件设置GitHub存储库</h1><ol class=""><li id="42a8" class="lz ma hi is b it kw ix kx jb mb jf mc jj md jn me mf mg mh bi translated">如果你还没有一个GitHub帐号，创建一个。</li><li id="af34" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn me mf mg mh bi translated">在目标云项目中启用<a class="ae jx" href="https://console.cloud.google.com/flows/enableapi?apiid=cloudbuild.googleapis.com" rel="noopener ugc nofollow" target="_blank">云构建API </a>。</li><li id="41d9" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn me mf mg mh bi translated">继续之前，请派生此存储库。这一步很重要，因为您将把您的更改推送到此回购<br/> a .导航到<a class="ae jx" href="https://github.com/kioie/InventoryManagement" rel="noopener ugc nofollow" target="_blank">https://github.com/kioie/InventoryManagement</a><br/>b .在页面的右上角，单击<code class="du lw lx ly ln b"><strong class="is hj">Fork</strong></code>。</li></ol><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/6970bd838cf0a36127a2f57fe735d5c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LARCB6o6eGjFHm6--AsWMw.png"/></div></div><figcaption class="mp mq et er es mr ms bd b be z dx translated">分叉项目</figcaption></figure><p id="ee4f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.在Github上安装Google Cloud Build应用。您可以按照此处的<a class="ae jx" href="https://cloud.google.com/cloud-build/docs/automating-builds/run-builds-on-github#installing_the_google_cloud_build_app" rel="noopener ugc nofollow" target="_blank"><strong class="is hj"/></a>指令进行操作。</p><p id="5bf6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="le">确保您选择了</em> </strong> <code class="du lw lx ly ln b"><strong class="is hj"><em class="le">kioie/InventoryManagement</em></strong></code> <strong class="is hj"> <em class="le">库叉作为您要连接的库，否则这个构建将无法工作。</em> </strong></p><p id="fdbe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.在谷歌云控制台中，打开云构建<a class="ae jx" href="https://console.cloud.google.com/cloud-build/triggers?_ga=2.173763299.1749283848.1589680102-1322801348.1576371208&amp;_gac=1.259777016.1587192241.CjwKCAjwp-X0BRAFEiwAheRui4GkVAiJEcD-d_dhMaMnTeAmRAMMUBXLV45atuLUiiLinEjPGLLbuhoCzD8QAvD_BwE" rel="noopener ugc nofollow" target="_blank">构建触发器</a>页面。</p><p id="725d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="le">在进入下一步之前，确保删除所有创建的、可能与该项目相关的触发器。</em> </strong></p><p id="9993" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">6.选择您的Google Cloud项目并点击<code class="du lw lx ly ln b"><strong class="is hj">Open</strong></code>。</p><p id="83c9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">7.点击<code class="du lw lx ly ln b"><strong class="is hj">Create Trigger</strong></code>。</p><p id="4f1a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">8.填写选项</p><ul class=""><li id="e096" class="lz ma hi is b it iu ix iy jb mt jf mu jj mv jn mw mf mg mh bi translated"><em class="le">必选</em>。在<code class="du lw lx ly ln b"><strong class="is hj">Name</strong></code>字段中，输入名称</li><li id="d4db" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn mw mf mg mh bi translated"><em class="le">可选</em>。在<code class="du lw lx ly ln b"><strong class="is hj">Description</strong></code>字段中，输入触发器工作方式的简要描述</li><li id="5912" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn mw mf mg mh bi translated">在<code class="du lw lx ly ln b"><strong class="is hj">Event</strong></code>下，选择<code class="du lw lx ly ln b"><strong class="is hj">Push to a branch</strong></code></li><li id="c14c" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn mw mf mg mh bi translated">在<code class="du lw lx ly ln b"><strong class="is hj">Source</strong></code>下拉列表中选择<code class="du lw lx ly ln b">kioie/InventoryManagement</code>仓库<br/> <strong class="is hj"> <em class="le">注意:如果该仓库没有出现，点击</em> </strong> <code class="du lw lx ly ln b"><strong class="is hj"><em class="le">Connect New Repository</em></strong></code> <strong class="is hj"> <em class="le">按钮，在GitHub上连接您的回购，然后返回步骤5。</em> </strong></li><li id="88bd" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn mw mf mg mh bi translated">在<code class="du lw lx ly ln b"><strong class="is hj">Branch</strong></code>下，输入<code class="du lw lx ly ln b">^master$</code></li><li id="0f90" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn mw mf mg mh bi translated">在<code class="du lw lx ly ln b"><strong class="is hj">Build Configuration </strong></code>下选择<code class="du lw lx ly ln b"><strong class="is hj">Cloud Build configuration file (YAML or JSON)</strong></code> <br/>为<code class="du lw lx ly ln b">Cloud Build configuration file location</code>输入<code class="du lw lx ly ln b">cloudbuild.yaml</code> <br/> <strong class="is hj"> <em class="le">注意:不要多加一个</em> </strong> <code class="du lw lx ly ln b"><strong class="is hj"><em class="le">/</em></strong></code></li><li id="1403" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn mw mf mg mh bi translated">点击<code class="du lw lx ly ln b"><strong class="is hj">create</strong></code></li></ul><p id="403d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">9.在您的活动触发器下，您应该能够看到您新创建的触发器。</p><h1 id="3cbc" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated"><strong class="ak">一些简要信息</strong></h1><p id="476a" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">作为Google Cloud Build应用程序的一个要求，您的存储库必须包含一个<code class="du lw lx ly ln b"><a class="ae jx" href="https://docs.docker.com/get-started/part2/#define-a-container-with-dockerfile" rel="noopener ugc nofollow" target="_blank">Dockerfile</a></code>或<code class="du lw lx ly ln b"><a class="ae jx" href="https://cloud.google.com/cloud-build/docs/build-config" rel="noopener ugc nofollow" target="_blank">cloudbuild.yaml</a></code>文件才能成功配置您的构建。</p><p id="f9e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lw lx ly ln b">Dockerfile</code>一般用于建造码头集装箱。如果您使用云构建Docker构建，您将需要一个<code class="du lw lx ly ln b">Dockerfile</code>。本教程针对应用引擎构建，但是您会注意到样例repo包含一个<code class="du lw lx ly ln b">Dockerfile</code>。这是因为云构建包含一个额外的步骤，该步骤通过创建一个容器工件来完成，尽管这对于本教程来说不是必需的。</p><p id="3a71" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du lw lx ly ln b">cloudbuild.yaml</code>是云构建的配置文件。您可以在以下场景中使用<code class="du lw lx ly ln b">cloudbuild.yaml </code>:</p><ul class=""><li id="cd79" class="lz ma hi is b it iu ix iy jb mt jf mu jj mv jn mw mf mg mh bi translated">对非Docker构建使用云构建应用程序时。</li><li id="8306" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn mw mf mg mh bi translated">如果你想微调你的Docker构建，你可以提供一个除了<code class="du lw lx ly ln b">Dockerfile</code>之外的<code class="du lw lx ly ln b">cloudbuild.yaml</code>。如果您的存储库包含一个<code class="du lw lx ly ln b">Dockerfile</code>和一个<code class="du lw lx ly ln b">cloudbuild.yaml</code>，Google Cloud Build应用程序将使用<code class="du lw lx ly ln b">cloudbuild.yaml</code>来配置构建。</li></ul><h1 id="d423" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">设置应用引擎</h1><p id="48e7" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn hb bi translated">我们将需要我们的部署应用程序引擎。最后，我们的应用程序将在<a class="ae jx" href="https://YOUR_PROJECT_ID.appspot.com" rel="noopener ugc nofollow" target="_blank">https://YOUR _ PROJECT _ id . appspot . com</a>上部署和访问</p><ol class=""><li id="5567" class="lz ma hi is b it iu ix iy jb mt jf mu jj mv jn me mf mg mh bi translated"><code class="du lw lx ly ln b">pom.xml</code>已经包含了<code class="du lw lx ly ln b">projectId</code>和<code class="du lw lx ly ln b">version</code>的配置。我们将对此进行更改，以反映当前的项目ID。<br/> <code class="du lw lx ly ln b">&lt;deploy.projectId&gt;sample-gcp-project-276208&lt;/deploy.projectId&gt;</code></li><li id="7b95" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn me mf mg mh bi translated">启用<a class="ae jx" href="https://console.developers.google.com/apis/library/appengine.googleapis.com" rel="noopener ugc nofollow" target="_blank">应用引擎管理API </a></li><li id="10bd" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn me mf mg mh bi translated">启用<a class="ae jx" href="https://console.developers.google.com/apis/library/appengineflex.googleapis.com" rel="noopener ugc nofollow" target="_blank"> App引擎灵活API </a></li><li id="07e5" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn me mf mg mh bi translated">我们需要给云构建服务帐户更多的权限</li></ol><p id="cb93" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">您需要授予cloudbuild服务帐户、Secret Manager的管理员访问权限、应用引擎和云Sql </strong>。</p><ul class=""><li id="7bfc" class="lz ma hi is b it iu ix iy jb mt jf mu jj mv jn mw mf mg mh bi translated">转到<a class="ae jx" href="https://console.cloud.google.com/iam-admin/iam?_ga=2.101936833.1749283848.1589680102-1322801348.1576371208&amp;_gac=1.224978664.1587192241.CjwKCAjwp-X0BRAFEiwAheRui4GkVAiJEcD-d_dhMaMnTeAmRAMMUBXLV45atuLUiiLinEjPGLLbuhoCzD8QAvD_BwE" rel="noopener ugc nofollow" target="_blank"> IAM &amp;管理页面</a></li><li id="f500" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn mw mf mg mh bi translated">点击页面顶部的<code class="du lw lx ly ln b"><strong class="is hj">Project selector</strong></code>下拉列表，选择当前项目组织。</li><li id="25dc" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn mw mf mg mh bi translated">在<strong class="is hj"> IAM </strong>页面上，在<code class="du lw lx ly ln b">cloud build service account</code>旁边，(不要与<code class="du lw lx ly ln b">cloud build service agent</code>混淆)点击<code class="du lw lx ly ln b"><strong class="is hj">Edit</strong></code>(或铅笔按钮)。</li><li id="010c" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn mw mf mg mh bi translated">在出现的<code class="du lw lx ly ln b"><strong class="is hj">Edit permissions panel </strong></code>上，添加必要的角色。</li><li id="90fb" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn mw mf mg mh bi translated">点击<code class="du lw lx ly ln b"><strong class="is hj">Add another role</strong></code>。并添加特定的角色。<br/>我们将增加3个角色:<br/> —应用引擎管理员<br/> —云SQL管理员<br/> —秘密管理员管理员</li><li id="d639" class="lz ma hi is b it mj ix mk jb ml jf mm jj mn jn mw mf mg mh bi translated">添加完角色后，点击<code class="du lw lx ly ln b"><strong class="is hj">Save</strong></code>。</li></ul><p id="24bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最终的权限列表应该如下所示</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/f62cace43e998c17daa0a40cc0b6a7d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7Lxe_2as7FViJ90pcn0H6w.png"/></div></div><figcaption class="mp mq et er es mr ms bd b be z dx translated">权限列表</figcaption></figure><p id="f7d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在进入触发云构建的最后一步。我们将把更新后的代码推送到GitHub。</p><h1 id="b9d1" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">按下GitHub并触发构建</h1><ol class=""><li id="1936" class="lz ma hi is b it kw ix kx jb mb jf mc jj md jn me mf mg mh bi translated">添加您的远程GitHub fork repo作为您的上游repo</li></ol><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="5486" class="lr jz hi ln b fi ls lt l lu lv">git remote add upstream <a class="ae jx" href="https://github.com/YOUR_ACCOUNT_NAME/InventoryManagement" rel="noopener ugc nofollow" target="_blank">https://github.com/YOUR_ACCOUNT_NAME/InventoryManagement</a><br/>git remote -vv</span></pre><p id="1d2f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.提交您的更改</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="974d" class="lr jz hi ln b fi ls lt l lu lv">git add .<br/>git commit</span></pre><p id="f526" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.向上游推进</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="ee67" class="lr jz hi ln b fi ls lt l lu lv">git push upstream master</span></pre><p id="2cc3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.这应该会自动触发您在GCP云上的构建。您可以使用下面的命令检查您的构建状态</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="fa97" class="lr jz hi ln b fi ls lt l lu lv">gcloud builds list</span></pre><p id="af36" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.希望您的构建以成功的结果完成，如果是这样，您可以用命令获取应用程序的url</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="8781" class="lr jz hi ln b fi ls lt l lu lv">gcloud app browse</span></pre><p id="971e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">6.我们现在可以测试我们的端点</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="887a" class="lr jz hi ln b fi ls lt l lu lv">curl <a class="ae jx" href="https://sample-gcp-project-277704.uc.r.appspot.com/inventory" rel="noopener ugc nofollow" target="_blank">https://sample-gcp-project-277704.uc.r.appspot.com/inventory</a><br/>curl <a class="ae jx" href="https://sample-gcp-project-277704.uc.r.appspot.com/inventory/1" rel="noopener ugc nofollow" target="_blank">https://sample-gcp-project-277704.uc.r.appspot.com/inventory/1</a><br/>curl <a class="ae jx" href="https://sample-gcp-project-277704.uc.r.appspot.com/inventory/2" rel="noopener ugc nofollow" target="_blank">https://sample-gcp-project-277704.uc.r.appspot.com/inventory/2</a></span></pre><p id="3d27" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果一切顺利，你现在有一个运行在GCP应用引擎上的应用，使用云构建部署，托管在GitHub上，并使用秘密管理器来维护你的秘密。</p></div></div>    
</body>
</html>