<html>
<head>
<title>Google Cloud Anthos Series -Anthos Multi-cluster Ingress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云Anthos系列-Anthos多集群入口</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-cloud-anthos-series-part6-bbb70e2f9979?source=collection_archive---------0-----------------------#2022-03-09">https://medium.com/google-cloud/google-cloud-anthos-series-part6-bbb70e2f9979?source=collection_archive---------0-----------------------#2022-03-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="1973" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated"><strong class="ak">谷歌云Anthos系列:第六部</strong></h2></div><p id="398d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated"><span class="l ju jv jw bm jx jy jz ka kb di"> W </span>欢迎来到“谷歌云Anthos系列”的第6部分。你可以找到完整的系列<a class="ae kc" rel="noopener" href="/google-cloud/google-cloud-anthos-series-23b9a35e9179">她的</a> e</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es kd"><img src="../Images/9cb7b580f0d0cc602b403a8a0101c6ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V_MJn4dD8GWH4TPvXTryzQ.png"/></div></div></figure><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es kp"><img src="../Images/708a68529f4f89cf4815b44d78b2894a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*prYfmxbUPBPZeAj7E3dyMA.png"/></div></div></figure><p id="76c2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Multi Cluster Ingress是Google托管的服务，帮助客户通过部署在多个云区域的集群来构建弹性Anthos架构。除了弹性之外，它还有助于将流量重定向到最近的集群，以确保最低的延迟和一致的用户体验。在包装之下，该服务通过外部HTTP(s)负载平衡服务利用<a class="ae kc" href="https://cloud.google.com/docs/security/infrastructure/design#google_front_end_service" rel="noopener ugc nofollow" target="_blank"> Google前端(GFEs) </a>。任何传入的请求都由GFEs路由到离客户端最近的GKE集群。当存在工作负载或数据驻留的区域隔离等要求时，组织还可以选择具有多集群入口的多集群体系结构</p><h2 id="be65" class="kq kr hi bd ks kt ku kv kw kx ky kz la jg lb lc ld jk le lf lg jo lh li lj lk bi translated"><strong class="ak">多集群入口架构组件</strong></h2><p id="0776" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">下面简要列出了多集群入口体系结构组件及其功能</p><p id="1052" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">多集群入口控制器(Anthos入口控制器)</strong></p><ul class=""><li id="b750" class="lq lr hi iz b ja jb jd je jg ls jk lt jo lu js lv lw lx ly bi translated">指成员集群之外的控制平面</li><li id="b57a" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">通过创建后端网络端点组(neg ),利用GCP的外部负载平衡器</li><li id="d317" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">LB的后端端点动态跟踪pod端点</li><li id="8940" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">跟踪集群中的pod，并确保负载平衡器了解集群中的更新</li></ul><p id="a351" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">配置集群</strong></p><ul class=""><li id="574e" class="lq lr hi iz b ja jb jd je jg ls jk lt jo lu js lv lw lx ly bi translated">用于部署多集群入口操作所需的名为<em class="me">multiclustergress</em>和<em class="me"> MultiClusterService </em>的自定义资源类型</li><li id="e887" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">一个GKE集群被指定为集中管理多集群入口资源的控制平面</li><li id="ebc0" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated"><em class="me">MultiClusterService(MCS)</em>表示跨不同集群部署的服务，将由负载均衡器公开。</li><li id="d236" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated"><em class="me">MultiClusterIngress(MCI)</em>类似于k8s集群中的入口资源，它定义了向MCS发送匹配流量的后端、路径、协议等</li></ul><p id="6fbf" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">舰队</strong></p><ul class=""><li id="402f" class="lq lr hi iz b ja jb jd je jg ls jk lt jo lu js lv lw lx ly bi translated">以前称为environ</li><li id="f1b0" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">将多个群集组合在一起，作为多群集入口的后端</li><li id="aaaa" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">支持“命名空间一致性”，即多个集群中具有相同名称和相同命名空间的资源被分组为单个工作负载</li></ul><p id="f59e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">成员集群</strong></p><ul class=""><li id="03bf" class="lq lr hi iz b ja jb jd je jg ls jk lt jo lu js lv lw lx ly bi translated">指GKE集群注册地一支舰队</li><li id="4916" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">托管多集群入口将流量重定向到的工作负载</li><li id="4eda" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">默认情况下，MCS向所有后端集群发送流量，但这可以在MCS配置yaml中定制，以针对特定集群</li></ul><p id="96b0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">多个GKE集群的多集群入口的高级架构如下所示:</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es mf"><img src="../Images/0fc75e1dc09ab59f1430d37eef3d07ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D595HAu-M6JNTYaX4VBHBA.png"/></div></div><figcaption class="mg mh et er es mi mj bd b be z dx translated">参考:谷歌云多集群入口<a class="ae kc" href="https://cloud.google.com/kubernetes-engine/docs/concepts/multi-cluster-ingress" rel="noopener ugc nofollow" target="_blank">文档</a></figcaption></figure><h2 id="3d17" class="kq kr hi bd ks kt ku kv kw kx ky kz la jg lb lc ld jk le lf lg jo lh li lj lk bi translated">多集群入口部署</h2><p id="5895" class="pw-post-body-paragraph ix iy hi iz b ja ll ij jc jd lm im jf jg ln ji jj jk lo jm jn jo lp jq jr js hb bi translated">在我们开始部署之前，先说一下定价。虽然GKE集群仅使用多集群入口服务，但客户可以选择独立定价。仅当Anthos API被禁用时，此定价才适用。如果启用了Anthos API，并且您也在使用Anthos的其他功能，那么计费将取决于集群vCPUs和<a class="ae kc" href="https://cloud.google.com/anthos/pricing#pricing_table" rel="noopener ugc nofollow" target="_blank"> Anthos定价</a>。对于此次部署，我们将使用Anthos定价和我们在之前的<a class="ae kc" rel="noopener" href="/google-cloud/google-cloud-devops-part-1-introduction-to-google-native-devops-process-bfb55be9e3f3"> Google Cloud Devops博客系列</a>中使用的在线精品应用程序</p><p id="237d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意:要了解更多关于Anthos定价的信息，你可以参考这个博客系列的第3部分</p><p id="501b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">部署注意事项</p><ul class=""><li id="604c" class="lq lr hi iz b ja jb jd je jg ls jk lt jo lu js lv lw lx ly bi translated">部署多集群入口的步骤需要GCP项目的GKE管理员权限，因为它需要提升权限</li><li id="59e0" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">建议对集群使用<a class="ae kc" href="https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity" rel="noopener ugc nofollow" target="_blank">工作负载标识</a>，以便在访问其他GCP资源时对集群中的工作负载进行无缝认证</li></ul><p id="1882" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下图显示了Samajik使用多集群入口的最终状态架构</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es mk"><img src="../Images/93cc995688b072e281e16976f7ab9a21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sdb1b_taI6QeEO33XcsFfA.png"/></div></div></figure><p id="3e46" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面给出了从云外壳逐步部署多集群入口的步骤。将代码中以粗体标记的变量替换为特定于您的环境的值，如项目id、集群名称、GCP地区等</p><ol class=""><li id="75e1" class="lq lr hi iz b ja jb jd je jg ls jk lt jo lu js ml lw lx ly bi translated">启用部署所需的API。应该运行下面的命令来使用Anthos定价</li></ol><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="80ea" class="kq kr hi mn b fi mr ms l mt mu">gcloud services enable \<br/>    anthos.googleapis.com \<br/>    multiclusteringress.googleapis.com \<br/>    gkehub.googleapis.com \<br/>    container.googleapis.com \<br/>    --project=<strong class="mn hj">&lt;&lt;Your-project-id&gt;&gt;</strong></span></pre><p id="4006" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.部署启用了工作负载标识的集群。这里，我们在三个不同的区域部署了三个集群，分别名为集群1、集群2和集群3</p><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="5bba" class="kq kr hi mn b fi mr ms l mt mu">gcloud container clusters create cluster1 \<br/>    --zone=us-central1-b \<br/>    --enable-ip-alias \<br/>    --workload-pool=<strong class="mn hj">&lt;&lt;Your-project-id&gt;&gt;</strong>.svc.id.goog \<br/>    --release-channel=stable \<br/>    --project=<strong class="mn hj">&lt;&lt;Your-project-id&gt;&gt;</strong></span><span id="01ee" class="kq kr hi mn b fi mv ms l mt mu">gcloud container clusters create cluster2 \<br/>    --zone=europe-west1-b \<br/>    --enable-ip-alias \<br/>    --workload-pool=<strong class="mn hj">&lt;&lt;Your-project-id&gt;&gt;</strong>.svc.id.goog \<br/>    --release-channel=stable \<br/>    --project=<strong class="mn hj">&lt;&lt;Your-project-id&gt;&gt;</strong></span><span id="4074" class="kq kr hi mn b fi mv ms l mt mu">gcloud container clusters create cluster3 \<br/>    --zone=asia-east1-b \<br/>    --enable-ip-alias \<br/>    --workload-pool=<strong class="mn hj">&lt;&lt;Your-project-id&gt;&gt;</strong>.svc.id.goog \<br/>    --release-channel=stable \<br/>    --project=<strong class="mn hj">&lt;&lt;Your-project-id&gt;&gt;</strong></span></pre><p id="91f2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.检索集群的凭据，并对其进行重命名，以便于使用。替换集群名称后，对所有三个集群重复以下步骤</p><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="21ad" class="kq kr hi mn b fi mr ms l mt mu">gcloud container clusters get-credentials cluster1 \<br/>    --zone=us-central1-b \<br/>    --project=<strong class="mn hj"><em class="me">&lt;&lt;Your-project-id&gt;&gt;</em></strong></span><span id="1a22" class="kq kr hi mn b fi mv ms l mt mu">kubectl config rename-context gke_<strong class="mn hj"><em class="me">&lt;&lt;Your-project-id&gt;&gt;</em></strong>_us-central1-b_g<em class="me">cluster1</em> <em class="me">cluster1</em></span></pre><p id="67f7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">4.使用工作负载身份向机群添加集群。替换集群名称后，对所有三个集群重复以下命令</p><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="4025" class="kq kr hi mn b fi mr ms l mt mu">gcloud container hub memberships register cluster1 \<br/>    --gke-cluster us-central1-b/cluster1 \<br/>    --enable-workload-identity \<br/>    --project=<strong class="mn hj"><em class="me">&lt;&lt;Your-project-id&gt;&gt;</em></strong></span></pre><p id="b12b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">5.使用以下命令确认舰队成员</p><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="e9a4" class="kq kr hi mn b fi mr ms l mt mu">gcloud container hub memberships list --project=<strong class="mn hj"><em class="me">&lt;&lt;Your-project-id&gt;&gt;</em></strong></span></pre><p id="3abe" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">输出将类似于下图</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es mw"><img src="../Images/4dc4d5deb7a9a7a8a4124ba43866293d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sbfJU01p0DtTWByPMPfW9Q.png"/></div></div></figure><p id="3bdd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">6.将集群1配置为配置集群</p><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="e2bd" class="kq kr hi mn b fi mr ms l mt mu">gcloud beta container hub ingress enable \<br/>  --config-membership=cluster1</span></pre><p id="f11e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">7.使用下面的内容创建一个yaml文件namespace.yaml来定义名称空间</p><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="fe47" class="kq kr hi mn b fi mr ms l mt mu">apiVersion: v1<br/>kind: Namespace<br/>metadata:<br/>  name: mcinamespace</span></pre><p id="8548" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">8.将上下文切换到cluster1并部署namespace.yaml来创建名称空间。对集群2和集群3重复相同的步骤</p><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="5894" class="kq kr hi mn b fi mr ms l mt mu">kubectl config use-context cluster1<br/>kubectl apply -f namespace.yaml</span></pre><p id="ae9f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">9.从GitHub克隆在线精品微服务演示应用程序</p><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="7c41" class="kq kr hi mn b fi mr ms l mt mu">git clone <a class="ae kc" href="https://github.com/GoogleCloudPlatform/microservices-demo.git" rel="noopener ugc nofollow" target="_blank">https://github.com/GoogleCloudPlatform/microservices-demo.git</a><br/>cd microservices-demo/release/</span></pre><p id="593e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">10.编辑kubernetes清单。yaml并删除以下配置负载平衡器入口的代码块。我们稍后将为前端服务配置多集群入口</p><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="b77e" class="kq kr hi mn b fi mr ms l mt mu"><br/> — -<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/> name: frontend-external<br/>spec:<br/> type: LoadBalancer<br/> selector:<br/> app: frontend<br/> ports:<br/> — name: http<br/> port: 80<br/> targetPort: 8080</span></pre><p id="1a8f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">11.通过切换上下文，在所有三个集群中部署应用程序。以下命令将在集群1中创建部署。对集群2和集群3重复相同的操作</p><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="b483" class="kq kr hi mn b fi mr ms l mt mu">kubectl config use-context cluster1</span><span id="54dc" class="kq kr hi mn b fi mv ms l mt mu">kubectl apply -f kubernetes-manifests.yaml -n mcinamespace</span></pre><p id="fac4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">12.部署成功后，您可以看到门户中列出的每个集群的工作负载</p><p id="809d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意:如果由于资源不足而导致调度单元时出现错误，请启用自动扩展或创建额外的节点池来调度单元。</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es mx"><img src="../Images/2a320b426824763e021ca699301b8363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H9X5oM0F3m3qE9U7km9wiw.png"/></div></div></figure><p id="bc4e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">13.下一步是创建一个可以代表所有三个集群的前端服务的MCS资源。用下面的内容创建一个文件mcs_boutique.yaml。</p><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="a76a" class="kq kr hi mn b fi mr ms l mt mu">apiVersion: networking.gke.io/v1<br/>kind: MultiClusterService<br/>metadata:<br/>  name: boutique-mcs<br/>  namespace: mcinamespace<br/>spec:<br/>  template:<br/>    spec:<br/>      selector:<br/>        app: frontend<br/>      ports:<br/>      - name: web<br/>        protocol: TCP<br/>        port: 8080<br/>        targetPort: 8080</span></pre><p id="a008" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">14.仅在配置集群ie集群1中运行以下命令来创建MCS</p><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="7b07" class="kq kr hi mn b fi mr ms l mt mu">kubectl config use-context cluster1</span><span id="1503" class="kq kr hi mn b fi mv ms l mt mu">kubectl apply -f mcs_boutique.yaml</span></pre><p id="cf8a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">15.在切换上下文之后，在其他集群中运行下面的命令，您可以看到在所有具有标签为<em class="me"> app:mcinamespace </em>的集群中创建了一个关联的headless服务</p><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="1a79" class="kq kr hi mn b fi mr ms l mt mu">kubectl config use-context cluster2<br/>kubectl get service -n mcinamespace</span></pre><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es my"><img src="../Images/6860ee97352d96f77fda6a332698ad8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8wwLUMBOZ3Qvu3pglDwldw.png"/></div></div></figure><p id="44e9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">16.使用下面的内容创建一个文件mci_boutique.yaml。它将用于创建MCI服务</p><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="1313" class="kq kr hi mn b fi mr ms l mt mu">apiVersion: networking.gke.io/v1<br/>kind: MultiClusterIngress<br/>metadata:<br/>  name: mci-ingress<br/>  namespace: mcinamespace<br/>spec:<br/>  template:<br/>    spec:<br/>      backend:<br/>        serviceName: boutique-mcs<br/>        servicePort: 8080</span></pre><p id="ab53" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">17.仅在配置集群ie cluster 1中运行以下命令来创建MCI</p><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="cec9" class="kq kr hi mn b fi mr ms l mt mu">kubectl config use-context cluster1<br/>kubectl apply -f mci_boutique.yaml</span></pre><p id="a7b3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">18.使用以下命令检查MCI服务的状态。您应该看到为该服务创建了一个VIP</p><pre class="ke kf kg kh fd mm mn mo mp aw mq bi"><span id="1ae5" class="kq kr hi mn b fi mr ms l mt mu">kubectl describe mci mci-ingress -n mcinamespace</span></pre><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es mz"><img src="../Images/c817dcdcd06e44d35d6ad0edb9272159.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IlK3qD4tChCoCk-6tU0LBA.png"/></div></div></figure><p id="879f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">除了VIP，您还可以看到MCI控制器创建了多个资源，即负载平衡器、后端服务、防火墙规则、转发规则、网络端点组和健康检查。负载平衡器也可以从谷歌云控制台上看到。</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es na"><img src="../Images/811c9c13cab652609749f8148ee7fc67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cKmz2MCRGfb-MnM4owcTmQ.png"/></div></div></figure><p id="e9ef" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">前端IP将与之前显示的VIP相同。您可以看到后端被配置为跨neg分发流量，指向不同区域的三个成员集群</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es nb"><img src="../Images/729afb2abaeaaffc5a57b31dbf82e963.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n2seqmaQe8Yo19CReaB_7g.png"/></div></div></figure><p id="4be6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">19.该网址可通过http://MCI VIP &gt;或http:// <loadbalancer frontendip="">访问</loadbalancer></p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es nc"><img src="../Images/10dfa377b94d8445c147e76e539cf5cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s0fIsEnEX65ES3C8JS3ZGQ.png"/></div></div></figure><p id="525c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">即将到来..</strong></p><p id="695d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">多集群入口解决了Samajik在多个云位置轻松扩展服务的需求。古汉现在更加兴奋地探索Anthos的其他功能，Samajik可以从中受益。请继续关注古汉和拉姆的对话，了解更多信息…</p><p id="9dc2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">供稿人:<a class="nd ne ge" href="https://medium.com/u/c79cc28e2999?source=post_page-----bbb70e2f9979--------------------------------" rel="noopener" target="_blank">普什卡·科塔瓦德</a>，<a class="nd ne ge" href="https://medium.com/u/2d47f7f3f8e2?source=post_page-----bbb70e2f9979--------------------------------" rel="noopener" target="_blank">安其特·尼尚特</a>，<a class="nd ne ge" href="https://medium.com/u/71d9487165c6?source=post_page-----bbb70e2f9979--------------------------------" rel="noopener" target="_blank">丹杜斯</a></p></div></div>    
</body>
</html>