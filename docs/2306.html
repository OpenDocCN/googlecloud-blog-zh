<html>
<head>
<title>Does your apps consume Google Services ? Switch to GCP for cost savings and better performance !!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你的应用程序使用谷歌服务吗？为了节省成本和更好的性能，切换到GCP！！</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/using-google-services-switch-to-gcp-for-cost-savings-and-better-performance-d9b36aeeaa23?source=collection_archive---------0-----------------------#2022-08-17">https://medium.com/google-cloud/using-google-services-switch-to-gcp-for-cost-savings-and-better-performance-d9b36aeeaa23?source=collection_archive---------0-----------------------#2022-08-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bf9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作者:高拉夫·马丹和纳库尔·甘达</p><p id="ad15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">语境</strong></p><p id="170a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当谈到公共云的采用时，一些起决定性作用的因素是您选择的地区的服务可用性、用户体验、成本、操作简易性等。</p><p id="b479" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从技术架构师/设计师的角度来看；我们倾向于专注于卓越的设计，并致力于通过以最佳方式安排云结构来实现所需的功能，以便我们能够为最终客户提供高价值。在进行这种艺术设计时，建筑师倾向于较少强调成本控制/成本优化参数，因为对大多数建筑师来说，卓越的设计在优先列表中占据更高的位置。本博客的目的是展示架构师如何处理复杂的应用程序设计&amp;利用某些众所周知的谷歌服务，可以简单地忽略他们在GCP平台上的网络成本重点，并自动享受每月云支出中减少的网络出口支出。</p><p id="60f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">GCP网络定价简介</strong></p><p id="a9b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们深入了解客户特定的场景之前，让我们了解一下任何客户最终可能支付的网络出口支出的细微差别。</p><p id="2634" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从高层次来看，任何离开GCP资源的流量都可以分类如下</p><ol class=""><li id="ebe5" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><strong class="ih hj">内部流量</strong>:又称骨干流量。这是我们主干网内的流量。示例包括—GCP地区的VM1 1与GCP地区的VM2对话2</li><li id="b400" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><strong class="ih hj">外部流量</strong>:这是离开谷歌网络的流量，通常以最终用户(通常是互联网)为目的地。</li></ol><p id="c8f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们必须将流量类型与GCP的出口定价SKU对应起来，则GCP的出口支出将属于以下四大类别之一-</p><ol class=""><li id="4945" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">Google云中的虚拟机到虚拟机出口定价</li><li id="e9a1" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">虚拟机到谷歌服务定价</li><li id="6b08" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">互联网出口定价—高级层</li><li id="ef16" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">互联网出口定价—标准层</li></ol><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es jr"><img src="../Images/6fc8a9876e746c1a46e692d02522b2de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hiDJPoUAj0GEZMcJTqvzhg.png"/></div></div></figure><p id="a39f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述<strong class="ih hj">类别(B) </strong>的费用基于以下内容定价-</p><ul class=""><li id="4101" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc kd jj jk jl bi translated">给定区域的同一分区中的源和目标虚拟机？</li><li id="0c2b" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc kd jj jk jl bi translated">给定区域不同分区中的源和目标虚拟机？</li><li id="c34e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc kd jj jk jl bi translated">源和目标虚拟机位于不同的区域，但仍然在同一个洲？</li><li id="af57" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc kd jj jk jl bi translated">不同大陆的源和目标虚拟机？</li></ul><p id="fbbe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">标准层[<strong class="ih hj">C类</strong> ]的互联网出口收费基于以下内容-</p><ul class=""><li id="15b8" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc kd jj jk jl bi translated">交通地理定位源(GCP地区)</li><li id="6072" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc kd jj jk jl bi translated">每月使用量</li></ul><p id="a025" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">针对高级等级[<strong class="ih hj">D类</strong> ]互联网出口的收费基于以下内容-</p><ul class=""><li id="17f9" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc kd jj jk jl bi translated">流量的源和目的地地理定位</li><li id="aca8" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc kd jj jk jl bi translated">每月使用量</li></ul><p id="8d18" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇博客的重点是<strong class="ih hj"><em class="ke">A类</em> </strong>(虚拟机到谷歌服务)，我想在这里提出几个要点:</p><ol class=""><li id="44cf" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">如果像VM这样的Google云资源调用像Youtube、drive、maps这样的Google服务；此交易不收取出口费用</li><li id="740e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">如果像虚拟机这样的谷歌云资源调用其所在区域之外的谷歌云服务，则需要付费，这与谷歌云中的虚拟机到虚拟机出口费用相同</li><li id="f8a1" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">使用外部IP地址/内部IP地址在<strong class="ih hj">相同区域</strong>内出口到某个Google云服务也不收取网络出口费用</li><li id="9306" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">有一些服务像Memorystore for Redis，Filestore，Cloud SQL，Google Kubernetes Engine这吸引了外出成本，即使从相同区域内访问也是如此。成本将与Google云中虚拟机到虚拟机出口的成本相同</li></ol><p id="aed5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面可以看到一个简单的视图</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es kf"><img src="../Images/e2e9ea717358289fdfff3d96dc9fc703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Jc4beyh232GVxB5C"/></div></div></figure><p id="4bf3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更详细的价格可在以下网址获得:【https://cloud.google.com/vpc/network-pricing<a class="ae kg" href="https://cloud.google.com/vpc/network-pricing" rel="noopener ugc nofollow" target="_blank"/>。我强烈建议读者花些时间浏览上述网址，以理解其中的细微差别。除此之外，我还强烈建议读者阅读有关网络特定费用的信息，这些费用可能适用于您使用独立服务的情况，如Google cloud storage bucket。例如:除了存储成本、数据处理成本之外，如果从您的GCS存储桶读取数据或在GCS存储桶之间移动数据，还会产生相关的网络成本。</p><p id="e971" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">优化您的数据出口成本—迁移到谷歌云</strong></p><p id="35a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">无论你是在上传大量视频到youtube，调用谷歌地图API还是通过Firebase发送通知，谷歌云都可以从网络出口成本的角度为你提供服务。事实上，根据GCP在<a class="ae kg" href="https://cloud.google.com/vpc/network-pricing#all-networking-pricing" rel="noopener ugc nofollow" target="_blank">的公开文件https://cloud . Google . com/VPC/network-pricing # all-networking-pricing</a>，</p><p id="ea83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ke">访问特定的谷歌非云产品，如YouTube、Maps、</em> <a class="ae kg" href="https://developers.google.com/authorized-buyers/rtb/peer-guide#trading_locations" rel="noopener ugc nofollow" target="_blank"> <em class="ke">双击</em> </a> <em class="ke">和Drive，无论是使用外部IP地址还是内部IP地址</em>访问谷歌云中的虚拟机<strong class="ih hj">都是免费的。</strong></p><p id="3a42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据相同的URL如果你和你的源在同一个地区，谷歌云服务(如Firebase)的出口也是免费的。</p><p id="40ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为一个真实的例子，我们将展示一个使用案例，客户通过将其应用程序从当前的云提供商迁移到GCP，可以节省99%的出口费用(每年高达数十万美元)。</p><p id="c312" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">客户场景</strong></p><p id="69ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该客户是一个纯粹的云端客户，内部没有基础架构。在1000英尺的高度；他们在公共云(非GCP)中的基础设施由数百个向终端客户端发送通知的“推送服务器”组成，其中99%的客户端由Chrome浏览器或Android手机组成。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es kh"><img src="../Images/9606fc2dbcc165543e8d8cc473d93936.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9gxafx9L7PWsJR9p"/></div></div></figure><p id="84c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于使用谷歌的firebase通知服务是免费的，他们正在利用Firebase云消息(FCM)服务。<br/>一个月内，他的云托管基础设施向Firebase服务发出了约2500亿次请求。</p><p id="c622" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于这些请求来自另一个云提供商(非GCP)，每次调用<a class="ae kg" href="http://fcm.googleapis.com/" rel="noopener ugc nofollow" target="_blank">fcm.googleapis.com</a>(平均负载为4KB)就有超过30 TB的数据流出互联网。因此，该客户向另一家云提供商(非GCP)支付了超过2.5万美元的网络出口费用。</p><p id="723c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">客户改造后的设置</strong></p><p id="dae7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在与客户接洽后，我们可以看到网络出口方面的巨大支出，这是我们想要解决的一个领域。FCM是一个全局服务，因此基于工作负载调用FCM服务，我们可以节省大量的网络出口成本。如上所述，流量在Google backbone上的网络出口成本取决于源位置和目的位置。虽然FCM是一个全局服务，但是成本将取决于FCM服务的哪个单元是给定请求的服务源。</p><p id="8cfd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了证明这一点，我们必须首先规划将调用fcm服务的工作负载的定位。作为APAC的大客户，我们对他们在GCP(新加坡)东南亚1地区托管的呼叫FCM服务的工作负载进行了测试。通过这种设置，我们在一个月的时间内测试了FCM服务每天70亿次的点击。从GCP的角度来看，这与虚拟机到虚拟机的定价(新加坡区域内)或有时(新加坡区域内的区域内)收取相同的费用。这要追溯到本文开头的GCP网络定价部分..服务“fcm”是谷歌云服务；调用这个服务的主机也在Google cloud网络主干上。所以或多或少的流量都是谷歌云内部的。因此，我们必须找到合适的工作负载定位，以便将适用的网络费用降至最低(流量保持在区域内，如果流量保持在给定区域的某个区域内，效果会更好)。经过一个月的测试，我们在GCP w.r.t .展示了他们目前每月在替代公共云提供商的出口上的支出下降了99%。这意味着将整个应用程序迁移到GCP几乎可以消除客户目前在替代公共云提供商的“网络出口”上的支出。该POC帮助客户做出明智的决定，将其应用程序迁移到GCP</p><p id="de40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结论</strong></p><p id="ebab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">采用公共云背后的推动因素之一是成本，因此当谈到公共云支出时，“每一分钱都很重要”。因此，了解并回答诸如哪些服务工作负载将被消耗、我的工作负载将与哪些其他工作负载对话、访问我的工作负载的终端用户在哪里等问题，将有助于我们更好地规划工作负载的地理位置。</p><p id="13b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于使用谷歌服务的应用程序，如地图、驾驶、youtube在GCP平台上托管这样的应用程序是显而易见的，因为在GCP托管的应用程序访问这些谷歌服务的网络出口成本是零，这是客户可以节省很多钱的地方</p><p id="0f3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">也适用于使用谷歌云服务的应用程序；很容易得出这样结论:如果这样的应用程序托管在GCP；客户的应用程序访问这些Google云服务的网络出口成本要么是免费的，要么是按照虚拟机到虚拟机的SKU定价收取的，这比备选云提供商的出口成本低得多，因为流量将离开备选云提供商的基础设施。这同样可以帮助客户节省大量资金。</p><p id="1f8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">有用参考:</strong></p><p id="b37f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">https://cloud.google.com/products/calculator<a class="ae kg" href="https://cloud.google.com/products/calculator" rel="noopener ugc nofollow" target="_blank">GCP定价计算器</a></p><p id="7e1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">了解https://cloud.google.com/vpc/pricing<a class="ae kg" href="https://cloud.google.com/vpc/pricing" rel="noopener ugc nofollow" target="_blank">GCP网络定价</a></p><p id="2dcf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">免责声明</strong>:这是为了告知读者，文中表达的观点、想法和意见仅属于作者，不一定属于作者的雇主、组织、委员会或其他团体或个人。</p></div></div>    
</body>
</html>