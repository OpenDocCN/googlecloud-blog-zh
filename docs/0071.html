<html>
<head>
<title>Firebase Data Structures: Complex Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Firebase数据结构:复杂数据</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/firebase-data-structures-complex-data-eb76b5a31124?source=collection_archive---------0-----------------------#2016-02-28">https://medium.com/google-cloud/firebase-data-structures-complex-data-eb76b5a31124?source=collection_archive---------0-----------------------#2016-02-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="502b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您错过了我关于分页的第一期Firebase数据结构文章，您可能想在继续之前先看看。</p><p id="84c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">都赶上了？太好了！先说复杂数据。</p><p id="da8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">2016年6月30日更新:</strong>我发布了我的免费课，<a class="ae jd" href="https://t.co/3eNdfsMtfu" rel="noopener ugc nofollow" target="_blank"> Firebase 3.0 for Web </a>。看看这个。</p><h2 id="30c9" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">示例数据</h2><figure class="ka kb kc kd fd ke er es paragraph-image"><div class="er es jz"><img src="../Images/a7c2383b7c35d788e8468b47806fb7af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*r1gdaGgg1gRqDMqb434mCw.png"/></div></figure><p id="5638" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我只创建了一个用户。注意所有的按键都是一样的(-KB_wr7Obntw9yrQNVK7)？</p><h2 id="922f" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">复杂数据需要服务器</h2><p id="d2b6" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">当一个新用户登录到我的系统时——当然是使用<a class="ae jd" href="https://www.firebase.com/docs/web/guide/user-auth.html" rel="noopener ugc nofollow" target="_blank"> Firebase认证</a>——我在/users节点中创建一个新条目来存放他们的数据。</p><ul class=""><li id="e7b3" class="km kn hi ih b ii ij im in iq ko iu kp iy kq jc kr ks kt ku bi translated">当用户创建帐户历史时，我将该历史记录在/user readable/-KB _ wr 7 obn tw 9 yrqnvk 7/account history下。</li><li id="0c00" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">当用户创建地址、公司数据和帖子时，我将它们保存在/user owned/-KB _ wr 7 obn tw 9 yrqnvk 7/<em class="la">{ address，company，posts} </em>下。</li><li id="4d2c" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">为了好玩，我将用户的日志保存在/userLogs/-KB_wr7Obntw9yrQNVK7下</li></ul><p id="6bf9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些操作需要服务器或<a class="ae jd" href="https://cloud.google.com/functions/docs" rel="noopener ugc nofollow" target="_blank">谷歌云功能</a>来复制数据。例如，/userReadable节点将有一个防止写入的安全规则。我必须将用户数据写入/userReadable服务器。</p><p id="b2bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">/userOwned节点将拥有用户的读/写权限，但是我仍然需要一个服务器将/userOwned的更改分散到我的数据结构的其他部分，以便其他用户和/或公众可以读取。</p><h2 id="0eed" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">为什么我的查询很慢？</h2><p id="3e0c" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">想象一下，如果我将所有这些数据嵌套在/users/-KB_wr7Obntw9yrQNVK7节点下，会怎么样？我可以将地址、公司、文章和帐户历史节点直接推送到我的用户对象中，这样可以节省大量时间！！！💩</p><p id="7272" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在考虑在我的网站的管理部分显示我的用户列表。当我查询一个用户时，我会收到嵌套在该用户下的所有节点，不管我是否需要它们。</p><p id="7468" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想象一下，如果每个用户的accountHistory节点超过100kb，会是什么情况？如果我想在一个列表中显示10个用户，我将查询超过1MB的数据，即使我只想显示用户名和电子邮件地址。</p><p id="e575" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我做过这个。书页嘎然而止。🚨 🚑 🚒</p><h2 id="967e" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">保持你的数据浅薄</h2><p id="fc8d" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">将数据分解成不同的组成部分使您能够只查询您需要的数据。使用服务器适当地复制数据将使您能够避免进行连接。复制数据，使其看起来与您向用户显示的完全一样。</p><p id="36d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">浅层数据和特定于视图的数据复制会使写入过程稍微繁重一些。然而，大多数应用程序读取数据的次数远远多于写入数据的次数，因此重复的、分散的数据可能会有很高的性能。</p><p id="fc19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，如果你发现你的应用程序需要大量的写操作，试着用最简单的方式写，并使用一个服务器进程将这些写操作组合成更容易阅读的结构。利用<a class="ae jd" href="https://www.firebase.com/blog/2015-09-24-atomic-writes-and-more.html" rel="noopener ugc nofollow" target="_blank">多位置更新</a>使这变得轻而易举。</p><h2 id="aad9" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">日志</h2><p id="4ae8" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">不要害怕重复数据！NoSQL因重复数据而繁荣。如果一个用户改变了她的用户名，你可能不得不在三个不同的地方更新一个用户名节点，但是<a class="ae jd" href="https://www.firebase.com/blog/2015-09-24-atomic-writes-and-more.html" rel="noopener ugc nofollow" target="_blank">多位置更新</a>有助于做到这一点……同样，它让读取变得非常快。</p><p id="a53d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我喜欢创建日志。我喜欢服务器进程监视数据变化，并将它们记录到/logs/comments或/logs/deletedPosts或任何有意义的/logs/*节点。Firebase使得这种日志记录几乎是即时的，日志让我可以快速地对浅层数据列表进行排序，以找到我需要的内容。一旦我有了评论或deletedPost之类的东西，就很容易找到原始文档进行更深入的检查。</p><p id="8d9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我的日志太长，我会删除旧的日志，因为它们只是日志。如果你需要一些法庭数据分析，你可以随时循环查看原始记录。</p><h2 id="93c3" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">下一个！</h2><p id="b26f" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">我有一些关于<a class="ae jd" rel="noopener" href="/@ChrisEsplin/firebase-data-structures-security-rules-72fd4ad91f0d#.iy6r58c44">安全规则</a>的想法来分享。请跟我来！</p><p id="8d50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在评论中，在推特上，在新的Firebase Slack频道上给我打电话😍！！！</p></div></div>    
</body>
</html>