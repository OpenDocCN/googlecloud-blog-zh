<html>
<head>
<title>Convert Group By CUBE (Teradata) to Bigquery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将按多维数据集分组(Teradata)转换为Bigquery</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/convert-group-by-cube-teradata-to-bigquery-9650b91b12f4?source=collection_archive---------4-----------------------#2022-11-24">https://medium.com/google-cloud/convert-group-by-cube-teradata-to-bigquery-9650b91b12f4?source=collection_archive---------4-----------------------#2022-11-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="ef9d" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">简介:</h1><p id="39dc" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Group by CUBE是Group by子句的teradata扩展，允许在单个语句中执行多个group by子句。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kb"><img src="../Images/468332ddf26b33aa836f9c348cc24dce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6LE-cZtDSiKUsV9SXZ9AKQ.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">立方体2n组</figcaption></figure><p id="bedb" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated">给定<em class="kw"> n </em>个维度，CUBE生成2 <em class="kw"> n </em>个不同种类的组。每个组表示为一行。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kx"><img src="../Images/251c4d73d4c5237c3c8948fed2cb5ed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7dVO0M_dqlKNy3vXLvYlPw.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">Teradata到Bigquery的转换</figcaption></figure><h1 id="4877" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">先决条件</h1><ol class=""><li id="f700" class="ky kz hi jf b jg jh jk jl jo la js lb jw lc ka ld le lf lg bi translated">Teradata数据仓库及其SQL语法的基础知识</li><li id="fd0d" class="ky kz hi jf b jg lh jk li jo lj js lk jw ll ka ld le lf lg bi translated">对Bigquery及其SQL语法有很好的理解</li></ol><h1 id="26d9" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">转换逻辑</h1><h2 id="8b6c" class="lm ig hi bd ih ln lo lp il lq lr ls ip jo lt lu it js lv lw ix jw lx ly jb lz bi translated">示例场景:</h2><p id="0782" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">假设，要求是找出城市和州对销售额的影响</p><p id="62a2" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated">样本数据如下所示</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ma"><img src="../Images/1a57f78e7508defcf211550db4197bee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rCmcJbDyHMP4s3bOtEzWHQ.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">抽样资料</figcaption></figure><h2 id="f35b" class="lm ig hi bd ih ln lo lp il lq lr ls ip jo lt lu it js lv lw ix jw lx ly jb lz bi translated">Teradata SQL:</h2><blockquote class="mb mc md"><p id="bb58" class="jd je kw jf b jg kr ji jj jk ks jm jn me kt jq jr mf ku ju jv mg kv jy jz ka hb bi translated">SELECT city，state，SUM(sales_amount)作为total _ sales<br/>FROM sales _ TBL<br/>GROUP BY CUBE(city，state)；</p></blockquote><h2 id="0896" class="lm ig hi bd ih ln lo lp il lq lr ls ip jo lt lu it js lv lw ix jw lx ly jb lz bi translated"><strong class="ak">大查询SQL: </strong></h2><blockquote class="mb mc md"><p id="4b91" class="jd je kw jf b jg kr ji jj jk ks jm jn me kt jq jr mf ku ju jv mg kv jy jz ka hb bi translated">SELECT <br/> sales_tbl.city为城市，<br/> NULL为州，<br/>sum(sales _ TBL . sales _ amount)total _ sales<br/>FROM<br/>sales _ TBL<br/>GROUP BY 1</p><p id="0b9c" class="jd je kw jf b jg kr ji jj jk ks jm jn me kt jq jr mf ku ju jv mg kv jy jz ka hb bi translated">联合所有</p><p id="7821" class="jd je kw jf b jg kr ji jj jk ks jm jn me kt jq jr mf ku ju jv mg kv jy jz ka hb bi translated">SELECT <br/> NULL为城市，<br/> sales_tbl.state为州，<br/>sum(sales _ TBL . sales _ amount)total _ sales<br/>FROM<br/>sales _ TBL<br/>GROUP BY 2</p><p id="7c6f" class="jd je kw jf b jg kr ji jj jk ks jm jn me kt jq jr mf ku ju jv mg kv jy jz ka hb bi translated">联合所有</p><p id="7fe4" class="jd je kw jf b jg kr ji jj jk ks jm jn me kt jq jr mf ku ju jv mg kv jy jz ka hb bi translated">从<br/> sales_tbl <br/>组中按1，2选择<br/> sales_tbl.city为城市，<br/> sales_tbl.state为州，<br/>sum(sales _ TBL . sales _ amount)total _ sales<br/></p><p id="a8c6" class="jd je kw jf b jg kr ji jj jk ks jm jn me kt jq jr mf ku ju jv mg kv jy jz ka hb bi translated">联合所有</p><p id="331e" class="jd je kw jf b jg kr ji jj jk ks jm jn me kt jq jr mf ku ju jv mg kv jy jz ka hb bi translated">从<br/> sales_tbl <br/>中选择<br/> NULL为城市，<br/> NULL为州，<br/>sum(sales _ TBL . sales _ amount)total _ sales，<br/>；</p></blockquote><h2 id="0dc0" class="lm ig hi bd ih ln lo lp il lq lr ls ip jo lt lu it js lv lw ix jw lx ly jb lz bi translated">翻译解释:</h2><p id="0c78" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">由于group by cube中有两个维度，因此创建了(2*2) = 4个组。</p><p id="d808" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated"><strong class="jf hj">第一组:城市效应</strong></p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mh"><img src="../Images/1f68016232fedc5df5a851084a003389.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y_52QoZzfUsgOMxyUHhV7g.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">第一组</figcaption></figure><p id="303e" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated"><strong class="jf hj">第2组:状态的影响</strong></p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mi"><img src="../Images/341e8362407b165fb1cd10502254fc3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NaBHUWAo1uK6VhrqjBhYfA.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">第二组</figcaption></figure><p id="cfba" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated"><strong class="jf hj">第三组:城市和州的影响</strong></p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mj"><img src="../Images/e87fa10cacf1fe8b4b47a1abd5812558.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*poXGT3h1CGsDDQBpKfPZ8Q.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">第三组</figcaption></figure><p id="9d01" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated"><strong class="jf hj">第四组:没有城市和州的影响</strong></p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mk"><img src="../Images/aca961c32bfe9a00143586b5a90aeec0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*seg-4xvId91wmDW4CT8BBg.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">第四组</figcaption></figure><p id="16bb" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated">因此，最终的查询输出是上述所有4个组的并集</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ml"><img src="../Images/a3fbae9ebf3cd465b14a714a22ad4f99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*33k7rjL--cF4Vd8Y59-eXw.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">按多维数据集输出分组</figcaption></figure><p id="44bf" class="pw-post-body-paragraph jd je hi jf b jg kr ji jj jk ks jm jn jo kt jq jr js ku ju jv jw kv jy jz ka hb bi translated">经过这些更改后，Bigquery SQL将生成与Teradata相同的输出。</p></div></div>    
</body>
</html>