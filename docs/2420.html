<html>
<head>
<title>Replicating MSSQL Server to Google Big Query Using Dataflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用数据流将MSSQL Server复制到Google Big Query</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/replicating-mssql-server-to-google-big-query-using-dataflow-a946f2a4fd5a?source=collection_archive---------0-----------------------#2022-10-13">https://medium.com/google-cloud/replicating-mssql-server-to-google-big-query-using-dataflow-a946f2a4fd5a?source=collection_archive---------0-----------------------#2022-10-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7505" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要将MSSQL数据复制到大型查询中，我们有多种选择，例如，如果您想使用CDC方法，您可以使用— <a class="ae jd" href="https://cloud.google.com/data-fusion/docs/tutorials/replicating-data/sqlserver-to-bigquery" rel="noopener ugc nofollow" target="_blank"> this </a>。</p><p id="1988" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇博客中，我们将看看如何使用数据流将MSSQL连接到BQ。数据流是谷歌的无服务器产品，支持流媒体和批处理。让我们开始吧！</p><ol class=""><li id="874a" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">创建一个MSSQL server实例——您可以在云SQL上创建它，或者在GCE上安装一个。我做到了后者。</li></ol><p id="3a35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建一个CE实例，您可以使用Google cloud建议的默认值，只需将引导映像更改为以下内容(您也可以使用其他风格，对于这个演示，我们将使用Ubuntu，以便其他人可以轻松复制这些步骤)</p><figure class="jo jp jq jr fd js er es paragraph-image"><div class="er es jn"><img src="../Images/dfb3dc1d9d1a4cb7e4a730ac465b1520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*KKsIfKYtTUeJZtjX0t5-aw.png"/></div></figure><p id="d503" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦实例启动，您应该能够看到新创建的实例</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es jv"><img src="../Images/1f902dec9385e382b171fabf74612966.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JdzCp5tiTsvb9gPHqxIuZA.png"/></div></div></figure><p id="0889" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将源机器网络上的端口1433开放给传入连接，这是我们将连接到sql server的地方。</p><p id="6782" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2) SSH进入机器，使用<a class="ae jd" href="https://learn.microsoft.com/en-us/sql/linux/quickstart-install-connect-ubuntu?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank">这个</a>安装MSSQL</p><p id="6c39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3)让我们创建一些将在BQ中复制的源数据</p><p id="ec06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">连接到实例</p><blockquote class="ka kb kc"><p id="1e8f" class="if ig kd ih b ii ij ik il im in io ip ke ir is it kf iv iw ix kg iz ja jb jc hb bi translated">sqlcmd -S localhost -U sa -P <your_password/></p><p id="9863" class="if ig kd ih b ii ij ik il im in io ip ke ir is it kf iv iw ix kg iz ja jb jc hb bi translated">创建表格</p><p id="2810" class="if ig kd ih b ii ij ik il im in io ip ke ir is it kf iv iw ix kg iz ja jb jc hb bi translated">创建数据库测试；</p><p id="67b5" class="if ig kd ih b ii ij ik il im in io ip ke ir is it kf iv iw ix kg iz ja jb jc hb bi translated">使用测试；</p><p id="2a9f" class="if ig kd ih b ii ij ik il im in io ip ke ir is it kf iv iw ix kg iz ja jb jc hb bi translated">创建表test_rep (id INT，name NVARCHAR(50)，quantity INT)；</p><p id="e46d" class="if ig kd ih b ii ij ik il im in io ip ke ir is it kf iv iw ix kg iz ja jb jc hb bi translated">插入到test_rep值(1，'香蕉'，150)；</p><p id="6a27" class="if ig kd ih b ii ij ik il im in io ip ke ir is it kf iv iw ix kg iz ja jb jc hb bi translated">插入到test_rep值(2，'橙色'，154)；</p><p id="6033" class="if ig kd ih b ii ij ik il im in io ip ke ir is it kf iv iw ix kg iz ja jb jc hb bi translated">去</p></blockquote><p id="849f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，您可以创建一个新用户，数据流将通过该用户连接到sql server，对于此演示，我们可以只重用superadmin用户。</p><p id="adf4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4)我们已经完成了源系统设置，现在让我们创建一个数据流作业来同步这些数据</p><p id="8fee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.1)创建一个BQ目标表，它应该具有与源相同的模式</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es kh"><img src="../Images/537cfb1ae52eff925c10b248ddbd4ddb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OQz13l28vpjRiVCYBj6Ncg.png"/></div></div></figure><p id="b937" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.2)创建一个测试桶，数据流作业将在其中保存临时数据和驱动程序</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es ki"><img src="../Images/89ac6419f132e4c963a7133cb2cb520f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qF5O08bsnhKuqK_rSTux5w.png"/></div></div></figure><p id="9979" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.3)下载<a class="ae jd" href="https://www.microsoft.com/en-us/download/details.aspx?id=54671" rel="noopener ugc nofollow" target="_blank"> JDBC </a>驱动程序，提取jar文件并将其放在上面创建的驱动程序文件夹下，这是数据流能够与MSSQL对话所必需的</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es kj"><img src="../Images/713f20e0161b4d6c5ccf4cbc449f78af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4yoadQThSSsJVoXX1_HHTA.png"/></div></div></figure><p id="57d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.4)让我们最终创建数据流作业。转到数据流服务，并选择从模板创建作业</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es kk"><img src="../Images/d579ff3ba65726985104b07a92438210.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*z9tYdAiXuZ4MKas4idBn0A.png"/></div></div></figure><p id="ec83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据流有许多现成的模板可以重复使用，这里我们将使用JDBC到BQ模板</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es kl"><img src="../Images/3db05fb7bd192a1ce4d0bb4045ee0309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hGDrFArq3aM4-cW8l4Twlg.png"/></div></div></figure><p id="677f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如下填写所需的管道选项</p><p id="d19d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">JDBC连接— jdbc:sqlserver:// <your instance="" ip=""> :1433</your></p><p id="b4d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">驱动程序类名-com . Microsoft . SQL server . JDBC . SQL server driver</p><p id="5682" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">driverJars —给出我们在步骤4.3中保存在bucket中的驱动程序的路径，例如-GS://sl-test-bucket-12/driver/sqljdbc 42 . jar</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es km"><img src="../Images/9a06efc35796a42b1be06c471ab0ac2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AQDSM-c2zf6_S0YFf9FhGA.png"/></div></div></figure><p id="3aaf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成后，点击底部的显示可选参数</p><p id="3776" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并按照下面截图中的指示添加新参数</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es kn"><img src="../Images/7562ab232e617cf2e81336658c5756ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1DPwPa1IGu2x4x4RBK82xg.png"/></div></div></figure><p id="0407" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">JDBC连接属性—数据库=测试；encrypt = truetrustServerCertificate = true</p><p id="bc2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成这些参数后，单击底部的运行作业</p><p id="12f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5)现在一切就绪。一旦作业完成，您应该能够看到下图</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es ko"><img src="../Images/7cae0fa7650c49a352fa11aa1318e188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xVMA7Htv87Mquh_rJRcRmg.png"/></div></div></figure><p id="a6a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到，从JDBC (MSSQL DB)读取和写入BQ的步骤都是成功的</p><p id="4b26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6)转到BQ，确认数据是否已经复制到它上面</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es kp"><img src="../Images/b390077f68d3fe4d39e0377c19769744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YPYXofwkKtJB2NPMfejeng.png"/></div></div></figure><p id="8a4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">总之</strong>我们已经一步一步地使用JDBC到BQ模板将数据从MSSQL复制到BQ，类似的模板或步骤可以用于从任何源数据库复制，只要它支持JDBC连接。</p></div></div>    
</body>
</html>