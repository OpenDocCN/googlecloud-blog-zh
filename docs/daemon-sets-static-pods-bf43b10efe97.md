# å®ˆæŠ¤è¿›ç¨‹é›†å’Œé™æ€è±†èšâ˜¸â˜¸

> åŸæ–‡ï¼š<https://medium.com/google-cloud/daemon-sets-static-pods-bf43b10efe97?source=collection_archive---------0----------------------->

Kubernetes ä¸­å…³äºå®ˆæŠ¤è¿›ç¨‹é›†å’Œé™æ€ Pods çš„ä¸€åˆ‡

## ä»‹ç»ğŸš©ğŸš©

![](img/32ccea9e0737c85430762c5706309073.png)

å„ä½è¯»è€…å¥½ğŸ‘‹æˆ‘å·²ç»å†™äº†ä¸€æ®µæ—¶é—´å…³äº Kubernetes åŠå…¶å¯¹è±¡çš„åŸºç¡€çŸ¥è¯†ã€‚æˆ‘è§‰å¾—åŸºç¡€çŸ¥è¯†å·²ç»è®²å¾—å¾ˆå¥½äº†ï¼Œç°åœ¨æ˜¯æ—¶å€™è½¬å‘æ›´é«˜çº§çš„ Kubernetes ä¸»é¢˜äº†ã€‚
å…¶ä¸­ä¸€ä¸ªè¯é¢˜æ˜¯å…³äº Kubernetes ä¸­çš„å®ˆæŠ¤è¿›ç¨‹é›†å’Œé™æ€ podã€‚

***æ‰€ä»¥åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è¯•ç€äº†è§£ä¸€ä¸‹*** :

*   ä»€ä¹ˆæ˜¯å®ˆæŠ¤è¿›ç¨‹é›†ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒï¼Ÿï¼Ÿ
*   æˆ‘ä»¬å¦‚ä½•åˆ›å»ºä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹é›†ï¼Ÿï¼Ÿ
*   ä»€ä¹ˆæ˜¯é™æ€ Podï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒï¼Ÿï¼Ÿ
*   æˆ‘ä»¬å¦‚ä½•åˆ›å»ºä¸€ä¸ªé™æ€ Podï¼Ÿï¼Ÿ
*   å®ˆæŠ¤è¿›ç¨‹é›†å’Œé™æ€ Pod ä¹‹é—´çš„åŒºåˆ«ã€‚

> **æ‰€ä»¥æ²¡æœ‰ä»»ä½•è¿›ä¸€æ­¥çš„å»¶è¿Ÿï¼Œè®©æˆ‘ä»¬å¼€å§‹å§:)**

## ä»€ä¹ˆæ˜¯å®ˆæŠ¤è¿›ç¨‹é›†ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒï¼Ÿï¼ŸğŸ¤” ğŸ¤”

![](img/4d32a773d946db954eb738f9a0507210.png)

ä¸€ä¸ª ***DaemonSet*** ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹å¿…é¡»åœ¨å…¶ä¸Šè¿è¡Œä¸€ä¸ª Pod çš„å‰¯æœ¬ã€‚
éšç€èŠ‚ç‚¹è¢«æ·»åŠ åˆ°é›†ç¾¤ä¸­ï¼Œpod ä¹Ÿè¢«æ·»åŠ åˆ°å…¶ä¸­ã€‚éšç€èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤ï¼Œè¿™äº› pod å°†è¢«åƒåœ¾æ”¶é›†ã€‚åˆ é™¤ DaemonSet å°†æ¸…é™¤å®ƒåˆ›å»ºçš„æ‰€æœ‰ podã€‚

> ç®€å•åœ°è¯´ï¼Œ **DaemonSet** æ˜¯ä¸€ä¸ª Kubernetes å¯¹è±¡ï¼Œå®ƒç¡®ä¿é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åº”è¯¥æœ‰ä¸€ä¸ªç‰¹å®šçš„èŠ‚ç‚¹åœ¨å…¶ä¸Šè¿è¡Œã€‚

**è®©æˆ‘ä»¬è¯•ç€ç†è§£å½“è¾¾è’™å¡ç‰¹å‡ºç°åœ¨ç”»é¢ä¸­æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ:**

*   æ¯å½“æœ‰æ–°èŠ‚ç‚¹æ·»åŠ åˆ°ç¾¤é›†æ—¶ï¼Œ**daemon set**å°†å¤åˆ¶ Pod å¹¶åœ¨æ–°æ·»åŠ çš„èŠ‚ç‚¹ä¸Šè°ƒåº¦è¯¥ Podã€‚
*   æ¯å½“ä»é›†ç¾¤ä¸­åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œ**daemon set**å°†ä»è¯¥èŠ‚ç‚¹ä¸­åˆ é™¤ Pod çš„å‰¯æœ¬ã€‚
*   **åˆ é™¤ä¸€ä¸ª DaemonSet** å¯èƒ½ä¼šæ€æ­»é›†ç¾¤ä¸­ä¸åŒèŠ‚ç‚¹ä¸Šç”±å®ƒè°ƒåº¦çš„æ‰€æœ‰ podã€‚

> DaemonSets æœ‰ç‚¹åƒ ReplicaSets ï¼Œå› ä¸ºå®ƒæœ‰åŠ©äºéƒ¨ç½² pod çš„å¤šä¸ªå®ä¾‹ã€‚ä½†æ˜¯ DaemonSets ä¼šç¡®ä¿åœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œ pod çš„ä¸€ä¸ªå‰¯æœ¬ã€‚

**ä½¿ç”¨ DaemonSets çš„ç”¨ä¾‹:**

1.  å®ƒå¯ä»¥ç”¨äºåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Š ***è¿è¡Œé›†ç¾¤å­˜å‚¨èˆ±***
2.  å®ƒå¯ä»¥ç”¨äºåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Š ***è¿è¡Œæ—¥å¿—æ”¶é›† pod***
3.  å®ƒå¯ä»¥ç”¨äº ***åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ªèŠ‚ç‚¹ç›‘æ§ pod***

> æˆ‘æƒ³ç°åœ¨å¯èƒ½å¾ˆæ¸…æ¥šä»€ä¹ˆæ˜¯ DaemonSetï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä½¿ç”¨å®ƒï¼Ÿ**è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨ä¸‹ä¸€èŠ‚åˆ›å»ºä¸€ä¸ª**:))

## æˆ‘ä»¬å¦‚ä½•åˆ›å»º**daemonset**ï¼ŸğŸ¤“ğŸ¤“

![](img/1ddb0edd415ee71d2aea016d83877725.png)

Photo by [æ„šæœ¨æ··æ ª cdd20](https://unsplash.com/@cdd20?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ YAML æ–‡ä»¶åˆ›å»º DaemonSetsã€‚è¦ç”¨ YAML åˆ›å»ºä¸€ä¸ª Kubernetes DaemonSetï¼Œé¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œä¸ºå®ƒåˆ†é…å¿…è¦çš„è®¿é—®æƒé™ï¼Œç„¶åå®šä¹‰å¿…è¦çš„é”®-å€¼å¯¹ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ª DaemonSet å®šä¹‰æ–‡ä»¶ *(* `daemon-set-definition.yaml` *)* çš„ä¾‹å­

```
**apiVersion**: apps/v1
**kind**: DaemonSet
**metadata**:
  **name**: monitoring-daemon
  **labels**:
    **app**: nginx
**spec**:
  **selector**:
    **matchLabels**:
      **app**: monitoring-agent
  **template**:
    **metadata**:
     **labels**:
       **app**: monitoring-agent
    **spec**:
      **containers**:
      - **name**: monitoring-agent
        **image**: monitoring-agent
```

è¿™ä¸ªæ–‡ä»¶ä¸­æœ‰å¾ˆå¤šæ–¹é¢å’Œç»„ä»¶ã€‚è®©æˆ‘ä»¬é€ä¸€åˆ†æğŸ˜€

*   è®©æˆ‘ä»¬ä»`apiVersion`(é”®å€¼å¯¹)å¼€å§‹ã€‚è¿™ç”¨äºè¯´æ˜åœ¨åˆ›å»º DaemonSet æ—¶ï¼Œæ‚¨å°†åœ¨åå°è¿è¡Œä»€ä¹ˆ API æœåŠ¡å™¨å’Œç‰ˆæœ¬ã€‚
*   æ¥ä¸‹æ¥æ˜¯`kind`,è¡¨ç¤ºè¿™æ˜¯ä¸€ç§å®šä¹‰æ–‡ä»¶ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªâ€œæ¶é­”é›†â€ã€‚
*   æ¥ä¸‹æ¥æ˜¯`metadata`ï¼Œè¿™æ˜¯ä¸€ä¸ªåŒ…å«é¡¹ç›®åç§°å’Œæ ‡ç­¾çš„å­—å…¸ã€‚å…ƒæ•°æ®å­˜å‚¨åˆ†é…ç»™æ­£åœ¨åˆ›å»ºçš„ DaemonSet çš„å€¼ã€‚
*   æœ€åæ˜¯`spec`ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„/åˆ—è¡¨ã€‚ä»¥ä¸‹æ˜¯å…¶ä¸­å­˜åœ¨çš„å€¼åŠå…¶å«ä¹‰ã€‚

    `template`:åŸºæœ¬åŒ…å« POD è§„æ ¼çš„éƒ¨åˆ†ã€‚å½“ DaemonSet éœ€è¦åœ¨ä¸åŒçš„åœºæ™¯ä¸­æ—‹è½¬æ–°çš„åŠèˆ±æ—¶ï¼Œè¿™ä¸ªéƒ¨åˆ†å°±æ´¾ä¸Šäº†ç”¨åœºã€‚

æˆ‘ä»¬å·²ç»å®Œæˆäº† DaemonSet å®šä¹‰æ–‡ä»¶ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥ä¿å­˜å¹¶é€€å‡ºæ–‡ä»¶ã€‚

ä½¿ç”¨æ­¤å‘½ä»¤åŸºäºä¸Šè¿° YAML æ–‡ä»¶åˆ›å»º DaemonSet:

```
kubectl create -f daemon-set-definition.yaml
```

ä½¿ç”¨æ­¤å‘½ä»¤åˆ—å‡ºå®ˆæŠ¤é›†

```
kubectl get daemonsets
```

ä½¿ç”¨æ­¤å‘½ä»¤è·å–å®ˆæŠ¤é›†çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯

```
kubectl describe daemonsets monitoring-daemon
```

## ä»€ä¹ˆæ˜¯é™æ€ Podï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒï¼Ÿï¼ŸğŸ¤” ğŸ¤”

![](img/002bd9c10433324d57461cb62da75fd0.png)

***é™æ€ Pods*** ç”±ç‰¹å®šèŠ‚ç‚¹ä¸Šçš„ kubelet å®ˆæŠ¤è¿›ç¨‹ç›´æ¥ç®¡ç†ï¼Œæ— éœ€ API æœåŠ¡å™¨è§‚å¯Ÿå®ƒä»¬ã€‚ä¸æ§åˆ¶å°ç®¡ç†çš„åŠèˆ±ä¸åŒï¼Œkubelet ç›‘è§†æ¯ä¸ªé™æ€åŠèˆ±ã€‚
**é™æ€ Pods** æ€»æ˜¯ç»‘å®šåˆ°ç‰¹å®šèŠ‚ç‚¹ä¸Šçš„ä¸€ä¸ª Kubeletã€‚

> **ç®€å•æ¥è¯´ï¼Œ** **é™æ€åŠèˆ±**åªæ˜¯ç®€å•çš„åŠèˆ±ï¼Œä½†å®ƒä»¬ä¸å—ä¸»èŠ‚ç‚¹æ§åˆ¶ã€‚æ›´ç¡®åˆ‡åœ°è¯´ï¼ŒèŠ‚ç‚¹ä¸Šçš„ kubelet ä½¿å®ƒä»¬æ—‹è½¬èµ·æ¥ï¼Œå¹¶åœ¨å®ƒä»¬çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­è§‚å¯Ÿå®ƒä»¬ã€‚ç”šè‡³åœ¨å®ƒä»¬å¤±è´¥æ—¶é‡æ–°å¯åŠ¨å®ƒä»¬ã€‚

kubelet è‡ªåŠ¨å°è¯•åœ¨ Kubernetes API æœåŠ¡å™¨ä¸Šä¸ºæ¯ä¸ªé™æ€ Pod åˆ›å»ºä¸€ä¸ªé•œåƒ Podã€‚è¿™æ„å‘³ç€åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ pod åœ¨ API æœåŠ¡å™¨ä¸Šæ˜¯å¯è§çš„ï¼Œä½†æ˜¯ä¸èƒ½ä»é‚£é‡Œè¿›è¡Œæ§åˆ¶ã€‚

**ä½¿ç”¨é™æ€ pod çš„ç”¨ä¾‹:** é™æ€ pod é€šå¸¸è¢«ä¸åŒçš„è½¯ä»¶ç”¨æ¥è‡ªä¸¾ Kubernetes æœ¬èº«ã€‚ä¾‹å¦‚ï¼Œ`kubeadm`ä½¿ç”¨é™æ€ pod æ¥ ***è°ƒå‡º Kubernetes æ§åˆ¶å¹³é¢ç»„ä»¶*** ï¼Œå¦‚ api-serverã€controller-manager ä½œä¸ºä¸»èŠ‚ç‚¹ä¸Šçš„é™æ€ podã€‚
ç„¶åè¿™äº›ç»„ä»¶å°†ç”±ä¸»èŠ‚ç‚¹ä¸Šçš„ Kubelet æŸ¥çœ‹ã€‚

> æˆ‘æƒ³ç°åœ¨å¯èƒ½å¾ˆæ¸…æ¥šä»€ä¹ˆæ˜¯é™æ€ Podï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä½¿ç”¨å®ƒï¼Ÿ**è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨ä¸‹ä¸€èŠ‚åˆ›å»ºä¸€ä¸ª**:))

## æˆ‘ä»¬æ€æ ·æ‰èƒ½åˆ›é€ å‡ºé™æ€çš„è±†èšï¼Ÿï¼ŸğŸ¤“ğŸ¤“

![](img/b6f745ab29a3bd074f6f8de577d5850d.png)

Simone Secci åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

å¯ä»¥é€šè¿‡ä½¿ç”¨æ ‡å‡† pod é…ç½®æ–‡ä»¶(yaml æ–‡ä»¶)æ¥åˆ›å»ºé™æ€ Podï¼Œç„¶åå°†è¿™äº›æ–‡ä»¶æ”¾åœ¨è¦åˆ›å»º POD çš„èŠ‚ç‚¹ä¸Šçš„ç‰¹å®šç›®å½•ä¸­ã€‚

ä½¿ç”¨`kubelet --pod-manifest-path=<the directory>`å¯åŠ¨ kubelet å®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒä¼šå®šæœŸæ‰«æç›®å½•ï¼Œå¹¶åœ¨ yaml/json æ–‡ä»¶å‡ºç°/æ¶ˆå¤±æ—¶åˆ›å»º/åˆ é™¤é™æ€ podã€‚

**ä¾‹å¦‚ï¼Œè¿™æ˜¯å¦‚ä½•å¯åŠ¨ä¸€ä¸ªç®€å•çš„ web æœåŠ¡å™¨ä½œä¸ºé™æ€ pod :**

1.  é€‰æ‹©ä¸€ä¸ªæˆ‘ä»¬æƒ³è¦è¿è¡Œé™æ€ pod çš„èŠ‚ç‚¹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ˜¯`my-node1`
    `ssh my-node1`
2.  é€‰æ‹©ä¸€ä¸ªç›®å½•ï¼Œæ¯”å¦‚`/etc/kubelet.d`ï¼Œå¹¶åœ¨é‚£é‡Œæ”¾ç½®ä¸€ä¸ª web æœåŠ¡å™¨ pod å®šä¹‰æ–‡ä»¶ï¼Œä¾‹å¦‚`/etc/kubelet.d/static-web.yaml`
3.  åœ¨èŠ‚ç‚¹ä¸Šé…ç½® kubelet å®ˆæŠ¤è¿›ç¨‹ï¼Œé€šè¿‡ä½¿ç”¨`--pod-manifest-path=/etc/kubelet.d/`å‚æ•°è¿è¡Œå®ƒæ¥ä½¿ç”¨è¿™ä¸ªç›®å½•ã€‚
4.  é‡å¯ kubelet `$ systemctl restart kubelet`

## å®ˆæŠ¤ç¨‹åºé›†å’Œé™æ€ Pod ä¹‹é—´çš„åŒºåˆ«

![](img/578be6a00e5f1937fe1e512a31fa7ced.png)![](img/1d7a3c20969c50d20f3d7ca8ba6a409a.png)

## æ¥ä¸‹æ¥å‘¢ï¼ŸğŸ‘€ ğŸ‘€

![](img/a3e1949a0716378f6899c18db2064da6.png)

> éå¸¸æ„Ÿè°¢ä½ æ¥åˆ°è¿™é‡Œï¼è¿™æ˜¯æœ¬æ–‡çš„ç»“å°¾ã€‚
> ä½†æˆ‘ä»¬åªæ˜¯è§¦åŠäº† K8s ç”Ÿæ€ç³»ç»Ÿçš„è¡¨é¢:)ã€‘
> è¿˜æœ‰å¾ˆå¤šï¼Œè¿™å°†æ˜¯ä¸€æ¬¡æœ‰è¶£çš„æ—…ç¨‹ï¼Œæˆ‘ä»¬å°†ä¸€èµ·å­¦ä¹ è®¸å¤šå¾ˆé…·çš„ä¸œè¥¿ã€‚
> 
> é¼“æŒï¼Œè·Ÿæˆ‘æ¥ğŸ™ˆå¦‚æœä½ å–œæ¬¢æˆ‘çš„ä½œå“ï¼Œå¹¶å¸Œæœ›åœ¨æœªæ¥æ›´å¤šåœ°é˜…è¯»æˆ‘çš„ä½œå“:)

å¦‚æœä½ å¯¹è¿™ç¯‡æ–‡ç« æœ‰ä»»ä½•ç–‘é—®ï¼Œæˆ–è€…æƒ³èŠèŠå¤©ï¼Œè¯·éšæ—¶è”ç³»æˆ‘çš„ç¤¾äº¤åª’ä½“è´¦å·

*æ¨ç‰¹â€”*[*https://twitter.com/ChindaVibhor*](https://twitter.com/ChindaVibhor)

*LinkedInâ€”*[*https://www.linkedin.com/in/vibhor-chinda-465927169/*](https://www.linkedin.com/in/vibhor-chinda-465927169/)

## ç›¸å…³æ–‡ç« 

[](/google-cloud/scheduling-in-kubernetes-9bc96c9008d8) [## kubernetes çš„æ—¥ç¨‹å®‰æ’

### Kubernetes ä¸­çš„è°ƒåº¦æµç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿï¼Ÿ

medium.com](/google-cloud/scheduling-in-kubernetes-9bc96c9008d8) [](/google-cloud/deploying-a-local-kubernetes-cluster-using-minikube-abe94a2c7583) [## ä½¿ç”¨ Minikube éƒ¨ç½²æœ¬åœ° Kubernetes é›†ç¾¤ğŸš¢ ğŸš¢

### å¦‚ä½•ä½¿ç”¨ Minikube è®¾ç½®æœ¬åœ° Kubernetes é›†ç¾¤ï¼Ÿï¼Ÿ

medium.com](/google-cloud/deploying-a-local-kubernetes-cluster-using-minikube-abe94a2c7583) 

æˆ‘ä»ç„¶ä¼šç»§ç»­å‘è¡¨æ–°çš„æ–‡ç« ï¼Œæ¶µç›–æˆ‘æ­£åœ¨æ¢ç´¢çš„ä¸€ç³»åˆ—ä¸»é¢˜ã€‚

é‚£éƒ½æ˜¯ä¹¡äº²ä»¬ï¼ï¼æ¶‚é¸¦:))