<html>
<head>
<title>How to Backup Google BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何备份Google BigQuery</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-backup-google-big-query-5f078138cedc?source=collection_archive---------0-----------------------#2020-03-20">https://medium.com/google-cloud/how-to-backup-google-big-query-5f078138cedc?source=collection_archive---------0-----------------------#2020-03-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6ca94db6a60d1ecf06eb5aea65ab7a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IWruHaIEuPbzJqKg.jpg"/></div></div></figure><h1 id="c1e6" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">假设</h1><p id="de1c" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">备份策略基于以下假设:</p><ul class=""><li id="8250" class="km kn hi jq b jr ko jv kp jz kq kd kr kh ks kl kt ku kv kw bi translated">BigQuery中的数据大小:50TB</li><li id="251d" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">数据摄取方法:仅追加(将数据加载到新的每日分区中，保留旧分区中的所有历史数据)</li><li id="e6c1" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">加载频率:每天</li><li id="f831" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">BQ中的当前数据保留期:数据存储2年，没有任何删除或存档</li><li id="a7d4" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">每日增量负载大小:50/(2 * 365)～= 70GB</li><li id="929d" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">每3年可能需要一次完整的备份恢复(例如，整个数据集或项目被意外删除，但很晚才被发现)</li><li id="f86a" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">一个季度可能需要一次部分(分区或表)备份恢复(例如:错误的ETL操作截断的表或分区)</li><li id="dbfc" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">所有1年的数据都应保留</li><li id="f508" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">1年后，必要的摘要/汇总数据可以单独备份(大小可以忽略不计),每日备份可以删除。</li></ul><h1 id="f3eb" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">备份策略</h1><p id="45ac" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">BQ在后台执行自动快照，可在2天内恢复(对于丢弃的数据),在7天内恢复表数据。以下几点和备份策略可用于从恢复操作中恢复，对于表数据，这些操作在2天内不会被注意到，对于7天内不会被注意到。有关快照和取消删除的更多信息，请参考<a class="ae lc" href="https://cloud.google.com/bigquery/table-decorators#snapshot_decorators" rel="noopener ugc nofollow" target="_blank">本</a>和<a class="ae lc" href="https://cloud.google.com/bigquery/docs/managing-tables#undeletetable" rel="noopener ugc nofollow" target="_blank">本</a>。</p><p id="6561" class="pw-post-body-paragraph jo jp hi jq b jr ko jt ju jv kp jx jy jz ld kb kc kd le kf kg kh lf kj kk kl hb bi translated"><strong class="jq hj">备选方案1</strong>(GCS中的成本效益选项):</p><ul class=""><li id="5f7e" class="km kn hi jq b jr ko jv kp jz kq kd kr kh ks kl kt ku kv kw bi translated">将所有当前数据一次性备份到GCS</li><li id="f393" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">ETL窗口结束后，每天备份增量负载(新分区和新表)</li><li id="9e70" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">使用GCS单区域</li><li id="d412" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">将coldline存储用于当前备份和超过1个月的每日增量备份</li><li id="7580" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">使用近线存储进行30天的每日增量备份</li><li id="073d" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">30天后，将每日增量备份从近线移动到冷线</li><li id="1ebd" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">1年后，从coldline中删除每日增量备份</li><li id="5fd5" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">在另一个GCP项目中使用bucket也可以从意外的项目删除中恢复，并提供单独的IAM特权和访问范围。(注意:项目所有者可以在30天内停止删除。这种情况是最悲观的，但不会增加任何额外成本。)</li><li id="f98d" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">采用这种策略，GCS中会有一个副本</li></ul><p id="b902" class="pw-post-body-paragraph jo jp hi jq b jr ko jt ju jv kp jx jy jz ld kb kc kd le kf kg kh lf kj kk kl hb bi translated"><strong class="jq hj">备选项2 </strong>(另一个数据集和项目中的1个历史副本) :</p><ul class=""><li id="2ec8" class="km kn hi jq b jr ko jv kp jz kq kd kr kh ks kl kt ku kv kw bi translated">将所有当前数据集一次性复制到专门为备份创建的项目中名称中包含备份日期的其他数据集。</li><li id="dc36" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">每天复制新分区和新表，如果其他数据没有变化，则追加到备份数据集。</li><li id="c2bc" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">在这个示例策略中，将有一个保存所有历史的备份副本</li></ul><p id="e408" class="pw-post-body-paragraph jo jp hi jq b jr ko jt ju jv kp jx jy jz ld kb kc kd le kf kg kh lf kj kk kl hb bi translated"><strong class="jq hj">备选3 </strong>(多余的副本；如果数据变化是不可预测的，例如，未控制数量的表被截断和加载，先前分区中的数据被更新等):</p><ul class=""><li id="9261" class="km kn hi jq b jr ko jv kp jz kq kd kr kh ks kl kt ku kv kw bi translated">每天将所有当前数据集复制到专门为备份创建的项目中名称中包含备份日期的其他数据集</li><li id="aff2" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">定义数据集删除策略，例如:</li><li id="39b0" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">将每周开始的备份数据集保留4周，并在1周后删除其他每日备份数据集。</li><li id="2fcd" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">将月初的备份数据集保留3个月，并在1个月后删除其他每周备份数据集。</li><li id="c4e7" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">使用这个示例策略，BigQuery中将有7+3+2=12个副本</li><li id="4805" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">根据业务需求，可以缩小尺寸。</li></ul><h1 id="2480" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">费用</h1><ul class=""><li id="b75e" class="km kn hi jq b jr js jv jw jz lg kd lh kh li kl kt ku kv kw bi translated">存储在coldline中的总备份大小:50TB+70GB * 335 ~ = 73.5 TB</li><li id="ce8d" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">近线存储的总备份大小:70GB*30=2.1TB</li><li id="5358" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">单个地区的Coldline存储成本为73,5TB(例如:芬兰):每月301.06美元</li><li id="fdb7" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">单个地区(例如芬兰)2.1TB的近线存储成本:每月21.50美元</li><li id="fc68" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated"><strong class="jq hj">总费用:每月322.56美元</strong></li></ul><p id="751f" class="pw-post-body-paragraph jo jp hi jq b jr ko jt ju jv kp jx jy jz ld kb kc kd le kf kg kh lf kj kk kl hb bi translated">注意价格可能会有变化，请查看<a class="ae lc" href="https://cloud.google.com/storage/pricing" rel="noopener ugc nofollow" target="_blank"> GCS价格页面</a>了解价格详情。</p><p id="83a5" class="pw-post-body-paragraph jo jp hi jq b jr ko jt ju jv kp jx jy jz ld kb kc kd le kf kg kh lf kj kk kl hb bi translated">您还可以使用<a class="ae lc" href="https://cloud.google.com/products/calculator" rel="noopener ugc nofollow" target="_blank"> GCP价格计算器</a>计算最新价格的成本。</p><h1 id="e509" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">75TB的其他存储替代方案</h1><ul class=""><li id="fc10" class="km kn hi jq b jr js jv jw jz lg kd lh kh li kl kt ku kv kw bi translated">Coldline单地区:每月307.20美元</li><li id="e8c4" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">多地区热线:每月537.60美元</li><li id="7faf" class="km kn hi jq b jr kx jv ky jz kz kd la kh lb kl kt ku kv kw bi translated">近线多地区:每月768美元</li></ul><p id="ea88" class="pw-post-body-paragraph jo jp hi jq b jr ko jt ju jv kp jx jy jz ld kb kc kd le kf kg kh lf kj kk kl hb bi translated">对于其他计算:<a class="ae lc" href="https://cloud.google.com/products/calculator/" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/products/calculator/</a></p><p id="7bbe" class="pw-post-body-paragraph jo jp hi jq b jr ko jt ju jv kp jx jy jz ld kb kc kd le kf kg kh lf kj kk kl hb bi translated">对于存储定价:<a class="ae lc" href="https://cloud.google.com/storage/pricing" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/storage/pricing</a></p></div></div>    
</body>
</html>