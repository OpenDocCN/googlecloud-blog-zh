<html>
<head>
<title>Connecting to Cloud SQL - Thinking about it</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">连接到云SQL——考虑一下</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/connecting-google-cloud-sql-94025ba27071?source=collection_archive---------1-----------------------#2019-10-25">https://medium.com/google-cloud/connecting-google-cloud-sql-94025ba27071?source=collection_archive---------1-----------------------#2019-10-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/23ae89e680f61cca63c0c7af884f9bfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*efvnGXZbvpu0ib5qBdUfuQ.png"/></div></div></figure><p id="d638" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">嗨，朋友们！</p><p id="c479" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，您已经<a class="ae jo" href="https://cloud.google.com/sql/docs/mysql/quickstart" rel="noopener ugc nofollow" target="_blank">创建了您的第一个云SQL实例</a>！但是指南告诉你只要在云壳中连接它就可以了。这太棒了。不要误解我。我喜欢云壳。然而，当您试图弄清楚如何用您的应用程序或数据库管理工具连接到您的数据库时，这实际上没有什么好处。</p><p id="4620" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我将讨论连接到云SQL的位置、方式和原因。</p><ol class=""><li id="f20c" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated"><code class="du jy jz ka kb b"><a class="ae jo" rel="noopener" href="/p/94025ba27071#a772"><strong class="is hj">Where</strong></a></code>您正在连接，这将如何影响文档中所谓的“公共与私有”IP，以及围绕这一问题的考虑因素和设置方法(剧透一下，这不是公共与私有这么简单)。</li><li id="5f1a" class="jp jq hi is b it kc ix kd jb ke jf kf jj kg jn ju jv jw jx bi translated"><code class="du jy jz ka kb b"><a class="ae jo" rel="noopener" href="/p/94025ba27071#2bcf"><strong class="is hj">How</strong></a></code>你连接。具体来说:围绕身份验证的类型做出决定，是否使用SSL。使用Google的SQL代理是否有意义(代理是什么？最简单地说，它是一个独立的二进制文件，可以安全地连接到您的云SQL实例，而不用担心IP地址的允许列表，或者手动配置SSL。更多<a class="ae jo" href="https://cloud.google.com/sql/docs/mysql/sql-proxy" rel="noopener ugc nofollow" target="_blank">此处</a>。)，或者最好通过API直接连接。</li><li id="b57e" class="jp jq hi is b it kc ix kd jb ke jf kf jj kg jn ju jv jw jx bi translated"><code class="du jy jz ka kb b"><a class="ae jo" rel="noopener" href="/p/94025ba27071#1b41"><strong class="is hj">Why</strong></a></code>将会围绕什么时候组合<code class="du jy jz ka kb b">Where</code>和<code class="du jy jz ka kb b">How</code>的不同片段展开一些场景。</li></ol><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kh"><img src="../Images/019eaebae58d5df852f98632c0ed66de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o6POlPnEXQFLExqmkYcvew.png"/></div></div></figure><h1 id="a772" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">在哪里</h1><p id="8b59" class="pw-post-body-paragraph iq ir hi is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hb bi translated">当您设置您的云SQL实例时，隐藏在<code class="du jy jz ka kb b">Set connectivity</code>下拉列表中的配置选项下的是公共和私有IP设置选项。</p><p id="5b14" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将做一个陈述让你记住，然后再详细解释一下:私有意味着你从虚拟私有云(VPC)内部连接到云SQL。公共意味着你是从公共互联网连接到它。</p><p id="7d64" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，什么是VPC？</p><p id="f652" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里有一个详细的概述<a class="ae jo" href="https://cloud.google.com/vpc/docs/vpc" rel="noopener ugc nofollow" target="_blank"/>。简而言之:VPC是一个专用的私人网络，类似于公司办公室的网络，这样不同的谷歌云产品就可以在不使用公共互联网的情况下相互交流。</p><p id="9976" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它们有很多复杂的网络用途。现在，只要知道存在一个默认的就行了(适当地命名为“default”)。如果您决定启用专用IP，您会看到它列在“关联网络”下的配置选项中(即使您自己没有设置)。请注意，如果您有一个遗留VPC，因为您的项目有点旧，它不会显示在下拉列表中。你可以通过进入控制台中的<a class="ae jo" href="https://console.cloud.google.com/networking/networks/list" rel="noopener ugc nofollow" target="_blank"> VPC网络</a>来检查这一点，并检查你的默认VPC的模式。</p><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/3ba8c29c3ecd19ea3e8fb3d82cfc2eed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vtmJKn7g7kJE2reQ"/></div></div></figure><p id="c95d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果是<code class="du jy jz ka kb b">Legacy</code>，它不会显示为云SQL实例的选项。</p><p id="e34a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在事情变得有点复杂了。并非所有谷歌云的产品都支持VPC连接。事实上，一些“无服务器”产品(如应用引擎、云功能或云运行)无法直接连接到VPC。不过没关系，不要惊慌。我们有一个解决办法。<a class="ae jo" href="https://cloud.google.com/vpc/docs/configure-serverless-vpc-access" rel="noopener ugc nofollow" target="_blank">无服务器VPC连接器</a>可以授权您的无服务器环境访问您的VPC上的产品(比如带有私有IP的云SQL实例)。</p><p id="ac92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">快速回顾一下:公共IP意味着可能通过外部互联网路由，私有IP意味着来自VPC网络内部。一些GCP产品需要一些帮助才能使用私有IP。</p><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kh"><img src="../Images/0f63a4b1b4ba6439994851d5ceb2194a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xogKk3ZziRQAyCalFYY-XA.png"/></div></div></figure><h1 id="2bcf" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">怎么</h1><p id="b939" class="pw-post-body-paragraph iq ir hi is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hb bi translated">有多种方法可以连接到云SQL实例:</p><ol class=""><li id="f9b7" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">云代理</li><li id="5862" class="jp jq hi is b it kc ix kd jb ke jf kf jj kg jn ju jv jw jx bi translated">允许消费者使用的公共知识产权</li><li id="dd8c" class="jp jq hi is b it kc ix kd jb ke jf kf jj kg jn ju jv jw jx bi translated">VPC互联应用的私有IP</li><li id="fe53" class="jp jq hi is b it kc ix kd jb ke jf kf jj kg jn ju jv jw jx bi translated">特定于语言的连接器(例如Java的JDBC套接字工厂)</li><li id="68ef" class="jp jq hi is b it kc ix kd jb ke jf kf jj kg jn ju jv jw jx bi translated">使用API编写自己的连接器需要短暂的SSL创建/连接</li><li id="080e" class="jp jq hi is b it kc ix kd jb ke jf kf jj kg jn ju jv jw jx bi translated">使用永久密钥对设置SSL加密</li></ol><p id="1203" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这绝对是混搭的情况。例如，您可以作为白名单中的用户连接到公共IP，还可以在实例上设置SSL加密。我们将在下一节讨论为什么您会选择进行不同的配置，但首先我想简单地介绍一下如何设置一些方法，并强调一些使用案例。</p><p id="5365" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我得到的大部分信息将被整合到官方<a class="ae jo" href="https://cloud.google.com/sql/docs/mysql/quickstarts" rel="noopener ugc nofollow" target="_blank">文档</a>页面的快速入门中。所以当他们合并后，我会链接到快速入门，而不是我的快速博客。指南的链接:</p><ol class=""><li id="42f0" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated"><a class="ae jo" rel="noopener" href="/@GabeWeiss/cloud-sql-private-ip-proxy-83e85456571f">私有IP +代理</a>(谷歌计算引擎虚拟机)</li><li id="f0cd" class="jp jq hi is b it kc ix kd jb ke jf kf jj kg jn ju jv jw jx bi translated"><a class="ae jo" rel="noopener" href="/@GabeWeiss/cloud-sql-public-ip-proxy-5513f59e5a9e">公共IP +代理</a></li><li id="fa3f" class="jp jq hi is b it kc ix kd jb ke jf kf jj kg jn ju jv jw jx bi translated"><a class="ae jo" rel="noopener" href="/@GabeWeiss/cloud-sql-public-ip-allowlist-e2e375b4432d">带有允许列表IP的公共IP</a></li><li id="82d2" class="jp jq hi is b it kc ix kd jb ke jf kf jj kg jn ju jv jw jx bi translated"><a class="ae jo" rel="noopener" href="/@GabeWeiss/connecting-cloud-sql-kubernetes-sidecar-46e016e07bb4">Kubernetes边车集装箱中的代理人</a></li></ol><p id="b374" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我也很乐意在这些最初的基础上增加更多的内容。如果你有具体想看的，请在下面添加评论，或者通过<a class="ae jo" href="https://twitter.com/GabeWeiss_" rel="noopener ugc nofollow" target="_blank"> Twitter </a> (DMs开放)联系我，让我知道。</p><figure class="ki kj kk kl fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kh"><img src="../Images/b40987e6496e549dd07bfb44c2f0ad7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pICLYL2BT9aG8kfDBZ_mKQ.png"/></div></div></figure><h1 id="1b41" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">为什么</h1><p id="87b8" class="pw-post-body-paragraph iq ir hi is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hb bi translated">虽然您可以通过我们上面列出的任何方式连接到云SQL，但是考虑一下您为什么选择哪种方式实际上归结为两点:</p><p id="d3eb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第一，你的环境允许什么。例如，正如我们所提到的，如果你在一个不允许你运行额外的二进制文件的企业环境中工作，那么运行Google的SQL代理将不会是一个选项，你将需要寻找其他选项。有时，您可能需要使用以特定方式签名的永久SSL证书。如果你在GCP使用的产品还不完全支持VPC连接，那么你需要使用公共IP而不是私有IP。</p><p id="ebec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">二，风险承受能力。您可以采用最简单的方式来设置路由，即向您的实例开放一个公共IP，并允许列出任何正在连接的IP。求你了。求你了。不要那样做。也许是为了测试您的应用程序，但在生产中，不要这样做。除非你不介意别人访问你的数据库。在这种情况下，无论如何！</p><p id="a89a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一方面，你可以反其道而行之，在与云SQL实例相同的VPC内运行GCE上的应用程序，这样你就可以使用内部IP地址，然后在本地主机上使用Google的SQL代理，这样只有你的应用程序可以与代理对话。</p><p id="5790" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就性能而言，与查询优化之类的东西相比，在完全安全的锁定模式下运行之间的差异可能很小，但它大于零。当然，如果您的应用程序依赖于实时响应，那么就对所有的事情进行优化。我只是提醒你不要在不需要的地方进行预优化。除非你需要，否则不要为了几毫秒的额外延迟而牺牲数据安全性。</p><p id="df1d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">最佳实践是使用谷歌SQL代理。</strong>从安全的角度来看，它将使用短暂的SSL令牌为您管理所有应用程序到数据库实例的加密，因此即使其中一个受到攻击，它也是一个短期证书，因此您的暴露窗口很小。我再强调一遍…除非你有要求让你不用，那就用代理吧！</p><h1 id="b23b" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">结论</h1><p id="8af4" class="pw-post-body-paragraph iq ir hi is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hb bi translated">所以你有它！这是一个关于Google云平台上云SQL的连接性的博客，希望基本上是完整的。无论你从哪里连接，无论你选择什么样的连接方式，我希望这篇博客能帮你做到这一点！</p><p id="f385" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您有任何问题或意见，请在下面留下，或通过<a class="ae jo" href="https://twitter.com/GabeWeiss_" rel="noopener ugc nofollow" target="_blank"> Twitter </a>联系我。DMs打开了！</p></div></div>    
</body>
</html>