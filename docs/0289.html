<html>
<head>
<title>Hosting multiple websites on Single Google Cloud Compute Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在单个谷歌云计算引擎上托管多个网站</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/hosting-multiple-websites-on-single-google-cloud-compute-engine-9768e2f02c6d?source=collection_archive---------0-----------------------#2017-05-22">https://medium.com/google-cloud/hosting-multiple-websites-on-single-google-cloud-compute-engine-9768e2f02c6d?source=collection_archive---------0-----------------------#2017-05-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/a72e2cf9de99771a9d6f36d7685d111c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*D9vrlwUQfNu4eLwudIwIew.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">虚拟主机允许在一台服务器上托管多个站点</figcaption></figure><p id="9066" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇文章将是关于在使用Apache 2的自定义域的谷歌云计算引擎的单个虚拟机实例上托管多个网站。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="dcdf" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">简介:</h1><p id="72a8" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">要在“谷歌计算引擎”上托管多个网站，我们首先需要托管我们的单个网站，即服务器已经安装。现在，通过为您的其他域创建“sites-available”的“domain.conf”文件，我们将能够告诉服务器根据请求的“host”标头路由到不同的目录。这基本上是在Apache中创建虚拟主机。现在，使用计算引擎虚拟机的IP将域名指向服务器。经过一段时间(传播阶段)后，您将能够访问由谷歌云计算引擎中的单个虚拟机实例托管和服务的两个网站。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="2717" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">详细:</h1><p id="45c0" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">在裁剪之前，您需要</p><ul class=""><li id="01cd" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated"><strong class="is hj">一个激活的谷歌云平台</strong> ( GCP ) <strong class="is hj">账号</strong>。如果你还没有，转到<a class="ae lh" href="https://cloud.google.com" rel="noopener ugc nofollow" target="_blank"> GCP网站</a>并点击<em class="li">免费试用</em>，你将被要求提供信用卡/借记卡的详细信息，并可能获得300美元的试用信用。</li><li id="02ee" class="ky kz hi is b it lj ix lk jb ll jf lm jj ln jn ld le lf lg bi translated">创建了一个项目。</li><li id="9b21" class="ky kz hi is b it lj ix lk jb ll jf lm jj ln jn ld le lf lg bi translated">安装了apache2的GCP计算引擎的运行虚拟机实例。</li><li id="8437" class="ky kz hi is b it lj ix lk jb ll jf lm jj ln jn ld le lf lg bi translated">对DNS有所了解</li></ul><p id="d5c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">虽然我假设你已经安装了apache服务器，并在上面成功地托管了一个网站，但我还是会在这个博客里把它设置好，以防万一..；)因此，如果您愿意，可以跳过以下部分。</p><h2 id="4bb6" class="lo jw hi bd jx lp lq lr kb ls lt lu kf jb lv lw kj jf lx ly kn jj lz ma kr mb bi translated">在GCP计算引擎上创建虚拟机实例:</h2><ul class=""><li id="fb36" class="ky kz hi is b it kt ix ku jb mc jf md jj me jn ld le lf lg bi translated">迎面走向<a class="ae lh" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> GCP控制台</a>。现在，如果您还没有创建项目，您将会看到一个要求创建项目的屏幕，单击该屏幕并创建一个项目。</li><li id="d50f" class="ky kz hi is b it lj ix lk jb ll jf lm jj ln jn ld le lf lg bi translated">导航到您的项目。通过下拉项目选择器验证它。</li></ul><figure class="mg mh mi mj fd ij er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mf"><img src="../Images/a79573d134628a17a97d9fb2aedb88fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B3FYpThSqmFiyOvGWKiwXw.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">下拉项目选择</figcaption></figure><ul class=""><li id="8cbd" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">现在从侧菜单(点击汉堡图标显示)点击'<strong class="is hj">计算引擎</strong>'。</li><li id="feed" class="ky kz hi is b it lj ix lk jb ll jf lm jj ln jn ld le lf lg bi translated">导航到“虚拟机实例”并单击“<strong class="is hj">创建实例</strong>”。</li><li id="bdec" class="ky kz hi is b it lj ix lk jb ll jf lm jj ln jn ld le lf lg bi translated">现在填写虚拟机的名称和配置，填写任意名称。现在选择机器类型为'<em class="li"> f1-micro </em>'，引导镜像为'<em class="li"> Ubuntu 16.04 LTS </em>'，并在防火墙部分下选中'<em class="li">允许HTTTP流量</em> c '。</li><li id="4601" class="ky kz hi is b it lj ix lk jb ll jf lm jj ln jn ld le lf lg bi translated">点击'<strong class="is hj">创建</strong>'按钮，现在你就完成了。</li></ul><h2 id="cbf8" class="lo jw hi bd jx lp lq lr kb ls lt lu kf jb lv lw kj jf lx ly kn jj lz ma kr mb bi translated">托管第一个网站:</h2><ul class=""><li id="a7e8" class="ky kz hi is b it kt ix ku jb mc jf md jj me jn ld le lf lg bi translated">对于托管网站，我们需要在我们的虚拟机实例上设置一个服务器。我们将在虚拟机实例上安装apache2服务器。</li><li id="f1b1" class="ky kz hi is b it lj ix lk jb ll jf lm jj ln jn ld le lf lg bi translated">导航到计算引擎中的虚拟机实例，然后单击“SSH”</li></ul><figure class="mg mh mi mj fd ij er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mo"><img src="../Images/c9d7b8276f1a07e533936a636f5e5b53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dlfuPRzRJpZxhzJdeAekTQ.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">正在连接到GCP上的虚拟机实例</figcaption></figure><ul class=""><li id="ce1f" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">您将被定向到一个浏览器窗口/选项卡，其中有一个终端连接到您的虚拟机实例。</li><li id="2f21" class="ky kz hi is b it lj ix lk jb ll jf lm jj ln jn ld le lf lg bi translated">现在在终端上执行以下命令(在浏览器中打开)</li></ul><p id="a11f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du mp mq mr ms b">sudo apt-get install apache2</code></p><p id="ff5a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果出现提示，请输入“y”。</p><ul class=""><li id="0949" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">现在，您可以将文件托管在位置“/var/www/html/”中。出于演示的目的，执行下面的命令，这将为我们的服务器创建一个测试页面。</li></ul><pre class="mg mh mi mj fd mt ms mu mv aw mw bi"><span id="158b" class="lo jw hi ms b fi mx my l mz na">cd /var/www/html</span><span id="ab00" class="lo jw hi ms b fi nb my l mz na">sudo echo “&lt;html&gt;&lt;head&gt;&lt;title&gt;Hello&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Test Page&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;” &gt;&gt; index.html</span></pre><ul class=""><li id="12b6" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">现在，导航回虚拟机维护列表页面，单击与您的虚拟机名称相对应的外部IP地址。它会将您重定向到一个新的选项卡，您应该会看到我们刚刚创建的测试页面。</li><li id="8d8d" class="ky kz hi is b it lj ix lk jb ll jf lm jj ln jn ld le lf lg bi translated">在这种状态下，我们已经成功地举办了一个网站(目前只有一个网页)。如果我们希望我们的页面可以使用域名访问，那么我们需要将我们的域名指向我们实例的IP地址。转到你的域名卖家的账户，找到DNS设置，编辑<strong class="is hj"> A记录</strong>并填写你的虚拟机实例的外部IP地址。几分钟后，网站应该可以通过您的域名访问。例如下图所示。您还可以为“www”子域名添加一个CNAME，以使用“<em class="li">http://</em><strong class="is hj"><em class="li">www</em></strong><em class="li">. example . com</em>”而不是“<em class="li">http://example.com</em>”的常规方式访问网站。</li></ul><figure class="mg mh mi mj fd ij er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es nc"><img src="../Images/2c71524006546b3a0493e4f213ea2091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wNW-UnnhHsbk13CM0cOi0w.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">DNS设置中的记录示例</figcaption></figure><ul class=""><li id="e912" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">您甚至可以通过在Google Cloud DNS中创建一个区域(在“网络”部分下提供)并指出您的域名服务器是为您的区域创建的，来选择Google的DNS服务。</li></ul><h2 id="9f31" class="lo jw hi bd jx lp lq lr kb ls lt lu kf jb lv lw kj jf lx ly kn jj lz ma kr mb bi translated">在同一计算引擎虚拟机上托管另一个网站</h2><p id="c4e2" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">要在同一台机器上托管另一个网站，您需要创建“domain.conf”文件，并在Apache服务器上创建虚拟主机。我们开始吧。</p><ul class=""><li id="feb6" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">导航到虚拟机实例页面，并通过SSH进入虚拟机。</li><li id="80a4" class="ky kz hi is b it lj ix lk jb ll jf lm jj ln jn ld le lf lg bi translated">现在，在终端中，使用“cd”命令导航到apache的站点可用目录</li></ul><p id="8488" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du mp mq mr ms b">cd /etc/apache2/sites-available/</code></p><ul class=""><li id="122d" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">现在，在这个目录中，我们将使用默认的配置文件为我们的网站创建一个。假设您有两个域'<em class="li"> domain1.com' </em>和'<em class="li">domain2.com</em>'，让我们为这两个域创建conf文件。</li><li id="1f98" class="ky kz hi is b it lj ix lk jb ll jf lm jj ln jn ld le lf lg bi translated">复制默认配置:</li></ul><pre class="mg mh mi mj fd mt ms mu mv aw mw bi"><span id="bdd9" class="lo jw hi ms b fi mx my l mz na">sudo cp 000-default.conf domain1.com.conf<br/>sudo cp 000-default.conf domain2.com.conf</span></pre><ul class=""><li id="7112" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">使用“nano”或“vi(m)”编辑文件以反映以下数据</li></ul><pre class="mg mh mi mj fd mt ms mu mv aw mw bi"><span id="90b5" class="lo jw hi ms b fi mx my l mz na">ServerName example.com<br/>ServerAlias www.example.com<br/>ServerAdmin admin@example.com<br/>DocumentRoot /var/www/example.com/html</span></pre><p id="3773" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">其中example.com应在各自的文件中替换为“domain1.com”和“domain2.com”。</p><p id="38fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面的步骤展示了如何为一个文件这样做——比如说domain1.com</p><pre class="mg mh mi mj fd mt ms mu mv aw mw bi"><span id="63dd" class="lo jw hi ms b fi mx my l mz na">sudo nano domain1.com.conf</span></pre><p id="feae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将打开编辑器，现在编辑并进行更改，并根据您的操作系统使用“Cmd + C”或“Ctrl + C ”,当提示时输入“y”。将保存更改。</p><ul class=""><li id="d522" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">下一步是启用这些配置，并为我们的网站重新定位和添加测试页面。</li><li id="9e05" class="ky kz hi is b it lj ix lk jb ll jf lm jj ln jn ld le lf lg bi translated">首先让我们重新定位文件在正确的位置。</li></ul><pre class="mg mh mi mj fd mt ms mu mv aw mw bi"><span id="5ed7" class="lo jw hi ms b fi mx my l mz na">cd /var/www/</span><span id="4143" class="lo jw hi ms b fi nb my l mz na">sudo mkdir domain1.com</span><span id="8fbc" class="lo jw hi ms b fi nb my l mz na">sudo mkdir domain2.com</span><span id="d322" class="lo jw hi ms b fi nb my l mz na">cd domain1.com</span><span id="e852" class="lo jw hi ms b fi nb my l mz na">sudo mkdir html</span><span id="d510" class="lo jw hi ms b fi nb my l mz na">sudo echo “&lt;html&gt;&lt;head&gt;&lt;title&gt;Hello&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Test Page for domain1&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;” &gt;&gt; index.html</span><span id="c1f1" class="lo jw hi ms b fi nb my l mz na">cd /var/www/domain2.com/</span><span id="f4c9" class="lo jw hi ms b fi nb my l mz na">sudo mkdir html</span><span id="71c4" class="lo jw hi ms b fi nb my l mz na">sudo echo “&lt;html&gt;&lt;head&gt;&lt;title&gt;Hello&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Test Page for domain2&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;” &gt;&gt; index.html</span></pre><ul class=""><li id="9337" class="ky kz hi is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">现在让我们启用配置</li></ul><pre class="mg mh mi mj fd mt ms mu mv aw mw bi"><span id="1b20" class="lo jw hi ms b fi mx my l mz na">sudo a2ensite domain1.com</span><span id="eb59" class="lo jw hi ms b fi nb my l mz na">sudo a2ensite domain2.com</span><span id="defa" class="lo jw hi ms b fi nb my l mz na">sudo service apache2 restart</span></pre><p id="92c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们已经完成了服务器端的工作。我们需要纠正以这种方式添加的所有域名的DNS设置。所有网站的记录都应指向此虚拟机实例IP地址。更改可能需要一段时间才能反映出来，但您将能够访问两个服务不同文件的域。</p><p id="d096" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我就此告辞。附注:这是我的第一篇博文，请原谅我的内容质量，我也希望听到反馈。感谢阅读这篇文章。:)</p></div></div>    
</body>
</html>