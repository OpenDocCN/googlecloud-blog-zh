<html>
<head>
<title>Authenticating Google Cloud Ruby Gems</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">鉴定谷歌云红宝石宝石</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/authenticating-google-cloud-ruby-gems-adc6fc31f63a?source=collection_archive---------0-----------------------#2017-01-11">https://medium.com/google-cloud/authenticating-google-cloud-ruby-gems-adc6fc31f63a?source=collection_archive---------0-----------------------#2017-01-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7cd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随着我们为谷歌云产品推出更多的ruby gems，我一直在询问如何认证你的脚本。有几种不同的方法。有些更适合特定的场景。我想我应该写下有哪些选择，以及何时选择使用每种方法。关于认证的更多信息可以在文档中找到<a class="ae jd" href="https://googlecloudplatform.github.io/google-cloud-ruby/#/docs/google-cloud/v0.23.0/guides/authentication" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="dd23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的说明假设您已经为项目启用了将要使用的API。如果你没有这样做或者不确定你可以检查一下<a class="ae jd" href="http://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank"> API管理器</a>。</p><h1 id="b142" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">在谷歌计算引擎上运行</h1><p id="6644" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我将从简单的例子开始。当您使用Google Cloud Ruby gems on Compute Engine运行代码时，身份验证会自动进行。您只需要在创建实例时设置正确的范围。如果GCE是您的生产环境，这种方法很有效。然而，由于我的大部分开发工作都是在笔记本电脑上完成的，这对于我来说还不够。当我在GCE之外运行我的代码时，我需要一种认证的方法。幸运的是，还有其他几种身份验证方法可用。</p><h1 id="0ba1" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">使用服务帐户</h1><p id="bc96" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">要从外部计算引擎访问Google Cloud APIs，您需要一个服务帐户。服务帐户类似于您可能在其他服务中使用的API令牌或密钥。使用令牌的站点通常使用令牌授予对任何代码的完全访问权限。服务客户可以让您更加细化。每个服务帐户都有一个相关的私钥，您可以授予该帐户访问它需要的API和产品的权限。如果帐户的私钥被错误的人共享(或意外登录)，你可以在谷歌云控制台中快速撤销访问权限。</p><p id="cf0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将在Google Cloud Console中生成一个新的服务帐户，并将一个JSON文件下载到您的客户端，该文件包含库知道如何读取的密钥。创建服务帐户的说明可从这里获得:<a class="ae jd" href="https://googlecloudplatform.github.io/google-cloud-ruby/#/docs/google-cloud/v0.23.0/guides/authentication" rel="noopener ugc nofollow" target="_blank">文本</a>或<a class="ae jd" href="https://www.youtube.com/watch?v=tSnzoW4RlaQ" rel="noopener ugc nofollow" target="_blank">视频</a>。</p><h1 id="0214" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">使用环境变量</h1><p id="c249" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">所有库都需要项目id和服务帐户信息来进行身份验证。向代码提供这些信息的最简单的方法之一是使用环境变量。所有的<code class="du kh ki kj kk b">google-cloud-ruby</code>库都寻找<code class="du kh ki kj kk b">GOOGLE_CLOUD_PROJECT</code>环境变量来获取项目ID，并寻找<code class="du kh ki kj kk b">GOOGLE_CLOUD_KEYFILE</code>(JSON文件的路径)或<code class="du kh ki kj kk b">GOOGLE_CLOUD_KEYFILE_JSON</code>(实际的JSON)来获取服务帐户信息。</p><p id="25b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大多数ruby爱好者都熟悉这种方法。一旦你设置好了，你就不需要在你的代码中考虑认证了；它只是工作。然而，“它只是工作”也是使用这种方法的缺点。如果您有多个授权范围不同的GCP项目或服务帐户，那么在项目之间移动时很容易忘记更新环境变量。此外，如果你和我一样，你会花20分钟的时间试图找出为什么有些东西不能被授权，然后你才想起有一个环境变量指向一个不同于你当前工作的项目。</p><h1 id="691a" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">在代码中指定</h1><p id="b461" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我通常通过在代码中指定凭证来进行身份验证。我经常同时有四个或更多的活动项目。我试着使用环境变量，但是一直搞不清楚我在哪个项目中。所以我转而将认证细节放入代码中。</p><p id="7cd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我创建了一个服务帐户，并将JSON文件存储在项目的根目录中。我添加了一个<code class="du kh ki kj kk b">.gitignore</code>规则，这样我就不会意外地将凭证签入源代码控制。要使用服务帐户，我只需在实例化gcloud对象时传递项目id和服务帐户的路径。</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="bd61" class="kt jf hi kk b fi ku kv l kw kx">require "google/cloud" <br/>gcloud = Google::Cloud.new "my-project-id", "service-account.json"</span></pre><h1 id="165a" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">组合方法</h1><p id="ab27" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我也看到人们使用多种认证方法的组合。大多数情况下，他们会在生产、暂存和其他共享环境中使用环境变量，并在开发时在代码中使用凭证。</p><pre class="kl km kn ko fd kp kk kq kr aw ks bi"><span id="4fbf" class="kt jf hi kk b fi ku kv l kw kx">require "google/cloud" <br/>PROJECT_ID = ENV["GOOGLE_CLOUD_PROJECT"] || <br/>  "my-project-id" <br/>SERVICE_ACCOUNT = ENV["GOOGLE_CLOUD_KEYFILE"] || <br/>  "service-account.json" </span><span id="7f50" class="kt jf hi kk b fi ky kv l kw kx">gcloud = Google::Cloud.new PROJECT_ID, SERVICE_ACCOUNT</span></pre><p id="49bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不太喜欢这种方法。我喜欢让我的生产环境尽可能与开发相匹配。然而，它应该工作得很好，如果这符合你的需要，对你来说有意义，那就去做吧。</p><p id="32d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是使用Google Cloud gems for Ruby时几种不同的认证方式。希望这些方法中的一个能够满足您的需求，您可以很快开始编码。</p><p id="3899" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">01/08/17</p></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><p id="a335" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lg">原载于2017年1月11日</em><a class="ae jd" href="http://www.thagomizer.com/blog/2017/01/11/authenticating-google-cloud-ruby-gems.html" rel="noopener ugc nofollow" target="_blank"><em class="lg">www.thagomizer.com</em></a><em class="lg">。</em></p></div></div>    
</body>
</html>