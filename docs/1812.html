<html>
<head>
<title>Full relational diagram for Ethereum public data on Google BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google BigQuery上以太坊公共数据的完整关系图</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/full-relational-diagram-for-ethereum-public-data-on-google-bigquery-2825fdf0fb0b?source=collection_archive---------1-----------------------#2021-02-23">https://medium.com/google-cloud/full-relational-diagram-for-ethereum-public-data-on-google-bigquery-2825fdf0fb0b?source=collection_archive---------1-----------------------#2021-02-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/7ffbb2cb73ce0cbf5c2dd1de6396558c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*280Oy5k6J0NCcoKjLZsUVg.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">维克多·哈克曼的原画</figcaption></figure><div class=""/><figure class="ev ex iv iw ix hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es iu"><img src="../Images/4767cada3a2a8dd9bc17134e4327b706.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e5NHRqew4lXNLQ7NAL7KIQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated"><a class="ae iy" href="https://dbdiagram.io/d/602e721380d742080a3b1265" rel="noopener ugc nofollow" target="_blank">https://dbdiagram.io/d/602e721380d742080a3b1265</a></figcaption></figure><p id="2ff8" class="pw-post-body-paragraph iz ja hx jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">找到来自一个令人惊叹的开源项目<a class="ae iy" href="https://github.com/blockchain-etl" rel="noopener ugc nofollow" target="_blank">区块链-ETL </a>的以太坊数据的完整关系图。</p><h1 id="ee2c" class="jx jy hx bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">用法示例</h1><h2 id="e86e" class="kv jy hx bd jz kw kx ky kd kz la lb kh jk lc ld kl jo le lf kp js lg lh kt li bi translated">1.crypto _以太坊. transactions</h2><p id="ffd5" class="pw-post-body-paragraph iz ja hx jb b jc lj je jf jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw hb bi translated">transactions表有正常的以太坊交易，如果需要查找内部交易，需要查询trace表。</p><blockquote class="lo lp lq"><p id="2133" class="iz ja lr jb b jc jd je jf jg jh ji jj ls jl jm jn lt jp jq jr lu jt ju jv jw hb bi translated">内部交易实际上不被认为是交易，因为它们不直接包括在区块链中。相反，只能被看作是跟踪的副产品。</p></blockquote><h2 id="b159" class="kv jy hx bd jz kw kx ky kd kz la lb kh jk lc ld kl jo le lf kp js lg lh kt li bi translated">2.crypto _以太坊. contracts</h2><p id="df88" class="pw-post-body-paragraph iz ja hx jb b jc lj je jf jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw hb bi translated">注意——合同表上没有任何唯一键</p><p id="6ed1" class="pw-post-body-paragraph iz ja hx jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hy">合约&amp;交易</strong></p><p id="5083" class="pw-post-body-paragraph iz ja hx jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">contracts.address可以是fond transactions.to_address或transactions . receipt _ contract _ address。</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="6777" class="kv jy hx ma b fi me mf l mg mh"><strong class="ma hy">transactions.to_address</strong> - Address of the receiver. null when its a contract creation transaction.</span><span id="00c7" class="kv jy hx ma b fi mi mf l mg mh"><strong class="ma hy">transactions.receipt_contract_address</strong> - The contract address created, if the transaction was a contract creation, otherwise null.</span></pre><p id="1f16" class="pw-post-body-paragraph iz ja hx jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hy">加盟合同&amp;交易</strong></p><p id="4359" class="pw-post-body-paragraph iz ja hx jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">当连接合同和交易时，您必须使用复合外键。</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="cb70" class="kv jy hx ma b fi me mf l mg mh">"crypto_ethereum.transactions".("block_hash", "to_address") &lt; "bigquery-public-data:crypto_ethereum.contracts".("block_hash", "address")</span><span id="e725" class="kv jy hx ma b fi mi mf l mg mh">OR</span><span id="6926" class="kv jy hx ma b fi mi mf l mg mh">"bigquery-public-data:crypto_ethereum.transactions".("block_hash", "receipt_contract_address") &lt; "bigquery-public-data:crypto_ethereum.contracts".("block_hash", "address")</span></pre><p id="3127" class="pw-post-body-paragraph iz ja hx jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hy">契约&amp;痕迹</strong></p><p id="a32e" class="pw-post-body-paragraph iz ja hx jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">Trace.from_address和Trace.to_address都可以有contract.address</p><h2 id="7288" class="kv jy hx bd jz kw kx ky kd kz la lb kh jk lc ld kl jo le lf kp js lg lh kt li bi translated">3.crypto_ethereum.traces</h2><p id="3f01" class="pw-post-body-paragraph iz ja hx jb b jc lj je jf jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw hb bi translated">在以太坊<a class="ae iy" href="https://openethereum.github.io/JSONRPC-trace-module" rel="noopener ugc nofollow" target="_blank">https://openethereum.github.io/JSONRPC-trace-module</a>中了解更多关于跟踪的信息，JSONRPC-trace-module用于填充crypto_ethereum.traces表</p><blockquote class="lo lp lq"><p id="fd68" class="iz ja lr jb b jc jd je jf jg jh ji jj ls jl jm jn lt jp jq jr lu jt ju jv jw hb bi translated">内部交易实际上不被认为是交易，因为它们不直接包括在区块链中。取而代之的只能被看作是追踪的副产品</p></blockquote><p id="0a32" class="pw-post-body-paragraph iz ja hx jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><a class="ae iy" href="https://etherscan.io/tx/0x09b8fc0deb96a27ddd9f20d8ca5d76931dc2fa5be97191ab04ce12239b0d6525#internal" rel="noopener ugc nofollow" target="_blank"><strong class="jb hy">etherscan . io</strong></a><strong class="jb hy">内部交易简化和高级</strong></p><p id="1da6" class="pw-post-body-paragraph iz ja hx jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">如果您使用Etherscan查找内部事务，请注意简单视图和高级视图之间的切换</p><figure class="lv lw lx ly fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mj"><img src="../Images/064d7c6a08350f5498e8e62efce4a923.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e8ENm3WZd8EJoQyxzk9Ofg.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated"><a class="ae iy" href="https://etherscan.io/tx/0x09b8fc0deb96a27ddd9f20d8ca5d76931dc2fa5be97191ab04ce12239b0d6525#internal" rel="noopener ugc nofollow" target="_blank">关闭</a></figcaption></figure><figure class="lv lw lx ly fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mk"><img src="../Images/8396ee7a34d0f4f7cc66ccbc8afb7702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UkS2_dkYo-patYdIGYmnkA.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">打开</figcaption></figure><p id="a63e" class="pw-post-body-paragraph iz ja hx jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hy">内部交易简单视图</strong></p><p id="9b27" class="pw-post-body-paragraph iz ja hx jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">如何查询内部交易的跟踪表<a class="ae iy" href="https://etherscan.io/tx/0x09b8fc0deb96a27ddd9f20d8ca5d76931dc2fa5be97191ab04ce12239b0d6525#internal" rel="noopener ugc nofollow" target="_blank">(默认/来自Etherscan.io的简单视图)</a>。返回的总行数将与以太网扫描信息屏幕上关于块的信息相匹配。</p><figure class="lv lw lx ly fd hk"><div class="bz dy l di"><div class="ml mm l"/></div></figure><figure class="lv lw lx ly fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mn"><img src="../Images/f4039a2bdf3459ff4e846a0e3e3c6ef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fbLTwpa3hRIKyEkABx5jww.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">125个内部事务(实际上，还有更多，这些是值&gt; 0的事务)</figcaption></figure><p id="2d99" class="pw-post-body-paragraph iz ja hx jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hy">内部交易高级视图</strong></p><p id="6445" class="pw-post-body-paragraph iz ja hx jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">如何查询内部交易的跟踪表(<a class="ae iy" href="https://etherscan.io/tx/0x09b8fc0deb96a27ddd9f20d8ca5d76931dc2fa5be97191ab04ce12239b0d6525/advanced#internal" rel="noopener ugc nofollow" target="_blank">来自Etherscan.io的</a>高级视图)</p><figure class="lv lw lx ly fd hk"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h2 id="6429" class="kv jy hx bd jz kw kx ky kd kz la lb kh jk lc ld kl jo le lf kp js lg lh kt li bi translated">3.crypto _ ether eum . modified _ tokens</h2><p id="e595" class="pw-post-body-paragraph iz ja hx jb b jc lj je jf jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw hb bi translated">用来自CSV 的<a class="ae iy" href="https://github.com/blockchain-etl/ethereum-etl-airflow/blob/master/dags/resources/stages/seed/data/token_amendments.csv" rel="noopener ugc nofollow" target="_blank">数据修改令牌。</a></p><p id="3317" class="pw-post-body-paragraph iz ja hx jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">首先进行重复数据删除，因为令牌表可能会因create 2<a class="ae iy" rel="noopener" href="/@jason.carver/defend-against-wild-magic-in-the-next-ethereum-upgrade-b008247839d2">https://medium . com/@ Jason . carver/defend-against-wild-magic-in-the-next-ether eum-upgrade-b 008247839 D2</a></p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="0426" class="kv jy hx ma b fi me mf l mg mh">##Query for View amended_tokens</span><span id="a9e1" class="kv jy hx ma b fi mi mf l mg mh">WITH tokens AS (<br/>    -- Deduplicate first since the tokens table might have duplicate entries due to CREATE2 <a class="ae iy" rel="noopener" href="/@jason.carver/defend-against-wild-magic-in-the-next-ethereum-upgrade-b008247839d2">https://medium.com/@jason.carver/defend-against-wild-magic-in-the-next-ethereum-upgrade-b008247839d2</a><br/>    SELECT <br/>        address,<br/>        ANY_VALUE(symbol) AS symbol,<br/>        ANY_VALUE(name) AS name,<br/>        ANY_VALUE(decimals) AS decimals,<br/>    FROM `bigquery-public-data.crypto_ethereum.tokens`<br/>    GROUP BY address<br/>)<br/>SELECT <br/>    address,<br/>    COALESCE(am.symbol, tokens.symbol) AS symbol,<br/>    COALESCE(am.name, tokens.name) AS name,<br/>    COALESCE(am.decimals, tokens.decimals) AS decimals,<br/>FROM<br/>  `blockchain-etl-internal.common.token_amendments` AS am<br/>FULL OUTER JOIN<br/>  tokens<br/>USING(address)</span></pre><h2 id="2643" class="kv jy hx bd jz kw kx ky kd kz la lb kh jk lc ld kl jo le lf kp js lg lh kt li bi translated">4.crypto _以太坊.令牌</h2><p id="851e" class="pw-post-body-paragraph iz ja hx jb b jc lj je jf jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw hb bi translated">令牌列表</p><h2 id="04aa" class="kv jy hx bd jz kw kx ky kd kz la lb kh jk lc ld kl jo le lf kp js lg lh kt li bi translated">5.crypto _ ether eum . token _ transfer</h2><p id="682c" class="pw-post-body-paragraph iz ja hx jb b jc lj je jf jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw hb bi translated">以太坊区块链上最流行的交易类型是调用ERC20类型的契约来执行传输操作，将一些令牌从一个20字节的地址移动到另一个20字节的地址。该表包含这些交易的子集，并对数据进行了进一步处理和反规范化，以使其更易于用于令牌传输事件的分析。</p><h2 id="03c8" class="kv jy hx bd jz kw kx ky kd kz la lb kh jk lc ld kl jo le lf kp js lg lh kt li bi translated">6.crypto_ethereum.logs</h2><p id="209b" class="pw-post-body-paragraph iz ja hx jb b jc lj je jf jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw hb bi translated">与token_transfers表类似，logs表包含智能合约事件的数据。但是，它包含所有日志数据，而不仅仅是ERC20令牌传输。该表通常用于报告以太坊区块链上记录的任何事件类型。</p><h2 id="2a6c" class="kv jy hx bd jz kw kx ky kd kz la lb kh jk lc ld kl jo le lf kp js lg lh kt li bi translated">7.crypto_ethereum.balances</h2><p id="034d" class="pw-post-body-paragraph iz ja hx jb b jc lj je jf jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw hb bi translated">此表包含所有地址的以太网余额，每天更新。</p><figure class="lv lw lx ly fd hk"><div class="bz dy l di"><div class="ml mm l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">运行<a class="ae iy" href="https://console.cloud.google.com/bigquery?sq=819168234572:c1cd90fa232b42a6ba31efce1f6ff67e" rel="noopener ugc nofollow" target="_blank"> BigQuery </a>。</figcaption></figure><h1 id="29d2" class="jx jy hx bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">分区字段</h1><p id="6ef2" class="pw-post-body-paragraph iz ja hx jb b jc lj je jf jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw hb bi translated">如果表在图中有分区设置，您可以看到“分区字段”。</p><p id="416e" class="pw-post-body-paragraph iz ja hx jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">使用下表时</p><ul class=""><li id="430f" class="mo mp hx jb b jc jd jg jh jk mq jo mr js ms jw mt mu mv mw bi translated">crypto _以太坊. contracts</li><li id="2050" class="mo mp hx jb b jc mx jg my jk mz jo na js nb jw mt mu mv mw bi translated">crypto_ethereum.logs</li><li id="e3fc" class="mo mp hx jb b jc mx jg my jk mz jo na js nb jw mt mu mv mw bi translated">crypto _ ether eum . token _ transfer</li><li id="2f1e" class="mo mp hx jb b jc mx jg my jk mz jo na js nb jw mt mu mv mw bi translated">crypto_ethereum.traces</li><li id="d955" class="mo mp hx jb b jc mx jg my jk mz jo na js nb jw mt mu mv mw bi translated">crypto _以太坊. transactions</li></ul><p id="8834" class="pw-post-body-paragraph iz ja hx jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">尝试使用分区字段。这将加快您的查询并降低您的成本。</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="5d44" class="kv jy hx ma b fi me mf l mg mh">WHERE transactions.block_timestamp = '2021-01-21'<br/>WHERE blocks.timestamp = '2010-12-05'</span></pre><figure class="lv lw lx ly fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nc"><img src="../Images/c7b696beb5c8d35053e04865be3be586.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KKScxVQksPPlOnEZ.png"/></div></div></figure><h1 id="57d3" class="jx jy hx bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">交互图</strong></h1><p id="935f" class="pw-post-body-paragraph iz ja hx jb b jc lj je jf jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw hb bi translated">在<a class="ae iy" href="https://dbdiagram.io/d/602e721380d742080a3b1265" rel="noopener ugc nofollow" target="_blank">https://dbdiagram.io/d/602e721380d742080a3b1265</a>找到一个包含更多列级细节的交互图。</p><figure class="lv lw lx ly fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nd"><img src="../Images/92e9a83de523131ed41c32549ad87031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fJQSbbJJ2BC4-3cJqFLQBw.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated"><a class="ae iy" href="https://dbdiagram.io/d/602e721380d742080a3b1265" rel="noopener ugc nofollow" target="_blank">https://dbdiagram.io/d/602e721380d742080a3b1265</a></figcaption></figure><h1 id="cb40" class="jx jy hx bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">学习SQL和加密货币</h1><p id="d352" class="pw-post-body-paragraph iz ja hx jb b jc lj je jf jg lk ji jj jk ll jm jn jo lm jq jr js ln ju jv jw hb bi translated">我有几个帖子可以帮助你快速学习和使用SQL处理来自不同加密货币的区块链数据。试试<a class="ae iy" href="https://rifkiamil.medium.com/the-fastest-way-to-learn-sql-with-bitcoin-data-on-a-live-database-from-google-part-1-c10480041f0a" rel="noopener">“用Google的实时数据库上的比特币数据学习SQL的最快方法”</a>。</p></div></div>    
</body>
</html>