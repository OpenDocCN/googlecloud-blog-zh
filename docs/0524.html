<html>
<head>
<title>Istio + Kubernetes on Windows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Windows上的Istio + Kubernetes</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/istio-kubernetes-on-windows-f0666b126286?source=collection_archive---------1-----------------------#2018-02-19">https://medium.com/google-cloud/istio-kubernetes-on-windows-f0666b126286?source=collection_archive---------1-----------------------#2018-02-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/a4148279e22772853ddab62b69954c40.png" data-original-src="https://miro.medium.com/v2/resize:fit:300/0*ANZYgpIy7N6V1QXs."/></div></figure><p id="f8b1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我最近一直在研究<a class="ae jk" href="https://istio.io/" rel="noopener ugc nofollow" target="_blank"> Istio </a>，一个连接和管理微服务的开放平台。在Containers和Kubernetes之后，我相信Istio是我们微服务之旅的下一步，我们将在如何管理和保护微服务的工具和方法上实现标准化。自然，我非常兴奋能得到Istio。</p><p id="e452" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">虽然在Google Kubernetes Engine (GKE)上设置Istio非常简单，但是在本地进行调试和测试总是很有用的。我特别想在我的Windows机器上的本地<a class="ae jk" href="https://github.com/kubernetes/minikube" rel="noopener ugc nofollow" target="_blank"> Minikube </a> Kubernetes集群上安装Istio。我遇到了一些小问题，我想在这里概述一下，以防对其他人有用。</p><p id="142a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我假设您已经安装并运行了一个Minikube集群。如果没有，你可以看看我在<a class="ae jk" href="https://meteatamel.wordpress.com/2018/02/14/minikube-on-windows/" rel="noopener ugc nofollow" target="_blank">之前发表的关于如何在你的Windows机器上设置和运行Minikube集群的文章</a>。Istio有一个针对Kubernetes的<a class="ae jk" href="https://istio.io/docs/setup/kubernetes/quick-start.html" rel="noopener ugc nofollow" target="_blank">快速入门教程</a>。我将遵循这一点，但它是以Linux为中心的，一些命令必须被Windows采用。</p><h1 id="756c" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">下载Istio</h1><p id="9226" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">下面是从Quickstart下载Istio的命令:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="86e9" class="kx jm hi kt b fi ky kz l la lb">curl -L <a class="ae jk" href="https://git.io/getLatestIstio" rel="noopener ugc nofollow" target="_blank">https://git.io/getLatestIstio</a> | sh -</span></pre><p id="ac11" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是一个Linux shell命令，它不能在Windows cmd或PowerShell上运行。谢天谢地，已经有人在这里写了一个等价的PowerShell脚本<a class="ae jk" href="https://gist.github.com/kameshsampath/796060a806da15b39aa9569c8f8e6bcf" rel="noopener ugc nofollow" target="_blank">。我按原样使用了脚本，只将<em class="lc">isti osition</em>更改为<em class="lc"> 0.5.1 </em>，这是截至今天的最新Istio版本:</a></p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="6d09" class="kx jm hi kt b fi ky kz l la lb">param( [string] $IstioVersion = "0.5.1" )</span></pre><p id="1b82" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">该脚本下载Istio并将一个<em class="lc"> ISTIO_HOME </em>设置为环境变量。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="374c" class="kx jm hi kt b fi ky kz l la lb">PS C:\dev\local\istio&gt; .\getLatestIstio.ps1 </span><span id="fcb4" class="kx jm hi kt b fi ld kz l la lb">Downloading Istio from <a class="ae jk" href="https://github.com/istio/istio/releases/download/" rel="noopener ugc nofollow" target="_blank">https://github.com/istio/istio/releases/download/</a> 0.5.1/istio_0.5.1_win.zip to path C:\dev\local\istio</span></pre><p id="3173" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，我将<em class="lc"> %ISTIO_HOME%\bin </em>添加到<em class="lc">路径</em>中，以确保我可以运行<em class="lc"> istoctl </em>命令。</p><h1 id="2207" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">安装并验证Istio</h1><p id="96cd" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">为了安装Istio并启用边车之间的相互TLS认证，我在<a class="ae jk" href="https://istio.io/docs/setup/kubernetes/quick-start.html" rel="noopener ugc nofollow" target="_blank">快速入门</a>中运行了相同的命令:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="dc1c" class="kx jm hi kt b fi ky kz l la lb">PS C:\istio-0.5.1&gt; kubectl apply -f install/kubernetes/istio-auth.yaml </span><span id="f9e8" class="kx jm hi kt b fi ld kz l la lb">namespace "istio-system" created clusterrole <br/>"istio-pilot-istio-system" created clusterrole <br/>"istio-sidecar-injector-istio-system" created clusterrole <br/>"istio-mixer-istio-system" created clusterrole <br/>"istio-ca-istio-system" created clusterrole <br/>"istio-sidecar-istio-system" created</span></pre><p id="bfc7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">并验证所有Istio pods都在运行:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="eae4" class="kx jm hi kt b fi ky kz l la lb">PS C:\istio-0.5.1&gt; kubectl get pods -n istio-system </span><span id="87c3" class="kx jm hi kt b fi ld kz l la lb">NAME READY STATUS RESTARTS AGE <br/>istio-ca-797dfb66c5-x4bzs 1/1 Running 0 2m <br/>istio-ingress-84f75844c4-dc4f9 1/1 Running 0 2m <br/>istio-mixer-9bf85fc68-z57nq 3/3 Running 0 2m <br/>istio-pilot-575679c565-wpcrf /2 Running 0 2m</span></pre><h1 id="b791" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">部署示例应用程序</h1><p id="4f24" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">在Windows上部署应用程序也略有不同。要使用Envoy容器注入部署BookSample应用程序，您通常会在Linux上运行以下命令:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="ad94" class="kx jm hi kt b fi ky kz l la lb">kubectl create -f &lt;(istioctl kube-inject -f samples/bookinfo/kube/bookinfo.yaml)</span></pre><p id="7791" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">重定向会导致PowerShell出现问题。相反，您可以首先运行<em class="lc"> istioctl </em>命令，并将其保存到一个中间yaml:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="f5e7" class="kx jm hi kt b fi ky kz l la lb">istioctl kube-inject -f .\samples\bookinfo\kube\bookinfo.yaml &gt; bookinfo_inject.yaml</span></pre><p id="028c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，您可以应用中间yaml:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="2fa8" class="kx jm hi kt b fi ky kz l la lb">PS C:\istio-0.5.1&gt; kubectl create -f .\bookinfo_inject.yaml </span><span id="6ae7" class="kx jm hi kt b fi ld kz l la lb">service "details" created <br/>deployment "details-v1" created <br/>service "ratings" created <br/>deployment "ratings-v1" created <br/>service "reviews" created <br/>deployment "reviews-v1" created <br/>deployment "reviews-v2" created <br/>deployment "reviews-v3" created <br/>service "productpage" created <br/>deployment "productpage-v1" created <br/>ingress "gateway" created</span></pre><p id="6493" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这样，您将拥有由Istio部署和管理的BookInfo应用程序。希望这有助于让Istio + Kubernetes在Windows上的Minikube中运行。</p></div><div class="ab cl le lf gp lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="hb hc hd he hf"><p id="17c9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="lc">原载于2018年2月19日</em><a class="ae jk" href="https://meteatamel.wordpress.com/2018/02/19/istio-kubernetes-on-windows/" rel="noopener ugc nofollow" target="_blank"><em class="lc">【meteatamel.wordpress.com】</em></a><em class="lc">。</em></p></div></div>    
</body>
</html>