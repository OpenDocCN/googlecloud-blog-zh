<html>
<head>
<title>Using Secret Manager and Cloud Functions to send mail with SendGrid</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Secret Manager和Cloud函数通过SendGrid发送邮件</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/using-secret-manager-and-cloud-functions-to-send-mail-with-sendgrid-f2f1df684278?source=collection_archive---------1-----------------------#2022-01-06">https://medium.com/google-cloud/using-secret-manager-and-cloud-functions-to-send-mail-with-sendgrid-f2f1df684278?source=collection_archive---------1-----------------------#2022-01-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7827" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为谷歌云工作，我最喜欢的一件事是有机会分享我学到的东西，并将其推广给他人。在之前的一篇文章中，我写了一个使用谷歌云功能从云发布/订阅发送电子邮件的项目。在这种特殊情况下，要求只使用本地SMTP功能，并且所有消息都必须来自静态IP。</p><p id="a242" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我有机会在没有这些要求的情况下重新审视这一点，并以不同的方式来做这件事。我仍然使用<a class="ae jd" href="https://cloud.google.com/functions" rel="noopener ugc nofollow" target="_blank">云功能</a>，但是调用SendGrid来完成这项工作。SendGrid是Google Cloud Marketplace上可用的电子邮件服务之一。</p><p id="e24c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注册SendGrid后，我必须生成一个API密匙。像任何种类的凭证一样，API密钥需要受到保护。我决定用<a class="ae jd" href="https://cloud.google.com/secret-manager" rel="noopener ugc nofollow" target="_blank">的秘密经理</a>来做这件事。您使用Secret Manager来存储<em class="je">秘密</em>(比如密码、密钥等等)。Secret Manager对信息进行加密，并支持版本控制和资源许可。您只需创建一个服务帐户，并在Secret Manager控制台中添加<a class="ae jd" href="https://cloud.google.com/secret-manager/docs/access-control" rel="noopener ugc nofollow" target="_blank"> Secret Accessor </a>权限，然后将该服务帐户附加到云功能。</p><p id="e3d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我开发了两个云函数，一个处理来自云发布/订阅的消息，另一个处理来自HTTP调用的消息。云函数解析消息，从Secret Manager获取API密钥，然后调用SendGrid。这是两个用例的图表。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/1acd627e320d1b4a6c5ef41e8ae05476.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1hbsJcOh0WORofRUgdFGvQ.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">使用Secret Manager从云发布/订阅中调用SendGrid的云函数</figcaption></figure><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es jv"><img src="../Images/e5ed50f4970cbf3ed21771ef0d6d24bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*lcVvzdd5ID3eEXHQ0HRxIA.png"/></div></figure><p id="63b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想了解更多这方面的信息，可以看看GitHub repo 。此外，请注意，虽然我为谷歌云工作，但我是以个人名义写作，而不是以任何官方身份。</p><p id="00db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">编码快乐！</p></div></div>    
</body>
</html>