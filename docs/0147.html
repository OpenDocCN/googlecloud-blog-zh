<html>
<head>
<title>Comparing tweets about Trump &amp; Hillary with natural language processing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用自然语言处理比较关于特朗普和希拉里的推文</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/comparing-tweets-about-trump-hillary-with-natural-language-processing-a0064e949666?source=collection_archive---------0-----------------------#2016-09-12">https://medium.com/google-cloud/comparing-tweets-about-trump-hillary-with-natural-language-processing-a0064e949666?source=collection_archive---------0-----------------------#2016-09-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5410" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">人们在推特上是如何谈论希拉里和特朗普的？使用我在这里使用的相同方法来分析关于奥运会的推文，我处理了9月9日到10日关于两位候选人的30万条推文的数据。这是我想到的:</p><h2 id="39e4" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated"><strong class="ak">热门<em class="jz">形容词</em>在以希拉里或川普为主题的推文中使用</strong></h2><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ka"><img src="../Images/410a7874f206b5c3de5b0f36b1704a7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0NEm_t-gb6MY5Y9hSEdCHw.png"/></div></div></figure><h2 id="27a4" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">在以希拉里或特朗普为主题的推文中使用的顶级动词</h2><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es km"><img src="../Images/c1f395a10eba1d17c85480b184ba733e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BldCw2h_CtENbu_GPoOyWg.png"/></div></div></figure><h2 id="5bd1" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated"><strong class="ak">选举推文中最常用的表情符号</strong></h2><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kn"><img src="../Images/0d9a0d7dee835a4c7f88436be9c9a0ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DUb0dLjYHy8G_ffDK5_FbQ.png"/></div></div></figure><p id="ac67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我用了哪些工具？</p><ul class=""><li id="1e98" class="ko kp hi ih b ii ij im in iq kq iu kr iy ks jc kt ku kv kw bi translated"><a class="ae jd" href="https://dev.twitter.com/streaming/overview" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Twitter流媒体API </strong> </a>:获取所有选举推文</li><li id="1c5c" class="ko kp hi ih b ii kx im ky iq kz iu la iy lb jc kt ku kv kw bi translated"><a class="ae jd" href="https://cloud.google.com/natural-language/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">云自然语言API </strong> </a>:解析推文&amp;获取语法数据</li><li id="677b" class="ko kp hi ih b ii kx im ky iq kz iu la iy lb jc kt ku kv kw bi translated"><a class="ae jd" href="https://cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> BigQuery </strong> </a>:分析推文语法数据</li><li id="c105" class="ko kp hi ih b ii kx im ky iq kz iu la iy lb jc kt ku kv kw bi translated"><a class="ae jd" href="https://www.tableau.com/stories/topic/google-cloud-platform" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">Tableau</strong></a><strong class="ih hj"/>和一些JavaScript技巧:可视化数据</li></ul><h1 id="3706" class="lc jf hi bd jg ld le lf jk lg lh li jo lj lk ll jr lm ln lo ju lp lq lr jx ls bi translated"><strong class="ak"> Twitter流媒体API:获取所有选举推文</strong></h1><p id="3b7b" class="pw-post-body-paragraph if ig hi ih b ii lt ik il im lu io ip iq lv is it iu lw iw ix iy lx ja jb jc hb bi translated">我使用Node.js的<a class="ae jd" href="https://dev.twitter.com/streaming/overview" rel="noopener ugc nofollow" target="_blank"> Twitter流媒体API </a>来传输提到希拉里或特朗普的推文。你可以在第一行代码中看到我寻找的粗体搜索词:</p><pre class="kb kc kd ke fd ly lz ma mb aw mc bi"><span id="bb96" class="je jf hi lz b fi md me l mf mg">var search_terms = '<strong class="lz hj">#Trump2016</strong>,<strong class="lz hj">#ImWithHer</strong>,<strong class="lz hj">@HillaryClinton</strong>,<strong class="lz hj">@realdonaldtrump</strong>,<strong class="lz hj">#NeverTrump</strong>,<strong class="lz hj">#MakeAmericaGreatAgain</strong>,<strong class="lz hj">Hillary Clinton</strong>,<strong class="lz hj">Donald Trump</strong>';</span><span id="6df7" class="je jf hi lz b fi mh me l mf mg">client.stream('statuses/filter', {track: search_terms}, function(stream) {</span><span id="bad6" class="je jf hi lz b fi mh me l mf mg">  stream.on('data', function(tweet) {<br/>    if (tweet.text.substring(0,2) != 'RT') {<br/>      callNLApi(tweet);<br/>    }<br/>  });</span><span id="817b" class="je jf hi lz b fi mh me l mf mg">  stream.on('error', function(error) {<br/>    console.log(error);<br/>  });<br/> <br/>});</span></pre><p id="3f5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有一次我得到一条tweet(不包括那些以“RT”开头的)，我把它发给自然语言API进行语法分析。</p><h1 id="b151" class="lc jf hi bd jg ld le lf jk lg lh li jo lj lk ll jr lm ln lo ju lp lq lr jx ls bi translated"><strong class="ak">云自然语言API:解析推文</strong></h1><p id="538f" class="pw-post-body-paragraph if ig hi ih b ii lt ik il im lu io ip iq lv is it iu lw iw ix iy lx ja jb jc hb bi translated">新的<a class="ae jd" href="https://cloud.google.com/natural-language/" rel="noopener ugc nofollow" target="_blank">云自然语言API </a>有三种方法——语法标注、实体和情感分析。在这里，我将重点关注语法注释，但你可以查看这篇文章了解其他两个的细节。语法注释响应为您提供了有关句子结构和每个单词的词性的详细信息。Tweets经常缺少标点符号，并且语法不总是正确的，但是NL API仍然能够解析它们并提取语法数据。例如，<a class="ae jd" href="https://twitter.com/Newsweek/status/774668800906043392" rel="noopener ugc nofollow" target="_blank">这是我上传的大约30万条推文中的一条</a>:</p><blockquote class="mi mj mk"><p id="6ba6" class="if ig ml ih b ii ij ik il im in io ip mm ir is it mn iv iw ix mo iz ja jb jc hb bi translated">唐纳德·川普是唯一的拒绝者，副总统候选人迈克·彭斯公布了他的纳税申报单</p></blockquote><p id="0c43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是API为该推文返回的语法数据的可视化(您可以在这里创建自己的<a class="ae jd" href="https://cloud.google.com/natural-language/#nl_demo_section" rel="noopener ugc nofollow" target="_blank"/>):</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es mp"><img src="../Images/3a627f6248f4e5e54a43b1c06bf2c918.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w31q0sj5wSPxsFxwf49gqA.png"/></div></div></figure><p id="ffde" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">API的JSON响应为您提供了上述依赖解析树中可视化的所有数据。它为句子中的每个标记返回一个对象(标记是一个单词或标点)。下面是上例中一个令牌的JSON响应示例，这里是单词“releases”:</p><pre class="kb kc kd ke fd ly lz ma mb aw mc bi"><span id="1e9c" class="je jf hi lz b fi md me l mf mg">{<br/>  "text": {<br/>    "content": "releases",<br/>    "beginOffset": -1<br/>  },<br/>  "partOfSpeech": {<br/>    "tag": "VERB"<br/>  },<br/>  "dependencyEdge": {<br/>    "headTokenIndex": 2,<br/>    "label": "ADVCL"<br/>  },<br/>  "lemma": "release"<br/>}</span></pre><p id="56da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来分析一下答案:<strong class="ih hj">标签</strong>告诉我们‘发布’是一个动词。标签告诉我们这个词在上下文中的作用。这里是<strong class="ih hj"> ADVCL </strong>，代表状语从句修饰语。<strong class="ih hj"> headTokenIndex </strong>表示弧在依赖解析树中到这个标记的位置，每个标记作为一个索引。<strong class="ih hj"/><a class="ae jd" href="https://en.wikipedia.org/wiki/Lemma_(morphology)" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">lemma</strong></a>是单词的词根形式，如果你在统计一个单词的出现次数，并且想要合并重复项，这是很有用的(注意“releases”的lemma是“release”)。</p><p id="02eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是我对NL API的请求:</p><pre class="kb kc kd ke fd ly lz ma mb aw mc bi"><span id="b41f" class="je jf hi lz b fi md me l mf mg">function callNLApi(tweetData) {<br/>  var requestUrl = "https://language.googleapis.com/v1beta1/documents:annotateText?key=API_KEY"</span><span id="5fba" class="je jf hi lz b fi mh me l mf mg">  var requestBody = {<br/>    “document”: {<br/>       “type”: “PLAIN_TEXT”,<br/>       “content”: tweetData.text<br/>     }<br/>  }</span><span id="0516" class="je jf hi lz b fi mh me l mf mg">  var options = {<br/>    url: requestUrl,<br/>    method: “POST”,<br/>    body: requestBody,<br/>    json: true<br/>  }</span><span id="0983" class="je jf hi lz b fi mh me l mf mg">  request(options, function(err, resp, body) {<br/>    if (!err &amp;&amp; resp.statusCode == 200){</span><span id="0726" class="je jf hi lz b fi mh me l mf mg">      var tokens = body.tokens;<br/>      // Do something with the tokens</span><span id="ab7e" class="je jf hi lz b fi mh me l mf mg">    } <br/>  }<br/>}</span></pre><p id="d6f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我有了JSON格式的所有语法数据，有无数种方法可以分析它。我决定将每条推文插入到一个BigQuery表中，并在以后找出如何分析它，而不是在推文进来时进行分析。</p><h1 id="6122" class="lc jf hi bd jg ld le lf jk lg lh li jo lj lk ll jr lm ln lo ju lp lq lr jx ls bi translated"><strong class="ak"> BigQuery:分析推文中的语言趋势</strong></h1><p id="daa7" class="pw-post-body-paragraph if ig hi ih b ii lt ik il im lu io ip iq lv is it iu lw iw ix iy lx ja jb jc hb bi translated">我创建了一个包含所有推文的<a class="ae jd" href="https://cloud.google.com/bigquery/" rel="noopener ugc nofollow" target="_blank"> BigQuery </a>表，然后运行一些SQL查询来寻找语言趋势。下面是我的BigQuery表的模式:</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es mq"><img src="../Images/b484da242710971be522f50e4eb55368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dKFZ5hYbVzMZRgJp7YTVyw.png"/></div></div><figcaption class="mr ms et er es mt mu bd b be z dx translated">BigQuery表模式(每行是一条tweet)</figcaption></figure><p id="113f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用Google-cloud NPM包将每条推文插入到我的表格中，只用了几行JavaScript代码:</p><pre class="kb kc kd ke fd ly lz ma mb aw mc bi"><span id="22b7" class="je jf hi lz b fi md me l mf mg">var row = {<br/>     id: tweet.id,<br/>     text: tweet.text,<br/>     created_at: tweet.created_at,<br/>     user_followers_count: tweet.user.followers,<br/>     hashtags: JSON.stringify(tweet.hashtags),<br/>     tokens: JSON.stringify(body.tokens)<br/>};</span><span id="bc0b" class="je jf hi lz b fi mh me l mf mg">table.insert(row, function(error, insertErr, apiResp) {<br/>  if (error) {<br/>    console.log('err', error);<br/>  } else if (insertErr.length == 0) {<br/>    console.log('success!');<br/>  }<br/>});</span></pre><p id="2b6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ml">现在该分析数据了！我的表中的tokens列是一个巨大的JSON字符串。幸运的是，BigQuery支持<a class="ae jd" href="https://cloud.google.com/bigquery/user-defined-functions" rel="noopener ugc nofollow" target="_blank">用户定义函数</a>(UDF)，这允许您编写JavaScript函数来解析表中的数据。</em></p><p id="ff4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了识别形容词，我查找了NL API返回的所有标记，其中<strong class="ih hj"> ADJ </strong>作为它们的<strong class="ih hj">部分语音</strong>标签。但我不想要我收集的所有推文中的<em class="ml">所有</em>形容词，我真的只想要那些以希拉里或川普为句子主题的推文中的形容词。NL API使用<strong class="ih hj"> NSUBJ </strong>(名义主题)标签来过滤符合这个标准的tweets。<a class="ae jd" href="https://gist.github.com/sararob/c1701d78523d4efe741203c08cc6a4bf" rel="noopener ugc nofollow" target="_blank">下面是完成的查询</a>(内嵌UDF)——它统计了所有以希拉里或川普为名词性主语的推文中的形容词。</p><p id="4916" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了统计表情符号，我修改了我的UDF来寻找所有带有partOfSpeech标签为<strong class="ih hj"> X </strong>(表示外国字符)的符号，并使用一个正则表达式来提取所有表情符号字符(感谢<a class="ae jd" href="https://twitter.com/mathias" rel="noopener ugc nofollow" target="_blank"> Mathias </a>提供的<a class="ae jd" href="https://github.com/mathiasbynens/emoji-regex" rel="noopener ugc nofollow" target="_blank">表情符号正则表达式</a>！).以下是查询:</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es mv"><img src="../Images/fbbccc5954138c1b4eb0e7b4cc3c56f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UCbHEZpPCCZ4zPlHAfFgIQ.png"/></div></div></figure><p id="6aa3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出是:</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es mw"><img src="../Images/903a8df42398081bca4ee4eb4df6d652.png" data-original-src="https://miro.medium.com/v2/resize:fit:300/format:webp/1*TqbalEXn6AgpdQVoer9Smg.png"/></div></figure><p id="d130" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当以表情符号标记云的形式查看时，这些数据会更有趣，详见下一节我是如何做到的。</p><h1 id="c3ca" class="lc jf hi bd jg ld le lf jk lg lh li jo lj lk ll jr lm ln lo ju lp lq lr jx ls bi translated"><strong class="ak">可视化数据</strong></h1><p id="45d9" class="pw-post-body-paragraph if ig hi ih b ii lt ik il im lu io ip iq lv is it iu lw iw ix iy lx ja jb jc hb bi translated">我最喜欢BigQuery的一点是它与数据可视化工具的集成，如<a class="ae jd" href="http://www.tableau.com/" rel="noopener ugc nofollow" target="_blank"> Tableau </a>、<a class="ae jd" href="https://www.google.com/analytics/data-studio/" rel="noopener ugc nofollow" target="_blank"> Data Studio </a>和<a class="ae jd" href="https://zeppelin.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Zeppelin </a>。我将我的BigQuery表连接到Tableau来创建如上所示的条形图。Tableau允许您根据正在处理的数据类型创建各种不同的图表。这里有一个饼状图，显示了我收集的推文中的前10个标签(小写以消除重复):</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es mx"><img src="../Images/2a5755951b90311aba783d2ed407c47c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YIC_vhCF5UjQEfzBDzIayw.png"/></div></div></figure><p id="1343" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了制作表情符号标记云，我从我的表情符号查询中下载了JSON:</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es my"><img src="../Images/3ee5f1b59c2bf59d22406011e2963dca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7sZkmoxp0eXpjSClLO555w.png"/></div></div></figure><p id="85ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后使用这个方便的<a class="ae jd" href="https://github.com/lucaong/jQCloud" rel="noopener ugc nofollow" target="_blank"> JavaScript库</a>生成单词云。</p><h1 id="bb37" class="lc jf hi bd jg ld le lf jk lg lh li jo lj lk ll jr lm ln lo ju lp lq lr jx ls bi translated">下一步是什么？</h1><ul class=""><li id="b04d" class="ko kp hi ih b ii lt im lu iq mz iu na iy nb jc kt ku kv kw bi translated">开始使用<strong class="ih hj">自然语言API </strong>:在浏览器中试用<a class="ae jd" href="https://cloud.google.com/natural-language/#nl_demo_section" rel="noopener ugc nofollow" target="_blank">，深入</a><a class="ae jd" href="https://cloud.google.com/natural-language/docs/" rel="noopener ugc nofollow" target="_blank">文档</a>，或者查看 <a class="ae jd" href="https://rominirani.com/tutorial-google-cloud-natural-language-api-910740100378#.obxvl0vpo" rel="noopener ugc nofollow" target="_blank">的</a><a class="ae jd" href="https://cloud.google.com/blog/big-data/2016/08/structuring-unstructured-text-with-the-google-cloud-natural-language-api" rel="noopener ugc nofollow" target="_blank"> one </a> <a class="ae jd" href="https://cloud.google.com/blog/big-data/2016/07/using-the-cloud-natural-language-api-to-analyze-harry-potter-and-the-new-york-times" rel="noopener ugc nofollow" target="_blank">这些</a>博客文章以获取更多信息</li><li id="b8ed" class="ko kp hi ih b ii kx im ky iq kz iu la iy lb jc kt ku kv kw bi translated">从<strong class="ih hj"> BigQuery </strong>开始:关注<a class="ae jd" href="https://cloud.google.com/bigquery/quickstart-web-ui" rel="noopener ugc nofollow" target="_blank"> Web UI快速入门</a>或查看<a class="nc nd ge" href="https://medium.com/u/279fe54c149a?source=post_page-----a0064e949666--------------------------------" rel="noopener" target="_blank"> Felipe Hoffa </a>的任何中型帖子</li></ul><p id="5eb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有问题吗？在Twitter上找到我或者在评论中告诉我你的想法。</p></div></div>    
</body>
</html>