<html>
<head>
<title>Advanced Caching Part 1: Google Cloud CDN and Varnish</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">高级缓存第1部分:Google Cloud CDN和Varnish</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/advanced-caching-part-1-google-cloud-cdn-and-varnish-e63d79252367?source=collection_archive---------0-----------------------#2019-08-19">https://medium.com/google-cloud/advanced-caching-part-1-google-cloud-cdn-and-varnish-e63d79252367?source=collection_archive---------0-----------------------#2019-08-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/cc65eadb0259f0379353abce0d4bc1d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oTMExIh5is_3JByFxNeB-g.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">Google Cloud CDN和Varnish Cache可以加速您的最终用户体验</figcaption></figure><div class=""/><p id="3d93" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi js translated"><span class="l jt ju jv bm jw jx jy jz ka di"> G </span> <a class="ae kb" href="https://cloud.google.com/cdn/" rel="noopener ugc nofollow" target="_blank"> oogle Cloud CDN </a>是一个轻量级的内容交付网络解决方案。它抵消了后端的负载。当然，它大大减少了最终用户的HTTP响应时间。当这还不够时，还有<a class="ae kb" href="https://varnish-cache.org" rel="noopener ugc nofollow" target="_blank">清漆缓存</a>。</p><p id="46fc" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这篇博文将带您了解如何在Google Cloud中实现Varnish的高级缓存规则。这可以在Google Cloud CDN背后完成，也可以完全靠自己。它解决了编辑HTML响应主体的需要，以便可以缓存伪动态内容。</p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="972c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi js translated">arnish Cache缩小了与Google Cloud的CDN差距。Varnish允许您以声明方式设置缓存规则。这是通过使用一个名为<a class="ae kb" href="https://varnish-cache.org/docs/5.2/users-guide/esi.html" rel="noopener ugc nofollow" target="_blank">的功能完成的，边缘侧包括</a> (ESIs)。</p><figure class="kk kl km kn fd hk er es paragraph-image"><div class="er es kj"><img src="../Images/8a77a765560ae935817ddfbfb830f9bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*IfE1O9jlk_NDZzbFttPiqA.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">Edge Side Includes (ESIs)允许直接在Varnish缓存服务器上编辑HTML响应</figcaption></figure><p id="be60" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> 1。谷歌云平台<br/> </strong>登录你的谷歌云平台(GCP)控制台并导航至该平台</p><figure class="kk kl km kn fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ko"><img src="../Images/f5fcc8b2b4cc56dca98f9982a38d2a24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g37CTCjvo3GwCstWqwlzbg.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">流行服务的可信虚拟机映像在谷歌云市场中</figcaption></figure><p id="8d3e" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> 2。选择一个清漆图像<br/> </strong>选择一个清漆缓存图像*，安装在谷歌计算引擎(GCE)虚拟机(VM)上</p><figure class="kk kl km kn fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kp"><img src="../Images/cc9c93682388f7f015d78f8b5f84a948.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KGZpLJoVQAndEAfo2opl8Q.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">Varnish Cache是一个反向代理，具有HTML(和其他)响应的高级缓存</figcaption></figure><p id="a7ff" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> 3。部署映像<br/> </strong>启动会将您导航到GCP控制台的GCE部分</p><figure class="kk kl km kn fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kq"><img src="../Images/31f2c4064197fe8376ff912645661b53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HYRT5KOF7ClaztZEV4Pj0Q.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">虚拟机映像可以直接从市场启动到GCE实例上</figcaption></figure><p id="52df" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> 4。选择机器类型<br/> </strong>根据您的用例，您可能想要选择强大的虚拟机<br/>或者，考虑在Google Kubernetes引擎(GKE)集群中手动部署Varnish</p><figure class="kk kl km kn fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kr"><img src="../Images/28f39995a7d8409b1a2415ee3f988aca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FRgs8WAWumrX0vX7QimuuA.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">出于开发目的，一台双CPU机器就足够了</figcaption></figure><p id="c0bb" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> 5。映像无缝部署</strong></p><p id="b81b" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">GCP市场映像优雅地为您配置了虚拟机和网络端口</p><figure class="kk kl km kn fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ks"><img src="../Images/a34b6aef2a63327cdbc841142c094ca5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0NfRTQ3BZiuNoX6mMWj6BQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">清漆图像在技术上是一个容器，在引擎盖下</figcaption></figure><p id="cf96" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">6。Edge Side包括(<a class="ae kb" href="http://book.varnish-software.com/4.0/chapters/Content_Composition.html#edge-side-includes" rel="noopener ugc nofollow" target="_blank">link</a>)<strong class="iw hy"><br/></strong>esis允许您将内容注入到Varnish机器上的响应主体<br/>中，创建具有&lt; esi &gt;标签<br/>的web文件这里我们将PHP放入HTML文件中，以演示除ESI之外的脚本编写</p><figure class="kk kl km kn fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kt"><img src="../Images/2749537d7b70e723c06a2960b71e979f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nTch4WVkfz5ydrI5grqj7w.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated"><esi>标签引用了一个单独的HTML文件</esi></figcaption></figure><p id="6d46" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们创建第二个web文件，上面的<esi>标记引用了这个文件<br/>。第二个文件包含JavaScript，它将在最终用户的浏览器中运行</esi></p><figure class="kk kl km kn fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ku"><img src="../Images/15bd854e4baa18ed96ef09c216378e4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pf5L6A7J0AGtTVyESXoFcw.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">HTML文件包含动态填充响应的JavaScript</figcaption></figure><p id="82e7" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> 7。ESI在Google Cloud工作！<br/> </strong>在下面的HTTP响应中，PHP代码在服务器上运行<br/> <strong class="iw hy">然而</strong>，Varnish &lt; esi &gt;标签根据需要插入了JavaScript<br/>这个HTTP响应因此被Varnish <br/>有效地缓存，这是一个伪动态网页的缓存</p><figure class="kk kl km kn fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kv"><img src="../Images/236193d90b3df90ad34fe637f38d4025.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S9IPeBOm34JgqAyNY6tK1w.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">Varnish的ESI服务构建响应体，插入JavaScript，从而缓存伪动态响应</figcaption></figure></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="1e0e" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy">谷歌云CDN最佳实践</strong> ( <a class="ae kb" href="https://cloud.google.com/cdn/docs/best-practices" rel="noopener ugc nofollow" target="_blank">链接</a>)</p><figure class="kk kl km kn fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kw"><img src="../Images/e94b95b4e9d9858e39dfde3ad80a4f7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XkJpQdHJgjZDYBOP7AOorg.png"/></div></div></figure></div></div>    
</body>
</html>