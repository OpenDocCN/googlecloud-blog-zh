<html>
<head>
<title>Visualize GCP Architecture using Forseti 2.0 and D3.js!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用凡赛堤2.0和D3.js可视化GCP建筑！</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/visualize-gcp-architecture-using-forseti-2-0-and-d3-js-ffc8fdf59450?source=collection_archive---------0-----------------------#2018-11-27">https://medium.com/google-cloud/visualize-gcp-architecture-using-forseti-2-0-and-d3-js-ffc8fdf59450?source=collection_archive---------0-----------------------#2018-11-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="83e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"><em class="jd">= = 2019-8-16更新= =</em>=</strong></p><p id="60ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">我的好朋友Garrett 10x倍放大了下面的想法，并在</em></strong><a class="ae je" href="https://cloud.google.com/blog/products/identity-security/understand-gcp-organization-resource-hierarchies-with-forseti-visualizer" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj"><em class="jd">https://cloud . Google . com/blog/products/identity-security/understand-GCP-organization-resource-hierarchy-with-forse ti-visualizer</em></strong></a></p><p id="7182" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然下面的一切应该仍然可以工作(尽管有一些小的调整，因为凡赛堤版本)，我强烈建议你看看他正在做的伟大的东西！干杯！ </p><p id="d3f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd"> MZ </em> </strong></p><p id="4b5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"><em class="jd">= =/更新== </em> </strong></p><p id="de06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">客户和同事通常很难创建他们的云应用程序架构的手绘图表，并且随着情况的变化保持这些图表的更新也不是一件有趣的事情…</p><p id="26b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是现在，通过结合<a class="ae je" href="https://forsetisecurity.org/?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=q4_2018_gcp_visualization" rel="noopener ugc nofollow" target="_blank">凡赛堤安全</a>的库存扫描器、一些聪明但相当粗糙的云SQL和<a class="ae je" href="https://d3js.org/" rel="noopener ugc nofollow" target="_blank"> D3.js </a>可折叠树，你可以自动生成代表你的GCP环境的交互式架构图，就像这个…</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/c4ced665265941469521b811c18013fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VS9cGmwYzNf3XNQ1"/></div></div></figure><p id="cc0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经记录了下面的冒险和说明，但是如果你想跳到好的东西，代码在GitHub <a class="ae je" href="https://github.com/GoogleCloudPlatform/professional-services/tree/master/tools/gcp-arch-viz" rel="noopener ugc nofollow" target="_blank">这里</a>上，在web上有一个工作版本<a class="ae je" href="https://storage.googleapis.com/forsetiviz-external/gcp-arch-viz.html" rel="noopener ugc nofollow" target="_blank">这里</a> …干杯！</p><h1 id="e420" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">背景</h1><p id="735e" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">我告诉你一个小秘密——我绝对讨厌写文档。我一直很讨厌它。好了，我说了。我不后悔…</p><p id="a4bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我以写代码为生时，那主要意味着连接类/继承图，而现在在我作为云工程师的角色中，是GCP架构图。当然，当你只有少量的课程、项目或资源时，这并不是那么糟糕。您可能可以将整个内容放在一个合理大小的白板上。但是，一旦事情开始变得更大、更严重，并开始改变以适应您的业务需求，事情就会很快失控(并且过时)!</p><p id="776c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对我来说，事实是这样的:在一个活生生的、呼吸的、不断变化的环境中保持手写文档的更新是一场必败的战斗，我只是不想再这样做了。你也不应该。依我看，最好的文档是自动文档，直接从你需要记录的东西中生成…</p><p id="69e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在之前的软件开发人员生涯中，我们通过一个在代码提交时触发的<a class="ae je" href="https://jenkins.io/" rel="noopener ugc nofollow" target="_blank"> Jenkins </a>作业来自动化这一点，运行<a class="ae je" href="http://www.stack.nl/~dimitri/doxygen/" rel="noopener ugc nofollow" target="_blank"> doxygen </a>和<a class="ae je" href="https://www.graphviz.org/" rel="noopener ugc nofollow" target="_blank"> graphviz </a>的组合来读取/分析我们的代码，并输出带有漂亮的类层次图的精美网页。有点像这样:</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es ku"><img src="../Images/cc5e6300e67963ef4abf9b7cc67004b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*Z2FwyFm-x90dHUjR9tVE3w.png"/></div><figcaption class="kv kw et er es kx ky bd b be z dx translated"><em class="kz">来源:</em><a class="ae je" href="https://www.vtk.org/doc/nightly/html/classvtkIdList.html" rel="noopener ugc nofollow" target="_blank"><em class="kz">https://www.vtk.org/doc/nightly/html/classvtkIdList.html</em></a></figcaption></figure><p id="860d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在GCP的世界里，这应该是一样容易的，我想要建造它。但是，为了做到这一点，我需要几个不同的部分:</p><ul class=""><li id="26ac" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lf lg lh li bi translated">扫描一个GCP组织，并列出所有存在的东西。如果所述扫描器跟踪层级(父/子关系)和组织(哪些事物是另一事物的组件——想想网络中的虚拟机),则加分</li><li id="7ee8" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">一些以一种有用和动态的方式描绘GCP建筑的东西。加分这里我们可以用大幅面打印机把图片打印出来。</li><li id="50ec" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">某种方式将第一件事的输出粘合到第二件事的输入中。</li></ul><p id="fdbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">剧透警告</strong>——上面所有的部分都存在，我把它们连接在一起，看起来像这样:</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/ad7946998dee9b1317b8b109c9b7a201.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*umeANTDE5d4fmqiF"/></div></div><figcaption class="kv kw et er es kx ky bd b be z dx translated"><em class="kz">工作示例:</em><a class="ae je" href="https://storage.googleapis.com/forsetiviz-external/gcp-arch-viz.html" rel="noopener ugc nofollow" target="_blank">https://storage . Google APIs . com/forsetiviz-external/GCP-arch-viz . html</a></figcaption></figure><p id="cbc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是tl。我如何到达那里的博士(下面有更长的解释):</p><ol class=""><li id="4230" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lo lg lh li bi translated">使用<a class="ae je" href="https://forsetisecurity.org/?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=q4_2018_gcp_visualization" rel="noopener ugc nofollow" target="_blank">凡赛堤安全</a>对所有GCP资源进行清点扫描</li><li id="31f8" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lo lg lh li bi translated">连接到凡赛堤的云SQL数据库，并将最近的库存扫描导出到CSV</li><li id="8225" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lo lg lh li bi translated">将CSV数据导入HTML网页，并使用D3.js将库存数据可视化为动态的交互式树</li><li id="1667" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lo lg lh li bi translated">利润！</li></ol><p id="0b1b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">完全披露:</strong>这个初步的解决方案远没有我和<a class="lp lq ge" href="https://medium.com/u/dc8042aba528?source=post_page-----ffc8fdf59450--------------------------------" rel="noopener" target="_blank">瑞安·麦克道尔</a>不久前发表的<a class="ae je" rel="noopener" href="/google-cloud/visualize-gcp-billing-using-bigquery-and-data-studio-d3e695f90c08">计费可视化报告</a>那么完美，那是100%故意的。我的第一个帖子的目的是快速展示我们今天已经获得的部分的可能性，并获得一个工作原型&amp;代码(跳转到底部的github链接)。从那以后，我会在后续的文章中努力让架构查看器更好，因为我们都会学到更多…</p><p id="eb0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们开始吧，好吗？</p></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><h1 id="23a8" class="jr js hi bd jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko bi translated">使用凡赛堤2.0设置库存扫描</h1><p id="148f" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">首先，我们需要扫描我们的GCP环境，列出那里存在的所有文件夹、项目和其他资源。幸运的是，<a class="ae je" href="https://forsetisecurity.org/?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=q4_2018_gcp_visualization" rel="noopener ugc nofollow" target="_blank">凡赛堤安全</a> (2.0或更高版本)为我们处理了所有的GCP <a class="ae je" href="https://forsetisecurity.org/docs/latest/use/cli/inventory.html" rel="noopener ugc nofollow" target="_blank">库存扫描</a>，并创建了一个漂亮、整洁的云SQL表，其中包含父子关系。这是一个很好的开始！</p><p id="25b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置凡赛堤非常简单——这只是他们的GitHub repo的“git克隆”并运行一个设置向导，但是在开始之前有几件事情需要注意:</p><ol class=""><li id="d205" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lo lg lh li bi translated">你很可能需要以组织管理员的身份运行这个向导(或者让一个组织管理员帮你运行它)，因为需要权限。根据您公司的结构，这可能是一件大事，所以我想在这里特别强调一下…</li><li id="2c02" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lo lg lh li bi translated">与大多数云技术一样，你需要建立一个计费账户，并与你的项目相关联，以便为凡赛堤运行的基础设施付费。<strong class="ih hj">注意:持续运行凡赛堤需要成本！</strong></li><li id="0c95" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lo lg lh li bi translated">从我自己的凡赛堤项目估计大约每月125美元，并没有保证这个数字会是你在你的。您必须自行监控，并对由此产生的费用承担全部责任。也就是说，这些帖子的未来迭代完全有可能会研究定制设置和降低成本的方法，使其更容易为预算有限的人所接受…</li><li id="81f5" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lo lg lh li bi translated">关闭凡赛堤的服务器是降低成本的好方法。考虑在不使用时停止虚拟机和云SQL实例。</li></ol><p id="598c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，除了这些，你可以在这里找到官方的凡赛堤设置说明:</p><p id="7ddd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae je" href="https://forsetisecurity.org/docs/latest/setup/install.html" rel="noopener ugc nofollow" target="_blank">https://forsetisecurity.org/docs/latest/setup/install.html</a></p><p id="d48b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦您安装了凡赛堤，清单扫描器应该会自动运行，下面的步骤应该能够帮助您检查扫描的输出，并导出清单数据进行可视化…</p></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><h1 id="53bb" class="jr js hi bd jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko bi translated">导出GCP资源的快照</h1><p id="dea6" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">此时，我们应该有一个正在运行的凡赛堤实例，以及一些存储在云SQL数据库中的库存记录。让我们来看看…</p><p id="26a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，让我们连接到云SQL实例，这样我们就可以在本地运行查询。我用一个单独的谷歌计算引擎实例连接了<a class="ae je" href="https://cloud.google.com/sql/docs/mysql/connect-compute-engine" rel="noopener ugc nofollow" target="_blank">，但是你可以自由选择对你来说最容易的。最终，您只需要能够执行SQL查询，并看到结果。一旦你连接上了，这里有一些有趣的查询可以运行:</a></p><h1 id="7e53" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">获取最新清单扫描的id</h1><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="md me l"/></div><figcaption class="kv kw et er es kx ky bd b be z dx translated"><a class="ae je" href="https://gist.github.com/mzinni/824ed1c08ba8d12d096fc0111340c68f" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/mz inni/824 ed 1c 08 ba 8d 12d 096 fc 0111340 c 68 f</a></figcaption></figure><h1 id="bb0a" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">查询最新的库存记录(使用上面的“id ”)</h1><p id="75eb" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">免责声明:下面的查询中有很多不太好的地方，这就是为什么我想把它拿出来，而不是让你自己找出答案。您将看到我从大文本blob字段中进行JSON查找、引号替换和IFNULL()替换。所有这些都是使CSV输出与JS文本文件阅读器和D3.js处理配合得很好所需要的，所以要预先警告:如果你玩这个，<a class="ae je" href="https://en.wikipedia.org/wiki/Here_be_dragons" rel="noopener ugc nofollow" target="_blank">这里是龙</a> …</p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="md me l"/></div><figcaption class="kv kw et er es kx ky bd b be z dx translated"><a class="ae je" href="https://gist.github.com/mzinni/fa67f6b38e34d488604ebef3ece2dee9" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/mz inni/fa 67 f 6b 38 e 34d 488604 ebef 3 ECE 2 dee 9</a></figcaption></figure><h1 id="7a0b" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">将库存数据导出到CSV</h1><p id="061c" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">现在我们知道有数据可以处理，让我们导出最近的一组库存记录，并将该数据作为可视化实用程序的输入。方法如下:</p><ol class=""><li id="31d5" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lo lg lh li bi translated">按照这里的云SQL文档中的说明来完成导出步骤。</li><li id="10a5" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lo lg lh li bi translated">当到达输入SQL查询的部分时，直接使用上面的那个。它应该看起来像下面的图像。</li><li id="06e1" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lo lg lh li bi translated">单击Export，当数据导出操作在后台完成时，您将返回到主云SQL界面。注意:与上面的注意事项类似，这可能需要几分钟时间，具体取决于清单扫描中包括的GCP资源的数量。</li><li id="6046" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lo lg lh li bi translated">完成后，您应该将生成的CSV文件转储到Google云存储桶中。万岁。</li></ol><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es mf"><img src="../Images/ad87ddd180b3b53a1fe100cb7ff427d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*PNbWd3CLSNaoon4j"/></div></figure></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><h1 id="4620" class="jr js hi bd jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk mc km kn ko bi translated">让D3.js给你全部画出来！</h1><p id="de64" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">也许是因为我从来都不是一个UI爱好者，也许是因为我对“交互式”网站的定义是在我可以使用<code class="du mg mh mi mj b"><em class="jd">&lt;marquee&gt;</em></code>标签制作滚动文本时形成的，但这个项目是我第一次尝试使用<a class="ae je" href="https://d3js.org/" rel="noopener ugc nofollow" target="_blank">D3 . js库</a>作为可视化数据的方式。也就是说，既然我已经找到了，我想我再也不会用别的东西了。一旦你通过了最初的学习曲线，找到了一个很好的适合*如何*可视化你的数据的方法，并通过一些潜在的lib版本不匹配(*牢骚* v3/v4/V5 *牢骚*)，D3库提供了无限的能力和灵活性来可视化地讲述你的故事。所以，不用说，虽然学习曲线很艰难(现在仍然如此)，但我是一个超级粉丝…</p><p id="0afb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我开始的时候，我知道这个项目非常适合树形结构(节点、叶节点、作为组织/文件夹/项目/资源的叶)，所以我的首要任务是找到一个合适的例子。幸运的是，稍微搜索一下就找到了这些工作示例，可以作为起点(谢谢！):</p><p id="b882" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae je" href="https://bl.ocks.org/mbostock/4339083" rel="noopener ugc nofollow" target="_blank">https://bl.ocks.org/mbostock/4339083</a></p><p id="f67a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae je" href="https://wizardace.com/d3-collapsible-tree/" rel="noopener ugc nofollow" target="_blank">https://wizardace.com/d3-collapsible-tree/</a></p><p id="ec50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些例子完成了我所寻找的大部分工作——绘制多层树，以及动态展开/折叠功能，但是我知道还需要一些“定制”工作。因此，与我启动大多数项目的方式类似，我抓取了一些代码作为起点，在本地复制它，将其添加到github repo以进行版本控制，并添加到一个“哦，废话，我毁了它”安全网，然后开始黑客攻击…</p><p id="b603" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我有了本地代码，我知道我将需要一个本地web服务器来检查我的更改。这里保持它的超级整洁，我只是选择使用作为默认python安装的一部分的SimpleHTTPServer。因此，在我破解代码的目录中，我运行了以下代码:</p><p id="5881" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du mg mh mi mj b">python -m SimpleHTTPServer 8000 &amp;</code></p><p id="9694" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该命令完成并返回cmd提示符后，我启动了一个浏览器，指向:</p><p id="5bff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du mg mh mi mj b">localhost:8000/gcp-arch-viz.html</code></p><p id="ec1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">瞧，现在我已经有了“编辑代码-&gt;测试代码-&gt;提交代码”循环，我们可以自由地破解了，最安全的是我不会以不可恢复的方式破坏东西…</p><p id="9688" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从那以后，我只需要找到我想添加的功能的例子，把它们分开来理解基本原理，然后把我找到的东西改编成我想要的。让我们一点一点的快速看一下，但是没有特别的顺序…</p><h2 id="3390" class="mk js hi bd jt ml mm mn jx mo mp mq kb iq mr ms kf iu mt mu kj iy mv mw kn mx bi translated">从CSV文件加载树数据</h2><p id="1684" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">因为我想尽快将它发布出去，所以我最初选择从一个独立的CSV文件中加载库存数据，并严格要求该文件与呈现的html/javascript位于同一个目录中，并且符合非常严格的格式。这些需求使得<a class="ae je" href="https://github.com/GoogleCloudPlatform/professional-services/blob/c8dd9de62c5e645ac01599de9d1e843bcab4f73e/tools/gcp-arch-viz/gcp-arch-viz.html#L51-L58" rel="noopener ugc nofollow" target="_blank">文件处理代码</a>非常标准，我遇到的唯一的复杂情况是:</p><ol class=""><li id="cb73" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lo lg lh li bi translated">我必须记住浏览器是异步加载文件的，并且是需要的。然后()等待加载完成，并</li><li id="f247" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lo lg lh li bi translated">出于性能原因，浏览器通常会缓存一些东西，所以<a class="ae je" href="https://github.com/GoogleCloudPlatform/professional-services/blob/c8dd9de62c5e645ac01599de9d1e843bcab4f73e/tools/gcp-arch-viz/gcp-arch-viz.html#L53" rel="noopener ugc nofollow" target="_blank">在文件名</a>后面添加了一个cachebuster参数，这样我就不会疯狂地想为什么刷新页面时我的本地更改没有显示出来…</li></ol><h2 id="46e4" class="mk js hi bd jt ml mm mn jx mo mp mq kb iq mr ms kf iu mt mu kj iy mv mw kn mx bi translated">将CSV库存数据转换为D3模型</h2><p id="3b45" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">使用D3最酷的一点是，一旦你将数据转换成库可以理解的格式，大部分事情都是开箱即用的。很可爱，对吧？嗯，算是吧…</p><p id="eb19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让这个项目工作的最糟糕的部分之一是弄清楚如何解析输入CSV文件并以“正确”的方式填充D3树结构，以便D3 lib以我想要的方式绘制它。还记得我在上面讲输入CSV文件时提到的“非常严格的格式”吗？是的，所以，这种严格的格式与<a class="ae je" href="https://github.com/GoogleCloudPlatform/professional-services/blob/c8dd9de62c5e645ac01599de9d1e843bcab4f73e/tools/gcp-arch-viz/gcp-arch-viz.html#L76-L89" rel="noopener ugc nofollow" target="_blank">非常紧密地耦合在一起，即解析每个库存行</a>的代码，将特定输入位置的值分配给相应的节点变量。</p><p id="abff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">把它弄乱，哪怕是一点点，突然间<a class="ae je" href="https://github.com/GoogleCloudPlatform/professional-services/blob/c8dd9de62c5e645ac01599de9d1e843bcab4f73e/tools/gcp-arch-viz/gcp-arch-viz.html#L93-L96" rel="noopener ugc nofollow" target="_blank">链接父母和孩子的代码</a>就被弄乱了，树根本不能渲染。美好时光…</p><h2 id="df74" class="mk js hi bd jt ml mm mn jx mo mp mq kb iq mr ms kf iu mt mu kj iy mv mw kn mx bi translated">添加GCP图标</h2><p id="411a" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">在我冒险的这一点上，我有了一个工作的、交互式的树形图，它准确地反映了我的组织的根/文件夹/项目/资源层次结构，但是它看起来有点…咩…</p><p id="6390" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，当你得到一个看起来“咩”的东西时，你会怎么做呢？当然是你加图！</p><p id="e120" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在谷歌云网站上找到官方的谷歌云平台标识并不太难，一旦我在谷歌云存储上托管了我需要的标识，我所需要的就是<a class="ae je" href="https://github.com/GoogleCloudPlatform/professional-services/blob/c8dd9de62c5e645ac01599de9d1e843bcab4f73e/tools/gcp-arch-viz/gcp-arch-viz.html#L253-L292" rel="noopener ugc nofollow" target="_blank">一点图像设置代码</a>来将树的无聊圆圈变成漂亮得多的GCP官方标识。</p><h1 id="93b3" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">但是等等，为什么你的文件夹是这样摆放的？</h1><p id="37cf" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">很棒的问题！</p><p id="1b48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简而言之，我最近无意中陷入了一场有点固执己见的精彩对话，围绕着组织GCP环境的“最佳”方式，以便适应不同的团队、业务单位、开发与生产等。所以，我想我会利用那里学到的知识来建立我自己的组织，并在这个过程中，写一些关于它的东西，并给出更多的代码。你现在看到的是我下一篇文章的第一步，可能会有一个吸引人的标题，比如“用这个奇怪的技巧启动你闪亮的新GCP组织”之类的…</p><p id="21eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，请继续关注！</p><h1 id="5188" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">不要重新发明轮子！用我的代码运行吧！…</h1><p id="7bcd" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">尽管弄清楚所有D3.js的东西很有趣，但是没有理由让你一个人从头再来一遍所有的“乐趣”——这就是我在这里的目的！请随意叉下面的回购，并自行处理工作代码和CSV数据！</p><p id="9203" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae je" href="https://github.com/GoogleCloudPlatform/professional-services/tree/master/tools/gcp-arch-viz" rel="noopener ugc nofollow" target="_blank">https://github . com/Google cloud platform/professional-services/tree/master/tools/GCP-arch-viz</a></p><p id="33b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">…当然，欢迎github问题和请求！我会尽最大努力定期回顾，添加评论，合并符合我对这件事的愿景/方向的PRs。如果你想投稿，想知道我对未来的想法，看看下面的列表……:)</p><h1 id="843e" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">…而这仅仅是开始…</h1><p id="7564" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">这就是我让您的GCP环境自动绘制出来的MVP，但这绝对不是我打算停止的地方…</p><p id="d937" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们希望在未来的版本中加入其他有趣的想法(排名不分先后，GitHub即将发布！):</p><ul class=""><li id="e79d" class="la lb hi ih b ii ij im in iq lc iu ld iy le jc lf lg lh li bi translated">创建端点以从中提取清单数据(并替换CSV文件)？</li><li id="2b9b" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">水平与垂直绘图模式？</li><li id="547f" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">UI上的资源过滤器？</li><li id="4d1e" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">在UI上全部展开/全部折叠？</li><li id="a7ef" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">图标的详细信息？</li><li id="a2a6" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">平滑一些动画过渡(展开/折叠图标)？</li><li id="054b" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">VPC/网络组织的实例？</li><li id="4617" class="la lb hi ih b ii lj im lk iq ll iu lm iy ln jc lf lg lh li bi translated">每个网络的防火墙规则？</li></ul></div></div>    
</body>
</html>