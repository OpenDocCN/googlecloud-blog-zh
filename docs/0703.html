<html>
<head>
<title>Setting up a Java Development Environment for Apache Beam on Google Cloud Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Google云平台上为Apache Beam搭建Java开发环境</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/setting-up-a-java-development-environment-for-apache-beam-on-google-cloud-platform-ec0c6c9fbb39?source=collection_archive---------0-----------------------#2018-07-27">https://medium.com/google-cloud/setting-up-a-java-development-environment-for-apache-beam-on-google-cloud-platform-ec0c6c9fbb39?source=collection_archive---------0-----------------------#2018-07-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="e2fe" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">介绍</h1><p id="558c" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这些说明将向您展示如何建立并运行开发环境，以开始开发Java数据流作业。最终，你将能够以调试模式在本地运行数据流作业，在<a class="ae kb" href="https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop" rel="noopener ugc nofollow" target="_blank"> REPL </a>中执行代码以加快开发周期，并将你的作业提交给谷歌云数据流。</p><p id="8db6" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">在旅途中感觉需要Beam？在你的网络浏览器中检查<a class="ae kb" rel="noopener" href="/google-cloud/coding-apache-beam-in-your-web-browser-and-running-it-in-cloud-dataflow-c41c275d42c8">编码Apache Beam并在云数据流中运行它</a>。</p><p id="9298" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">用Python更舒服？在谷歌云平台上为Apache Beam检查<a class="ae kb" rel="noopener" href="/google-cloud/python-development-environments-for-apache-beam-on-google-cloud-platform-b6f276b344df"> Python开发环境。</a></p><h1 id="6e5b" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">什么样的工具可以支撑你的Java开发环境？</h1><p id="51e2" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">您将使用以下组件:</p><ul class=""><li id="9278" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka km kn ko kp bi translated">来自JetBrains的Java IDE。</li><li id="96d4" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">来自ASF的项目管理和理解工具。</li><li id="6d17" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated"><strong class="jf hj"> Google Cloud SDK : </strong>命令行工具，用于管理您的Google云平台项目，并将Apache Beam管道作为数据流作业提交给您。</li></ul><p id="1be3" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">想要更多吗？查看<a class="ae kb" href="https://www.jetbrains.com/idea/documentation/" rel="noopener ugc nofollow" target="_blank"> IntelliJ </a>、<a class="ae kb" href="https://maven.apache.org/" rel="noopener ugc nofollow" target="_blank"> Maven </a>、<a class="ae kb" href="https://cloud.google.com/dataflow/" rel="noopener ugc nofollow" target="_blank"> Google Dataflow </a>的官方文档。</p><h1 id="b6b2" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">你需要什么</h1><ul class=""><li id="2403" class="kh ki hi jf b jg jh jk jl jo kv js kw jw kx ka km kn ko kp bi translated">最近版本的Chrome浏览器。</li><li id="cf9c" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">Java 8 <a class="ae kb" href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" rel="noopener ugc nofollow" target="_blank"> JDK </a></li><li id="092a" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">Java的基础知识</li><li id="fd55" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">你最喜欢的CLI(即。Mac终端)</li><li id="1a07" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka km kn ko kp bi translated">现有的谷歌云项目</li></ul><h1 id="54d8" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">安装适当的软件</h1><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es ky"><img src="../Images/1aea76be831036db7dde65545c31d789.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/0*umNmTMVOWjc-Mpk2"/></div></figure><div class="kz la lb lc fd ab cb"><figure class="lg ld lh li lj lk ll paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><img src="../Images/19851e755ec5c65e3548211e1f64f3d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/0*-1ugYp-hyMgUEJEh"/></div></figure><figure class="lg ld lq li lj lk ll paragraph-image"><img src="../Images/bb8f0a9be38fc51b1c5334acd6936731.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/0*7xK_woVTfBKksh3d"/></figure><figure class="lg ld lq li lj lk ll paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><img src="../Images/a9945e70b2548e3e5ff45ce808889e68.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/0*RX2xfrr0q0_tqDzt"/></div><figcaption class="lr ls et er es lt lu bd b be z dx lv di lw lx translated">适合您环境的开发工具。</figcaption></figure></div><h2 id="b8c9" class="ly ig hi bd ih lz ma mb il mc md me ip jo mf mg it js mh mi ix jw mj mk jb ml bi translated">遵循这些安装指南(按此顺序)</h2><ol class=""><li id="27d7" class="kh ki hi jf b jg jh jk jl jo kv js kw jw kx ka mm kn ko kp bi translated"><a class="ae kb" href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" rel="noopener ugc nofollow" target="_blank"> Java 8 JDK </a></li></ol><p id="ea90" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">确保设置JAVA_HOME环境变量。</p><p id="dccd" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">如果您使用的是Mac，请将其添加到bash配置文件中。您可以在终端中运行这些命令。</p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="787b" class="ly ig hi mo b fi ms mt l mu mv">echo “export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_xxx.jdk/Contents/Home/” &gt;&gt; ~/.bash_profile<br/>source ~/.bash_profile</span></pre><p id="4c34" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">2.<a class="ae kb" href="https://cloud.google.com/sdk/" rel="noopener ugc nofollow" target="_blank">谷歌云SDK </a></p><p id="bb49" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">访问<a class="ae kb" href="https://cloud.google.com/sdk/docs/quickstart-macos" rel="noopener ugc nofollow" target="_blank"> Cloud SDK下载页面</a>，将google-cloud-sdk解压到您的/Applications目录。</p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="ca36" class="ly ig hi mo b fi ms mt l mu mv">Applications/google-cloud-sdk/install.sh<br/>export PATH=/Applications/google-cloud-sdk/bin:$PATH</span></pre><p id="322b" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">打开一个<em class="mw">新的</em>终端，运行这个命令，并在随后的提示中输入必要的信息。</p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="9a88" class="ly ig hi mo b fi ms mt l mu mv">gcloud init</span></pre><p id="e393" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">确保您的SDK版本是最新的。</p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="bea1" class="ly ig hi mo b fi ms mt l mu mv">gcloud components update</span></pre><ol class=""><li id="15b8" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka mm kn ko kp bi translated"><a class="ae kb" href="https://www.jetbrains.com/idea/download/" rel="noopener ugc nofollow" target="_blank"> IntelliJ(社区版)</a></li></ol><p id="1f4f" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">您将在本安装指南中使用IntelliJ，因为它的<a class="ae kb" href="https://zeroturnaround.com/rebellabs/developer-productivity-report-2017-why-do-you-use-java-tools-you-use/" rel="noopener ugc nofollow" target="_blank">越来越受欢迎</a>和直观的调试特性。</p><ol class=""><li id="2a5c" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka mm kn ko kp bi translated"><a class="ae kb" href="http://maven.apache.org/install.html" rel="noopener ugc nofollow" target="_blank">阿帕奇Maven </a></li></ol><p id="f6c8" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">许多java开发人员都熟悉Maven，它是测试、打包和编译Java项目的有用工具。</p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="bb4b" class="ly ig hi mo b fi ms mt l mu mv">unzip apache-maven-3.5.3-bin.zip -d /opt/apache-maven/<br/>echo PATH=/opt/apache-maven/bin:\$PATH &gt;&gt; ~/.bash_profile<br/>source ~/.bash_profile</span></pre><p id="89ec" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">检查maven安装是否成功。</p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="ab1e" class="ly ig hi mo b fi ms mt l mu mv">mvn -v</span></pre><p id="d75c" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">您应该会看到如下输出:</p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="c26d" class="ly ig hi mo b fi ms mt l mu mv">Apache Maven 3.5.3 (138edd61fd100ec658bfa2d307c43b76940a5d7d; 2017–10–18T08:58:13+01:00)<br/>Maven home: /opt/apache-maven-3.5.3<br/>Java version: 1.8.0_45, vendor: Oracle Corporation<br/>Java home: /Library/Java/JavaVirtualMachines/jdk1.8.0_45.jdk/Contents/Home/jre<br/>Default locale: en_US, platform encoding: UTF-8<br/>OS name: “mac os x”, version: “10.8.5”, arch: “x86_64”, family: “mac”</span></pre><p id="abc9" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><a class="ae kb" href="https://console.cloud.google.com/flows/enableapi?apiid=dataflow,compute_component,logging,storage_component,storage_api,bigquery" rel="noopener ugc nofollow" target="_blank">启用BigQuery、Dataflow和Google云存储API</a>，如果在API管理器中尚未启用的话。这需要几分钟时间。</p><p id="93d9" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">在控制台中，这可以通过左侧菜单手动完成，转到<strong class="jf hj"> API的&amp;服务- &gt;仪表板</strong>并点击<strong class="jf hj">启用API和服务</strong></p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es mx"><img src="../Images/182bcc93257a43692e297765c493f90d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/0*-W-UCq1f8L1hLWhd"/></div></figure><h1 id="6700" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">Google云项目设置</h1><p id="bb61" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">从您的Google云平台控制台页面打开云外壳:</p><p id="7126" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">将变量设置为等于您的项目id:</p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="cd15" class="ly ig hi mo b fi ms mt l mu mv">export PROJECT=$(gcloud config get-value core/project)</span></pre><h2 id="055c" class="ly ig hi bd ih lz ma mb il mc md me ip jo mf mg it js mh mi ix jw mj mk jb ml bi translated">创建云存储桶</h2><p id="4c26" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">使用make bucket命令在项目中的us-central1中创建新的区域存储桶</p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="0c15" class="ly ig hi mo b fi ms mt l mu mv">gsutil mb -c regional -l us-central1 gs://$PROJECT<br/>export BUCKET=$PROJECT</span></pre><h2 id="a730" class="ly ig hi bd ih lz ma mb il mc md me ip jo mf mg it js mh mi ix jw mj mk jb ml bi translated">创建BigQuery数据集</h2><p id="2253" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在BigQuery中创建数据集。这是BigQuery中所有表的加载位置。</p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="a190" class="ly ig hi mo b fi ms mt l mu mv">bq mk DataflowJavaSetup</span></pre><h1 id="3912" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">配置IntelliJ</h1><h2 id="b5a5" class="ly ig hi bd ih lz ma mb il mc md me ip jo mf mg it js mh mi ix jw mj mk jb ml bi translated">克隆数据流模板报告</h2><p id="b3f2" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在这次演练中，您将使用来自数据流模板报告的源代码:</p><div class="my mz ez fb na nb"><a href="https://github.com/GoogleCloudPlatform/DataflowTemplates" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab dw"><div class="nd ab ne cl cj nf"><h2 class="bd hj fi z dy ng ea eb nh ed ef hh bi translated">Google cloud platform/dataflow templates</h2><div class="ni l"><h3 class="bd b fi z dy ng ea eb nh ed ef dx translated">数据流模板-大数据Apache波束模板</h3></div><div class="nj l"><p class="bd b fp z dy ng ea eb nh ed ef dx translated">github.com</p></div></div></div></a></div><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es nk"><img src="../Images/5f4a9ffb14dc726ee028a22cb627dc76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wN__7zaCYDZnJAdh"/></div></div></figure><ol class=""><li id="8887" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka mm kn ko kp bi translated">打开IntelliJ。</li><li id="7c56" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">选择从版本控制中签出。</li><li id="fa24" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">选择Git。</li><li id="2e51" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">在URL中粘贴此回购链接:<a class="ae kb" href="https://github.com/GoogleCloudPlatform/DataflowTemplates.git" rel="noopener ugc nofollow" target="_blank">https://github . com/Google cloud platform/dataflowtemplates . git</a></li><li id="8e40" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">单击克隆。</li><li id="5fa5" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">单击是。</li></ol><h2 id="68bd" class="ly ig hi bd ih lz ma mb il mc md me ip jo mf mg it js mh mi ix jw mj mk jb ml bi translated">设置Maven项目</h2><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es nl"><img src="../Images/c61d049814350410af0ae7b6a56d6e9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QJk5ifN-ZJJj_3rg"/></div></div></figure><ol class=""><li id="7c2f" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka mm kn ko kp bi translated">选择Maven。</li><li id="abe7" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">单击下一步。</li><li id="5ca8" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">选中“递归搜索项目”。</li><li id="824f" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">勾选“自动导入Maven项目”。</li><li id="21fc" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">(在接下来的三个屏幕中单击“下一步”,因为默认设置将满足您的需要)。单击完成。</li></ol><h2 id="5b04" class="ly ig hi bd ih lz ma mb il mc md me ip jo mf mg it js mh mi ix jw mj mk jb ml bi translated">查找管道源代码</h2><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es nm"><img src="../Images/7aa43c6b29d53c4c26198823589e4aa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4UpSU4qf6s8zBaDK"/></div></div></figure><ol class=""><li id="09a2" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka mm kn ko kp bi translated">按以下顺序遍历文件系统树:</li><li id="dcff" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">data flow templates/src/main/Java/templates/textiotobigquery . Java</li></ol><h1 id="c1ce" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">运行数据流管道</h1><h2 id="f937" class="ly ig hi bd ih lz ma mb il mc md me ip jo mf mg it js mh mi ix jw mj mk jb ml bi translated">在本地运行Apache Beam管道</h2><p id="2ae7" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">首先，您将做一些环境设置，然后您将运行<a class="ae kb" href="https://cloud.google.com/dataflow/docs/templates/provided-templates#gcstexttobigquery" rel="noopener ugc nofollow" target="_blank">一个数据流模板，它从GCS读取并应用一个javascript UDF，然后写入BigQuery </a>。</p><h2 id="8094" class="ly ig hi bd ih lz ma mb il mc md me ip jo mf mg it js mh mi ix jw mj mk jb ml bi translated">设置</h2><ol class=""><li id="43c9" class="kh ki hi jf b jg jh jk jl jo kv js kw jw kx ka mm kn ko kp bi translated">打开终端。</li></ol><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es nn"><img src="../Images/cfcedc46587b5b6c501b203ff9e78be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TQXYBCT1TCiN_uaR"/></div></div></figure><p id="593a" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">为此示例创建一个BigQuery数据集。</p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="c77b" class="ly ig hi mo b fi ms mt l mu mv">bq mk java_quickstart</span></pre><p id="1e4a" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">编译maven项目。</p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="ae3e" class="ly ig hi mo b fi ms mt l mu mv">mvn clean &amp;&amp; mvn compile</span></pre><h2 id="df24" class="ly ig hi bd ih lz ma mb il mc md me ip jo mf mg it js mh mi ix jw mj mk jb ml bi translated">为定义这个Apache Beam管道的类创建一个运行/调试配置</h2><p id="38af" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">此配置为IntelliJ定义了如何在本地运行代码。这对于测试和调试代码的早期阶段是必不可少的，无需等待(和支付)数据流来启动工人。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es no"><img src="../Images/da62b4fb1480557f5473c9f3c2180182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*Kio8ryDB0ZtU1wqDwRvF7Q.gif"/></div></figure><ol class=""><li id="86c0" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka mm kn ko kp bi translated">在右上角的下拉列表中，选择编辑配置。</li><li id="f015" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">单击+按钮并选择应用程序。</li><li id="be15" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">为您的配置命名。通常，这与配置运行的类的名称相同，但如果不同的参数有不同的配置，则可能更具描述性。</li><li id="f94d" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">将程序参数粘贴到指定的文本框中。现在让我们使用TestDataflowRunner。(参见本节下面的示例参数)</li></ol><p id="af70" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">5.在工作目录下拉列表中选择%MAVEN_REPOSITORY%</p><p id="3cc4" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">6.单击应用，然后单击确定</p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="9d35" class="ly ig hi mo b fi ms mt l mu mv">--project=sandbox<br/>--stagingLocation=gs://sandbox/staging<br/>--tempLocation=gs://sandbox/temp<br/>--templateLocation=gs://sandbox/templates/GcsToBigQueryTemplate.json<br/>--runner=TestDataflowRunner<br/>--javascriptTextTransformGcsPath=gs://sandbox/resources/UDF/sample_UDF.js<br/>--JSONPath=gs://sandbox/resources/schemas/sample_schema.json<br/>--javascriptTextTransformFunctionName=transform<br/>--inputFilePattern=gs://sandbox/data/data.txt<br/>--outputTable=sandbox:java_quickstart.colorful_coffee_people<br/>--bigQueryLoadingTemporaryDirectory=gs://sandbox/bq_load_temp/</span></pre><h2 id="da48" class="ly ig hi bd ih lz ma mb il mc md me ip jo mf mg it js mh mi ix jw mj mk jb ml bi translated">设置断点并运行调试器</h2><p id="b30f" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">断点将暂停程序的执行，允许您在REPL中检查变量或运行代码片段。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es no"><img src="../Images/40f76fd9e3662239d901e9ecaa0fdbfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*4VH3QPC4Dc5jfTJnd5W9MQ.gif"/></div></figure><ol class=""><li id="ad94" class="kh ki hi jf b jg kc jk kd jo kj js kk jw kl ka mm kn ko kp bi translated">在TextIOToBigQuery.java的第93行设置一个断点，方法是在空白处单击代码的左边。这个区域有时被称为左檐槽。</li><li id="f169" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">右键单击&gt;“调试TextIOToBigQuery”</li><li id="9125" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">管道将在到达此行时暂停执行。</li><li id="0153" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">在这一点上检查变量。</li><li id="5748" class="kh ki hi jf b jg kq jk kr jo ks js kt jw ku ka mm kn ko kp bi translated">右键单击并选择“Evaluate expression ”,键入要运行的Java代码片段(具有IntelliJ的所有语法突出显示和提前键入建议功能),以帮助诊断错误并探索该断点处的执行状态。</li></ol><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es no"><img src="../Images/5286a6c02ba41ff966b3846b00710164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*mD08ItGxCoSwpOHzl7v1qQ.gif"/></div></figure><p id="5033" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">更多细节请查看IntelliJ <a class="ae kb" href="https://www.jetbrains.com/help/idea/debugging-your-first-java-application.html" rel="noopener ugc nofollow" target="_blank">调试器介绍</a>和<a class="ae kb" href="https://www.jetbrains.com/help/idea/debugging-code.html" rel="noopener ugc nofollow" target="_blank">调试器文档</a>！</p><h1 id="f4d3" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">在Google Cloud Dataflow Runner上运行Apache Beam管道</h1><p id="55c8" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">要在Google Cloud Dataflow workers上运行这个管道，您需要在GCS中存放以下数据文件。</p><p id="e8ad" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">该模板需要带有BigQuery模式和javascript UDF的JSON文件来转换文本。使用<a class="ae kb" href="https://cloud.google.com/dataflow/docs/templates/provided-templates#gcstexttobigquery" rel="noopener ugc nofollow" target="_blank">文档</a>中的示例。</p><p id="ba15" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">创建以下两个文件:</p><p id="0de4" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj"> sample_schema.json: </strong></p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="67a5" class="ly ig hi mo b fi ms mt l mu mv">{<br/> “BigQuery Schema”: [<br/> {<br/> “name”: “location”,<br/> “type”: “STRING”<br/> },<br/> {<br/> “name”: “name”,<br/> “type”: “STRING”<br/> },<br/> {<br/> “name”: “age”,<br/> “type”: “STRING”<br/> },<br/> {<br/> “name”: “color”,<br/> “type”: “STRING”<br/> },<br/> {<br/> “name”: “coffee”,<br/> “type”: “STRING”<br/> }<br/> ]<br/>}</span></pre><p id="d3c9" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj"> sample_UDF.js: </strong></p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="5ab1" class="ly ig hi mo b fi ms mt l mu mv">function transform(line) {<br/> var values = line.split(‘,’);<br/> var obj = new Object();</span><span id="6809" class="ly ig hi mo b fi np mt l mu mv"> obj.location = values[0];<br/> obj.name = values[1];<br/> obj.age = values[2];<br/> obj.color = values[3];<br/> obj.coffee = values[4];<br/> var jsonString = JSON.stringify(obj);<br/> <br/>return jsonString;<br/>}</span></pre><p id="92ff" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj"> data.txt </strong></p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="bba4" class="ly ig hi mo b fi ms mt l mu mv">US,joe,18,green,late<br/>CAN,jan,33,red,cortado<br/>MEX,jonah,56,yellow,cappuccino</span></pre><p id="eb04" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">将这些文件存放在Google云存储中:</p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="c50a" class="ly ig hi mo b fi ms mt l mu mv">gsutil cp ./sample_UDF.js gs://$BUCKET/resources/UDF/<br/>gsutil cp ./sample_schema.json gs://$BUCKET/resources/schemas/<br/>gsutil cp ./data.txt gs://$BUCKET/data/</span></pre><p id="fb59" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">这个Maven命令在用templateLocation指定的云存储位置创建并存放一个模板。创建并暂存模板后，暂存位置包含执行模板所需的其他文件。如果删除临时位置，模板执行将失败。更多信息请查看数据流模板的<a class="ae kb" href="https://cloud.google.com/dataflow/docs/templates/creating-templates#creating-and-staging-templates" rel="noopener ugc nofollow" target="_blank">文档。</a></p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="6953" class="ly ig hi mo b fi ms mt l mu mv">mvn compile exec:java -Dexec.mainClass=com.google.cloud.teleport.templates.TextIOToBigQuery -Dexec.cleanupDaemonThreads=false -Dexec.args=” \<br/>--project=$PROJECT \<br/>--stagingLocation=gs://$BUCKET/staging \<br/>--tempLocation=gs://$BUCKET/temp \<br/>--templateLocation=gs://$BUCKET/templates/GcsToBigQueryTemplate.json \<br/>--runner=DataflowRunner”</span></pre><p id="46e7" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">最后，您将使用gcloud命令行工具提交一个作业，该作业将运行您的staged Dataflow模板。</p><pre class="kz la lb lc fd mn mo mp mq aw mr bi"><span id="f622" class="ly ig hi mo b fi ms mt l mu mv">gcloud dataflow jobs run colorful-coffee-people-gcs-test-to-big-query \<br/>--gcs-location=gs://$BUCKET/templates/GcsToBigQueryTemplate.json \<br/>--zone=us-central1-f \<br/>--parameters=javascriptTextTransformGcsPath=gs://$BUCKET/resources/UDF/sample_UDF.js,JSONPath=gs://$BUCKET/resources/schemas/sample_schema.json,javascriptTextTransformFunctionName=transform,inputFilePattern=gs://$BUCKET/data/data.txt,outputTable=$PROJECT:java_quickstart.colorful_coffee_people,bigQueryLoadingTemporaryDirectory=gs://$BUCKET/bq_load_temp/</span></pre><h1 id="d053" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">去比赛吧！</h1><p id="d433" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在，您已经建立了一个开发环境，可以开始使用Apache Beam Java SDK创建管道，并提交它们以在Google Cloud Dataflow上运行。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es nq"><img src="../Images/8b0dc4182407f1bf39056929aa0e194d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*co1zd4fa-iD4e3rW8i7wSg.png"/></div></div></figure></div></div>    
</body>
</html>