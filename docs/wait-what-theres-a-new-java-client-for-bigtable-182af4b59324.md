# 等等！什么？Bigtable 有了新的 Java 客户端？！

> 原文：<https://medium.com/google-cloud/wait-what-theres-a-new-java-client-for-bigtable-182af4b59324?source=collection_archive---------4----------------------->

这篇文章是与克里斯汀·奥利里合作创作的。

多年来，我们为 Bigtable 提供的 Java 客户端是 HBase 兼容的。然而，最近我们已经看到许多开发人员采用 Bigtable，他们不是从 HBase 过渡，而是 Cassandra 或其他东西。

所以对于不需要 HBase 兼容性的人来说，使用 HBase 客户端对于某些操作来说可能过于复杂。这就是为 Bigtable 开发新的 Java 客户端的原因。请注意，这并不意味着 HBase 客户端将被弃用。这两个客户端将并存，您可以选择最适合您的用例的一个。

新客户端的主要特点是:
-更灵活的过滤器
-更少的依赖性
-完全异步和背压感知

一篇剖析新客户端特性的博客文章正在制作中，敬请关注。在这一篇中，我们将关注开发人员。

为了获得更多的实践经验，我们决定采用 codelab: [云 Bigtable](https://codelabs.developers.google.com/codelabs/cloud-bigtable-intro-java/#0) 简介，由我们的朋友和同事 [Billy Jacobson](https://twitter.com/BillyJacobson) 创建，它使用 HBase 客户端并翻译查询，以便它们可以与新客户端一起工作。

codelab 使用一个公共数据集，可以在 [Kaggle](https://www.kaggle.com/stoney71/new-york-city-transport-statistics) 找到。

> 该数据集来自纽约市 MTA 公交车数据流服务。大约以 10 分钟为增量，每一行中都包含了公交车位置、路线、公交车站等信息。公共汽车时刻表中的预定到达时间也包括在内，以给出公共汽车应该在哪里的指示(比时刻表落后多少，或者准时，或者甚至提前多少)。

下面您会看到获取从`12:00 am`到`1:00 am`的`June 1, 2017`上的`M86-SBS`线路上的公交车数据的查询。一辆 id 为`NYCT_5824`的车辆当时在公交线路上。

> **执行查找**
> 
> 您将执行的第一个查询是一个简单的行查找。你会得到 2017 年 6 月 1 日上午 12:00 到凌晨 1:00 M86-SBS 线路上一辆公交车的数据。一辆车牌号为 NYCT_5824 的车当时在公交线路上。
> 
> 有了这些信息，并知道模式设计(公交公司/公交线路/下舍入到小时/车辆 ID 的时间戳)，您可以推断出行键是:
> 
> MTA/M86-SBS/149627520000/NYCT _ 5824

> 结果应该包含该小时内公共汽车的最近位置。但是您希望看到所有的位置，所以在 get 请求上设置最大版本数。

因此，让我们看看新的 Java 客户端会是什么样子

> **执行扫描**
> 现在，让我们查看该小时公交线路的所有数据。扫描代码看起来非常类似于 get 代码。您给扫描器一个起始位置，然后指出您只需要在时间戳 1496275200000 表示的小时内的 M86-SBS 总线的行。

这是新 Java 客户端的相同查询。

> 对这个查询的一个有趣的修改是查看 M86-SBS 总线的整个月份的数据，这非常容易做到。从起始行和前缀过滤器中删除时间戳以获得结果。

新 Java 客户端的版本将如下所示。

> **引入过滤器**
> 接下来，您将过滤向东行驶的公交车和向西行驶的公交车

这是查询的新 Java 客户端版本。

> 要让公共汽车向西行驶，请更改 valueFilter 中的字符串:

下面是如何为新的 Java 客户端更改过滤器。

> **执行多范围扫描** 对于最后一个查询，您将处理当您关心一个区域中的许多公交线路时的情况:

最后，对新客户端进行多范围扫描

博文中的所有代码都可以在[这个](https://github.com/dbergqvist/cbt-intro-java/tree/hbase-java) GitHub repo 中找到。如果事情没有按预期进行，请联系 [me](https://twitter.com/bexie) 。