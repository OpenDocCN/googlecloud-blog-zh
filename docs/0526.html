<html>
<head>
<title>Deploying your NodeJS app with Docker and Kubernetes on GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在GCP上使用Docker和Kubernetes部署NodeJS应用程序</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/deploying-your-nodejs-app-with-docker-and-kubernetes-on-gcp-5dee8df5d896?source=collection_archive---------0-----------------------#2018-02-23">https://medium.com/google-cloud/deploying-your-nodejs-app-with-docker-and-kubernetes-on-gcp-5dee8df5d896?source=collection_archive---------0-----------------------#2018-02-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/8e575c14df2b4d59973e9020ccabfceb.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/format:webp/1*q_yAUPUdRddC9CFacbsYtA.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">谷歌云平台</figcaption></figure><p id="547e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个教程很容易理解，但是推荐一些技术经验！</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="6e7f" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">假设</h1><ul class=""><li id="4ae6" class="ku kv hi is b it kw ix kx jb ky jf kz jj la jn lb lc ld le bi translated">您已经有一个NodeJS应用程序</li><li id="5718" class="ku kv hi is b it lf ix lg jb lh jf li jj lj jn lb lc ld le bi translated">你要么使用GCP <a class="ae lk" href="https://console.cloud.google.com/cloudshell/" rel="noopener ugc nofollow" target="_blank">云外壳</a>，要么在你的本地外壳上安装<code class="du ll lm ln lo b">gcloud</code>、<code class="du ll lm ln lo b">kubectl</code>和<code class="du ll lm ln lo b">docker</code></li><li id="6f79" class="ku kv hi is b it lf ix lg jb lh jf li jj lj jn lb lc ld le bi translated">您有一个启用了<a class="ae lk" href="https://console.cloud.google.com/apis/api/container.googleapis.com" rel="noopener ugc nofollow" target="_blank"> Kubernetes引擎API </a>的GCP项目</li></ul><h1 id="9e07" class="jw jx hi bd jy jz lp kb kc kd lq kf kg kh lr kj kk kl ls kn ko kp lt kr ks kt bi translated">配置您的项目</h1><p id="2be0" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">首先，我们需要为您的项目配置一些设置:</p><pre class="lx ly lz ma fd mb lo mc md aw me bi"><span id="4366" class="mf jx hi lo b fi mg mh l mi mj">gcloud config set project kube-tutorial-194819<br/>gcloud config set compute/zone us-west1-a</span></pre><p id="e48b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这会将当前项目设置为您的项目(在这种情况下，我的项目是<code class="du ll lm ln lo b">kube-tutorial-194819</code>，然后将默认计算区域设置为<code class="du ll lm ln lo b">us-west1-a</code></p><h1 id="8e51" class="jw jx hi bd jy jz lp kb kc kd lq kf kg kh lr kj kk kl ls kn ko kp lt kr ks kt bi translated">将你的应用归档</h1><p id="ef8b" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">现在，我们需要将您的应用程序放入Docker容器中，这样我们就可以将它部署到我们将创建的Kubernetes集群中。</p><p id="2f45" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">转到Node应用程序的根目录，使用您喜欢的shell编辑器创建一个<code class="du ll lm ln lo b">Dockerfile</code>和<code class="du ll lm ln lo b">.dockerignore</code>文件:</p><p id="abab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ll lm ln lo b">nano Dockerfile</code>并把这作为它的内容:</p><pre class="lx ly lz ma fd mb lo mc md aw me bi"><span id="1775" class="mf jx hi lo b fi mg mh l mi mj">FROM node:carbon<br/><br/>WORKDIR /usr/src/app<br/><br/>COPY package*.json ./<br/><br/>RUN npm install<br/><br/>COPY . .<br/><br/>EXPOSE 8080<br/>CMD [ "npm", "start" ]</span></pre><p id="84e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个Docker映像获取Node的最新版本，然后更改目录，复制<code class="du ll lm ln lo b">package.json</code>文件，运行<code class="du ll lm ln lo b">npm install</code>，复制所有内容，并运行<code class="du ll lm ln lo b">npm start</code>来启动您的应用程序监听端口8080。你可以在这里找到更多关于这个<a class="ae lk" href="https://nodejs.org/en/docs/guides/nodejs-docker-webapp/" rel="noopener ugc nofollow" target="_blank">的细节</a>。</p><p id="268c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们将制作我们的<code class="du ll lm ln lo b">.dockerignore</code>文件:</p><p id="2ea4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ll lm ln lo b">nano .dockerignore</code></p><pre class="lx ly lz ma fd mb lo mc md aw me bi"><span id="b5bb" class="mf jx hi lo b fi mg mh l mi mj">node_modules<br/>npm-debug.log</span></pre><p id="8df5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">像<code class="du ll lm ln lo b">.gitignore</code>一样，<code class="du ll lm ln lo b">.dockerignore</code>文件告诉系统在构建时要忽略哪些文件和目录。</p><h2 id="a19e" class="mf jx hi bd jy mk ml mm kc mn mo mp kg jb mq mr kk jf ms mt ko jj mu mv ks mw bi translated">上传你的码头图片到GCR</h2><p id="6aec" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">现在让我们构建我们的映像，并将其部署到<a class="ae lk" href="https://cloud.google.com/container-registry/" rel="noopener ugc nofollow" target="_blank"> Google容器注册表</a>！</p><p id="a092" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ll lm ln lo b">docker build -t gcr.io/kube-tutorial-194819/kube-tutorial:latest .</code></p><p id="1725" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这用标签建立了我们的形象:</p><p id="b097" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ll lm ln lo b">gcr.io/kube-tutorial-194819/kube-tutorial:latest</code></p><p id="32e1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该标签的格式为<code class="du ll lm ln lo b">gcr.io/[PROJECT_ID]/[APP_NAME][:version]</code></p><p id="93f0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们用<code class="du ll lm ln lo b">gcr.io/[PROJECT_ID]</code>开始图像的标签是很重要的，这样Docker就知道我们会把图像推到哪里。</p><p id="3135" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们将继续推进我们的私有容器注册表:</p><p id="d249" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ll lm ln lo b">gcloud docker -- push gcr.io/kube-tutorial-194819/kube-tutorial</code></p><h1 id="1cfd" class="jw jx hi bd jy jz lp kb kc kd lq kf kg kh lr kj kk kl ls kn ko kp lt kr ks kt bi translated">部署到Google Kubernetes引擎</h1><p id="20c9" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">既然我们的应用程序已经Dockerized，我们可以设置我们的部署。</p><pre class="lx ly lz ma fd mb lo mc md aw me bi"><span id="965b" class="mf jx hi lo b fi mg mh l mi mj">gcloud container clusters create kube-tutorial<br/>gcloud container clusters get-credentials kube-tutorial</span></pre><p id="c788" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将创建一个名为<code class="du ll lm ln lo b">kube-tutorial</code>的集群，然后验证我们的shell以使用该集群。</p><p id="f6c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们将在群集上运行部署:</p><pre class="lx ly lz ma fd mb lo mc md aw me bi"><span id="0a10" class="mf jx hi lo b fi mg mh l mi mj">kubectl run kube-tutorial \<br/>--image gcr.io/kube-tutorial-194819/kube-tutorial:latest \<br/>--port 8080</span></pre><p id="9cad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将创建部署，并使用我们刚刚推送到容器注册中心的映像将其命名为<code class="du ll lm ln lo b">kube-tutorial</code>，然后指定我们将公开的端口为8080。现在让我们向世界展示我们的部署:</p><pre class="lx ly lz ma fd mb lo mc md aw me bi"><span id="6665" class="mf jx hi lo b fi mg mh l mi mj">kubectl expose deployment kube-tutorial --type "LoadBalancer"</span></pre><p id="5004" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们的应用程序已经部署好了！要找到负载平衡器给我们的外部IP，请运行以下命令:</p><pre class="lx ly lz ma fd mb lo mc md aw me bi"><span id="9324" class="mf jx hi lo b fi mg mh l mi mj">kubectl get service kube-tutorial</span></pre><p id="c5e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可能会将<pending>视为外部IP，但请稍等片刻，然后重新运行该命令，最终您会看到它。继续将那个外部IP地址输入到你的浏览器中，添加<code class="du ll lm ln lo b">:8080</code>来指定端口。</pending></p><h1 id="8ad3" class="jw jx hi bd jy jz lp kb kc kd lq kf kg kh lr kj kk kl ls kn ko kp lt kr ks kt bi translated">摘要</h1><ul class=""><li id="37ca" class="ku kv hi is b it kw ix kx jb ky jf kz jj la jn lb lc ld le bi translated">在本教程中，我们学习了如何Dockerize你的NodeJS应用程序。</li><li id="80a9" class="ku kv hi is b it lf ix lg jb lh jf li jj lj jn lb lc ld le bi translated">然后，我们将Docker图像上传到Google容器注册表。</li><li id="3d7d" class="ku kv hi is b it lf ix lg jb lh jf li jj lj jn lb lc ld le bi translated">最后，我们将这个映像部署到Google Kubernetes引擎上的一个Kubernetes集群中。</li></ul><h1 id="7422" class="jw jx hi bd jy jz lp kb kc kd lq kf kg kh lr kj kk kl ls kn ko kp lt kr ks kt bi translated">走向</h1><p id="88db" class="pw-post-body-paragraph iq ir hi is b it kw iv iw ix kx iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">下次我们将了解Kubernetes的版本控制，以及将更新部署到您的应用程序是多么容易！</p><p id="46c3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如有疑问，在下方评论！</p></div></div>    
</body>
</html>