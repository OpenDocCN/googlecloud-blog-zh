<html>
<head>
<title>Automatic per-variant google_services.json configurations with Gradle</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Gradle自动配置每个变量的google_services.json</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/automatic-per-variant-google-services-json-configurations-with-gradle-d3d3e40abc0e?source=collection_archive---------1-----------------------#2015-08-26">https://medium.com/google-cloud/automatic-per-variant-google-services-json-configurations-with-gradle-d3d3e40abc0e?source=collection_archive---------1-----------------------#2015-08-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="093b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用<a class="ae jd" href="https://developers.google.com/mobile/add" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/mobile/add</a>轻松生成一个<em class="je"> google_services.json </em>文件，您的应用程序可以使用该文件为AppEngine、Analytics、GCM等指定API变量。按照Google Developers站点上的文档进行设置。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/c541708e30d81f1693714a7910616679.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VMT_AmW56cYSijLfEVlvVg.png"/></div></div></figure><p id="a5c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装完成后，它运行良好——但是如果您想在您的<em class="je">调试</em>与<em class="je">发布</em>构建类型中使用不同的API键，该怎么办呢？不幸的是，<em class="je"> google_services.json </em>必须驻留在您的<em class="je"> :app </em>模块的根目录中，而不是在buildType/productVariant文件夹中，所以Gradle不能通过文件夹放置自动为您处理这个问题。不要担心——通过一些自定义的梯度任务，我们可以解决这个问题！</p><p id="9c15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，将每个构建类型各自的<em class="je"> google_services.json </em>放在以下位置:</p><pre class="jg jh ji jj fd jr js jt ju aw jv bi"><span id="e717" class="jw jx hi js b fi jy jz l ka kb">app/src/debug/google_services.json<br/>app/src/main/google_services.json</span></pre><p id="5d09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们在你的:app的<em class="je"> build.gradle </em>中创建一些gradle任务，以自动将适当的<em class="je"> google_services.json </em>移动到<em class="je">app/Google _ services . JSON</em></p><pre class="jg jh ji jj fd jr js jt ju aw jv bi"><span id="4fca" class="jw jx hi js b fi jy jz l ka kb">task switchToDebug(type: Copy) {<br/>    description = 'Switches to DEBUG google-services.json'<br/>    from "src/debug"<br/>    include "google-services.json"<br/>    into "."<br/>}<br/><br/>task switchToRelease(type: Copy) {<br/>    description = 'Switches to RELEASE google-services.json'<br/>    from "src/release"<br/>    include "google-services.json"<br/>    into "."<br/>}</span></pre><p id="7f6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很好，但是在构建应用程序之前必须手动运行这些任务非常麻烦。我们希望上述适当的复制任务在运行<em class="je">:汇编调试</em>或<em class="je">:汇编发布</em>之前的某个时间运行。让我们看看当<em class="je">:assembler release</em>运行时会发生什么:</p><pre class="jg jh ji jj fd jr js jt ju aw jv bi"><span id="038f" class="jw jx hi js b fi jy jz l ka kb">Zaks-MBP:my_awesome_application zak$ ./gradlew assembleRelease<br/>Parallel execution is an incubating feature.<br/>.... (other tasks)<br/>:app:processReleaseGoogleServices<br/>....<br/>:app:assembleRelease</span></pre><p id="8a05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意<em class="je">:app:processReleaseGoogleServices</em>任务。这个任务负责处理根<em class="je"> google_services.json </em>文件。我们希望正确的<em class="je"> google_services.json </em>被处理，所以我们必须事先立即运行我们的复制任务。</p><p id="05d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将此添加到您的<em class="je"> build.gradle </em>中。注意<em class="je">后附</em>评估。</p><pre class="jg jh ji jj fd jr js jt ju aw jv bi"><span id="8f33" class="jw jx hi js b fi jy jz l ka kb">afterEvaluate {<br/>    processDebugGoogleServices.dependsOn switchToDebug<br/>    processReleaseGoogleServices.dependsOn switchToRelease<br/>}</span></pre><p id="7696" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，无论何时调用<em class="je">:app:processreleasegoleservices</em>，我们新定义的<em class="je"> :app:switchToRelease </em>都会被提前调用。<em class="je">调试</em>构建类型的逻辑相同。你可以运行<em class="je">:app:assembler release</em>，发布版本<em class="je"> google_services.json </em>会自动复制到你的app模块的根文件夹。</p><p id="43a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">瞧啊。请记住，您可以通过Gradle的依赖管理系统挂钩到任何Gradle任务进行预处理。</p><p id="fc9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在这个<a class="ae jd" href="https://gist.github.com/ZakTaccardi/708d5e2ad7d7d5bbd084" rel="noopener ugc nofollow" target="_blank">要点</a>中看到代码本身。请随时提供对该流程的任何改进！</p></div></div>    
</body>
</html>