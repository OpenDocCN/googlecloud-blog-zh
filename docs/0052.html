<html>
<head>
<title>Cloud Logging though a Python Log Handler</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Python日志处理程序进行云日志记录</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/cloud-logging-though-a-python-log-handler-a3fbeaf14704?source=collection_archive---------0-----------------------#2016-01-14">https://medium.com/google-cloud/cloud-logging-though-a-python-log-handler-a3fbeaf14704?source=collection_archive---------0-----------------------#2016-01-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="fc74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在谷歌云平台上做大数据已经有一段时间了，我真的看到这个平台成熟了。如果你在做大数据，你可能会喜欢Python。真的是一门把事情做好的语言。</p><p id="b413" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中一个内置特性是<strong class="ih hj"> <em class="je">日志</em> </strong>。Python有一些现成的日志处理程序，用于记录控制台、文件和流。但是我真的很惊讶没有人为Google Cloud Logging编写一个像样的日志处理程序。</p><p id="bec5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以我决定为我的<a class="ae jd" href="https://github.com/alexvanboxel/luigiext-gcloud/wiki/Logging" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> luigi-gcloud </strong> </a>扩展编写一个内置处理程序，通过日志配置让用户完全控制他们想要记录的内容。</p><p id="3b30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是因为它很小而且易于使用，所以我想分享它，这样你就可以在你的Python脚本中构建它，这些脚本应该在Compute上运行。将它包含在您的项目中，您就可以使用该处理程序了。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><p id="be75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">剩下的唯一一件事就是用一个ini文件来配置它。不过需要注意的是，要确保根日志记录器不使用我们的处理程序。这是因为客户端库也做日志记录，你会得到一个封闭的循环。</p><p id="746d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ini文件中的重要部分是<strong class="ih hj">【logger _ app】</strong>和<strong class="ih hj">【handler _ cloudLoggingHandler】</strong>部分。这将把名为“my-app”的记录器路由到相应的处理程序。在handler部分，您需要指定我们的云项目的project_id。</p><pre class="jf jg jh ji fd jm jn jo jp aw jq bi"><span id="331d" class="jr js hi jn b fi jt ju l jv jw"><strong class="jn hj">[loggers]<br/></strong>keys = root,app<br/><br/><strong class="jn hj">[handlers]<br/></strong>keys = consoleHandler,cloudLoggingHandler<br/><br/><strong class="jn hj">[formatters]<br/></strong>keys = simpleFormatter<br/><br/><strong class="jn hj">[logger_root]<br/></strong>level = DEBUG<br/>handlers = consoleHandler<br/><br/><strong class="jn hj">[logger_app]<br/></strong>level = DEBUG<br/>handlers = cloudLoggingHandler,consoleHandler<br/>qualname = my-app<br/>propagate = 0<br/><br/><strong class="jn hj">[handler_consoleHandler]<br/></strong>class = StreamHandler<br/>level = DEBUG<br/>formatter = simpleFormatter<br/>args = (sys.stdout,)<br/><br/><strong class="jn hj">[handler_cloudLoggingHandler]<br/></strong>class = gcloud.log.CloudLoggingHandler<br/>level = DEBUG<br/>args = ('your-project-id',)<br/><br/><strong class="jn hj">[formatter_simpleFormatter]<br/></strong>format = %(levelname)-8s %(name)-18s : %(message)s</span></pre><p id="7782" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一切都配置好了，现在可以开始直接登录云日志了。确保查看控制台中的<strong class="ih hj">自定义日志</strong>。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jk jl l"/></div></figure><p id="b81c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我必须指出，对于每个日志调用，都会执行一个API调用，这会影响性能。但是由于许多Python脚本是为对性能不太重要的自动化任务编写的，所以这对他们来说应该不是问题。</p><p id="671d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">伐木快乐！</p></div></div>    
</body>
</html>