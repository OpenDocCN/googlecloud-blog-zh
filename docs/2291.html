<html>
<head>
<title>Gremlin Chaos Engineering On Google Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云上的Gremlin混沌工程</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/gremlin-chaos-engineering-on-google-cloud-2568f9fc70c9?source=collection_archive---------0-----------------------#2022-08-08">https://medium.com/google-cloud/gremlin-chaos-engineering-on-google-cloud-2568f9fc70c9?source=collection_archive---------0-----------------------#2022-08-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div class="er es hg"><img src="../Images/c355b61a50da538abadd690b35ffc00b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*0USL-EsvwXU9detj7JmvnA.jpeg"/></div></figure><div class=""/></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><p id="db5c" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">本文基于如何在Google Cloud上使用Gremlin实现<strong class="iv hq">混沌工程实验。</strong></p><h2 id="b131" class="jr js hp bd jt ju jv jw jx jy jz ka kb je kc kd ke ji kf kg kh jm ki kj kk kl bi translated">先决条件</h2><ol class=""><li id="d76d" class="km kn hp iv b iw ko ja kp je kq ji kr jm ks jq kt ku kv kw bi translated">谷歌云平台账户</li><li id="cb06" class="km kn hp iv b iw kx ja ky je kz ji la jm lb jq kt ku kv kw bi translated">Gremlin应用程序帐户</li><li id="eaec" class="km kn hp iv b iw kx ja ky je kz ji la jm lb jq kt ku kv kw bi translated">GKE集群</li></ol><h2 id="f616" class="jr js hp bd jt ju jv jw jx jy jz ka kb je kc kd ke ji kf kg kh jm ki kj kk kl bi translated">什么是混沌工程？</h2><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lc"><img src="../Images/15cb595ec33d0c69e3a058745f91f983.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EmEinzq_SYrW_H1R5Ck-qQ.png"/></div></div></figure><p id="9803" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hq">混沌工程</strong>是一种测试分布式软件的方法，它故意引入失败和故障场景，以验证其在面对随机中断时的弹性。</p><blockquote class="ll lm ln"><p id="81d7" class="it iu lo iv b iw ix iy iz ja jb jc jd lp jf jg jh lq jj jk jl lr jn jo jp jq hb bi translated"><strong class="iv hq">混沌工程让你将你认为会发生的事情与你的系统中实际发生的事情进行比较。你实际上是“故意破坏东西”来学习如何建立更有弹性的系统。</strong></p></blockquote><h2 id="0396" class="jr js hp bd jt ju jv jw jx jy jz ka kb je kc kd ke ji kf kg kh jm ki kj kk kl bi translated">Gremlin是什么？</h2><figure class="ld le lf lg fd hk er es paragraph-image"><div class="er es ls"><img src="../Images/d93eae2b5fe16d9426129ca22e08d92c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*4jws-rnkWWZkpAZe4_eZnQ.png"/></div></figure><p id="f1e4" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Gremlin 是一种简单、安全、可靠的方法，通过使用混沌工程来识别和修复故障模式，从而提高系统的弹性。</p><p id="f752" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Gremlin 是一个可以在任何环境下运行的云原生平台。Gremlin支持所有公共云环境——AWS、Azure和GCP——并在Linux、Windows和容器化环境(如Kubernetes和bare metal)上运行。</p><p id="3686" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">2010年，<strong class="iv hq">网飞</strong>推出了一项随机关闭生产软件实例的技术——就像在服务器机房放一只猴子出来——来测试云如何处理它的服务。于是，工具<a class="ae lt" href="https://netflixtechblog.com/5-lessons-weve-learned-using-aws-1f2a28588e4c" rel="noopener ugc nofollow" target="_blank">混沌猴</a>诞生了。</p><p id="34a1" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hq">混沌工程在网飞等组织中日趋成熟，并催生了</strong><a class="ae lt" href="https://www.gremlin.com/community/tutorials/chaos-engineering-the-history-principles-and-practice/" rel="noopener ugc nofollow" target="_blank"><strong class="iv hq">Gremlin(2016)</strong></a><strong class="iv hq"/>等技术，变得更具针对性和知识性。</p><p id="6efc" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">现在让我们在谷歌云 上开始<strong class="iv hq"> <em class="lo"> Gremlin混沌工程实验如下:</em></strong></p><ol class=""><li id="b62d" class="km kn hp iv b iw ix ja jb je lu ji lv jm lw jq kt ku kv kw bi translated"><strong class="iv hq">对GKE吊舱的Gremlin关机攻击，以验证应用程序的高可用性</strong></li><li id="222f" class="km kn hp iv b iw kx ja ky je kz ji la jm lb jq kt ku kv kw bi translated"><strong class="iv hq"> Gremlin CPU攻击GKE Pod以验证GKE水平Pod自动缩放</strong></li><li id="f04d" class="km kn hp iv b iw kx ja ky je kz ji la jm lb jq kt ku kv kw bi translated"><strong class="iv hq"> Gremlin黑洞攻击GKE负载均衡器，以验证GKE上web应用程序的高可用性</strong></li></ol><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lx"><img src="../Images/8df87aac4dd08ed18295a7c981e74d98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KDg5BOSYfCtr8VBXTKHtZQ.png"/></div></div></figure><p id="4aeb" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">作为先决条件的一部分，我们已经注册了Gremlin Web App帐户。</p><p id="2aed" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">注册一个Gremlin网络应用账户→<a class="ae lt" href="https://app.gremlin.com/signup" rel="noopener ugc nofollow" target="_blank">https://app.gremlin.com/signup</a></p><p id="820c" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">为了在GKE上执行各种混沌实验，我们需要在GKE安装Gremlin Kubernetes客户端，以便我们可以从Gremlin web应用程序创建对GKE的各种攻击。</p><h2 id="c817" class="jr js hp bd jt ju jv jw jx jy jz ka kb je kc kd ke ji kf kg kh jm ki kj kk kl bi translated">在GKE集群上安装Gremlin客户端代理</h2><p id="2444" class="pw-post-body-paragraph it iu hp iv b iw ko iy iz ja kp jc jd je ly jg jh ji lz jk jl jm ma jo jp jq hb bi translated">要安装Gremlin Kubernetes客户端，您需要您的<strong class="iv hq"> Gremlin团队ID和密钥</strong>。如果您不知道您的团队ID和密钥是什么，您可以从Gremlin web应用程序中获取它们。</p><p id="320d" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">访问Gremlin中的<a class="ae lt" href="https://app.gremlin.com/settings/teams" rel="noopener ugc nofollow" target="_blank">团队页面</a>，然后在列表中点击您的团队名称。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es mb"><img src="../Images/203d196111809b5d26603fe654789386.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jfwoAtY2bjNxN9Gr1n9UgQ.png"/></div></div></figure><p id="8c2d" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">在团队屏幕上点击配置。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es mb"><img src="../Images/1037c8f41cdc0fdf7c52a431286ceea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TqoA90U0OBMzAwYuq2imYQ.png"/></div></div></figure><p id="dee5" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">如果您不知道您的密钥，您将需要重置它。单击重置按钮。您将看到一个弹出窗口，提醒您使用当前密钥的任何正在运行的客户端都需要配置新密钥。点击继续。</p><p id="7309" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">接下来，您将看到一个弹出屏幕，显示新的密钥。把它记下来。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div class="ab fe cl mc"><img src="../Images/57f162033c5bb524a5068a0353079fe7.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ElQWfCbDGN-Eb093WOlYng.png"/></div></figure><h2 id="0c28" class="jr js hp bd jt ju jv jw jx jy jz ka kb je kc kd ke ji kf kg kh jm ki kj kk kl bi translated">用Helm安装Gremlin客户端</h2><div class="hh hi ez fb hj md"><a href="https://www.gremlin.com/docs/getting-started/install-kubernetes-helm/" rel="noopener  ugc nofollow" target="_blank"><div class="me ab dw"><div class="mf ab mg cl cj mh"><h2 class="bd hq fi z dy mi ea eb mj ed ef ho bi translated">使用Helm | Gremlin Docs在Kubernetes上安装Gremlin</h2><div class="mk l"><h3 class="bd b fi z dy mi ea eb mj ed ef dx translated">除了在主机上安装Gremlin客户端之外，您还可以安装Gremlin Kubernetes客户端——两者都是…</h3></div><div class="ml l"><p class="bd b fp z dy mi ea eb mj ed ef dx translated">www.gremlin.com</p></div></div><div class="mm l"><div class="mn l mo mp mq mm mr hl md"/></div></div></a></div><p id="a9e4" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">添加Gremlin头盔图:</p><pre class="ld le lf lg fd ms mt mu mv aw mw bi"><span id="74b3" class="jr js hp mt b fi mx my l mz na">helm repo add gremlin <a class="ae lt" href="https://helm.gremlin.com" rel="noopener ugc nofollow" target="_blank">https://helm.gremlin.com</a></span></pre><p id="db17" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">为Gremlin Kubernetes客户端创建一个名称空间:</p><pre class="ld le lf lg fd ms mt mu mv aw mw bi"><span id="cb49" class="jr js hp mt b fi mx my l mz na">kubectl create namespace gremlin</span></pre><p id="70e5" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">接下来，您将运行<code class="du nb nc nd mt b">helm</code>命令来安装Gremlin客户端。在这个命令中，有三个占位符变量需要用真实数据替换。用你的团队ID替换<code class="du nb nc nd mt b">$GREMLIN_TEAM_ID</code>，用你的密钥替换<code class="du nb nc nd mt b">$GREMLIN_TEAM_SECRET</code>。将<code class="du nb nc nd mt b">$GREMLIN_CLUSTER_ID</code>替换为GKE集群的名称。</p><pre class="ld le lf lg fd ms mt mu mv aw mw bi"><span id="59a5" class="jr js hp mt b fi mx my l mz na">helm install gremlin gremlin/gremlin <br/>--namespace gremlin \<br/>--set gremlin.hostPID=true \<br/>--set gremlin.secret.managed=true \<br/>--set gremlin.container.driver=docker-runc \<br/>--set gremlin.secret.type=secret \<br/>--set gremlin.secret.teamID=$GREMLIN_TEAM_ID \ <br/>--set gremlin.secret.clusterID=$GREMLIN_CLUSTER_ID \<br/>--set gremlin.secret.teamSecret=$GREMLIN_TEAM_SECRET</span></pre><p id="17a6" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hq">注意:</strong>这里在上面的舵上安装小精灵。集装箱。驱动程序值可能因您的集群节点容器运行时而异。在我的例子中，我使用了Ubuntu-docker图像类型的GKE节点。</p><p id="dbf5" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">要验证安装是否成功，请运行以下命令:</p><pre class="ld le lf lg fd ms mt mu mv aw mw bi"><span id="61ac" class="jr js hp mt b fi mx my l mz na">kubectl get pods -n gremlin</span></pre><p id="bb67" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">输出应该显示集群中每个节点的一个<code class="du nb nc nd mt b">chao</code> pod和一个<code class="du nb nc nd mt b">gremlin</code> pod。这些都应该处于<code class="du nb nc nd mt b">Running</code>状态:</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es ne"><img src="../Images/4480f27c92c7b82305db5d9b78cf2803.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cfll2uBDG4YaBaWl0wok0g.png"/></div></div></figure><p id="7eb4" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">您也可以从Gremlin Web应用程序检查客户端的状态</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nf"><img src="../Images/0daa31957542bf0b661388c5bc5ea74e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G0AWy2lITrENB9kfBIdeug.png"/></div></div></figure><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es ng"><img src="../Images/a83f20c05cba2afd54861a8fc431cc8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TJb7lEH5LYr0RArWgGxBiA.png"/></div></div></figure><h2 id="5506" class="jr js hp bd jt ju jv jw jx jy jz ka kb je kc kd ke ji kf kg kh jm ki kj kk kl bi translated">设置与Gremlin Web App的Slack集成</h2><p id="4390" class="pw-post-body-paragraph it iu hp iv b iw ko iy iz ja kp jc jd je ly jg jh ji lz jk jl jm ma jo jp jq hb bi translated">我们还可以将我们的slack应用程序与Gremlin集成，以便在Slack通道上获得攻击报告和通知。</p><p id="011a" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">为了设置与Gremlin的slack集成，我们必须在Gremlin集成中添加我们为获取Gremlin攻击通知而创建的Slack通道。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nh"><img src="../Images/d79873b240e9aba263273191c872baa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3xXjJvmpH_hhPTrczjj7FA.jpeg"/></div></div></figure><p id="b4a3" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">现在只需选择您希望接收Gremlin通知的空闲频道，然后单击Allow。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es ni"><img src="../Images/b837d316d55b5f78010c466f14dc44c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g5yp6jhzOJzZMhlknuO5-w.jpeg"/></div></div></figure><p id="f9a9" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">这就是你与Gremlin的所有<strong class="iv hq"> Slack集成现在准备好了。</strong>🎉🎉</p><p id="b35a" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">现在，我们已经在GKE集群上安装了Gremlin代理，并启用了slack应用程序通知。</p><p id="a113" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">让我们在GKE集群上部署一个示例Nginx web应用程序。</p><h2 id="7183" class="jr js hp bd jt ju jv jw jx jy jz ka kb je kc kd ke ji kf kg kh jm ki kj kk kl bi translated">使用HPA在GKE集群上部署Nginx应用</h2><ol class=""><li id="ecc5" class="km kn hp iv b iw ko ja kp je kq ji kr jm ks jq kt ku kv kw bi translated">为Nginx部署创建一个单独的名称空间。</li></ol><pre class="ld le lf lg fd ms mt mu mv aw mw bi"><span id="2f8f" class="jr js hp mt b fi mx my l mz na">kubectl create ns app</span></pre><p id="bbdc" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">2.在应用程序命名空间中部署Nginx部署。</p><pre class="ld le lf lg fd ms mt mu mv aw mw bi"><span id="6ec3" class="jr js hp mt b fi mx my l mz na">kubectl apply -f nginx.yaml</span></pre><figure class="ld le lf lg fd hk"><div class="bz dy l di"><div class="nj nk l"/></div></figure><p id="d634" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">3.使用GKE负载平衡器公开Nginx部署。</p><pre class="ld le lf lg fd ms mt mu mv aw mw bi"><span id="c0b8" class="jr js hp mt b fi mx my l mz na">kubectl expose deployment myapp --type=LoadBalancer --port=80</span></pre><p id="67cf" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">4.为Nginx部署部署水平Pod自动缩放器。</p><pre class="ld le lf lg fd ms mt mu mv aw mw bi"><span id="2b7f" class="jr js hp mt b fi mx my l mz na">kubectl apply -f hpa.yaml</span></pre><figure class="ld le lf lg fd hk"><div class="bz dy l di"><div class="nj nk l"/></div></figure><p id="9960" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">5.使用以下命令检查是否正确部署了所有资源。</p><pre class="ld le lf lg fd ms mt mu mv aw mw bi"><span id="abe9" class="jr js hp mt b fi mx my l mz na">kubectl get all -n app</span></pre><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nl"><img src="../Images/219ad46e8c5c95b10a6084b0e1d7f4d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fRqkKPiQ052qPbu7k37Qqw.png"/></div></div></figure><p id="3948" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">我们现在可以开始在Nginx样本部署上执行各种混乱实验或攻击，以验证各种事情，如监控、警报、伸缩和可用性等是否工作。</p><h2 id="a300" class="jr js hp bd jt ju jv jw jx jy jz ka kb je kc kd ke ji kf kg kh jm ki kj kk kl bi translated">小鬼袭击</h2><figure class="ld le lf lg fd hk er es paragraph-image"><div class="er es nm"><img src="../Images/652476053d628f7db62d7cd23eeb0d81.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/1*Su9N0ao2leRgaDmlgP5Glw.gif"/></div></figure><p id="d316" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">攻击是一种以简单、安全和可靠的方式将故障注入系统的方法。 Gremlin提供了一系列针对您的基础设施的攻击。这包括影响系统资源、延迟或丢弃网络流量、关闭主机等等。除了运行一次性攻击，您还可以安排定期或重复攻击，创建攻击模板，以及查看攻击报告。</p><p id="177e" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Gremlin提供了三类攻击:</p><ul class=""><li id="9140" class="km kn hp iv b iw ix ja jb je lu ji lv jm lw jq nn ku kv kw bi translated"><strong class="iv hq">资源攻击:</strong>测试对计算资源消耗的突然变化</li><li id="6275" class="km kn hp iv b iw kx ja ky je kz ji la jm lb jq nn ku kv kw bi translated"><strong class="iv hq">网络攻击:</strong>测试不可靠的网络条件</li><li id="f0b1" class="km kn hp iv b iw kx ja ky je kz ji la jm lb jq nn ku kv kw bi translated"><strong class="iv hq">状态攻击:</strong>测试环境中的意外变化，比如断电、节点故障、时钟漂移或应用程序崩溃</li></ul><p id="1de9" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">我们将从Nginx部署上的这些攻击类型中选择一种进行攻击，以验证我们系统的各个方面。</p><h2 id="f4fd" class="jr js hp bd jt ju jv jw jx jy jz ka kb je kc kd ke ji kf kg kh jm ki kj kk kl bi translated">利用Gremlin关机攻击验证高可用性</h2><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es no"><img src="../Images/cd5f45a84c81cdce912fc55b1b03d4b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5slTujrcQT92X6Hrsj04-g.png"/></div></div></figure><p id="3960" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hq">关机攻击</strong>让团队通过测试他们的应用程序和系统在实例不再运行时的表现来建立对主机故障的恢复能力。</p><h2 id="f8b6" class="jr js hp bd jt ju jv jw jx jy jz ka kb je kc kd ke ji kf kg kh jm ki kj kk kl bi translated">为Nginx部署配置Gremlin攻击</h2><p id="6652" class="pw-post-body-paragraph it iu hp iv b iw ko iy iz ja kp jc jd je ly jg jh ji lz jk jl jm ma jo jp jq hb bi translated">转到Gremlin Web应用程序控制台中的攻击菜单→选择Kubernetes →选择集群和命名空间(目标应用程序所在的位置)</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es np"><img src="../Images/86b4dba9699c02655614c50e45b7ace4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZSpv4MfBAsXkrSpsvX-hug.png"/></div></div></figure><p id="89df" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">选择Gremlin执行攻击的目标部署，并定义攻击的爆炸半径。</p><p id="cd1c" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hq">爆炸半径:攻击中包含的主机数量或目标部分数量</strong></p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nq"><img src="../Images/f7ea64083b70b8cb048785f7b2cbbd03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N1VVL1OlYNyiH4TIAZhs5A.png"/></div></div></figure><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nq"><img src="../Images/a9bc8c72c5eb2f969a3f45f78c9bc280.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rVlDIAapJe2Wfiq1AHjxMA.png"/></div></div></figure><p id="a602" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">对于关机，攻击从状态攻击中选择攻击类型为关机攻击。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es np"><img src="../Images/0761bf73e72c562b62b6c1aa39fd4fbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*98-l0UDXPhgsnHCIjowgvg.png"/></div></div></figure><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nq"><img src="../Images/5ba9dd482d44ab9e2a449433f6130af6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qN49mH-U_VO6Vi3vSi4hHg.png"/></div></div></figure><p id="3f7b" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">点击释放小妖精运行特定的攻击。</p><p id="5789" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hq">运行Gremlin关机攻击</strong></p><p id="f276" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">单击attack details查看Gremlin在Nginx Deployment Pods上运行的攻击的详细信息和输出。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nq"><img src="../Images/53fe5e96d1ac34e818d5d94157379efd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dc5ifwqB6n_0uawXz3tcQg.png"/></div></div></figure><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nq"><img src="../Images/0d1aa6a85be885dfb31d08d1b88ff7c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-5a1wjuX134ZN9qYHzX16Q.png"/></div></div></figure><p id="48bb" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">我们可以看到，由于更多的副本，即使在运行关闭攻击时，Nginx部署也是高度可用的。</p><pre class="ld le lf lg fd ms mt mu mv aw mw bi"><span id="d6ae" class="jr js hp mt b fi mx my l mz na">kubectl get pods -n app -w</span></pre><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nr"><img src="../Images/28285a0748a1a7634235551bba8b54ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LvgiHSH3xRcHtXDfEW7Qhg.png"/></div></div></figure><p id="341f" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hq">关机攻击可以回答如下问题:</strong></p><ul class=""><li id="3326" class="km kn hp iv b iw ix ja jb je lu ji lv jm lw jq nn ku kv kw bi translated">实例重新启动需要多长时间？当实例重新联机时，我的应用程序是否成功重启？</li><li id="e954" class="km kn hp iv b iw kx ja ky je kz ji la jm lb jq nn ku kv kw bi translated">我的负载平衡器会自动将请求从失败的实例中重新路由出去吗？我有其他实例来处理这些请求吗？</li><li id="81b7" class="km kn hp iv b iw kx ja ky je kz ji la jm lb jq nn ku kv kw bi translated">如果用户在一个失败的实例上有一个活动会话，该会话会在另一个实例上正常继续吗？</li><li id="a2a4" class="km kn hp iv b iw kx ja ky je kz ji la jm lb jq nn ku kv kw bi translated">有没有数据丢失？正在进行的处理作业是否重新启动？</li></ul><h2 id="372c" class="jr js hp bd jt ju jv jw jx jy jz ka kb je kc kd ke ji kf kg kh jm ki kj kk kl bi translated">使用Gremlin验证GKE水平Pod自动缩放</h2><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es no"><img src="../Images/8662265f4b343331cc73ee6cea0ca4dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*44KKIV70KOhw4FgtL6nC0w.png"/></div></div></figure><p id="e80d" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">CPU攻击有助于确保即使在CPU容量有限或耗尽的情况下，您的应用程序也能按预期运行。CPU攻击还有助于测试和验证自动修复过程，如自动扩展和负载平衡。</p><p id="024a" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">对于CPU攻击，从资源攻击中选择攻击类型作为CPU攻击，并为攻击配置更多详细信息，如攻击持续时间、将受影响的目标CPU容量等。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es np"><img src="../Images/0761bf73e72c562b62b6c1aa39fd4fbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*98-l0UDXPhgsnHCIjowgvg.png"/></div></div></figure><p id="eccd" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hq">运行Gremlin CPU攻击</strong></p><p id="21e4" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">单击attack details查看Gremlin在Nginx Deployment Pods上运行的攻击的详细信息和输出。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es ns"><img src="../Images/a0dcdc6504853966a96f719df8787167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6uL2aPbYSc1T-kZNKWaloA.png"/></div></div></figure><p id="50db" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">我们可以验证Nginx Pods为CPU利用率定义的水平Pod自动扩展在攻击期间是否工作。</p><pre class="ld le lf lg fd ms mt mu mv aw mw bi"><span id="2ffd" class="jr js hp mt b fi mx my l mz na">kubectl get pods -n app -w</span></pre><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es np"><img src="../Images/ae6870aafe4739278de2a717ec21b5a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XbfS9U_D6Qlklmy775814Q.png"/></div></div></figure><p id="f782" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">我们可以看到，GKE HPA将Nginx Pods按比例增加到4，因为我们定义的最大计数是4。</p><pre class="ld le lf lg fd ms mt mu mv aw mw bi"><span id="f76b" class="jr js hp mt b fi mx my l mz na">kubectl get hpa</span></pre><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es np"><img src="../Images/c92189f30109d7bc2456472929797c96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9pBtvgU-IBTlqfwwH2a0bg.png"/></div></div></figure><p id="a7a9" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">这样，通过运行CPU或内存攻击，我们可以验证为应用程序定义的HPA。</p><p id="fb47" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hq"> CPU攻击可以回答如下问题:</strong></p><ul class=""><li id="ca1d" class="km kn hp iv b iw ix ja jb je lu ji lv jm lw jq nn ku kv kw bi translated">当CPU资源耗尽时，用户体验会受到怎样的影响？</li><li id="6eb5" class="km kn hp iv b iw kx ja ky je kz ji la jm lb jq nn ku kv kw bi translated">我是否有适当的监控和警报来检测CPU峰值？</li><li id="50e4" class="km kn hp iv b iw kx ja ky je kz ji la jm lb jq nn ku kv kw bi translated">我是否配置了配额来按应用程序、进程或容器限制CPU？</li><li id="11b7" class="km kn hp iv b iw kx ja ky je kz ji la jm lb jq nn ku kv kw bi translated">我有清理脚本来清除损坏的线程吗？</li></ul><h2 id="20df" class="jr js hp bd jt ju jv jw jx jy jz ka kb je kc kd ke ji kf kg kh jm ki kj kk kl bi translated">利用GKE负载均衡器上的Gremlin黑洞攻击验证Nginx Web App的高可用性</h2><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es no"><img src="../Images/c0d39e7812dab6a62d6abbaf1ad47fba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*off-U26FDMd6wuiRk3LERg.png"/></div></div></figure><p id="49bc" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">黑洞攻击允许您通过丢弃服务之间的网络流量来模拟这些中断。这使您能够发现硬依赖、测试回退和故障转移机制，并为应用程序应对不可靠的网络做好准备。</p><p id="efdd" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">对于黑洞攻击，从网络攻击中选择攻击类型作为黑洞攻击，并为攻击配置更多细节，如端口细节等。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es np"><img src="../Images/e75af9f6b87af04b6ad7647f9f56ca99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*do5rnVBMY5Q_5sU4AW15gQ.png"/></div></div></figure><p id="9570" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">在我们的例子中，我们在端口80上运行Nginx部署。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es np"><img src="../Images/5971e764999dbf2570b70086d0616876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ErLNIBQS-ZhusC8fvIWb-g.png"/></div></div></figure><p id="6ae0" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hq">运行小妖精黑洞攻击</strong></p><p id="0699" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">单击attack details查看Gremlin在Nginx Deployment Pods上运行的攻击的详细信息和输出。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nf"><img src="../Images/30df59b8061c187dce093c076ed2889d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TLgIE1g1lf4AJ9VwLk09ZQ.png"/></div></div></figure><p id="4a4e" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">我们可以从GCP负载平衡器外部IP检查Nginx网页状态。由于多个后端单元之间的高可用性和GCP负载平衡，在web体验方面没有延迟或阻塞。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es np"><img src="../Images/a5a314ca168f191baa82e43ed530684c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ENJXjV6OZ5_AHk1K1VuI6Q.png"/></div></div></figure><p id="cd7b" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hq">黑洞攻击可以回答如下问题:</strong></p><ul class=""><li id="aec5" class="km kn hp iv b iw ix ja jb je lu ji lv jm lw jq nn ku kv kw bi translated">在我们的系统中，依赖关系存在于哪里？</li><li id="1388" class="km kn hp iv b iw kx ja ky je kz ji la jm lb jq nn ku kv kw bi translated">我们是否有适当的监控来提醒每个服务的不可用性？</li><li id="0765" class="km kn hp iv b iw kx ja ky je kz ji la jm lb jq nn ku kv kw bi translated">如果依赖项不可用，我们的应用程序会正常降级吗？</li><li id="8d86" class="km kn hp iv b iw kx ja ky je kz ji la jm lb jq nn ku kv kw bi translated">当下游依赖项不可用时，用户体验会受到负面影响吗？</li><li id="5fe0" class="km kn hp iv b iw kx ja ky je kz ji la jm lb jq nn ku kv kw bi translated">我们是否有一些我们认为不重要的依赖关系，但实际上可能会导致整个应用程序崩溃？</li></ul><p id="48fa" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">对于<strong class="iv hq">通知</strong>部分，我们已经配置了<strong class="iv hq">与Gremlin web应用</strong>的slack集成，通过它我们可以获得slack通道中关于我们对GKE执行的每个Gremlin攻击状态的所有通知。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nf"><img src="../Images/b2b0ca5a41c6a54c8b2c6ee48f4e5478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rk3CskzQgu7vapR79geb8A.png"/></div></div></figure><h2 id="7601" class="jr js hp bd jt ju jv jw jx jy jz ka kb je kc kd ke ji kf kg kh jm ki kj kk kl bi translated">结论</h2><figure class="ld le lf lg fd hk er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es nt"><img src="../Images/c44becc8a292bbeecaa468861980ff20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*NNUp98Dtq5TyzXEbqWruyw.gif"/></div></div></figure><p id="e27b" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">混沌工程的首要目标是通过测试我们的应用程序和系统如何处理故障来提高它们的可靠性。要做到这一点，我们需要采取一种结构化的、组织良好的方法，具有明确定义的目标和关键绩效指标(KPI)。</p><p id="3c1a" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">在没有任何指导或监督的情况下运行随机实验不会产生可操作的结果，并且会将我们的系统置于不必要的风险中。</p><p id="ccc9" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">为了达到提高可靠性的高层次目标，我们需要使用更细粒度的目标来指导我们的混沌工程采用过程。</p><h1 id="33c7" class="nu js hp bd jt nv nw nx jx ny nz oa kb ob oc od ke oe of og kh oh oi oj kk ok bi translated">有问题吗？</h1><p id="5d0c" class="pw-post-body-paragraph it iu hp iv b iw ko iy iz ja kp jc jd je ly jg jh ji lz jk jl jm ma jo jp jq hb bi translated">如果你有任何问题，我很乐意在评论中阅读。在<a class="ae lt" rel="noopener" href="/@onkar17">媒体</a>或<a class="ae lt" href="https://www.linkedin.com/in/onkar17/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上关注我。</p></div></div>    
</body>
</html>