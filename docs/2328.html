<html>
<head>
<title>Achieving confidential and risk-averse AI/ML with advances in ubiquitous data encryption</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">借助无处不在的数据加密技术的进步，实现保密和规避风险的AI/ML</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/achieving-confidential-and-risk-averse-ai-ml-with-advances-in-ubiquitous-data-encryption-8c9b251c48cd?source=collection_archive---------2-----------------------#2022-08-25">https://medium.com/google-cloud/achieving-confidential-and-risk-averse-ai-ml-with-advances-in-ubiquitous-data-encryption-8c9b251c48cd?source=collection_archive---------2-----------------------#2022-08-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/85411e5dce5d9f4e888de55fb8b43f27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R0rTj8QU9Tsur2VKoy713A.jpeg"/></div></div></figure><p id="faa3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">(本文原载于LinkedIn，其中还链接了一段说明视频)</em></p><p id="808c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">云规模AI/ML解决方案按需提供无与伦比的容量和速度，但一些组织出于隐私、数据主权或安全考虑，不允许其工程师考虑这些解决方案。无论是出于商业还是文化原因，对保证的需求甚至可能超过监管要求。更严格地说，端到端数据加密无处不在，通过独特地结合来自谷歌云平台、AMD和Thales等组织的解决方案，工程师可以提供保证。这些安全收益没有得到充分开发和理解，更不用说它们在规避风险的AI/ML环境中的潜力了。</p><p id="49e6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">具有讽刺意味的是，要实现这种保密性，还有一个障碍。Cloudnative，secured containerisation与机器内存加密所需的硬件不兼容。我们提出了一种新的中间件API方法来解决这个问题，并考虑了vTPM加密证明在引导时的作用、Linux内核选项和T/GPU可用性。</p><ul class=""><li id="1762" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">隐私、数据主权和商业问题人为地降低了人工智能/人工智能的胃口</li><li id="8123" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">成为贵组织的加密AI/ML提供商可提供安全的控制</li><li id="b88a" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">查明加密故事中缺失的环节</li><li id="7699" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">使用无处不在的数据加密为机密数据带来AI/ML</li><li id="54d1" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">cloud native catch 22:container ization是无处不在的数据加密的安全屏障</li><li id="df7a" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">让机密AI/ML架构适合云原生工作负载</li><li id="7956" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">进一步阅读</li></ul><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/ea343aca20fa6daaa58bb3562f8b9185.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fU7gkmPpEgEXEe9N"/></div></div></figure><p id="10e5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">AI/ML解决方案的商业前景已经在一系列领域得到了充分证明，从预测分析和文档处理到语言和视频分析。云规模解决方案按需提供无与伦比的容量和速度，但一些组织不放心考虑它们的潜力。#隐私、#数据主权或#安全问题可能会面临棘手的障碍——云服务提供商(CSP)本身需要的隐性信任，以及在云中托管公共#AIML计算的管辖权选择。#MachineLearning的覆盖范围不断扩大，增加了可能受益但需要保证的群体数量。在关注还没有说出来或者对AI/ML的考虑还不成熟的地方，AI/ML的潜在用途甚至可能不会公开。</p><p id="8703" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/googlecloudplatform" rel="noopener ugc nofollow" target="_blank"># Google cloud platform</a>(<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/gcp" rel="noopener ugc nofollow" target="_blank"># GCP</a>)在CPU级内存加密和条件加密密钥访问方面的进步，为规避风险或对管辖权敏感的AI/ML使用开辟了新的可能性。这一未被充分利用且鲜为人知的机会已经被用于金融服务领域，并提供了比通常在云中更全面的数据<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/endtoendencryption" rel="noopener ugc nofollow" target="_blank"> #EndToEndEncryption </a>。CSP控制可以阻止密钥访问，改进的管辖控制可以强制<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/cloudnative" rel="noopener ugc nofollow" target="_blank"> #cloudnative </a> AI/ML满足您的数据主权需求。同时保持非批处理工作负载所需的无与伦比的云可扩展性和按需速度。</p><p id="0688" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们下面要解决的架构挑战是如何将这些技术应用于现代集装箱工作负载，解决GCP提供的解决方案中不可避免的限制。这是因为涉及到你的容器不应该与之对话的硬件。我们提出了API中间件，并谈到了为什么vTPM加密证明的GCP操作日志是不够的。我们还简要探讨了Linux内核参数，即使在实例内存<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/encryption" rel="noopener ugc nofollow" target="_blank"> #encryption </a>不可用的情况下(例如，与G/TPU硬件一起)，这些参数也应该提供充分的保证。</p><p id="8006" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下文将在本文后面解释，并且无疑可以改进。任何建议，意见和差距或错误的识别将不胜感激。</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kj"><img src="../Images/6f1cb5a754da210775c8c4b182f42ff0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ShiC_oVpQBgDQppq9xG8gA.jpeg"/></div></div></figure><h1 id="b688" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">隐私、数据主权和商业问题人为地降低了人工智能/人工智能的胃口</h1><p id="afff" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">与国家安全相关的金融服务、医疗保健和其他行业在信任第三方系统及其数据或分析方面仍会自然保守。云毕竟是“别人的电脑”。这种不安甚至可能是一个组织、部门或团队的文化，当GCP等提供商定期满足严格的合规标准时，这种不安就会持续存在，包括ISO、FedRamp、HIPAA、PCI/DSS、EBA、ESMA、PRA和其他与云外包相关的法规和标准。API提供的CSP服务也不能幸免于此，这与机器学习非常相关。预装的最先进的GCP人工智能/人工智能服务是通过公共API以编程方式访问的，这些API是由不分配给你的安全“公共”计算提供的。</p><h1 id="ee39" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">成为贵组织的加密AI/ML提供商可提供安全的控制</h1><p id="e929" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">充当您组织的cloudnative AI/ML服务提供商是可行的备选方案——从您的私有集群构建、测试、服务和管理模型。这些可以在混合或多云# <a class="ae ki" href="https://cloud.google.com/anthos" rel="noopener ugc nofollow" target="_blank"> Anthos </a>环境中，或者在谷歌Kubernetes引擎(<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/gke" rel="noopener ugc nofollow" target="_blank"> #GKE </a>)上。虽然比使用谷歌的开箱即用API更麻烦，但这种越来越常见的方法通过标准的开源平台，如<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/kubeflow" rel="noopener ugc nofollow" target="_blank"> #Kubeflow </a>(建立在Knative等技术上，用于私有cloudnative体验)，为您的机器学习工程师和基础设施管理员提供高效和可扩展的控制。快速浏览一下这个私有GKE集群解决方案的更广泛的安全状况，可以发现它解决了我们在本文开头提到的许多问题。但不完全是，我们将会看到。</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/7bc7ae7fd5c4832aba1199f4c79f71b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JIpxFfTKTl3cUblg"/></div></div></figure><p id="b20e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">即使不考虑GCP 100亿美元的网络安全计划，加密和T2密码术也是这个平台所固有的。您自己的<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/cloud" rel="noopener ugc nofollow" target="_blank"> #cloud </a>集群可以从引导固件和序列的加密签名和散列的机器完整性测试中受益(它们在屏蔽计算实例中聚集在一起，也可以部署为GKE屏蔽节点)。然后，您知道您的虚拟机本身没有受到干扰，即使是受到损害的虚拟机管理程序。存储中的静态数据总是加密的。还有增加云上和云下控制程度的选项，比如集成外部<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/keymanagement" rel="noopener ugc nofollow" target="_blank"> #keymanagement </a>系统或者直接提供你自己的密钥。此外，存储的数据被分块存储在不同的位置，每个数据块都单独加密，以防止谷歌文件系统Colossus遭到破坏。从你的机器的角度来看，数据也在网络层(第3层)进行加密，这一切都发生在GCP的Andromeda软件定义网络(SDN)上。作为其基础的旋转密钥由身份验证安全令牌补充，这是欺骗数据包无法模仿的。<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/zerotrustsecurity" rel="noopener ugc nofollow" target="_blank"> #ZeroTrustSecurity </a>规程可以在微服务之间进一步加密，比如在Istio或者其他服务mesh框架内使用MTL(不限于容器化的工作负载)。GCP的网络吞吐量<a class="ae ki" href="https://www.cockroachlabs.com/blog/2021-cloud-report/" rel="noopener ugc nofollow" target="_blank">是其他CSP的三倍</a>(部分原因是定制的NIC硬件从CPU上卸载了加密)。以及您在GCP地区的集群和您选择的司法管辖区(相对于GCP AI/ML API位置，这里的“全球”、“美国”或“欧盟”位置对于您的数据主权需求来说可能过于宽泛)。</p><h1 id="6431" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">查明加密故事中缺失的环节</h1><p id="76c2" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">所有上述控制和加密是至关重要的保证和最佳实践。适用于监管场景的防弹设计。但是在上面概述的传统云加密链中有两个漏洞。</p><p id="7d2d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，机器存储器本身是未加密的。这导致恶意行为者获取正在处理的未加密数据的可能性极小，这些数据在存储和传输过程中经过了精心加密。这可能是假设发生的，因为谷歌部署的无数安全措施遭到破坏。或者是因为一个新的CPU级别或KVM/QEMU虚拟机管理程序漏洞在被发现和修补之前就被利用了，从而允许某人在自己的虚拟机之外探索裸机主机。</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/8a9e5da8bb286b641966914f8b42bd5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jxeM3_oItoXz0-gG"/></div></div></figure><p id="14a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/linux" rel="noopener ugc nofollow" target="_blank"> #Linux </a>的术语来说，让我们阐明自由探索你的虚拟机或公共服务的内存是不可能的。在主流Linux发行版中，默认情况下不支持对/dev/mem或/dev/kmem的直接访问。分别地，主内存访问需要在<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/kernel" rel="noopener ugc nofollow" target="_blank">#内核</a>中故意禁用<a class="ae ki" href="https://www.kernel.org/doc/man-pages/online/pages/man4/mem.4.html" rel="noopener ugc nofollow" target="_blank"> CONFIG_STRICT_DEVMEM </a>，访问整个内核虚拟内存空间需要启用<a class="ae ki" href="https://www.kernel.org/doc/man-pages/online/pages/man4/mem.4.html" rel="noopener ugc nofollow" target="_blank"> CONFIG_DEVKMEM </a>。最佳实践也是在GCP 上启动Linux映像的<a class="ae ki" href="https://cloud.google.com/compute/docs/images/building-custom-os#kernelbuild" rel="noopener ugc nofollow" target="_blank">要求。x86系统上的</a><a class="ae ki" href="https://www.kernel.org/doc/Documentation/admin-guide/kernel-parameters.txt" rel="noopener ugc nofollow" target="_blank"> nopat </a>内核参数也不应该有意启用页面属性表，因为这样会减轻恶意的内存探测。GCP用于GKE节点的<a class="ae ki" href="https://cloud.google.com/container-optimized-os/docs/concepts/security" rel="noopener ugc nofollow" target="_blank">容器优化操作系统</a>有一个超过这些标准的强化方法。鉴于引导加载程序是操纵内核引导选项的最直接的方式，还值得注意的是，所有这些<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/linuxkernel" rel="noopener ugc nofollow" target="_blank"> #LinuxKernel </a>选项的完整性都受到UEFI measured-boot hashing在<a class="ae ki" href="https://lists.gnu.org/archive/html/grub-devel/2017-07/msg00003.html" rel="noopener ugc nofollow" target="_blank"> GRUB </a>上下文中的保护。人们可以合理地假设，以上所有以及更多都是谷歌裸机的默认做法，其他一切都在裸机上运行。</p><p id="3078" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第二，CSP仍然需要与管理和访问用于解密或签名的密钥相关的剩余信任级别。如果您将外部管理的加密密钥集成到GCP云KMS中，这种必要的信任也同样适用。在最基本的情况下，如果GCP向他们或您的内部部署系统索要密钥，GCP会得到一个密钥。在此之上的许可控制来自基于角色的GCP身份访问管理(IAM)和GCP元数据。对IAM本身和元数据供应的假设违反需要足够具体或足够广泛，以实现访问1) GCP的云密钥管理系统(云KMS)和/或2)通过云外部密钥管理(EKM)集成到云KMS访问内部<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/kms" rel="noopener ugc nofollow" target="_blank"> #KMS </a>。</p><p id="de84" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">简而言之，跨虚拟机实例探索内存几乎是不可能的。某些形式的攻击还需要物理访问场所，这<a class="ae ki" href="https://www.youtube.com/watch?v=kd33UVZhnAA" rel="noopener ugc nofollow" target="_blank">更不可能</a>。许多将意味着一个严重的预先计划的复杂程度——也许需要国家赞助。现实情况是，主要的云提供商超出了几乎任何组织可以独自实现的安全级别和一致性。此外，在上述假设的可能性中，还有许多未言明的“如果”。</p><p id="a147" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">尽管如此，零信任安全作为一门学科存在是有原因的。从<a class="ae ki" href="https://meltdownattack.com/" rel="noopener ugc nofollow" target="_blank"> Meltdown和Spectre </a>到<a class="ae ki" href="https://googleprojectzero.blogspot.com/2021/06/an-epyc-escape-case-study-of-kvm.html" rel="noopener ugc nofollow" target="_blank"> hypervisor漏洞</a>，‘未知的未知’不会预先宣布它们自己。这意味着需要加密内存计算来进一步增强云安全性，而不仅仅是针对<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/artificialintelligence" rel="noopener ugc nofollow" target="_blank">#人工智能</a>工作负载。已经满足的需求…</p><h1 id="9576" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">使用无处不在的数据加密为机密数据带来AI/ML</h1><p id="19a0" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">硅巨头通过加密内存解决方案满足了这一市场需求，这也为更普遍的端到端加密开辟了一种新的CSP阻塞密钥管理模式。这些收益没有得到充分开发和理解，更不用说它们在规避风险的人工智能/人工智能环境中的潜力了。通常，GCP提供的基于API的服务仍然是企业人工智能/人工智能对话中唯一的一等公民。最初考虑机器学习的可能性时，不要忽略共享的公共CSP计算选项。</p><p id="d097" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">虚拟机内存加密减少了CSP中所需的隐式信任，因为读取系统内存基本上变得不可能。这可以在不改变代码或执行速度的情况下直接放到大多数堆栈中，因为这是CPU级别的特性。GCP通过GCP N2D和C2D机器类型中的EPYC罗马和米兰一代CPU实现了这一点。机密虚拟机实例可以用作独立的谷歌计算引擎(GCE)虚拟机，也可以用作GKE集群(包括Anthos)中的机密节点。这些处理器使用AMD <a class="ae ki" href="https://developer.amd.com/sev/" rel="noopener ugc nofollow" target="_blank">安全加密虚拟化(SEV) </a>技术对内存进行加密，从而将其安全内存加密(SME)技术开放给KVM实例。内存加密密钥是在虚拟机创建期间生成的，并不存储在AMD芯片之外，这意味着谷歌在设计上无法访问它们。</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/35ac6c9e3e2295cf06148e9117961a76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*26DdOTp7UMhO9Zny"/></div></div></figure><p id="4a76" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">来自GCP的令人兴奋的发展是，现有的技术可以创新地结合起来，超越端到端加密，实现谷歌所说的<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/ubiquitousdataencryption" rel="noopener ugc nofollow" target="_blank"># ubiquitousdatacryption</a>(<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/ude" rel="noopener ugc nofollow" target="_blank"># UDE</a>)。外部内部KMS可能已经通过<a class="ae ki" href="https://cloud.google.com/kms/docs/ekm#supported_partners" rel="noopener ugc nofollow" target="_blank">云EKM </a>连接到云KMS，这意味着GCP服务可以依赖于外部管理的加密密钥。当机密实例与EKM结合时，GCP看不到保存在加密内存中的临时密钥，也看不到数据解密/加密操作所需的临时密钥(可能用于数据块、对象或文件级存储)。外部KMS访问也可以锁定到特定的实例、特定的区域、特定的项目。这降低了GCP IAM漏洞的爆炸半径，并由外部KMS测井(可用于SRE自动化和警报)补充。<a class="ae ki" href="https://cloud.google.com/vpc-service-controls/docs/supported-products" rel="noopener ugc nofollow" target="_blank"> VPC服务控制</a>也可能在限制访问云EKM方面发挥作用。但是存储器加密密钥隐藏的好处不能预先作为外部KMS的要求来实施。实例配置选择由GCP决定，不会阻止非机密虚拟机成功访问外部KMS。GCP现在已经弥补了这个缺口。</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/42e4f9becd83b9ea7691f8039ec30e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MUWtoNe0MdIvbmVP"/></div></div></figure><p id="2150" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">新的魔力来自于<a class="ae ki" href="https://thalesdocs.com/ctp/cm/2.9/reference/cckmapi/ekm-apis/index.html#example-response_1" rel="noopener ugc nofollow" target="_blank">进一步锁定外部KMS</a>，EKM访问以加密内存硬件发出请求为条件(最初仅由<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/thales" rel="noopener ugc nofollow" target="_blank"> #Thales </a> CipherTrust云密钥管理器支持)。因此，短暂的存储密钥访问可以锁定到加密的内存实例，进一步减少了GCP所需的隐式信任。<a class="ae ki" href="https://thalesdocs.com/ctp/cm/2.9/reference/cckmapi/ekm-apis/index.html#example-response_1" rel="noopener ugc nofollow" target="_blank">密钥访问策略</a>也可以由您的本地KMS单独控制加密和解密操作(例如，可能信任未加密内存的本地工作负载)。GCP为这样的关键操作提供了一个客户端工具<a class="ae ki" href="https://github.com/GoogleCloudPlatform/stet" rel="noopener ugc nofollow" target="_blank">,它也直接集成到了谷歌云存储(GCS)对象的gsutil中。用于AI/ML模型生成的数据湖通常理想地保存在</a><a class="ae ki" href="https://www.linkedin.com/feed/hashtag/objectstorage" rel="noopener ugc nofollow" target="_blank"> #ObjectStorage </a>上，这使得该特性对上面讨论的私有AI/ML集群具有直接的重要性。为了进一步保证，可以部署分割信任方法，其中秘密被<a class="ae ki" href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing" rel="noopener ugc nofollow" target="_blank">分割成多个部分</a>，授权必须由GCP云KMS和外部KMS通过EKM授予。这种全面的UDE方法已经在现场成功部署，一个例子是<a class="ae ki" href="https://cloud.google.com/blog/products/identity-security/ubiquitous-data-encryption-on-google-cloud" rel="noopener ugc nofollow" target="_blank">德意志银行</a>。</p><p id="62a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以看到我们已经解决了开始时的问题。Cloudscale AI/ML的可能性不需要受到隐私、数据主权或安全问题的阻碍。可扩展的按需专用GKE节点池可以在特定的国家管辖区部署加密内存，取代云中的公共AI/ML计算。云最佳实践已经可以满足监管期望，但是额外的加密保护为文化风险厌恶者或特定的业务需求提供了24克拉的安全性。通过UDE，CSP所需的隐性信任可以大大减少，而控制力会增加。</p><p id="5859" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步是克服该解决方案不可避免的技术限制。</p><h1 id="ca9f" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">cloud native catch 22:container ization是无处不在的数据加密的安全屏障</h1><p id="bbc0" class="pw-post-body-paragraph iq ir hi is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">我们下面要解决的复杂问题是，GCP工具必须作为根用户在机密虚拟机上运行。但是在GKE或Anthos实现中，以root用户身份运行容器是不可用的。出于良好的安全原因，最佳实践不允许特权容器。</p><p id="ef29" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">AI/ML工作负载可以直接部署在自动扩展的托管实例组(MIG)上，而不需要容器化来解决这个问题。这是一个合理的解决方案，但在云原生计算的世界中是一个现实的问题。<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/kubernetes" rel="noopener ugc nofollow" target="_blank"> #Kubernetes </a>是像Kubeflow这样的公司的<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/mlops" rel="noopener ugc nofollow" target="_blank"> #MLops </a>工作流和编排所必需的，在整个模型生命周期中提供了大量的实际收益。与仅仅构建和部署的传统软件不同，模型必须不断地被策划以保持预测能力。模型和版本的蔓延也必须得到相应的管理。</p><p id="9044" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好奇者:这些根特权是必需的，因为必须核对硬件环境，特别是要用密码证明发出请求的虚拟机是机密实例。我们假设这需要访问/proc/cpuinfo、/dev/tpm0和/或/dev/tpmrm0。目前尚不清楚哪些用于远程证明中使用的特别检查(由<a class="ae ki" href="https://www.amd.com/system/files/TechDocs/SEV-SNP-strengthening-vm-isolation-with-integrity-protection-and-more.pdf" rel="noopener ugc nofollow" target="_blank">安全嵌套分页(SNP) </a>在启动时测量boot捕获SEV状态后执行)。可以选择使用GCP Ops日志记录，其中包含在引导时进行的vTPM证明。这在我们的机密计算场景中是不合适的。我们需要在不重启的情况下对请求进行特别证明，而GCP运营仍然依赖于对CSP系统的隐式信任。</p><h1 id="1fef" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">让机密AI/ML架构适合云原生工作负载</h1><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/e43f83e7fda302b675ed478bcb4c1d8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fAhnfhfckK3c9qtZ"/></div></div></figure><p id="259c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安全集装箱化是实现UDE的一个障碍，所以我们能做什么？如上所述，我们可以放弃kube flow type<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/architecture" rel="noopener ugc nofollow" target="_blank"># architecture</a>的cloudnative收益，而仅仅将模型直接部署到MIG。如果这是不可接受的，我们建议的解决方案是组装非常简单的中间件，在自动扩展MIG中的原始虚拟机上运行不受限制的API。MIG端点可以被防火墙保护，以仅通过GCP内部Https负载平衡进行应答(“ing and not”er，因为GCP LBs是SDN堆栈的一部分，其本身不是平衡器)。这将允许私有集群上运行的其他容器化工作负载通过REST或gRPC运行UDE操作或请求GCS上的UDE保护对象数据。还增加了一层“通过模糊来获得安全感”</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kj"><img src="../Images/6f1cb5a754da210775c8c4b182f42ff0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ShiC_oVpQBgDQppq9xG8gA.jpeg"/></div></div></figure><p id="9556" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这种方法保持了云的可扩展性。根据实际负载，MIG中的机器数量将会增加或减少。值得注意的是，非批量数据分析场景对网络吞吐量更敏感。实例模板必须考虑到这一点，通过<a class="ae ki" href="https://cloud.google.com/compute/docs/machine-types#machine_type_comparison" rel="noopener ugc nofollow" target="_blank">选择机器形状</a>以获得及时的结果，因为最大带宽范围从10到100Gbps。中间件API机器的配置可以由cloudinit部署，无论是运行bash、ansible、puppet还是其他脚本。用于加密和解密操作的GCP UDE工具的<a class="ae ki" href="https://github.com/GoogleCloudPlatform/stet/blob/main/docs/advanced_configuration.md" rel="noopener ugc nofollow" target="_blank"> YAML配置保存在~/。每个托管实例上的config/stet.yaml(包括是否使用拆分键)。</a></p><p id="c77f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个MIG上创建到UDE的API的一个“快速而肮脏”的方法是打开两个https端点来监听post请求。将中间件请求记录到每个虚拟机的系统日志将确保它们被自动收集到GCP日志中，以进行手动分析或自动化。命令行工具本身必须由API在后台使用，因为在撰写本文时，UDE功能尚未集成到GCP SDK中:</p><ol class=""><li id="ccb3" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ls jv jw jx bi translated">/stet端点将从GCP工具运行stet命令，使用UDE保护密钥进行直接加密和解密，加密内存虚拟机上的客户端库将通过云EKM访问这些密钥。端点有三个参数API密钥、操作符类型(加密/解密)和操作数(base64格式的文件)。</li><li id="b108" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ls jv jw jx bi translated">/gsutilcpstet终结点将运行带有–stet标志的gsutil cp命令，该命令在一个命令中自动完成从GCS和UDE操作的对象传输。端点有三个参数API键、源和目的地。对于解密，源是gs://对象位置，API响应将包含base64格式的文件。对于加密，源是base64格式的文件，目标是gs://对象位置。Base64编码支持blobs，如图像。可以在GKE节点本身上执行桶和对象的导航，因为查看GCS名称或元数据不需要关键字，只需要适当的IAM特权或访问范围。</li></ol><p id="4361" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">还有一些额外的技术要点需要工程师考虑。gsutil的STDOUT目前不能通过管道传输，因此可以在bash序列中调用它，如下所示:</p><pre class="ke kf kg kh fd lt lu lv lw aw lx bi"><span id="3fd6" class="ly kl hi lu b fi lz ma l mb mc">destination="$(urlencode $source)"$EPOCHREALTIME; \</span><span id="4149" class="ly kl hi lu b fi md ma l mb mc">gsutil cp --stet "gs://$source” $destination; \</span><span id="8022" class="ly kl hi lu b fi md ma l mb mc">base64 $destination</span></pre><p id="81a0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在生成输出时，STDOUT应该流式传输到http，并且在完成之前不会被阻塞。否则，内存使用量将会激增，因为base64编码版本将一直保存在内存中，直到完全生成并准备好提供服务(数据归档可能非常大)。例如，<a class="ae ki" href="https://www.npmjs.com/package/stdout-stream" rel="noopener ugc nofollow" target="_blank">节点</a>和<a class="ae ki" href="https://github.com/go-cmd/cmd" rel="noopener ugc nofollow" target="_blank"> golang </a>的相关模块似乎存在(应该评估这些模块是否具有适当的内存行为，即它们不会用自己的缓冲有效地覆盖最大外壳屏幕缓冲)。您还需要确保服务于端点的守护进程没有强加最大http响应大小。还可以考虑一个额外的端点或另一种方法来支持多个文件传输或gsutil rsync(上述方法中的通配符下载和解密在base64编码阶段会失败)。您还可以考虑在服务网格中创建<a class="ae ki" href="https://istio.io/latest/docs/tasks/traffic-management/egress/egress-gateway/#egress-gateway-for-https-traffic" rel="noopener ugc nofollow" target="_blank">外部服务条目</a>，比如<a class="ae ki" href="https://www.linkedin.com/feed/hashtag/istio" rel="noopener ugc nofollow" target="_blank"> #Istio </a> /Anthos SM(指向GCP负载平衡端点)。或者，您可以完全取代GCP负载平衡，<a class="ae ki" href="https://istio.io/latest/docs/setup/install/virtual-machine/" rel="noopener ugc nofollow" target="_blank">在虚拟机</a>上安装Istio，并利用# mTLS提高Istio负载平衡的安全性(在GCP LBs 上<a class="ae ki" href="https://cloud.google.com/load-balancing/docs/ssl-certificates#ssl-certificate-limits" rel="noopener ugc nofollow" target="_blank">不可用)。</a></p><p id="07d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">访问中间件的API密钥可以在GCP秘密管理器中存储和管理，对其的读取访问可以被<a class="ae ki" href="https://cloud.google.com/secret-manager/docs/access-control#conditions" rel="noopener ugc nofollow" target="_blank">锁定</a>到仅由1)要保护的API中间件管理的实例和2)允许访问中间件的GKE节点池使用的服务帐户。必须注意确保策略不允许模拟这些服务帐户，并且可以再次使用VPC服务控制。这里需要有一个平衡——这是通过使用CSP服务将对GCP的隐性信任重新提升到正常水平的唯一一点。但是真正的好处是通过服务帐户锁定对允许的GKE节点池的访问。坦率地说，同样值得注意的是，GCP秘密和关键管理人员的安全绝对关系到谷歌平台的可信度。或者，可以集成第三方秘密管理器，可能包括基于硬件的安全模块(HSM)。</p><p id="54cd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一个需要考虑的因素是，GKE机密节点目前不提供T/GPU硬件。这似乎不是什么大问题。并非所有的机器学习模型都从训练的硬件加速中受益匪浅(深度学习是一个主要的例外)。这意味着机密节点仍然适合于训练和服务多种类型的模型。</p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/1b9ea9e227f614fb11604ac5f9c8e7f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*25k75JBchGRFjmPK"/></div></div></figure><p id="2d88" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在不可避免地需要T/GPU的情况下，带有加速器的非机密可抢占节点池可以用于深度学习模型训练。这种未加密内存实例的使用并不妨碍交易，原因有很多——非机密节点对UDE收益的稀释可能是最小的、暂时的，并且具有有限的爆炸半径。首先，可抢占节点尽可能短暂(持续最长24小时，相比之下，点节点或正常节点持续更长时间)。您无法预先预测可抢占实例将在哪些GCP裸机上启动，并且它们会随着机器抢占而不断变化。这破坏了许多形式的攻击。为了增强这一功能，还可以按照随机的定期计划清空节点，然后直接删除它们的实例，让GKE MIG自动重新创建它们。其次，T/GPU非机密节点内存仍然受到上面概述的Linux内核内存保护的保护，在GKE节点上运行的容器优化操作系统超过了这一保护。第三，训练数据很少需要包含个人身份信息或其他机密信息。如有必要，还可以使用GCP的云数据丢失预防API (DLP)进行编辑，该API符合<a class="ae ki" href="https://cloud.google.com/dlp/docs/support/data-security#certifications" rel="noopener ugc nofollow" target="_blank">严格的监管和行业标准</a>、第三方产品或开源解决方案。第四，即使模型必须受益于T/GPU训练，非加速的高性能机密节点也可以提供服务。那些可以由机密节点提供服务的模型不受影响，因为它们仍然由加密的内存提供服务。</p><p id="69bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以上无疑可以改进。任何建议，意见和差距或错误的识别将不胜感激。</p><p id="79cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae ki" href="https://www.linkedin.com/pulse/achieving-confidential-risk-averse-aiml-advances-data-ramyar/" rel="noopener ugc nofollow" target="_blank"> <em class="jo">(本文原载LinkedIn) </em> </a></p><h1 id="d750" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">进一步阅读</h1><ul class=""><li id="ce0a" class="jp jq hi is b it li ix lj jb mf jf mg jj mh jn ju jv jw jx bi translated"><a class="ae ki" href="https://cpl.thalesgroup.com/blog/encryption/google-ubiquitous-data-encryption-ekm" rel="noopener ugc nofollow" target="_blank"> CipherTrust数据安全平台现在允许用户控制由谷歌云的机密计算处理的数据的加密密钥</a>，<a class="ae ki" href="https://www.linkedin.com/in/leonor-jones-b157891?miniProfileUrn=urn%3Ali%3Afs_miniProfile%3AACoAAABK7wEBCXrnK8mPTc1rSkzGfJCJ_XbW6pY" rel="noopener ugc nofollow" target="_blank"> Leonor Jones </a>，Thales，2021</li><li id="e0c5" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><a class="ae ki" href="https://cloud.google.com/blog/products/identity-security/ubiquitous-data-encryption-on-google-cloud" rel="noopener ugc nofollow" target="_blank">通过无处不在的数据加密更加信任谷歌云</a>，<a class="ae ki" href="https://www.linkedin.com/in/ilsung?miniProfileUrn=urn%3Ali%3Afs_miniProfile%3AACoAAABbc28Bdjmaedp_F0XLwcrC955vsRNI7RE" rel="noopener ugc nofollow" target="_blank">李一星</a>，<a class="ae ki" href="https://www.linkedin.com/in/anoosh-saboori-30619737?miniProfileUrn=urn%3Ali%3Afs_miniProfile%3AACoAAAeuBfYBAMrUiGEBs_BnS_5tzMQPCilO4Q4" rel="noopener ugc nofollow" target="_blank">阿诺什·萨博里</a>，谷歌云博客，2021年</li><li id="157a" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated"><a class="ae ki" href="https://cloud.google.com/compute/confidential-vm/docs/ubiquitous-data-encryption" rel="noopener ugc nofollow" target="_blank">使用分裂信任加密工具促进无处不在的数据加密</a>，谷歌云文档，2021年</li></ul><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/abdc5a4b85817dc26b470218fb66a97c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JJ6LXiRvDp-nTXcX"/></div></div></figure><p id="8d8b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">博士<a class="ae ki" href="https://www.linkedin.com/in/rramyar/" rel="noopener ugc nofollow" target="_blank">理查德·拉姆亚尔</a>，2022(商标和原始图像是其各自所有者的财产)</p><p id="8871" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">相关服务见<a class="ae ki" href="https://www.wipro.com/cloud?utm_source=RichardRamyarLinkedInBlog&amp;utm_campaign=RichardRamyarLinkedInBlog" rel="noopener ugc nofollow" target="_blank">https://www.wipro.com/cloud</a>和<a class="ae ki" href="https://www.wipro.com/cybersecurity?utm_source=RichardRamyarLinkedInBlog&amp;utm_campaign=RichardRamyarLinkedInBlog" rel="noopener ugc nofollow" target="_blank">https://www.wipro.com/cybersecurity</a></p><p id="92c0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">访问学者(荣誉)@ <a class="ae ki" href="https://www.libf.ac.uk/" rel="noopener ugc nofollow" target="_blank">伦敦银行和金融学院</a> / <a class="ae ki" href="https://risk.libf.ac.uk/" rel="noopener ugc nofollow" target="_blank"> LIBF治理、风险和监管中心</a> / <a class="ae ki" href="https://digital.libf.ac.uk/" rel="noopener ugc nofollow" target="_blank"> LIBF数字银行和金融中心</a></p><p id="0d62" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我的观点不一定代表任何雇主、客户或其他相关组织的观点</p></div></div>    
</body>
</html>