# 构建云运营模式和治理的框架—第一部分

> 原文：<https://medium.com/google-cloud/a-framework-to-build-cloud-operating-model-and-governance-part-i-7f87bf66b241?source=collection_archive---------1----------------------->

# TL；速度三角形定位法(dead reckoning)

云的基本承诺之一是为开发人员提供更大的灵活性来构建他们的产品和应用程序。开发人员有望对云环境中的资源供应有更多的控制权，并可以随意破坏它们。随着各种规模的企业带着这个目标向云迁移，他们面临的最大挑战之一是决定正确的治理和运营模式。是应该集权还是分权，还是现在这个争论已经无关紧要了？作为一名云客户和谷歌的客户工程师，我参与了许多关于这个话题的辩论。这个问题没有对错之分。

这篇文章的目标是为读者提供一个思想框架，其中包含一些可行的想法和方法，可以帮助构建一个云运营和治理模型，为开发人员提供更多的自由，并为治理团队提供正确的控制级别，以避免任何灾难。

这是一个很长的话题，可以说很多。所以我把这篇文章分成两部分。

所以，让我们开始吧…

# 一点历史(我在过去 19-20 年间观察到的)

术语治理在现代工作环境中几乎总是被认为是一个“不好”的词，并且经常被认为是“阻止你使用你想要的东西来构建你的产品和应用程序的控制”的同义词。在我看来，这不是一个真正的评估，而是有理由/曾经有理由以这种方式进行治理。以下是我看到的一些原因:

*   **简化的 IT 组合:**企业中的技术生命周期是一项漫长而艰巨的任务。不对其进行治理会带来许多挑战
*   **成本控制:**在本地环境中引入一项技术可能需要花费数十万到数百万美元的许可费用。为了成本效益，通常需要长期承诺。一旦引入，组织不希望使用竞争技术来进一步投资类似的功能。
*   **可支持性:**在大型组织中引入一项技术时，稳定性始终是首要考虑的因素。"当事情出错时，谁会在周日凌晨 3 点接到电话？"；当我在一家大型财富 50 强组织中负责介绍一项新技术时，我已经听过这个问题几百次了。这是一个 100%公平的问题。因此可支持性是一个关键需求，因此建立了许多集中的专家团队来为几个 IT 组件提供支持，开发人员依靠他们来对环境进行任何更改。
*   **整个体系的所有权:**当您拥有一个数据中心时，您要对整个体系负全责，从数据中心安全到服务器、平台、网络设备等等。您必须支持所有这些，这影响了组织在长时间的评估过程后谨慎地选择技术。这样的评估可能需要几个月的时间，开发者才有机会尝试。

许多这样的因素促使组织采用严厉的集中治理和操作模型框架，这不仅导致长的变更周期和“控制”，而且还迫使开发人员使用某些语言、运行时、数据库、平台等。在我过去的生活中，由于长时间的人工审查，我多次努力使一个简单的架构变更获得批准。

云的一些基本承诺是敏捷性、“随用随付”成本模型以及对开发人员的独立性/灵活性。因此，任何违背这些承诺的治理模式都不适用于云。此外，随着云的采用，组织不必在敏捷性/创新和治理(一致性、成本和安全性)之间做出选择，您可以同时拥有两者。

对于大规模采用云的组织来说，最大的问题是，云治理模型应该是集中式的还是分散式的？

让我们详细探讨一下这个问题，并尝试提出一个有助于回答这个问题的框架。

首先，让我们给出“治理”的基本定义(不管您是本地的还是云的)。

# 云蛋糕

我总是建议把云想象成一个分层的蛋糕，就像 OSI 模型一样。这块蛋糕的每一层都有不同的用途，有不同的复杂程度，需要不同的技能组合。所有这些层都与治理和运营模型粘合在一起。让我们深入这些层。

![](img/ae55db14ebfa4f65d0264ea115cd8e0c.png)

1.  云基础—这是由一些基础组件组成的层，这些组件使您的云环境能够正常工作。例如，混合连接、身份同步、VPC 结构、资源层级/组织结构、计费、组织策略、IAM 等。
2.  云服务——这些是像 Google Cloud 这样的 CSP 提供给客户的服务。比如说；Google 计算引擎、Google Kubernetes 引擎、云 SQL、云 Run 等。
3.  应用程序—这些是开发人员在云中使用一个或多个服务(第 2 层)创建的应用程序/产品。比如说；开发者可以在 GKE 之上创建一个用 Go 编写的 REST API。
4.  安全性(跨部门)—安全性跨越上面的所有层，但侧重点和角色不同。比如说；对于云基础服务，安全性更侧重于网络分段、网络安全、组织策略、防火墙规则等。而对于云服务层安全则更侧重于 IAM、Guardrails、SIEM、CSPM、审计日志、访问日志等。除此之外，安全部门还负责满足法规、合规性和审计要求。
5.  运营(跨部门)—与安全运营一样，跨多个层，但具有不同的角色和关注点。例如，对于云基础服务，运营可能更关注网络可观察性，而对于应用层运营，可能会更关注应用 SLA/SLO、应用日志记录、应用 Mon、性能优化等。对于云服务，大部分操作由云服务提供商负责。
6.  CCoE —组织中的一个机构，负责云的采用和成功、监督财务运营、构建参考架构等。

# 治理阶段

![](img/b24e73b00745c4fc517e8b940ab65a03.png)

从实施的角度来看，治理有 3 个阶段。这并不意味着在这些阶段中应用的治理规则是不同的，相反，在所有 3 个阶段之间保持一致性变得极其重要。例如，使用某些治理规则来构建产品的工程师不应该在运行时使用不同的护栏集而感到惊讶。

# 两个极端案例的故事

让我们举一个极端的例子，每个开发人员负责他们“应用程序/产品部分”的所有层。假设 Tim 是一名产品开发人员或产品所有者，在这种情况下，他将承担哪些责任。

![](img/0826e2f86f279aa465157e640b59baeb.png)

这只是一个例子，Tim 可能需要戴更多的帽子。年底即将到来，公司必须通过一项安全审计，因此现在 Tim 需要与审计员合作，了解法规，生成日志和报告，填补空白，然后结束审计，即使在此之后，Tim 也需要将此报告给领导层。这可能需要几周时间。同时，Tim 的产品需要适应业务需求的新功能。像这样的活动远远超出了产品开发。Tim 的重点应该放在产品功能上。

让我们从另一个极端来看另一个场景，其中一个或多个集中式团队负责所有层。例如，开发人员需要去这个集中的团队为他们创建/支持/维护一个 GCP 项目，启用服务，构建所需的基础设施(GCE，Cloud SQL，PubSub 等)。)，等等。如果不是不可能，这是非常难以衡量的。许多组织都有类似的运营模式来运行内部 IT(将云任务更改为内部任务)，但随着 DevOps 原则的采用，此模式。在许多场合，我已经看到这种模式在云中失败，我认为应该不惜一切代价避免这种模式。

答案几乎总是介于这两种极端模式之间。

# 要求

工程团队在着陆区需要什么来托管代码？

*   轻松做实验
*   能够在需要时部署代码/应用程序
*   能够在需要时在云中旋转资源
*   不必为经常做的事情等待批准
*   启用构建产品/应用程序所需的云服务(不需要额外批准)
*   观察环境和其中托管的代码的行为
*   满足最终消费者(人或代码)的 SLO/SLA
*   环境可扩展以适应潜在的未来增长

治理模型在着陆区需要什么？

*   默认安全性设置不允许意外操作
*   向开发人员、运营人员和客户授予适当级别的访问权限
*   预算的制定是为了避免意外成本。观察环境的代价
*   在云中部署和管理资产的强制一致性
*   识别并填充偏离预期状态的漂移(这超出了 Kubernetes 中所做的工作)
*   安全性在各种环境中得到一致实施
*   一致地配置资源，以管理与入职、漂移、可发现性和恢复相关的风险
*   能够了解云环境中部署了哪些资产，它们部署在哪里，何时发生变化
*   实施清晰的资产所有权。

# 交付云治理和运营模式的支柱

![](img/d1491e64858f9dded3d85df897fc5ada.png)

# 1.自动化(GitOps、工作流和自助服务)

自动化使我们能够实现一致性、可审核性、敏捷性和自助服务客户的能力。在过去的几年中，许多组织已经投入了大量的精力来采用 DevOps 进行应用程序开发，但是这些原则并没有应用到基础架构的构建中，并且它经常在产品交付渠道中制造障碍。GitOps 将许多 DevOps 原则提升到了一个新的水平，并将其应用到云资产和基础架构构建中。GitOps 的关键概念是使用 Git 存储库来存储环境的期望状态，并以声明方式部署/管理云资产。它使您能够通过使用代码来可预测地创建、更改和改进您的云基础架构。在 Git 存储库中将基础设施作为代码(IaC)意味着它是受版本控制的、可审计的、可扫描的，并且是开放协作的。在此基础上，使用可审计和可审查的构建和发布管道来构建基础设施。有很多工具可以支持 IaC，比如 Terraform(来自 HashiCorp)、Pulumi 等。Terraform 应用广泛，通常是我选择的 IaC。代理确保当前状态没有偏离期望状态，例如 Argo、Kubernetes 配置连接器等。

这里有一个很好的帖子，可以让你开始使用 Google Cloud 中的 Terraform 的 GitOps[https://Cloud . Google . com/architecture/managing-infra structure-as-code](https://cloud.google.com/architecture/managing-infrastructure-as-code)

GitOps 极大地支持了云治理，并使其更容易实现。正在经历 DevOps 采用之旅的组织可以轻松采用 GitOps 实践。

工作流可以将各种自动化结合在一起，还可以实现可观察性和过程遥测。自助服务是向目标受众提供自动化服务的一种方式。

# 2.开发商宣传

以客户为中心对每个企业的成功都至关重要，这方面的文章不计其数。当我们谈论业务/产品创新时，问的第一个问题是，“谁是你的客户，这种创新将如何帮助这些客户”。一个成功的商业和产品理念总是以客户为中心。云的采用必须以同样的方式进行。谁是云环境的客户？是团队在云环境中开发产品和应用程序；这些开发人员是您的云环境的客户。云治理和运营模式必须以工程师和开发人员为中心，并且应该围绕他们来构建。不这样做通常会导致缓慢的采用、摩擦、抱怨和更长的变革/创新周期。一个成功的运营和治理模式使开发者能够充分利用云平台的潜力，为他们的组织构建创新产品。

# 3.护栏

无形的安全和控制不再只是听起来很酷的词，而是现在的现实。许多云原生安全产品和流程并不妨碍开发人员，但仍然使用 guardrails 强制实现所需的安全级别。护栏有许多定义，但 IMO 护栏是在云环境中自动执行策略的方式，旨在防止配置失误。护栏(顾名思义)是为了让产品工程团队与治理规则保持一致而构建的，不会妨碍日常的构建/部署。当工程团队想要超越已建立的治理控制时，护栏应该防止环境中的任何漂移。

许多组织试图建立 100%完美的护栏，但在 IMO (SRE 原则)中，应该有一个实现 n-9 覆盖率的目标，其余的应该作为例外处理(如“错误预算”)。绝对需要对护栏进行持续监控和反馈，以分析有效性和差距。

# 第一部分结束

到目前为止，我们已经讨论了一些历史，以建立一些关于为什么创建遗留治理和运营模型以及它们如何帮助本地环境的背景。随着云的采用，需要一个新的思维过程，为此，我们建议将云视为一个分层的堆栈、治理阶段和 3 个支柱，在此基础上可以构建新的治理和运营模式。

在下一部分中，我们将尝试构建一个工作模型，许多组织已经采用或正在采用该模型来构建他们的云治理和运营模型。

## [**构建云运营模式和治理的框架—第二部分**](/google-cloud/a-framework-to-build-cloud-operating-model-and-governance-part-ii-f50e98e0cdaa)