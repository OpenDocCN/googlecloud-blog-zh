<html>
<head>
<title>Patch and Update Table — BigQuery Part-III</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">修补和更新表— BigQuery第三部分</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/patch-and-update-table-bigquery-part-iii-7f2547021926?source=collection_archive---------0-----------------------#2017-11-04">https://medium.com/google-cloud/patch-and-update-table-bigquery-part-iii-7f2547021926?source=collection_archive---------0-----------------------#2017-11-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="da05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">最初发表。</em></p><p id="cace" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi je translated"><span class="l jf jg jh bm ji jj jk jl jm di"> D </span> aemon博客:<a class="ae jn" href="https://sunnykrgupta.github.io/patch-and-update-table-bigquery-part-iii.html" rel="noopener ugc nofollow" target="_blank">https://sunnykrgupta . github . io/patch-and-update-table-big query-part-iii . html</a></p><p id="a9d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">系列其他帖子:</strong></p><ul class=""><li id="ca6e" class="jo jp hi ih b ii ij im in iq jq iu jr iy js jc jt ju jv jw bi translated"><a class="ae jn" rel="noopener" href="/google-cloud/export-load-job-with-mongodb-bigquery-part-i-64a00eb5266b">导出&amp;使用MongoDB加载作业— BigQuery Part-I |由Sunny Gupta | Google Cloud—Community | Medium</a></li><li id="f765" class="jo jp hi ih b ii jx im jy iq jz iu ka iy kb jc jt ju jv jw bi translated">【Redis流媒体— BigQuery Part-II |作者Sunny Gupta | Google Cloud—Community | Medium</li></ul></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><figure class="kk kl km kn fd ko er es paragraph-image"><div class="er es kj"><img src="../Images/137637c2cef70d1d7737dd34c3d92614.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/0*4dorQigbt7af0Fjm.png"/></div></figure><p id="56df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章是三篇文章系列的第三部分。在之前的帖子中，我们了解了BigQuery加载作业<a class="ae jn" href="https://sunnykrgupta.github.io/export-load-job-with-mongodb-bigquery-part-i.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">导出&amp;加载作业与MongoDB—big query Part-I</strong></a><strong class="ih hj"/>和<strong class="ih hj"> </strong>的基本原理。</p><p id="ead7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我们将学习修补和更新表模式。</p><h1 id="3153" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">更新/修补BigQuery中的表</h1><p id="298e" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">当您在表中准备好数据，并且突然需要在表中添加更多字段来进行分析时，表更新非常重要。</p><p id="c512" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，我们将添加一个字段，并在更新操作后查看表中的变化。</p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h2 id="9c94" class="lu ks hi bd kt lv lw lx kx ly lz ma lb iq mb mc lf iu md me lj iy mf mg ln mh bi translated">1.将字段添加到架构中</h2><p id="9fb7" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">我们将使用之前用于流式传输的相同表<code class="du mi mj mk ml b"><strong class="ih hj">StreamTable</strong></code>，并引入一个字段作为数据类型为<code class="du mi mj mk ml b"><strong class="ih hj">INTEGER</strong></code>的字段<code class="du mi mj mk ml b"><strong class="ih hj">UniqueSocialNumber</strong></code>。让我们将这些更改添加到<code class="du mi mj mk ml b"><strong class="ih hj">schema.py</strong></code>中，它将被我们在后面的步骤中编写的主程序使用。</p><pre class="kk kl km kn fd mm ml mn mo aw mp bi"><span id="042e" class="lu ks hi ml b fi mq mr l ms mt">$ cat schema.py</span><span id="e2b7" class="lu ks hi ml b fi mu mr l ms mt"><em class="jd">#Add field schema</em><br/>TableObject = {<br/>    "tableReference": {<br/>      "projectId": "mimetic-slate",<br/>      "tableId": "StreamTable",<br/>      "datasetId": "BQ_Dataset",<br/>    },</span><span id="5570" class="lu ks hi ml b fi mu mr l ms mt">    "schema": {<br/>      "fields": [<br/>          {<br/>              "name": "username",<br/>              "type": "STRING",<br/>              "mode": "NULLABLE"<br/>          },<br/>          {<br/>              "name": "name",<br/>              "type": "STRING",<br/>              "mode": "NULLABLE"<br/>          },<br/>          {<br/>              "name": "birthdate",<br/>              "type": "STRING",<br/>              "mode": "NULLABLE"<br/>          },<br/>          {<br/>              "name": "sex",<br/>              "type": "STRING",<br/>              "mode": "NULLABLE"<br/>          },<br/>          {<br/>              "name": "address",<br/>              "type": "STRING",<br/>              "mode": "NULLABLE"<br/>          },<br/>          {<br/>              "name": "mail",<br/>              "type": "STRING",<br/>              "mode": "NULLABLE"<br/>          },<br/>          {<br/>              "name": "UniqueSocialNumber",   <em class="jd">#New Field</em><br/>              "type": "INTEGER",<br/>              "mode": "NULLABLE"<br/>          }<br/>      ],<br/>  },<br/>}</span></pre></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h2 id="26a0" class="lu ks hi bd kt lv lw lx kx ly lz ma lb iq mb mc lf iu md me lj iy mf mg ln mh bi translated">2.BigQuery中的补丁/更新API</h2><p id="cedc" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">我们已经准备好了<code class="du mi mj mk ml b">schema.py</code>脚本，下面是我们的主程序<code class="du mi mj mk ml b"><strong class="ih hj">tablePatch.py</strong></code>，它将执行对bigquery的表补丁API调用。</p><p id="e6c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">BigQuery中有两种方法可以更新表。</p><ul class=""><li id="6f93" class="jo jp hi ih b ii ij im in iq jq iu jr iy js jc jt ju jv jw bi translated"><code class="du mi mj mk ml b"><strong class="ih hj">tables.patch</strong></code> -该方法仅替换资源中提供的字段</li><li id="c1b8" class="jo jp hi ih b ii jx im jy iq jz iu ka iy kb jc jt ju jv jw bi translated"><code class="du mi mj mk ml b"><strong class="ih hj">tables.update</strong></code> -这个方法替换整个表格资源。</li></ul><blockquote class="mv mw mx"><p id="540f" class="if ig jd ih b ii ij ik il im in io ip my ir is it mz iv iw ix na iz ja jb jc hb bi translated"><strong class="ih hj">补丁示例:</strong></p></blockquote><pre class="kk kl km kn fd mm ml mn mo aw mp bi"><span id="f019" class="lu ks hi ml b fi mq mr l ms mt">$ cat tablePatch.py</span><span id="cca4" class="lu ks hi ml b fi mu mr l ms mt"><em class="jd">#!/usr/bin/env python</em></span><span id="9fb8" class="lu ks hi ml b fi mu mr l ms mt"><em class="jd">#https://developers.google.com/api-client-library/python/</em><br/><strong class="ml hj">from</strong> <strong class="ml hj">googleapiclient</strong> <strong class="ml hj">import</strong> discovery<br/><strong class="ml hj">from</strong> <strong class="ml hj">oauth2client.client</strong> <strong class="ml hj">import</strong> GoogleCredentials<br/><strong class="ml hj">from</strong> <strong class="ml hj">schema</strong> <strong class="ml hj">import</strong> TableObject<br/></span><span id="4f3a" class="lu ks hi ml b fi mu mr l ms mt"><em class="jd"># [START Table Creater ]</em><br/><strong class="ml hj">def</strong> PatchTable(bigquery):<br/>    tables = bigquery.tables()</span><span id="e2b5" class="lu ks hi ml b fi mu mr l ms mt">    tableStatusObject =tables.patch(                         <br/>          projectId=TableObject['tableReference']['projectId'],\<br/>          datasetId=TableObject['tableReference']['datasetId'],\<br/>          tableId=TableObject['tableReference']['tableId'], \<br/>          body=TableObject).execute()<br/>    <strong class="ml hj">print</strong> "<strong class="ml hj">\n\n</strong>Table Patched"<br/><em class="jd"># [END]</em></span><span id="be2a" class="lu ks hi ml b fi mu mr l ms mt"><strong class="ml hj">def</strong> main():<br/>    <em class="jd">#to get credentials from my laptop</em><br/>    credentials = GoogleCredentials.get_application_default()<br/>    <em class="jd"># Construct the service object for interacting with the BigQuery API.</em><br/>    bigquery = discovery.build('bigquery', 'v2', credentials=credentials)<br/>    PatchTable(bigquery)</span><span id="7ce5" class="lu ks hi ml b fi mu mr l ms mt"><em class="jd">'''</em><br/><em class="jd">https://cloud.google.com/bigquery/docs/tables#update-schema</em><br/><em class="jd">'''</em></span><span id="340e" class="lu ks hi ml b fi mu mr l ms mt"><strong class="ml hj">if</strong> __name__ == '__main__':<br/>    main()<br/>    <strong class="ml hj">print</strong> "BQ Table Patch !!"</span></pre><blockquote class="mv mw mx"><p id="5a26" class="if ig jd ih b ii ij ik il im in io ip my ir is it mz iv iw ix na iz ja jb jc hb bi translated">更新示例:</p></blockquote><pre class="kk kl km kn fd mm ml mn mo aw mp bi"><span id="056d" class="lu ks hi ml b fi mq mr l ms mt">#instead of calling patch(), we call update() to apply updates<br/>tableStatusObject =tables.update(                         <br/>          projectId=TableObject['tableReference']['projectId'],\<br/>          datasetId=TableObject['tableReference']['datasetId'],\<br/>          tableId=TableObject['tableReference']['tableId'], \<br/>          body=TableObject).execute()</span></pre><p id="fdcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应用更改后，我们可以验证bigquery表模式中的更改。</p><p id="2c7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">访问界面:<a class="ae jn" href="https://bigquery.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">https://bigquery.cloud.google.com</a></p><p id="7eec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您还可以通过运行<code class="du mi mj mk ml b"><strong class="ih hj">bq</strong></code> CLI命令来验证表模式</p><pre class="kk kl km kn fd mm ml mn mo aw mp bi"><span id="3272" class="lu ks hi ml b fi mq mr l ms mt">$ bq show BQ_Dataset.StreamTable<br/>Table mimetic-slate:BQ_Dataset.StreamTable</span><span id="5b44" class="lu ks hi ml b fi mu mr l ms mt">   Last modified                Schema               Total Rows   Total Bytes   Expiration   Time Partitioning   Labels  <br/> ----------------- -------------------------------- ------------ ------------- ------------ ------------------- --------<br/>  04 Nov 15:48:43   |-username: string              451          50837                                                  <br/>                    |-name:string                                                                                      <br/>                    |-birthdate:string                                                                                 <br/>                    |-sex:string                                                                                       <br/>                    |-address:string                                                                                   <br/>                    |-mail:string                                                                                      <br/>                    |-UniqueSocialNumber: integer</span></pre><p id="b092" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考</strong>:</p><ul class=""><li id="1edd" class="jo jp hi ih b ii ij im in iq jq iu jr iy js jc jt ju jv jw bi translated"><strong class="ih hj">表补丁和更新:</strong><a class="ae jn" href="https://developers.google.com/resources/api-libraries/documentation/bigquery/v2/python/latest/bigquery_v2.tables.html" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/resources/API-libraries/documentation/big query/v2/python/latest/big query _ v2 . tables . html</a></li></ul></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h2 id="53ca" class="lu ks hi bd kt lv lw lx kx ly lz ma lb iq mb mc lf iu md me lj iy mf mg ln mh bi translated">3.预览bigquery表中的数据</h2><p id="d103" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">单击表格预览查看新字段。它将显示<code class="du mi mj mk ml b"><strong class="ih hj">null</strong></code>与旧记录。您可以开始流式传输包含这个新添加的字段的数据，并将其写入表中。</p><p id="5c75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">表格预览</strong></p><figure class="kk kl km kn fd ko er es paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="er es nb"><img src="../Images/446adc723046997e112791c3cb683697.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hxQMjePUvTMIB8Dw.png"/></div></div></figure></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="fcb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Github参考</strong>:<a class="ae jn" href="https://github.com/sunnykrGupta/Bigquery-series" rel="noopener ugc nofollow" target="_blank">https://github.com/sunnykrGupta/Bigquery-series</a></p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><h1 id="cfff" class="kr ks hi bd kt ku ng kw kx ky nh la lb lc ni le lf lg nj li lj lk nk lm ln lo bi translated">结论</h1><p id="bcec" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">这是对BigQuery表更新的介绍，我们的3篇文章系列到此结束。</p><p id="4e03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个系列中，我们介绍了Google BigQuery无服务器产品的基本特性。在其他云上还有其他类似的产品，如AWS redshift、Azure SQL Data Warehouse，它们为BigQuery等无限计算资源提供服务。</p><p id="638a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请评论您对该系列的想法/反馈。</p></div></div>    
</body>
</html>