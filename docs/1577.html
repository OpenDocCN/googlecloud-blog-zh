<html>
<head>
<title>Creating SLOs with Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Terraform创建SLO</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/some-time-ago-i-looked-at-using-the-service-monitoring-api-to-create-basic-slos-against-out-of-b3555b08036f?source=collection_archive---------0-----------------------#2020-08-31">https://medium.com/google-cloud/some-time-ago-i-looked-at-using-the-service-monitoring-api-to-create-basic-slos-against-out-of-b3555b08036f?source=collection_archive---------0-----------------------#2020-08-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2068" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前一段时间，我<a class="ae jd" rel="noopener" href="/google-cloud/slos-with-stackdriver-service-monitoring-62f193147b3f?source=---------6------------------">看了看</a>使用服务监控API创建基本的SLO来对抗“开箱即用”的服务，比如App Engine。从那时起，这个功能已经有了很多更新，现在有了对创建定制<a class="ae jd" href="https://www.terraform.io/docs/providers/google/r/monitoring_service.html" rel="noopener ugc nofollow" target="_blank">服务</a>和<a class="ae jd" href="https://www.terraform.io/docs/providers/google/r/monitoring_slo.html" rel="noopener ugc nofollow" target="_blank"> SLOs </a>的Terraform支持。我想亲自尝试一下，看看它是如何工作的。</p><h1 id="6681" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">创建服务</h1><p id="3a7b" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">如果您使用Istio、App Engine或云端点等工具，SLO监控可以很好地为您识别服务。但是如果你的服务是在GCE上呢？在这种情况下，您需要将其定义为定制服务，这将允许您针对它定义SLO。</p><p id="eb45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是如何在Terraform中定义一个“<a class="ae jd" href="https://www.terraform.io/docs/providers/google/r/monitoring_service.html" rel="noopener ugc nofollow" target="_blank">监控服务</a>”:</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="ed54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">服务定义实际上非常简单——您只需提供一个项目特有的服务ID和一个显示名称。运行“terraform apply”后，服务便会出现在控制台中:</p><p id="f8e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从那里，您可以使用UI来创建一个SLO:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es ko"><img src="../Images/fd1effb5dc6c4d540fb53a482622e15b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DQ6DspOdYYKUFSWW"/></div></div></figure><p id="9980" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">请注意</strong>您必须使用“其他”作为衡量标准—定制服务对可用性和延迟没有“现成的”理解。所以，你需要有一个好的SLI为你服务。您可以使用基于日志的指标，如果您正在使用Google Cloud负载平衡器，可以使用它发出的指标，或者由服务编写的自定义指标。让我们来看看如何使用后者定义SLO。</p><h1 id="3e96" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">定义SLO</h1><p id="3e64" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">以下是使用Terraform定义SLO的方法:</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="d912" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里需要考虑3个主要因素:</p><ul class=""><li id="6c0e" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated"><strong class="ih hj">基础知识</strong> —资源ID、SLO ID、用于定义SLO的服务以及SLO显示名称。</li><li id="db4f" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">SLI<strong class="ih hj"/>——您将使用基于请求的还是基于windows的SLI？如果是基于请求的—您将如何计算总请求数并区分好的和坏的请求？</li></ul><p id="f8a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的例子中，我使用了一个服务，该服务可以发出两个独立的指标——一个统计所有请求，另一个统计错误。这使得事情变得非常简单。</p><ul class=""><li id="0ab3" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated"><strong class="ih hj">目标</strong>——你的SLO的实际目标是什么？</li></ul><p id="d189" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本例中，我们的目标是在一天内99%的请求成功。</p><h1 id="0458" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">创建和验证</h1><p id="9007" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">此时，运行<code class="du lj lk ll lm b">terraform plan</code>以确保一切正常:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es ln"><img src="../Images/77d4a112b46649e03e222ee204919ee5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CZpOo-vPEtZGgCu3JZqGyw.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">“地形图”的输出</figcaption></figure><p id="01d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果一切正常，运行<code class="du lj lk ll lm b">terraform apply</code>来创建服务和SLO:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es ln"><img src="../Images/e76424ec10dac77a48906a6f900ee2b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5uylMFw4-V93uKCqxYIQ_g.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">“地形应用”的输出</figcaption></figure><p id="3caf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意</strong>我的文件有两个SLO——一个是基于请求的可用性SLO，另一个是基于windows的延迟SLO。这就是创建3个资源的原因。</p><p id="2b9e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此时，您可以返回控制台并检查您的新服务:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es ko"><img src="../Images/dee42b0d936819cd3a9de187c0d2c4eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*91GRnOYpPlT-_1qJ"/></div></div></figure><p id="2fb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我显然没有正确设置我的可用性目标(或者我的服务有一些严重的问题)——在我采取下一步措施设置错误预算燃烧警报之前，我绝对应该重新考虑这个问题。</p><h1 id="3b26" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">摘要</h1><p id="b5a9" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我真的很高兴看到服务和SLO支持来到Terraform，我希望许多人将利用这一点来扩展他们的自动化能力。此时，一旦项目启动，所有主要的监控原语都可以自动创建——这是个好消息！感谢阅读，并让我知道你的想法！</p></div></div>    
</body>
</html>