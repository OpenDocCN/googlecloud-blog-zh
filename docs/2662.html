<html>
<head>
<title>Implementing scalable microservices for the consumer goods delivery industry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为消费品交付行业实施可扩展的微服务</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/implementing-scalable-microservices-for-the-consumer-goods-delivery-industry-c675e3654114?source=collection_archive---------9-----------------------#2022-12-21">https://medium.com/google-cloud/implementing-scalable-microservices-for-the-consumer-goods-delivery-industry-c675e3654114?source=collection_archive---------9-----------------------#2022-12-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ff8fb7f5ffea28858108cc774c800296.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AQSiUGxkfqg7CjPiM-0VGQ.jpeg"/></div></div></figure><p id="0995" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对杂货、蔬菜、文具等消费品进行最后一英里配送的公司面临的一个共同挑战是根据不可预测的需求进行扩展的能力。由于向消费者交付的速度是该行业的一个关键基准，因此扩大和扩大必须在没有任何延迟的情况下进行。</p><p id="00cc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">谷歌云平台(GCP)提供了构建、部署和运行可扩展微服务的有效方法来应对这一挑战。最后一英里配送公司是来自多个行业(如食品杂货、文具、医疗等)的各种生产商的消费者。架构的一个方法是让每个业务单元(生产者)在他们自己的GCP项目中照顾他们各自的领域过程。中央GCP项目将运行应用(计算)集群，并通过监控业务部门使用的每个GCP项目的指标来执行扩展。下面的图1展示了该架构。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jo"><img src="../Images/e9c3c62ba10d43ac8debddac89375cf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CWDEn1gHUZc51nxG"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated"><em class="jx">图1:利用来自Pubsub </em>的外部指标构建可扩展微服务(pod)的架构图</figcaption></figure><p id="0acf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">配置一个GCP项目来部署GKE集群，然后部署指标适配器，让GKE集群通过云监控发送和接收指标。(提示:请参考这个:<a class="ae jy" href="https://cloud.google.com/kubernetes-engine/docs/tutorials/autoscaling-metrics#step1" rel="noopener ugc nofollow" target="_blank"><em class="jz">https://cloud . Google . com/kubernetes-engine/docs/tutorials/auto scaling-metrics # step 1</em></a>)使这个GCP项目成为<em class="jz"> Monitoring (Scoping) </em>项目，以监控GCP项目中与其他业务部门相关的指标。被界定范围的单个GCP项目通常被称为<em class="jz">监控</em>项目。这可以使用监控(范围界定)项目的监控工作区的指标范围功能来执行，如下面的示例屏幕截图(图2)所示:(提示:使用“添加GCP项目”选项来添加被监控的项目)</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jo"><img src="../Images/2a739dfc48d9f52ffebcf203a2b7ec5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*52eZ3AW6bWS2TmMd"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated"><em class="jx">图2:将多个受监控项目划分为一个监控项目的示例截图</em></figcaption></figure><p id="d376" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">确保在相应的GCP项目(在监视项目和被监视项目中)中创建了(或已经存在)相关的发布订阅和主题。</p><p id="febf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">(<em class="jz">提示:以下示例命令可用于创建pubsub主题和订阅。</em></p><ul class=""><li id="c8fb" class="ka kb hi is b it iu ix iy jb kc jf kd jj ke jn kf kg kh ki bi translated"><em class="jz"> gcloud发布主题描述echo-projectD </em></li><li id="8bff" class="ka kb hi is b it kj ix kk jb kl jf km jj kn jn kf kg kh ki bi translated"><em class="jz"> gcloud pubsub订阅创建echo-read-projectD—topic = echo-projectD—topic-project = point-of-views-11282022)</em></li></ul><p id="a673" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在GCP监控项目的GKE集群中部署微服务(pod)。该应用程序必须使用一个具有“<em class="jz">发布订阅者</em>角色的<em class="jz">服务帐户</em>。下面的屏幕截图显示了一个示例应用程序，它轮询pubsub主题及其清单文件。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/6ae0a554b58af831fc5f5ae2ab4d704d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_0eRSlnQ7WLFfrnD"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated"><em class="jx">图3:可以部署的Python应用程序</em>的样本代码(用于测试)</figcaption></figure><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/0e05a1bd43be3681316d8e778da9a902.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*D0pjEiCtMOXdlIW2"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated"><em class="jx">图4:图3所示示例应用程序的清单文件</em></figcaption></figure><p id="bfc6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">配置水平Pod自动缩放器(HPA)以查找pubsub指标。例如，配置一个HPA来监听来自资源类型<em class="jz"> pubsub_subscription的<em class="jz">pubsub.googleapis.com/subscription/num_undelivered_messages</em>度量。</em>在下面图5的示例截图中，HPA正在寻找特定的订阅id。(这可以推断为包括额外的标签，以便根据需要进一步过滤。)</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jo"><img src="../Images/64b0a75ea4327a4c94f97b7c64d396d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*90dk-h0UO0HRt_1F"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated"><em class="jx">图4:监听pubsub指标的示例HPA的清单文件</em></figcaption></figure><p id="d75c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">应用清单并描述HPA以查看初始状态。<em class="jz">目标</em>字段显示实际值与期望值的对比。下面的图5显示了一个相同的示例截图</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jo"><img src="../Images/d7b55437677154136b617dcf0cfbd265.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LdCx6cN0zLf_FPhL"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated"><em class="jx">图5:显示缩放初始状态的HPA描述</em></figcaption></figure><p id="9391" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">设置现在已经完成。当消息被发布到与HPA监控的订阅相关联的pubsub主题时(在上面的示例中)，在GKE集群中运行的pod将开始水平扩展。为了测试设置，您可能需要在pubsub上生成负载，方法是从每个受监控项目(由单个业务单位处理)以及在监控项目中向pubsub主题发布一系列消息。可以观察到，HPA监听这些外部度量，并通过启动水平pod自动缩放来做出反应。观察HPA的当前状态。图6显示了一个演示向外扩展的示例屏幕截图。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jo"><img src="../Images/362577caccb504d272ae55848d4c87aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pTBh3Dafr63bjoI4"/></div></div></figure><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jo"><img src="../Images/e14674f4c4e78a10d6a8d7aa9601ed0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pmV1nxUGy3Iwkpvi"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated"><em class="jx">图6:显示当前缩放状态的HPA描述</em></figcaption></figure><p id="f33c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从业务角度来看，在监控项目的GKE集群中运行的最后一英里消费品交付应用可以根据从其他业务部门(杂货业务部门、文具业务部门、医疗业务部门等)接收的(外部)指标进行无缝扩展。)，提供自动化、速度和运营效率。</p><p id="dbc9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有关更多详细信息，您可以参考Google的以下文档:</p><p id="7448" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">[1]查看多个项目的指标—<a class="ae jy" href="https://cloud.google.com/monitoring/settings" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/monitoring/settings</a></p><p id="87ec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">[2]基于指标优化Pod自动缩放—<a class="ae jy" href="https://cloud.google.com/kubernetes-engine/docs/tutorials/autoscaling-metrics#pubsub_1" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/kubernetes-engine/docs/tutorials/auto scaling-metrics # pubsub _ 1</a></p></div></div>    
</body>
</html>