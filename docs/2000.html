<html>
<head>
<title>Everything You Always Wanted to Know About VPC Peering* (*But Were Afraid to Ask)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你一直想知道的关于VPC对等的一切*(但不敢问)</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/everything-you-always-wanted-to-know-about-vpc-peering-but-were-afraid-to-ask-2b26267ba7d9?source=collection_archive---------0-----------------------#2021-11-04">https://medium.com/google-cloud/everything-you-always-wanted-to-know-about-vpc-peering-but-were-afraid-to-ask-2b26267ba7d9?source=collection_archive---------0-----------------------#2021-11-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="78ad" class="ig ih hi bd ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd bi translated">TL:DR</h1><p id="05f2" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">这篇文章概述了<a class="ae kc" href="https://cloud.google.com/vpc/docs/vpc-peering" rel="noopener ugc nofollow" target="_blank"> Google Cloud VPC网络peering</a>，它们的剖析、主要误解和一些观察点，以便用户可以学习如何在设计基础设施时明智地使用它们。</p><h1 id="e5e2" class="ig ih hi bd ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd bi translated">语境</h1><p id="48c5" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated"><a class="ae kc" href="https://cloud.google.com/vpc/docs/vpc-peering" rel="noopener ugc nofollow" target="_blank">虚拟私有云(VPC)对等</a>允许连接多个<a class="ae kc" href="https://cloud.google.com/vpc/docs/vpc" rel="noopener ugc nofollow" target="_blank"> VPC网络</a>高速、低延迟且无额外成本。</p><p id="97af" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">鉴于它们的强大功能和易于管理，用户通常决定采用它们作为连接GCP网络的标准机制。</p><p id="a6ba" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">在与许多客户打交道的过程中，我总是注意到许多关于VPC皮灵的概念经常被误解，并可能成为混淆的根源。不幸的是，这转化为糟糕的设计决策，当项目已经开始时，需要经常修正这些决策。</p><p id="9bc0" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">本文的目标是澄清这些误解，希望能帮助用户更明智、更有意识地设计他们的网络。</p><p id="173b" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">让我们一起来探索VPC皮林的一些特点。</p><h1 id="08ba" class="ig ih hi bd ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd bi translated">管理域</h1><p id="5bde" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">当用户在图中看到用单线表示的VPC peering时，他们经常会感到困惑，忽略了他们的管理跨不同的管理域的事实。</p><p id="ca35" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">为了建立VPC对等网络，每个VPC管理员需要明确授权他们的网络连接到另一个。无论管理员是相同的还是不同的，在VPC对等出现之前，需要在GCP进行两种不同的配置。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ki"><img src="../Images/4cbe6512ba8a713eba9ab249c6a13899.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*00j0Tx1bg7OsThtxhaalHQ.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">在本例中，VPCs托管了两个不同的项目，由两个不同的管理员拥有。在形成对等之前，它们都需要创建到另一个VPC的对等。</figcaption></figure><p id="248c" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">在GCP，如果管理员只授权从一个网络到另一个网络的对等，就会出现这种情况:</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ky"><img src="../Images/f826e8857ba902e54ae79d6417e2bca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9h-C6Pdpf50vWGV20B8J7A.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">对等仍然是不活动的，因为只有一个管理域授权了对等。</figcaption></figure><p id="ea0f" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">虽然这是健康对等的表现，但是一旦两个网络都授权了通信。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es kz"><img src="../Images/e58daa02717aad7a173b28d40dd350d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tDhrGKsYSJp7VKTUc13JZw.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">对等都是“活动的”，因为两个管理员都授权了VPC对等。</figcaption></figure><h1 id="f5e8" class="ig ih hi bd ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd bi translated">Peerings是不可传递的</h1><p id="8a0f" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">让我们再举一个例子:假设我们有三个VPCs、B和C。</p><p id="01d5" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">虽然VPCs直接对等中的主机可以通信，但对于连接到A和c的主机来说，情况并非如此。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es la"><img src="../Images/5d84f098961539f2ab2fe66f825eb82f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wf5lqQCQT_226_e0Sxf_tQ.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">三个VPC是对等的。机器A可以与B通信，B可以与C通信。无论如何，如果A和C之间没有额外的VPC对等点，A就不能与C通信</figcaption></figure><p id="aed8" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">我们经常看到这样的用例:</p><ul class=""><li id="8980" class="lb lc hi jg b jh kd jl ke jp ld jt le jx lf kb lg lh li lj bi translated"><em class="lk">轴辐式拓扑</em>:不可能让不同的辐条通过集线器通信，除非在辐条之间创建VPC对等点(或者集线器中的网络设备协调辐条之间的通信)</li><li id="2e44" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated"><em class="lk">Google托管服务:</em>许多Google托管服务利用peerings将Google托管VPC(托管服务运行的地方)连接到用户的VPC。需要例子？GKE私有集群、云SQL、NetApp CVS卷是众多卷中最受欢迎的。如果用户VPC也与其他VPC对等，需要从哪些主机访问托管服务呢？</li></ul><p id="8a74" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">“好吧，有什么问题吗？再多加几个peerings吧！”…不尽然！</p><p id="bbae" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">以下是一些重要的注意事项:</p><ul class=""><li id="f503" class="lb lc hi jg b jh kd jl ke jp ld jt le jx lf kb lg lh li lj bi translated">用户不能配置谷歌管理的虚拟专用计算机，所以你<em class="lk">不能</em>创建——例如——额外的peerings到其他虚拟专用计算机。</li><li id="fc56" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated">最重要的是，<strong class="jg hj">VPC喷丸数量有限</strong>！我们将在接下来的段落中详细讨论这一点。</li></ul><p id="89a7" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">重要的是要明白，随着限制而来的还有选择，这可以帮助我们避免或绕开可能的问题。这些是我经常提议的:</p><ul class=""><li id="6b60" class="lb lc hi jg b jh kd jl ke jp ld jt le jx lf kb lg lh li lj bi translated">尽量减少VPC的数量(VPC贵族也是如此！).</li><li id="d4cf" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated">评估VPC之间使用<a class="ae kc" href="https://cloud.google.com/network-connectivity/docs/vpn/how-to/creating-ha-vpn2" rel="noopener ugc nofollow" target="_blank">托管HA VPNs的对等替换。</a></li><li id="484f" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated">添加网络设备或<a class="ae kc" rel="noopener" href="/google-cloud/accessing-gke-private-clusters-through-iap-14fedad694f8">代理</a>，以便中断并重新启动连接，这样我们就可以一次跳过多个peerings。</li><li id="2cb9" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated">考虑将<a class="ae kc" href="https://cloud.google.com/vpc/docs/private-service-connect" rel="noopener ugc nofollow" target="_blank">私有服务连接(PSC) </a>用于内部负载平衡器(ilb)，以便<a class="ae kc" href="https://cloud.google.com/vpc/docs/configure-private-service-connect-producer" rel="noopener ugc nofollow" target="_blank">为您的服务</a>发布私有端点，这些端点可以<a class="ae kc" href="https://cloud.google.com/vpc/docs/configure-private-service-connect-services" rel="noopener ugc nofollow" target="_blank">从其他VPC</a>使用，而不需要任何额外的VPC网络对等。</li></ul><p id="16c2" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">这里真的没有好与坏的答案。运用你的良好判断力来构建符合你需求的解决方案。</p><h1 id="be69" class="ig ih hi bd ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd bi translated">不是所有的东西都要经过剥皮</h1><p id="4633" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">值得注意的是，并不是所有的信息都包含在peerings中。其中，最相关的是:</p><ul class=""><li id="3301" class="lb lc hi jg b jh kd jl ke jp ld jt le jx lf kb lg lh li lj bi translated"><a class="ae kc" href="https://cloud.google.com/compute/docs/internal-dns" rel="noopener ugc nofollow" target="_blank"> <em class="lk"> GCE内部DNS名称</em> </a>，不能被对等VPC引用。</li><li id="fd4d" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated"><a class="ae kc" href="https://cloud.google.com/vpc/docs/firewalls" rel="noopener ugc nofollow" target="_blank"> <em class="lk">防火墙标签和服务帐户</em> </a>，不能从另一个对等VPC中创建的防火墙规则中引用。</li><li id="b100" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated"><a class="ae kc" href="https://cloud.google.com/dns/?utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=emea-it-all-en-dr-skws-all-all-trial-e-gcp-1010042&amp;utm_content=text-ad-none-any-DEV_c-CRE_167391992105-ADGP_Hybrid%20%7C%20SKWS%20-%20EXA%20%7C%20Txt%20~%20Networking%20~%20Cloud%20DNS%23v1-KWID_43700067133808111-kwd-19757490240-userloc_1008736&amp;utm_term=KW_cloud%20dns-NET_g-PLAC_&amp;gclid=CjwKCAjwiY6MBhBqEiwARFSCPr_iy5lW0KD-fYAFQeJyv6DRKE120_2kJOfK-GEd8j8JLaxP2gypvxoC3FIQAvD_BwE&amp;gclsrc=aw.ds" rel="noopener ugc nofollow" target="_blank">云DNS </a>区域和记录:云DNS中定义的记录解析不是通过peerings，而是通过Google API调用。要允许跨VPC云DNS主机名解析，请使用<a class="ae kc" href="https://cloud.google.com/dns/docs/overview#dns-peering" rel="noopener ugc nofollow" target="_blank"> DNS对等</a>来代替。</li><li id="6f6a" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated">下一跳是默认Internet网关的路由。</li><li id="5964" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated">使用网络标签自定义静态路由。</li><li id="e35e" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated">防火墙规则从不通过对等交换。</li><li id="3cc6" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated">一个VPC网络中的入口防火墙无法通过来自另一个VPC网络的源标记或源服务帐户来识别源</li><li id="e6d0" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated"><a class="ae kc" href="https://cloud.google.com/vpc/docs/private-service-connect" rel="noopener ugc nofollow" target="_blank">私有服务连接(PSC)端点</a>，不能被其他对等VPC使用(…这有意义吗？)</li></ul><h1 id="dfb3" class="ig ih hi bd ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd bi translated">导入和导出路线</h1><p id="a3de" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">对等VPC总是自动交换它们的私有IP地址子网路由。</p><p id="0edc" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">此外，您可以配置对等VPC来交换其他路由:</p><ul class=""><li id="7680" class="lb lc hi jg b jh kd jl ke jp ld jt le jx lf kb lg lh li lj bi translated">交换与包含<a class="ae kc" href="https://cloud.google.com/vpc/docs/vpc-peering#importing-exporting-routes" rel="noopener ugc nofollow" target="_blank">私用公共IP</a>的子网相关的路由。</li><li id="f55b" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated">交换自定义路由，例如自定义静态路由，或通过BGP从云VPN或云互连获知的自定义动态路由。</li></ul><p id="63f5" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">在这两种情况下，对等配置都提供了专用选项，允许从另一个VPC导出和/或导入路由。</p><p id="789c" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">以下是取自GCP控制台的一个示例:</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lq"><img src="../Images/f5ab148e07c8859e47d7d24a7dca8baa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OxekadwsmD-ywbdVuLaakg.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">对于这两个网络，peerings已被设置为导入和导出，它们的自定义路由和子网都包括PUPI地址。</figcaption></figure><p id="1fde" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">根据用户的需求，配置可能会有所不同。至少，一个VPC对等体需要允许路由的导出，而另一个对等体需要授权它们的导入。</p><p id="e655" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">让我们看一个与动态路由相关的图形示例:</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lr"><img src="../Images/8e1b9f984dc791162bebd9f99757b57d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ODIBVw2xM8R1VODqpczSA.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">通过对等设置，动态(自定义)路由从VPC A导出到VPC B，并从VPC B导入到VPC A</figcaption></figure><p id="4448" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">VPC A的管理员希望与VPC B共享从云VPN(通过云路由器)获取的自定义(动态)路由。为此，VPA A的管理员导出自定义路由，编辑其对等关系(从A到B)。为了完成这个过程，VPC B的管理员导入自定义路由(从B到A)。</p><h1 id="4d5e" class="ig ih hi bd ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd bi translated">对等组限制和可扩展性</h1><p id="a3cc" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">这是最常见的误解，但是在介绍了基本的VPC对等概念之后，不得不提出来。</p><p id="011f" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">让我们开始熟悉一个新术语:一个<strong class="jg hj"> P <em class="lk">工程组</em> (PG)是一组通过<em class="lk">直接</em> VPC对等连接的VPC网络。</strong></p><p id="c690" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">值得注意的是</p><ul class=""><li id="e791" class="lb lc hi jg b jh kd jl ke jp ld jt le jx lf kb lg lh li lj bi translated">这个概念(以及相关的元素基数)对于每个VPC 是特定的<em class="lk">:换句话说，每个VPC为每个对等组限制计算自己的使用量。</em></li><li id="736e" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated">我们谈论的是<em class="lk">直接</em>剥皮。鉴于peerings是不可传递的，我们考虑的是与VPC直接相连的网络。</li></ul><p id="d4f0" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">让我们看一个例子:</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ls"><img src="../Images/26c12602111e85c68013aa12288c04e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lKJk9TSoB16VwidUzI-jDw.png"/></div></div></figure><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lt"><img src="../Images/bec788ac238ee3ce2c6cfa5b737d6ffc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fctEcxiW5yK8qJU5wksAEQ.png"/></div></div><figcaption class="ku kv et er es kw kx bd b be z dx translated">同一组互连VPC的不同对等组及其基数。</figcaption></figure><p id="14d4" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">该图显示了通过VPC皮林连接的不同VPC。对于每个VPC，我们看到一个特定的对等组，用不同的颜色表示，以及一个关联的基数。</p><p id="d96e" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">上图中有<em class="lk"> 5个VPC</em>，所以<em class="lk"> 5个对等组</em>。</p><p id="b8ed" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">那么，为什么对等组对我们如此重要？</p><p id="942f" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">因为<a class="ae kc" href="https://cloud.google.com/vpc/docs/quota#vpc-peering" rel="noopener ugc nofollow" target="_blank"> <strong class="jg hj">一个对等组内不同GCP元素的数量是有限的</strong> </a> <strong class="jg hj">。</strong></p><p id="181b" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">这包括:</p><ul class=""><li id="fbde" class="lb lc hi jg b jh kd jl ke jp ld jt le jx lf kb lg lh li lj bi translated">VPC·皮灵斯(在写这篇文章的时候，已经25岁了)</li><li id="6882" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated">GCE实例</li><li id="1356" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated">子网和别名范围</li><li id="ce09" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated">ILBs转发规则</li><li id="68cf" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated">静态和动态路由</li></ul><p id="5a2b" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">用于计算这些限制的算法在<a class="ae kc" href="https://cloud.google.com/vpc/docs/quota#vpc-peering-effective-limit" rel="noopener ugc nofollow" target="_blank">官方谷歌云文档</a>中公开。</p><p id="f4be" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">虽然这些数字中有许多看起来很高，但如果网络设计不当，VPC peering使用不当，它们很快就会受到攻击。</p><p id="7bd0" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated"><a class="ae kc" href="https://cloud.google.com/vpc/docs/quota#vpc-peering" rel="noopener ugc nofollow" target="_blank">这些是软限制，可以通过向谷歌销售和云支持</a>请求<strong class="jg hj">例外</strong>增加。重要的是要记住，增长是<em class="lk">而不是</em> <em class="lk">保证</em>的，而且通常情况下，一个数字的增长可能会导致其他数字的下降，因为这些对象在底层的Google SDN基础设施中是如何映射在一起的。</p><h1 id="312f" class="ig ih hi bd ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd bi translated">结束语</h1><p id="2e75" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">VPC peering是非常有用和强大的，但用户应该明智地使用它们，以避免奇怪的惊喜。设计基础设施时:</p><ul class=""><li id="792c" class="lb lc hi jg b jh kd jl ke jp ld jt le jx lf kb lg lh li lj bi translated">尝试<strong class="jg hj">最小化VPC喷丸次数</strong></li><li id="5b17" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated"><strong class="jg hj">预见你未来的需求</strong>。您需要连接到托管服务吗？你需要允许你的辐条之间直接沟通吗？削皮不一定是你的正确解决方案。使用<a class="ae kc" href="https://cloud.google.com/vpc/docs/private-service-connect" rel="noopener ugc nofollow" target="_blank"> PSC </a>、<a class="ae kc" rel="noopener" href="/google-cloud/accessing-gke-private-clusters-through-iap-14fedad694f8">代理</a>或<a class="ae kc" href="https://cloud.google.com/network-connectivity/docs/vpn/how-to/creating-ha-vpn2" rel="noopener ugc nofollow" target="_blank">托管VPN</a>进行评估。</li><li id="b9f7" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated"><strong class="jg hj">关注您的需求和机制，使您的网络规模更大；限制更少。</strong>限额是一个不断变化的目标，如果有充分的理由，可以根据要求例外提高限额。你不应该设计你的网络，把你的决定(主要)建立在限制之上。从您的需求出发，努力使您的网络设计更具可扩展性。如果你做得很好，你几乎肯定不会触及谷歌的网络限制。</li><li id="4d1e" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated"><strong class="jg hj">控制人数</strong>。在设计过程中，请记住考虑每个对等组的多个维度:这包括VPC对等组(也包括Google管理的对等组)、虚拟机数量、转发规则等等！</li><li id="e134" class="lb lc hi jg b jh ll jl lm jp ln jt lo jx lp kb lg lh li lj bi translated"><strong class="jg hj">不要把本文中的数字当成给定的</strong>。请定期查看官方文档，并联系销售人员和Google Cloud支持人员，以了解更多有关最新更新的信息。数字随着基础设施不断发展。</li></ul><p id="2872" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated">虽然这些信息包含在官方文档中，但我花了相当多的时间将不同的信息整合在一起，并获得足够的经验来撰写本文。希望这篇文章是有用的，这样你就不会犯我们经常看到的同样的错误！</p><p id="f153" class="pw-post-body-paragraph je jf hi jg b jh kd jj jk jl ke jn jo jp kf jr js jt kg jv jw jx kh jz ka kb hb bi translated"><em class="lk">感谢</em><a class="lu lv ge" href="https://medium.com/u/2288812ff80e?source=post_page-----2b26267ba7d9--------------------------------" rel="noopener" target="_blank"><em class="lk">Simone Ruffilli</em></a><em class="lk">和</em><a class="lu lv ge" href="https://medium.com/u/c71319e9f3c4?source=post_page-----2b26267ba7d9--------------------------------" rel="noopener" target="_blank"><em class="lk">Gerritd</em></a><em class="lk">的支持和真知灼见。</em></p></div></div>    
</body>
</html>