<html>
<head>
<title>Personalized recommendations with customized recommender</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">具有定制推荐器的个性化推荐</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/personalized-recommendations-with-customized-recommender-f8aca1e6c5aa?source=collection_archive---------3-----------------------#2022-08-30">https://medium.com/google-cloud/personalized-recommendations-with-customized-recommender-f8aca1e6c5aa?source=collection_archive---------3-----------------------#2022-08-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/aa6b5e28610ec1341c0666ce53e536b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9-acRpCvLkbVNzlLzBPSZQ.png"/></div></div></figure><p id="7278" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">任何云平台的优势之一是可扩展性。现在创建<strong class="is hj">几十个</strong>账户、<strong class="is hj">几百个</strong>项目、<strong class="is hj">几千个</strong>资源……非常容易，过一段时间后，你会有<strong class="is hj">吨的东西</strong>，很难管理、优化和策划。<br/>在谷歌云上，<a class="ae jo" href="https://cloud.google.com/recommender/docs" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">主动协助</strong> </a>通过提供建议，帮助你保持你的云环境<strong class="is hj">干净、安全、高效</strong>。</p><p id="dc5e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不同的推荐引擎<strong class="is hj">非常有用</strong>并提供<strong class="is hj">强大的洞察力</strong>。然而，这种见解是基于通用规则的。<br/>例如，在<strong class="is hj"> 90天的观察期</strong>之后，您将会得到<strong class="is hj"> IAM建议</strong>(减少对某个账户授予的权限)。根据您的使用情况，可能是<strong class="is hj">太多</strong>，或者<strong class="is hj">太少</strong>。</p><blockquote class="jp"><p id="2149" class="jq jr hi bd js jt ju jv jw jx jy jn dx translated">但是现在，你可以定制推荐者的配置！</p></blockquote><p id="4d95" class="pw-post-body-paragraph iq ir hi is b it jz iv iw ix ka iz ja jb kb jd je jf kc jh ji jj kd jl jm jn hb bi translated">让我们试试我最喜欢的推荐者:<a class="ae jo" href="https://cloud.google.com/policy-intelligence/docs/role-recommendations-overview" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> IAM推荐者</strong> </a></p><h1 id="8477" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">获取当前配置</h1><p id="8b25" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">第一步是<strong class="is hj">提取当前配置</strong>。为此，您必须拥有推荐者查看者角色(在我们的示例中是<em class="lh"> IAM推荐者查看者</em>角色)。</p><p id="f5fa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，你必须在<a class="ae jo" href="https://cloud.google.com/recommender/docs/recommenders" rel="noopener ugc nofollow" target="_blank">列表</a>中选择<strong class="is hj">你的推荐人的名字</strong>。<br/>我的是<code class="du li lj lk ll b">google.iam.policy.Recommender</code></p><p id="6808" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，使用<strong class="is hj"> gcloud CLI获取配置</strong>并可视化结果</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="61b0" class="lu kf hi ll b fi lv lw l lx ly">gcloud beta recommender recommender-config describe \<br/> google.iam.policy.Recommender \<br/> --location=global \<br/> --project=&lt;ProjectID&gt;</span></pre></div><div class="ab cl lz ma gp mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hb hc hd he hf"><p id="4f08" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">典型的结果如下</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="1468" class="lu kf hi ll b fi lv lw l lx ly">etag: '"24512cd0d91389e6"'<br/>name: projects/&lt;project&gt;/locations/global/recommenders/google.iam.policy.Recommender/config<br/>recommenderGenerationConfig:<br/>  params:<br/>    minimum_observation_period: P90D<br/>revisionId: DEFAULT<br/>updateTime: '2022-08-08T01:18:29Z'</span></pre><p id="9541" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lh">你可以注意到</em> <code class="du li lj lk ll b"><em class="lh">P90D</em></code> <em class="lh">默认定义了90天的观察期</em></p><h1 id="d7a0" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">使用CLI应用您自己的配置</h1><p id="fe9b" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">要使用CLI<strong class="is hj">更新您的配置</strong>，您需要两件事情:</p><ul class=""><li id="3f41" class="mg mh hi is b it iu ix iy jb mi jf mj jj mk jn ml mm mn mo bi translated">当前参数</li><li id="d862" class="mg mh hi is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo bi translated"><code class="du li lj lk ll b">ETAG</code>。<br/><em class="lh"/><code class="du li lj lk ll b"><em class="lh">etag</em></code><em class="lh">通常用于了解请求者读取的最新版本。如果提交的</em> <code class="du li lj lk ll b"><em class="lh">etag</em></code> <em class="lh">与当前的相同，则接受更新，否则拒绝更新。</em></li></ul><h2 id="bce3" class="lu kf hi bd kg mu mv mw kk mx my mz ko jb na nb ks jf nc nd kw jj ne nf la ng bi translated">获取并更新当前参数</h2><p id="3470" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">您可以使用<strong class="is hj"> describe命令</strong>和<code class="du li lj lk ll b">JQ</code>提取当前参数，并<strong class="is hj">将结果保存在文件</strong>中，此处<code class="du li lj lk ll b">paramsConfig.json</code>为<em class="lh">(JSON格式)</em></p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="08b7" class="lu kf hi ll b fi lv lw l lx ly">gcloud beta recommender recommender-config describe \<br/> google.iam.policy.Recommender \<br/> --location=global \<br/> --project=&lt;ProjectID&gt; \<br/> --format=json \<br/> | jq .recommenderGenerationConfig &gt; paramsConfig.json</span></pre><p id="9b96" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，<strong class="is hj">更新参数值</strong>。例如，<em class="lh"/><code class="du li lj lk ll b"><em class="lh">P30D</em></code><em class="lh">默认为30天的可观测性而不是90天。</em></p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="1017" class="lu kf hi ll b fi lv lw l lx ly">{<br/>  "params": {<br/>    "minimum_observation_period": "P30D"<br/>  }<br/>}</span></pre><h2 id="e55d" class="lu kf hi bd kg mu mv mw kk mx my mz ko jb na nb ks jf nc nd kw jj ne nf la ng bi translated"><code class="du li lj lk ll b">ETAG</code>值</h2><p id="9d85" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">接下来，<code class="du li lj lk ll b">etag</code>值。同样，用describe和<code class="du li lj lk ll b">JQ</code>，但是要把<strong class="is hj">的结果保存在变量</strong>中，这里用<code class="du li lj lk ll b">ETAG</code>。</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="b064" class="lu kf hi ll b fi lv lw l lx ly">export ETAG=$(gcloud beta recommender recommender-config describe \<br/> google.iam.policy.Recommender \<br/> --location=global \<br/> --project=&lt;ProjectID&gt; \<br/> --format=json \<br/> | jq .etag)</span></pre><h2 id="3c9e" class="lu kf hi bd kg mu mv mw kk mx my mz ko jb na nb ks jf nc nd kw jj ne nf la ng bi translated">执行更新</h2><p id="8a4e" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">最后，将所有这些放在<strong class="is hj">一个最终命令</strong>中。使用<code class="du li lj lk ll b">paramsConfig.json</code>和<code class="du li lj lk ll b">etag</code>值</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="fb58" class="lu kf hi ll b fi lv lw l lx ly">gcloud beta recommender recommender-config update \<br/> google.iam.policy.Recommender \<br/> --location=global \<br/> --project=&lt;ProjectID&gt; \<br/> --config-file=paramsConfig.json --etag=${ETAG}</span></pre><p id="37d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lh">您必须拥有推荐者管理员角色(在我们的示例中是</em> <code class="du li lj lk ll b"><em class="lh">IAM</em></code> <em class="lh">推荐者管理员角色)。</em></p></div><div class="ab cl lz ma gp mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hb hc hd he hf"><p id="733c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该命令成功应用后，可以再次<strong class="is hj">执行一次描述</strong>(第一部分)<strong class="is hj">来确认</strong>设置了正确的值。</p><h1 id="fc48" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">使用API的最简单方法</h1><p id="93eb" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">如你所见，<strong class="is hj">开发者体验并不好</strong>。提取一部分API响应，单独获取etag，好无聊。</p><blockquote class="jp"><p id="a692" class="jq jr hi bd js jt ju jv jw jx jy jn dx translated">对于最简单的更新，您可以使用<a class="ae jo" href="https://cloud.google.com/recommender/docs/reference/rest/v1beta1/projects.locations.recommenders/updateConfig" rel="noopener ugc nofollow" target="_blank">推荐API </a>。</p></blockquote><h2 id="c042" class="lu kf hi bd kg mu nh mw kk mx ni mz ko jb nj nb ks jf nk nd kw jj nl nf la ng bi translated">获取并更新当前参数</h2><p id="5e22" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">首先，<strong class="is hj">在JSON中原样获取当前配置</strong>，并将结果保存在一个文件中，例如<em class="lh"/><code class="du li lj lk ll b"><em class="lh">recommender-iam.json</em></code><em class="lh"/></p><p id="7067" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">或者像以前一样使用CLI。</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="197c" class="lu kf hi ll b fi lv lw l lx ly">gcloud beta recommender recommender-config describe \<br/> google.iam.policy.Recommender \<br/> --location=global \<br/> --project=&lt;ProjectID&gt; \<br/> --format=json \<br/>&gt; <a class="ae jo" href="http://twitter.com/recommender" rel="noopener ugc nofollow" target="_blank">recommender</a>-iam.json</span></pre><p id="dc9f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">或者直接使用API</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="e7d7" class="lu kf hi ll b fi lv lw l lx ly">curl -H "x-goog-user-project: &lt;ProjectID&gt;" \<br/> -H "Authorization: Bearer $(gcloud auth print-access-token)" \<br/><a class="ae jo" href="https://recommender.googleapis.com/v1beta1/projects/751286965207/locations/global/recommenders/google.iam.policy.Recommender/config" rel="noopener ugc nofollow" target="_blank">https://recommender.googleapis.com/v1beta1/projects/&lt;ProjectID&gt;/locations/global/recommenders/google.iam.policy.Recommender/config</a> \<br/> &gt; <a class="ae jo" href="http://twitter.com/recommender" rel="noopener ugc nofollow" target="_blank">recommender</a>-iam.json</span></pre><p id="9c05" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lh">请注意，您可以使用CLI获取要验证的访问令牌。<br/>如果你用的是你的用户账号，那就不得不用</em> <code class="du li lj lk ll b"><em class="lh">x-goog-user-project</em></code> <em class="lh">头来提“消费项目”。<br/>如果您使用服务帐户，您可以将其删除。</em></p><p id="1c2f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">保存后，<em class="lh">更新内容</em>；<em class="lh">以</em>为例，将 <code class="du li lj lk ll b"><em class="lh">P90D</em></code> <em class="lh">改为</em> <code class="du li lj lk ll b"><em class="lh">P30D</em></code> <em class="lh"/></p><h2 id="4783" class="lu kf hi bd kg mu mv mw kk mx my mz ko jb na nb ks jf nc nd kw jj ne nf la ng bi translated">执行更新</h2><p id="d6a5" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">有趣的部分来了。<strong class="is hj">保持提取的JSON不变</strong>。没有要提取的<code class="du li lj lk ll b">etag</code>或参数！</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="eff7" class="lu kf hi ll b fi lv lw l lx ly">curl -H "x-goog-user-project: &lt;ProjectID&gt;" \<br/> -d <a class="ae jo" href="http://twitter.com/recommender" rel="noopener ugc nofollow" target="_blank">@recommender</a>-iam.json -X PATCH \<br/> -H "Authorization: Bearer $(gcloud auth print-access-token)" \<br/> -H "Content-Type: application/json" \<br/><a class="ae jo" href="https://recommender.googleapis.com/v1beta1/projects/751286965207/locations/global/recommenders/google.iam.policy.Recommender/config" rel="noopener ugc nofollow" target="_blank">https://recommender.googleapis.com/v1beta1/projects/&lt;ProjectID&gt;/locations/global/recommenders/google.iam.policy.Recommender/config</a></span></pre><p id="6561" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lh">我已经和工程团队分享了这种最简单的方法。希望CLI快点好起来！</em></p><h1 id="78ab" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">用你的规则搭建的平台</h1><p id="f3db" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">推荐者定制仅在开始才<strong class="is hj">并且所有的推荐者还不可定制。</strong></p><p id="9ab9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，一些<strong class="is hj">强制组件缺少</strong>，如Terraform模块能够直接使用IaC设置推荐器参数。</p><p id="1a95" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">无论如何，您可以<strong class="is hj">开始思考和定义您的策略</strong>以及您<strong class="is hj">希望如何被推荐</strong>来优化您的云环境！</p></div></div>    
</body>
</html>