<html>
<head>
<title>Modernize your video streaming with personalized user Experience</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过个性化的用户体验使您的视频流现代化</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/modernize-your-video-streaming-with-personalized-user-experience-8dded23d86b2?source=collection_archive---------2-----------------------#2022-12-08">https://medium.com/google-cloud/modernize-your-video-streaming-with-personalized-user-experience-8dded23d86b2?source=collection_archive---------2-----------------------#2022-12-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b663" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望你在NEXT22上有一个很好的体验，在NEXT 22期间，我们宣布了对媒体CDN上直播流的支持，以及与T2谷歌广告管理器360和T4媒体CDN的集成。</p><p id="06c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将介绍Media CDN与Google Ad Manager 360之间的集成，以及使用双令牌认证来保护面向客户的URL。在我们开始技术细节之前，让我们先了解一下媒体CDN和谷歌广告管理器。</p><h1 id="a376" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">关于媒体CDN</h1><p id="d5e4" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">媒体CDN是谷歌云的媒体交付CDN平台，专为流媒体视频和大型对象下载而设计。媒体CDN补充云CDN，我们的web加速CDN平台。</p><p id="ad10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">媒体CDN的独特之处在于，它利用了我们用来向客户提供内容的基础设施——基于谷歌私有的光纤网络。</p><p id="970a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">非谷歌客户将首次能够访问这个平台，在全球超过206个国家/地区和1300多个城市提供大规模覆盖和存在。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/59b9936f72fe7693c6ddcfe0e2eea3d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*enIMKXVnnp-9_rsD"/></div></div></figure><blockquote class="ks kt ku"><p id="a228" class="if ig kv ih b ii ij ik il im in io ip kw ir is it kx iv iw ix ky iz ja jb jc hb bi translated">这张地图是我们网络呼吸的图形表示，而不是特定缓存位置的精确指示器。</p></blockquote><h1 id="93ac" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">关于谷歌广告经理(GAM)</h1><p id="63c2" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">谷歌广告管理器是一个面向大型出版商的广告管理平台。Ad Manager提供精细控制，支持多种广告交换和网络，包括AdSense、广告交换、第三方网络和第三方交换。</p><p id="d1b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">广告管理器适合您，如果您需要:</p><ul class=""><li id="6d00" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">一个将所有库存类型(网站、移动应用、视频或游戏)货币化的中心</li><li id="a671" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">使用第三方网络来竞争广告库存</li><li id="8831" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">更复杂的报告，以获得更精细的见解</li></ul><h1 id="87c9" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">将媒体CDN与GAM集成</h1><p id="c38c" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">如今，越来越多的观众通过各种设备观看电视和视频。在这些设备之间无缝投放相关广告，同时提供出色的体验，已经变得难以实现。</p><p id="a557" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过媒体CDN和GAM的集成，我们将通过媒体CDN提供现代化的流媒体体验，通过服务器端广告插入(SSAI)提供个性化的用户体验，从而实现两者的完美结合。</p><p id="2788" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过媒体CDN和GAM之间的集成，我们将客户端广告集成的复杂性从播放器转移到云，并将广告缝合到流级别的内容中。你得到的是</p><ul class=""><li id="4c3c" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">广告和内容之间的无缝观看体验，无需重新缓冲</li><li id="7b8e" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">跨任意数量的设备</li><li id="af02" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">直播、线性和视频点播内容的内容和广告投放</li><li id="e3c4" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">针对每个用户的针对性和相关性广告</li></ul><p id="a35d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们开始集成之前，我想向您展示一个最终状态架构，以便您很好地了解我们的整体解决方案在部署后的外观。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/4138d0554ff5c01fc888e386149ec8fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SK_o94Efhfq_Mdfz"/></div></div></figure><h1 id="080a" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">先决条件:</h1><p id="2c81" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated"><strong class="ih hj"> Media-CDN先决条件:</strong></p><ul class=""><li id="7bba" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">两个媒体CDN密钥集(一个用于短令牌，一个用于长令牌)</li><li id="60d6" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">两个媒体CDN来源(一个指向dai.google.com，一个指向您的实际来源)</li><li id="51b5" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">启用SSL证书的两个媒体CDN配置(这是DAI的必备功能)。</li></ul><p id="cb50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> GAM先决条件:</strong></p><ul class=""><li id="43d8" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">在您的网络中启用了相对播放列表URL字段的情况下访问GAM 360，这是默认情况下在您的UI上不可用的预发布功能(您可以在实时流配置的内容流设置中找到此功能。</li></ul><p id="5b84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看下面的截图，并检查您的网络是否支持相对播放列表的网址。如果它没有显示此选项，请联系您的GAM团队为您启用它。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ln"><img src="../Images/5f69a0904ebf3cacab6455c9e0e55571.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YKtqO6-DRH2JEUk6"/></div></div></figure><h1 id="d831" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">媒体CDN配置</h1><h1 id="8017" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">用于双令牌认证的短令牌密钥集创建。</h1><p id="3998" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">DAI只支持HMAC，所以您必须为短期令牌创建HMAC密钥集。</p><p id="4942" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">遵循<a class="ae lo" href="https://cloud.google.com/media-cdn/docs/use-dual-token-authentication#set-up-short-duration-tokens" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/media-cdn/docs/use-dual-token-authentic ation # setup-short-duration-tokens</a>中提到的步骤</p><p id="d027" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为HMAC钥匙集创作。</p><p id="ab5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要生成密码，您可以使用以下命令</p><pre class="kh ki kj kk fd lp lq lr bn ls lt bi"><span id="43af" class="lu je hi lq b be lv lw l lx ly">python3.9 -c "import secrets;open('py-shared.secret','wb').write(secrets.token_bytes(32))"</span></pre><p id="794a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将shared.secret文件上传到secret manager后，它将为您提供64个字符的密钥(删除空格后，它将类似于d 7258 f 90 D2 f 4049 e 14 B1 C5 ecfbc 698 fbcb 925111 ABC 808 DD 17 f 22153 C1 FCC 71d，请记下来，因为这在DAI配置中是必需的)</p><h1 id="103b" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">用于双令牌认证的长令牌密钥集创建。</h1><p id="1d65" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">遵循<a class="ae lo" href="https://cloud.google.com/media-cdn/docs/use-dual-token-authentication#create-long-duration-keyset" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/Media-cdn/docs/use-dual-token-authentic ation # create-long-duration-keyset</a>中提到的步骤对于媒体CDN管理的长令牌，这是CDN管理的长令牌，因为媒体CDN使用ED25519签名来生成和验证长令牌。ED25519是一种非对称歌唱算法，需要一个私钥用于令牌生成，一个公钥用于令牌验证。</p><p id="8e65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于CDN必须进行生成和验证，因此需要对长密钥集进行CDN管理。</p><h1 id="1f16" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">两个起源的创造</h1><h1 id="2501" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">傣源</h1><p id="75bc" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">对于主和子清单请求，该起点将指向dai.google.com。我们将在Media-CDN服务中配置路由规则。</p><p id="26e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为参考的YAML样本。</p><p id="dfed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在您使用YAML之前，请在下面的&lt; &gt;之间更改<strong class="ih hj"> &lt;变量&gt; </strong>，例如，您的项目ID、项目编号等..，带花括号的变量— {variables}是媒体CDN变量，如果不需要，请不要更改它们。</p><pre class="kh ki kj kk fd lp lq lr bn ls lt bi"><span id="3022" class="lu je hi lq b be lv lw l lx ly">name: projects/&lt;your-project-Id&gt;/locations/global/edgeCacheOrigins/dai-origin<br/>updateTime: '2022-09-30T10:25:44.195099638Z'<br/>originAddress: dai.google.com<br/>protocol: HTTP2<br/>timeout:<br/> connectTimeout: 5s<br/> maxAttemptsTimeout: 15s<br/> responseTimeout: 30s<br/> readTimeout: 15s<br/>createTime: '2022-09-27T05:20:23.011190947Z'</span></pre><h1 id="4c87" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">实际内容来源</h1><p id="c0bd" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">这个原点将指向您的实际内容所在的GCS存储桶。我们将在面向最终用户的服务和面向dai的服务中使用此来源(从DAI到媒体CDN的异步获取，用于主清单和子清单)。</p><p id="12fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为参考的YAML样本。</p><pre class="kh ki kj kk fd lp lq lr bn ls lt bi"><span id="8609" class="lu je hi lq b be lv lw l lx ly">name: projects/&lt;your-project-Id&gt;/locations/global/edgeCacheOrigins/content-origin<br/>updateTime: '2022-09-26T06:36:53.721017008Z'<br/>originAddress: gs://&lt;your-GCS-bucket-name&gt;<br/>protocol: HTTP2<br/>port: 443<br/>timeout:<br/> connectTimeout: 5s<br/> maxAttemptsTimeout: 15s<br/> responseTimeout: 30s<br/> readTimeout: 15s<br/>createTime: '2022-09-26T06:35:44.718831043Z'</span></pre><h1 id="cd7f" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">创建两个服务</h1><p id="78da" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">创建两个服务来获取IP地址和配置SSL证书。我们将更新服务，一旦我们有游戏流创建。</p><ul class=""><li id="df97" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">创建服务yaml — dai-facing.yaml，上传到云壳。</li></ul><pre class="kh ki kj kk fd lp lq lr bn ls lt bi"><span id="ecbd" class="lu je hi lq b be lv lw l lx ly">name: dai-facing<br/>routing:<br/>  hostRules:<br/>  - hosts:<br/>    - "*"<br/>    pathMatcher: routes<br/>  pathMatchers:<br/>  - name: routes<br/>    routeRules:<br/>    - priority: 1<br/>      matchRules:<br/>      - prefixMatch: "/"<br/>      origin: dai-origin</span></pre><ul class=""><li id="9390" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">使用yaml导入服务。</li></ul><pre class="kh ki kj kk fd lp lq lr bn ls lt bi"><span id="7a8f" class="lu je hi lq b be lv lw l lx ly">gcloud edge-cache services import dai-facing \<br/>  --source={path-to-the-yaml-file}</span></pre><ul class=""><li id="d9bf" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">通过检查ipv4Addresses字段，检索并记录响应中返回的IP。</li><li id="bae4" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">类似地，创建服务yaml — customer-facing.yaml并上传到云外壳。</li></ul><pre class="kh ki kj kk fd lp lq lr bn ls lt bi"><span id="b7e6" class="lu je hi lq b be lv lw l lx ly">name: customer-facing<br/>routing:<br/>  hostRules:<br/>  - hosts:<br/>    - "*"<br/>    pathMatcher: routes<br/>  pathMatchers:<br/>  - name: routes<br/>    routeRules:<br/>    - priority: 1<br/>      matchRules:<br/>      - prefixMatch: "/"<br/>      origin: content-origin</span></pre><ul class=""><li id="84f7" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">使用yaml导入服务。</li></ul><pre class="kh ki kj kk fd lp lq lr bn ls lt bi"><span id="6fea" class="lu je hi lq b be lv lw l lx ly">gcloud edge-cache services import customer-facing \<br/>  --source=&lt;path-to-the-yaml-file&gt;</span></pre><ul class=""><li id="b06c" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">通过检查ipv4Addresses字段，检索并记录响应中返回的IP。</li></ul><h1 id="8463" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">配置域以指向CDN服务IP</h1><ul class=""><li id="07d8" class="kz la hi ih b ii kb im kc iq lz iu ma iy mb jc le lf lg lh bi translated">按照<a class="ae lo" href="https://cloud.google.com/dns/docs/set-up-dns-records-domain-name#create_a_record_to_point_the_domain_to_an_external_ip_address" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/DNS/docs/set-up-DNS-records-domain-name # create _ A _ record _ to _ point _ the _ domain _ to _ an _ external _ ip _ address</a>中的步骤创建一条记录，将域指向<strong class="ih hj">面向戴的服务</strong>的CDN服务IP</li><li id="36f2" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">同样，按照<a class="ae lo" href="https://cloud.google.com/dns/docs/set-up-dns-records-domain-name#create_a_record_to_point_the_domain_to_an_external_ip_address" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/DNS/docs/set-up-DNS-records-domain-name # create _ A _ record _ to _ point _ the _ domain _ to _ an _ external _ ip _ address</a>中的步骤，创建一条记录，将域指向<strong class="ih hj">面向客户服务</strong>的CDN服务IP</li><li id="e3b4" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">按照<a class="ae lo" href="https://cloud.google.com/media-cdn/docs/configure-ssl-certificates" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/media-cdn/docs/configure-SSL-certificates</a>中的步骤，为<strong class="ih hj">面向dai的服务</strong>和<strong class="ih hj">面向客户的服务</strong>创建SSL证书</li></ul><p id="6baf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将在GAM中进行CDN配置和线性配置</p><h1 id="a0fe" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">游戏配置</h1><h1 id="ae65" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">GAM中的线性CDN配置</h1><ul class=""><li id="a718" class="kz la hi ih b ii kb im kc iq lz iu ma iy mb jc le lf lg lh bi translated">点击<strong class="ih hj">新配置</strong></li></ul><p id="4def" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">一般设置</strong></p><ul class=""><li id="444d" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated"><strong class="ih hj">名称</strong> : &lt;给出您的首选CDN配置名称&gt;</li><li id="64c3" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated"><strong class="ih hj">类型</strong>:直播流内容</li><li id="a213" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated"><strong class="ih hj">摄取设置</strong></li><li id="9b71" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated"><strong class="ih hj">摄取URL前缀</strong> : &lt;面向服务的FQDN&gt;/&lt;前缀1 &gt; /</li></ul><p id="f6df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">#prefix1是您选择的前缀，对于后续配置，我们将其称为前缀1</p><ul class=""><li id="ddde" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated"><strong class="ih hj"> CDN认证</strong> : Akamai</li><li id="f083" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated"><strong class="ih hj">令牌认证:</strong>启用</li><li id="fce2" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated"><strong class="ih hj">令牌认证密钥:</strong> &lt;我们之前创建的64个字符长的HMAC密钥&gt;</li></ul><p id="f0ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">默认交付设置</strong></p><ul class=""><li id="d16b" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated"><strong class="ih hj">交付URL前缀</strong> : &lt;面向客户服务的FQDN&gt;</li><li id="faac" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated"><strong class="ih hj">安全设置</strong>:勾选“使用摄取安全设置”</li><li id="08cb" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated"><strong class="ih hj">主播放列表原点转发类型</strong>:常规</li><li id="1a18" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated"><strong class="ih hj">主播放列表原点路径前缀</strong> : / &lt;前缀1 &gt;</li><li id="e79d" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">点击<strong class="ih hj">保存</strong></li></ul><h1 id="7bd1" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">GAM中的线性流配置</h1><ul class=""><li id="a74b" class="kz la hi ih b ii kb im kc iq lz iu ma iy mb jc le lf lg lh bi translated">点击<strong class="ih hj">新建直播</strong></li></ul><p id="1a70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">通用设置</strong></p><ul class=""><li id="38dd" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated"><strong class="ih hj">名称</strong> : &lt;给出你的首选线性流配置名称&gt;</li><li id="641c" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated"><strong class="ih hj">结束时间</strong>:无限制</li></ul><p id="4177" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">内容流设置</strong></p><ul class=""><li id="6d8a" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated"><strong class="ih hj">内容流</strong>:https://&lt;FQDN-of-Dai-facing-service&gt;/&lt;prefix 1&gt;/&lt;path-to-master-manifest-file&gt;/index . m3u 8(检查您的主清单文件名是否正确)</li></ul><p id="933b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">#主清单url，在FQDN/后带有{前缀1}</p><ul class=""><li id="fdf1" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated"><strong class="ih hj">直播流内容配置</strong> : &lt;选择-cdn-配置-名称-我们之前创建的&gt;</li><li id="c2b5" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated"><strong class="ih hj">相对播放列表网址</strong>:已启用</li></ul><p id="1e2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">广告中断设置</strong></p><ul class=""><li id="0e8e" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated"><strong class="ih hj">主广告标签</strong> : &lt;根据您的业务需求选择或添加广告标签URL&gt;</li></ul><p id="2f2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<strong class="ih hj">保存</strong>和<strong class="ih hj"> </strong>找到创建的实时流并记下资产键</p><p id="4630" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">资产关键字</strong> : ABCDEFGHIJKLMNOPQRS</p><h1 id="fbeb" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">更新媒体CDN服务:</h1><p id="5f66" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">此时，SSL证书应该处于活动状态。使用以下命令检查SSL证书状态</p><pre class="kh ki kj kk fd lp lq lr bn ls lt bi"><span id="e48a" class="lu je hi lq b be lv lw l lx ly">gcloud certificate-manager certificates describe &lt;certificate-name&gt;</span></pre><h1 id="c206" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">更新面向dai的服务:</h1><ul class=""><li id="9e1f" class="kz la hi ih b ii kb im kc iq lz iu ma iy mb jc le lf lg lh bi translated">使用cloud shell和import按照下面的修改更新dai-facing.yaml文件。</li></ul><blockquote class="ks kt ku"><p id="01c5" class="if ig kv ih b ii ij ik il im in io ip kw ir is it kx iv iw ix ky iz ja jb jc hb bi translated">注意:我们只为m3u8文件创建路由规则，因为DAI只希望从您的源获得m3u8文件，而不需要从您的实际源下载实际段。如果有人将访问此FQDN和清单文件路径，则媒体CDN也不会向请求者提供段，因为没有路由规则。ts文件。</p></blockquote><pre class="kh ki kj kk fd lp lq lr bn ls lt bi"><span id="c2f7" class="lu je hi lq b be lv lw l lx ly">name: projects/&lt;your-project-Id&gt;/locations/global/edgeCacheServices/dai-facing<br/>updateTime: '2022-09-29T07:28:09.450208839Z'<br/>requireTls: true<br/>edgeSslCertificates:<br/>- projects/&lt;your-project-number&gt;/locations/global/certificates/&lt;certificate-name-of-your-dai-facing-service&gt;<br/>routing:<br/> hostRules:<br/> - hosts:<br/>   - &lt;FQDN-of-your-dai-facing-service&gt;<br/>   pathMatcher: path-matcher-0<br/> pathMatchers:<br/> - name: path-matcher-0<br/>   routeRules:<br/>   - priority: '1'<br/>     matchRules:<br/>     - prefixMatch: /&lt;prefix1&gt;/&lt;path-to-master-manifest-file&gt;/&lt;master-manifest-file-name&gt;.m3u8 #this will point to your master manifest file<br/>     origin: projects/&lt;your-project-number&gt;/locations/global/edgeCacheOrigins/content-origin<br/>     headerAction: {}<br/>     routeAction:<br/>       cdnPolicy:<br/>         cacheMode: FORCE_CACHE_ALL<br/>         defaultTtl: 3600s<br/>         cacheKeyPolicy:<br/>           excludeHost: true<br/>           excludeQueryString: true<br/>         signedRequestMode: DISABLED<br/>       urlRewrite:<br/>         pathPrefixRewrite: /&lt;path-to-master-manifest-file&gt;/&lt;master-manifest-file-name&gt;.m3u8 #Please note - this is without prefix1<br/>   - priority: '2'<br/>     matchRules:<br/>     - pathTemplateMatch: /&lt;prefix1&gt;/&lt;path-to-master-manifest-file&gt;/{variant}/{file}.m3u8 #{variant} and {file} are media cdn supported variables here, if you don’t have folders underneath your master manifest file, please remove {variant}/ from pathTemplateMatch, do not remove curly braces from variables.<br/>     origin: projects/&lt;your-project-number&gt;/locations/global/edgeCacheOrigins/content-origin<br/>     headerAction: {}<br/>     routeAction:<br/>       cdnPolicy:<br/>         cacheMode: FORCE_CACHE_ALL<br/>         defaultTtl: 2s<br/>         cacheKeyPolicy:<br/>           excludeHost: true<br/>           excludeQueryString: true<br/>         signedRequestMode: DISABLED<br/>       urlRewrite:<br/>         pathTemplateRewrite: /&lt;path-to-master-manifest-file&gt;/{variant}/{file}.m3u8 #{variant} and {file} are media cdn supported variables here, if you don’t have folders underneath your master manifest file, please remove {variant}/ from pathTemplateMatch, do not remove curly braces from variables.<br/>logConfig:<br/> enable: true<br/> sampleRate: 1.0<br/>createTime: '2022-09-28T12:49:55.392769608Z'</span></pre><ul class=""><li id="5031" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">使用yaml导入服务。</li></ul><pre class="kh ki kj kk fd lp lq lr bn ls lt bi"><span id="f734" class="lu je hi lq b be lv lw l lx ly">gcloud edge-cache services import dai-facing \<br/>  --source={path-to-the-yaml-file}</span></pre><h1 id="9997" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">更新面向用户的服务:</h1><ul class=""><li id="6e9b" class="kz la hi ih b ii kb im kc iq lz iu ma iy mb jc le lf lg lh bi translated">按照下面的修改，使用云外壳和导入更新面向客户的. yaml文件。</li></ul><pre class="kh ki kj kk fd lp lq lr bn ls lt bi"><span id="3f5a" class="lu je hi lq b be lv lw l lx ly">name: projects/&lt;your-project-Id&gt;/locations/global/edgeCacheServices/customer-facing<br/>updateTime: '2022-09-30T12:31:44.574157874Z'<br/>requireTls: true<br/>edgeSslCertificates:<br/>- projects/&lt;your-project-number&gt;/locations/global/certificates/&lt;certificate-name-of-your-customer-facing-service&gt;<br/>routing:<br/> hostRules:<br/> - hosts:<br/>   - &lt;FQDN-of-your-customer-facing-service&gt;<br/>   pathMatcher: path-matcher-0<br/> pathMatchers:<br/> - name: path-matcher-0<br/>   routeRules:<br/>   - priority: '1'<br/>     matchRules:<br/>     - pathTemplateMatch: /linear/*/*/*/*/*/*/master.m3u8<br/>     origin: projects/&lt;your-project-number&gt;/locations/global/edgeCacheOrigins/dai-origin<br/>     headerAction:<br/>       responseHeadersToAdd:<br/>       - headerName: x-cdn-status<br/>         headerValue: '{cdn_cache_status}'<br/>     routeAction:<br/>       cdnPolicy:<br/>         cacheMode: CACHE_ALL_STATIC<br/>         defaultTtl: 3600s<br/>         maxTtl: 86400s<br/>         cacheKeyPolicy:<br/>           excludeHost: true<br/>           excludeQueryString: true<br/>         signedRequestMode: REQUIRE_TOKENS<br/>         signedRequestKeyset: &lt;your-short-token-keyset-name&gt; #This is to validate urls and tokens generated by DAI<br/>         signedTokenOptions:<br/>           tokenQueryParameter: hdnea<br/>           allowedSignatureAlgorithms:<br/>           - HMAC_SHA_256<br/>           - ED25519<br/>           - HMAC_SHA1<br/>         addSignatures:<br/>           actions:<br/>           - GENERATE_TOKEN_HLS_COOKIELESS<br/>           keyset: &lt;your-long-token-keyset-name&gt; #This is to add long tokens in query parameters by media CDN<br/>           tokenTtl: 86400s<br/>           tokenQueryParameter: hdntl<br/>           copiedParameters:<br/>           - PathGlobs<br/>           - URLPrefix<br/>           - acl<br/>       urlRewrite:<br/>         hostRewrite: dai.google.com<br/>   - priority: '3'<br/>     matchRules:<br/>     - pathTemplateMatch: /**.ts<br/>     origin: projects/&lt;your-project-number&gt;/locations/global/edgeCacheOrigins/content-origin<br/>     headerAction:<br/>       responseHeadersToAdd:<br/>       - headerName: x-cache-status<br/>         headerValue: '{cdn_cache_status}'<br/>     routeAction:<br/>       cdnPolicy:<br/>         cacheMode: FORCE_CACHE_ALL<br/>         defaultTtl: 31536000s<br/>         cacheKeyPolicy:<br/>           excludeHost: true<br/>           excludeQueryString: true<br/>         negativeCaching: true<br/>         negativeCachingPolicy:<br/>           '403': 120s<br/>           '404': 120s<br/>           '502': 120s<br/>         signedRequestMode: REQUIRE_TOKENS<br/>         signedRequestKeyset: &lt;your-long-token-keyset-name&gt; #This is to validate urls and tokens generated media CDN in response to child manifest<br/>         signedTokenOptions:<br/>           tokenQueryParameter: hdntl<br/>   - priority: '2'<br/>     matchRules:<br/>     - pathTemplateMatch: /**.m3u8<br/>     origin: projects/&lt;your-project-number&gt;/locations/global/edgeCacheOrigins/dai-origin<br/>     headerAction:<br/>       responseHeadersToAdd:<br/>       - headerName: x-cache-status<br/>         headerValue: '{cdn_cache_status}'<br/>     routeAction:<br/>       cdnPolicy:<br/>         cacheMode: CACHE_ALL_STATIC<br/>         defaultTtl: 3600s<br/>         maxTtl: 86400s<br/>         cacheKeyPolicy:<br/>           excludeHost: true<br/>           excludeQueryString: true<br/>         signedRequestMode: REQUIRE_TOKENS<br/>         signedRequestKeyset: &lt;your-long-token-keyset-name&gt; #This is to validate urls and tokens generated by media CDN in response to master manifest file<br/>         signedTokenOptions:<br/>           tokenQueryParameter: hdntl<br/>           allowedSignatureAlgorithms:<br/>           - HMAC_SHA_256<br/>           - ED25519<br/>           - HMAC_SHA1<br/>         addSignatures:<br/>           actions:<br/>           - PROPAGATE_TOKEN_HLS_COOKIELESS #Media CDN can also generate token option for segments, you can also use the GENERATE_TOKEN_HLS_COOKIELESS option here.<br/>           keyset: &lt;your-long-token-keyset-name&gt; #This is to add long tokens in query parameters by media CDN <br/>           tokenTtl: 86400s<br/>           tokenQueryParameter: hdntl<br/>           copiedParameters:<br/>           - PathGlobs<br/>           - URLPrefix<br/>           - acl<br/>       urlRewrite:<br/>         hostRewrite: dai.google.com<br/>logConfig:<br/> enable: true<br/> sampleRate: 1.0<br/>createTime: '2022-09-26T06:58:15.925641821Z'</span></pre><ul class=""><li id="271d" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">使用yaml导入服务。</li></ul><pre class="kh ki kj kk fd lp lq lr bn ls lt bi"><span id="e7e9" class="lu je hi lq b be lv lw l lx ly">gcloud edge-cache services import customer-facing \<br/> - source=&lt;path-to-the-yaml-file&gt;</span></pre><p id="77fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成后，尝试玩游戏的网址和插入SCTE标记来测试你的集成。</p><h1 id="ea23" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">庆祝🥳的时间到了</h1><p id="2780" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">希望你一直陪着我，直到旅程结束，给自己一个应有的奖励，使用<strong class="ih hj">媒体CDN </strong>构建现代化的流媒体方法，使用<strong class="ih hj">谷歌</strong>规模的谷歌广告管理器构建个性化的用户体验。</p><p id="0e05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请与我分享您的反馈，并建议我应该在下一篇关于GCP媒体产品的博客中包含哪些内容。</p><p id="089f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">免责声明:</strong>这是为了告知读者，文中表达的观点、想法和意见仅属于作者，不一定属于作者的雇主、组织、委员会或其他团体或个人。</p></div></div>    
</body>
</html>