<html>
<head>
<title>Building REST API for Google Firestore using App Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用应用引擎为Google Firestore构建REST API</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-read-google-firestore-data-using-rest-api-1386df45c420?source=collection_archive---------0-----------------------#2021-09-18">https://medium.com/google-cloud/how-to-read-google-firestore-data-using-rest-api-1386df45c420?source=collection_archive---------0-----------------------#2021-09-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="95bb" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">读取存储在Google Firestore中的数据库配置参数</h2></div><p id="202b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">配置参数是允许应用程序确定起作用的基本值的设置。配置存储及其管理的确定取决于各种因素，包括环境、部署方法和配置元素的类型。在大规模分布式环境中，除非有一个自动化的配置文件管理系统，否则数据库是必不可少的。</p><p id="be47" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以下因素影响使用Firestore作为配置存储的决定:<br/> ■可扩展的无服务器文档数据库<br/> ■直接连接到web和移动应用程序<br/> ■通过丰富的安全和数据验证规则进行数据保护<br/> ■与Google云服务统一集成</p><h2 id="f1ce" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">数据流图</h2><p id="b937" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">数据流图描述了与多个数据库相关的配置参数设置。Rest-API调用使用层次结构来读取特定的数据库信息，并作为JSON返回。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div class="er es kt"><img src="../Images/6b533eeeff6b65311d16e7e15c2c939d.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/1*vVqqtPWq6ac0wXdy2cdw2g.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx translated">多个数据库的配置存储</figcaption></figure><h2 id="5676" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">源代码</h2><p id="9b16" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated">在这篇博客中，Google App Engine用于在Google管理的平台上开发和托管web应用程序。App Engine服务可以用不同的编程语言编写，在这个解决方案中，node.js用作代码库。</p><p id="f068" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> app.js: </strong>这个<strong class="iz hj"> </strong>文件包含启动服务器和响应请求的JavaScript代码。以下代码通过运行在端口8080上的服务器响应来自web客户端的请求。</p><pre class="ku kv kw kx fd lf lg lh li aw lj bi"><span id="8ff1" class="jt ju hi lg b fi lk ll l lm ln">'use strict';</span><span id="177b" class="jt ju hi lg b fi lo ll l lm ln">require('dotenv').config();<br/>const bodyParser = require('body-parser');<br/>const cors = require('cors');<br/>const express = require('express');<br/>const app = express();</span><span id="abbc" class="jt ju hi lg b fi lo ll l lm ln">const fsReadController = require('./controllers/fsReadController');</span><span id="318d" class="jt ju hi lg b fi lo ll l lm ln">app.use(bodyParser.json());<br/>app.use(cors());</span><span id="5b28" class="jt ju hi lg b fi lo ll l lm ln">app.get('/firestore/:collection/:database/:db', (req, res) =&gt; {<br/>    fsReadController.index(req, res);<br/>});</span><span id="796d" class="jt ju hi lg b fi lo ll l lm ln">const PORT = process.env.PORT || 8080;<br/>app.listen(PORT, () =&gt; {<br/>    console.log(`App listening on port ${PORT}`);<br/>});</span><span id="8e3d" class="jt ju hi lg b fi lo ll l lm ln">module.exports = app;</span></pre><p id="b15f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> fsReadController.js : </strong>该代码用于根据请求读取输入参数，并检索存储在Cloud Firestore中的数据。API调用的响应是JSON字符串格式的。</p><pre class="ku kv kw kx fd lf lg lh li aw lj bi"><span id="3784" class="jt ju hi lg b fi lk ll l lm ln">'use strict';</span><span id="9c29" class="jt ju hi lg b fi lo ll l lm ln">const { Firestore } = require("<a class="ae lp" href="http://twitter.com/google" rel="noopener ugc nofollow" target="_blank">@google</a>-cloud/firestore");<br/>const firestore = new Firestore();</span><span id="9662" class="jt ju hi lg b fi lo ll l lm ln">async function getFireStoreDocument(docPath) {<br/>    const document = firestore.doc(docPath);<br/>    let doc = await document.get();<br/>    return doc;<br/>}</span><span id="0465" class="jt ju hi lg b fi lo ll l lm ln">exports.index = async function (req, res) {<br/>    const collection = req.params.collection;<br/>    const database = req.params.database;<br/>    const db = req.params.db;<br/>    const docPath = collection + "/" + database + "/dbname/" + db;</span><span id="d715" class="jt ju hi lg b fi lo ll l lm ln">    try {<br/>        const doc = await getFireStoreDocument(docPath);<br/>        const docData = JSON.stringify(doc.data(), null, 4);<br/>        res.status(200).send(docData);<br/>    }<br/>    catch (err) {<br/>        console.error(err);<br/>        res.status(500).send(err.message);<br/>    }<br/>};</span></pre><h2 id="0a61" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">将应用程序部署到应用程序引擎</h2><ol class=""><li id="4a4c" class="lq lr hi iz b ja ko jd kp jg ls jk lt jo lu js lv lw lx ly bi translated">从GitHub资源库下载源代码</li><li id="0aa9" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">更改到应用程序文件夹[<strong class="iz hj">$ CD cloud-firestore-API</strong></li><li id="77f6" class="lq lr hi iz b ja lz jd ma jg mb jk mc jo md js lv lw lx ly bi translated">部署应用程序[ <strong class="iz hj"> $ gcloud应用程序部署</strong></li></ol><h2 id="e678" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">试验结果</h2><p id="9f25" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated"><strong class="iz hj">请求:</strong>(用实际url替换“targeturl”)</p><pre class="ku kv kw kx fd lf lg lh li aw lj bi"><span id="1185" class="jt ju hi lg b fi lk ll l lm ln">curl --request GET '<a class="ae lp" href="https://cloud-firestore-api-dot-eap-lab-06e21a76f78f462a.ue.r.appspot.com/firestore/dbconfig/oracle/db1'" rel="noopener ugc nofollow" target="_blank">https://targeturl/firestore/dbconfig/oracle/db1'</a></span></pre><p id="c6f7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">响应:</strong></p><pre class="ku kv kw kx fd lf lg lh li aw lj bi"><span id="adf4" class="jt ju hi lg b fi lk ll l lm ln">{<br/>  "SID": "orcl",<br/>  "Password": "password",<br/>  "HostName": "db1.example.com",<br/>  "UserName": "dbadmin",<br/>  "Schema": "dbadmin",<br/>  "PORT": "1531",<br/>  "Version": "12.2.0.3"<br/>}</span></pre><h2 id="b4a0" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">源代码库</h2><p id="3473" class="pw-post-body-paragraph ix iy hi iz b ja ko ij jc jd kp im jf jg kq ji jj jk kr jm jn jo ks jq jr js hb bi translated"><a class="ae lp" href="https://github.com/soumendra-mishra/cloud-firestore-api.git" rel="noopener ugc nofollow" target="_blank">https://github.com/soumendra-mishra/cloud-firestore-api.git</a></p></div></div>    
</body>
</html>