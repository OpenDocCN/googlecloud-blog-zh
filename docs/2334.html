<html>
<head>
<title>Automate your VOD transcoding at scale with GCP: Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GCP大规模自动化VOD转码:第2部分</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/automate-your-vod-transcoding-at-scale-with-gcp-part-2-b1da0e57823d?source=collection_archive---------1-----------------------#2022-08-30">https://medium.com/google-cloud/automate-your-vod-transcoding-at-scale-with-gcp-part-2-b1da0e57823d?source=collection_archive---------1-----------------------#2022-08-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9cfd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">欢迎回到我的两部分博客的第二部分，用GCP大规模自动化你的视频点播转码。</p><p id="2b1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在第一部分开始时承诺涵盖端到端集成、自动化、安全性、日志记录和报告，展示了下面的架构图。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/5036460277f81d8d0939984310c091b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-2TNKk9i-H75pq6a"/></div></div></figure><blockquote class="jp jq jr"><p id="de67" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="hi">图像:</em> </strong> <em class="hi">转码自动化整体架构</em></p></blockquote><p id="296d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在第1部分中，我介绍了代码转换管道自动化，下面是整体架构部分。我们还构建了cloud Pub/Sub 1和cloud Pub/Sub 2，它们在第1部分中没有用，但我们将在第2部分中使用它们。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/4b4dfd689c66ea99bd66779c5c3475b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RxVuXQJvJEhzoRy8"/></div></div></figure><p id="0303" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你错过了这个博客系列的第一部分，那么我建议你先阅读第一部分，可以在<a class="ae jw" rel="noopener" href="/google-cloud/automate-your-vod-transcoding-at-scale-with-gcp-part-1-87503fdd3a9f">https://medium . com/Google-cloud/automate-your-VOD-transcoding-at-scale-with-GCP-part-1-87503 FDD 3 a9 f</a>上找到，然后从这个博客开始。</p><h1 id="d888" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">第二部分:</h1><p id="dda5" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">在上一部分中，我介绍了自动化、日志记录和安全性(没有人工干预和使用IAM权限的原始访问)，在这一部分中，我将介绍集成、报告和可视化的其余部分。</p><h1 id="c797" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">转码开始状态:</h1><p id="0e5a" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">我们在第1部分创建了一个发布/订阅主题(代码转换-开始-状态)，现在是时候将发布/订阅与Google BigQuery (BQ)连接起来了，在这一部分，我们将从整体架构构建下面的部分。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es la"><img src="../Images/48f79fcf9335e2f5acad0dab382ce5d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GrhNV6dBg35QEG47"/></div></div></figure><h1 id="4a39" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">BigQuery (BQ)代码转换开始状态:</h1><p id="dfe5" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">在创建BQ订阅之前，我们需要创建一个数据集和表。从谷歌云控制台进入BQ，点击你的项目id旁边的三个点，然后点击创建数据集。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lb"><img src="../Images/88859d75fc2ef1943360b99285e0be6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4SZjtsWMUUmRd-4f"/></div></div></figure><h1 id="a0ca" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">创建数据集:</h1><p id="50ee" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">在下面的示例中，我选择了transcoding_jobs作为数据集ID，选择了asia-south1作为数据位置(您可以选择自己的数据集ID和数据位置),并保留了其余设置的默认配置。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lc"><img src="../Images/be68b85cb2ddfa8337eab797434156fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uwIkjt0sDv_afvy4"/></div></div></figure><h1 id="2eb3" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">创建转码-开始-状态表:</h1><p id="b6b0" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">同样，单击数据集(transcoding_job)旁边的三个点，单击创建表格。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ld"><img src="../Images/d217cf25058f04d54b07071ef4de4ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*84UQE4nENF7EQ6FF"/></div></div></figure><p id="77c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用代码转换-开始-状态作为表名，在schema上，点击编辑作为文本，并把GitHub gist中提供的json作为文本，然后点击创建表</p><p id="dd43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jw" href="https://gist.github.com/nazir-kabani/bea532aa37a0c3ad86205dd83f0f397d" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/nazir-kabani/bea 532 aa 37 a 0 C3 ad 86205 DD 83 f 0 f 397d</a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/49290b63deab0511a2236eccfb642033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MpohBwfmei98A-RK"/></div></div></figure><h1 id="2f1f" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">发布/订阅1到BQ导出:</h1><p id="1bb8" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">在我们为BQ导出创建发布/订阅之前，我们必须将<strong class="ih hj"> BigQuery表权限授予发布/订阅服务帐户</strong>。</p><p id="c147" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从google cloud console，转到IAM点击添加，在新主体中添加发布/订阅服务帐户<strong class="ih hj">(您的ID将类似于service-{ Project-Number } @ GCP-sa-pubsub . IAM . gserviceaccount . com)</strong>，在角色中添加BigQuery数据编辑器并保存。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/9286df837e17f0f28080230259a2f239.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6gMBKhX_8hRh5h4q"/></div></div></figure><p id="9268" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，从谷歌云控制台进入发布/订阅-&gt;主题，打开转码-开始-状态。点击EXPORT TO BIGQUERY</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/9dc5b1aa832575c0e6151fc70f91e1b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g8lW1b7cdAFsRGwh"/></div></div></figure><p id="09b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将看到一个弹出窗口，决定是使用发布/订阅还是使用数据流，选择发布/订阅并单击继续。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es le"><img src="../Images/7d67cb132f1c24f41d196b9fe86422d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GQ5COrojJWAQ-_e3"/></div></div></figure><p id="7397" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一页上，选择您选择的subscription-id，选择transcoding_jobs作为数据集，选择transcoding-start-status作为表，<strong class="ih hj">选择use topic schema，选择drop unknown fields </strong>，然后单击create。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lf"><img src="../Images/e6cc6e81115f2dccaf43c738dca918f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8bNmTtrh75GGlDAd"/></div></div></figure><p id="466a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样。我们已经完成了将开始状态导出到BQ的代码转换，但是我们将在将代码转换完成状态导出到BQ后进行检查。</p><h1 id="2f52" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">转码完成状态:</h1><p id="7404" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">到目前为止容易吗？现在，让我们从整体架构构建以下部分架构，以将转码完成状态导出到BQ。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lg"><img src="../Images/e4cd31d354d8bec443bceeadd299ed3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aXTq4o37GXmIbFQA"/></div></div></figure><p id="f5a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在博客的第1部分，我们创建了一个名为代码转换-作业-通知的云发布/订阅2主题，并在代码转换器作业模板中使用了该主题。转码器API使用该主题发布作业完成后的转码作业状态，现在我们将使用该主题触发云函数2从转码器API获取作业完成元数据，并将作业完成元数据发布到云发布/订阅3。</p><h1 id="a10d" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">发布/订阅3:</h1><p id="ef04" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">在构建第二个云函数之前，我们必须创建Pub/Sub3，并在云函数2中使用它的主题ID。</p><p id="dfc2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从google cloud控制台，转到发布/订阅-&gt;模式，然后单击创建模式。</p><p id="0614" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">给你的模式起一个你喜欢的名字，对于这个博客，我使用代码转换-完成-状态作为模式名。</p><p id="8626" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选择Avro作为模式类型，并通过模式定义中GitHub gist下面的json，然后单击create。</p><p id="97e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jw" href="https://gist.github.com/nazir-kabani/9b811d1955c0e7803de7550090269092" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/nazir-kabani/9b 811d 1955 c 0 e 7803 de 7550090269092</a></p><p id="af68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，点击从模式页面创建主题<strong class="ih hj">(不要转到主题页面创建)</strong>。输入主题ID代码转换-完成-状态，然后点击创建主题。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lh"><img src="../Images/c2bc24b93a26d5d4c345a9019b50378f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aafo7ut-ql1FhznZ"/></div></div></figure><h1 id="e3ca" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">云功能2:</h1><p id="39f5" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">现在，我们将使用以下配置构建第二个云函数。</p><p id="2321" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从google cloud console，进入cloud functions，点击create function，给函数名取你喜欢的名字(我在这篇博客里用的是代码转换-作业-完成名)，选择代码转换器API和你的源输出桶可用的最近的地区。</p><p id="905c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在触发类型中，选择云发布/订阅，在选择云发布/订阅主题中选择转码-作业-通知，然后单击保存。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es li"><img src="../Images/90b154a4eb8af10f2b95d38ca7e46042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gBqucXktGmZ29bKI"/></div></div></figure><p id="b261" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">展开运行时、构建、连接和安全设置，进行以下更改，然后单击下一步。</p><ul class=""><li id="2dd5" class="lj lk hi ih b ii ij im in iq ll iu lm iy ln jc lo lp lq lr bi translated">在运行时下，将分配的内存更改为1 GB</li><li id="87ae" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lo lp lq lr bi translated">在连接下，选择允许内部流量和来自云负载平衡的流量</li></ul><p id="5fc7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一个屏幕上，选择Python 3.10作为运行时环境，并从下面的GitHub gist urls复制/粘贴代码。(在粘贴代码之前，请不要忘记更改代码中的以下几行)。</p><ul class=""><li id="b395" class="lj lk hi ih b ii ij im in iq ll iu lm iy ln jc lo lp lq lr bi translated">更新第40行的项目id</li><li id="3918" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lo lp lq lr bi translated">更新第44行中的输出时段名称</li><li id="a478" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lo lp lq lr bi translated">在第46和47行中更新CDN主机名或IPv4地址</li><li id="ccad" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lo lp lq lr bi translated">更新第62行中的项目id和发布-订阅3主题名称(如果不同的话)</li></ul><p id="0252" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">main . py—<a class="ae jw" href="https://gist.github.com/nazir-kabani/a436f2e9ca3ed1b1276d0ced14ec88b1" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/nazir-kabani/a 436 f 2e 9 ca 3 ed 1b 1276d 0 ced 14 EC 88 b 1</a></p><p id="2815" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">requirements . txt—<a class="ae jw" href="https://gist.github.com/nazir-kabani/d702849967098aba99cf63d5e7f0833f" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/nazir-kabani/d 702849967098 ABA 99 cf 63d 5 e 7 f 0833 f</a></p><p id="4680" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，单击部署。</p><h1 id="32a3" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">BigQuery (BQ)代码转换完成状态:</h1><p id="d035" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">在前面的步骤中，我们已经创建了一个transcoding_jobs数据集和transcoding-start-status表。现在，我们将在同一数据集下创建一个转码完成状态表。</p><h1 id="e1f8" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">创建转码-完成-状态表:</h1><p id="9230" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">单击数据集(transcoding_job)旁边的三个点，单击创建表格。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ld"><img src="../Images/dbdddc8d1471ba483590c260f7c60742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YCBiMGYseU-uE7uB"/></div></div></figure><p id="c566" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用代码转换-完成-状态作为表名，在schema上，点击edit as text，将GitHub gist中提供的json作为文本，然后点击create table。</p><p id="f8c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jw" href="https://gist.github.com/nazir-kabani/fa072136cf2f8698dca18313d0e0e49f" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/nazir-kabani/fa 072136 cf 2f 8698 DCA 18313d 0 E0 e 49 f</a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/fb0e75cc34c216a057206160242685b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jWc1LfiV_Q6e86wl"/></div></div></figure><h1 id="10ff" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">发布/订阅3到BQ导出:</h1><p id="6976" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">从谷歌云控制台进入发布/订阅-&gt;主题，打开转码-完成-状态。点击EXPORT TO BIGQUERY</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/ef626313805f1395858590c4d267132e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZW6sQvWc0bpLlIOs"/></div></div></figure><p id="3bbe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将看到一个弹出窗口，决定是使用发布/订阅还是使用数据流，选择发布/订阅并单击继续。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es le"><img src="../Images/8fd6de86a9b446862e43a4eaf11b4cb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*92bQkiidiipAHH1j"/></div></div></figure><p id="3be6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一页中，选择您选择的subscription-id，选择transcoding_jobs作为数据集，选择transcoding-complete-status作为表格，<strong class="ih hj">选择use topic schema，选择drop unknown fields </strong>，然后单击create。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lx"><img src="../Images/5a4b0040598e4a5bfbd7e586be3926ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HojrXozpntunstnk"/></div></div></figure><h1 id="0e1e" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">连接表和构建仪表板:</h1><p id="0c72" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">就这样，现在我们完成了所有的集成，现在是时候在两个BQ表之间创建一个连接，并为代码转换作业创建一个单一窗口(在整体架构的下面)。</p><p id="3050" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在开始BQ join之前，我希望你上传大量的短视频(至少4-5个)到你的源存储桶，这样一旦你加入BQ表，它就会显示大量的填充有数据的行。</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/35a778e392c507d555dc15497900ee73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*x6tmLX-Vb1z_2pPE"/></div></div></figure><h1 id="87fe" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">BQ表连接:</h1><p id="61f5" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">从google cloud console，进入BQ，打开任意一个表，点击new选项卡中的查询。</p><p id="0dd9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在更改项目名称、数据集名称和表名称</strong>后运行以下查询(仅当您已经更改了我在博客中使用的名称)。</p><blockquote class="jp jq jr"><p id="729c" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">从“项目名称.代码转换_作业.代码转换-完成-状态”中选择*</p><p id="9378" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">left join ` project-name . transcoding _ jobs . transcoding-start-status ` start</p><p id="becd" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">on start.jobId = complete.jobId</p></blockquote><p id="34a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行该查询后，您将在查询页面下方的BQ表中看到查询结果(类似于下图)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/90d07d6ac0cc162b27b3bdda9f245cc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aWnHenx1R2bEo4Lw"/></div></div></figure><h1 id="2e8a" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">使用Data Studio可视化数据:</h1><p id="f8b1" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">本练习的最后一步是使用Data Studio可视化转码作业的数据。从查询结果上的explore data中，单击explore with Data Studio，它将打开另一个带有Data Studio报告的窗口。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/eb5db2477d93351f668eae8f9f26ce5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Our8Xl8BrOyBxvY9"/></div></div></figure><p id="11b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从这里，你可以使用数据工作室的帮助<a class="ae jw" href="https://support.google.com/datastudio/answer/6292570?hl=en#zippy=%2Cin-this-article" rel="noopener ugc nofollow" target="_blank">https://support.google.com/datastudio/answer/6292570?建立你自己的报告HL = en # zippy = % 2 CIN-this-article</a>或者你可以使用我的模板(<a class="ae jw" href="https://datastudio.google.com/reporting/0a3ec04b-581b-4793-bce4-bd9fa6f14a8d/preview" rel="noopener ugc nofollow" target="_blank">https://data studio . Google . com/reporting/0 a3 EC 04 b-581 b-4793-BCE 4-BD 9 fa 6 f 14 a 8d/preview</a>)来构建你的报告，类似于下面的一个。</p><p id="9017" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如需帮助，请参考帮助中心关于从模板页面创建报告的帮助文章。(【https://support.google.com/datastudio/answer/9851950? T4】HL = en # zippy = % 2c in-this-article</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/9ab998ff0a5760ee1b189bb41ce03f3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iWEEi2POMLvjhOSz"/></div></div></figure><h1 id="1d91" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">庆祝🥳的时间到了</h1><p id="561d" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">希望你一直陪着我，直到旅程结束，为你的OTT平台建立一个视频管道，给自己一个值得的奖励。</p><p id="efa3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请与我分享您的反馈，并建议我应该在下一篇关于GCP媒体云产品的博客中包含哪些内容。</p><p id="8b7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请查看GCP媒体云产品。</p><ol class=""><li id="61d2" class="lj lk hi ih b ii ij im in iq ll iu lm iy ln jc lz lp lq lr bi translated">代码转换器API—<a class="ae jw" href="https://cloud.google.com/transcoder/docs" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/transcoder/docs</a>=</li><li id="95b5" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lz lp lq lr bi translated">直播API—<a class="ae jw" href="https://cloud.google.com/livestream/docs" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/livestream/docs</a></li><li id="e47c" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lz lp lq lr bi translated">视频拼接API—<a class="ae jw" href="https://cloud.google.com/video-stitcher/docs" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/video-stitcher/docs</a></li><li id="ba55" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lz lp lq lr bi translated">媒体CDN—<a class="ae jw" href="https://cloud.google.com/media-cdn" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/media-cdn</a></li></ol><p id="fd74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本博客的参考链接。</p><ol class=""><li id="cfc4" class="lj lk hi ih b ii ij im in iq ll iu lm iy ln jc lz lp lq lr bi translated">本博客系列的第1部分—<a class="ae jw" rel="noopener" href="/google-cloud/automate-your-vod-transcoding-at-scale-with-gcp-part-1-87503fdd3a9f">https://medium . com/Google-cloud/automate-your-VOD-transcode-at-scale-with-GCP-part-1-87503 FDD 3 a9 f</a></li><li id="3184" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lz lp lq lr bi translated">BQ转码-开始-状态表方案—<a class="ae jw" href="https://gist.github.com/nazir-kabani/bea532aa37a0c3ad86205dd83f0f397d" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/nazir-kabani/bea 532 aa 37 a 0 C3 ad 86205 DD 83 f 0 f 397d</a></li><li id="3a12" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lz lp lq lr bi translated">Pub/Sub 3转码-完成-状态-模式—<a class="ae jw" href="https://gist.github.com/nazir-kabani/9b811d1955c0e7803de7550090269092" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/nazir-kabani/9 b 811d 1955 c0e 7803 de 7550090269092</a></li><li id="f9a2" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lz lp lq lr bi translated">云函数2 main . py—<a class="ae jw" href="https://gist.github.com/nazir-kabani/a436f2e9ca3ed1b1276d0ced14ec88b1" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/nazir-kabani/a 436 f 2e 9 ca 3 ed 1 b 1276d 0 ced 14 EC 88 b 1</a></li><li id="69a6" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lz lp lq lr bi translated">云函数2 requirements . txt—<a class="ae jw" href="https://gist.github.com/nazir-kabani/d702849967098aba99cf63d5e7f0833f" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/nazir-kabani/d 702849967098 ABA 99 cf 63 D5 e7f 0833 f</a></li><li id="ad40" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lz lp lq lr bi translated">BQ转码-完成-状态表模式—<a class="ae jw" href="https://gist.github.com/nazir-kabani/fa072136cf2f8698dca18313d0e0e49f" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/nazir-kabani/fa 072136 cf 2f 8698 DCA 18313d 0 E0 e 49 f</a></li></ol></div></div>    
</body>
</html>