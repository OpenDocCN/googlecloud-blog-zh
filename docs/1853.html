<html>
<head>
<title>Real-time Crypto Price Anomaly Detection with Deep Learning and Band Protocol</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于深度学习和Band协议的实时加密价格异常检测</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/technical-indicators-calculation-and-anomaly-detection-on-band-protocol-data-6dbf3b9b92c6?source=collection_archive---------0-----------------------#2021-04-15">https://medium.com/google-cloud/technical-indicators-calculation-and-anomaly-detection-on-band-protocol-data-6dbf3b9b92c6?source=collection_archive---------0-----------------------#2021-04-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5c84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对金融时间序列数据进行即时、准确的分析，对于处于资本市场核心的价格发现机制至关重要。</p><p id="bcb9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">我们将向您展示如何使用机器学习从金融时间序列数据中实时获得洞察力</strong>。特别地，提供了实现用于异常检测的LSTM神经网络的Keras模型。</p><p id="4955" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">我们正在使用的数据来自Google BigQuery </strong>中的 <a class="ae jd" href="https://console.cloud.google.com/marketplace/product/public-data-finance/crypto-band-dataset" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">波段协议公共数据集</strong> </a> <strong class="ih hj">。<a class="ae jd" href="https://bandprotocol.com/" rel="noopener ugc nofollow" target="_blank"> Band Protocol </a>是一个跨链的数据oracle平台，它将真实世界的数据和API聚合并连接到智能合约。<a class="ae jd" href="https://console.cloud.google.com/bigquery?sq=514812189943:ddb21ecda3324764ae185eef010a187d" rel="noopener ugc nofollow" target="_blank">这个示例查询</a>给出了100种货币对的最新和历史美元价格，包括$ETH、$BTC和$BAND。</strong></p><h1 id="3e29" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">分析一目了然</h1><p id="4851" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">整个过程可以分为两部分:</p><p id="3d5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第1部分:使用</strong> <a class="ae jd" href="https://cloud.google.com/dataflow" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">数据流</strong> </a>的度量计算。包括以下度量指标和技术指标:相对强弱指标(<a class="ae jd" href="https://en.wikipedia.org/wiki/Relative_strength_index" rel="noopener ugc nofollow" target="_blank"> RSI </a>)、移动平均线(<a class="ae jd" href="https://en.wikipedia.org/wiki/Moving_average" rel="noopener ugc nofollow" target="_blank"> MA </a>)、开盘价、最高价、最低价、收盘价(<a class="ae jd" href="https://en.wikipedia.org/wiki/Open-high-low-close_chart" rel="noopener ugc nofollow" target="_blank"> OHLC </a>)。</p><p id="98c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第2部分:异常检测。我们正在使用在<a class="ae jd" href="https://keras.io/" rel="noopener ugc nofollow" target="_blank"> Keras </a>中实现的<a class="ae jd" href="https://adventuresinmachinelearning.com/keras-lstm-tutorial/" rel="noopener ugc nofollow" target="_blank"> LSTM </a>模型。</p><p id="3772" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们来看看细节。</p><h1 id="aa92" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">第1部分:度量计算</h1><p id="c3f9" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">从检查源代码库开始:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="8c7f" class="kq jf hi km b fi kr ks l kt ku">git clone <a class="ae jd" href="https://github.com/blockchain-etl/band-dataflow-sample-applications.git" rel="noopener ugc nofollow" target="_blank">https://github.com/blockchain-etl/band-dataflow-sample-applications.git</a><br/>cd band-dataflow-sample-applications<br/>cd timeseries-streaming/timeseries-java-applications</span></pre><p id="2f02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">从历史数据中引导指标</strong></p><p id="4a0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">BandDataBootstrapGenerator管道允许您计算历史oracle请求的指标。数据来源于BigQuery表<code class="du kv kw kx km b"><a class="ae jd" href="https://console.cloud.google.com/bigquery?p=public-data-finance&amp;d=crypto_band&amp;t=oracle_requests&amp;page=table" rel="noopener ugc nofollow" target="_blank"><em class="ky">public-data-finance.crypto_band.oracle_requests</em></a></code> <em class="ky">。</em></p><p id="0f95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">初始化变量:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="fe35" class="kq jf hi km b fi kr ks l kt ku"><em class="ky">PROJECT=$(gcloud config get-value project 2&gt; /dev/null)    <br/># Make sure to update the date to yesterday's date<br/>TIMESTAMP_THRESHOLD="2020-10-01T07:00:00.0Z" <br/>DATASET_NAME=crypto_band<br/>TABLE_NAME=metrics<br/>TEMP_BUCKET=&lt;replace_with_your_temporary_bucket&gt;</em></span></pre><p id="763b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建大查询数据集:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="74bf" class="kq jf hi km b fi kr ks l kt ku">bq --location=US mk --dataset $DATASET_NAME </span></pre><p id="58aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行管道:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="dc19" class="kq jf hi km b fi kr ks l kt ku">./gradlew generate_band_bootstrap_data --args="\<br/>    --bigQueryTableForTSAccumOutputLocation=$PROJECT:$DATASET_NAME.$TABLE_NAME \<br/>    --timestampThreshold="$TIMESTAMP_THRESHOLD" \<br/>    --runner=DataflowRunner \<br/>    --tempLocation=gs://$TEMP_BUCKET/temp \<br/>    --maxNumWorkers=1 \<br/>    --region=us-central1 \<br/>"</span></pre><p id="d8fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">管道将被部署到数据流，根据历史数据的数量，需要30到60分钟。</p><figure class="kh ki kj kk fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kz"><img src="../Images/51c45babb4aa71aec47944344b45ec2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MbseOTBbW1vmFUMr5U1aCA.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">“引导度量”数据流管道</figcaption></figure><p id="e32a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，管道对OHLC使用10分钟的聚合窗口，对移动平均和RSI计算使用60分钟的滚动窗口。您可以分别使用<code class="du kv kw kx km b">--typeOneComputationsLengthInSecs</code>和<code class="du kv kw kx km b">--typeTwoComputationsLengthInSecs</code>自定义参数。</p><p id="5be0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以在我们之前设置的公共表<code class="du kv kw kx km b">band-etl.crypto_band.metrics</code>中观察结果:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="83d5" class="kq jf hi km b fi kr ks l kt ku">SELECT * <br/>FROM `band-etl.crypto_band.metrics` <br/>--WHERE timeseries_key = 'ETH'<br/>ORDER BY lower_window_boundary DESC<br/>LIMIT 1000</span></pre><figure class="kh ki kj kk fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es ll"><img src="../Images/be74ce0dd926981017229ed214e33427.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OjPTD2RV4IxwUysKaDPtlQ.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">BigQuery控制台中的band-etl.crypto_band.metrics表</figcaption></figure><p id="5ced" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以查询前一天的$ETH的RSI:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="1452" class="kq jf hi km b fi kr ks l kt ku">SELECT upper_window_boundary as time, data.dbl_data as RSI <br/>FROM `band-etl.crypto_band.metrics` <br/>CROSS JOIN UNNEST(data) AS data<br/>WHERE timeseries_key = 'ETH'<br/>  AND data.metric = 'RELATIVE_STRENGTH_INDICATOR'<br/>ORDER BY lower_window_boundary DESC<br/>LIMIT 144</span></pre><p id="7689" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并直接从BigQuery控制台在<a class="ae jd" href="http://datastudio.google.com" rel="noopener ugc nofollow" target="_blank"> Data Studio </a>中将其可视化:</p><figure class="kh ki kj kk fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lm"><img src="../Images/5058859fafc901c7517814080b4cb988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDeyrloJFeRR3qZsB2BW-A.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">以太坊相对强度指数(RSI)</figcaption></figure><p id="380a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">从发布/订阅流计算指标</strong></p><p id="0c65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://github.com/blockchain-etl/band-dataflow-sample-applications/blob/master/timeseries-streaming/timeseries-java-applications/BandExamples/src/main/java/io/blockchainetl/band/examples/simpledata/transforms/BandDataStreamGenerator.java" rel="noopener ugc nofollow" target="_blank">BandDataStreamGenerator</a>管道允许您计算从发布/订阅订阅<code class="du kv kw kx km b">projects/public-data-finance/topics/crypto_band.oracle_requests</code>中提取的oracle请求的指标。它会将结果输出到指定的BigQuery表和指定的发布/订阅主题。</p><p id="297e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为波段协议oracle请求创建发布/订阅:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="d0ad" class="kq jf hi km b fi kr ks l kt ku">gcloud pubsub subscriptions create crypto_band.oracle_requests.metrics \<br/>    --topic=crypto_band.oracle_requests \<br/>    --topic-project=public-data-finance</span></pre><p id="f27d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">初始化变量:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="fdb2" class="kq jf hi km b fi kr ks l kt ku"><em class="ky">PROJECT=$(gcloud config get-value project 2&gt; /dev/null)    <br/># Make sure to update the date to yesterday's date<br/>TIMESTAMP_THRESHOLD="2020-10-01T07:00:00.0Z" <br/>DATASET_NAME=crypto_band<br/>TABLE_NAME=metrics<br/>TEMP_BUCKET=&lt;replace_with_your_temporary_bucket&gt;<br/></em>TOPIC_NAME=crypto_band.metrics</span></pre><p id="3c5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在数据流中启动管道:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="daf7" class="kq jf hi km b fi kr ks l kt ku">./gradlew run_band_example --args="\<br/>    --pubSubSubscriptionForOracleRequests=projects/$PROJECT/subscriptions/crypto_band.oracle_requests.metrics \<br/>    --bigQueryTableForTSAccumOutputLocation=$PROJECT:$DATASET_NAME.$TABLE_NAME \<br/>    --timestampThreshold="$TIMESTAMP_THRESHOLD" \<br/>    --pubSubTopicForTSAccumOutputLocation=projects/$PROJECT/topics/$TOPIC_NAME \<br/>    --runner=DataflowRunner \<br/>    --maxNumWorkers=1 \<br/>    --workerMachineType=n1-standard-1 \<br/>    --diskSizeGb=30 \<br/>    --region=us-central1 \<br/>"</span></pre><p id="91ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出将被传输到指定的BigQuery表和发布/订阅主题。</p><h1 id="2f3b" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">第2部分:异常检测</h1><p id="5c37" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">下面提供的示例旨在探索处理频段协议数据所需的数据工程，并将其交付给<a class="ae jd" href="https://en.wikipedia.org/wiki/Autoencoder#Anomaly_Detection" rel="noopener ugc nofollow" target="_blank">自动编码器—解码器</a>。</p><p id="d2fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第2部分可以分为三个步骤:</p><ol class=""><li id="6504" class="ln lo hi ih b ii ij im in iq lp iu lq iy lr jc ls lt lu lv bi translated">正在生成TF。训练模型的示例。</li><li id="f138" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">根据训练数据训练LSTM模型。</li><li id="7db7" class="ln lo hi ih b ii lw im lx iq ly iu lz iy ma jc ls lt lu lv bi translated">批量异常检测。</li></ol><p id="c142" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">生成TF。带协议数据的示例</strong></p><p id="2289" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了构建模型，您需要首先运行生成器作业<br/><a class="ae jd" href="https://github.com/blockchain-etl/band-dataflow-sample-applications/blob/master/timeseries-streaming/timeseries-java-applications/BandExamples/src/main/java/io/blockchainetl/band/examples/simpledata/transforms/BandDataBootstrapGenerator.java" rel="noopener ugc nofollow" target="_blank">BandDataBootstrapGenerator.java</a>，它将创建训练数据作为TF。示例:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="d681" class="kq jf hi km b fi kr ks l kt ku"><em class="ky">git clone https://github.com/blockchain-etl/band-dataflow-sample-applications.git<br/>cd dataflow-sample-applications/timeseries-streaming/timeseries-java-applications</em></span></pre><p id="5219" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行数据流作业(确保用您的值替换<code class="du kv kw kx km b">&lt;your_temp_bucket&gt;</code>，并更新<code class="du kv kw kx km b">TIMESTAMP_THRESHOLD</code>变量):</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="16b2" class="kq jf hi km b fi kr ks l kt ku">TIMESTAMP_THRESHOLD="2020-10-03T00:00:00.0Z"<br/>BUCKET=&lt;your_temp_bucket&gt;<br/>./gradlew generate_band_bootstrap_data --args="\<br/>    --interchangeLocation=gs://$BUCKET/band_bootstrap_tfexamples/run0 \<br/>    --timestampThreshold="$TIMESTAMP_THRESHOLD" \<br/>    --runner=DataflowRunner \<br/>    --tempLocation=gs://$BUCKET/temp \<br/>    --maxNumWorkers=1 \<br/>    --region=us-central1 \<br/>"</span></pre><p id="592d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦工作完成，从<code class="du kv kw kx km b">gs://$BUCKET/band_bootstrap_tfexamples/run0</code>下载生成的文件，<br/>修改<a class="ae jd" href="https://github.com/blockchain-etl/band-dataflow-sample-applications/blob/master/timeseries-streaming/timeseries-python-applications/MLPipelineExamples/test_pipelines/config.py" rel="noopener ugc nofollow" target="_blank"> config.py </a>中的信息以匹配您的本地环境。</p><p id="4f00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">训练模型</strong></p><p id="24e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置虚拟环境:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="1bec" class="kq jf hi km b fi kr ks l kt ku">virtualenv -p python3.7 streaming-tf-consumer<br/>source streaming-tf-consumer/bin/activate</span></pre><p id="4ce9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装依赖项:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="bf51" class="kq jf hi km b fi kr ks l kt ku">git clone <a class="ae jd" href="https://github.com/blockchain-etl/band-dataflow-sample-applications.git" rel="noopener ugc nofollow" target="_blank">https://github.com/blockchain-etl/band-dataflow-sample-applications.git</a><br/>cd dataflow-sample-applications/timeseries-streaming/timeseries-python-applications<br/>cd MLPipeline<br/>pip install -e .<br/>cd ..<br/>ls</span></pre><p id="5751" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在激活虚拟环境的情况下运行命令:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="d7dd" class="kq jf hi km b fi kr ks l kt ku">python MLPipelineExamples/test_pipelines/timeseries_local_simple_data.py</span></pre><p id="4f15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该会看到如下的模型建筑:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="4f75" class="kq jf hi km b fi kr ks l kt ku">....<br/>Epoch 26/30<br/>280/280 [==============================] - 6s 21ms/step - loss: 119.8072 - mean_absolute_error: 6.8178 - val_loss: 684588.3750 - val_mean_absolute_error: 670.2068<br/>Epoch 27/30<br/>280/280 [==============================] - 7s 23ms/step - loss: 119.6002 - mean_absolute_error: 6.8087 - val_loss: 203.5257 - val_mean_absolute_error: 8.6160<br/>Epoch 28/30<br/>280/280 [==============================] - 6s 20ms/step - loss: 119.5842 - mean_absolute_error: 6.8084 - val_loss: 41512.6406 - val_mean_absolute_error: 160.1564<br/>Epoch 29/30<br/>280/280 [==============================] - 6s 20ms/step - loss: 119.5832 - mean_absolute_error: 6.8084 - val_loss: 5213.2568 - val_mean_absolute_error: 58.4286<br/>Epoch 30/30<br/>280/280 [==============================] - 5s 19ms/step - loss: 119.5791 - mean_absolute_error: 6.8083 - val_loss: 24351.4551 - val_mean_absolute_error: 151.2784</span></pre><p id="c06f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将在config.py文件中您为<code class="du kv kw kx km b">PIPELINE_ROOT</code>指定的位置下输出一个serving_model_dir。<br/>现在，您可以按照选项1中概述的其余步骤，但使用您自己的模型。</p><p id="21bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">批量推断</strong></p><p id="322e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<a class="ae jd" href="https://github.com/blockchain-etl/band-dataflow-sample-applications/blob/master/timeseries-streaming/timeseries-python-applications/MLPipelineExamples/test_pipelines/batch_inference.py" rel="noopener ugc nofollow" target="_blank"> batch_inference.py </a>中定义的流水线读取给定的TF。示例和保存的模型，<br/>运行推理以获得预测值，将该值与实际值进行比较，如果差值大于阈值<br/>，则将该值报告为异常。</p><p id="b38f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在激活virtual-env的情况下运行命令，使用在上一步中构建的模型提供<br/><code class="du kv kw kx km b">--saved_model_location</code>的位置值，以及使用<code class="du kv kw kx km b">--tfrecord_folder:</code>从GCS bucket下载的生成数据的位置值</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="2493" class="kq jf hi km b fi kr ks l kt ku"><em class="ky">python MLPipelineExamples/test_pipelines/batch_inference.py \<br/>--saved_model_location=./build/Trainer/model/5/serving_model_dir \<br/>--tfrecord_folder=/&lt;your-directory&gt;/data/*</em></span></pre><p id="50aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将看到检测到异常值的消息:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="4203" class="kq jf hi km b fi kr ks l kt ku"><em class="ky">...<br/>Outlier detected for ETH-value-LAST at 2020-08-23 21:20:00 - 2020-08-23 22:20:00 Difference was 279.74764251708984 for value input 388.8900146484375 output 109.14237213134766 with raw data [388.8900146484375]<br/>Outlier detected for ETH-value-FIRST at 2020-08-22 14:20:00 - 2020-08-22 15:20:00 Difference was 310.73509216308594 for value input 392.1044921875 output 81.36940002441406 with raw data [392.1044921875]<br/>Outlier detected for ETH-value-LAST at 2020-08-22 14:20:00 - 2020-08-22 15:20:00 Difference was 308.1451416015625 for value input 392.1044921875 output 83.9593505859375 with raw data [392.1044921875]</em></span></pre><p id="a50c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注1: </strong>本样本旨在展示支持从流束管道生成并交付给LSTM自动编码器-解码器的数据所需的数据工程工作。它并不打算展示异常检测的最新机器学习方法，还需要做更多的工作来优化模型以获得更好的性能。</p><p id="049e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注2: </strong>这里使用的LSTM是预先训练和部署的，而不是在线学习的。将这个示例扩展为小批量在线学习留给读者作为练习。</p><h2 id="a860" class="kq jf hi bd jg mb mc md jk me mf mg jo iq mh mi js iu mj mk jw iy ml mm ka mn bi translated">参考</h2><p id="b671" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">本文基于Reza Rokni的工作。有关数据流中时间序列数据处理的更多示例，请参考以下知识库:</p><p id="71cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://github.com/GoogleCloudPlatform/dataflow-sample-applications/tree/master/timeseries-streaming" rel="noopener ugc nofollow" target="_blank">https://github . com/Google cloud platform/data flow-sample-applications/tree/master/time series-streaming</a>。</p></div></div>    
</body>
</html>