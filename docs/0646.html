<html>
<head>
<title>How to use Google Cloud Platform with your favorite Machine Learning Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将谷歌云平台与自己喜欢的机器学习框架结合使用</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-use-google-cloud-platform-with-your-favorite-machine-learning-framework-ca59f1e81aee?source=collection_archive---------2-----------------------#2018-06-13">https://medium.com/google-cloud/how-to-use-google-cloud-platform-with-your-favorite-machine-learning-framework-ca59f1e81aee?source=collection_archive---------2-----------------------#2018-06-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="11bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还记得你的算法需要几个小时才能完成的时候吗？如果你需要运行它10 (100？)倍！在这种情况下，可能值得考虑扩大规模，谷歌云平台有很多选项可以让你运行你最喜欢的机器学习框架/算法。</p><p id="41a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在一个典型的ML管道中，有(至少)三个关键步骤。</p><ol class=""><li id="1f8b" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">你<strong class="ih hj">训练</strong>一个模型来优化你的目标函数(某种损失/误差函数)。</li><li id="3471" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">然后，您可能想要探索不同的模型配置(例如，模型的类型、层数)，看看哪一个效果最好:这是<strong class="ih hj">超参数调整</strong>部分。</li><li id="ef7e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">最后，一旦您找到了最佳配置并对结果感到满意，您就想公开您的模型以使其可用于运行预测。<strong class="ih hj">将您的模型</strong>部署为API是将其公开给生产应用程序的好方法，因为该接口为开发人员所熟知并普遍使用。</li></ol><p id="975e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本帖中，我们将回顾这些步骤，并将重点放在一些常见的框架上:</p><ul class=""><li id="a610" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc jr jj jk jl bi translated"><strong class="ih hj"> TensorFlow </strong> : Google开源库，多用于深度学习应用，扩展性高。</li><li id="8892" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated"><strong class="ih hj"> Scikit-learn </strong>:机器学习库，当数据适合内存时，主要用于非神经网络应用。</li><li id="9e35" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated"><strong class="ih hj"> XGBoost </strong>:实现一个模型(极端增强渐变)的库，流行于具有高可伸缩性的结构化数据。</li><li id="6994" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated"><strong class="ih hj"> H2O </strong>:机器学习库，多用于非神经网络应用，扩展性高。</li></ul><p id="5137" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">这篇文章旨在给出一些最佳实践的指南，并不作为解释每个过程的每一步的教程。</strong>但是，相关教程的链接会在可用时提供。</p><p id="779d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Cloud ML Engine是运行TensorFlow库的一个很棒的工具，在产品<a class="ae js" href="https://cloud.google.com/ml-engine/docs/tensorflow/technical-overview" rel="noopener ugc nofollow" target="_blank">网站</a>上有很好的文档记录。因此，这篇文章将关注其他三个库:Scikit-learn、XGBoost和H2O。</p><h1 id="f6c0" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">培养</h1><p id="2f85" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">在云上训练模型提供了两个主要优势:水平扩展和访问更高端的加速器，如GPU和TPU。</p><h2 id="17fa" class="kw ju hi bd jv kx ky kz jz la lb lc kd iq ld le kh iu lf lg kl iy lh li kp lj bi translated">GCE上的缩放</h2><p id="d04e" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">谷歌计算引擎(GCEs)或托管Jupyter笔记本电脑(如Kaggle内核或Datalab)上的训练模型是扩展的简单方法。简单地旋转一个实例，然后像在本地一样训练一个模型！</p><p id="cf5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种方法的优点是:</p><ul class=""><li id="32af" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc jr jj jk jl bi translated"><strong class="ih hj">垂直缩放</strong>通过使用任意强大的GCE实例(不需要修改代码)。</li><li id="348f" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated"><strong class="ih hj">通过使用启用GPU的GCE实例进行GPU加速</strong>(scikit-learn无法实现，但<a class="ae js" href="http://xgboost.readthedocs.io/en/latest/gpu/" rel="noopener ugc nofollow" target="_blank"> xgboost </a>和<a class="ae js" href="http://docs.h2o.ai/driverless-ai/latest-stable/docs/userguide/install/google-compute.html" rel="noopener ugc nofollow" target="_blank"> h2o </a>支持)。</li><li id="3790" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated"><strong class="ih hj">在底层库启用时使用多核进行水平扩展</strong><em class="lk">(感兴趣的水平扩展参数:scikit learn中的一些模型有参数</em><a class="ae js" href="http://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html%5C" rel="noopener ugc nofollow" target="_blank"><em class="lk">【n _ jobs】</em></a><em class="lk">，Xgboost有参数</em><a class="ae js" href="https://machinelearningmastery.com/best-tune-multithreading-support-xgboost-python/" rel="noopener ugc nofollow" target="_blank"><em class="lk">【n threads】</em></a><em class="lk">，它将处理多线程，而h2o.init()将自动检测内核数量)。</em></li></ul><h2 id="9142" class="kw ju hi bd jv kx ky kz jz la lb lc kd iq ld le kh iu lf lg kl iy lh li kp lj bi translated">通过Dataproc对Spark进行缩放</h2><p id="9d79" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">H2O和XGBoost可以在Spark上运行，因此可以使用Dataproc在多个workers上扩展Spark。Scikit-learn还有一个<a class="ae js" href="https://github.com/databricks/spark-sklearn" rel="noopener ugc nofollow" target="_blank"> Spark版本</a>，你可以利用它。虽然通过Dataproc在Spark上进行缩放允许您使用更大的数据集，并提供更好的水平缩放，但它确实需要更多的时间来设置。</p><h1 id="8962" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">超参数调谐</h1><p id="7374" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">在云中执行超参数调优为您提供了水平扩展的优势。有几种潜在的方法可以做到这一点。</p><p id="12b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您使用GCE来训练单个模型，您可以继续使用此训练环境来进行hyper参数调整，但是您的水平缩放将受限于您的机器的核心数量。</p><p id="7468" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您已经通过Dataproc使用Spark来训练单个模型，一个自然的想法是继续使用相同的环境。所有的ML库都包含一些函数，可以进行一些网格搜索探索，为您处理缩放，所以不需要额外的设置。</p><p id="c73c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">TPOT也是一种调整你的模型的便捷方式。它与scikit-learn非常相似，可以帮助您对最佳模型进行基准测试。它会搜索模型和参数的最佳组合，从您的解决方案中挤出一两个百分点！通过使用n_jobs参数，您可以在一个GCE实例上扩展这个搜索。</p><h1 id="44de" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">模型部署</h1><p id="88a6" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">在部署方面，云ML引擎可以为您节省大量时间。您不必考虑使用正确的组件(例如负载平衡、版本控制)来构建基础设施，只需几步就可以将您训练过的scikit-learn和XGBoost模型部署为API(<a class="ae js" href="https://cloud.google.com/blog/big-data/2018/04/serving-real-time-scikit-learn-and-xgboost-predictions" rel="noopener ugc nofollow" target="_blank">示例</a>，参见下面的更多链接)。</p><p id="52f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于H2O，仍然没有现成的解决方案，因此需要使用Flask(仅用于开发)/App Engine/Google Cloud端点来完成一些工作。一些例子可以在<a class="ae js" href="https://www.analyticsvidhya.com/blog/2017/09/machine-learning-models-as-apis-using-flask/" rel="noopener ugc nofollow" target="_blank">这里</a>(第六部分)或者<a class="ae js" href="https://github.com/GoogleCloudPlatform/ml-on-gcp/tree/master/sklearn/gae_serve" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="e057" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">每个框架的摘要</h1><p id="7684" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated"><strong class="ih hj">云ML引擎流量</strong></p><ul class=""><li id="ca99" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc jr jj jk jl bi translated">训练:<a class="ae js" href="https://cloud.google.com/ml-engine/docs/tensorflow/training-overview" rel="noopener ugc nofollow" target="_blank"> Cloud MLE </a>通过使用加速器(GPU)和集群(多工)来加速你的模型。</li><li id="91a9" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated">超级参数:<a class="ae js" href="https://cloud.google.com/ml-engine/docs/tensorflow/hyperparameter-tuning-overview" rel="noopener ugc nofollow" target="_blank">云MLE </a>让你用贝叶斯优化调整你的参数。</li><li id="c614" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated">部署:<a class="ae js" href="https://cloud.google.com/ml-engine/docs/tensorflow/prediction-overview" rel="noopener ugc nofollow" target="_blank">云MLE </a>将您的模型部署为API。</li></ul><p id="4e43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Scikit-learn </strong></p><ul class=""><li id="4c1b" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc jr jj jk jl bi translated">训练:您可以在GCE上训练您的模型并缩放实例。缩放将取决于模型本身，特别是是否有参数<em class="lk"> n_jobs </em> ( <a class="ae js" href="http://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html%5C" rel="noopener ugc nofollow" target="_blank">示例</a>)。</li><li id="2285" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated">Hyper参数:GCE(例如GridSearch函数中的n_jobs)。您还可以通过使用Spark库<a class="ae js" href="https://databricks.com/blog/2016/02/08/auto-scaling-scikit-learn-with-apache-spark.html" rel="noopener ugc nofollow" target="_blank"> spark sklearn </a>在Dataproc上进行缩放。</li><li id="868f" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated">部署:<a class="ae js" href="https://cloud.google.com/ml-engine/docs/scikit/getting-predictions" rel="noopener ugc nofollow" target="_blank">云MLE </a>将您的模型部署为API(示例在<a class="ae js" href="https://github.com/GoogleCloudPlatform/cloudml-samples/blob/master/sklearn/notebooks/Online%20Prediction%20with%20scikit-learn.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>中)。</li></ul><p id="fe15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> XGBoost </strong></p><ul class=""><li id="c8b0" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc jr jj jk jl bi translated">训练:你可以在GCE上训练你的模型，使用参数<em class="lk"> n_threads </em>进行缩放。您也可以使用<a class="ae js" href="https://docs.databricks.com/user-guide/faq/xgboost.html" rel="noopener ugc nofollow" target="_blank"> Spark版本</a>并在Dataproc上训练您的模型。</li><li id="4e73" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated">Hyper parameter:缩放由内置的xgboost gridsearch处理。</li><li id="cbcc" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated">部署:<a class="ae js" href="https://cloud.google.com/blog/big-data/2018/04/serving-real-time-scikit-learn-and-xgboost-predictions" rel="noopener ugc nofollow" target="_blank">云MLE </a>将您的模型部署为API(示例在<a class="ae js" href="https://github.com/GoogleCloudPlatform/cloudml-samples/blob/master/sklearn/notebooks/Online%20Prediction%20with%20scikit-learn.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>中)。</li></ul><p id="48e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> H2O </strong></p><ul class=""><li id="b679" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc jr jj jk jl bi translated">训练:你可以在<a class="ae js" href="http://docs.h2o.ai/driverless-ai/latest-stable/docs/userguide/install/google-compute.html" rel="noopener ugc nofollow" target="_blank"> GCE </a>上训练你的模型，并缩放实例。您也可以使用<a class="ae js" href="https://github.com/h2oai/sparkling-water" rel="noopener ugc nofollow" target="_blank"> Spark版本</a>并在Dataproc上训练您的模型。对于R用户，你可以在GCP 上启动<a class="ae js" href="https://console.cloud.google.com/launcher/details/rstudio-launcher-public/rstudio-server-pro-for-gcp" rel="noopener ugc nofollow" target="_blank"> R-Studio并使用合适的</a><a class="ae js" href="https://www.h2o.ai/h2o-old/h2o-on-r/" rel="noopener ugc nofollow" target="_blank"> h2o包</a>。</li><li id="d2be" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated">超级参数:缩放由内置的h2o网格搜索处理。</li><li id="280f" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated">部署:您可以使用Flask/App Engine/Cloud Endpoints等工具来进行部署(一些示例可以在这里的<a class="ae js" href="https://www.analyticsvidhya.com/blog/2017/09/machine-learning-models-as-apis-using-flask/" rel="noopener ugc nofollow" target="_blank">和这里</a>的<a class="ae js" href="https://github.com/GoogleCloudPlatform/ml-on-gcp/tree/master/sklearn/gae_serve" rel="noopener ugc nofollow" target="_blank">中找到)</a></li></ul><p id="c221" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">词汇:</strong></p><ul class=""><li id="2aea" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc jr jj jk jl bi translated"><a class="ae js" href="https://cloud.google.com/compute/" rel="noopener ugc nofollow" target="_blank">谷歌计算引擎</a> (GCE):谷歌云上的可扩展虚拟机。</li><li id="c295" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated"><a class="ae js" href="https://cloud.google.com/ml-engine/docs/tensorflow/technical-overview" rel="noopener ugc nofollow" target="_blank">云机器学习引擎</a> (Cloud MLE):面向机器学习应用的Google Cloud托管基础设施。</li><li id="5252" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated"><a class="ae js" href="https://cloud.google.com/dataproc/" rel="noopener ugc nofollow" target="_blank"> Dataproc </a>:在Google Cloud上运行Apache Spark或Hadoop的托管服务。</li></ul><p id="50e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这篇文章能帮助你澄清不同的选择！还有，如果你有其他想法，请在评论里分享！</p><p id="938f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您的阅读！</p></div></div>    
</body>
</html>