<html>
<head>
<title>GCP: Monitor IAM role assignments via Log Alerts in GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GCP:通过GCP的日志预警监控IAM职责分配</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/audit-iam-role-assignments-in-gcp-through-log-alerts-3bcdf3d7a504?source=collection_archive---------0-----------------------#2022-07-07">https://medium.com/google-cloud/audit-iam-role-assignments-in-gcp-through-log-alerts-3bcdf3d7a504?source=collection_archive---------0-----------------------#2022-07-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="84fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GCP IAM使组织和项目管理员能够管理基于角色的用户对特定资源的访问。通常，使用谷歌云的企业希望对授予个人用户、组或服务帐户的角色和权限实施严格控制。企业可能希望实施最佳实践，只向用户组而不是单个用户或服务帐户授予角色。</p><p id="97a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将介绍通过云<strong class="ih hj">日志警报</strong>监控GCP云组织内IAM角色访问的方法。作为一个用例示例，让我们考虑一个当角色被直接分配给用户而不是用户组时如何配置日志警报的示例。</p><p id="f5b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第一步:</strong></p><p id="fe75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在“GCP日志记录”页面中，让我们根据审核日志进行筛选，以查看GCP资源上发生的所有更改。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b44f00f2f0055fe5cb4400e8d7967ac9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*O9KOpv_mk_o-5nBD.png"/></div></div></figure><p id="4813" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第二步:</strong></p><p id="45d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">细化日志过滤器，以过滤审计日志并提取与IAM策略和角色分配相关的日志。</p><p id="0573" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">logName =(" projects/<project_id>/logs/cloud audit . Google APIs . com % 2 factivity ")和proto payload . method name = " SetIamPolicy "</project_id></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/da78b42a8fd3668ace79b2c40ae98444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GK6FwoPvTnFVt3Yj.png"/></div></div></figure><p id="bf6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">IAM职责分配的GCP审计日志</p><p id="2d05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第三步:</strong></p><p id="7708" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">细化日志过滤器，以在“用户已被分配角色”时过滤IAM角色分配的审计日志</p><p id="0149" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">logName =(" projects/&lt;<project_id>&gt;/logs/cloud audit . Google APIs . com % 2 factivity ")和proto payload . method name = " setiam policy "和(proto payload . service data . policy delta . binding deltas . member:" user:")</project_id></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/71805c310d5d2f4ba854d627ffdf40b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AGCgbL5C1eijF0BU.png"/></div></div></figure><p id="c841" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将角色分配给用户时的GCP审核日志</p><p id="0c4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第四步:</strong></p><p id="6fdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基于日志事件创建日志警报。使用此配置，只要将IAM策略分配给用户，就会在指定的通知通道上触发警报。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jp"><img src="../Images/7e3c34e9c358d3a09777df20d3a32bc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DjL2WFNQzFI5Xhrs.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/adf37729bc2de73b0be46d38f2352179.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pizFU9s0LgyAFhw6"/></div></div></figure><h1 id="289f" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结论</h1><p id="fae3" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">我们展示了如何在GCP中创建日志警报来跟踪特定的IAM角色分配。您可以利用此功能在不推荐的情况下(如直接向用户分配角色)或在向服务帐户分配角色时获得自动警报。</p></div></div>    
</body>
</html>