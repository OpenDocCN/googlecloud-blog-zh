<html>
<head>
<title>Error handling with Apache Beam : presentation of Asgarde</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Apache Beam的错误处理:Asgarde演示</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/error-handling-with-apache-beam-presentation-of-asgarde-ce5e5dfb2d74?source=collection_archive---------0-----------------------#2022-01-20">https://medium.com/google-cloud/error-handling-with-apache-beam-presentation-of-asgarde-ce5e5dfb2d74?source=collection_archive---------0-----------------------#2022-01-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/4829188ea3caceaed2ce4b4d660ee564.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*UaYsSQe6ObFbiSwswpAjKw.gif"/></div></figure><h1 id="7ba4" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">波束ParDo和DoFn的误差逻辑</h1><p id="8f9a" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">Beam建议用死信来处理错误。这意味着捕捉流程中的错误，并使用辅助输出，将错误收集到文件、数据库或任何其他输出中…</p><p id="46fb" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">Beam建议用<code class="du kn ko kp kq b">DoFn</code>类中的<code class="du kn ko kp kq b">TupleTags</code>处理侧输出，例如:</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="kv kw l"/></div></figure><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="c530" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">使用这种方法，我们可以在所有步骤中获得输出和失败结果集合。</p><h1 id="3140" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">波束映射元素和平面映射元素的错误逻辑</h1><p id="0740" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">Beam还允许通过内置组件处理错误，如<code class="du kn ko kp kq b">MapElements</code>和<code class="du kn ko kp kq b">FlatMapElements</code>(目前这是一个截至2020年4月的实验性功能)。</p><p id="8045" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">在幕后，在这些类中，Beam使用了上面解释的相同概念。</p><p id="ba73" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">示例:</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="489d" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">对于FlatMapElements，逻辑是相同的:</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="kv kw l"/></div></figure><h1 id="41f4" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">方法之间的比较</h1><h1 id="7939" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">普通光束管道</h1><p id="b9a1" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在通常的束流水线流程中，步骤被流畅地链接:</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="kv kw l"/></div></figure><h1 id="fe3a" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">具有错误处理的普通波束流水线</h1><p id="55f5" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">以下是每个步骤中错误处理的相同流程:</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="e8ec" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">这种方法的问题:</p><ul class=""><li id="9030" class="kx ky hi jm b jn ki jr kj jv kz jz la kd lb kh lc ld le lf bi translated">我们在应用链上失去了原有的流畅风格，因为我们必须处理每一步的输出和错误。</li><li id="3e54" class="kx ky hi jm b jn lg jr lh jv li jz lj kd lk kh lc ld le lf bi translated">对于<code class="du kn ko kp kq b">MapElements</code>和<code class="du kn ko kp kq b">FlatMapElements</code>我们总是要加上<code class="du kn ko kp kq b">exceptionsInto</code>和<code class="du kn ko kp kq b">exceptionsVia</code>(可以集中)。</li><li id="93c0" class="kx ky hi jm b jn lg jr lh jv li jz lj kd lk kh lc ld le lf bi translated">对于每个定制的DoFn，我们必须复制<code class="du kn ko kp kq b">TupleTag</code>逻辑和try catch块的代码(可以是集中式的)。</li><li id="de39" class="kx ky hi jm b jn lg jr lh jv li jz lj kd lk kh lc ld le lf bi translated">代码很冗长。</li><li id="d24a" class="kx ky hi jm b jn lg jr lh jv li jz lj kd lk kh lc ld le lf bi translated">没有集中的代码把所有的错误串联起来，我们要把所有的失败串联起来(可以集中)。</li></ul><p id="8908" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">我们开发了一个名为<code class="du kn ko kp kq b">Asgarde</code>的库，它允许在Beam管道中进行错误处理，代码不那么冗长，表达性代码更加简洁&amp;。</p><h1 id="5032" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">使用Asgarde进行错误处理的普通射束管道</h1><p id="727b" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">下面是错误处理的相同流程，但是使用了这个库:</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="5e67" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">一些解释:</p><ul class=""><li id="b9d5" class="kx ky hi jm b jn ki jr kj jv kz jz la kd lb kh lc ld le lf bi translated"><code class="du kn ko kp kq b">CollectionComposer</code>类允许集中所有的错误逻辑，流畅地组合应用并连接流中发生的所有故障。</li><li id="3489" class="kx ky hi jm b jn lg jr lh jv li jz lj kd lk kh lc ld le lf bi translated">对于<code class="du kn ko kp kq b">MapElements</code>和<code class="du kn ko kp kq b">FlatMapElements</code>，在场景后面，<code class="du kn ko kp kq b">apply</code>方法在<code class="du kn ko kp kq b">Failure</code>对象上添加<code class="du kn ko kp kq b">exceptionsInto</code>和<code class="du kn ko kp kq b">exceptionsVia</code>。如果需要，如果你有一些基于<code class="du kn ko kp kq b">Failure</code>对象的自定义逻辑，我们也可以显式地使用<code class="du kn ko kp kq b">exceptionsInto</code>和<code class="du kn ko kp kq b">exceptionsVia</code>。</li><li id="c66e" class="kx ky hi jm b jn lg jr lh jv li jz lj kd lk kh lc ld le lf bi translated"><code class="du kn ko kp kq b">MapElementFn</code>类是一个定制的<code class="du kn ko kp kq b">DoFn</code>类，在内部封装了<code class="du kn ko kp kq b">DoFn</code>的共享逻辑，比如try/catch块和Tuple标签。我们将在下一节中详细介绍概念。</li></ul><h1 id="7999" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">图书馆的目的</h1><ul class=""><li id="7f62" class="kx ky hi jm b jn jo jr js jv ll jz lm kd ln kh lc ld le lf bi translated">将所有错误处理逻辑包装在一个composer类中。</li><li id="db97" class="kx ky hi jm b jn lg jr lh jv li jz lj kd lk kh lc ld le lf bi translated">将<code class="du kn ko kp kq b">exceptionsInto</code>和<code class="du kn ko kp kq b">exceptionsVia</code>用在原生光束类<code class="du kn ko kp kq b">MapElements</code>和<code class="du kn ko kp kq b">FlatMapElements</code>中。</li><li id="b21b" class="kx ky hi jm b jn lg jr lh jv li jz lj kd lk kh lc ld le lf bi translated">在检查故障时，保持Beam在<code class="du kn ko kp kq b">apply</code>方法中提出的流畅风格，并提供一种不太冗长的错误处理方式。</li><li id="332f" class="kx ky hi jm b jn lg jr lh jv li jz lj kd lk kh lc ld le lf bi translated">用集中的try/catch块(loan模式)和Tuple标签公开定制的<code class="du kn ko kp kq b">DoFn</code>类。</li><li id="e3ee" class="kx ky hi jm b jn lg jr lh jv li jz lj kd lk kh lc ld le lf bi translated">公开对<code class="du kn ko kp kq b">DoFn</code>类的<code class="du kn ko kp kq b">@Setup</code>步骤的更容易的访问。</li><li id="1cd0" class="kx ky hi jm b jn lg jr lh jv li jz lj kd lk kh lc ld le lf bi translated">揭示一种处理过滤逻辑中的错误的方法(目前Beam的<code class="du kn ko kp kq b">Filter.by</code>不提供)。</li></ul><p id="5601" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">贷款模式的一些资源:</p><p id="3c9b" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated"><a class="ae lo" href="https://dzone.com/articles/functional-programming-patterns-with-java-8" rel="noopener ugc nofollow" target="_blank">https://dzone . com/articles/functional-programming-patterns-with-Java-8</a></p><div class="lp lq ez fb lr ls"><a href="https://blog.knoldus.com/scalaknol-understanding-loan-pattern/" rel="noopener  ugc nofollow" target="_blank"><div class="lt ab dw"><div class="lu ab lv cl cj lw"><h2 class="bd hj fi z dy lx ea eb ly ed ef hh bi translated">ScalaKnol:了解贷款模式</h2><div class="lz l"><h3 class="bd b fi z dy lx ea eb ly ed ef dx translated">顾名思义，借出模式将资源借出给你的函数。所以如果你把这个句子。它会…</h3></div><div class="ma l"><p class="bd b fp z dy lx ea eb ly ed ef dx translated">blog.knoldus.com</p></div></div><div class="mb l"><div class="mc l md me mf mb mg ik ls"/></div></div></a></div><p id="8c27" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">关于<code class="du kn ko kp kq b">Asgarde</code>库的更多信息，这里是项目自述文件的链接:</p><div class="lp lq ez fb lr ls"><a href="https://github.com/tosun-si/asgarde" rel="noopener  ugc nofollow" target="_blank"><div class="lt ab dw"><div class="lu ab lv cl cj lw"><h2 class="bd hj fi z dy lx ea eb ly ed ef hh bi translated">GitHub-tosun-si/as garde:as garde允许用Apache Beam Java简化错误处理，用…</h2><div class="lz l"><h3 class="bd b fi z dy lx ea eb ly ed ef dx translated">这个模块允许用Apache Beam Java简化错误处理。该项目托管在Maven存储库上。你可以…</h3></div><div class="ma l"><p class="bd b fp z dy lx ea eb ly ed ef dx translated">github.com</p></div></div><div class="mb l"><div class="mh l md me mf mb mg ik ls"/></div></div></a></div><blockquote class="mi mj mk"><p id="94fa" class="jk jl ml jm b jn ki jp jq jr kj jt ju mm kk jx jy mn kl kb kc mo km kf kg kh hb bi translated">如果你喜欢我的文章，想看我的帖子，请关注我:</p><p id="3059" class="jk jl ml jm b jn ki jp jq jr kj jt ju mm kk jx jy mn kl kb kc mo km kf kg kh hb bi translated">- <a class="ae lo" rel="noopener" href="/@mazlum.tosun">中</a> <br/> - <a class="ae lo" href="https://twitter.com/MazlumTosun3" rel="noopener ugc nofollow" target="_blank">推特</a> <br/> - <a class="ae lo" href="https://www.linkedin.com/in/mazlum-tosun-900b1812" rel="noopener ugc nofollow" target="_blank">领英</a></p></blockquote></div></div>    
</body>
</html>