<html>
<head>
<title>Flutter Vision — Flutter + Firebase ML Vision + Firebase Cloud Firestore</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flutter Vision—Flutter+Firebase ML Vision+Firebase Cloud Firestore</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/flutter-vision-flutter-firebase-ml-vision-firebase-cloud-firestore-76f3794f5d38?source=collection_archive---------0-----------------------#2018-12-15">https://medium.com/google-cloud/flutter-vision-flutter-firebase-ml-vision-firebase-cloud-firestore-76f3794f5d38?source=collection_archive---------0-----------------------#2018-12-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e62f77ee870b9a046c9bbde54b32bcb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DRwLVCQ6Su7ypiYbnrnV_Q.png"/></div></div></figure><p id="ecb3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我曾经是一个代码迷，发布了许多开发平台，如Cordova(和相关的应用程序框架，如Ionic)以及Xamarin。我一直在关注谷歌的加入。<a class="ae jo" href="https://developers.googleblog.com/2018/12/flutter-10-googles-portable-ui-toolkit.html" rel="noopener ugc nofollow" target="_blank">最近</a>他们发布了1.0版本，我决定尝试一下。由于Flutter应用程序是用Dart编写的(对此我没有什么经验)，我有点担心，但我被谷歌的声明所鼓舞:</p><blockquote class="jp jq jr"><p id="e2a0" class="iq ir js is b it iu iv iw ix iy iz ja jt jc jd je ju jg jh ji jv jk jl jm jn hb bi translated">你不需要以前的Dart或移动编程经验。</p></blockquote><p id="4a81" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">考虑到这一点，我决定用Ionic+Firebase+Google Cloud Vision重新开发一个应用程序。如果你想看看，可以找到<a class="ae jo" rel="noopener" href="/google-cloud/ionic-3-google-cloud-vision-firebase-78ea68cfbea8">教程</a>和<a class="ae jo" href="https://github.com/cbetz/my-stuff" rel="noopener ugc nofollow" target="_blank">源代码</a>。</p><p id="da98" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本教程中，我们将构建一个应用程序，它可以拍摄物品的照片，使用ML Vision来标记物品，并将图像和标签保存到Firebase Cloud Firestore和存储中。如果你想跳到源代码，可以在这里找到<a class="ae jo" href="https://github.com/cbetz/flutter-vision" rel="noopener ugc nofollow" target="_blank"/>。这是成品的视频:</p><figure class="jw jx jy jz fd ij"><div class="bz dy l di"><div class="ka kb l"/></div></figure></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="da08" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">开始了。我遵循了为MacOS提供的安装说明<a class="ae jo" href="https://flutter.io/docs/get-started/install/macos" rel="noopener ugc nofollow" target="_blank">。虽然不像brew或npm安装那么容易，但我轻松地完成了。确保运行<strong class="is hj"> flutter doctor </strong>并按照说明安装任何缺失的依赖项。</a></p><p id="a156" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我选择的编辑器是VS Code，幸运的是它有Flutter和Dart插件<a class="ae jo" href="https://flutter.io/docs/get-started/editor?tab=vscode#vscode" rel="noopener ugc nofollow" target="_blank">可用</a>。运行<strong class="is hj"> Flutter:运行Flutter Doctor </strong>提示我指向安装我的Flutter SDK的位置，然后我就可以开始编写我的应用程序了！</p><p id="0d05" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第一步是使用这里列出的<a class="ae jo" href="https://flutter.io/docs/get-started/test-drive?tab=vscode" rel="noopener ugc nofollow" target="_blank">方便的VS代码命令创建一个新项目。几秒钟后，项目安装完成，包括iOS和Android平台的特定文件。根据我使用Cordova的经验，我发现这非常令人惊讶，因为添加单个平台是一个独立的(有时很长)过程。</a></p><p id="98db" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此时，我们已经准备好运行应用程序。此时我没有运行任何模拟器(iOS)或仿真器(Android ),所以我在VS代码状态栏中点击<strong class="is hj"> No Devices </strong>,然后点击iOS device，这将自动启动一个iPhone XR模拟器。回到VS代码，我点击F5，16.2秒后，应用程序在模拟器上以调试模式运行。快！按照<a class="ae jo" href="https://flutter.io/docs/get-started/test-drive?tab=vscode" rel="noopener ugc nofollow" target="_blank">教程</a>我修改了文本并保存main.dart，这开始了一次热重装。1.5秒后，我在屏幕上看到了下一条文本。快！</p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="7644" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">和我之前的app和<a class="ae jo" rel="noopener" href="/google-cloud/ionic-3-google-cloud-vision-firebase-78ea68cfbea8">教程</a>一样，Flutter Vision要拍摄一个物品的照片，在设备上使用ML Kit for Firebase对照片进行分析，然后将数据存储在Firebase Cloud Firestore中。</p><p id="8670" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们需要能够在用户拍照后调用相机并保存图像文件。<a class="ae jo" href="https://pub.dartlang.org/packages/camera" rel="noopener ugc nofollow" target="_blank">摄像头插件</a>的安装说明是<a class="ae jo" href="https://pub.dartlang.org/packages/camera#-installing-tab-" rel="noopener ugc nofollow" target="_blank">这里是</a>。请务必在此处进行<a class="ae jo" href="https://pub.dartlang.org/packages/camera#-readme-tab-" rel="noopener ugc nofollow" target="_blank">概述的平台特定更改。在看了一个简单的</a><a class="ae jo" href="https://github.com/flutter/plugins/tree/master/packages/camera#example" rel="noopener ugc nofollow" target="_blank">示例</a>和一个更复杂的<a class="ae jo" href="https://github.com/flutter/plugins/blob/master/packages/camera/example/lib/main.dart" rel="noopener ugc nofollow" target="_blank">示例</a>后，我更新了我的应用程序，只显示了一个相机预览和一个拍照按钮。拍照后，文件名和路径会通过一个图标显示出来。粘贴在这里有点长，所以查看一下<a class="ae jo" href="https://gist.github.com/cbetz/d7a41873ee2b1c349221223b7d95a572" rel="noopener ugc nofollow" target="_blank">要点</a>获取出处。最好用实际设备测试，因为我们使用的是摄像头。将一个设备连接到你的机器上，你应该会在VS代码的状态栏中看到它。按F5键启动构建和调试会话。注意:我被提示在Xcode中选择一个团队——选择一个之后，我就让应用程序在我的手机上运行了。第一步完成！</p></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="39e9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们需要一个使用Firebase ML套件的方法。快速搜索后，我看到谷歌有Firebase Flutter插件— <a class="ae jo" href="https://github.com/flutter/plugins/blob/master/FlutterFire.md" rel="noopener ugc nofollow" target="_blank"> FlutterFire </a>！要使用Firebase服务，我们需要首先创建一个Firebase项目。这里有一个很棒的教程<a class="ae jo" href="https://codelabs.developers.google.com/codelabs/flutter-firebase/#5" rel="noopener ugc nofollow" target="_blank"/>解释了如何做到这一点。接下来，我们需要严格遵循概述的<a class="ae jo" href="https://codelabs.developers.google.com/codelabs/flutter-firebase/#6" rel="noopener ugc nofollow" target="_blank">步骤</a>来处理特定于平台的配置。现在我们已经有了一个Firebase项目并设置了我们的平台，我们可以开始使用Firebase ML工具包了。让我们按照<a class="ae jo" href="https://pub.dartlang.org/packages/firebase_ml_vision#-installing-tab-" rel="noopener ugc nofollow" target="_blank">安装说明</a>将ML工具包添加到我们的应用程序中。为了快速测试，让我们创建一个函数来处理标签检测，并遍历ML Vision返回的标签列表，并将它们显示给用户。稍后我们会让它变得更有用。</p><pre class="jw jx jy jz fd kj kk kl km aw kn bi"><span id="bea2" class="ko kp hi kk b fi kq kr l ks kt">Future&lt;void&gt; detectLabels() async {</span><span id="5341" class="ko kp hi kk b fi ku kr l ks kt">final FirebaseVisionImage visionImage = FirebaseVisionImage.fromFilePath(imagePath);</span><span id="604c" class="ko kp hi kk b fi ku kr l ks kt">final LabelDetector labelDetector = FirebaseVision.instance.labelDetector();</span><span id="1c45" class="ko kp hi kk b fi ku kr l ks kt">final List&lt;Label&gt; labels = await labelDetector.detectInImage(visionImage);</span><span id="6af5" class="ko kp hi kk b fi ku kr l ks kt">for (Label label in labels) {</span><span id="ae23" class="ko kp hi kk b fi ku kr l ks kt">  final String text = label.label;</span><span id="41ab" class="ko kp hi kk b fi ku kr l ks kt">  _scaffoldKey.currentState.showSnackBar(SnackBar(content: Text(text)));</span><span id="4619" class="ko kp hi kk b fi ku kr l ks kt">}</span><span id="94e1" class="ko kp hi kk b fi ku kr l ks kt">}</span></pre><p id="cac0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">变化的全部要点<a class="ae jo" href="https://gist.github.com/cbetz/9303f3179098a3fdd998765fdc4ecbc0" rel="noopener ugc nofollow" target="_blank">在这里</a>。让我们点击F5再次启动应用程序。有用！观看它的实际应用:</p><figure class="jw jx jy jz fd ij"><div class="bz dy l di"><div class="ka kb l"/></div></figure></div><div class="ab cl kc kd gp ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hb hc hd he hf"><p id="f85f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们将把图像和标签数据保存到Firestore。上次我们使用了Firebase的实时数据库——从那时起，Firebase发布了Firestore，这是一个功能丰富的NoSQL数据库。要设置Firestore数据库，请遵循此处的说明<a class="ae jo" href="https://firebase.google.com/docs/firestore/quickstart" rel="noopener ugc nofollow" target="_blank"/>，选择<strong class="is hj">测试模式</strong>进行开发/测试。请记住，这为您留下了很大的空间，因此在投入生产之前，请确保使用安全规则将其锁定。回到代码——Flutter有一个可用的插件<a class="ae jo" href="https://github.com/flutter/plugins/tree/master/packages/cloud_firestore" rel="noopener ugc nofollow" target="_blank">这里</a>我们将<a class="ae jo" href="https://pub.dartlang.org/packages/cloud_firestore#-installing-tab-" rel="noopener ugc nofollow" target="_blank">安装</a>。接下来，在我们拍摄照片并对其进行分析之后，让我们将其存储为一个<em class="js">文档</em>，我们将称之为一个<strong class="is hj">项目</strong>。多个文档将被组织成一个<em class="js">集合</em>，我们称之为<strong class="is hj">条目</strong>。创建一个函数，该函数将创建一个新的<strong class="is hj">项目</strong>:</p><pre class="jw jx jy jz fd kj kk kl km aw kn bi"><span id="cdfa" class="ko kp hi kk b fi kq kr l ks kt">Future&lt;void&gt; _addItem(List&lt;String&gt; labels) async {</span><span id="029f" class="ko kp hi kk b fi ku kr l ks kt">await Firestore.instance.collection('items').add(&lt;String, dynamic&gt; {</span><span id="e86b" class="ko kp hi kk b fi ku kr l ks kt">'labels': labels</span><span id="d232" class="ko kp hi kk b fi ku kr l ks kt">});</span><span id="f8b5" class="ko kp hi kk b fi ku kr l ks kt">}</span></pre><p id="dba5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后更改我们的标签检测过程，调用这个新函数:</p><pre class="jw jx jy jz fd kj kk kl km aw kn bi"><span id="6bd4" class="ko kp hi kk b fi kq kr l ks kt">Future&lt;void&gt; detectLabels() async {</span><span id="3e0b" class="ko kp hi kk b fi ku kr l ks kt">final FirebaseVisionImage visionImage = FirebaseVisionImage.fromFilePath(imagePath);</span><span id="6f8d" class="ko kp hi kk b fi ku kr l ks kt">final LabelDetector labelDetector = FirebaseVision.instance.labelDetector();</span><span id="81a4" class="ko kp hi kk b fi ku kr l ks kt">final List&lt;Label&gt; labels = await labelDetector.detectInImage(visionImage);</span><span id="b57e" class="ko kp hi kk b fi ku kr l ks kt">List&lt;String&gt; labelTexts = new List();</span><span id="8740" class="ko kp hi kk b fi ku kr l ks kt">for (Label label in labels) {</span><span id="cb7b" class="ko kp hi kk b fi ku kr l ks kt">  final String text = label.label;</span><span id="1500" class="ko kp hi kk b fi ku kr l ks kt">  labelTexts.add(text);</span><span id="1548" class="ko kp hi kk b fi ku kr l ks kt">}</span><span id="4f1d" class="ko kp hi kk b fi ku kr l ks kt">_addItem(labelTexts);</span><span id="896b" class="ko kp hi kk b fi ku kr l ks kt">}</span></pre><p id="b4c6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，当我们拍照时，我们可以看到收藏中的物品以极快的速度增加。明确地说，这是拍摄一张照片，使用ML Vision分析照片的标签，然后将其保存到云数据库。说真的，这是令人难以置信的<em class="js">快</em>:</p><figure class="jw jx jy jz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/0a223b5a01e23776608e85ca8514ebc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1wShnfTa5WTa6gXSBmsPEg.png"/></div></div></figure><p id="2c90" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们需要存储我们的图像。在之前的应用中，我们对图像数据进行了base64编码，并将其直接存储在Firebase的实时数据库中。由于数据类型限制，我们将无法在云Firestore中存储图像数据。别担心，我们会将图像文件存储在Firebase存储中，然后使用<a class="ae jo" href="https://pub.dartlang.org/packages/firebase_storage#-installing-tab-" rel="noopener ugc nofollow" target="_blank"> Firebase存储插件</a>获取URL并存储在<strong class="is hj">项目</strong>文档中。这是我们处理上传的函数。它上传文件，然后等待StorageUploadTask并获取downloadURL:</p><pre class="jw jx jy jz fd kj kk kl km aw kn bi"><span id="cd3f" class="ko kp hi kk b fi kq kr l ks kt">Future&lt;String&gt; _uploadFile(filename) async {</span><span id="d30a" class="ko kp hi kk b fi ku kr l ks kt">  final File file = File(imagePath);</span><span id="8b6b" class="ko kp hi kk b fi ku kr l ks kt">  final StorageReference ref = FirebaseStorage.instance.ref().child('$filename.jpg');</span><span id="e77e" class="ko kp hi kk b fi ku kr l ks kt">  final StorageUploadTask uploadTask = ref.putFile(file, StorageMetadata(contentLanguage: 'en'));</span><span id="752e" class="ko kp hi kk b fi ku kr l ks kt">  final downloadURL = await (await uploadTask.onComplete).ref.getDownloadURL();</span><span id="e221" class="ko kp hi kk b fi ku kr l ks kt">  return downloadURL.toString();</span><span id="b775" class="ko kp hi kk b fi ku kr l ks kt">}</span></pre><p id="2ad8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更新our _addItem函数以保存URL:</p><pre class="jw jx jy jz fd kj kk kl km aw kn bi"><span id="39ed" class="ko kp hi kk b fi kq kr l ks kt">Future&lt;void&gt; _addItem(String downloadURL, List&lt;String&gt; labels) async {</span><span id="b208" class="ko kp hi kk b fi ku kr l ks kt">await Firestore.instance.collection('items').add(&lt;String, dynamic&gt; {</span><span id="b733" class="ko kp hi kk b fi ku kr l ks kt">'downloadURL': downloadURL,</span><span id="17fa" class="ko kp hi kk b fi ku kr l ks kt">'labels': labels</span><span id="d632" class="ko kp hi kk b fi ku kr l ks kt">});</span><span id="7e31" class="ko kp hi kk b fi ku kr l ks kt">}</span></pre><p id="c260" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们需要一个唯一的URL，所以我们将使用方便的uuid包，如<a class="ae jo" href="https://github.com/flutter/plugins/blob/master/packages/firebase_storage/example/lib/main.dart" rel="noopener ugc nofollow" target="_blank">示例</a>:</p><pre class="jw jx jy jz fd kj kk kl km aw kn bi"><span id="feb7" class="ko kp hi kk b fi kq kr l ks kt">Future&lt;void&gt; detectLabels() async {</span><span id="5b30" class="ko kp hi kk b fi ku kr l ks kt">final FirebaseVisionImage visionImage = FirebaseVisionImage.fromFilePath(imagePath);</span><span id="8893" class="ko kp hi kk b fi ku kr l ks kt">final LabelDetector labelDetector = FirebaseVision.instance.labelDetector();</span><span id="7555" class="ko kp hi kk b fi ku kr l ks kt">final List&lt;Label&gt; labels = await labelDetector.detectInImage(visionImage);</span><span id="7619" class="ko kp hi kk b fi ku kr l ks kt">List&lt;String&gt; labelTexts = new List();</span><span id="7ba3" class="ko kp hi kk b fi ku kr l ks kt">for (Label label in labels) {</span><span id="b3e5" class="ko kp hi kk b fi ku kr l ks kt">  final String text = label.label;</span><span id="8905" class="ko kp hi kk b fi ku kr l ks kt">  labelTexts.add(text);</span><span id="7751" class="ko kp hi kk b fi ku kr l ks kt">}</span><span id="2c83" class="ko kp hi kk b fi ku kr l ks kt">final String uuid = Uuid().v1();</span><span id="e2bb" class="ko kp hi kk b fi ku kr l ks kt">final String downloadURL = await _uploadFile(uuid);</span><span id="a5eb" class="ko kp hi kk b fi ku kr l ks kt">_addItem(downloadURL, labelTexts);</span><span id="28a6" class="ko kp hi kk b fi ku kr l ks kt">}</span></pre><p id="6b48" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">F5再次尝试:</p><figure class="jw jx jy jz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kw"><img src="../Images/769f470d77af66f057a992dfa4086fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HX3GAIDlUUap6OS37vGI1Q.png"/></div></div></figure><p id="d858" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此时，我们的图像和数据存储在Firebase中。接下来，我们需要向用户显示带有标签的图像列表。我们将重组我们的应用程序，使其有两个屏幕:一个负责向用户显示图像和标签列表；另一个拍摄照片并启动ML视觉过程。让我们创建一个新的屏幕，<strong class="is hj"> ItemListScreen </strong>，来显示卡片列表。我将修改示例<a class="ae jo" href="https://github.com/flutter/plugins/blob/master/packages/cloud_firestore/example/lib/main.dart" rel="noopener ugc nofollow" target="_blank">这里的</a>和<a class="ae jo" href="https://github.com/flutter/flutter/blob/master/examples/flutter_gallery/lib/demo/material/cards_demo.dart" rel="noopener ugc nofollow" target="_blank">这里的</a>以满足我们的需求:</p><pre class="jw jx jy jz fd kj kk kl km aw kn bi"><span id="0f8d" class="ko kp hi kk b fi kq kr l ks kt">class ItemsListScreen extends StatelessWidget {</span><span id="2a9c" class="ko kp hi kk b fi ku kr l ks kt">@override</span><span id="65c6" class="ko kp hi kk b fi ku kr l ks kt">Widget build(BuildContext context) {</span><span id="028a" class="ko kp hi kk b fi ku kr l ks kt">  return Scaffold(</span><span id="c73b" class="ko kp hi kk b fi ku kr l ks kt">    appBar: AppBar(</span><span id="8356" class="ko kp hi kk b fi ku kr l ks kt">     title: const Text('My Items'),</span><span id="6ee1" class="ko kp hi kk b fi ku kr l ks kt">  ),</span><span id="fde4" class="ko kp hi kk b fi ku kr l ks kt">  body: ItemsList(firestore: Firestore.instance),</span><span id="032a" class="ko kp hi kk b fi ku kr l ks kt">  floatingActionButton: FloatingActionButton(</span><span id="be0b" class="ko kp hi kk b fi ku kr l ks kt">    onPressed: () {</span><span id="5d97" class="ko kp hi kk b fi ku kr l ks kt">      Navigator.push(</span><span id="7c42" class="ko kp hi kk b fi ku kr l ks kt">        context,</span><span id="cabd" class="ko kp hi kk b fi ku kr l ks kt">        MaterialPageRoute(builder: (context) =&gt; CameraScreen()),</span><span id="2564" class="ko kp hi kk b fi ku kr l ks kt">      );</span><span id="17ef" class="ko kp hi kk b fi ku kr l ks kt">    },</span><span id="742f" class="ko kp hi kk b fi ku kr l ks kt">    child: const Icon(Icons.add),</span><span id="dda3" class="ko kp hi kk b fi ku kr l ks kt">  ),</span><span id="eb0f" class="ko kp hi kk b fi ku kr l ks kt">);</span><span id="8ae9" class="ko kp hi kk b fi ku kr l ks kt">}</span><span id="a472" class="ko kp hi kk b fi ku kr l ks kt">}</span></pre><p id="6044" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">…和一个<strong class="is hj"> ItemsList </strong>小部件(抱歉格式不合适，这里有一个要点<a class="ae jo" href="https://gist.github.com/cbetz/e56936f3850eb97e3fc53f833d98fd74" rel="noopener ugc nofollow" target="_blank"/>):</p><pre class="jw jx jy jz fd kj kk kl km aw kn bi"><span id="f147" class="ko kp hi kk b fi kq kr l ks kt">class ItemsList extends StatelessWidget {</span><span id="07e9" class="ko kp hi kk b fi ku kr l ks kt">ItemsList({this.firestore});</span><span id="1ac0" class="ko kp hi kk b fi ku kr l ks kt">final Firestore firestore;<br/></span><span id="d78e" class="ko kp hi kk b fi ku kr l ks kt">@override</span><span id="0bfa" class="ko kp hi kk b fi ku kr l ks kt">Widget build(BuildContext context) {</span><span id="9f50" class="ko kp hi kk b fi ku kr l ks kt">return StreamBuilder&lt;QuerySnapshot&gt;(</span><span id="a468" class="ko kp hi kk b fi ku kr l ks kt">stream: firestore.collection('items').snapshots(),</span><span id="a173" class="ko kp hi kk b fi ku kr l ks kt">builder: (BuildContext context, AsyncSnapshot&lt;QuerySnapshot&gt; snapshot) {</span><span id="2927" class="ko kp hi kk b fi ku kr l ks kt">if (!snapshot.hasData) return const Text('Loading...');</span><span id="e285" class="ko kp hi kk b fi ku kr l ks kt">final int itemsCount = snapshot.data.documents.length;</span><span id="4b9e" class="ko kp hi kk b fi ku kr l ks kt">return ListView.builder(</span><span id="dfef" class="ko kp hi kk b fi ku kr l ks kt">itemCount: itemsCount,</span><span id="a5a1" class="ko kp hi kk b fi ku kr l ks kt">itemBuilder: (_, int index) {</span><span id="b1d2" class="ko kp hi kk b fi ku kr l ks kt">final DocumentSnapshot document = snapshot.data.documents[index];</span><span id="98cb" class="ko kp hi kk b fi ku kr l ks kt">return SafeArea(</span><span id="c7eb" class="ko kp hi kk b fi ku kr l ks kt">top: false,</span><span id="3e17" class="ko kp hi kk b fi ku kr l ks kt">bottom: false,</span><span id="e215" class="ko kp hi kk b fi ku kr l ks kt">child: Container(</span><span id="ed36" class="ko kp hi kk b fi ku kr l ks kt">padding: const EdgeInsets.all(8.0),</span><span id="4cf5" class="ko kp hi kk b fi ku kr l ks kt">height: 310.0,</span><span id="edd9" class="ko kp hi kk b fi ku kr l ks kt">child: Card(</span><span id="5682" class="ko kp hi kk b fi ku kr l ks kt">shape: RoundedRectangleBorder(</span><span id="621a" class="ko kp hi kk b fi ku kr l ks kt">borderRadius: BorderRadius.only(</span><span id="1837" class="ko kp hi kk b fi ku kr l ks kt">topLeft: Radius.circular(16.0),</span><span id="e9c3" class="ko kp hi kk b fi ku kr l ks kt">topRight: Radius.circular(16.0),</span><span id="08e9" class="ko kp hi kk b fi ku kr l ks kt">bottomLeft: Radius.circular(16.0),</span><span id="32df" class="ko kp hi kk b fi ku kr l ks kt">bottomRight: Radius.circular(16.0),</span><span id="fb73" class="ko kp hi kk b fi ku kr l ks kt">),</span><span id="4de9" class="ko kp hi kk b fi ku kr l ks kt">),</span><span id="20ca" class="ko kp hi kk b fi ku kr l ks kt">child: Column(</span><span id="165d" class="ko kp hi kk b fi ku kr l ks kt">crossAxisAlignment: CrossAxisAlignment.start,</span><span id="fc86" class="ko kp hi kk b fi ku kr l ks kt">children: &lt;Widget&gt;[</span><span id="9626" class="ko kp hi kk b fi ku kr l ks kt">// photo and title</span><span id="c114" class="ko kp hi kk b fi ku kr l ks kt">SizedBox(</span><span id="4fdc" class="ko kp hi kk b fi ku kr l ks kt">height: 184.0,</span><span id="4fc7" class="ko kp hi kk b fi ku kr l ks kt">child: Stack(</span><span id="17ca" class="ko kp hi kk b fi ku kr l ks kt">children: &lt;Widget&gt;[</span><span id="15b4" class="ko kp hi kk b fi ku kr l ks kt">Positioned.fill(</span><span id="8b79" class="ko kp hi kk b fi ku kr l ks kt">child: Image.network(</span><span id="554f" class="ko kp hi kk b fi ku kr l ks kt">document['downloadURL']</span><span id="d8f1" class="ko kp hi kk b fi ku kr l ks kt">),</span><span id="6451" class="ko kp hi kk b fi ku kr l ks kt">),</span><span id="4d02" class="ko kp hi kk b fi ku kr l ks kt">],</span><span id="ba04" class="ko kp hi kk b fi ku kr l ks kt">),</span><span id="652b" class="ko kp hi kk b fi ku kr l ks kt">),</span><span id="42c3" class="ko kp hi kk b fi ku kr l ks kt">Expanded(</span><span id="1e47" class="ko kp hi kk b fi ku kr l ks kt">child: Padding(</span><span id="e53f" class="ko kp hi kk b fi ku kr l ks kt">padding: const EdgeInsets.fromLTRB(16.0, 16.0, 16.0, 0.0),</span><span id="19d1" class="ko kp hi kk b fi ku kr l ks kt">child: DefaultTextStyle(</span><span id="b181" class="ko kp hi kk b fi ku kr l ks kt">softWrap: true,</span><span id="6ae4" class="ko kp hi kk b fi ku kr l ks kt">//overflow: TextOverflow.,</span><span id="1fe1" class="ko kp hi kk b fi ku kr l ks kt">style: Theme.of(context).textTheme.subhead,</span><span id="653c" class="ko kp hi kk b fi ku kr l ks kt">child: Column(</span><span id="c80c" class="ko kp hi kk b fi ku kr l ks kt">crossAxisAlignment: CrossAxisAlignment.start,</span><span id="6f31" class="ko kp hi kk b fi ku kr l ks kt">children: &lt;Widget&gt;[</span><span id="1c84" class="ko kp hi kk b fi ku kr l ks kt">Text(document['labels'].join(', ')),</span><span id="8189" class="ko kp hi kk b fi ku kr l ks kt">]</span><span id="3940" class="ko kp hi kk b fi ku kr l ks kt">),</span><span id="63ec" class="ko kp hi kk b fi ku kr l ks kt">),</span><span id="a369" class="ko kp hi kk b fi ku kr l ks kt">),</span><span id="4397" class="ko kp hi kk b fi ku kr l ks kt">),</span><span id="4e39" class="ko kp hi kk b fi ku kr l ks kt">],</span><span id="a523" class="ko kp hi kk b fi ku kr l ks kt">),</span><span id="b3dd" class="ko kp hi kk b fi ku kr l ks kt">),</span><span id="20c5" class="ko kp hi kk b fi ku kr l ks kt">),</span><span id="3119" class="ko kp hi kk b fi ku kr l ks kt">);</span><span id="183d" class="ko kp hi kk b fi ku kr l ks kt">},</span><span id="ae7d" class="ko kp hi kk b fi ku kr l ks kt">);</span><span id="8546" class="ko kp hi kk b fi ku kr l ks kt">},</span><span id="5bbf" class="ko kp hi kk b fi ku kr l ks kt">);</span><span id="e782" class="ko kp hi kk b fi ku kr l ks kt">}</span><span id="29c9" class="ko kp hi kk b fi ku kr l ks kt">}</span></pre><p id="ef7c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们将主屏幕更改为<strong class="is hj">项目列表屏幕</strong>:</p><pre class="jw jx jy jz fd kj kk kl km aw kn bi"><span id="88cb" class="ko kp hi kk b fi kq kr l ks kt">class FlutterVisionApp extends StatelessWidget {</span><span id="1e04" class="ko kp hi kk b fi ku kr l ks kt">@override</span><span id="233a" class="ko kp hi kk b fi ku kr l ks kt">Widget build(BuildContext context) {</span><span id="570f" class="ko kp hi kk b fi ku kr l ks kt">  return MaterialApp(</span><span id="01c8" class="ko kp hi kk b fi ku kr l ks kt">    home: ItemsListScreen(),</span><span id="7e0a" class="ko kp hi kk b fi ku kr l ks kt">  );</span><span id="5598" class="ko kp hi kk b fi ku kr l ks kt">}</span><span id="683c" class="ko kp hi kk b fi ku kr l ks kt">}</span></pre><p id="f161" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们还应该在用户拍照后将他们带回列表，这样他们就可以通过向<strong class="is hj">检测标签</strong>函数添加以下内容来查看结果:</p><pre class="jw jx jy jz fd kj kk kl km aw kn bi"><span id="dee4" class="ko kp hi kk b fi kq kr l ks kt">Navigator.push(</span><span id="274d" class="ko kp hi kk b fi ku kr l ks kt">  context,</span><span id="7cca" class="ko kp hi kk b fi ku kr l ks kt">  MaterialPageRoute(builder: (context) =&gt; ItemsListScreen()),</span><span id="9959" class="ko kp hi kk b fi ku kr l ks kt">);</span></pre><p id="ba42" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我还决定做一些清理，将<strong class="is hj"> FlutterVisionHome </strong>重命名为<strong class="is hj"> CameraScreen </strong>，因为我们现在有不止一个屏幕。</p><p id="9484" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后一次运行应用程序，查看最终结果！Firebase ML视觉<em class="js">狂</em>快。配合Flutter，我们能够在几个小时内，而不是几天内，获得一个可以在iOS和Android上运行的漂亮应用程序。难以置信。如果你像我一样，因为不了解Dart而对尝试Flutter犹豫不决，那么今天就试试吧！</p><p id="441d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">源代码可在<a class="ae jo" href="https://github.com/cbetz/flutter-vision" rel="noopener ugc nofollow" target="_blank">这里</a>获得。如果你遇到麻烦，或者在评论中联系我，请随时在这里提出问题。感谢收听！</p></div></div>    
</body>
</html>