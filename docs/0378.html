<html>
<head>
<title>Getting started with Google BigQuery — A Google Cloud codelab for GeoHackWeek 2017</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google BigQuery入门——2017年GeoHackWeek的Google云代码实验室</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/getting-started-with-google-cloud-a-codelab-for-geohackweek-2017-848c25ed72fd?source=collection_archive---------0-----------------------#2017-09-13">https://medium.com/google-cloud/getting-started-with-google-cloud-a-codelab-for-geohackweek-2017-848c25ed72fd?source=collection_archive---------0-----------------------#2017-09-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b725" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你好<a class="ae jd" href="https://geohackweek.github.io/ghw2017/" rel="noopener ugc nofollow" target="_blank"> GeoHackWeek 2017 </a>与会者。在这个<a class="ae jd" href="https://g.co/codelabs" rel="noopener ugc nofollow" target="_blank"> codelabs </a>风格的教程中，我们将浏览一些在谷歌云平台(GCP)上可用的<a class="ae jd" href="https://cloud.google.com/public-datasets/" rel="noopener ugc nofollow" target="_blank">公共数据集</a>，并使用一些可用于分析地理空间数据的工具。</p><h1 id="8dbb" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">开始之前</h1><p id="f9ef" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">希望你有一个GCP项目为它设置的谷歌帐户。如果没有，查看<a class="ae jd" href="https://geohackweek.github.io/preliminary/02-gcp-tutorial/" rel="noopener ugc nofollow" target="_blank">初级教程</a>。</p><p id="69a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦您有了一个启用了计费的GCP项目(例如，通过开始免费试用或使用优惠券)，您就可以继续下一步了。</p><h1 id="3637" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">关于这些公共数据集</h1><p id="f24f" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">有几个地方可以找到谷歌托管的<a class="ae jd" href="https://cloud.google.com/public-datasets/" rel="noopener ugc nofollow" target="_blank">公共数据集</a>。</p><ul class=""><li id="e463" class="kh ki hi ih b ii ij im in iq kj iu kk iy kl jc km kn ko kp bi translated"><a class="ae jd" href="https://earthengine.google.com/datasets/" rel="noopener ugc nofollow" target="_blank">地球引擎公共数据集</a></li><li id="b656" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated"><a class="ae jd" href="https://console.cloud.google.com/launcher/browse?filter=solution-type:dataset" rel="noopener ugc nofollow" target="_blank"> Google Cloud Platform公共数据集</a> —新数据集将在此加载，但其他数据集将记录在产品文档中。</li><li id="a291" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated"><a class="ae jd" href="https://cloud.google.com/bigquery/public-data/" rel="noopener ugc nofollow" target="_blank"> Google BigQuery公共数据集</a> —结构化数据集，可通过SQL查询。</li><li id="700a" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated"><a class="ae jd" href="https://cloud.google.com/storage/docs/public-datasets/" rel="noopener ugc nofollow" target="_blank">云存储公共数据集</a> —栅格数据，包括Landsat数据。</li></ul><p id="3609" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将要探索的数据集是<a class="ae jd" href="https://cloud.google.com/bigquery/public-data/nyc-citi-bike" rel="noopener ugc nofollow" target="_blank">纽约市花旗自行车旅行数据集</a>。</p><h1 id="7811" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">在Google BigQuery中浏览纽约市的自行车出行数据集</h1><p id="c6ea" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">通过在<a class="ae jd" href="https://bigquery.cloud.google.com/table/bigquery-public-data:new_york.citibike_trips?tab=schema" rel="noopener ugc nofollow" target="_blank">https://big query . cloud . Google . com/table/big query-public-data:new _ York . Citi bike _ trips的<a class="ae jd" href="https://cloud.google.com/bigquery/bigquery-web-ui" rel="noopener ugc nofollow" target="_blank"> BigQuery Web UI </a>中打开该表来查看该表。tab =模式</a></p><p id="f4c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你会看到一个表格中有哪些列，以及一些在表格上做一些操作的按钮。</p><p id="90bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://stackoverflow.com/a/23991604" rel="noopener ugc nofollow" target="_blank">不要在BigQuery </a>中执行SELECT *操作，而是使用预览按钮来获取表中某些行的样本。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/1b8afd6c09515d70a5b1a0215d7cd3d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tI5G7G9ogDQ_6dZ1."/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">使用预览按钮感受一下数据。</figcaption></figure><h1 id="ee58" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">撰写BigQuery查询</h1><p id="e290" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">对于我们的第一个查询，让我们找出哪些车站是最受欢迎的目的地。</p><p id="8072" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<strong class="ih hj">撰写查询</strong>按钮。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es ll"><img src="../Images/6bb627b83173d3c1b7cd0a5e359adedd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Qo88s085LgDT5sEvkrQkA.png"/></div></div></figure><p id="acb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用<a class="ae jd" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/" rel="noopener ugc nofollow" target="_blank">标准SQL语法</a>，我们需要在选项中启用它。点击<strong class="ih hj">显示选项</strong>按钮，取消选中使用传统SQL语法的选项。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lm"><img src="../Images/a6dcbc94a4335478c135d3ec0bd76396.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DVjUUWLodpdld_F-."/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">对本教程中的查询使用标准SQL语法。</figcaption></figure><p id="916f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，输入查询文本来查找最受欢迎的花旗自行车目的地。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="2edd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后点击<strong class="ih hj">运行查询</strong>按钮。</p><p id="ad5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">几秒钟后，您应该会看到一个电台表，按照它们在trips表中出现的频率排序。</p><p id="a4a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为什么会显示“已处理1.15 GB”？这意味着BigQuery扫描了那么多字节来计算这个查询的结果。<a class="ae jd" href="https://cloud.google.com/bigquery/pricing#free-tier" rel="noopener ugc nofollow" target="_blank">每月前1 TB的处理是免费的</a>。</p><h1 id="8560" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">更复杂的查询</h1><p id="e462" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">在另一篇文章中，我<a class="ae jd" rel="noopener" href="/@TimSwast/what-are-the-most-popular-citibike-destinations-for-nyc-couples-1baf646fbba">使用这个数据集寻找团体和单人旅行的热门目的地</a>。</p><figure class="kw kx ky kz fd la"><div class="bz dy l di"><div class="ln lo l"/></div></figure><h1 id="7b94" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">可视化查询结果</h1><p id="e7cd" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">可视化BigQuery查询结果的一种方法是使用云数据实验室。</p><p id="0369" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，打开谷歌云平台控制台:<a class="ae jd" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com</a></p><p id="8307" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，使用右上角的Shell图标打开<a class="ae jd" href="https://cloud.google.com/shell/" rel="noopener ugc nofollow" target="_blank"> Google Cloud Shell </a>。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lp"><img src="../Images/5839404aa0790b09234d6078486d0f19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N2T9dUUUPzFQhaoy89xiHQ.png"/></div></div></figure><p id="a69a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输入命令创建一个新的Datalab实例。</p><blockquote class="lq lr ls"><p id="e8a1" class="if ig lt ih b ii ij ik il im in io ip lu ir is it lv iv iw ix lw iz ja jb jc hb bi translated"><em class="hi">数据实验室创建地理周刊</em></p></blockquote><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lx"><img src="../Images/9117557be0ed2a50fe3a66254af172ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z37MGjnS2nDt5yxdk-xM4A.png"/></div></div></figure><p id="241e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Web预览功能连接到新实例。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es ly"><img src="../Images/0ceb8948730d8a3656f4a86f83439554.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*DMzuAYKXTaIHbSsoR8X78w.png"/></div></figure><p id="917d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将打开一个Jupyter笔记本环境，为使用Google Cloud进行一些定制。要从Datalab访问Google BigQuery，可以使用<em class="lt"> pandas.io.gbq </em>(也称为<a class="ae jd" href="https://pandas-gbq.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> pandas-gbq </a>)包。</p><blockquote class="lq lr ls"><p id="d879" class="if ig lt ih b ii ij ik il im in io ip lu ir is it lv iv iw ix lw iz ja jb jc hb bi translated">data frame = pandas . io . gbq . read _ gbq(<br/>' SELECT 1 '，project_id='myproj '，dialect='standard ')</p></blockquote><p id="1db6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="http://googledatalab.github.io/pydatalab/datalab.magics.html" rel="noopener ugc nofollow" target="_blank"> Datalab还内置了IPython magic commands </a>，用于与BigQuery和其他Google Cloud APIs一起工作。</p><h1 id="a0a4" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">关闭您的Datalab实例</h1><p id="d193" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">为了节省成本，您可以在不使用Datalab实例时停止它。</p><blockquote class="lq lr ls"><p id="bbb9" class="if ig lt ih b ii ij ik il im in io ip lu ir is it lv iv iw ix lw iz ja jb jc hb bi translated">数据实验室停止地理黑客周</p></blockquote><p id="2db6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将关闭实例，但不会删除它或它的存储。</p><p id="94e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要启动它并重新连接，请使用connect命令。</p><blockquote class="lq lr ls"><p id="5c0a" class="if ig lt ih b ii ij ik il im in io ip lu ir is it lv iv iw ix lw iz ja jb jc hb bi translated">数据实验室连接地理黑客周刊</p></blockquote><p id="1ccb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您完全完成了实例并备份了笔记本，您可以使用删除命令完全删除实例。</p><blockquote class="lq lr ls"><p id="c576" class="if ig lt ih b ii ij ik il im in io ip lu ir is it lv iv iw ix lw iz ja jb jc hb bi translated">数据实验室删除地理黑客周</p></blockquote><h1 id="736a" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">额外资源</h1><ul class=""><li id="2027" class="kh ki hi ih b ii kc im kd iq lz iu ma iy mb jc km kn ko kp bi translated"><a class="ae jd" href="https://codelabs.developers.google.com/codelabs/bigquery-maps-api/#0" rel="noopener ugc nofollow" target="_blank">将BigQuery与谷歌地图API </a>相结合——这是一个代码实验室，它使用BigQuery中的用户定义函数来进行空间查询，然后使用谷歌地图可视化结果。</li><li id="984d" class="kh ki hi ih b ii kq im kr iq ks iu kt iy ku jc km kn ko kp bi translated"><a class="ae jd" rel="noopener" href="/@TimSwast/visualizing-big-data-with-google-cloud-fe323a03f85c">更多可视化数据的资源</a> —我在Google Cloud Next 2017的演讲和我为此做的可视化演示。</li></ul></div></div>    
</body>
</html>