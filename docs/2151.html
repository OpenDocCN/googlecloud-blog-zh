<html>
<head>
<title>Google Cloud Anthos Series: Anthos Multi-cloud &amp; Hybrid story</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云Anthos系列:Anthos多云和混合故事</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-cloud-anthos-series-anthos-multi-cloud-hybrid-story-fc70ce352c40?source=collection_archive---------0-----------------------#2022-04-04">https://medium.com/google-cloud/google-cloud-anthos-series-anthos-multi-cloud-hybrid-story-fc70ce352c40?source=collection_archive---------0-----------------------#2022-04-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="12e7" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">Google Cloud Anthos系列(在AWS上部署Anthos):<strong class="ak">第九部分</strong></h2></div><p id="5ab2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated"><span class="l ju jv jw bm jx jy jz ka kb di"> W </span>欢迎来到“谷歌云Anthos系列”的第9部分。你可以在这里找到完整的系列<a class="ae kc" rel="noopener" href="/google-cloud/google-cloud-anthos-series-23b9a35e9179"/>。</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es kd"><img src="../Images/0945a52ecafa1bce6a05df23b9baceb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*owLFjtUfo3J-aXHR9Y2SWg.png"/></div></div></figure><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es kp"><img src="../Images/ff49a5f8d9db9fc2420e3fd2b72db841.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h1D_l8-q8fM3MFJeeaStAQ.png"/></div></div></figure><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es kq"><img src="../Images/c90f1444180e826b4eb2a25ea52b0f83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fl7e5UiPVrg7-5FEcoqHZg.png"/></div></div></figure><p id="1a96" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">借助Anthos集群，您可以通过统一的管理、信号和配置控制平面将工作负载部署到多个云中。</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es kr"><img src="../Images/cd88f7363dc24366e48f9a0fb21fbf88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RClLakB1ar6YuECwEWPpNw.png"/></div></div></figure><p id="fa22" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个例子中，我们将通过Anthos在AWS上部署一个Kubernetes集群。</p><p id="a7a2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">作为先决条件，安装并配置以下组件:</p><blockquote class="ks kt ku"><p id="317a" class="ix iy kv iz b ja jb ij jc jd je im jf kw jh ji jj kx jl jm jn ky jp jq jr js hb bi translated"><a class="ae kc" href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" rel="noopener ugc nofollow" target="_blank">AWS CLI</a><br/><a class="ae kc" href="https://cloud.google.com/sdk/docs/install" rel="noopener ugc nofollow" target="_blank">g cloud CLI</a><br/><a class="ae kc" href="https://stedolan.github.io/jq/download/" rel="noopener ugc nofollow" target="_blank">jq</a><br/><a class="ae kc" href="https://kubernetes.io/docs/tasks/tools/" rel="noopener ugc nofollow" target="_blank">ku bectl</a></p></blockquote><p id="6a99" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里我们将使用的AWS地区是us-west-2 <br/>这里我们将使用的GCP地区是us-west1</p><p id="27d6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">设置一些环境变量</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="afaa" class="le lf hi la b fi lg lh l li lj">PROJECT_ID="&lt;your-gcp-project-id&gt;"</span><span id="0d59" class="le lf hi la b fi lk lh l li lj">AWS_REGION="us-west-2"</span><span id="f333" class="le lf hi la b fi lk lh l li lj">GCP_REGION="us-west1"</span><span id="d913" class="le lf hi la b fi lk lh l li lj">gcloud components update</span></pre><p id="fe52" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">启用以下API</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="f174" class="le lf hi la b fi lg lh l li lj">gcloud services enable gkemulticloud.googleapis.com<br/>gcloud services enable gkeconnect.googleapis.com<br/>gcloud services enable connectgateway.googleapis.com<br/>gcloud services enable cloudresourcemanager.googleapis.com<br/>gcloud services enable anthos.googleapis.com<br/>gcloud services enable logging.googleapis.com<br/>gcloud services enable monitoring.googleapis.com</span></pre><p id="5ff7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">让我们在AWS中创建一个VPC，其公共和私有子网位于不同的az中。</strong></p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es ll"><img src="../Images/4fa4b6af8700e81abb4995316d55da56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w2a2hxYENzu5cugW8o3ImQ.png"/></div></div></figure><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="0fad" class="le lf hi la b fi lg lh l li lj">aws --region $AWS_REGION ec2 create-vpc \<br/>    --cidr-block 10.0.0.0/16 \<br/>    --tag-specifications 'ResourceType=vpc, Tags=[{Key=Name,Value=anthosAWSVPC}]'</span><span id="a70f" class="le lf hi la b fi lk lh l li lj">VPC_ID=$(aws ec2 describe-vpcs \<br/>  --filters 'Name=tag:Name,Values=anthosAWSVPC' \<br/>  --query "Vpcs[].VpcId" --output text)</span><span id="1be7" class="le lf hi la b fi lk lh l li lj">aws ec2 modify-vpc-attribute --enable-dns-hostnames --vpc-id $VPC_ID<br/>aws ec2 modify-vpc-attribute --enable-dns-support --vpc-id $VPC_ID</span></pre><p id="543d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">创建私有和公共子网</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="d1e8" class="le lf hi la b fi lg lh l li lj">aws ec2 create-subnet \<br/>     --availability-zone us-west-2a \<br/>     --vpc-id $VPC_ID \<br/>     --cidr-block 10.0.1.0/24 \<br/>     --tag-specifications 'ResourceType=subnet, Tags=[{Key=Name,Value=anthosAWSPrivateSubnet1}]'<br/>   aws ec2 create-subnet \<br/>     --availability-zone us-west-2b \<br/>     --vpc-id $VPC_ID \<br/>     --cidr-block 10.0.2.0/24 \<br/>     --tag-specifications 'ResourceType=subnet, Tags=[{Key=Name,Value=anthosAWSPrivateSubnet2}]'<br/>   aws ec2 create-subnet \<br/>     --availability-zone us-west-2c \<br/>     --vpc-id $VPC_ID \<br/>     --cidr-block 10.0.3.0/24 \<br/>     --tag-specifications 'ResourceType=subnet, Tags=[{Key=Name,Value=anthosAWSPrivateSubnet3}]'</span><span id="9c48" class="le lf hi la b fi lk lh l li lj">aws ec2 create-subnet \<br/>  --availability-zone us-west-2a \<br/>  --vpc-id $VPC_ID \<br/>  --cidr-block 10.0.101.0/24 \<br/>  --tag-specifications 'ResourceType=subnet, Tags=[{Key=Name,Value=anthosAWSPublicSubnet1}]'<br/>aws ec2 create-subnet \<br/>  --availability-zone us-west-2b \<br/>  --vpc-id $VPC_ID \<br/>  --cidr-block 10.0.102.0/24 \<br/>  --tag-specifications 'ResourceType=subnet, Tags=[{Key=Name,Value=anthosAWSPublicSubnet2}]'<br/>aws ec2 create-subnet \<br/>  --availability-zone us-west-2c \<br/>  --vpc-id $VPC_ID \<br/>  --cidr-block 10.0.103.0/24 \<br/>  --tag-specifications 'ResourceType=subnet, Tags=[{Key=Name,Value=anthosAWSPublicSubnet3}]'</span></pre><p id="0bfe" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">将子网标记为公共</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="5bb4" class="le lf hi la b fi lg lh l li lj">PUBLIC_SUBNET_ID_1=$(aws ec2 describe-subnets \<br/>  --filters 'Name=tag:Name,Values=anthosAWSPublicSubnet1' \<br/>  --query "Subnets[].SubnetId" --output text)<br/>PUBLIC_SUBNET_ID_2=$(aws ec2 describe-subnets \<br/>  --filters 'Name=tag:Name,Values=anthosAWSPublicSubnet2' \<br/>  --query "Subnets[].SubnetId" --output text)<br/>PUBLIC_SUBNET_ID_3=$(aws ec2 describe-subnets \<br/>  --filters 'Name=tag:Name,Values=anthosAWSPublicSubnet3' \<br/>  --query "Subnets[].SubnetId" --output text)<br/>aws ec2 modify-subnet-attribute \<br/>  --map-public-ip-on-launch \<br/>  --subnet-id $PUBLIC_SUBNET_ID_1<br/>aws ec2 modify-subnet-attribute \<br/>  --map-public-ip-on-launch \<br/>  --subnet-id $PUBLIC_SUBNET_ID_2<br/>aws ec2 modify-subnet-attribute \<br/>  --map-public-ip-on-launch \<br/>  --subnet-id $PUBLIC_SUBNET_ID_3</span></pre><p id="0c54" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">创建互联网网关</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="2fcf" class="le lf hi la b fi lg lh l li lj">aws --region $AWS_REGION  ec2 create-internet-gateway \<br/>  --tag-specifications 'ResourceType=internet-gateway, Tags=[{Key=Name,Value=anthosAWSInternetGateway}]'</span><span id="cb15" class="le lf hi la b fi lk lh l li lj">INTERNET_GW_ID=$(aws ec2 describe-internet-gateways \<br/>  --filters 'Name=tag:Name,Values=anthosAWSInternetGateway' \<br/>  --query "InternetGateways[].InternetGatewayId" --output text)</span><span id="59fc" class="le lf hi la b fi lk lh l li lj">aws ec2 attach-internet-gateway \<br/>  --internet-gateway-id $INTERNET_GW_ID \<br/>  --vpc-id $VPC_ID</span></pre><p id="0e44" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">为公共子网配置路由表</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="d5c7" class="le lf hi la b fi lg lh l li lj">aws ec2 create-route-table --vpc-id $VPC_ID \<br/>  --tag-specifications 'ResourceType=route-table, Tags=[{Key=Name,Value=anthosAWSPublicRouteTbl1}]'<br/>aws ec2 create-route-table --vpc-id $VPC_ID \<br/>  --tag-specifications 'ResourceType=route-table, Tags=[{Key=Name,Value=anthosAWSPublicRouteTbl2}]'<br/>aws ec2 create-route-table --vpc-id $VPC_ID \<br/>  --tag-specifications 'ResourceType=route-table, Tags=[{Key=Name,Value=anthosAWSPublicRouteTbl3}]'</span><span id="bf51" class="le lf hi la b fi lk lh l li lj">PUBLIC_ROUTE_TABLE_ID_1=$(aws ec2 describe-route-tables \<br/>    --filters 'Name=tag:Name,Values=anthosAWSPublicRouteTbl1' \<br/>    --query "RouteTables[].RouteTableId" --output text)<br/>PUBLIC_ROUTE_TABLE_ID_2=$(aws ec2 describe-route-tables \<br/>    --filters 'Name=tag:Name,Values=anthosAWSPublicRouteTbl2' \<br/>    --query "RouteTables[].RouteTableId" --output text)<br/>PUBLIC_ROUTE_TABLE_ID_3=$(aws ec2 describe-route-tables \<br/>    --filters 'Name=tag:Name,Values=anthosAWSPublicRouteTbl3' \<br/>    --query "RouteTables[].RouteTableId" --output text)<br/>aws ec2 associate-route-table \<br/>  --route-table-id $PUBLIC_ROUTE_TABLE_ID_1 \<br/>  --subnet-id $PUBLIC_SUBNET_ID_1<br/>aws ec2 associate-route-table \<br/>  --route-table-id $PUBLIC_ROUTE_TABLE_ID_2 \<br/>  --subnet-id $PUBLIC_SUBNET_ID_2<br/>aws ec2 associate-route-table \<br/>  --route-table-id $PUBLIC_ROUTE_TABLE_ID_3 \<br/>  --subnet-id $PUBLIC_SUBNET_ID_3</span><span id="7061" class="le lf hi la b fi lk lh l li lj">aws ec2 create-route --route-table-id $PUBLIC_ROUTE_TABLE_ID_1 \<br/>  --destination-cidr-block 0.0.0.0/0 --gateway-id $INTERNET_GW_ID<br/>aws ec2 create-route --route-table-id $PUBLIC_ROUTE_TABLE_ID_2 \<br/>  --destination-cidr-block 0.0.0.0/0 --gateway-id $INTERNET_GW_ID<br/>aws ec2 create-route --route-table-id $PUBLIC_ROUTE_TABLE_ID_3 \<br/>  --destination-cidr-block 0.0.0.0/0 --gateway-id $INTERNET_GW_ID</span><span id="c162" class="le lf hi la b fi lk lh l li lj">aws ec2 allocate-address \<br/>  --tag-specifications 'ResourceType=elastic-ip, Tags=[{Key=Name,Value=anthosAWSNatEip1}]'<br/>aws ec2 allocate-address \<br/>  --tag-specifications 'ResourceType=elastic-ip, Tags=[{Key=Name,Value=anthosAWSNatEip2}]'<br/>aws ec2 allocate-address \<br/>  --tag-specifications 'ResourceType=elastic-ip, Tags=[{Key=Name,Value=anthosAWSNatEip3}]'</span></pre><p id="c36b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">创建NAT网关</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="0ec3" class="le lf hi la b fi lg lh l li lj">NAT_EIP_ALLOCATION_ID_1=$(aws ec2 describe-addresses \<br/>     --filters 'Name=tag:Name,Values=anthosAWSNatEip1' \<br/>     --query "Addresses[].AllocationId" --output text)<br/>   NAT_EIP_ALLOCATION_ID_2=$(aws ec2 describe-addresses \<br/>     --filters 'Name=tag:Name,Values=anthosAWSNatEip2' \<br/>     --query "Addresses[].AllocationId" --output text)<br/>   NAT_EIP_ALLOCATION_ID_3=$(aws ec2 describe-addresses \<br/>     --filters 'Name=tag:Name,Values=anthosAWSNatEip3' \<br/>     --query "Addresses[].AllocationId" --output text)<br/>   aws ec2 create-nat-gateway \<br/>     --allocation-id $NAT_EIP_ALLOCATION_ID_1 \<br/>     --subnet-id $PUBLIC_SUBNET_ID_1 \<br/>     --tag-specifications 'ResourceType=natgateway, Tags=[{Key=Name,Value=anthosAWSNatGateway1}]'<br/>   aws ec2 create-nat-gateway \<br/>     --allocation-id $NAT_EIP_ALLOCATION_ID_2 \<br/>     --subnet-id $PUBLIC_SUBNET_ID_2 \<br/>     --tag-specifications 'ResourceType=natgateway, Tags=[{Key=Name,Value=anthosAWSNatGateway2}]'<br/>   aws ec2 create-nat-gateway \<br/>     --allocation-id $NAT_EIP_ALLOCATION_ID_3 \<br/>     --subnet-id $PUBLIC_SUBNET_ID_3 \<br/>     --tag-specifications 'ResourceType=natgateway, Tags=[{Key=Name,Value=anthosAWSNatGateway3}]'</span></pre><p id="7990" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">为私有子网配置路由表</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="e598" class="le lf hi la b fi lg lh l li lj">aws ec2 create-route-table --vpc-id $VPC_ID \<br/>  --tag-specifications 'ResourceType=route-table, Tags=[{Key=Name,Value=anthosAWSPrivateRouteTbl1}]'<br/>aws ec2 create-route-table --vpc-id $VPC_ID \<br/>  --tag-specifications 'ResourceType=route-table, Tags=[{Key=Name,Value=anthosAWSPrivateRouteTbl2}]'<br/>aws ec2 create-route-table --vpc-id $VPC_ID \<br/>  --tag-specifications 'ResourceType=route-table, Tags=[{Key=Name,Value=anthosAWSPrivateRouteTbl3}]'</span><span id="1a37" class="le lf hi la b fi lk lh l li lj">PRIVATE_SUBNET_ID_1=$(aws ec2 describe-subnets \<br/>  --filters 'Name=tag:Name,Values=anthosAWSPrivateSubnet1' \<br/>  --query "Subnets[].SubnetId" --output text)<br/>PRIVATE_SUBNET_ID_2=$(aws ec2 describe-subnets \<br/>  --filters 'Name=tag:Name,Values=anthosAWSPrivateSubnet2' \<br/>  --query "Subnets[].SubnetId" --output text)<br/>PRIVATE_SUBNET_ID_3=$(aws ec2 describe-subnets \<br/>  --filters 'Name=tag:Name,Values=anthosAWSPrivateSubnet3' \<br/>  --query "Subnets[].SubnetId" --output text)<br/>PRIVATE_ROUTE_TABLE_ID_1=$(aws ec2 describe-route-tables \<br/>  --filters 'Name=tag:Name,Values=anthosAWSPrivateRouteTbl1' \<br/>  --query "RouteTables[].RouteTableId" --output text)<br/>PRIVATE_ROUTE_TABLE_ID_2=$(aws ec2 describe-route-tables \<br/>  --filters 'Name=tag:Name,Values=anthosAWSPrivateRouteTbl2' \<br/>  --query "RouteTables[].RouteTableId" --output text)<br/>PRIVATE_ROUTE_TABLE_ID_3=$(aws ec2 describe-route-tables \<br/>  --filters 'Name=tag:Name,Values=anthosAWSPrivateRouteTbl3' \<br/>  --query "RouteTables[].RouteTableId" --output text)<br/>aws ec2 associate-route-table --route-table-id $PRIVATE_ROUTE_TABLE_ID_1 \<br/>  --subnet-id $PRIVATE_SUBNET_ID_1<br/>aws ec2 associate-route-table --route-table-id $PRIVATE_ROUTE_TABLE_ID_2 \<br/>  --subnet-id $PRIVATE_SUBNET_ID_2<br/>aws ec2 associate-route-table --route-table-id $PRIVATE_ROUTE_TABLE_ID_3 \<br/>  --subnet-id $PRIVATE_SUBNET_ID_3</span><span id="591b" class="le lf hi la b fi lk lh l li lj">NAT_GW_ID_1=$(aws ec2 describe-nat-gateways \<br/> --filter 'Name=tag:Name,Values=anthosAWSNatGateway1' \<br/> --query "NatGateways[].NatGatewayId" --output text)<br/>NAT_GW_ID_2=$(aws ec2 describe-nat-gateways \<br/> --filter 'Name=tag:Name,Values=anthosAWSNatGateway2' \<br/> --query "NatGateways[].NatGatewayId" --output text)<br/>NAT_GW_ID_3=$(aws ec2 describe-nat-gateways \<br/> --filter 'Name=tag:Name,Values=anthosAWSNatGateway3' \<br/> --query "NatGateways[].NatGatewayId" --output text)<br/>aws ec2 create-route --route-table-id $PRIVATE_ROUTE_TABLE_ID_1  \<br/>  --destination-cidr-block 0.0.0.0/0 --gateway-id $NAT_GW_ID_1<br/>aws ec2 create-route --route-table-id $PRIVATE_ROUTE_TABLE_ID_2  \<br/>  --destination-cidr-block 0.0.0.0/0 --gateway-id $NAT_GW_ID_2<br/>aws ec2 create-route --route-table-id $PRIVATE_ROUTE_TABLE_ID_3 \<br/>  --destination-cidr-block 0.0.0.0/0 --gateway-id $NAT_GW_ID_3</span></pre><p id="11ce" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">为负载平衡器标记子网</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="dcce" class="le lf hi la b fi lg lh l li lj">aws ec2 create-tags \<br/>  --resources $PUBLIC_SUBNET_ID_1 \<br/>  --tags Key=kubernetes.io/role/elb,Value=1<br/>aws ec2 create-tags \<br/>  --resources $PUBLIC_SUBNET_ID_2 \<br/>  --tags Key=kubernetes.io/role/elb,Value=1<br/>aws ec2 create-tags \<br/>  --resources $PUBLIC_SUBNET_ID_3 \<br/>  --tags Key=kubernetes.io/role/elb,Value=1</span><span id="d1eb" class="le lf hi la b fi lk lh l li lj">aws ec2 create-tags \<br/>  --resources $PRIVATE_SUBNET_ID_1 \<br/>  --tags Key=kubernetes.io/role/internal-elb,Value=1<br/>aws ec2 create-tags \<br/>  --resources $PRIVATE_SUBNET_ID_2 \<br/>  --tags Key=kubernetes.io/role/internal-elb,Value=1<br/>aws ec2 create-tags \<br/>  --resources $PRIVATE_SUBNET_ID_3 \<br/>  --tags Key=kubernetes.io/role/internal-elb,Value=1</span></pre><p id="c97d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">在AWS中创建KMS键</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="48d3" class="le lf hi la b fi lg lh l li lj">AWS_KMS_DATA=$(<!-- -->aws --region $AWS_REGION kms create-key \<br/>    --description "kms_key"<!-- -->)</span><span id="036e" class="le lf hi la b fi lk lh l li lj">AWS_KMS_ARN=$(echo $AWS_KMS_DATA | jq .KeyMetadata.Arn -r)</span></pre><p id="0eb4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">创建IAM策略和角色</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="38bb" class="le lf hi la b fi lg lh l li lj">PROJECT_ID="$(gcloud config get-value project)"</span><span id="9a0a" class="le lf hi la b fi lk lh l li lj">PROJECT_NUMBER=$(gcloud projects describe "$PROJECT_ID" \<br/>  --format "value(projectNumber)")<br/><br/>aws iam create-role --role-name ANTHOS_API_ROLE \<br/>  --assume-role-policy-document '{<br/>  "Version": "2012-10-17",<br/>  "Statement": [<br/>    {<br/>      "Sid": "",<br/>      "Effect": "Allow",<br/>      "Principal": {<br/>        "Federated": "accounts.google.com"<br/>      },<br/>      "Action": "sts:AssumeRoleWithWebIdentity",<br/>      "Condition": {<br/>        "StringEquals": {<br/>          "accounts.google.com:sub": "service-'$PROJECT_NUMBER'@gcp-sa-gkemulticloud.iam.gserviceaccount.com"<br/>        }<br/>      }<br/>    }<br/>  ]<br/>}'</span><span id="4a57" class="le lf hi la b fi lk lh l li lj">ANTHOS_API_ROLE_ARN=$(aws iam get-role --role-name "ANTHOS_API_ROLE" --query "Role.Arn" --output text)</span><span id="429b" class="le lf hi la b fi lk lh l li lj">aws iam create-policy --policy-name ANTHOS_API_POLICY \<br/>    --policy-document '{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Sid": "",<br/>            "Effect": "Allow",<br/>            "Action": [<br/>                "kms:Encrypt",<br/>                "kms:DescribeKey",<br/>                "iam:CreateServiceLinkedRole",<br/>                "iam:PassRole",<br/>                "elasticloadbalancing:DescribeTargetHealth",<br/>                "elasticloadbalancing:DescribeTargetGroups",<br/>                "elasticloadbalancing:DescribeLoadBalancers",<br/>                "elasticloadbalancing:DescribeListeners",<br/>                "elasticloadbalancing:DeleteTargetGroup",<br/>                "elasticloadbalancing:DeleteLoadBalancer",<br/>                "elasticloadbalancing:DeleteListener",<br/>                "elasticloadbalancing:CreateTargetGroup",<br/>                "elasticloadbalancing:CreateLoadBalancer",<br/>                "elasticloadbalancing:CreateListener",<br/>                "elasticloadbalancing:AddTags",<br/>                "elasticloadbalancing:ModifyTargetGroupAttributes",<br/>                "ec2:ModifyNetworkInterfaceAttribute",<br/>                "ec2:DescribeAccountAttributes",<br/>                "ec2:DescribeInternetGateways",<br/>                "ec2:RunInstances",<br/>                "ec2:RevokeSecurityGroupIngress",<br/>                "ec2:RevokeSecurityGroupEgress",<br/>                "ec2:DescribeVpcs",<br/>                "ec2:DescribeVolumes",<br/>                "ec2:DescribeSubnets",<br/>                "ec2:DescribeSecurityGroups",<br/>                "ec2:DescribeNetworkInterfaces",<br/>                "ec2:DescribeLaunchTemplates",<br/>                "ec2:DescribeKeyPairs",<br/>                "ec2:DeleteVolume",<br/>                "ec2:DeleteTags",<br/>                "ec2:DeleteSecurityGroup",<br/>                "ec2:DeleteNetworkInterface",<br/>                "ec2:DeleteLaunchTemplate",<br/>                "ec2:CreateVolume",<br/>                "ec2:CreateTags",<br/>                "ec2:CreateSecurityGroup",<br/>                "ec2:CreateNetworkInterface",<br/>                "ec2:CreateLaunchTemplate",<br/>                "ec2:AuthorizeSecurityGroupIngress",<br/>                "ec2:AuthorizeSecurityGroupEgress",<br/>                "autoscaling:UpdateAutoScalingGroup",<br/>                "autoscaling:TerminateInstanceInAutoScalingGroup",<br/>                "autoscaling:DescribeAutoScalingGroups",<br/>                "autoscaling:DeleteTags",<br/>                "autoscaling:DeleteAutoScalingGroup",<br/>                "autoscaling:CreateOrUpdateTags",<br/>                "autoscaling:CreateAutoScalingGroup"<br/>            ],<br/>            "Resource": "*"<br/>        }<br/>    ]<br/>}'</span><span id="9b27" class="le lf hi la b fi lk lh l li lj">ANTHOS_API_POLICY_ARN=arn:aws:iam::$(aws sts get-caller-identity | jq .Account -r):policy/ANTHOS_API_POLICY</span><span id="1bd7" class="le lf hi la b fi lk lh l li lj">aws iam attach-role-policy \<br/> --policy-arn $ANTHOS_API_POLICY_ARN \<br/> --role-name ANTHOS_API_ROLE</span><span id="94dd" class="le lf hi la b fi lk lh l li lj">aws iam create-role --role-name ANTHOS_CONTROL_PLANE_ROLE \<br/>  --assume-role-policy-document '{<br/>  "Version": "2012-10-17",<br/>  "Statement": [<br/>    {<br/>      "Sid": "",<br/>      "Effect": "Allow",<br/>      "Principal": {<br/>        "Service": "ec2.amazonaws.com"<br/>      },<br/>      "Action": "sts:AssumeRole"<br/>    }<br/>  ]<br/>}'</span><span id="7304" class="le lf hi la b fi lk lh l li lj">aws iam create-policy --policy-name ANTHOS_CONTROL_PLANE_POLICY \<br/>    --policy-document '{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Sid": "",<br/>            "Effect": "Allow",<br/>            "Action": [<br/>                "kms:Encrypt",<br/>                "kms:Decrypt"<br/>            ],<br/>            "Resource": "'"$AWS_KMS_ARN"'"<br/>        },<br/>        {<br/>            "Sid": "",<br/>            "Effect": "Allow",<br/>            "Action": [<br/>                "iam:CreateServiceLinkedRole",<br/>                "elasticloadbalancing:SetLoadBalancerPoliciesOfListener",<br/>                "elasticloadbalancing:SetLoadBalancerPoliciesForBackendServer",<br/>                "elasticloadbalancing:RegisterTargets",<br/>                "elasticloadbalancing:RegisterInstancesWithLoadBalancer",<br/>                "elasticloadbalancing:ModifyTargetGroup",<br/>                "elasticloadbalancing:ModifyLoadBalancerAttributes",<br/>                "elasticloadbalancing:ModifyListener",<br/>                "elasticloadbalancing:DetachLoadBalancerFromSubnets",<br/>                "elasticloadbalancing:DescribeTargetHealth",<br/>                "elasticloadbalancing:DescribeTargetGroups",<br/>                "elasticloadbalancing:DescribeLoadBalancers",<br/>                "elasticloadbalancing:DescribeLoadBalancerPolicies",<br/>                "elasticloadbalancing:DescribeLoadBalancerAttributes",<br/>                "elasticloadbalancing:DescribeListeners",<br/>                "elasticloadbalancing:DeregisterTargets",<br/>                "elasticloadbalancing:DeregisterInstancesFromLoadBalancer",<br/>                "elasticloadbalancing:DeleteTargetGroup",<br/>                "elasticloadbalancing:DeleteLoadBalancerListeners",<br/>                "elasticloadbalancing:DeleteLoadBalancer",<br/>                "elasticloadbalancing:DeleteListener",<br/>                "elasticloadbalancing:CreateTargetGroup",<br/>                "elasticloadbalancing:CreateLoadBalancerPolicy",<br/>                "elasticloadbalancing:CreateLoadBalancerListeners",<br/>                "elasticloadbalancing:CreateLoadBalancer",<br/>                "elasticloadbalancing:CreateListener",<br/>                "elasticloadbalancing:ConfigureHealthCheck",<br/>                "elasticloadbalancing:AttachLoadBalancerToSubnets",<br/>                "elasticloadbalancing:ApplySecurityGroupsToLoadBalancer",<br/>                "elasticloadbalancing:AddTags",<br/>                "ec2:RevokeSecurityGroupIngress",<br/>                "ec2:ModifyVolume",<br/>                "ec2:ModifyInstanceAttribute",<br/>                "ec2:DetachVolume",<br/>                "ec2:DescribeDhcpOptions",<br/>                "ec2:DescribeVpcs",<br/>                "ec2:DescribeVolumesModifications",<br/>                "ec2:DescribeVolumes",<br/>                "ec2:DescribeTags",<br/>                "ec2:DescribeSubnets",<br/>                "ec2:DescribeSnapshots",<br/>                "ec2:DescribeSecurityGroups",<br/>                "ec2:DescribeRouteTables",<br/>                "ec2:DescribeRegions",<br/>                "ec2:DescribeLaunchTemplateVersions",<br/>                "ec2:DescribeInstances",<br/>                "ec2:DeleteVolume",<br/>                "ec2:DeleteTags",<br/>                "ec2:DeleteSnapshot",<br/>                "ec2:DeleteSecurityGroup",<br/>                "ec2:DeleteRoute",<br/>                "ec2:CreateVolume",<br/>                "ec2:CreateTags",<br/>                "ec2:CreateSnapshot",<br/>                "ec2:CreateSecurityGroup",<br/>                "ec2:CreateRoute",<br/>                "ec2:AuthorizeSecurityGroupIngress",<br/>                "ec2:AttachVolume",<br/>                "ec2:AttachNetworkInterface",<br/>                "autoscaling:TerminateInstanceInAutoScalingGroup",<br/>                "autoscaling:SetDesiredCapacity",<br/>                "autoscaling:DescribeTags",<br/>                "autoscaling:DescribeLaunchConfigurations",<br/>                "autoscaling:DescribeAutoScalingInstances",<br/>                "autoscaling:DescribeAutoScalingGroups"<br/>            ],<br/>            "Resource": "*"<br/>        }<br/>    ]<br/>}'</span><span id="ec83" class="le lf hi la b fi lk lh l li lj">ANTHOS_CONTROL_PLANE_POLICY_ARN=arn:aws:iam::$(aws sts get-caller-identity | jq .Account -r):policy/ANTHOS_CONTROL_PLANE_POLICY</span><span id="29f0" class="le lf hi la b fi lk lh l li lj">aws iam attach-role-policy \<br/>  --policy-arn $ANTHOS_CONTROL_PLANE_POLICY_ARN \<br/>  --role-name ANTHOS_CONTROL_PLANE_ROLE</span><span id="a7f3" class="le lf hi la b fi lk lh l li lj">aws iam create-instance-profile \<br/>  --instance-profile-name ANTHOS_CONTROL_PLANE_PROFILE</span><span id="fa49" class="le lf hi la b fi lk lh l li lj">aws iam add-role-to-instance-profile \<br/>  --instance-profile-name ANTHOS_CONTROL_PLANE_PROFILE \<br/>  --role-name ANTHOS_CONTROL_PLANE_ROLE</span><span id="5e7d" class="le lf hi la b fi lk lh l li lj">aws iam create-role --role-name ANTHOS_NODE_POOL_ROLE \<br/>  --assume-role-policy-document '{<br/>  "Version": "2012-10-17",<br/>  "Statement": [<br/>    {<br/>      "Sid": "",<br/>      "Effect": "Allow",<br/>      "Principal": {<br/>        "Service": "ec2.amazonaws.com"<br/>      },<br/>      "Action": "sts:AssumeRole"<br/>    }<br/>  ]<br/>}'</span><span id="df1c" class="le lf hi la b fi lk lh l li lj">aws iam create-policy \<br/>    --policy-name ANTHOS_NODE_POOL_POLICY \<br/>    --policy-document '{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Sid": "",<br/>            "Effect": "Allow",<br/>            "Action": [<br/>                "kms:Encrypt",<br/>                "kms:Decrypt"<br/>            ],<br/>            "Resource": "'"$<!-- -->AWS_KMS_ARN<!-- -->"'"<br/>        },<br/>        {<br/>            "Sid": "",<br/>            "Effect": "Allow",<br/>            "Action": [<br/>               "autoscaling:DescribeAutoScalingGroups",<br/>               "ec2:AttachNetworkInterface",<br/>               "ec2:DescribeInstances",<br/>               "ec2:DescribeTags"<br/>            ],<br/>            "Resource": "*"<br/>        }<br/>    ]<br/>}'</span><span id="491f" class="le lf hi la b fi lk lh l li lj">ANTHOS_NODE_POOL_POLICY_ARN=arn:aws:iam::$(aws sts get-caller-identity | jq .Account -r):policy/ANTHOS_NODE_POOL_POLICY</span><span id="e6d0" class="le lf hi la b fi lk lh l li lj">aws iam attach-role-policy --role-name ANTHOS_NODE_POOL_ROLE \<br/>  --policy-arn $ANTHOS_NODE_POOL_POLICY_ARN</span><span id="e3b2" class="le lf hi la b fi lk lh l li lj">aws iam create-instance-profile \<br/>    --instance-profile-name ANTHOS_NODE_POOL_PROFILE</span><span id="67bd" class="le lf hi la b fi lk lh l li lj">aws iam add-role-to-instance-profile \<br/>  --instance-profile-name ANTHOS_NODE_POOL_PROFILE \<br/>  --role-name ANTHOS_NODE_POOL_ROLE</span></pre><p id="ad66" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">创建一个EC2密钥对</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="f402" class="le lf hi la b fi lg lh l li lj">ssh-keygen -t rsa -m PEM -b 4096 -C "$USER" \<br/>      -f SSH_PRIVATE_KEY -N "" 1&gt;/dev/null<br/><br/>aws ec2 import-key-pair --key-name ANTHOS_SSH_KEY_PAIR \<br/>      --public-key-material fileb://SSH_PRIVATE_KEY.pub</span></pre><p id="6a9c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> Anthos部署</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="82ce" class="le lf hi la b fi lg lh l li lj">gcloud config set container_aws/location $AWS_REGION</span></pre><p id="90b4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">创建一个集群</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="b0b1" class="le lf hi la b fi lg lh l li lj">gcloud container aws clusters create aws-cluster-0 \<br/>    --cluster-version 1.21.6-gke.1500 \<br/>    --aws-region $AWS_REGION \<br/>    --fleet-project $PROJECT_ID \<br/>    --vpc-id $VPC_ID \<br/>    --subnet-ids $PRIVATE_SUBNET_ID_1,$PRIVATE_SUBNET_ID_2,$PRIVATE_SUBNET_ID_3 \<br/>    --pod-address-cidr-blocks 172.31.0.0/20 \<br/>    --service-address-cidr-blocks 172.31.32.0/20 \<br/>    --role-arn $ANTHOS_API_ROLE_ARN \<br/>    --iam-instance-profile ANTHOS_CONTROL_PLANE_PROFILE \<br/>    --database-encryption-kms-key-arn $AWS_KMS_ARN \<br/>    --config-encryption-kms-key-arn $AWS_KMS_ARN \<br/>    --tags "google:gkemulticloud:cluster=aws-cluster-0" \<br/>    <!-- -->--location $GCP_REGION</span></pre><p id="df86" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">创建节点池</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="c7b9" class="le lf hi la b fi lg lh l li lj">gcloud container aws node-pools create pool-0 \<br/>    --cluster aws-cluster-0 \<br/>    --node-version 1.21.6-gke.1500 \<br/>    --min-nodes 1 \<br/>    --max-nodes 5 \<br/>    --max-pods-per-node 110 \<br/>    --root-volume-size 50 \<br/>    --subnet-id $PRIVATE_SUBNET_ID_1 \<br/>    --iam-instance-profile ANTHOS_NODE_POOL_PROFILE \<br/>    --config-encryption-kms-key-arn $AWS_KMS_ARN \<br/>    --ssh-ec2-key-pair ANTHOS_SSH_KEY_PAIR \<br/>    --tags "google:gkemulticloud:cluster=aws-cluster-0" \<br/>    <!-- -->--location $GCP_REGION</span></pre><p id="1ee0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">获取集群的身份验证凭据</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="356c" class="le lf hi la b fi lg lh l li lj">gcloud container aws clusters get-credentials aws-cluster-0 --<!-- -->location $GCP_REGION</span></pre><p id="5a4f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">克隆线上精品库。</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="13a9" class="le lf hi la b fi lg lh l li lj">git clone <a class="ae kc" href="https://github.com/GoogleCloudPlatform/microservices-demo.git" rel="noopener ugc nofollow" target="_blank">https://github.com/GoogleCloudPlatform/microservices-demo.git</a><br/>cd microservices-demo</span></pre><p id="8c7f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">部署在线精品应用</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="ba4f" class="le lf hi la b fi lg lh l li lj">kubectl apply -f ./release/kubernetes-manifests.yaml</span></pre><p id="6a3e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">通过AWS负载平衡器端点</strong>检查您的应用程序</p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="0a43" class="le lf hi la b fi lg lh l li lj">kubectl get service frontend-external | awk '{print $4}'</span></pre><p id="9578" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们已经部署并注册了Anthos集群，我们可以在GCP控制台中查看它。</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es lm"><img src="../Images/a336bec900a0fc88805a6f21bd8bfeac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gfoXPvKnxJEvfsD1HPLnuw.png"/></div></div></figure><p id="7907" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">登录集群</strong></p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es ln"><img src="../Images/b5ab5b117dde74e10667cc95e4225ad1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7j7QdQybsxx9s8vDtIGyzg.png"/></div></div></figure><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es lo"><img src="../Images/8da122adf791bec1443e3ddddf8c3232.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ESG_4YPMhRQtbELjdq0wQA.png"/></div></div></figure><p id="e736" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">您可以探索Kubernetes引擎UI，并获得集群的所有信息。</strong></p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es lp"><img src="../Images/ef926a003f7dfff06409307be6a0b5e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f_oZ3ha1B0aJKgFHOuOTFg.png"/></div></div></figure><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es lq"><img src="../Images/1d518aaf063c84a8dc524e7b14b6fc18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4DQdTyULVHY1uEoVjrLgww.png"/></div></div></figure><p id="074b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">由于Anthos使用AWS EC2作为其控制平面和节点，您也可以在AWS控制台中查看它们。</strong></p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es lr"><img src="../Images/eb2ed996f7ec5c33f47d31c5fd99a33c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yj969eeun2F78KwwQKf6Og.png"/></div></div></figure><p id="c0d3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们安装Anthos Service mesh来更好地了解微服务。</p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="7335" class="le lf hi la b fi lg lh l li lj">curl https://storage.googleapis.com/csm-artifacts/asm/asmcli_1.12 &gt; asmcli</span><span id="da9f" class="le lf hi la b fi lk lh l li lj">chmod +x asmcli</span><span id="0248" class="le lf hi la b fi lk lh l li lj">KUBECONFIG_LOCATION=$(echo "$HOME/.kube/config")</span><span id="b63c" class="le lf hi la b fi lk lh l li lj">./asmcli install \<br/>  --fleet_id $PROJECT_ID \<br/>  --kubeconfig $KUBECONFIG_LOCATION \<br/>  --platform multicloud \<br/>  --enable_all \<br/>  --ca mesh_ca</span><span id="cb29" class="le lf hi la b fi lk lh l li lj">kubectl -n istio-system get pods -l app=istiod --show-labels</span><span id="526c" class="le lf hi la b fi lk lh l li lj">REV=[rev-label]<br/></span><span id="e80e" class="le lf hi la b fi lk lh l li lj">kubectl label namespace default istio.io/rev=${REV} istio-injection- --overwrite<br/></span><span id="7b31" class="le lf hi la b fi lk lh l li lj">kubectl delete pod -n default --all<br/></span><span id="2590" class="le lf hi la b fi lk lh l li lj">kubectl get pod -n default</span></pre><p id="bc6f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">你可以查看Anthos Service Mesh仪表盘，里面应该会列出所有的服务。</strong></p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es ls"><img src="../Images/2108744aa433d9ddf31d257371386647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TeMFDwe2leDl-O0MDBOPwg.png"/></div></div></figure><p id="bd72" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">您可以使用以下命令删除集群，以避免在EC2上进行不必要的计费。</strong></p><pre class="ke kf kg kh fd kz la lb lc aw ld bi"><span id="8efd" class="le lf hi la b fi lg lh l li lj">gcloud container aws node-pools delete pool-0 --cluster aws-cluster-0 --location <!-- -->$GCP_REGION</span><span id="a605" class="le lf hi la b fi lk lh l li lj">gcloud container aws clusters delete aws-cluster-0 --location <!-- -->$GCP_REGION</span></pre><p id="94af" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">供稿人:<a class="lt lu ge" href="https://medium.com/u/c79cc28e2999?source=post_page-----fc70ce352c40--------------------------------" rel="noopener" target="_blank">普什卡·科塔瓦德</a>，<a class="lt lu ge" href="https://medium.com/u/41b475b881ff?source=post_page-----fc70ce352c40--------------------------------" rel="noopener" target="_blank">施吉莫尔·阿·克</a>，<a class="lt lu ge" href="https://medium.com/u/71d9487165c6?source=post_page-----fc70ce352c40--------------------------------" rel="noopener" target="_blank">丹杜斯</a></p></div></div>    
</body>
</html>