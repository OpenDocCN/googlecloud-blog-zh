<html>
<head>
<title>Advanced Caching Part 2: Google Cloud CDN and Apache</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">高级缓存第2部分:Google Cloud CDN和Apache</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/advanced-caching-part-2-google-cloud-cdn-and-apache-fccf4ca84a9f?source=collection_archive---------2-----------------------#2019-08-21">https://medium.com/google-cloud/advanced-caching-part-2-google-cloud-cdn-and-apache-fccf4ca84a9f?source=collection_archive---------2-----------------------#2019-08-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/2eef8edbdb4fff13cee922536593e6ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-FOFFcNLhvPxCq_vPATg5Q.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">如果Google Cloud CDN和Varnish Cache都不够用，那就该DIY了</figcaption></figure><div class=""/><p id="9ede" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi js translated"><span class="l jt ju jv bm jw jx jy jz ka di">在</span>第1部分，Google Cloud CDN和Varnish中，我们学习了缓存动态响应。在第2部分中，我们完全去掉了图片上的清漆，并且自己完成了所有的工作。假设Google Cloud CDN已经启动并运行，我们可以使用Apache在HTML响应被缓存之前对其进行修改。</p></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><p id="b766" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> 1。Apache模块mod_substitute <br/> </strong>在谷歌计算引擎(GCE)虚拟机(VM)上启用Apache模块<a class="ae ki" href="http://httpd.apache.org/docs/2.4/mod/mod_substitute.html" rel="noopener ugc nofollow" target="_blank"> mod_substitute </a></p><p id="4340" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="kj"> sudo a2enmod替换<br/> sudo服务apache2重启</em></p><p id="37b4" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">注意:以上终端命令适用于Ubuntu Linux</p><p id="b794" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> 2。在. js文件中添加所需的JavaScript代码</strong></p><figure class="kl km kn ko fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kk"><img src="../Images/1dae7f01eec390dc3b802973432b79ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2MN5fBsPnY7vQwU_TDGRpQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">创建一个. js文件来保存所需的JavaScript代码(在最终用户的web浏览器上运行)</figcaption></figure><p id="c68a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> 3。使用Apache Substitute插入一个&lt;脚本&gt;标签<br/> </strong> Apache的mod_substitute模块允许您编写标记规则</p><p id="e4ed" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="kj">vim/etc/Apache 2/ports . conf</em></p><p id="e926" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在ports.conf文件中，这些标记命令允许您利用Linux替代命令“s”</p><p id="d8c1" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">将步骤2中的JavaScript文件放入脚本标记中</p><figure class="kl km kn ko fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kp"><img src="../Images/07d48d32046e34d02deccd97bbc67081.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IwTWl2emy9uDfYppexBMqQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">使用Linux替代命令“s”将JavaScript文件插入到HTML响应中</figcaption></figure><p id="6e85" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> 4。为不同的目录和文件制定规则</strong> <br/>请注意，上述替换中的&lt;位置&gt;标签<br/>这种替换是针对web服务器根目录<br/>中的所有网页，针对特定的web目录和文件使用附加的&lt;位置&gt;标签</p><p id="28ba" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy"> 5。响应身体修改有效！</strong><br/>HTML响应中的&lt; head &gt;标签被Apache <br/>修改，它现在包含一个引用您的JavaScript文件的&lt; script &gt;标签</p><figure class="kl km kn ko fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kq"><img src="../Images/8a1f86210645113af93260fa6fd59981.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qpg4GF-ybN8wqj0r0VA8GQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">标签已经更新，这个修改后的HTML响应将被Google Cloud CDN缓存</figcaption></figure><p id="b9cc" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是在缓存网页中填充动态内容的好方法*</p><p id="5331" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy">*注意:</strong>确保您的内容的<a class="ae ki" href="https://cloud.google.com/cdn/docs/best-practices#setting_the_expiration_for_time-sensitive_content" rel="noopener ugc nofollow" target="_blank">到期时间</a>与您的生命周期相匹配。js文件更改</p></div></div>    
</body>
</html>