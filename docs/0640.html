<html>
<head>
<title>What a Go developer needs to know about Google Cloud Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Go开发者需要了解谷歌云平台</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/what-a-go-developer-needs-to-know-about-google-cloud-platform-e046c9e11abf?source=collection_archive---------0-----------------------#2018-06-11">https://medium.com/google-cloud/what-a-go-developer-needs-to-know-about-google-cloud-platform-e046c9e11abf?source=collection_archive---------0-----------------------#2018-06-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div class="er es hg"><img src="../Images/ffd191ec00f70ec083513332550aad4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*ljrmSJj5Ca2MJk-1l5Jz7A.jpeg"/></div></figure><div class=""/><p id="87bb" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hq">更新(2018 . 10 . 16)</strong>:自从我写这篇帖子以来，发生了很多变化。除了GCE和GKE(见下文)，App Engine已经<a class="ae jk" href="https://blog.golang.org/appengine-go111" rel="noopener ugc nofollow" target="_blank">显著改进</a>，并宣布支持Go on Cloud功能(撰写本文时为私有alpha)。</p><p id="4db0" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在<a class="ae jk" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a> (GCP)上运行Go代码，有两个很棒的可移植代码选择:<a class="ae jk" href="https://cloud.google.com/compute/" rel="noopener ugc nofollow" target="_blank">谷歌计算引擎</a> (GCE)，和<a class="ae jk" href="https://cloud.google.com/kubernetes-engine/" rel="noopener ugc nofollow" target="_blank">谷歌Kubernetes引擎</a> (GKE)。让我们深入了解一下每一种方法，以及Go开发者的一些额外选择。</p><h1 id="3206" class="jl jm hp bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">两个伟大的选择:GCE和GKE</h1><p id="9118" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">GCE被宣传为Google提供的“可扩展、高性能的虚拟机”，它是一个简单明了的产品，但也有一些细微之处。请参见此处的<a class="ae jk" href="https://cloud.google.com/go/docs/tutorials/bookshelf-on-compute-engine" rel="noopener ugc nofollow" target="_blank">快速入门</a>。它伴随着通常的成本和收益。作为一个很好的特性，GCE做了<a class="ae jk" href="https://cloud.google.com/compute/docs/instances/live-migration" rel="noopener ugc nofollow" target="_blank">实时迁移</a>，这意味着Google为您执行安全更新，而不会对虚拟机的工作负载产生任何影响。不用说，以任何必要的配置创建机器和网络是用户的责任。GCE有一个很好的特性，除了提供广泛的主机操作系统之外，还允许用户用容器创建虚拟机。</p><p id="4eb1" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从围棋开发者的角度来看，GKE几乎肯定是更令人兴奋的产品。请参见此处的<a class="ae jk" href="https://cloud.google.com/go/docs/tutorials/bookshelf-on-kubernetes-engine" rel="noopener ugc nofollow" target="_blank">快速入门</a>。您可以获得Kubernetes的所有功能，而没有在原始计算实例上运行它的困难(T21)。对于较小的系统来说，GKE可能有些过头了，但是它确实为您提供了一个很好的故事，告诉您如何随着系统的增长来扩展系统。</p><p id="3bed" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您选择这两个选项中的哪一个完全取决于您的系统看起来像什么，您对正常运行时间和可伸缩性有什么样的要求，等等。使用GCE的一个原因是，对于小型服务来说，它要便宜得多，而带有负载平衡器入口的GKE集群可能要贵得多。对于一些人来说，最好是构建一个Go二进制文件，并使用简单的工具在GCE上运行，比如<a class="ae jk" href="http://supervisord.org/" rel="noopener ugc nofollow" target="_blank"> supervisord </a>和<a class="ae jk" href="https://linux.die.net/man/1/scp" rel="noopener ugc nofollow" target="_blank"> scp </a>。或者，创建一个Kubernetes集群并将部署转移到GKE也很容易。对其他人来说，从GKE开始可能是正确的选择。</p><h1 id="566f" class="jl jm hp bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">关于应用引擎的思考</h1><p id="8a7e" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">除了GCE和GKE，谷歌云确实为Go开发者提供了第三个选择:<a class="ae jk" href="https://cloud.google.com/appengine/" rel="noopener ugc nofollow" target="_blank">应用引擎</a>。如果你接受<a class="ae jk" href="https://www.youtube.com/watch?v=tISy7EJQPzI&amp;t=8m17s" rel="noopener ugc nofollow" target="_blank">软件工程是随时间集成的编程</a>的定义，你可能会发现很难将App Engine视为一个合理的选择。它当然有显著的优势，例如，“从零扩展到行星尺度”，但它也有一些主要的弱点。</p><p id="d7b4" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">App Engine由<a class="ae jk" href="https://cloud.google.com/appengine/docs/go/" rel="noopener ugc nofollow" target="_blank">两个环境</a>组成:标准和灵活。标准环境打破了<a class="ae jk" href="https://12factor.net/" rel="noopener ugc nofollow" target="_blank">十二因素App </a>的“执行环境间最大的可移植性”的设计原则，并对<a class="ae jk" href="https://github.com/GoogleCloudPlatform/golang-samples/blob/f08cfc98f4c8e537114c8b1d02d7c32b235701bd/appengine/helloworld/hello.go#L16" rel="noopener ugc nofollow" target="_blank">如何编写你的主函数</a>提出了要求。当然，有合理的方法<a class="ae jk" href="https://blog.golang.org/the-app-engine-sdk-and-workspaces-gopath" rel="noopener ugc nofollow" target="_blank">来处理这个</a>。标准环境也倾向于在最新的Go版本之后运行一个次要版本。例如，Go 1.10于2018年2月16日发布。同时，在撰写本文时，App Engine支持的最新版本是Go 1.9。自<a class="ae jk" href="https://blog.golang.org/go1.6" rel="noopener ugc nofollow" target="_blank">2016年2月16日</a>起，Go支持<a class="ae jk" href="https://golang.org/cmd/go/#hdr-Vendor_Directories" rel="noopener ugc nofollow" target="_blank">卖身</a>。两年多过去了，App Engine依然不支持vendoring。人们至少可以使用老的方法，即每个项目检入一个完整的GOPATH，这是一种乏味而繁琐的做法，否则在支持vendoring的情况下，社区会放弃这种做法。</p><p id="8ff7" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">虽然标准环境对用户代码提出了一些苛刻的要求，但灵活环境更接近于许多人习惯的十二要素PaaS。灵活的环境还支持部署containizered应用程序。唯一的问题是，部署到灵活的环境是痛苦的缓慢的。例如，部署<a class="ae jk" href="https://github.com/GoogleCloudPlatform/golang-samples/blob/master/appengine_flexible/helloworld/helloworld.go" rel="noopener ugc nofollow" target="_blank"> Hello World示例</a>在一次全新部署中花费了12分钟，而在第二次部署中花费了11分钟，并且没有任何更改。对我来说，缓慢的部署违背了PaaS的目的。</p><p id="e7d6" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果你的用例<a class="ae jk" href="https://open.nytimes.com/moving-the-new-york-times-games-platform-to-google-app-engine-e9337f2c9444" rel="noopener ugc nofollow" target="_blank">正好符合让App Engine强大的东西</a>或者你正在寻找为<a class="ae jk" href="https://github.com/googleCloudPlatform/govanityurls" rel="noopener ugc nofollow" target="_blank">部署简单的<a class="ae jk" href="https://github.com/rsc/swtch/tree/master/app/rsc-io" rel="noopener ugc nofollow" target="_blank"> GoDoc重定向</a>作为虚荣心导入路径</a>，这可能是一个很好的选择。不过，总的来说，App Engine要求您编写不可移植的代码，或者部署缓慢。对一些人来说，这些可能是合理的缺点。对许多人来说，他们可能会成为交易的破坏者。</p><h1 id="1f41" class="jl jm hp bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">支持谷歌云功能</h1><p id="501e" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">目前<a class="ae jk" href="https://cloud.google.com/functions/" rel="noopener ugc nofollow" target="_blank">谷歌云功能</a> (GCF)上不支持Go。我确信所有的Go开发者都希望这种情况能尽快改变。与此同时，有一个非官方的(不受支持的)原生Go运行时<a class="ae jk" href="https://github.com/GoogleCloudPlatform/cloud-functions-go" rel="noopener ugc nofollow" target="_blank">，供那些可能喜欢尝试的人使用。或者，也可以在Kubernetes上运行Go函数。例如，参见</a><a class="ae jk" href="https://www.openfaas.com/" rel="noopener ugc nofollow" target="_blank"> OpenFaaS </a>或<a class="ae jk" href="https://github.com/projectriff/riff" rel="noopener ugc nofollow" target="_blank"> riff </a>。</p><p id="983e" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">一旦Go在GCF上得到适当的支持，这里的整个故事很可能会改变。事实上，对于大多数请求/响应工作负载，我认为GCF将是开发人员开始部署Go代码的最佳地方。</p><h1 id="f985" class="jl jm hp bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">一些值得了解的有用工具</h1><p id="1df1" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">虽然不是专门针对Go本身，但开发者会很乐意知道<a class="ae jk" href="https://cloud.google.com/source-repositories/" rel="noopener ugc nofollow" target="_blank">云资源仓库</a>、<a class="ae jk" href="https://cloud.google.com/container-registry/" rel="noopener ugc nofollow" target="_blank">容器注册中心</a>和<a class="ae jk" href="https://cloud.google.com/container-builder/" rel="noopener ugc nofollow" target="_blank">容器构建器</a>。还有许多其他开发工具，但是这里提到的三个特别有用。在GCP上部署应用程序时，最好将源代码、Docker映像以及构建、测试和部署步骤整合在一起。容器构建器特别好，因为它支持<a class="ae jk" href="https://cloud.google.com/container-builder/docs/configuring-builds/build-test-deploy-artifacts" rel="noopener ugc nofollow" target="_blank">构建、测试和部署工件</a>。</p><p id="204a" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，由于有了<a class="ae jk" href="https://github.com/googlecloudplatform/google-cloud-go" rel="noopener ugc nofollow" target="_blank">Google Cloud Client Libraries for Go</a>，Go绑定提供了无数有用的API。支持的API包括以下内容:</p><ul class=""><li id="27a4" class="ko kp hp io b ip iq it iu ix kq jb kr jf ks jj kt ku kv kw bi translated"><a class="ae jk" href="https://cloud.google.com/pubsub/" rel="noopener ugc nofollow" target="_blank">云发布/订阅</a>，</li><li id="138c" class="ko kp hp io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated"><a class="ae jk" href="https://cloud.google.com/natural-language/" rel="noopener ugc nofollow" target="_blank">自然语言处理</a>，</li><li id="5e42" class="ko kp hp io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated"><a class="ae jk" href="https://cloud.google.com/bigquery/" rel="noopener ugc nofollow" target="_blank"> BigQuery </a>，</li><li id="f76b" class="ko kp hp io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated"><a class="ae jk" href="https://cloud.google.com/spanner/" rel="noopener ugc nofollow" target="_blank">云扳手</a>，</li><li id="95f6" class="ko kp hp io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated"><a class="ae jk" href="https://cloud.google.com/datastore/" rel="noopener ugc nofollow" target="_blank">云数据存储</a>，</li><li id="6d2b" class="ko kp hp io b ip kx it ky ix kz jb la jf lb jj kt ku kv kw bi translated">诸如此类。</li></ul><p id="1e79" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">详见<a class="ae jk" href="https://godoc.org/cloud.google.com/go" rel="noopener ugc nofollow" target="_blank">GoDoc</a>。此外，阅读用4个字或更少的字描述的<a class="ae jk" rel="noopener" href="/google-cloud/gcp-products-described-in-4-words-or-less-f3056550e595"> GCP产品很有帮助</a>，因为产品种类太多了。如果已经用<a class="ae jk" href="https://cloud.google.com/docs/authentication/production" rel="noopener ugc nofollow" target="_blank">处理了认证</a>，那么从GCE调用各种API就不需要特殊的步骤。在GKE的例子中，人们可以通过服务代理人使用GCP API。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div class="er es lc"><img src="../Images/6ad5b1ec60667b21e79253ca0b299e93.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*eIMbmSVLP69ZJA4-GGD1MA.jpeg"/></div></figure><h1 id="3b52" class="jl jm hp bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">关键要点</h1><p id="92b5" class="pw-post-body-paragraph im in hp io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">在GCP部署Go代码时，GKE是一个例外的选择。对于喜欢直接使用虚拟机的用户来说，GCE是一个强大且相对便宜的选择。虽然App Engine for Go提供了各种优势和劣势，但大多数用户可能不会花太多时间考虑它，而是看看GKE，因为Kubernetes有理由感到兴奋。最后，鉴于GCP强大的<a class="ae jk" href="https://cloud.google.com/products/machine-learning/" rel="noopener ugc nofollow" target="_blank">机器学习API</a>，可以通过Go客户端库轻松访问，在评估IaaS选项时，GCP值得考虑。</p></div></div>    
</body>
</html>