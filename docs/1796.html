<html>
<head>
<title>Debugging running pods in GKE clusters</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">调试GKE集群中的运行窗格</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/debugging-running-pods-in-gke-clusters-7fa64b3534af?source=collection_archive---------1-----------------------#2021-02-11">https://medium.com/google-cloud/debugging-running-pods-in-gke-clusters-7fa64b3534af?source=collection_archive---------1-----------------------#2021-02-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="cfa1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一段时间以来，Kubernetes支持<a class="ae jd" href="https://kubernetes.io/docs/concepts/workloads/pods/ephemeral-containers/" rel="noopener ugc nofollow" target="_blank">短暂容器</a>。从Kubernetes版本1.18开始，除了一大套其他的<a class="ae jd" href="https://kubernetes.io/docs/tasks/debug-application-cluster/debug-application" rel="noopener ugc nofollow" target="_blank">故障排除方法</a>之外，短命吊舱可以用于<a class="ae jd" href="https://kubernetes.io/docs/tasks/debug-application-cluster/debug-running-pod/#ephemeral-container" rel="noopener ugc nofollow" target="_blank">调试运行吊舱</a>。虽然GKE已经支持Kubernetes 1.18，但<code class="du je jf jg jh b">kubectl debug</code>命令仍然不可用。主要是因为这个特性在Kubernetes API中仍然标记为<em class="ji"> Alpha </em>。那么，除了<a class="ae jd" href="https://cloud.google.com/blog/products/containers-kubernetes/tools-for-debugging-apps-on-google-kubernetes-engine" rel="noopener ugc nofollow" target="_blank">检查GKE应用程序日志和跟踪</a>之外，您还能做什么呢？</p><p id="4aa6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以从托管虚拟机访问正在运行的pod的容器。在GKE，大多数集群使用<a class="ae jd" href="https://cloud.google.com/kubernetes-engine/docs/concepts/node-images#cos" rel="noopener ugc nofollow" target="_blank"> COS </a>来运行工作节点。当您SSH到节点时，您仍然缺少root访问权限以及许多调试所需的有用实用程序。在COS中，您可以使用<a class="ae jd" href="https://cloud.google.com/container-optimized-os/docs/how-to/toolbox" rel="noopener ugc nofollow" target="_blank"> COS工具箱</a>来调试您的运行吊舱。工具箱最初是为了调试节点问题而创建的，但是可以很容易地转换为运行pod调试工具。例如，如果您需要捕获来自pod的流量，请执行以下操作:</p><ol class=""><li id="b7b4" class="jj jk hi ih b ii ij im in iq jl iu jm iy jn jc jo jp jq jr bi translated">SSH到pod运行的节点(使用<code class="du je jf jg jh b">kubectl get po -o wide</code>查看节点名称)。</li><li id="b85e" class="jj jk hi ih b ii js im jt iq ju iu jv iy jw jc jo jp jq jr bi translated">运行<a class="ae jd" href="https://cloud.google.com/container-optimized-os/docs/how-to/toolbox" rel="noopener ugc nofollow" target="_blank">工具箱</a>。</li><li id="9601" class="jj jk hi ih b ii js im jt iq ju iu jv iy jw jc jo jp jq jr bi translated">安装并运行tcpdump以捕获来源等于pod IP的所有数据包。</li><li id="d359" class="jj jk hi ih b ii js im jt iq ju iu jv iy jw jc jo jp jq jr bi translated">将转储从节点复制到您的工作站。</li></ol></div></div>    
</body>
</html>