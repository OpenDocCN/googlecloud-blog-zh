<html>
<head>
<title>Importing VMWare Virtual Appliances as Machine Images in GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在GCP将VMWare虚拟设备作为机器映像导入</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/importing-vmware-virtual-appliances-as-machine-images-in-gcp-f4964aa52e5c?source=collection_archive---------1-----------------------#2022-12-05">https://medium.com/google-cloud/importing-vmware-virtual-appliances-as-machine-images-in-gcp-f4964aa52e5c?source=collection_archive---------1-----------------------#2022-12-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/af87c659bace17eef9e34b5cfd7fb0f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*afZUCqsL-nk4Nshxdbps4w.png"/></div></div></figure><p id="ce82" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="jo">本</em> <strong class="is hj"> <em class="jo">博客</em> </strong> <em class="jo">介绍了如何将虚拟机镜像从VMWare虚拟设备导入</em><strong class="is hj"><em class="jo">【GCP】</em></strong><em class="jo">。在这篇博客中，我们将带您了解使用cli从GCP的OVA和VMDK文件导入机器映像的不同步骤。除此之外，我们还将以</em><strong class="is hj"><em class="jo">VMWare Unified Access Gateway Appliance</em></strong><em class="jo">为例，向GCP展示一个</em> <strong class="is hj"> <em class="jo">自定义操作系统</em> </strong> <em class="jo">映像的导入。</em></p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="0ade" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated"><strong class="ak">先决条件</strong></h1><p id="c45a" class="pw-post-body-paragraph iq ir hi is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hb bi translated">以下是继续导入图像所需的先决条件</p><ol class=""><li id="78e1" class="kz la hi is b it iu ix iy jb lb jf lc jj ld jn le lf lg lh bi translated">安装或更新至最新版本的<a class="ae li" href="https://cloud.google.com/compute/docs/gcloud-compute" rel="noopener ugc nofollow" target="_blank">谷歌云CLI </a>。</li><li id="ee01" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn le lf lg lh bi translated"><a class="ae li" href="https://cloud.google.com/compute/docs/gcloud-compute#set_default_zone_and_region_in_your_local_client" rel="noopener ugc nofollow" target="_blank">在<em class="jo"> gcloud </em> CLI上配置</a>一个默认的项目、区域和zone。</li><li id="3ee6" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn le lf lg lh bi translated">确保<em class="jo"> gcloud </em> CLI能够访问GCS和计算引擎。</li></ol></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="467e" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">从OVA/OVF文件导入机器映像</h1><p id="74e4" class="pw-post-body-paragraph iq ir hi is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hb bi translated">下面给出了从OVA文件导入机器映像的步骤。</p><p id="fbbd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第一步:导出环境变量</strong></p><p id="fafa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">导出下面给出的变量，开始使用——</p><pre class="lo lp lq lr fd ls lt lu bn lv lw bi"><span id="b13f" class="lx jx hi lt b be ly lz l ma mb">$ export network_name="&lt;NETWORK_NAME&gt;"<br/>$ export subnet_name="&lt;SUBNET_NAME&gt;"<br/>$ export machine_image_zone="&lt;ZONE&gt;"<br/>$ export image_name="&lt;MACHINE_IMAGE_NAME&gt;"<br/>$ export gcs_artifact_path="&lt;GCS_PATH_TO_STORE_ARTIFACTS&gt;"<br/>$ export os_type="&lt;OS&gt;"<br/>$ export ova_file_path="&lt;OVA_FILE_PATH&gt;"</span></pre><p id="3edb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">替换以下内容:</p><ul class=""><li id="7301" class="kz la hi is b it iu ix iy jb lb jf lc jj ld jn mc lf lg lh bi translated"><code class="du md me mf lt b">MACHINE_IMAGE_NAME</code>:您要导入的机器图像的名称。</li><li id="e094" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">OS</code>:OVA文件的操作系统。指定正在导入的机器映像的操作系统。必须是:<code class="du md me mf lt b">centos-7</code>、<code class="du md me mf lt b">debian-10</code>、<code class="du md me mf lt b">debian-11</code>、<code class="du md me mf lt b">debian-8</code>、<code class="du md me mf lt b">debian-9</code>、<code class="du md me mf lt b">opensuse-15</code>、<code class="du md me mf lt b">rhel-6</code>、<code class="du md me mf lt b">rhel-6-byol</code>、<code class="du md me mf lt b">rhel-7</code>、<code class="du md me mf lt b">rhel-7-byol</code>、<code class="du md me mf lt b">rhel-8</code>、<code class="du md me mf lt b">rhel-8-byol</code>、<code class="du md me mf lt b">rocky-8</code>、<code class="du md me mf lt b">sles-12</code>、<code class="du md me mf lt b">sles-12-byol</code>、<code class="du md me mf lt b">sles-15</code>、<code class="du md me mf lt b">sles-15-byol</code>、<code class="du md me mf lt b">sles-sap-12</code>、<code class="du md me mf lt b">sles-sap-12-byol</code>、<code class="du md me mf lt b">sles-sap-15</code>、<code class="du md me mf lt b">sles-sap-15-byol</code>、<code class="du md me mf lt b">ubuntu-1404</code>、<code class="du md me mf lt b">ubuntu-1604</code>、<code class="du md me mf lt b">ubuntu-1804</code>、<code class="du md me mf lt b">ubuntu-2004</code>、<code class="du md me mf lt b">ubuntu-2204</code></li><li id="2a15" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">NETWORK_NAME</code>:要导入图像的网络名称。(可选)</li><li id="5a3c" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">SUBNET_NAME</code>:要导入图像的子网名称。(可选)</li><li id="8fff" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">ZONE</code>:导入机器图像的<a class="ae li" href="https://cloud.google.com/compute/docs/regions-zones#locations" rel="noopener ugc nofollow" target="_blank">区</a>。如果留空，则使用项目的默认区域(可选)。</li><li id="47cf" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">OVA_FILE_PATH</code>:本地系统中OVA的文件路径。</li><li id="efb5" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">GCS_PATH_TO_STORE_ARTIFACTS</code>:存储OVA文件的云存储路径。</li></ul><p id="b9e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第二步:上传虚拟磁盘文件到云存储</strong></p><p id="1b43" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用<code class="du md me mf lt b">gsutil cp</code>将OVA文件推送到云存储。</p><pre class="lo lp lq lr fd ls lt lu bn lv lw bi"><span id="6b0b" class="lx jx hi lt b be ly lz l ma mb">$ gsutil cp $ova_file_path $gcs_artifact_path<br/>$ gcs_file_name=$(basename $ova_file_path)<br/>$ export gs_ova_file_url="$gcs_artifact_path/$gcs_file_name"</span></pre><p id="aa61" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第三步:将图像导入GCP </strong></p><p id="d856" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用<code class="du md me mf lt b">cloud compute machine-images import</code>命令从虚拟设备导入OVA格式的机器映像。</p><pre class="lo lp lq lr fd ls lt lu bn lv lw bi"><span id="f8be" class="lx jx hi lt b be ly lz l ma mb">$ gcloud compute machine-images import $image_name \<br/>    --os=$os_type \<br/>    --source-uri=$gs_ova_file_url \<br/>    --network=$network_name \<br/>    --subnet=$subnet_name \<br/>    --zone=$machine_image_zone</span></pre><blockquote class="mg mh mi"><p id="f362" class="iq ir jo is b it iu iv iw ix iy iz ja mj jc jd je mk jg jh ji ml jk jl jm jn hb bi translated"><strong class="is hj">注意</strong>:如果命令不支持操作系统类型，则<code class="du md me mf lt b">cloud compute machine-images import</code>不能用于创建机器映像。ex-光子图像</p><p id="7ee2" class="iq ir jo is b it iu iv iw ix iy iz ja mj jc jd je mk jg jh ji ml jk jl jm jn hb bi translated">有关<strong class="is hj">g cloud compute machine-images import</strong>命令的更多详细信息，请参考<a class="ae li" href="https://cloud.google.com/sdk/gcloud/reference/compute/machine-images/import" rel="noopener ugc nofollow" target="_blank">官方文档</a>。</p></blockquote></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="28a1" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">从VMDK文件导入机器映像</h1><p id="71ad" class="pw-post-body-paragraph iq ir hi is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hb bi translated">下面给出了从VMDK文件导入机器映像的步骤</p><p id="d07b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第一步:导出环境变量</strong></p><p id="5580" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">导出以下变量以开始—</p><pre class="lo lp lq lr fd ls lt lu bn lv lw bi"><span id="7709" class="lx jx hi lt b be ly lz l ma mb">$ export subnet_name="&lt;SUBNET_NAME&gt;"<br/>$ export machine_image_zone="&lt;ZONE&gt;"<br/>$ export image_name="&lt;MACHINE_IMAGE_NAME&gt;"<br/>$ export gcs_artifact_path="&lt;GCS_PATH_TO_STORE_ARTIFACTS&gt;"<br/>$ export vmdk_file_path="&lt;VMDK_FILE_PATH&gt;"</span></pre><p id="b519" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">替换以下内容:</p><ul class=""><li id="1dd2" class="kz la hi is b it iu ix iy jb lb jf lc jj ld jn mc lf lg lh bi translated"><code class="du md me mf lt b">MACHINE_IMAGE_NAME</code>:您要导入的机器图像的名称。</li><li id="9803" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">SOURCE_URI</code>:云存储中VMDK文件的路径。</li><li id="2ac1" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">NETWORK_NAME</code>:要导入图像的网络名称。(可选)</li><li id="4bb5" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">SUBNET_NAME</code>:要导入图像的子网名称。(可选)</li><li id="20e2" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">ZONE</code>:导入机器图像的<a class="ae li" href="https://cloud.google.com/compute/docs/regions-zones#locations" rel="noopener ugc nofollow" target="_blank">区</a>。如果留空，则使用项目的默认区域(可选)。</li><li id="3d35" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">VMDK_FILE_PATH</code>:VMDK在您本地系统中的文件路径。</li><li id="dacb" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">GCS_PATH_TO_STORE_ARTIFACTS</code>:存放VMDK文件的云存储路径。</li></ul><p id="8927" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第二步:上传虚拟磁盘文件到云存储</strong></p><p id="7098" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用<code class="du md me mf lt b">gsutil cp</code>将VMDK文件推送到云存储。</p><pre class="lo lp lq lr fd ls lt lu bn lv lw bi"><span id="7afe" class="lx jx hi lt b be ly lz l ma mb">$ gsutil cp $vmdk_file_path $gcs_artifact_path<br/>$ export gs_vmdk_file_url="$gcs_artifact_path/$(basename $vmdk_file_path)"</span></pre><p id="17c8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第三步:将图像导入GCP </strong></p><p id="ceae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用<code class="du md me mf lt b">cloud compute images import</code>命令导入机器图像。</p><pre class="lo lp lq lr fd ls lt lu bn lv lw bi"><span id="c048" class="lx jx hi lt b be ly lz l ma mb">$ gcloud compute images import $image_name \<br/>  --source-file $gs_vmdk_file_url \<br/>  --subnet=$subnet_name \<br/>  --zone=$machine_image_zone \<br/>  --no-address</span></pre><blockquote class="mg mh mi"><p id="e24a" class="iq ir jo is b it iu iv iw ix iy iz ja mj jc jd je mk jg jh ji ml jk jl jm jn hb bi translated"><strong class="is hj">注</strong> : <code class="du md me mf lt b">cloud compute images import</code>也可用于将虚拟磁盘映像，如VMware VHD文件导入计算引擎。</p><p id="d4ad" class="iq ir jo is b it iu iv iw ix iy iz ja mj jc jd je mk jg jh ji ml jk jl jm jn hb bi translated">要覆盖检测到的操作系统，请指定<code class="du md me mf lt b">--os</code>标志。您可以使用<code class="du md me mf lt b">--data-disk</code>标志省略翻译步骤。有关可选标志的更多信息，请参考<a class="ae li" href="https://cloud.google.com/sdk/gcloud/reference/compute/images/import" rel="noopener ugc nofollow" target="_blank">官方文档</a>。</p></blockquote><p id="11d8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有关操作系统支持，请参见<a class="ae li" href="https://cloud.google.com/compute/docs/images/os-details#import" rel="noopener ugc nofollow" target="_blank">操作系统详情。</a></p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="c02a" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">将统一接入网关镜像上传至谷歌云平台</h1><p id="1729" class="pw-post-body-paragraph iq ir hi is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hb bi translated">下面给出了在GCP从统一访问网关OVA文件创建机器映像的步骤。</p><p id="b562" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤1:下载统一接入网关镜像(OVA文件)</strong></p><p id="a523" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要将统一接入网关实例部署到计算引擎，您必须将统一接入网关设备磁盘映像上传到Google云平台。</p><p id="4729" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从<a class="ae li" href="https://my.vmware.com/web/vmware/downloads/#all_products" rel="noopener ugc nofollow" target="_blank"> VMware下载页面</a>下载2103版或更高版本的Unified Access Gateway.ova镜像文件。</p><p id="0a79" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第二步:从OVA文件中提取VMDK文件</strong></p><pre class="lo lp lq lr fd ls lt lu bn lv lw bi"><span id="61a1" class="lx jx hi lt b be ly lz l ma mb">$ mkdir /tmp/images<br/>$ cd /tmp/images<br/>$ tar -xvf $ova_file_name .</span></pre><p id="f067" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du md me mf lt b">ova_file_name</code> : ova_file_name是。ova映像文件，在前面的步骤中从VMware下载页面下载。</p><p id="7c94" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">例如</em></strong>:euc-unified-access-gateway-21 . 03 . 0 . 0–42741891 _ ov F10 . ova从VMware下载页面下载，其中<code class="du md me mf lt b">21-03</code>为版本号，<code class="du md me mf lt b">42741891</code>为内部版本号。</p><p id="8d83" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第三步:导出环境变量</strong></p><p id="6fbb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">导出下面给出的所需变量—</p><pre class="lo lp lq lr fd ls lt lu bn lv lw bi"><span id="36ce" class="lx jx hi lt b be ly lz l ma mb">$ export network_name="&lt;NETWORK_NAME&gt;"<br/>$ export subnet_name="&lt;SUBNET_NAME&gt;"<br/>$ export machine_image_zone="&lt;ZONE&gt;"<br/>$ export gcs_artifact_path="&lt;GCS_PATH_TO_STORE_ARTIFACTS&gt;"<br/>$ export uag_image_folder="/tmp/images"<br/>$ export vmdk_file_name="euc-unified-access-gateway-21.03.0.0-42741891-system.vmdk"</span></pre><p id="b761" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">替换以下内容:</p><ul class=""><li id="0c9c" class="kz la hi is b it iu ix iy jb lb jf lc jj ld jn mc lf lg lh bi translated"><code class="du md me mf lt b">MACHINE_IMAGE_NAME</code>:您要导入的机器图像的名称。</li><li id="288c" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">SOURCE_URI</code>:云存储上你的OVA或者OVF文件的路径。</li><li id="21ce" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">NETWORK_NAME</code>:要导入图像的网络名称。(可选)</li><li id="af00" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">SUBNET_NAME</code>:要导入图像的子网名称。(可选)</li><li id="3725" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">ZONE</code>:导入机器图像的<a class="ae li" href="https://cloud.google.com/compute/docs/regions-zones#locations" rel="noopener ugc nofollow" target="_blank">区</a>。如果留空，则使用项目的默认区域(可选)。</li><li id="51b9" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">OVA_FILE_PATH</code>:本地系统中OVA的文件路径。</li><li id="7a17" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">GCS_PATH_TO_STORE_ARTIFACTS</code>:存储OVA文件的云存储路径。</li><li id="3e65" class="kz la hi is b it lj ix lk jb ll jf lm jj ln jn mc lf lg lh bi translated"><code class="du md me mf lt b">vmdk_file_name</code>:用/tmp/images文件夹中的VMDK文件名替换此变量。</li></ul><p id="7f0e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第四步:上传VMDK文件到云存储</strong></p><p id="3489" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用<code class="du md me mf lt b">gsutil cp</code>将VMDK文件推送到云存储。</p><pre class="lo lp lq lr fd ls lt lu bn lv lw bi"><span id="bb1e" class="lx jx hi lt b be ly lz l ma mb">$ gsutil cp $uag_image_folder/$vmdk_image_file $gcs_artifact_path</span></pre><p id="af64" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第五步:设置变量</strong></p><p id="bbe3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">设置下面给出的变量以创建机器图像—</p><pre class="lo lp lq lr fd ls lt lu bn lv lw bi"><span id="0892" class="lx jx hi lt b be ly lz l ma mb">$ export gs_vmkd_file_url="&lt;SOURCE_URI&gt;"<br/>$ export image_name=$(echo $vmdk_file_name | sed 's/-system.vmdk//' | sed 's/\./-/g')</span></pre><p id="cc36" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du md me mf lt b">SOURCE_URI</code>:云存储中VMDK文件的路径。</p><p id="86ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤6:在计算引擎中创建设备映像</strong></p><p id="f3f8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用<code class="du md me mf lt b">gcloud compute images import</code>命令导入机器图像。</p><pre class="lo lp lq lr fd ls lt lu bn lv lw bi"><span id="ef2d" class="lx jx hi lt b be ly lz l ma mb">$ gcloud compute images import $image_name \<br/>  --data-disk --source-file $gs_vmdk_file_url \<br/>  --subnet=$subnet_name \<br/>  --zone=$machine_image_zone \<br/>  --no-address </span></pre><blockquote class="mg mh mi"><p id="c546" class="iq ir jo is b it iu iv iw ix iy iz ja mj jc jd je mk jg jh ji ml jk jl jm jn hb bi translated"><strong class="is hj">注意</strong>:我们不能使用<code class="du md me mf lt b">gcloud compute machine-images import</code>命令创建机器镜像，因为统一访问网关是Photon OS，该命令不支持。</p><p id="0547" class="iq ir jo is b it iu iv iw ix iy iz ja mj jc jd je mk jg jh ji ml jk jl jm jn hb bi translated">因此，我们使用带有<code class="du md me mf lt b">--data-disk</code>标志的<code class="du md me mf lt b">gcloud compute images import</code>命令。此标志指定磁盘上没有安装可引导的操作系统。导入磁盘，但不使其可引导或在其上安装Google tools。</p></blockquote><p id="d873" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有关可选标志的更多信息，请参考<a class="ae li" href="https://cloud.google.com/sdk/gcloud/reference/compute/images/import" rel="noopener ugc nofollow" target="_blank">官方文件</a>。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="d609" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">结论</h1><p id="f40a" class="pw-post-body-paragraph iq ir hi is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hb bi translated"><em class="jo">总之，用户可以参考本博客，从OVA和VMDK文件创建机器映像。该博客还介绍了如何导入定制操作系统映像，例如GCP的VMWare统一访问网关映像。</em></p><p id="a700" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢您的阅读。:)</p></div></div>    
</body>
</html>