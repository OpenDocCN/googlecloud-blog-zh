<html>
<head>
<title>Secure traffic to GKE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保护通往GKE的交通</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/secure-traffic-with-gke-how-many-times-to-encrypt-61a4d607b5c9?source=collection_archive---------0-----------------------#2021-03-13">https://medium.com/google-cloud/secure-traffic-with-gke-how-many-times-to-encrypt-61a4d607b5c9?source=collection_archive---------0-----------------------#2021-03-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="21b4" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">传输中的数据要加密多少次？</h2></div><p id="f540" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">剧透:本文没有代码示例</em>😊</p><p id="e6e4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">保护应用程序流量，也称为传输中的数据加密或应用程序通信加密，是一项标准的安全实践，几乎总是任何多层应用程序的一项要求。一种常见的做法是使用SSL / TLS协议。实施应声明支持的协议的版本和密码。</p><p id="4357" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">云原生应用通常部署在Kubernetes上，像谷歌云(GCP)中的<a class="ae ju" href="https://cloud.google.com/kubernetes-engine/docs/concepts/kubernetes-engine-overview" rel="noopener ugc nofollow" target="_blank"> GKE </a>。虽然对传输中的数据进行加密的想法很简单，但它的实施和操作可能需要相当大的投资。了解云提供商如何保护传输中的数据可能会有所帮助。了解这些细节并采用特定云提供商的最佳实践可以节省开发和维护工作，并提高应用程序的运行效率。这篇文章回顾了谷歌云中的数据传输保护，以及如何将其应用于GKE上运行的应用程序。</p><h1 id="c7d5" class="jv jw hi bd jx jy jz ka kb kc kd ke kf io kg ip kh ir ki is kj iu kk iv kl km bi translated">传输中的加密</h1><p id="f42d" class="pw-post-body-paragraph ix iy hi iz b ja kn ij jc jd ko im jf jg kp ji jj jk kq jm jn jo kr jq jr js hb bi translated">所有云提供商都声称会以某种方式保护传输中的数据。细节取决于应用的网络拓扑和云提供商的网络实施。谷歌云通过对用户不易察觉的加密来保护传输中的数据。这个过程在<a class="ae ju" href="https://cloud.google.com/security/overview/whitepaper#securing_data_in_transit" rel="noopener ugc nofollow" target="_blank">白皮书</a>和<a class="ae ju" href="https://cloud.google.com/security/encryption-in-transit" rel="noopener ugc nofollow" target="_blank">公开文档</a>中有描述。实质上，在谷歌控制的物理边界内开始并发送到谷歌控制的另一个<em class="jt">物理边界的每个通信都是加密的(使用TLS协议),无论目的地是哪里，也无论通信是使用谷歌专用网络还是网络提供商基础设施。这意味着从互联网上的客户端到GCP内部的虚拟机的直接连接必须由应用程序加密。</em></p><h1 id="e28e" class="jv jw hi bd jx jy jz ka kb kc kd ke kf io kg ip kh ir ki is kj iu kk iv kl km bi translated">公开托管在GKE上的应用程序</h1><p id="989d" class="pw-post-body-paragraph ix iy hi iz b ja kn ij jc jd ko im jf jg kp ji jj jk kq jm jn jo kr jq jr js hb bi translated">传输中的数据加密如何影响托管在GKE的应用程序服务？这取决于服务是如何公开以供访问的。公开托管在GKE的服务有两种主要方法:</p><ul class=""><li id="3998" class="ks kt hi iz b ja jb jd je jg ku jk kv jo kw js kx ky kz la bi translated"><em class="jt"> Via proxy </em>(入口或特使)该方法主要用于公开使用HTTP(S)或gRPC通信协议进行通信的服务。代理(入口控制器或特使)只是运行在GKE集群上的另一个应用程序。代理通常暴露在<a class="ae ju" href="https://cloud.google.com/load-balancing/docs/https" rel="noopener ugc nofollow" target="_blank"> L7 HTTP(S)负载均衡器</a>的后面。</li><li id="9320" class="ks kt hi iz b ja lb jd lc jg ld jk le jo lf js kx ky kz la bi translated"><em class="jt">直接访问</em>使用集群的节点IP和端口元组公开服务。与代理一样，节点IP可以直接访问或“隐藏”在<a class="ae ju" href="https://cloud.google.com/load-balancing/docs/network" rel="noopener ugc nofollow" target="_blank"> TCP/UDP负载平衡器</a>之后。</li></ul><p id="4d00" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当使用代理时，从客户端到服务的数据通过3个连接发送:(1)从客户端到Google L7 LB的连接，然后(2)从LB到GKE集群中的入口控制器，以及(3)从控制器到运行应用服务的Kubernetes pods之一。这是因为Google L7 LB和ingress controller都作为反向代理<a class="ae ju" href="https://en.wikipedia.org/wiki/Reverse_proxy" rel="noopener ugc nofollow" target="_blank">工作</a>。</p><figure class="lh li lj lk fd ll er es paragraph-image"><div class="er es lg"><img src="../Images/dc73ec57d7d8452496d1dda4f5dad074.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/0*HEXgR2PwomU0Y8YY"/></div></figure><p id="b711" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">根据定义，Google Cloud不加密connection 1通信(蓝色箭头)。即使呼叫者“在GCP境内”,通信也会被路由到Google负载平衡器的公共IP地址，而不是传输中默认保护的对象。连接2(灰色箭头)总是被Google加密，即使您配置LB通过HTTPS/SSL与后端服务通信。只有当入口控制器和应用服务在不同的<a class="ae ju" href="https://cloud.google.com/kubernetes-engine/docs/concepts/types-of-clusters#multi-zonal_clusters" rel="noopener ugc nofollow" target="_blank">可用性区域</a>中运行时，连接3才会被隐式加密，因为不同的可用性区域总是位于不同的物理位置。</p><p id="e63a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于直接访问，在互联网上的客户端和GCP的虚拟机之间建立连接。它与上图中的连接1相匹配。正如上一段所解释的，Google不会隐式加密这些连接。加密必须由应用程序来实现。</p><h1 id="70cf" class="jv jw hi bd jx jy jz ka kb kc kd ke kf io kg ip kh ir ki is kj iu kk iv kl km bi translated">什么时候加密？</h1><p id="1b73" class="pw-post-body-paragraph ix iy hi iz b ja kn ij jc jd ko im jf jg kp ji jj jk kq jm jn jo kr jq jr js hb bi translated">抛开粗心的选项不谈，有两种主要的方法:</p><ul class=""><li id="3c5c" class="ks kt hi iz b ja jb jd je jg ku jk kv jo kw js kx ky kz la bi translated">保护应用流量免受<a class="ae ju" href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" rel="noopener ugc nofollow" target="_blank"> MitM </a>攻击</li><li id="5e4d" class="ks kt hi iz b ja lb jd lc jg ld jk le jo lf js kx ky kz la bi translated">遵循受监管的加密策略</li></ul><figure class="lh li lj lk fd ll er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lo"><img src="../Images/e4de4632d6f0e54319d638e24bb8b895.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XRYrYdmNtOuwghxK"/></div></div></figure><p id="dc51" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于受管制的应用，除了加密所有连接别无选择。否则，只对连接1进行加密就足够了，云提供商(在这种情况下是Google)需要努力加密云内传输的流量。</p><h1 id="31fe" class="jv jw hi bd jx jy jz ka kb kc kd ke kf io kg ip kh ir ki is kj iu kk iv kl km bi translated">放弃</h1><p id="bba7" class="pw-post-body-paragraph ix iy hi iz b ja kn ij jc jd ko im jf jg kp ji jj jk kq jm jn jo kr jq jr js hb bi translated">以上是谷歌云平台中流量加密原理的概述。本文不是安全指南。如果你需要，考虑打电话给GCP的专业服务中心。</p></div></div>    
</body>
</html>