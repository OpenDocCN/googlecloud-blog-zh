<html>
<head>
<title>Sending emails natively from Google Cloud Pub/Sub events</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Google Cloud发布/订阅事件本机发送电子邮件</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/sending-emails-natively-from-google-cloud-pub-sub-events-f8260ffa6a89?source=collection_archive---------0-----------------------#2021-05-08">https://medium.com/google-cloud/sending-emails-natively-from-google-cloud-pub-sub-events-f8260ffa6a89?source=collection_archive---------0-----------------------#2021-05-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="3ed6" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">概观</h1><p id="2282" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Google Cloud通常推荐使用<a class="ae kb" href="https://cloud.google.com/security-command-center/docs/how-to-enable-real-time-notifications" rel="noopener ugc nofollow" target="_blank"> SendGrid等工具从Cloud Pub/Sub </a>触发的云功能发送邮件。出于商业原因，一些组织可能不希望使用第三方发送电子邮件。此外，您可能希望您的电子邮件来自静态IP地址，这将需要使用更高级别的此类服务，从而产生额外的费用。</p><p id="cc4a" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">pubsub_sendmail是一个谷歌<a class="ae kb" href="https://cloud.google.com/functions" rel="noopener ugc nofollow" target="_blank">云功能</a>，它可以由谷歌云<a class="ae kb" href="https://cloud.google.com/pubsub" rel="noopener ugc nofollow" target="_blank"> Pub/Sub </a>触发，然后使用Python <a class="ae kb" href="https://docs.python.org/3/library/smtplib.html" rel="noopener ugc nofollow" target="_blank"> smtplib </a>向所需的收件人发送电子邮件。你也可以通过使用<a class="ae kb" href="https://cloud.google.com/vpc/docs/configure-serverless-vpc-access" rel="noopener ugc nofollow" target="_blank"> VPC接入连接器</a>和<a class="ae kb" href="https://cloud.google.com/nat/docs/overview" rel="noopener ugc nofollow" target="_blank">云NAT </a>让电子邮件来自一个静态IP地址。</p><p id="56a2" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">pubsub_sendmail是使用部署shell脚本中的环境变量配置的。这些环境变量将在本文档的后面部分描述。欢迎修改或修复错误。当然，您也可以修改代码以适应任何未涵盖的用例。</p><p id="a5fb" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">诸如SendGrid之类的服务在不同的服务层提供了许多生产级别的特性，并且受到服务供应商的支持。如果您的邮件量相对较低，但您需要从静态IP发送电子邮件，使用像pubsub_sendmail这样的原生云功能是另一种选择。代价是您必须实现并支持云功能。pubsub_sendmail函数支持通过VPC接入连接器和云NAT使用静态IP。</p><h1 id="edb6" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">图表</h1><p id="bcc0" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">下图显示了从Cloud Pub/Sub发出的消息如何通过Cloud函数，然后生成电子邮件。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div class="er es kh"><img src="../Images/9695807890a255b44814551eb87e3314.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*PIv8q2RIZDmBUc8MGzKEqw.png"/></div></figure><h1 id="0974" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">加密</h1><p id="8afb" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">您可以将pubsub_sendmail配置为使用强制加密、机会加密或不加密。使用<em class="kp">强制加密</em>(也称为<em class="kp">隐式</em>)，与邮件服务器的整个会话从头到尾都是加密的。没有明文。使用<em class="kp">机会加密</em>(也称为<em class="kp">显式</em>)会话以明文开始，但随后通过发送STARTTLS命令提升为加密。换句话说，如果服务器允许<em class="kp">加密</em>(但不要求<em class="kp"/>)，那么它就是<em class="kp">机会性的</em>。如果服务器需要，则<em class="kp">强制</em>。当不支持加密时，整个会话都是明文(极不可能)。</p><h1 id="4394" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">想了解更多？</h1><p id="505c" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">有关包括配置和故障排除步骤在内的其他信息，请参考<a class="ae kb" href="https://github.com/GoogleCloudPlatform/cloud-pubsub-sendmail" rel="noopener ugc nofollow" target="_blank"> GitHub知识库</a>。如果您想进行改进，请随时提交拉取请求。</p></div></div>    
</body>
</html>