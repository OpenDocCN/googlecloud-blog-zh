<html>
<head>
<title>Debugging Node Google Cloud Functions Locally in VS Code!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">VS代码本地调试节点Google Cloud函数！</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/debugging-node-google-cloud-functions-locally-in-vs-code-e6b912eb3f84?source=collection_archive---------0-----------------------#2019-07-22">https://medium.com/google-cloud/debugging-node-google-cloud-functions-locally-in-vs-code-e6b912eb3f84?source=collection_archive---------0-----------------------#2019-07-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7e5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Google Cloud Functions Framework(FF)是一个强大的开发工具，允许开发人员在他们喜欢的IDE中调试无服务器功能！</p><p id="0960" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇博文中，我们将学习如何通过<strong class="ih hj"> V8 Inspector协议</strong> ( <code class="du je jf jg jh b">--inspect</code>)在VS代码中使用断点支持在本地调试Google Cloud函数<em class="jd">。</em></p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es ji"><img src="../Images/ab8a6cde2443930ec099ad14bfcd2f97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O47i15CKGYE2zrjk49oD_A.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx">🚫🐞➕⚡</figcaption></figure><h1 id="038b" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">设置您的项目</h1><p id="2c47" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">从您的终端，使用<code class="du je jf jg jh b">npm</code> CLI创建一个新的FF节点项目:</p><h2 id="5f1b" class="lb jz hi bd ka lc ld le ke lf lg lh ki iq li lj km iu lk ll kq iy lm ln ku lo bi translated">package.json</h2><ul class=""><li id="c5d2" class="lp lq hi ih b ii kw im kx iq lr iu ls iy lt jc lu lv lw lx bi translated"><code class="du je jf jg jh b">npm init</code>:用默认设置创建一个新的npm模块。(持续按下<code class="du je jf jg jh b">&lt;ENTER&gt;</code></li><li id="9905" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated"><code class="du je jf jg jh b">npm i @google-cloud/functions-framework</code>:安装FF</li></ul><h2 id="7043" class="lb jz hi bd ka lc ld le ke lf lg lh ki iq li lj km iu lk ll kq iy lm ln ku lo bi translated">索引. js</h2><p id="b005" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">用<code class="du je jf jg jh b">code .</code>打开VS代码，用以下<em class="jd">存根</em>内容创建一个名为<code class="du je jf jg jh b">index.js</code>的新文件:</p><figure class="jj jk jl jm fd jn"><div class="bz dy l di"><div class="md me l"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">一个非常简单的用于测试的节点函数。</figcaption></figure><h1 id="7a84" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">设置与代码</h1><p id="01a9" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">VS代码自带内置节点调试器！但是我们仍然需要创建配置文件。</p><p id="3c28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要创建一个基本项目，用下面的<code class="du je jf jg jh b">launch.json</code>和<code class="du je jf jg jh b">settings.json</code>文件创建一个<code class="du je jf jg jh b">.vscode</code>目录:</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div class="er es mf"><img src="../Images/b9fbe00e39611d327d7d496f1b82ae5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:296/format:webp/1*jGQ17PoUiySFl8IKXnvgPQ.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">我们的项目目录结构</figcaption></figure><p id="0caa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du je jf jg jh b">.vscode/launch.json</code></p><figure class="jj jk jl jm fd jn"><div class="bz dy l di"><div class="md me l"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated"><code class="du je jf jg jh b">.vscode/launch.json</code></figcaption></figure><p id="d8dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">注意:</em>端口<code class="du je jf jg jh b">9229</code>是<code class="du je jf jg jh b">node --inspect</code>的默认端口号。</p><p id="f9b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du je jf jg jh b">.vscode/settings.json</code></p><figure class="jj jk jl jm fd jn"><div class="bz dy l di"><div class="md me l"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated"><code class="du je jf jg jh b">.vscode/settings.json</code></figcaption></figure><p id="5e63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该选项将<a class="ae mg" href="https://code.visualstudio.com/blogs/2018/07/12/introducing-logpoints-and-auto-attach#_autoattaching-to-node-processes" rel="noopener ugc nofollow" target="_blank">自动将</a>节点调试器附加到VS代码。有用。</p><h1 id="da20" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">运行函数框架</h1><p id="1c0f" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">使用菜单项<code class="du je jf jg jh b">View &gt; Terminal</code>打开VS代码中的终端。运行函数框架，使用:</p><pre class="jj jk jl jm fd mh jh mi mj aw mk bi"><span id="c0f9" class="lb jz hi jh b fi ml mm l mn mo">node --inspect node_modules/@google-cloud/functions-framework --target=listGoogleAPIs</span></pre><p id="8358" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来分解一下:</p><ul class=""><li id="8378" class="lp lq hi ih b ii ij im in iq mp iu mq iy mr jc lu lv lw lx bi translated"><code class="du je jf jg jh b">node --inspect</code>:使用检查员API的节点标志。参见<a class="ae mg" href="https://nodejs.org/en/docs/guides/debugging-getting-started/" rel="noopener ugc nofollow" target="_blank">文档</a>。</li><li id="adfe" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated"><code class="du je jf jg jh b">node_modules/@google-cloud/functions-framework</code>:这是FF npm模块的位置(包含一个<code class="du je jf jg jh b">package.json</code> <code class="du je jf jg jh b">bin</code>属性)。</li><li id="53f3" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated"><code class="du je jf jg jh b">--target=listGoogleAPIs</code>:我们用我们的方法传入FF的一面旗帜。</li></ul><p id="23dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您会看到类似这样的内容:</p><pre class="jj jk jl jm fd mh jh mi mj aw mk bi"><span id="7ac6" class="lb jz hi jh b fi ml mm l mn mo">node --inspect node_modules/@google-cloud/functions-framework --target=listGoogleAPIs</span><span id="64bb" class="lb jz hi jh b fi ms mm l mn mo">Debugger listening on ws://127.0.0.1:9229/a391af83-9e3a-4c87-a2d5-dce855afca7c<br/>For help, see: <a class="ae mg" href="https://nodejs.org/en/docs/inspector" rel="noopener ugc nofollow" target="_blank">https://nodejs.org/en/docs/inspector</a></span><span id="17ea" class="lb jz hi jh b fi ms mm l mn mo">Serving function...<br/>Function: listGoogleAPIs<br/><strong class="jh hj">URL: </strong><a class="ae mg" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank"><strong class="jh hj">http://localhost:8080/</strong></a><br/>Debugger attached.</span></pre><p id="6e56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您正在本地运行函数框架，并附带了调试器。转到<code class="du je jf jg jh b">localhost:8080</code>到<em class="jd">本地运行</em>功能！</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es mt"><img src="../Images/93866695544da1e612412204b285b1e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pwA_nROHxcr1sDktHNxTaw.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">你会注意到当调试器连接上时，VS代码的状态栏变成了橙色。</figcaption></figure><p id="51eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你应该<code class="du je jf jg jh b">{"sum":45}</code>。但是<em class="jd">我们如何调试</em>？请继续阅读！</p><h1 id="59f1" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">添加断点</h1><p id="c12e" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated"><em class="jd">当</em>您的<code class="du je jf jg jh b">node</code>进程正在运行时，通过单击使用VS代码的调试器工具:</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div class="er es mu"><img src="../Images/cf05d6a9795fae80c5e9c42e8f9bae69.png" data-original-src="https://miro.medium.com/v2/resize:fit:232/format:webp/1*9XAms7_bO8pb30zZCiA0hg.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">🐞➕🚫</figcaption></figure><blockquote class="mv mw mx"><p id="5b4a" class="if ig jd ih b ii ij ik il im in io ip my ir is it mz iv iw ix na iz ja jb jc hb bi translated">注意:如果您没有创建<code class="du je jf jg jh b">.vscode/settings.json</code>文件，那么您需要在运行FF之后使用左上角的图标手动连接调试器。</p></blockquote><p id="1955" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要添加断点，请单击行号的左侧以点亮鲜红色🔴。</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div class="er es nb"><img src="../Images/b844990ae9815e02e3e30f7aeea99a84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*gA8kPvewJkvl5DqMbT8LiQ.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">注意左边的红点。</figcaption></figure><p id="8470" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后使用<code class="du je jf jg jh b"><a class="ae mg" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/</a></code>运行该功能，在调试侧面板中查看有用的信息。将鼠标悬停在变量上以查看它们的值或向左看。</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es nc"><img src="../Images/227352e1ce7d18deca773ce340e1402f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uCbTLOSZJMBZH2DDvFJBrg.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">注意i = 6，sum = 15。</figcaption></figure><p id="242f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，你可以<code class="du je jf jg jh b">console.log</code>这些值，但是现在你可以看到栈上的每个变量，复制值，甚至注入你自己的变量值。在试图解决问题时，这真的很有帮助。</p><figure class="jj jk jl jm fd jn"><div class="bz dy l di"><div class="nd me l"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">TypeScript程序管理器的智慧之言</figcaption></figure><h1 id="72d5" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">做一些有趣的事情</h1><p id="058c" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">好的。所以我想for循环。但是让我们建立一些更令人印象深刻的东西。</p><p id="aaf4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae mg" href="https://developers.google.com/discovery/" rel="noopener ugc nofollow" target="_blank"> Google Discovery API </a>是一个元API，它列出了Google APIs。调用API不需要auth(甚至不需要Google账号！).让我们查询API并列出所有Google(可发现的)API:</p><ol class=""><li id="8d2e" class="lp lq hi ih b ii ij im in iq mp iu mq iy mr jc ne lv lw lx bi translated">安装Google API客户端库:</li></ol><p id="1e3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du je jf jg jh b">npm install googleapis</code></p><p id="ee6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.用以下代码替换<code class="du je jf jg jh b">index.js</code>。</p><figure class="jj jk jl jm fd jn"><div class="bz dy l di"><div class="md me l"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">列出谷歌API的一小段代码</figcaption></figure><p id="8609" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.现在重新运行该函数。您应该会看到一个很大的JSON响应，其中包含一个Google服务列表。</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div class="er es nf"><img src="../Images/5eb6a9a80521f4042c84794aeae0efdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*UFpfyntrYXGtMcLU9E8M-A.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">提示:使用这个Chrome扩展进行漂亮的JSON格式化！</figcaption></figure><p id="40ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">酷豆！</p><h1 id="e091" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">部署到谷歌云</h1><p id="a7bb" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">将该功能部署到Google Cloud很容易。只需运行下面的<code class="du je jf jg jh b">gcloud</code>命令:</p><pre class="jj jk jl jm fd mh jh mi mj aw mk bi"><span id="ee58" class="lb jz hi jh b fi ml mm l mn mo">gcloud functions deploy listGoogleAPIs --trigger-http --runtime nodejs10</span></pre><p id="3588" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">过一会儿，你会得到一个<code class="du je jf jg jh b">httpsTrigger</code> URL，如下所示:</p><pre class="jj jk jl jm fd mh jh mi mj aw mk bi"><span id="ef2d" class="lb jz hi jh b fi ml mm l mn mo"><a class="ae mg" href="https://us-central1-codercom-test.cloudfunctions.net/listGoogleAPIs" rel="noopener ugc nofollow" target="_blank">https://us-central1-my-project.cloudfunctions.net/listGoogleAPIs</a></span></pre><p id="2e1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简单的豌豆(柠檬榨汁机)。</p><h1 id="6575" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">高级调试</h1><p id="083f" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">我们甚至可以做一些奇特的事情，比如条件调试:</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="er es ng"><img src="../Images/e42bdc4dd42fa03de19ae7ab27edbebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cZY9mXZn7zWVmJsIW32VeQ.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">仅在api.id .以(' cloud ')开头时中断</figcaption></figure><p id="9d0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">厌倦了在PRs中意外提交<code class="du je jf jg jh b">console.log</code>测试代码？添加一个日志点，保持代码整洁。只需右键单击行号的左侧。</p><figure class="jj jk jl jm fd jn er es paragraph-image"><div class="er es nh"><img src="../Images/233f64cb6cd902a985afa1c01d38c403.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/format:webp/1*3jvPqz9hghtCWKY1103XoA.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">添加线点的所有选项。</figcaption></figure><h1 id="828b" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">后续步骤</h1><p id="39b0" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">感谢阅读！看看这些相关的帖子:</p><ul class=""><li id="4b07" class="lp lq hi ih b ii ij im in iq mp iu mq iy mr jc lu lv lw lx bi translated"><a class="ae mg" rel="noopener" href="/@granttimmerman/google-cloud-functions-framework-9fbd899c201c">了解有关功能框架的更多信息</a></li><li id="31f7" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated"><a class="ae mg" href="https://github.com/GoogleCloudPlatform/functions-framework-nodejs" rel="noopener ugc nofollow" target="_blank">在GitHub上贡献功能框架</a></li><li id="0d02" class="lp lq hi ih b ii ly im lz iq ma iu mb iy mc jc lu lv lw lx bi translated"><a class="ae mg" href="https://code.visualstudio.com/docs/nodejs/nodejs-tutorial#_debugging-hello-world" rel="noopener ugc nofollow" target="_blank">阅读VS代码</a>中的调试节点</li></ul></div></div>    
</body>
</html>