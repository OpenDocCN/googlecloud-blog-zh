<html>
<head>
<title>A Guide to Deploy Elasticsearch Cluster on Google Kubernetes Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åœ¨Google Kuberneteså¼•æ“ä¸Šéƒ¨ç½²Elasticsearché›†ç¾¤çš„æŒ‡å—</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/google-cloud/a-guide-to-deploy-elasticsearch-cluster-on-google-kubernetes-engine-52f67743ee98?source=collection_archive---------0-----------------------#2018-04-26">https://medium.com/google-cloud/a-guide-to-deploy-elasticsearch-cluster-on-google-kubernetes-engine-52f67743ee98?source=collection_archive---------0-----------------------#2018-04-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d8e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æŒ‡å—ï¼Œå¸®åŠ©ä½ åœ¨Google Kuberneteså¼•æ“ä¸Šéƒ¨ç½²Elasticsearché›†ç¾¤ã€‚æœ¬æŒ‡å—åº”è¯¥é€‚ç”¨äºä»»ä½•Kubernetesé›†ç¾¤ï¼Œåªéœ€å¯¹æŒä¹…å·éƒ¨åˆ†è¿›è¡Œç®€å•è°ƒæ•´ã€‚</p><p id="b85d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ€»ä½“æ­¥éª¤å¦‚ä¸‹æ‰€ç¤º:</p><ol class=""><li id="eb0d" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">é€šè¿‡<a class="ae jd" href="https://kubernetes.io/docs/concepts/storage/storage-classes/" rel="noopener ugc nofollow" target="_blank">å­˜å‚¨ç±»</a>å¯ç”¨æŒä¹…å·ã€‚</li><li id="33af" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">é€šè¿‡<a class="ae jd" href="https://kubernetes.io/docs/concepts/services-networking/service/#headless-services" rel="noopener ugc nofollow" target="_blank">æ— å¤´æœåŠ¡</a>å¯ç”¨ElasticsearchèŠ‚ç‚¹å‘ç°ã€‚</li><li id="1610" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">é€šè¿‡<a class="ae jd" href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/" rel="noopener ugc nofollow" target="_blank">æœ‰çŠ¶æ€é›†</a>éƒ¨ç½²Elasticsearché›†ç¾¤ã€‚</li></ol><h1 id="4d28" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">1.æŒä¹…å·</h1><p id="fab9" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">ç¬¬ä¸€æ­¥æ˜¯åœ¨é›†ç¾¤ä¸Šåˆ›å»ºä¸€ä¸ªå­˜å‚¨ç±»ã€‚ç”¨ä»¥ä¸‹å†…å®¹åˆ›å»ºåä¸º<code class="du kv kw kx ky b">storage.yaml</code>çš„æ–°æ–‡ä»¶:</p><pre class="kz la lb lc fd ld ky le lf aw lg bi"><span id="ee3b" class="lh jt hi ky b fi li lj l lk ll">kind: StorageClass<br/>apiVersion: storage.k8s.io/v1<br/>metadata:<br/>  name: ssd<br/>provisioner: kubernetes.io/gce-pd<br/>parameters:<br/>  type: pd-ssd<br/>  zone: asia-southeast1-a</span></pre><p id="1745" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„å­˜å‚¨ç±»<code class="du kv kw kx ky b">provisioner</code>æ˜¯GCE ( <code class="du kv kw kx ky b">kubernetes.io/gce-pd</code>)ï¼Œå…·æœ‰ä»¥ä¸‹å‚æ•°:</p><ol class=""><li id="4078" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated"><code class="du kv kw kx ky b">type: pd-ssd</code>å¯ç”¨SSDä½œä¸ºæŒä¹…ç£ç›˜ã€‚æ‚¨å¯ä»¥ç”¨<code class="du kv kw kx ky b">type: pd-standard</code>æ›´æ–°å‚æ•°ç±»å‹ï¼Œä½¿æ ‡å‡†ç£ç›˜æˆä¸ºæŒä¹…ç£ç›˜</li><li id="5ab2" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><code class="du kv kw kx ky b">zone: asia-southeast1-a</code>ä¸ºè®¡ç®—åŒºã€‚æ‚¨å¯ä»¥å°†å…¶æ›´æ–°åˆ°æ‚¨è®¡ç®—åŒºåŸŸã€‚æ‚¨ä¹Ÿå¯ä»¥å°†<code class="du kv kw kx ky b">zones</code>å‚æ•°ç”¨äºå¤šä¸ªåŒºåŸŸï¼Œå¦‚ä¸‹æ‰€ç¤º:<code class="du kv kw kx ky b">zones: asia-southeast1-a, asia-southeast1-b</code>ã€‚</li></ol><p id="d8be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ç”¨å­˜å‚¨ç±»:</p><pre class="kz la lb lc fd ld ky le lf aw lg bi"><span id="6246" class="lh jt hi ky b fi li lj l lk ll">kubectl apply -f storage.yaml</span></pre><p id="9835" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‚¨åº”è¯¥èƒ½å¤Ÿåœ¨<a class="ae jd" href="https://console.cloud.google.com/kubernetes/storage" rel="noopener ugc nofollow" target="_blank">æ§åˆ¶é¢æ¿</a>ä¸Šçœ‹åˆ°å­˜å‚¨ç±»:</p><figure class="kz la lb lc fd ln er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es lm"><img src="../Images/7132de1ce60e466cfa9fb026c53aee2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W1ne7-zQtj4CY7IcaiUStA.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">my Laniakeaé›†ç¾¤ä¸Šçš„å­˜å‚¨ç±»</figcaption></figure><p id="3430" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚æœæ‚¨åœ¨éGoogle Kuberneteså¼•æ“ä¸Šéƒ¨ç½²Elasticsearché›†ç¾¤ï¼Œè¯·æ›´æ–°ç½®å¤‡ç¨‹åºå’Œå‚æ•°ã€‚æ‚¨å¯ä»¥åœ¨<a class="ae jd" href="https://kubernetes.io/docs/concepts/storage/storage-classes/#parameters" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œçš„</a>ä¸­çœ‹åˆ°å¯ç”¨çš„ä¾›åº”å™¨å’Œå‚æ•°ã€‚æœ¬æŒ‡å—çš„å…¶ä½™éƒ¨åˆ†å°†é€‚ç”¨äºä»»ä½•Kubernetesé›†ç¾¤ã€‚</p><h1 id="8f36" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">2.å¼¹æ€§æœç´¢èŠ‚ç‚¹å‘ç°</h1><p id="d16c" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">ç¬¬äºŒæ­¥æ˜¯é€šè¿‡headlessæœåŠ¡å¯ç”¨elasticsearchèŠ‚ç‚¹å‘ç°ã€‚åˆ›å»ºåä¸º<code class="du kv kw kx ky b">service.yaml</code>çš„æ–°æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:</p><pre class="kz la lb lc fd ld ky le lf aw lg bi"><span id="eb48" class="lh jt hi ky b fi li lj l lk ll">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: es<br/>  labels:<br/>    service: elasticsearch<br/>spec:<br/>  clusterIP: None<br/>  ports:<br/>  - port: 9200<br/>    name: serving<br/>  - port: 9300<br/>    name: node-to-node<br/>  selector:<br/>    service: elasticsearch</span></pre><p id="3ccc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ç”¨æ— å¤´æœåŠ¡:</p><pre class="kz la lb lc fd ld ky le lf aw lg bi"><span id="73f5" class="lh jt hi ky b fi li lj l lk ll">kubectl apply -f service.yaml</span></pre><p id="9839" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‚¨åº”è¯¥èƒ½å¤Ÿåœ¨ä»ªè¡¨æ¿ä¸Šçœ‹åˆ°è¯¥æœåŠ¡:</p><figure class="kz la lb lc fd ln er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es ly"><img src="../Images/f181a4a99966a0c29a469cce9915c44e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d4G6UfjqDOmz2dtKpUaqyw.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx translated">laniakeaé›†ç¾¤ä¸Šçš„ES headlessæœåŠ¡</figcaption></figure><p id="7afb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨ï¼Œåœ¨kubernetesé›†ç¾¤ä¸­ï¼Œæ¯ä¸ªå¸¦æœ‰æ ‡ç­¾<code class="du kv kw kx ky b">service: elasticsearch</code>çš„podéƒ½åº”è¯¥å¯ä»¥é€šè¿‡<code class="du kv kw kx ky b">$PODNAME.es.default.cluster.local</code>è®¿é—®ã€‚è¿™å°†æœ‰åŠ©äºæˆ‘ä»¬çš„å¼¹æ€§æœç´¢èŠ‚ç‚¹å‘ç°å½¼æ­¤å¹¶å½¢æˆä¸€ä¸ªé›†ç¾¤ã€‚</p><h1 id="b306" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">3.å¼¹æ€§æœç´¢é›†ç¾¤</h1><p id="26e4" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">æœ€åä¸€æ­¥æ˜¯ä½¿ç”¨StatefulSetéƒ¨ç½²elasticsearché›†ç¾¤ã€‚åˆ›å»ºåä¸º<code class="du kv kw kx ky b">elasticsearch.yaml</code>çš„æ–°æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:</p><figure class="kz la lb lc fd ln"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="569d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¦éƒ¨ç½²Elasticsearché›†ç¾¤ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤:</p><pre class="kz la lb lc fd ld ky le lf aw lg bi"><span id="e7c0" class="lh jt hi ky b fi li lj l lk ll">kubectl apply -f elasticsearch.yaml</span></pre><p id="0057" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç¾¤é›†å‡†å¤‡å°±ç»ªå¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œè¿™å–å†³äºç¾¤é›†çš„å¤§å°ã€‚æ‚¨å¯ä»¥é€šè¿‡è®¿é—®<a class="ae jd" href="https://console.cloud.google.com/kubernetes/workload" rel="noopener ugc nofollow" target="_blank">å·¥ä½œè´Ÿè½½ä»ªè¡¨æ¿</a>æ¥æŸ¥çœ‹é›†ç¾¤æ˜¯å¦å‡†å¤‡å°±ç»ªã€‚</p><p id="f7af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚æœæ‚¨çš„é›†ç¾¤å·²å‡†å¤‡å¥½ï¼Œæ‚¨å¯ä»¥é€šè¿‡port-forwardè®¿é—®å…¶ä¸­ä¸€ä¸ªelasticsearchèŠ‚ç‚¹æ¥æ£€æŸ¥é›†ç¾¤æ˜¯å¦å·²åˆ›å»º:</p><pre class="kz la lb lc fd ld ky le lf aw lg bi"><span id="a0b1" class="lh jt hi ky b fi li lj l lk ll">kubectl port-forward elasticsearch-0 9200:9200</span></pre><p id="8691" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™å°†æŠŠæ‰€æœ‰å¯¹<a class="ae jd" href="http://localhost:9200" rel="noopener ugc nofollow" target="_blank"> http://localhost:9200 </a>çš„è¯·æ±‚è½¬å‘åˆ°elasticsearch-0èŠ‚ç‚¹ã€‚ç„¶å:</p><pre class="kz la lb lc fd ld ky le lf aw lg bi"><span id="90cc" class="lh jt hi ky b fi li lj l lk ll">curl <a class="ae jd" href="http://10.20.8.3:9200/_cluster/state?pretty" rel="noopener ugc nofollow" target="_blank">http://localhost:9200/_cluster/state?pretty</a></span></pre><p id="1c2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å®ƒåº”è¯¥å‘æ‚¨æ˜¾ç¤ºè¯¥é›†ç¾¤ç”±5ä¸ªå¼¹æ€§æœç´¢èŠ‚ç‚¹ç»„æˆã€‚</p><p id="64b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å°±æ˜¯è¿™æ ·ï¼ç°åœ¨ä½ å¯ä»¥æ¬£èµæˆ‘æœ€å–œæ¬¢çš„gifäº†:</p><figure class="kz la lb lc fd ln"><div class="bz dy l di"><div class="mb ma l"/></div><figcaption class="lu lv et er es lw lx bd b be z dx">ğŸ˜Š</figcaption></figure></div></div>    
</body>
</html>