<html>
<head>
<title>PHP Functions on Cloud Run 🐘 🎉</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PHP函数在云上运行🐘 🎉</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/php-functions-on-cloud-run-23acdb6022e9?source=collection_archive---------0-----------------------#2020-01-15">https://medium.com/google-cloud/php-functions-on-cloud-run-23acdb6022e9?source=collection_archive---------0-----------------------#2020-01-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/42303e00dc0837af337092ecf90cec81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G0TzqK4zDpJQAWheWEW3CA.png"/></div></div></figure><p id="e399" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">介绍<em class="jo"> PHP函数框架</em>。这个开源库允许您轻松地将PHP应用程序部署到Cloud Run。在这篇博文中，我们将向您简要介绍这个包，并向您展示如何将PHP函数部署到Cloud Run！💨👟</p><h1 id="c941" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">PHP函数框架</h1><p id="8b86" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">PHP函数框架允许任何人以FaaS开发者的体验轻松开发自包含的PHP函数，这些函数可以在本地运行/测试并部署到云中。框架是发布在<a class="ae ks" href="https://packagist.org/packages/google/cloud-functions-framework" rel="noopener ugc nofollow" target="_blank">packagest</a>上的包，源代码在<a class="ae ks" href="https://github.com/GoogleCloudPlatform/functions-framework-php" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。</p><h2 id="6670" class="kt jq hi bd jr ku kv kw jv kx ky kz jz jb la lb kd jf lc ld kh jj le lf kl lg bi translated">开发PHP函数</h2><p id="023b" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">PHP函数框架允许您使用Symfony的面向对象的web应用程序框架来创建简单的HTTP请求处理程序。在您的计算机上进行测试时，您可以使用PHP的内置web服务器(通过一个简单的CLI命令)来运行您的函数代码，以响应HTTP请求。</p><p id="a5e5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个框架最好用一个例子来说明。让我们通过在一个新文件中编写一个简单的函数来创建一个“Hello World”示例，<code class="du lh li lj lk b">index.php</code>:</p><figure class="ll lm ln lo fd ij"><div class="bz dy l di"><div class="lp lq l"/></div><figcaption class="lr ls et er es lt lu bd b be z dx translated"><code class="du lh li lj lk b"><em class="lv">index.php</em></code></figcaption></figure><p id="be83" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后在一个<code class="du lh li lj lk b">composer.json</code>文件中指定对框架的依赖:</p><figure class="ll lm ln lo fd ij"><div class="bz dy l di"><div class="lp lq l"/></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">composer.json</figcaption></figure><p id="4767" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用<code class="du lh li lj lk b">composer install</code>安装这个包。</p><p id="aea1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，使用下面的脚本在本地运行函数框架，该脚本使用PHP内置的web服务器:</p><pre class="ll lm ln lo fd lw lk lx ly aw lz bi"><span id="0ff7" class="kt jq hi lk b fi ma mb l mc md">export FUNCTION_TARGET=helloHttp<br/>export FUNCTION_SIGNATURE_TYPE=http<br/>php -S localhost:8080 vendor/bin/router.php</span></pre><blockquote class="me mf mg"><p id="09ca" class="iq ir jo is b it iu iv iw ix iy iz ja mh jc jd je mi jg jh ji mj jk jl jm jn hb bi translated">注意:<code class="du lh li lj lk b">export</code>命令最初只需要运行一次。</p></blockquote><p id="2071" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<code class="du lh li lj lk b"><a class="ae ks" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/</a></code>，你会看到你的PHP服务器在本地运行！🐘</p><h2 id="81b5" class="kt jq hi bd jr ku kv kw jv kx ky kz jz jb la lb kd jf lc ld kh jj le lf kl lg bi translated">容器化您的应用程序</h2><p id="340e" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">PHP函数框架是可移植的，也就是说，你可以将现有的应用程序代码和函数框架放在一起，在任何支持PHP的地方运行。</p><p id="de82" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">PHP函数框架repo包括一个<a class="ae ks" href="https://github.com/GoogleCloudPlatform/functions-framework-php/blob/master/examples/hello/Dockerfile" rel="noopener ugc nofollow" target="_blank">示例</a> <code class="du lh li lj lk b"><a class="ae ks" href="https://github.com/GoogleCloudPlatform/functions-framework-php/blob/master/examples/hello/Dockerfile" rel="noopener ugc nofollow" target="_blank">Dockerfile</a></code>，我们可以使用/复制它来构建我们的容器。将该文件的内容(复制如下)添加到一个名为<code class="du lh li lj lk b">Dockerfile</code>的<em class="jo">新</em>文件中，紧挨着您的<code class="du lh li lj lk b">index.php</code>文件:</p><figure class="ll lm ln lo fd ij"><div class="bz dy l di"><div class="lp lq l"/></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">Dockerfile文件</figcaption></figure><h2 id="d6e8" class="kt jq hi bd jr ku kv kw jv kx ky kz jz jb la lb kd jf lc ld kh jj le lf kl lg bi translated">部署到云运行</h2><p id="3e93" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">将您的应用程序部署到Google Cloud很容易。运行以下命令来构建您的容器并部署到云运行💨👟：</p><pre class="ll lm ln lo fd lw lk lx ly aw lz bi"><span id="a8b1" class="kt jq hi lk b fi ma mb l mc md"># Set env var "GCP_PROJECT" to our project name<br/>GCP_PROJECT=$(gcloud config list --format 'value(core.project)' 2&gt;/dev/null)</span><span id="7099" class="kt jq hi lk b fi mk mb l mc md"># Set our Cloud Run region (so we aren't prompted)<br/>gcloud config set run/region us-central1</span><span id="e71e" class="kt jq hi lk b fi mk mb l mc md"># Build and upload your image in Google Container Registry<br/>gcloud builds submit --tag gcr.io/$GCP_PROJECT/hellophp<br/>gcloud run deploy hellophp \<br/>  --image gcr.io/$GCP_PROJECT/hellophp \<br/>  --region us-central1 \<br/>  --allow-unauthenticated \<br/>  --set-env-vars=FUNCTION_TARGET=helloHttp \<br/>  --set-env-vars=FUNCTION_SIGNATURE_TYPE=http</span></pre><p id="dd4a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">大约30秒后，您会看到一个如下所示的URL:</p><pre class="ll lm ln lo fd lw lk lx ly aw lz bi"><span id="44d2" class="kt jq hi lk b fi ma mb l mc md">https://hellophp-q7vieseflq-uc.a.run.app/?name=Functions%20Framework</span></pre><blockquote class="me mf mg"><p id="a3a5" class="iq ir jo is b it iu iv iw ix iy iz ja mh jc jd je mi jg jh ji mj jk jl jm jn hb bi translated">注意:此Hello World服务因滥用被删除…</p></blockquote><p id="3e4d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请随意<code class="du lh li lj lk b">curl</code>你的网址，并调用我们的功能！</p></div><div class="ab cl ml mm gp mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="hb hc hd he hf"><p id="5c49" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你有它！您已经将第一个PHP函数部署到Google Cloud了！</p><h2 id="f60b" class="kt jq hi bd jr ku kv kw jv kx ky kz jz jb la lb kd jf lc ld kh jj le lf kl lg bi translated">了解更多信息</h2><p id="55a6" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">渴望通过Google Cloud了解更多关于函数框架的知识吗？</p><ul class=""><li id="db62" class="ms mt hi is b it iu ix iy jb mu jf mv jj mw jn mx my mz na bi translated"><a class="ae ks" href="https://github.com/GoogleCloudPlatform/functions-framework-php" rel="noopener ugc nofollow" target="_blank">🐘在GitHub </a>上阅读PHP函数框架的源代码</li><li id="ba75" class="ms mt hi is b it nb ix nc jb nd jf ne jj nf jn mx my mz na bi translated"><a class="ae ks" href="https://github.com/GoogleCloudPlatform/functions-framework" rel="noopener ugc nofollow" target="_blank">📖通过阅读开发指南</a>了解更多关于所有功能框架的信息</li></ul></div></div>    
</body>
</html>