<html>
<head>
<title>Setup SSO for OpenVPN Access Server with Google Cloud Identity using SAML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SAML为具有Google Cloud身份的OpenVPN访问服务器设置SSO</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/setup-sso-for-openvpn-access-server-with-google-cloud-identity-using-saml-e748accf1476?source=collection_archive---------0-----------------------#2022-12-24">https://medium.com/google-cloud/setup-sso-for-openvpn-access-server-with-google-cloud-identity-using-saml-e748accf1476?source=collection_archive---------0-----------------------#2022-12-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5d7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用OpenVPN Access Server 2.11或更高版本，您可以使用SAML设置SSO。在这篇博文中，我们将使用Google Cloud Identity或Google Workspace来设置SSO。</p><p id="0bc5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SAML的优势在于它可以提供单点登录(SSO)体验。这意味着您可以使用相同的SAML IdP凭据来访问支持SAML身份验证的各种应用程序和服务。这消除了为每个应用程序或服务添加新凭证的需要。</p><h1 id="1278" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">先决条件</h1><ol class=""><li id="6dc1" class="kb kc hi ih b ii kd im ke iq kf iu kg iy kh jc ki kj kk kl bi translated">OpenVPN接入服务器版本2.11或以上(<a class="ae km" rel="noopener" href="/google-cloud/how-to-setup-point-to-site-vpn-in-google-cloud-using-openvpn-66f642ba08c9">您可以按照这篇博文在GCP创建OpenVPN接入服务器</a></li><li id="723b" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc ki kj kk kl bi translated">谷歌工作空间或云身份</li></ol><h1 id="31ba" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">设置</h1><h2 id="eb43" class="ks je hi bd jf kt ku kv jj kw kx ky jn iq kz la jr iu lb lc jv iy ld le jz lf bi translated">第一步</h2><p id="d5d3" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">首先，您需要登录到OpenVPN访问服务器，以收集关于作为服务提供商的访问服务器的信息。</p><ol class=""><li id="ff69" class="kb kc hi ih b ii ij im in iq lj iu lk iy ll jc ki kj kk kl bi translated">登录OpenVPN访问服务器管理用户界面</li><li id="ade7" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc ki kj kk kl bi translated">点击<strong class="ih hj">认证</strong> &gt; <strong class="ih hj"> SAML </strong></li><li id="add7" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc ki kj kk kl bi translated">您将需要以下信息:</li></ol><p id="2d31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a.SP身份</p><p id="b952" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b.SP ACS</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es lm"><img src="../Images/b95fa02287bf5e163c5c7de6e936e721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WbaGRLgyv7xAAj9F741jWw.png"/></div></div></figure><h2 id="58da" class="ks je hi bd jf kt ku kv jj kw kx ky jn iq kz la jr iu lb lc jv iy ld le jz lf bi translated">第二步</h2><p id="12f2" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">捕获信息后，现在登录到谷歌管理控制台。</p><ol class=""><li id="f10c" class="kb kc hi ih b ii ij im in iq lj iu lk iy ll jc ki kj kk kl bi translated">从菜单中点击<strong class="ih hj">应用&gt;网络和移动应用</strong></li><li id="5d3a" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc ki kj kk kl bi translated">点击<strong class="ih hj">添加应用&gt;添加定制SAML应用</strong></li><li id="0e92" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc ki kj kk kl bi translated">输入应用名称、描述和图标，输入信息后点击<strong class="ih hj">继续</strong></li></ol><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ly"><img src="../Images/75f5e079a63ef7c8ab1401ace034f336.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qUaNvz8CUOaE-xeIHhiXAA.png"/></div></div></figure><p id="8391" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.点击选项1:下载IdP元数据下的<strong class="ih hj">下载元数据</strong></p><p id="0769" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.保存XML文件以便在步骤3中使用，并点击<strong class="ih hj">继续</strong></p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ly"><img src="../Images/e31b12267a5e3efdf59e7995bf444388.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vucf4n1vw5aUhCf1OISF6g.png"/></div></div></figure><p id="41f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.使用我们从OpenVPN访问服务器获取的SP信息，将以下内容输入Google app:</p><p id="5587" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a.ACS URL —输入OpenVPN访问服务器SP ACS</p><p id="72d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b.实体ID —输入访问服务器SP标识</p><p id="7de1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">c.开始URL —为客户端Web用户界面输入“cws ”(这将引导您的用户在登录后进入客户端Web用户界面)</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ly"><img src="../Images/d506d64645b0ea6b8b0c0bad8ab38639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e9TYyJ34DAY44qqV7jJJYg.png"/></div></div></figure><p id="fd67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">d.点击<strong class="ih hj">继续</strong></p><p id="3c23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.配置属性映射，然后单击完成。可以用“主邮箱”=“邮箱”)。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ly"><img src="../Images/4934bc61ab398e8454105058c92ac349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ZLmvRYr9F1lt-bJfoSPNQ.png"/></div></div></figure><p id="b6a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8.或者，您也可以将此自定义SAML应用程序分配给一个组，而不是分配给组织内的每个人。在本演示中，我们将保留默认设置，即组织级别。</p><h2 id="96a4" class="ks je hi bd jf kt ku kv jj kw kx ky jn iq kz la jr iu lb lc jv iy ld le jz lf bi translated">第三步</h2><p id="8a15" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">现在，让我们将元数据XML文件上传到我们在步骤2中下载的访问服务器。</p><ol class=""><li id="706e" class="kb kc hi ih b ii ij im in iq lj iu lk iy ll jc ki kj kk kl bi translated">登录OpenVPN访问服务器管理用户界面</li><li id="f508" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc ki kj kk kl bi translated">点击<strong class="ih hj">认证&gt; SAML </strong></li><li id="2b5a" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc ki kj kk kl bi translated">点击<strong class="ih hj">通过元数据自动配置身份提供商(IdP)</strong></li><li id="aa04" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc ki kj kk kl bi translated">点击<strong class="ih hj">选择文件</strong>选择IdP元数据文件。</li><li id="fabe" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc ki kj kk kl bi translated">选择IdP元数据文件，点击上传</li></ol><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ly"><img src="../Images/583538bba05dc1620c1f88ffd216dead.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pxayesNJ1A-bmL_ENIXn2w.png"/></div></div></figure><p id="72c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.文件上传后，点击<strong class="ih hj">更新运行服务器。</strong>更新服务器后，手动配置身份提供者(IdP)下的所有详细信息应可见:</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es lz"><img src="../Images/675fb31d16331c7de46ebf251e5df080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C1xJjq5jyfZ18z3UF96EMA.png"/></div></div></figure><h2 id="5f62" class="ks je hi bd jf kt ku kv jj kw kx ky jn iq kz la jr iu lb lc jv iy ld le jz lf bi translated">第四步</h2><p id="87e8" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">现在我们已经配置了SAML，我们需要为用户打开服务。</p><ol class=""><li id="f555" class="kb kc hi ih b ii ij im in iq lj iu lk iy ll jc ki kj kk kl bi translated">登录谷歌管理控制台。</li><li id="0697" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc ki kj kk kl bi translated">点击<strong class="ih hj">应用&gt;网络和移动应用</strong></li><li id="2018" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc ki kj kk kl bi translated">点击你的<strong class="ih hj"> SAML应用。</strong>(我已经给app起了OpenVPN接入服务器名)</li><li id="c1c1" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc ki kj kk kl bi translated">点击<strong class="ih hj">用户访问</strong></li><li id="560e" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc ki kj kk kl bi translated">为每个人选择<strong class="ih hj">打开</strong>并点击<strong class="ih hj">保存</strong></li></ol><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ly"><img src="../Images/46d5954e15cd75eb0acc2c853fd704bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rR62qAjWdqEScJnL1679og.png"/></div></div></figure><p id="f908" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.现在登录到OpenVPN访问服务器管理界面。</p><p id="e029" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.点击<strong class="ih hj">认证&gt; SAML </strong></p><p id="4644" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8.点击开关打开<strong class="ih hj">启用SAML认证</strong>，然后点击<strong class="ih hj">保存设置</strong>和<strong class="ih hj">更新运行服务器</strong>。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ly"><img src="../Images/60e691e7808391301705d9bec7db9ce9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4WzLcTGUjqadxrGNgPpK6w.png"/></div></div></figure><p id="c14d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">9.现在，您可以按用户、按组配置文件或在全局级别启用SAML。</p><p id="74aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">10.在本演示中，我们将在每个用户级别和组级别启用，但我们还将了解如何在全局级别启用。</p><h2 id="eaf4" class="ks je hi bd jf kt ku kv jj kw kx ky jn iq kz la jr iu lb lc jv iy ld le jz lf bi translated">第五步</h2><p id="e7c8" class="pw-post-body-paragraph if ig hi ih b ii kd ik il im ke io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">现在，我们已经使用SAML for OpenVPN配置了SSO，我们可以将用户添加到OpenVPN访问服务器来启用访问。</p><ol class=""><li id="beed" class="kb kc hi ih b ii ij im in iq lj iu lk iy ll jc ki kj kk kl bi translated">登录到OpenVPN访问服务器管理界面。</li><li id="e788" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc ki kj kk kl bi translated">分配给用户</li></ol><p id="be5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a.点击<strong class="ih hj">用户管理&gt;用户权限</strong></p><p id="7288" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b.点击<strong class="ih hj">更多设置</strong>，选择<strong class="ih hj">认证方式</strong>下的<strong class="ih hj"> SAML </strong></p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ly"><img src="../Images/147770a44af2e9d42152a89f742d3fe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sbCbB83spQa7jB6bYUIAIw.png"/></div></div></figure><p id="d320" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">c.点击<strong class="ih hj">保存设置</strong>和<strong class="ih hj">更新运行服务器</strong></p><p id="a56d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.分配到一个组</p><p id="e49f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a.点击<strong class="ih hj">用户管理&gt;群组权限</strong></p><p id="78f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b.点击<strong class="ih hj">更多设置</strong>并选择<strong class="ih hj">认证方法</strong>下的<strong class="ih hj"> SAML </strong></p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ly"><img src="../Images/8b50280f02720a7f1e8d864ac79f95b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5OL2MDVCHnkfhxMGLDsLzg.png"/></div></div></figure><p id="c3cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">c.点击<strong class="ih hj">保存设置</strong>和<strong class="ih hj">更新运行服务器</strong></p><p id="e5f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.现在我们已经为测试用户将<strong class="ih hj">认证方法</strong>改为<strong class="ih hj"> SAML </strong>，我们可以使用云身份登录OpenVPN。</p><p id="2a6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.要对此进行测试，请打开OpenVPN访问服务器用户登录。</p><p id="3baa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.如果SAML已启用，您会在登录页面中找到通过SAML 按钮登录的<strong class="ih hj">。</strong></p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ma"><img src="../Images/4e967fea32fbdbc8f45a2a30bb66d50d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J07qIn6jQwdE0D6MjnPu-Q.png"/></div></div></figure><p id="3ba1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.单击“通过SAML登录”按钮，并使用我们在OpenVPN访问服务器中为SAML身份验证方法添加的用户登录。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mb"><img src="../Images/0585e0bed67c4ed3814afeea77f4c7d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ACFHjFYAjEuOFvKXMabzbQ.png"/></div></div></figure><p id="67a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8.登录后，您可以下载OpenVPN客户端或配置文件。此外，您可以直接从OpenVPN客户端登录并完成登录过程。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mc"><img src="../Images/a17e1e31de16d942c4cc07636119c6f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xvdC8PoWR5TbjG4Yum9HFw.png"/></div></div></figure><p id="8ef4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">9.或者，您可以启用SAML作为云身份用户的每个用户的默认身份验证方法。</p><p id="4454" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a.登录OpenVPN访问服务器管理用户界面</p><p id="1294" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b.点击<strong class="ih hj">认证&gt;设置</strong></p><p id="881b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">c.在<strong class="ih hj">默认认证系统</strong>下，选择<strong class="ih hj"> SAML </strong></p><p id="7c52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">d.将<strong class="ih hj">默认拒绝访问未列出的账户</strong>设置为<strong class="ih hj">否</strong></p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ly"><img src="../Images/f91bd92ead7cd4e6c89d9190ccc704d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KpkcpBTeypBcn4yEu1DqzA.png"/></div></div></figure><p id="2b3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">e.点击<strong class="ih hj">保存设置</strong>和<strong class="ih hj">更新运行服务器</strong>。</p><p id="7299" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您已经有了OpenVPN访问服务器，它配置了SAML，可以使用Google Cloud Identity进行单点登录。您可以从云身份实施MFA以获得额外的安全性。</p></div></div>    
</body>
</html>