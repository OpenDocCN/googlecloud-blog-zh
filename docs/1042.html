<html>
<head>
<title>MicroK8s on Google Cloud Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云平台上的MicroK8s</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/microk8s-on-google-cloud-platform-d8b7a71a3ef?source=collection_archive---------1-----------------------#2019-06-21">https://medium.com/google-cloud/microk8s-on-google-cloud-platform-d8b7a71a3ef?source=collection_archive---------1-----------------------#2019-06-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="67c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://microk8s.io/" rel="noopener ugc nofollow" target="_blank">https://microk8s.io/</a></p><p id="c630" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这多酷啊！？</p><h2 id="3ad5" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">设置</h2><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="bbe3" class="je jf hi ke b fi ki kj l kk kl">PROJECT=[[YOUR-PROJECT]]<br/>INSTANCE=[[YOUR-INSTANCE]] # Perhaps 'microk8s'<br/>ZONE=[[YOUR-ZONE]]</span><span id="fc58" class="je jf hi ke b fi km kj l kk kl">gcloud compute instances create ${INSTANCE} \<br/>--machine-type=custom-2-8192 \<br/>--preemptible \<br/>--tags=microk8s \<br/>--image-family=<strong class="ke hj">ubuntu-minimal-1904</strong> \<br/>--image-project=ubuntu-os-cloud \<br/>--zone=${ZONE} \<br/>--project=${PROJECT} \<br/>--metadata=startup-script='<br/>!# /bin/bash<br/><strong class="ke hj">sudo snap install microk8s --classic --channel=1.15/stable<br/>'</strong></span></pre><blockquote class="kn ko kp"><p id="d681" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated">使用你喜欢的任何一个Ubuntu版本。我真的很想要Ubuntu Core，但我认为<code class="du ku kv kw ke b">-minimial-</code>可能和。Ubuntu预装了snap。</p></blockquote><p id="0e97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想节省用<code class="du ku kv kw ke b">sudo</code>作为<code class="du ku kv kw ke b">microk8s.kubectl</code>命令前缀的时间，您可以使用以下命令将您的用户添加到实例的<code class="du ku kv kw ke b">microk8s</code>组:</p><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="e31e" class="je jf hi ke b fi ki kj l kk kl">gcloud compute ssh ${INSTANCE} \<br/>--zone=${ZONE} \<br/>--project=${PROJECT} \<br/>--command="<strong class="ke hj">sudo usermod -a -G microk8s $(whoami)</strong>"</span></pre><p id="35a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后:</p><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="063c" class="je jf hi ke b fi ki kj l kk kl">gcloud compute ssh ${INSTANCE} \<br/>--zone=${ZONE} \<br/>--project=${PROJECT}</span></pre><h2 id="72b1" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">库伯内特斯</h2><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="4607" class="je jf hi ke b fi ki kj l kk kl"><strong class="ke hj">microk8s.</strong>kubectl cluster-info<br/>Kubernetes master is running at <a class="ae jd" href="https://127.0.0.1:16443" rel="noopener ugc nofollow" target="_blank">https://127.0.0.1:16443</a><br/>Heapster is running at ...<br/>Grafana is running at ...<br/>InfluxDB is running at ...</span><span id="c2dc" class="je jf hi ke b fi km kj l kk kl"><strong class="ke hj">microk8s.</strong>kubectl get nodes<br/>NAME       STATUS   ROLES    AGE   VERSION<br/>microk8s   Ready    &lt;none&gt;    5m   v1.15.0</span></pre><p id="eae9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后:</p><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="33b9" class="je jf hi ke b fi ki kj l kk kl">microk8s.kubectl run nginx --image=docker.io/nginx --port=80</span><span id="99b2" class="je jf hi ke b fi km kj l kk kl">microk8s.kubectl get pods<br/>NAME                     READY   STATUS    RESTARTS   AGE<br/>nginx-5d756c54b9-hm97d   1/1     Running   0          48s</span><span id="b293" class="je jf hi ke b fi km kj l kk kl">microk8s.kubectl scale deployment/nginx --replicas=3</span><span id="7559" class="je jf hi ke b fi km kj l kk kl">microk8s.kubectl get pods<br/>NAME                     READY   STATUS    RESTARTS   AGE<br/>nginx-5d756c54b9-gh5m6   1/1     Running   0          7s<br/>nginx-5d756c54b9-hm97d   1/1     Running   0          71s<br/>nginx-5d756c54b9-j869t   1/1     Running   0          7s</span><span id="2a28" class="je jf hi ke b fi km kj l kk kl">microk8s.kubectl expose deployment/nginx --type=NodePort</span><span id="a328" class="je jf hi ke b fi km kj l kk kl">microk8s.kubectl describe service/nginx<br/>Name:                     nginx<br/>Namespace:                default<br/>Labels:                   run=nginx<br/>Annotations:              &lt;none&gt;<br/>Selector:                 run=nginx<br/>Type:                     NodePort<br/>IP:                       10.152.183.77<br/>Port:                     &lt;unset&gt;  80/TCP<br/>TargetPort:               80/TCP<br/>NodePort:                 &lt;unset&gt;  <strong class="ke hj">32592</strong>/TCP<br/>Endpoints:                10.1.1.10:80,10.1.1.11:80,10.1.1.12:80<br/>Session Affinity:         None<br/>External Traffic Policy:  Cluster<br/>Events:                   &lt;none&gt;</span></pre><p id="951a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，还有:</p><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="86d2" class="je jf hi ke b fi ki kj l kk kl"># Programmatically grab the NodePort value (#32592 above)<strong class="ke hj"><br/>PORT</strong>=$(\<br/>  microk8s.kubectl get service/nginx \<br/>  --output=jsonpath="{.spec.ports[0].nodePort}")</span><span id="8159" class="je jf hi ke b fi km kj l kk kl">curl <a class="ae jd" href="http://localhost:$(microk8s.kubectl" rel="noopener ugc nofollow" target="_blank">http://localhost:</a>${PORT}</span></pre><p id="9a01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">退货:</p><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="256a" class="je jf hi ke b fi ki kj l kk kl">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>&lt;head&gt;<br/>&lt;title&gt;Welcome to nginx!&lt;/title&gt;<br/>&lt;style&gt;<br/>    body {<br/>        width: 35em;<br/>        margin: 0 auto;<br/>        font-family: Tahoma, Verdana, Arial, sans-serif;<br/>    }<br/>&lt;/style&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;<br/>&lt;p&gt;If you see this page, the nginx web server is successfully installed and<br/>working. Further configuration is required.&lt;/p&gt;</span><span id="9b6e" class="je jf hi ke b fi km kj l kk kl">&lt;p&gt;For online documentation and support please refer to<br/>&lt;a href="<a class="ae jd" href="http://nginx.org/" rel="noopener ugc nofollow" target="_blank">http://nginx.org/</a>"&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;<br/>Commercial support is available at<br/>&lt;a href="<a class="ae jd" href="http://nginx.com/" rel="noopener ugc nofollow" target="_blank">http://nginx.com/</a>"&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><span id="88bb" class="je jf hi ke b fi km kj l kk kl">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="5e39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者，如果你喜欢:</p><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="98e1" class="je jf hi ke b fi ki kj l kk kl">gcloud compute ssh ${INSTANCE} \<br/>--ssh-flag="-L <strong class="ke hj">${PORT}</strong>:localhost:<strong class="ke hj">${PORT}</strong>" \<br/>--zone=${ZONE} \<br/>--project=${PROJECT}</span></pre><blockquote class="kn ko kp"><p id="9be9" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated">因为你必须从你的本地工作站运行<code class="du ku kv kw ke b">gcloud</code>命令，你不会有<code class="du ku kv kw ke b">${PORT}</code>设置。因此，您必须用值(在我的例子中是<code class="du ku kv kw ke b">32592</code>)替换<code class="du ku kv kw ke b">${PORT}</code>，或者在本地设置变量的值。</p><p id="6603" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated"><strong class="ih hj">注意</strong>不要求远程${PORT}值映射到您工作站上的相同端口；您还可以使用<code class="du ku kv kw ke b">80:localhost:${PORT}</code>来访问<code class="du ku kv kw ke b">:80</code>上的Nginx服务。</p></blockquote><p id="abb7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，您可以从本地工作站访问该服务:</p><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="7289" class="je jf hi ke b fi ki kj l kk kl">google-chrome http://localhost:${PORT}</span></pre><figure class="jz ka kb kc fd ky er es paragraph-image"><div class="er es kx"><img src="../Images/f1ed2b4b6651a582aa79ae8c12b24b88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*4GyH2riAxbrUUsezWTvUjQ.png"/></div></figure><h2 id="625f" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">结论</h2><p id="8c9f" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">作为一名谷歌人，我被Kubernetes引擎宠坏了，但有时你只是想要最简单的集群，或者你想在本地开发|部署。MicroK8s很优秀。</p><h2 id="f505" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">后续行动</h2><p id="7da1" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">安全地本地访问远程集群。</p><p id="f029" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">API服务器在<code class="du ku kv kw ke b">:16443</code>上可用。如果我们可以创建一个本地kubernetes配置文件*并且*我们可以转发到<code class="du ku kv kw ke b">:16443</code>，那么我们就可以远程访问集群:</p><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="3e1d" class="je jf hi ke b fi ki kj l kk kl">gcloud compute ssh ${INSTANCE} \<br/>--zone=${ZONE} \<br/>--project=${PROJECT} \<br/><strong class="ke hj">--ssh-flag="-L 16443:localhost:16443"</strong> </span></pre><p id="d653" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，从另一个终端(当上面的ssh端口转发正在运行时)，我们可以复制<code class="du ku kv kw ke b">microk8s</code>配置文件(</p><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="e849" class="je jf hi ke b fi ki kj l kk kl">gcloud compute scp \<br/>${INSTANCE}:/var/snap/microk8s/current/credentials/client.config \<br/>${PWD} \<br/>--zone=${ZONE} \<br/>--project=${PROJECT}</span></pre><p id="9494" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，或者使用<code class="du ku kv kw ke b">KUBECONFIG</code>:</p><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="5d3e" class="je jf hi ke b fi ki kj l kk kl">KUBECONFIG=${PWD}/client.config<br/>kubectl get pods</span></pre><p id="caaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者，显式引用每个命令上的配置:</p><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="e38c" class="je jf hi ke b fi ki kj l kk kl">kubectl --kubeconfig=${PWD}/client.config get pods</span></pre><p id="9592" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了完整起见，如果您的本地工作站也使用Snap，Google的Cloud SDK ( <code class="du ku kv kw ke b">gcloud</code>和<code class="du ku kv kw ke b">kubectl</code>都可以作为Snap使用。</p></div></div>    
</body>
</html>