<html>
<head>
<title>Use Google Cloud Memorystore (Redis) with the Online Boutique sample on GKE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用谷歌云存储(Redis)和GKE的在线精品样本</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/use-google-cloud-memorystore-redis-with-the-online-boutique-sample-on-gke-82f7879a900d?source=collection_archive---------2-----------------------#2022-12-20">https://medium.com/google-cloud/use-google-cloud-memorystore-redis-with-the-online-boutique-sample-on-gke-82f7879a900d?source=collection_archive---------2-----------------------#2022-12-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8a68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，在线精品样本的<code class="du jd je jf jg b">cartservice</code>将其数据存储在集群内Redis数据库中。在您的GKE集群之外使用完全托管的数据库服务，比如<a class="ae jh" href="https://cloud.google.com/memorystore" rel="noopener ugc nofollow" target="_blank"> Memorystore (Redis) </a>可以带来更高的弹性、可伸缩性和安全性。</p><blockquote class="ji jj jk"><p id="4a94" class="if ig jl ih b ii ij ik il im in io ip jm ir is it jn iv iw ix jo iz ja jb jc hb bi translated"><em class="hi">利用Redis的可扩展、安全且高度可用的内存服务减少延迟。</em></p></blockquote><p id="377c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，让我们看看如何将GKE集群上的在线精品样本连接到Google Cloud Memorystore (Redis)。</p><figure class="jq jr js jt fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es jp"><img src="../Images/7bc60a8128afe51c79121ab3bfdc9f71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bog3x3pLGKl_zgklFcjUtg.png"/></div></div><figcaption class="kb kc et er es kd ke bd b be z dx translated">使用Memorystore (Redis)的在线精品示例应用程序架构</figcaption></figure><h1 id="2843" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">目标</h1><ul class=""><li id="dcaf" class="ld le hi ih b ii lf im lg iq lh iu li iy lj jc lk ll lm ln bi translated">创建一个Google Kubernetes引擎(GKE)集群</li><li id="f9bf" class="ld le hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">设置内存存储(Redis)实例</li><li id="fdfb" class="ld le hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">部署连接到Memorystore (Redis)实例的在线精品示例</li></ul></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h1 id="ae76" class="kf kg hi bd kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky me la lb lc bi translated">费用</h1><p id="a4ff" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq mf is it iu mg iw ix iy mh ja jb jc hb bi translated">本教程使用Google Cloud的付费组件，包括:</p><ul class=""><li id="7421" class="ld le hi ih b ii ij im in iq mi iu mj iy mk jc lk ll lm ln bi translated"><a class="ae jh" href="https://cloud.google.com/kubernetes-engine/pricing" rel="noopener ugc nofollow" target="_blank"> Kubernetes发动机</a></li><li id="d4c7" class="ld le hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated"><a class="ae jh" href="https://cloud.google.com/memorystore/docs/redis/pricing" rel="noopener ugc nofollow" target="_blank"> Memorystore (Redis) </a></li></ul><p id="08cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<a class="ae jh" href="https://cloud.google.com/products/calculator" rel="noopener ugc nofollow" target="_blank">定价计算器</a>根据您的预计使用量生成成本估算。</p></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h1 id="71c9" class="kf kg hi bd kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky me la lb lc bi translated">开始之前</h1><p id="40ba" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq mf is it iu mg iw ix iy mh ja jb jc hb bi translated">本指南假设您拥有Google Cloud项目的所有者IAM权限。在生产中，您不需要所有者许可。</p><ol class=""><li id="6ecb" class="ld le hi ih b ii ij im in iq mi iu mj iy mk jc ml ll lm ln bi translated"><a class="ae jh" href="https://console.cloud.google.com/projectselector2" rel="noopener ugc nofollow" target="_blank">选择或创建一个谷歌云项目</a>。</li><li id="2acd" class="ld le hi ih b ii lo im lp iq lq iu lr iy ls jc ml ll lm ln bi translated"><a class="ae jh" href="https://cloud.google.com/billing/docs/how-to/modify-project" rel="noopener ugc nofollow" target="_blank">验证您的项目是否启用了计费</a>。</li></ol></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h1 id="96f9" class="kf kg hi bd kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky me la lb lc bi translated">设置您的环境</h1><p id="c56f" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq mf is it iu mg iw ix iy mh ja jb jc hb bi translated">初始化本教程中使用的通用变量:</p><pre class="jq jr js jt fd mm jg mn bn mo mp bi"><span id="da07" class="mq kg hi jg b be mr ms l mt mu">PROJECT_ID=FIXME-WITH-YOUR-PROJECT-ID<br/>REGION=us-east5<br/>ZONE=us-east5-a</span></pre><p id="1472" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了避免在整个教程中重复命令中的<code class="du jd je jf jg b">--project</code>，让我们设置当前项目:</p><pre class="jq jr js jt fd mm jg mn bn mo mp bi"><span id="01ae" class="mq kg hi jg b be mr ms l mt mu">gcloud config set project ${PROJECT_ID}</span></pre></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h1 id="a9a6" class="kf kg hi bd kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky me la lb lc bi translated">在项目中启用所需的API</h1><pre class="jq jr js jt fd mm jg mn bn mo mp bi"><span id="9669" class="mq kg hi jg b be mr ms l mt mu">gcloud services enable \<br/>    redis.googleapis.com \<br/>    container.googleapis.com</span></pre></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h1 id="8d0f" class="kf kg hi bd kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky me la lb lc bi translated">创建GKE集群</h1><pre class="jq jr js jt fd mm jg mn bn mo mp bi"><span id="0bd0" class="mq kg hi jg b be mr ms l mt mu">CLUSTER=memorystore-with-onlineboutique<br/>gcloud container clusters create ${CLUSTER} \<br/>    --zone ${ZONE} \<br/>    --machine-type=e2-standard-4 \<br/>    --num-nodes 4 \<br/>    --network default</span></pre></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h1 id="8386" class="kf kg hi bd kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky me la lb lc bi translated">设置Memorystore (Redis)实例</h1><pre class="jq jr js jt fd mm jg mn bn mo mp bi"><span id="8687" class="mq kg hi jg b be mr ms l mt mu">REDIS_NAME=memorystore-with-onlineboutique<br/>gcloud redis instances create ${REDIS_NAME} \<br/>    --size 1 \<br/>    --region ${REGION} \<br/>    --zone ${ZONE} \<br/>    --redis-version redis_6_x \<br/>    --network default</span></pre><p id="05bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意事项:</p><ul class=""><li id="d4b4" class="ld le hi ih b ii ij im in iq mi iu mj iy mk jc lk ll lm ln bi translated">您可以从位于同一区域的GKE集群连接到Memorystore (Redis)实例，并使用与您的实例相同的网络。</li><li id="4fae" class="ld le hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated">如果未启用VPC本地/IP别名，则无法从GKE集群连接到Memorystore (Redis)实例。</li></ul><p id="f178" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">等待Memorystore (Redis)实例成功预配，然后获取连接信息(专用IP地址和端口):</p><pre class="jq jr js jt fd mm jg mn bn mo mp bi"><span id="f62f" class="mq kg hi jg b be mr ms l mt mu">REDIS_IP=$(gcloud redis instances describe ${REDIS_NAME} \<br/>    --region ${REGION} \<br/>    --format 'get(host)')<br/>REDIS_PORT=$(gcloud redis instances describe ${REDIS_NAME} \<br/>    --region ${REGION} \<br/>    --format 'get(port)')</span></pre></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h1 id="ab38" class="kf kg hi bd kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky me la lb lc bi translated">部署连接到Memorystore (Redis)实例的在线精品商店</h1><p id="6cd8" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq mf is it iu mg iw ix iy mh ja jb jc hb bi translated">部署没有默认集群内Redis数据库的在线精品示例应用程序，现在指向Memorystore (Redis)实例:</p><pre class="jq jr js jt fd mm jg mn bn mo mp bi"><span id="9cf8" class="mq kg hi jg b be mr ms l mt mu">NAMESPACE=onlineboutique<br/>helm upgrade onlineboutique oci://us-docker.pkg.dev/online-boutique-ci/charts/onlineboutique \<br/>    --install \<br/>    --create-namespace \<br/>    -n ${NAMESPACE} \<br/>    --set cartDatabase.inClusterRedis.create=false \<br/>    --set cartDatabase.connectionString=${REDIS_IP}:${REDIS_PORT}</span></pre><p id="6969" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">成功部署所有应用程序后，您可以通过点击以下链接导航至在线精品网站:</p><pre class="jq jr js jt fd mm jg mn bn mo mp bi"><span id="3298" class="mq kg hi jg b be mr ms l mt mu">echo -n "http://" &amp;&amp; kubectl get svc frontend-external -n ${NAMESPACE} -o json | jq -r '.status.loadBalancer.ingress[0].ip'</span></pre><p id="bae8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">瞧，你可以轻松地将你的在线精品示例应用程序连接到一个Memorystore (Redis)数据库，恭喜你！</p></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h1 id="fb50" class="kf kg hi bd kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky me la lb lc bi translated">清理</h1><p id="851c" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq mf is it iu mg iw ix iy mh ja jb jc hb bi translated">为了避免向您的Google Cloud帐户收取费用，您可以删除本教程中使用的资源。</p><p id="1a35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除GKE群集:</p><pre class="jq jr js jt fd mm jg mn bn mo mp bi"><span id="9c7f" class="mq kg hi jg b be mr ms l mt mu">gcloud container clusters delete ${CLUSTER} \<br/>    --zone ${ZONE}</span></pre><p id="eb3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除Memorystore (redis)实例:</p><pre class="jq jr js jt fd mm jg mn bn mo mp bi"><span id="c43b" class="mq kg hi jg b be mr ms l mt mu">gcloud redis instances delete ${REDIS_NAME}</span></pre></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h1 id="7dcb" class="kf kg hi bd kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky me la lb lc bi translated">结论</h1><p id="60fc" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq mf is it iu mg iw ix iy mh ja jb jc hb bi translated">将数据库放在GKE集群之外，并提供托管服务，比如谷歌云存储(Redis)，可以为您带来更高的弹性、可伸缩性和安全性。这种设置允许复杂的场景，比如将应用程序分布在多个集群中，等等。</p></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><h1 id="76a4" class="kf kg hi bd kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky me la lb lc bi translated">更多资源</h1><ul class=""><li id="bf5a" class="ld le hi ih b ii lf im lg iq lh iu li iy lj jc lk ll lm ln bi translated"><a class="ae jh" href="https://cloud.google.com/blog/products/databases/best-pactices-for-cloud-memorystore-for-redis/" rel="noopener ugc nofollow" target="_blank">Google Cloud memory store for Redis最佳实践——高性能无忧部署技巧</a></li><li id="a791" class="ld le hi ih b ii lo im lp iq lq iu lr iy ls jc lk ll lm ln bi translated"><a class="ae jh" rel="noopener" href="/google-cloud/seamlessly-encrypt-traffic-from-any-apps-in-your-mesh-to-memorystore-redis-64b71969318d">无缝加密从网格中任何应用到Memorystore (Redis)的流量</a></li></ul></div><div class="ab cl lt lu gp lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hb hc hd he hf"><p id="b44f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jl">原帖</em><a class="ae jh" href="https://mathieu-benoit.github.io/" rel="noopener ugc nofollow" target="_blank"><em class="jl">Mathieu-Benoit . github . io</em></a><em class="jl">。</em></p></div></div>    
</body>
</html>