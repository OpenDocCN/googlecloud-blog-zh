<html>
<head>
<title>From Idea to Deployed on GCP in &lt; 24hrs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">免责声明:白天，我为Twitter工作，负责计算机和基础设施。</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/from-idea-to-deployed-on-gcp-in-24hrs-927eaf8a5939?source=collection_archive---------0-----------------------#2017-04-09">https://medium.com/google-cloud/from-idea-to-deployed-on-gcp-in-24hrs-927eaf8a5939?source=collection_archive---------0-----------------------#2017-04-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4af6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天外面看起来像这样，所以我决定呆在家里-</p><p id="9211" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">帆船。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/dc0ebf5112cdbca9fb9433d6b0a7931b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k0dTAUmDmZ2EEjwOkcINHQ.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">想法:每天或每周通过电子邮件给我发送一个特定的T2人的推文。</figcaption></figure><p id="f683" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">目的:不管我们喜欢与否，电子邮件会一直存在。我个人喜欢以这种方式，按照我的时间表来消化具体的内容，这是相当灵活的。此外，我想给<a class="ae ju" href="https://twitter.com/@redsoprano23" rel="noopener ugc nofollow" target="_blank"> @redsoprano23 </a>和<a class="ae ju" href="https://twitter.com/@ftdoctor" rel="noopener ugc nofollow" target="_blank"> @ftdoctor </a>一种更熟悉的方式来接触来自Twitter的内容。</p><p id="6a58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">没有耐心？这里的最终产品:<a class="ae ju" href="https://simplebirdmail.com" rel="noopener ugc nofollow" target="_blank">simplebirdmail.com</a>。</p><p id="f41b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在2017年7月9日，我决定关闭这个网站，因为它需要时间和金钱，而我现在没有时间去进一步维护它。</p><blockquote class="jv"><p id="03c3" class="jw jx hi bd jy jz ka kb kc kd ke jc dx translated">下面是我如何从一个想法到在这里&lt; 24hrs. It is not every button click but it is nearly every screen view, and every piece of code and configuration. This assumes a moderate level of comfort with all of the systems involved. The finished code is published to GitHub <a class="ae ju" href="https://github.com/drewrothstein/simplebirdmail" rel="noopener ugc nofollow" target="_blank">部署</a>以及内联Gists的一个相当彻底的走查。</p></blockquote><p id="4a93" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">名称选择</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="3a10" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">想出一个名字和域名。我不喜欢在购买域名之前开始一个项目(然后是让它成为现实的压力)。</h1><p id="ca50" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">[X]完成:简单的鸟邮件</p><p id="d9a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[X]注册域名:simplebirdmail.com</p><p id="af36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">粗糙的平台和架构</p><h1 id="1c03" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">决定平台和粗略的架构。我熟悉在几个平台上构建基础设施，并总是寻找一些新的和可能具有挑战性的东西。对于一个24小时的项目，在一个不太熟悉的平台上工作有点冒险，因为你不知道它的优势、局限性等等。</h1><p id="a2b0" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">谷歌计算平台的更新版<a class="ae ju" href="https://cloud.google.com/free/" rel="noopener ugc nofollow" target="_blank">免费层</a>看起来很酷，所以我会尝试一下。我可能会去一点自由层，但作为一个开始，它看起来很好。</p><p id="31cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[X]平台决定:谷歌计算(主要是应用引擎)</p><p id="4ffa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于粗略的架构，我发现把一个非常简单的、高层次的服务列表和流程看起来像什么是很有帮助的。</p><p id="7aa1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是非常粗略的，但这是最初的意图。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lz"><img src="../Images/2af0a460d8f0886fcb5c818a98e8efc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oMv1DkYXL_Qkiz86orleRw.png"/></div></div></figure><p id="eb8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[X]架构决定</p><p id="54f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">帐户设置</p><h1 id="bd95" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">对于这个项目，我需要设置以下公司开始帐户:</h1><p id="6ab0" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">谷歌云</p><ul class=""><li id="fb2f" class="ma mb hi ih b ii ij im in iq mc iu md iy me jc mf mg mh mi bi translated">MailChimp</li><li id="c39d" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">推特</li><li id="a857" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">所有这些都很容易设置，只有一些小问题。以下是其中的一些细节。</li></ul><p id="255c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">谷歌云账户</strong></p><p id="f73f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前往<a class="ae ju" href="https://cloud.google.com" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com</a>，用任何一个旧的谷歌邮箱账户登录。一旦注册，你可能会想在https://console.cloud.google.com/<a class="ae ju" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">的</a>将云平台加入书签，因为cloud.google.com<em class="jd">的</em>会将你带入他们的文档/定价/信息页面。</p><p id="65fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您愿意，可以创建新项目和新计费协议(针对各种API限额增加和服务使用)。在我的例子中，我有不同的项目和不同的账户，我想保持独立，所以我创建了一个新的计费协议。</p><p id="750e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj">计费&gt;预算和提醒</strong>下，您可能想要为<strong class="ih hj">预算金额</strong>设置一个提醒，以防您的项目意外开始花费超出您预期的资金。我选择100美元作为初始预算水平。</p><p id="afa3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj">应用引擎&gt;设置下，</strong>你可能想要设置一个<strong class="ih hj">每日支出限额</strong>，以防你的项目意外开始花费比你预期更多的钱。我也选择将其设置为100美元。</p><p id="219f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最初在你的App Engine仪表盘上，会显示限额是<a class="ae ju" href="https://twitter.com/mediocrity/status/845717462523920384" rel="noopener ugc nofollow" target="_blank"> $9，223，272.03吓得我裤子都掉了</a>。大约一小时后出现，这个问题消失了，它被设置为你的<em class="jd">每日消费限额</em>。</p><p id="8213" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您需要在控制台周围点击<strong class="ih hj">计算&gt;应用引擎</strong>选项卡，选择您的区域并设置您的第一个项目。您也可以等到第一次通过CLI部署时再这样做，因为它会提示您输入相同的信息。</p><p id="9b81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:有两种类型的应用引擎环境在这里详细描述<a class="ae ju" href="https://cloud.google.com/appengine/docs/the-appengine-environments#migrating_from_standard_to_the_flexible_environment" rel="noopener ugc nofollow" target="_blank"/>称为灵活和标准。灵活的环境运行在Docker容器中，启动实例需要几分钟时间，因此我将为前端选择标准环境，它不使用Docker容器，启动实例需要几毫秒时间。注意:稍后我将使用灵活的环境；这两者都在本演练中使用。</p><p id="07f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，我们将使用谷歌的KMS服务来加密和解密秘密，所以你也要启用它:<strong class="ih hj"> IAM &amp; Admin &gt;加密密钥</strong>。</p><p id="9f9e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> MailChimp账号</strong></p><p id="ca99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<a class="ae ju" href="https://mailchimp.com" rel="noopener ugc nofollow" target="_blank">https://mailchimp.com</a>开设账户非常简单。唯一奇怪的是法律规定，即使没有信用卡，你也要给他们你的地址。我们可能需要进一步挖掘模板中的这一点(或者对其稍加修饰，使其看起来真实，但实际并非如此)。</p><p id="84c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要在确认邮件后创建API密钥，请转到:<strong class="ih hj">附加服务&gt; API密钥&gt;创建密钥</strong>。</p><p id="6c7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保给钥匙贴上<strong class="ih hj">标签</strong>，以便日后识别。</p><p id="790b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦设置完毕，它看起来应该大致是这样的(复制API密匙以便以后安全存储)。</p><p id="b913" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">MailChimp &gt;附加&gt; API密钥&gt;创建密钥</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mo"><img src="../Images/aefc112640b440050ff17685189edacc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sLvlfZFU6UXGCwquhuIzjQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated"><strong class="ih hj">推特</strong></figcaption></figure><p id="d17d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">https://twitter.com的账户设置非常简单。在一个新的电子邮件地址下创建一个用户(并确认)后，我前往<a class="ae ju" href="https://apps.twitter.com" rel="noopener ugc nofollow" target="_blank">https://apps.twitter.com</a>创建一个API密匙。注册新应用程序需要名称、描述和URL。在<strong class="ih hj">密钥和访问令牌</strong>选项卡上，向下滚动到底部，然后<strong class="ih hj">创建我的访问令牌</strong>。</p><p id="1429" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">既然你在这个页面上，你也可以把<em class="jd">改为只读</em>，因为我们不会写任何东西。点击<strong class="ih hj">访问级别</strong>旁边的<strong class="ih hj">修改app权限</strong>链接，变为底部的<em class="jd">只读</em>和<strong class="ih hj">更新设置</strong>。注意:您可能会在初始创建时收到一条错误消息，但页面刷新会清除它；不确定为什么。</p><p id="6add" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成所有设置后，它看起来应该大致是这样的(复制消费者密钥+秘密，然后将访问令牌+秘密保存下来，以便以后安全地存储)。</p><p id="a5de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Twitter应用程序注册</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mp"><img src="../Images/7e5f421894e94dbdf4cc5ed041d8051b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_RNHnnk-48yd6iRXzC151A.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">配置开发环境</figcaption></figure><h1 id="358a" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">我将选择<strong class="ih hj"> Python </strong>，因为我已经选择了使用一个不熟悉的平台，所以我非常熟悉它以保持额外的复杂性最小化。</h1><p id="1072" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">跟随Google Cloud的指南<a class="ae ju" href="https://cloud.google.com/appengine/docs/standard/python/getting-started/python-standard-env" rel="noopener ugc nofollow" target="_blank">这里</a>和<a class="ae ju" href="https://cloud.google.com/appengine/docs/standard/python/tools/setting-up-eclipse" rel="noopener ugc nofollow" target="_blank">这里</a>开始。</p><p id="dc14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一个问题:这里涉及了*两个* SDKs，这最初让我很困惑。你既需要带有Python组件的<a class="ae ju" href="https://cloud.google.com/sdk/docs/" rel="noopener ugc nofollow" target="_blank"> Google Cloud SDK </a>，也需要用于Python的<a class="ae ju" href="https://cloud.google.com/appengine/docs/standard/python/download#appengine_sdk" rel="noopener ugc nofollow" target="_blank">App Engine SDK</a>。</p><p id="4212" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在OS X上，我选择在<em class="jd"> /usr/local/bin </em>中安装带有几个符号链接的Cloud SDK。后者你需要安装和启动，选择创建符号链接。</p><p id="1a2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ak"> PyDev (webapp框架)带Eclipse </strong></p><h2 id="7dc1" class="mq ks hi bd kt mr ms mt kx mu mv mw lb iq mx my lf iu mz na lj iy nb nc ln nd bi translated">如果您选择Eclipse途径，它将无法使用初始项目模板，因为文档中有一个小注释:</h2><p id="63fc" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">注意:PyDev starter项目已经过时，并且使用Python 2.5 webapp模块。</p><blockquote class="ne nf ng"><p id="c232" class="if ig jd ih b ii ij ik il im in io ip nh ir is it ni iv iw ix nj iz ja jb jc hb bi translated">要解决这个问题，您需要将您的<em class="jd"> app.yaml </em>中的<strong class="ih hj">运行时</strong>从python更改为<strong class="ih hj"> python27 </strong>。同时，您还应该添加python 2.7项目所需的<strong class="ih hj"> threadsafe: true </strong>。</p></blockquote><p id="594c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，<strong class="ih hj"> webapp </strong>示例可以工作，但是<a class="ae ju" href="https://webapp2.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> webapp2 </strong> </a>框架已经过时了，所以你可能想改用它(或者走下面的Flask路线，反正我们最终会这么做)。如果您选择<strong class="ih hj"> webapp2 </strong>路线，您将需要一个<em class="jd"> app.yaml </em>和<em class="jd"> main.py </em>来开始:</p><p id="9bf3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以在本地测试这一点，但是要在Eclipse中配置本地配置。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="b27b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">右键单击您的项目&gt;运行方式&gt;运行配置…</p><p id="2a20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">右键单击PyDev &gt;新建</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es nm"><img src="../Images/7052313d1428e295550ab31096b47e04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*vGHcb_pRnFphqcMZKTo3CQ.png"/></div></figure><p id="f0e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将其命名为<strong class="ih hj"> Run Local </strong>(或者其他什么)，将主模块设置为安装了<em class="jd"> dev_appserver.py </em>的位置(在我的例子中:<em class="jd">/usr/Local/Google _ app engine/dev _ appserver . py</em>)。在“参数”选项卡中，将程序参数设置为“${project_loc}”。</p><p id="9766" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这应该是这样的:</p><p id="8704" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">主选项卡</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es nn"><img src="../Images/42f6abfd149cade80233877960669797.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*gzQXqxoAbmbgm-uZDlY40g.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">参数选项卡</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es no"><img src="../Images/f00b58a60fd5102043c2a72c8f601551.png" data-original-src="https://miro.medium.com/v2/resize:fit:372/format:webp/1*0Ej-5pvrWURIeRu6RAByQg.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">选择右下角的Run，在控制台中你应该会看到启动消息，让你知道<a class="ae ju" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>已经设置好了，所以来看看吧！</figcaption></figure><p id="35b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">烧瓶不含Eclipse</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es np"><img src="../Images/17e09b298635986fd2e85984ebf46fb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/1*y_qC6qvVk1uTmXCLmuUA_g.png"/></div></figure><h2 id="c432" class="mq ks hi bd kt mr ms mt kx mu mv mw lb iq mx my lf iu mz na lj iy nb nc ln nd bi translated">如果你选择不使用Eclipse的Flask route，你会想要遵循这个<a class="ae ju" href="https://cloud.google.com/appengine/docs/standard/python/getting-started/python-standard-env" rel="noopener ugc nofollow" target="_blank">指南</a>或者你可以简单地在这里克隆repo <a class="ae ju" href="https://github.com/GoogleCloudPlatform/python-docs-samples" rel="noopener ugc nofollow" target="_blank">并且看一看<strong class="ih hj">灵活</strong>或者<strong class="ih hj">标准</strong>下的<em class="jd"> appengine </em>目录。请参阅上面链接到差异文档的注释。</a></h2><p id="5bbf" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">作为开始(并在本教程中继续)，我将选择<em class="jd">app engine/standard/flask/tutorial</em>项目，这是一个合理的起点。</p><p id="081e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我将在Google Cloud上创建一个独立的私有存储库(因为它目前是免费的测试版)。进入<strong class="ih hj">工具&gt;开发&gt;入门</strong>。当然要选一个有创意的名字。</p><p id="4f40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我喜欢将任何教程复制到我的新存储库的基础上来开始。</p><p id="47f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将空的repo克隆到本地源树的某个位置:</p><p id="8ae2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将教程项目复制到这个新存储库中:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="9f76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可能想将根文件夹从教程<strong class="ih hj">重命名为更具描述性的名称，我选择了<strong class="ih hj">前端</strong>。</strong></p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="5f27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">类似于我们如何配置Eclipse以便能够在本地运行，我们可以设置一个本地运行配置。</p><p id="697c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，将需求安装到文档中提到的<em class="jd"> lib </em>目录中:</p><p id="7732" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:正如文档中提到的，如果你使用<strong class="ih hj">自制</strong>版本的<strong class="ih hj"> python </strong>，你会遇到麻烦。我可能会建议不要那样做，转而使用<a class="ae ju" href="https://github.com/pyenv/pyenv" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> pyenv </strong> </a>，它工作得相当好。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><blockquote class="ne nf ng"><p id="1632" class="if ig jd ih b ii ij ik il im in io ip nh ir is it ni iv iw ix nj iz ja jb jc hb bi translated">通过使用<em class="jd"> dev_appserver.py </em>启动本地appserver，如果您安装了两个SDK，它应该在您的路径中，并让<em class="jd"> gcloud </em>工具附加您的shell的配置文件，或者如果您选择这样做，也可以手动执行。</p></blockquote><p id="0100" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该应用程序现在应该可以在本地<a class="ae ju" href="http://localhost:8080/form" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/form</a>获得。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="ae35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们进行任何更改之前，这是将初始教程代码提交到您的代码库中的好时机，所以让我们开始吧。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es nq"><img src="../Images/8f79f821fbe34f2fcf1f46da11e9198f.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/format:webp/1*Od2Fqd_OHxjMy_7kLZQvqw.png"/></div></figure><p id="2f84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们将这个应用程序部署到App Engine，这样除了我们的本地环境之外，我们也能掌握它的窍门。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es nr"><img src="../Images/092c161cad3dede2c9ef6b376d2097eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*Jzq9V6sMQpYusOrfMk-eyQ.png"/></div></figure><p id="3d0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将需要使用两个命令，如记录所示，<em class="jd"> gcloud app deploy </em>和<em class="jd"> gcloud app browse </em>。第一个部署您的应用程序，第二个在项目URL启动您的web浏览器。</p><p id="4340" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该能够在URL上浏览到<em class="jd"> /form </em>，并查看您在本地看到的相同表单。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ns"><img src="../Images/5c1939d37fd0f6a51aa7b5194440326e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*4gqAsZaETF3gcS_zChuA4Q.png"/></div></figure><p id="4166" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你已经到了这里，休息一下，享受一些soylent。几分钟后回来。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es nt"><img src="../Images/52dbc8561bdc4df1b37f46e478d5cf1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*qY36X5M2W9INSKRGmgavpg.png"/></div></figure><p id="ea4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好吃！</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es nu"><img src="../Images/995c863fc2cbfd80a5fe7ef91aed17d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sQyOBqV29xhapNZ4iM-SUA.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">概述</figcaption></figure></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="f0a7" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">我们已经在谷歌云、MailChimp和Twitter上创建了账户。我们有一个本地开发环境设置，并为Google App Engine部署了一个Flask教程。我们有一个代码库设置，并提交了教程代码。那么下一步是什么？我们有两条路径可以开始——前端或后端。先说前端。</h1><p id="d591" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">前端设计设置</p><h1 id="e890" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">我们需要将我们的教程表单转换成一个实际的前端，为用户提供我们想要的功能。在我想做的事情的情况下/目的中，我们需要捕捉一些信息——这个人想要接收关于他的电子邮件的Twitter用户和他们的电子邮件地址。就是这样(差不多)。</h1><p id="15f3" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">对于所有快速的项目，我喜欢把基本的用户界面元素放在一起，然后用花哨的加州样式表润色它(<a class="nv nw ge" href="https://medium.com/u/92ac42f12e5d?source=post_page-----927eaf8a5939--------------------------------" rel="noopener" target="_blank"> Jenn Schiffer </a>因其冗长而获得好评；这很神奇)。</p><p id="90c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是我们开始最低生活水平的小狗* (MVP)所需要的一切:</p><p id="06f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">绘图纸，画的不好(抱歉)。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es nx"><img src="../Images/232323c5db8b643f14829e881559ec00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GcmOXzP1-oaHUcp6-FJCqQ.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">*可能代表也可能不代表小狗。它可以是“产品”，但那就没那么有趣了。</figcaption></figure><p id="3536" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经有了90%的份额，我们甚至不需要做任何事情！</p><p id="2121" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">稍微修改一下form.html<em class="jd"/>，我们可以得到这个非常接近超级花哨的设计。</p><p id="904b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看我们在哪里:</p><p id="aa01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">form.html</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ny"><img src="../Images/1dee45ea88ed585c748bbf6035d70f1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:552/format:webp/1*IMRY0e6UEvtedjuBnrmuXA.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">从“所有的东西都在吗”的角度来看，答案非常接近“是”。</figcaption></figure><p id="e61e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，这可能是有争议的，但我可能会变得有点疯狂，如果这在这一点上看起来不那么好的话。这个<a class="ae ju" href="http://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank">引导</a>框架应该可以帮上忙；让我们在v4仍处于Alpha阶段时坚持使用可靠的v3。</p><p id="d16f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于这将在公共互联网上托管，并且目前没有很好的理由捆绑依赖关系(在我看来)，我们将指向MaxCDN的include(以及其他CDN)。</p><p id="ef71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了适应引导模板和特性，我们做了一些修改，看起来更简洁了:</p><p id="e531" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">form.html</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es nz"><img src="../Images/1745be8302695eb6079c7bace8fc40a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7vlLj8ve24zkSbd7zHV4zw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">前端设计目前是宜居的。现在添加功能。</figcaption></figure><p id="89ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前端功能设置</p><h1 id="4789" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">您可能已经注意到，设计的表单非常类似于MailChimp注册表单。虽然这很可能完全通过MailChimp表单来完成，而不需要单独的应用引擎托管前端，但这远没有那么有趣、好玩，也没有那么多的学习体验。此外，在MVP发布后，功能方面的限制将很快达到(想想:额外的选项、外部数据/用户存储、typeahead等)，如果在某个时候我们想转移到另一个平台，这是一个篮子里的许多鸡蛋(尽管锁定是完全不可避免的，如果你不这样想，这完全是一种幻觉)。</h1><p id="90c5" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">注意:因为上面没有提到，使用一个平台来处理电子邮件通常是一个好的实践。这很痛苦，有很多规则和情况是你不想花时间去面对的。</p><blockquote class="ne nf ng"><p id="d8cc" class="if ig jd ih b ii ij ik il im in io ip nh ir is it ni iv iw ix nj iz ja jb jc hb bi translated">我们将设计一个表单来捕获大部分数据，并注入将在网站上托管的数据，取代我们的大部分表格。</p></blockquote><p id="955e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先在MailChimp中创建一个<strong class="ih hj">列表</strong>。</p><p id="8c3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你会想要某种<em class="jd">联系方式@ </em>地址。最&lt;好的&gt;域名注册商(&lt;咳&gt; <a class="ae ju" href="https://www.gandi.net/" rel="noopener ugc nofollow" target="_blank">甘地</a>！&lt;/咳&gt;)让我们免费给你一些邮件代理，你可以设置一个联系地址。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es oa"><img src="../Images/1267b1d75c8dc14f8dd8a6f218cf6442.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*DA4xsId9WR1M1UAeXsICFw.png"/></div></figure><p id="9627" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用<a class="ae ju" href="https://twitter.com/@gandibar" rel="noopener ugc nofollow" target="_blank"> @gandibar </a>，他们太棒了。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ob"><img src="../Images/13a34fed5a059b205b12c914a11afc10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S5mbZwbaKW5Ob2emCkrkrQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">为了能够从特定地址发送邮件，您需要执行验证过程。</figcaption></figure><p id="d757" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在需要创建一个注册表单，它反映了我们创建的表单的大部分功能。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es oc"><img src="../Images/dba4115c3370aaff9c2ece22601e0055.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*_6WiWLPqn_xKrMZis0LiBQ.png"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es od"><img src="../Images/1f899bdc4928831c30947bfefcfc028f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*0Eme-gzw2Ojdlh3HEWqASA.png"/></div></figure><p id="a962" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们创建了一个包含电子邮件地址、频率和一个隐藏的Twitter句柄字段的表单。我们不想公开句柄输入，因为我们将向当前字段添加一个自动完成，并注入表单。</p><p id="c444" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回到嵌入表单页面，抓取HTML。我们需要对其进行一些分割，使表单符合我们的样式，保持Twitter句柄初始字段独立。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es oe"><img src="../Images/73265f3905052ae93223911800f46271.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g14NLZTWSAANCUPyRHV5Pg.png"/></div></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es of"><img src="../Images/4da86be24bee26ec77e632bf8abcebf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iYtgNuxO2k_D2Z3VZBtwpg.png"/></div></div></figure><p id="082f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">HTML、CSS和更新的表单:</p><p id="0114" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">form.html</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es og"><img src="../Images/3961896f9fd05c02f78baef50b7c346f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*MzDBHN_qo4ZlGkz1uCUu6A.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">这已经足够接近了，我们可以继续使用<a class="ae ju" href="https://twitter.github.io/typeahead.js/" rel="noopener ugc nofollow" target="_blank"> typeahead.js </a>来实现typeahead。看看这个库如何提前呈现Twitter句柄类型，他们在Heroku上设置了一个代理服务器来向Twitter发出请求。我们需要坚持这一点，这将通过增加这一要求来稍微扩展我们的架构。</figcaption></figure><p id="46c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最快和最轻的方法是使用<a class="ae ju" href="https://github.com/ruyadorno/twitter-proxy" rel="noopener ugc nofollow" target="_blank"> twitter代理</a>(它是Node，但是我们现在忽略它)。指着上面提到的一个是不行的，即使它看起来是完全开放的，没有任何限制(除了我必须假设/希望的上游限速)。</p><p id="050a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">分别是<em class="jd"> package.json </em>和<em class="jd"> server.js </em>:</p><p id="d3a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了在Google App Engine上运行这个应用程序，我们需要创建一个单独的Twitter应用程序(和相关的凭证)，一个单独的服务名来存放App Engine应用程序，并且需要组装一个<em class="jd"> app.yaml </em>配置。这两个步骤之前都有记录，继续假设完成的步骤。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="e037" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">分别是一个<em class="jd"> app.yaml </em>和<em class="jd"> credentials.json </em>:</p><p id="8286" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你现在可能意识到你需要一个<em class="jd">。gitignore </em>文件:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="5b16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成所有这些步骤后，我们现在可以进行本地测试，如果一切顺利，就可以进行部署了。本地运行<em class="jd"> npm启动</em>:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="0f8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">跳到一个浏览器窗口，输入:<a class="ae ju" href="http://localhost:5000/1.1/users/search.json?q=mediocrity" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/1.1/users/search . JSON？q =平庸</a></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es oh"><img src="../Images/6e0b41ef90b8d3d1dbd6bad34d288ae8.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*j9kQk3xmLr_0BFbtKJGtyA.png"/></div></figure><p id="6582" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这应该会在您的控制台中显示200:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es oi"><img src="../Images/6e4b5d420195444ba7f77d7360bc6200.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*PpSlE45RXoqZPmZOUcOrcQ.png"/></div></figure><p id="0305" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将下载一个JSON文件，其中包含许多用户的内容:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es oj"><img src="../Images/9a4f9b4e9b849e72ea8a4999090b15d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*FwGLdnFCkb_cYVSQaFVBBw.png"/></div></figure><p id="b99b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在这已经可以工作了，我们将用<em class="jd"> gcloud app deploy </em>将它上传到App Engine。第一次部署将需要几分钟，但上面的相同的URL，保存为基础，应该工作。在:<a class="ae ju" href="https://proxy-dot-simple-bird-mail-162703.appspot.com/" rel="noopener ugc nofollow" target="_blank">https://&lt;your _ app&gt;. app spot . com</a><a class="ae ju" href="http://localhost:5000/1.1/users/search.json?q=mediocrity" rel="noopener ugc nofollow" target="_blank">/1.1/users/search . JSON试试？q =平庸</a></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ok"><img src="../Images/f29c53bcd5f9b09f5c23d4a8e0b19517.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*1QLDW-AIie4jYsIqx9G9Ug.png"/></div></figure><p id="d9ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于安全等的一个简短说明...这是那种“照我说的做，不要照我做的做”的时刻。对于一个24小时的项目来说，这里有很多偷工减料的地方。其中一个角落是为另一个API发布一个可公开访问的代理。这一点也不酷。App Engine不*提供任何类型的控制来限制对您服务的访问。理想情况下，这应该以这样一种方式启动，它可以被限制到只有你的前端应用程序。为了时间和简单起见，我们将继续讨论这一点。如果时间允许，我们会重访。如果现在不解决这个问题，你就有被API<strong class="ih hj">限制</strong>速率的风险，以及<strong class="ih hj">意想不到的成本！</strong>等等。</p><blockquote class="ne nf ng"><p id="0fce" class="if ig jd ih b ii ij ik il im in io ip nh ir is it ni iv iw ix nj iz ja jb jc hb bi translated">前方接线</p></blockquote><h1 id="e40f" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">我们有一个API代理设置和添加到表单中的<em class="jd"> typeahead.js </em>。现在我们需要将它连接到表单上的第一个输入框。</h1><p id="265c" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">在我们这样做之前，关闭百叶窗，因为眩光。</p><p id="7b97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">日落时分。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/38f040c3917947e68b344bdff88d7c10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hjG5yfPZOuq97w8-NiCFpQ.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">我们可以从<em class="jd"> typeahead.js </em>网站的首页复制大部分代码，并根据需要进行修改。从JS文件(<em class="jd"> main.js </em>)开始，我们将保留大部分内容，但删除handlebars.js include并将其指向我们的主机:</figcaption></figure><p id="e318" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了删除<em class="jd"> handlebars.js </em>，我还删除了<em class="jd">预取</em>和<em class="jd">同步</em>功能，因为我们快速安装的代理在那里没有提供太多的价值。<em class="jd">查询</em>路径也有一点变化。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="a1f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在HTML方面，它也很像是复制/粘贴:</p><p id="988f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<em class="jd">form.html</em>更新步骤也有几个增加，包括<em class="jd"> jQuery </em>和交换使用<a class="ae ju" href="https://github.com/corejavascript/typeahead.js" rel="noopener ugc nofollow" target="_blank"><em class="jd">corejs-type ahead</em></a>库而不是<em class="jd"> typeahead.js </em>(前者被保留)。完整的HTML文件现在看起来像这样:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="5fca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">至于CSS前面(<em class="jd"> css/main.css </em>)有很多复制/粘贴，只需从第一个<em class="jd">开始复制整个文件即可。Typeahead </em>声明开始。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="b560" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回到我们正在运行的服务器，我们有一个带有Twitter搜索类型的自动完成表单，现在正在运行:</p><p id="5b43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们重新部署，以确保部署后一切仍能正常工作…</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ol"><img src="../Images/166b557445cb150445cffc5203eedeb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/format:webp/1*LgSFChiOV8uu-Q-hPxRUTA.png"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es om"><img src="../Images/211eec5022d59c0a76e86a9edcf78221.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*-wvZPUCS7HMHs1IKr4_JMw.png"/></div></figure><p id="dad2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">..戏剧性的停顿..</em></p><p id="8721" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确实如此，太棒了！</p><p id="b9f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前端功能的最后一步是将选定的(或键入的Twitter句柄)作为我们最初设置的隐藏合并字段发送到MailChimp。为此，我们将为MailChimp附加一个更新表单动作的处理程序。这里所描述的<a class="ae ju" href="http://kb.mailchimp.com/lists/signup-forms/determine-webpage-signup-location#Modify-Embed-Code" rel="noopener ugc nofollow" target="_blank">就是</a>。</p><p id="c39a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为此时我们已经安装了jQuery，所以只要Typeahead值发生变化，我们就会找到并修改元素。在我们的<em class="jd"> main.js </em>中，我们将添加以下内容:</p><p id="a7e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要将该字段添加到<em class="jd">动作</em>属性中:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="4325" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将在提交给MailChimp的表单上捕获输入句柄，这是一个必填字段。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="d702" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">测试</p><h1 id="d816" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">在构建后端之前，让我们重新部署并开始测试这是如何工作的…</h1><p id="5509" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated"><em class="jd">..戏剧性的停顿..</em></p><p id="f67d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有用！</p><p id="aed8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是您会立即注意到表单提交的用户体验非常糟糕，有一些绿色文本，句柄没有被清除，成功的确认不是非常清楚，等等。</p><p id="b047" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了解决这个问题，我们将为表单提交添加一个点击处理程序:</p><p id="05c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的HTML中的成功行:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="cba6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并将前面的行包装在一个div id <em class="jd"> presubmit </em>中:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="6e51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在它看起来很漂亮，看看吧！</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="8454" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">录像</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="on nl l"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">让我们检查一下MailChimp上的数据。浏览到<strong class="ih hj">列表&gt;订户</strong>(您需要接受至少一个邀请)。呃，推特账号不见了。看起来在表单中替换变量的好方法并不奏效。</figcaption></figure><p id="185f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们添加一个隐藏的输入字段并更新更改处理程序:</p><p id="9111" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在重新部署…</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="c3f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并重新注册…</p><p id="9b7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">..戏剧性的停顿..</em></p><p id="32b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">而且，还管用！</p><p id="033e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不太清楚为什么表单动作交换不起作用，但是查看Dev控制台中传递的参数，它只是一个空值。</p><p id="1a26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自定义域</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="7a82" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">由于前端的一切都在工作，我们应该开始让我们的域设置指向应用引擎站点的过程。为此，你必须在<strong class="ih hj">应用引擎&gt;设置&gt;自定义域名</strong>下添加站点。</h1><p id="cb2d" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">根据你的域名所在的位置，你可能需要登录并添加一个<em class="jd"> TXT </em>记录。Google工具将带您完成这一过程。这个过程可能需要几分钟到几个小时。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es oo"><img src="../Images/0192d08c01c8dbcfed3f53c8572ed5c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*NgsLDiocxr0HevQC_dsspg.png"/></div></figure><p id="bff6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">准备就绪后，您将能够继续添加映射。</p><p id="dec1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，在您的DNS提供商上更新您的区域文件。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es op"><img src="../Images/b5a5d0326c82c7b87e8596ed2cac58d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*28gKrnC_ExlFNdwy05FOYA.png"/></div></figure><p id="af65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦完成，您将需要等待长达24小时的DNS传播。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es oq"><img src="../Images/16eb9a1886a1cdbbd4787799fa63aea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ji1mxilDz9RZkr8kiy1aeg.png"/></div></div></figure><p id="3634" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SSL和HTTPS服务</p><h1 id="8f3c" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">在传播过程中，您可以开始设置SSL证书。考虑到功能、社区参与等因素，我通常喜欢使用Let's Encrypt。且不说是免费的(不过你真的应该<a class="ae ju" href="https://letsencrypt.org/donate/" rel="noopener ugc nofollow" target="_blank">捐</a>)！</h1><p id="9f80" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">我设置了一个SSL证书，此外，我想启用仅HTTPS，这样，如果用户试图访问HTTP，他们将被重定向。这实际上很简单，但是我们必须首先设置证书。</p><p id="0738" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">建立证书最简单的方法是使用<a class="ae ju" href="https://certbot.eff.org/" rel="noopener ugc nofollow" target="_blank"> certbot </a>(由EFF免费提供，你真的应该<a class="ae ju" href="https://supporters.eff.org/donate" rel="noopener ugc nofollow" target="_blank">捐赠</a>)！</p><p id="557b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在您的本地计算机上，发出如下命令(显然是填充您的域{s}):</p><p id="fb8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要设置这个文件的服务以进行验证。最简单的方法是修改我们的<em class="jd"> app.yaml </em>来添加一个处理程序。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="14ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像这样添加处理程序:</p><p id="a749" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并使用您的控制台中的内容编写一个<em class="jd"> acme01.txt </em>和<em class="jd"> acme02.txt </em>文件。部署之后，您应该能够在该URL上看到该文件的内容。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="52ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在示例中，我们有<strong class="ih hj">两个</strong>域，所以我们也需要对第二个文件这样做。第一次单击Enter后，您会注意到一个新的路径和需要编写的内容。添加一个额外的处理程序、文本文件，然后重新部署。完成后，您应该可以单击Enter继续。</p><p id="fdd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你做得正确，你应该看到<em class="jd">证书机器人</em>在本地生成<strong class="ih hj">密钥</strong>和<strong class="ih hj"> csr </strong>:</p><p id="30a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要运行一个命令，然后将文件上传到应用引擎。我们需要获取<strong class="ih hj">密钥</strong>并转换成<strong class="ih hj"> RSA格式</strong>。此外，让我们将整个链复制到我们当前的目录中。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es or"><img src="../Images/ba5bea6810c0161db1571a59a5f6c2ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*moK2gKp4FlH5k7GcmS-dyg.png"/></div></figure><p id="ed42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在将在<strong class="ih hj">设置&gt; SSL证书&gt;添加新的SSL证书</strong>对话框中上传(然后删除本地副本)这两个文件。给证书起一个名字，在第一个框中选择(或粘贴)<em class="jd"> fullchain.pem </em>，在第二个框中选择<em class="jd">私钥</em> (RSA格式)。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="49c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成后，选中您的域名旁边的复选框以启用证书，然后选择保存。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es os"><img src="../Images/d4810c81d51d11ff01ff36db7cd55e6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*1hYDCZjiBcMGC_zil2VGdQ.png"/></div></figure><p id="d216" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果一切按计划进行，你现在可以在HTTPS看到你的网站。</p><p id="0c85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">区域顶点</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ot"><img src="../Images/3ce88c347b96b680a62d58d81e062042.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*DdfU_SOccMsPkk6iTQjICg.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">万维网</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ou"><img src="../Images/15f7a4e9bba208440f3f03982afa9808.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*qgIxd0u_b8sKigtoPqPVtA.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">现在，我们已经启用了HTTPS，让我们关闭非HTTPS和重定向用户，因为一个安全的网站是一个快乐的网站。这对于App Engine来说非常简单，只需将<strong class="ih hj"> secure: always </strong>添加到<em class="jd"> app.yaml </em>中的静态和根处理程序中:</figcaption></figure><p id="4400" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这(正如这里的<a class="ae ju" href="https://cloud.google.com/appengine/docs/standard/php/config/appref#handlers_secure" rel="noopener ugc nofollow" target="_blank">所记载的</a>)为你处理重定向。部署后，您应该注意到，如果您浏览到非HTTPS，您会看到302'd到HTTPS:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="439d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开发控制台</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ov"><img src="../Images/761db8a9e28b5bdad1024f0876b2ad55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C5diShSWJXN2aPF2SVONdA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">概述</figcaption></figure></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="742f" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">此时，我们有一个运行在App Engine上的工作前端和代理服务。我们是HTTPS启用和重定向用户。是时候放下前端，开始后端工作了。在我们的例子中，后端将是App Engine (doc <a class="ae ju" href="https://cloud.google.com/solutions/reliable-task-scheduling-compute-engine" rel="noopener ugc nofollow" target="_blank">这里是</a>)上的一个调度作业(例如Cron)。</h1><p id="c726" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">就在我们开始工作之前，我们可能应该更新我们最初的粗略架构图。我们最终没有实现KMS，但我们计划在后端使用它来存储/获取我们的Twitter和MailChimp API密钥。与键相关，重要的是添加一个backlog项，以便从将Twitter的代理API凭证存储在非签入的JSON文件中切换到更好的东西(除了限制API之外)。我们还不得不托管一个开放的Twitter API代理。以下是更新后的图表:</p><p id="c57d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此时的当前待办事项列表:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lz"><img src="../Images/4fe0fab60799036f7feed538f3e803c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x5qKkiDV_0eMXs1PfXaHvA.png"/></div></div></figure><p id="86ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[代理]保护API代理</p><ul class=""><li id="a34e" class="ma mb hi ih b ii ij im in iq mc iu md iy me jc mf mg mh mi bi translated">[代理]将API代理中的凭据移动到KMS</li><li id="ca41" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">[前端]更多用户界面清理/工作</li><li id="c0fa" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">[前端]缩小/清理CSS/JS以限制请求大小</li><li id="d3f0" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">[前端]图标路线+文件</li><li id="a208" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">添加日志记录/监控/指标</li><li id="5768" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">后端</li></ul><h1 id="de48" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">首先，让我们克隆示例项目(这里是<a class="ae ju" href="https://github.com/GoogleCloudPlatform/reliable-task-scheduling-compute-engine-sample" rel="noopener ugc nofollow" target="_blank"/>，并查看一下<em class="jd"> gae </em>目录。这是一个<em class="jd"> webapp2 </em>项目，具有调用URL的cron配置。我们已经有了几个移动的部分，所以我们可能想坚持使用Flask，但是我们当然可以修改这个项目。</h1><p id="5e92" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">让我们将<em class="jd"> gae </em>目录复制到repo中的一个新目录中，用于这些调度的作业。</p><p id="951f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在还没有使用PubSub特性，所以删除它。我们应该给<em class="jd"> app.yaml </em>添加一个服务名。目前的功能非常简单，所以这应该很容易转换成一个烧瓶项目。我们将在事件处理程序中添加<strong class="ih hj">登录:管理</strong>设置(此处记录<a class="ae ju" href="https://cloud.google.com/appengine/docs/standard/python/config/appref#handlers_login" rel="noopener ugc nofollow" target="_blank">为</a>)。</p><p id="c746" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:对于应用引擎设置了适当的<code class="du ow ox oy oz b">X-Appengine</code>特殊头的内部请求，也满足<code class="du ow ox oy oz b">admin</code>登录限制。</p><blockquote class="ne nf ng"><p id="93fa" class="if ig jd ih b ii ij ik il im in io ip nh ir is it ni iv iw ix nj iz ja jb jc hb bi translated">注意:由于某些原因，您的第一个项目*必须*使用<strong class="ih hj">默认</strong>作为GAE上的服务名。我讨厌这样，但是当你创建一个新项目并试图使用服务的非默认命名时，就会出错。因此，如果你正在遵循这个教程，你的前端将永远被称为<strong class="ih hj">默认</strong>，此时你对此无能为力。</p><p id="e635" class="if ig jd ih b ii ij ik il im in io ip nh ir is it ni iv iw ix nj iz ja jb jc hb bi translated">稍后，我们将再次讨论这方面的细节(特别是标题)。</p></blockquote><p id="6273" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置几个测试端点并转换成Flask应用程序非常快</p><p id="b848" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于cron.yaml的一个注意事项是，如果您不想让它使用<strong class="ih hj">默认</strong>应用程序，您还必须指定一个<strong class="ih hj">目标</strong>参数，如这里讨论的<a class="ae ju" href="https://cloud.google.com/appengine/docs/flexible/nodejs/scheduling-jobs-with-cron-yaml#about" rel="noopener ugc nofollow" target="_blank"/>，就像在我们的例子中一样，并且对于在GAE上有多个应用程序的其他人来说可能是通用的。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><blockquote class="ne nf ng"><p id="abb5" class="if ig jd ih b ii ij ik il im in io ip nh ir is it ni iv iw ix nj iz ja jb jc hb bi translated">更新后的cron.yaml现在是:</p></blockquote><p id="cb47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以将配置和端点添加到我们称为前端的应用程序中，但是因为在这种情况下，两者之间没有共享代码，所以这实际上没有意义，也没有必要。我还想提供一个更实际的例子，因为使用GAE的组织可能有数百个应用程序，并且需要指定目标。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="73bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们首先确保我们可以使用<em class="jd">dev _ appserver . py app . YAML</em>进行本地测试。</p><p id="cbcd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">启动后，你需要勾选这个框以管理员身份登录(记得我们在<em class="jd"> app.yaml </em>中设置了<strong class="ih hj"> login: admin </strong>)。之后，我们应该会看到我们简单的标题行。</p><p id="38a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太好了！在我们深入之前，我们需要一个带有伪代码的高层次图表来理解我们在这里需要做什么。我们将构建的内容如下所示:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es pa"><img src="../Images/2a41f13ed724c054e6049349b2ded733.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ooQd1putpd6Pw-BRGLjpcA.png"/></div></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es pb"><img src="../Images/6165634de02e8edbdc20823a2e7af1f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*jQta4ktej1znsqfc8c9_8Q.png"/></div></figure><p id="349a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">后端的粗略流程</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es pc"><img src="../Images/f152a5ce27a088e5647089e45f7855c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5J4dR8OML36eWKWv9hJ0hg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">右下角是TBD，可能非常复杂，但我们可以获得所有的数据获取和解析设置。</figcaption></figure><p id="3b0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一个接口:MailChimp API。http://developer.mailchimp.com/<a class="ae ju" href="http://developer.mailchimp.com/" rel="noopener ugc nofollow" target="_blank">的文档整理得非常好，这使得浏览和找到你需要的东西变得非常棒。</a></p><p id="db2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从插入API键并从谷歌KMS获取开始，并对MailChimp进行单个API调用。KMS的文档位于<a class="ae ju" href="https://cloud.google.com/kms/docs/" rel="noopener ugc nofollow" target="_blank">这里</a>，但是我将从头到尾介绍一下。</p><p id="a336" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将<a class="ae ju" href="https://cloud.google.com/kms/docs/creating-keys" rel="noopener ugc nofollow" target="_blank">创建</a>一个密钥环(加密密钥分组)，一个加密密钥，并设置一个服务帐户来解密我们的应用程序。尽管建议职责分离(见这里的<a class="ae ju" href="https://cloud.google.com/kms/docs/separation-of-duties" rel="noopener ugc nofollow" target="_blank"/>)，但我是一个人，在这种情况下保护自己没有多大意义。</p><p id="c6e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和服务帐户:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="4606" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要授予此服务帐户加密/解密的权限，我们需要执行以下操作:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="1979" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的例子中，位置被设置为<strong class="ih hj">全局</strong>。我们可以进一步限制它，但对于我们有趣的应用程序来说，现在没有必要这么做。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><blockquote class="ne nf ng"><p id="2429" class="if ig jd ih b ii ij ik il im in io ip nh ir is it ni iv iw ix nj iz ja jb jc hb bi translated">有了服务帐户设置和适当的访问权限，我们需要创建一个服务帐户密钥，以便我们可以在Google云平台之外使用它(进行加密)。</p></blockquote><p id="26eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们使用我们创建的服务帐户将MailChimp API密钥添加到KMS。在python-docs-samples<a class="ae ju" href="https://github.com/GoogleCloudPlatform/python-docs-samples" rel="noopener ugc nofollow" target="_blank">repo</a>(之前克隆的)中，有一个小的KMS客户端可以用于此目的:<a class="ae ju" href="https://cloud.google.com/kms/docs/quickstart#a_simple_file_encrypter" rel="noopener ugc nofollow" target="_blank"> doc </a>。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="944b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在前面提到的文档中创建一个小的shell脚本，如下所示:</p><p id="8732" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将环境变量<em class="jd">GOOGLE _ APPLICATION _ CREDENTIALS</em>设置为您之前创建的<em class="jd"> key.json </em>文件的路径:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="692a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并运行它(使用您的MailChimp API键echo'd)！</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="5eb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它应该能呼应你所呼应的调。现在我们可以将这个秘密(<em class="jd"> /tmp/test_file.encrypted </em>)包含在我们的项目中，存储在Google云存储(GCS)中，或者对它做任何我们想做的事情。让我们将文件存储在GCS中。</p><p id="3b5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将从<em class="jd"> gcloud </em>切换到<em class="jd"> gsutil </em>命令行工具，用于与GCS进行交互，如果您之前安装了SDK，那么您应该已经安装了GCS。</p><p id="6851" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:似乎每个公共云最初都有单独命令行工具的问题。尽管AWS更糟糕，每个API调用一个(夸张)，但它仍然不断发生。</p><blockquote class="ne nf ng"><p id="0130" class="if ig jd ih b ii ij ik il im in io ip nh ir is it ni iv iw ix nj iz ja jb jc hb bi translated">创建一个存储桶，复制文件，并将其移动到所需位置，如下所示:</p></blockquote><p id="70b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本例中，我显示了路径<em class="jd">static/mailchimp _ API . encrypted</em>，但它可以是您让小脚本编写文件的任何位置(如果使用示例，则为<em class="jd"> /tmp/test_file.encrypted </em>)。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="a335" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于从GCS中读取，我们有几个选项，但是<em class="jd"> google-cloud </em> python库看起来非常好(这里是<a class="ae ju" href="https://googlecloudplatform.github.io/google-cloud-python/" rel="noopener ugc nofollow" target="_blank"/>)。我们将读取上传的文件，这个文件非常小，我们希望它以字符串的形式返回。这个库有一个<em class="jd"> download_as_string() </em>函数，太神奇了。blobs文档位于<a class="ae ju" href="https://googlecloudplatform.github.io/google-cloud-python/stable/storage-blobs.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="8ea5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是我们需要做的事情:</p><p id="950d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在顶部添加来自google.cloud导入存储的<em class="jd">和<strong class="ih hj">桶</strong>和<strong class="ih hj">文件名</strong>，我们应该可以开始了。</em></p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="f086" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还需要更新我们的<em class="jd">需求:</em></p><p id="05c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">部署和wahhhhla！您可以通过访问您的<em class="jd"> /test </em>端点来查看加密的内容，确认您可以成功地以字符串形式从GCS访问您的对象。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="b229" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GAE上调度作业的另一个问题是<strong class="ih hj">您必须在部署时指定cron.yaml文件</strong>。如果您不这样做，作业将不会得到安排。只需将它添加到您的“gcloud app deploy”的末尾，因此它将是“gcloud app deploy cron.yaml ”,如这里的<a class="ae ju" href="https://cloud.google.com/appengine/docs/flexible/nodejs/scheduling-jobs-with-cron-yaml#uploading_cron_jobs" rel="noopener ugc nofollow" target="_blank">所示</a>。</p><blockquote class="ne nf ng"><p id="1785" class="if ig jd ih b ii ij ik il im in io ip nh ir is it ni iv iw ix nj iz ja jb jc hb bi translated">让我们将这个字符串解密，这样就可以用它来调用MailChimp API。我们将添加<em class="jd"> google-api-python-client </em>需求来访问发现包(<a class="ae ju" href="http://google.github.io/google-api-python-client/" rel="noopener ugc nofollow" target="_blank"> doc </a>)。此外，我们将添加mailchimp3导入，它为他们的API提供了一个<a class="ae ju" href="https://github.com/charlesthk/python-mailchimp" rel="noopener ugc nofollow" target="_blank">漂亮的</a>包装。</p></blockquote><p id="6db9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要授予App Engine服务帐户访问我们密钥的权限，如下所示:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="7637" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新我们的<em class="jd"> main.py </em>以解密并进行初始API调用:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="29fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您的浏览器现在应该显示一个字符串(来自返回的JSON):</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="b30f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是开始返回所有订阅者的推文。这将是对每个句柄的API代理的请求。我们还应该解析并返回Tweet ID字符串，因为这可能是我们所需要的。这是来自<em class="jd">/status/user _ timeline . JSON</em>端点(doc <a class="ae ju" href="https://dev.twitter.com/rest/reference/get/statuses/user_timeline" rel="noopener ugc nofollow" target="_blank">此处</a>)。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="714a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，向我们的<em class="jd"> requirements.txt </em>添加请求:</p><p id="2911" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和<em class="jd"> main.py </em>:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="35e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在已经增加了几项。有几个调用API代理的新函数，有一些迭代、解析，并且添加了<em class="jd"> jsonify </em>以便在我们仍在开发时更容易查看响应。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="3677" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您在浏览器中重新部署并转到您的cron服务的<em class="jd"> /run </em>，您将得到如下内容:</p><p id="85ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">反应</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es pd"><img src="../Images/e96d9fa9c9baee4db136152aa2aa1aee.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/format:webp/1*OpXxqwz3cUxFghMPN_bqoQ.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">这是过去50个(见<em class="jd"> main.py </em>中的常量)Tweet IDs，由<em class="jd"> screen_name </em>为每个用户设置的每个句柄；几乎所有我们现在需要的东西都可以在MailChimp中开始组装电子邮件模板。</figcaption></figure><p id="e28b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">电子邮件模板</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="3a3a" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">邮件很棘手。具体来说，电子邮件客户端和模板是棘手的。有很多公司是围绕着让电子邮件看起来更好，并用各种增值服务来诱惑他们而建立的。对于MVP的发布，我唯一关注的客户端是Google Mail Web UI，它采用了相当宽的格式(&gt; 800px)。如果我能让它合理地工作，我会称之为足够好。</h1><p id="316d" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">不幸的是，MailChimp没有简单的社交合并标签来包含任何随机的推文(他们确实提供了一些标签，但不是为了这个目的)。这种功能的缺乏(通过标签/URL在电子邮件中嵌入推文的能力)将几乎占据教程的剩余部分。</p><p id="157e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用MailChimp集成来发送这些邮件的唯一方式是使用Mandrill API ( <a class="ae ju" href="https://mandrillapp.com/api/docs/" rel="noopener ugc nofollow" target="_blank"> docs </a>)。当然，此时您可以放弃MailChimp并设置自己的表单；使用SendGrid、Mailgun等等。这不是很理想，因为对于我的用例来说，分析跟踪或保持事情简单(显然是有争议的)，而且通常我没有使用过MailChimp或Mandrill APIs，而我使用过SendGrid和Amazon SES，并希望学习一些新的东西。</p><p id="d484" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要将Mandrill的免费试用添加到你的MailChimp账户，请点击这里的<a class="ae ju" href="http://kb.mailchimp.com/mandrill/add-or-remove-mandrill" rel="noopener ugc nofollow" target="_blank">按钮。转向剖面图&gt;账户&gt;事务处理&gt;添加顶杆&gt;开始试验。通过免费试用，你会收到2000封电子邮件，这足以让你了解它，并决定你是想继续使用它(并付费)还是转向更便宜的解决方案。</a></p><p id="e993" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你启用了试用版，你需要通过点击启动心轴来设置你的域名。通过输入并选择+添加来添加您的域:</p><p id="1bab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置域</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es pe"><img src="../Images/d63a912261430388976882db2b40a6d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gf75bxyNYaeDpjpO2ItPdA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">从“验证的域”下的“查看详细信息”开始，输入电子邮件地址并接收验证:</figcaption></figure><p id="4c77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">验证域</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es pf"><img src="../Images/178ea07011a004a394cfee5dd72bb973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*CycdzeT-envlllCo3mYJBw.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">单击电子邮件中的链接后，您应该会看到它现在已经过验证:</figcaption></figure><p id="430d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">验证域</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es pg"><img src="../Images/882330e080990094a21060508c682375.png" data-original-src="https://miro.medium.com/v2/resize:fit:380/format:webp/1*BanWm7LeCiMJfkPBRDHM4w.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">接下来，您需要设置DKIM，以便Mandrill被授权为您发送邮件。打开对话框，将此<strong class="ih hj"> TXT </strong>记录复制到您的DNS提供商的设置中:</figcaption></figure><p id="24ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">DKIM记录</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ph"><img src="../Images/c5c743f91a1315a91e0d36a69b888862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LDg7x7EQOuO4UM5q7jeDAw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">此外，您还需要按照显示DKIM/SPF设置说明下的说明添加/修改a/您的<strong class="ih hj"> SPF </strong>记录。</figcaption></figure><p id="8345" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果两者都被添加并在一段时间后传播(低阶分钟数&gt;小时数，通常取决于TTLs ),您应该能够查找两个记录:</p><p id="6b61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确认</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es pi"><img src="../Images/50f186373f3070f47d3c3358a8b05d2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*vn3dbSoyGsS5us4Hf3tYjA.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">要在Mandrill中使用模板，您可能需要选择手柄模板(文档<a class="ae ju" href="https://mandrill.zendesk.com/hc/en-us/articles/205582537" rel="noopener ugc nofollow" target="_blank">此处为</a>)。它相当标准，将提供最简单和最灵活的模板结构。</figcaption></figure><p id="9874" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Mandrill中的“发送默认值”下，我们将只设置HTML，<strong class="ih hj">不设置</strong>内联CSS(这对以后成功使用GMail WebUI至关重要)，并添加取消订阅页脚。我们可以在以后改变这一切，但这将是一个良好的开端:</p><p id="cc75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">发送默认值</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es pj"><img src="../Images/1a39d0bac2a657ba0b9c59f33f28004d.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*HqVT2Nt8RzN5mVqSRgifew.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">在SMTP &amp; API信息下，为Mandrill创建一个API密钥:</figcaption></figure><p id="402c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加API密钥</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es pk"><img src="../Images/6a54c1a9fd76b6d62212f261ad1db44e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-9C25uXnN6huO_GjUWXJw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">在左边的出站菜单栏下，转到Templates来创建我们的模板。给它一个名字，从地址，主题，等等。一切都可以在以后改变。</figcaption></figure><p id="8fbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最大的问题是，我们在模板中放什么？我们不能使用常见的Twitter嵌入选项，如在<a class="ae ju" href="https://publish.twitter.com" rel="noopener ugc nofollow" target="_blank">https://publish.twitter.com</a>上描述的，因为它们需要加载<em class="jd"> widgets.js </em>，并且电子邮件+ Javascript不能很好地结合在一起。我们不能使用标准的Tweet嵌入代码(Tweet &gt; Embed Tweet ),因为它也依赖于Javascript。我们也不能使用oEmbed API ( <a class="ae ju" href="https://dev.twitter.com/web/embedded-tweets" rel="noopener ugc nofollow" target="_blank">链接</a>)，因为它也需要Javascript。</p><p id="302f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了遵循品牌指南(<a class="ae ju" href="https://brand.twitter.com/" rel="noopener ugc nofollow" target="_blank">这里是</a>)，如果我们不能使用上述所有选项，我们可能应该只查看Twitter已经发送的一封电子邮件的来源。如果你看看其中一封邮件的来源，它可能看起来有点令人生畏，但事实并非如此:</p><p id="c757" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">电子邮件来源</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es pl"><img src="../Images/ca2083eaf4408a804dcc74a467c90afc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gtl03Pr-siLljyEodemGOQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">如果去掉古老的编码，去掉顶部的明文版本，并稍微重新格式化HTML和CSS，它实际上是非常有用的。我们需要做的是拿出一个模板和格式，以便我们可以在Mandrill中使用它。</figcaption></figure><p id="39aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不会对完成这一过程的过程感到厌烦，部分是因为它并不有趣，部分是因为我不知道除了用不可理解的方式录制重组文本的加速版本之外，我还能做什么。花了一个多小时，非常无聊。步骤大致如下:删除编码，清理并适当地分隔HTML，添加新行以查看实际发生的情况，并尽可能简化样式。完整的模板发布在GitHub <a class="ae ju" href="https://github.com/drewrothstein/simplebirdmail/tree/master/templates" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="cf63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将构建的电子邮件模板有三个部分:</p><p id="52b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用户(Twitter用户)</p><ol class=""><li id="382a" class="ma mb hi ih b ii ij im in iq mc iu md iy me jc pm mg mh mi bi translated">推文内容(推文)</li><li id="a438" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc pm mg mh mi bi translated">操作(回复、转发、收藏)</li><li id="174d" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc pm mg mh mi bi translated">无论是谁创建了这封邮件，都非常友好，有一些评论标签已经帮助描述了这些作品。</li></ol><p id="46ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">需要在<em class="jd"> main.py </em>中的<em class="jd"> parse_tweets </em>函数中解析几个新字段。我们需要以下内容来开始:</p><p id="21c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">个人资料图片(<em class="jd">user . profile _ image _ URL _ https</em>)</p><ul class=""><li id="bf96" class="ma mb hi ih b ii ij im in iq mc iu md iy me jc mf mg mh mi bi translated">转发计数(<em class="jd">转发计数</em>)</li><li id="f649" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">收藏夹计数(<em class="jd"> favorites_count </em>)不要与<em class="jd">User . favorites</em>计数混淆，后者是用户喜欢的计数。由于某种原因，这没有记录在状态/用户时间表(<a class="ae ju" href="https://dev.twitter.com/rest/reference/get/statuses/user_timeline" rel="noopener ugc nofollow" target="_blank">文档</a>)中。</li><li id="7e60" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">已验证(<em class="jd">用户.已验证</em>)</li><li id="3edc" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">姓名(<em class="jd">用户名</em></li><li id="651e" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">我们当前的结构是一个句柄数组的字典。我们将需要更多的结构而不是数组，并将每个Tweet ID与上述数据一起存储在另一个字典中。</li></ul><p id="1891" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">函数<em class="jd"> parse_tweets </em>现在会变成这样:</p><p id="7436" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这给了我们一个类似这样的数据结构:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="4a4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据结构</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es pn"><img src="../Images/9340ca328a7f7a9aa9844b7340a837fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*M-yV9gKoA6PWFoCkMdZe2w.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">现在我们已经有了我们需要的数据，我们需要使用Handlebars templating来根据前面提到的电子邮件模板过程(doc <a class="ae ju" href="https://mandrill.zendesk.com/hc/en-us/articles/205582537-Using-Handlebars-for-Dynamic-Content" rel="noopener ugc nofollow" target="_blank">在这里</a>)组装一个模板。</figcaption></figure><p id="65e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们刚刚创建了一个非常好的新数据结构，但是我们需要对它进行一些修改，以便能够调用Mandrill API。我们将使用<em class="jd"> merge_vars </em>，它们是我们可以设置的每个接收者的值(doc <a class="ae ju" href="https://mandrill.zendesk.com/hc/en-us/articles/205582487-How-to-Use-Merge-Tags-to-Add-Dynamic-Content#provide-merge-data-through-the-api" rel="noopener ugc nofollow" target="_blank">这里是</a>)。对于每个<strong class="ih hj"> rcpt </strong>(收件人电子邮件地址)，我们将传递一个<strong class="ih hj"> vars </strong>数组，其中包含我们要传递给模板的每个变量的<strong class="ih hj">名称</strong>和<strong class="ih hj">内容</strong>。</p><p id="0a2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看起来<strong class="ih hj">内容</strong>至少支持嵌套字典，所以有那个。在我们的电子邮件模板中，您可以想象一个大致如下的结构:</p><p id="0995" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">车把模板结构(粗糙)。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es po"><img src="../Images/a5ca01aa82156d266197e9c0261afddb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YDou_-W9_MEeINzU2F7uvA.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">为了证明我们对模板的粗略想法，我们将从一个粗略的模板开始，它只是显示我们可以设置和传递适当的值。作为第二阶段，我们将根据实际收到的电子邮件来考虑样式(之前讨论过)。</figcaption></figure><p id="f86f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了测试一个模板，我们应该设置一个小的测试脚本，我们可以高兴地使用它，直到我们准备好将它添加到我们在GAE的<strong class="ih hj"> cron </strong>任务中。为了保持额外的简单，这将只是一个小脚本，我们可以在本地执行，而不必在GAE上重新运行/部署。这将允许我们在测试模板和数据上快速迭代，一旦我们准备好，我们将作为<em class="jd"> merge_vars </em>传递。</p><p id="204e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">快速迭代对于一个24小时的项目来说是绝对关键的。如果你能找到一种快速迭代的方法，而不是等待基础设施恶作剧，那就去做吧！:)</p><blockquote class="ne nf ng"><p id="fbe3" class="if ig jd ih b ii ij ik il im in io ip nh ir is it ni iv iw ix nj iz ja jb jc hb bi translated">我整理的测试模板看起来像这样:</p></blockquote><p id="deca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像这样在Mandrill中发布它:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="0606" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">芯棒测试模板</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es pp"><img src="../Images/16aa630992f6051896e7d82b28390cd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qGiD5wdnp_RBmWfsak94qw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">要将此模板发送给测试用户(您)，您可以使用如下的小测试脚本:</figcaption></figure><p id="c436" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您需要在本地安装Python的<em class="jd"> mandrill </em>包(当然您也可以使用<a class="ae ju" href="https://virtualenv.pypa.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> <em class="jd"> virtualenv </em> </a>):</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="8fa4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并在小测试脚本的顶部填入几个变量。你可以用一个<em class="jd"> python mailme.py </em>来运行它，它会给你发一封类似这样的邮件:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="23b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">邮件截图</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es pq"><img src="../Images/e5f36ccb724703d26e819e5f45a04436.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/1*xuOqxTA6O37UNnoCqDs9uw.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">注意关于模板和脚本的一些事情。我们有一些变量作为<em class="jd"> global_merge_vars </em>和一些作为<em class="jd"> merge_vars </em>和空字符串被用作假的。</figcaption></figure><p id="cef4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经(大致)知道了我们将使用的数据结构，所以我们将移动我们的<em class="jd"> parse_tweets </em>函数来返回这种格式的数据。在我们做出这一改变的同时，我们也将放弃任何7天前创建的推文，因为我们将有一个每日和每周频率的邮件，没有必要存储这些邮件。我们以后再处理这个问题。</p><p id="1a6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将在这个阶段对<em class="jd"> python-dateutil </em>添加一个需求，因为它将为我们提供神奇的<strong class="ih hj">解析器</strong>日期函数。</p><p id="dcd5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在需要注意的是，当您添加依赖项时，您必须更新您的<strong class="ih hj"> requirements.txt </strong>。否则，在应用程序启动时，您会看到类似这样的内容(例如，如果您忘记添加python-dateutil):</p><blockquote class="ne nf ng"><p id="8171" class="if ig jd ih b ii ij ik il im in io ip nh ir is it ni iv iw ix nj iz ja jb jc hb bi translated">排除故障</p></blockquote><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><h1 id="5c98" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">我们将稍微绕道调试GAE应用程序，因为在这一点上，我们的应用程序已经增长到几百行，您可能会开始偶尔遇到(像我一样)偶尔发生的<strong class="ih hj">内部错误。</strong>部署后。</h1><p id="c5ff" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">GAE有一些非常容易使用的调试工具。最重要的是Stackdriver请求和日志查看器。从<strong class="ih hj">应用引擎&gt;服务</strong>中选择<strong class="ih hj">诊断&gt;工具&gt;日志</strong>下的服务:</p><p id="1644" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过日志进行诊断</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es pr"><img src="../Images/e562b724d2d945d683d9955fb502dd20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xhk8t48F6IVA7MOYbdgymQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">日志用图标很好地显示了信息(蓝色)、任何(无色)和错误(橙色)。您可以展开每一项，并使用“显示更多”或“显示全部”按钮来查看记录的更多内容:</figcaption></figure><p id="89ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">日志视图</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ps"><img src="../Images/6823aade4cbf16c18a0b0ad2e2e91b87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u9G7ew0XV8NQ6S1QlxlR_g.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">你打印的任何东西都可以在这些日志中看到，这很有帮助。在您的应用程序出现问题之前添加一个<em class="jd"> print() </em>语句会有助于查看发生了什么以及发生在哪里。发出日志可见请求后，通常需要大约5秒钟。</figcaption></figure><p id="0bde" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了通过控制台查看日志之外，<strong class="ih hj">您还可以在命令行</strong>上查看日志，这在很多情况下是更好的选择，而且非常棒！这是通过<em class="jd"> gcloud beta logging </em>命令完成的。这里有可用的文档<a class="ae ju" href="https://cloud.google.com/logging/docs/reference/tools/gcloud-logging#reading_log_entries" rel="noopener ugc nofollow" target="_blank">这里有</a>但是这里有一个例子，因为命令的制表符补全和帮助文本在它出现的时候有点不完整:</p><p id="37a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要计算出您的<em class="jd">日志名</em>，首先运行list命令:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="4e21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与这些命令混淆的部分(至少对我来说)是，一些命令以“logs”组为前缀，而一些命令没有(比如“read”)。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="9d9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要快速读取您想要调试的故障日志，您可以使用从他们的网站或brew ( <em class="jd"> brew install jq </em>)获得的<a class="ae ju" href="https://stedolan.github.io/jq/" rel="noopener ugc nofollow" target="_blank"> jq </a>实用程序。</p><p id="04be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加几个参数，您可以只查看500和日志行:</p><p id="61dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了日志潜水，你还可以在<strong class="ih hj">工具&gt;调试</strong>菜单下找到一个实时调试器。对于我们的应用程序来说，由于各种原因，这在这个阶段是行不通的，但是在将来可以实现。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="5152" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，还有一个Stackdriver错误报告控制台，它更加全面和深入。我没有发现它像提取日志一样有用，但我可以想象如果您有一个大型应用程序，它可能会有所帮助:</p><p id="a242" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">堆栈驱动程序错误报告</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es pt"><img src="../Images/44ea6ae8ada3c1711a1fbb1485cd35c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hUbVhatanoM0uJIWlPT5aw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">从这个视图中，您可以一目了然地看到GAE上的每个(或所有)应用程序、状态代码、错误分组，甚至可以打开通知、将特定警报静音或链接到某个问题。</figcaption></figure><p id="2137" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦进入特定的警报，您就可以在一个更直观的页面中获得几乎所有的日志详细信息:</p><p id="f1cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">堆栈驱动程序错误报告</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es pu"><img src="../Images/2c19ff852fbbe06d47ece236efe8f60a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OX80EeSjs1FqFipdbX83Qw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">您设置的任何计划作业(cron)在<strong class="ih hj">应用引擎&gt;任务队列&gt; Cron作业</strong>下也有一个特殊视图。您可以从高层次了解您的所有工作:</figcaption></figure><p id="64e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">克朗·乔布斯</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es pv"><img src="../Images/e8883b57018b848321f8820dc4efe582.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ccq-ejR0gBdBVTR4tLSTog.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">您还可以通过<strong class="ih hj">日志&gt;视图</strong>一键访问日志:</figcaption></figure><p id="4024" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">日志视图</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es pw"><img src="../Images/1be0313250e7b26aa5239dbbb088ac21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H76OPuHbVvuPph5D2s-cTg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">电子邮件模板</figcaption></figure><h1 id="4f8f" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">稍微离题后，回到电子邮件模板和数据格式。</h1><p id="a8ad" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">更有趣的一点是，鉴于Twitter允许在<strong class="ih hj">名称</strong>和<strong class="ih hj">文本</strong>中使用表情符号/ unicode字符(而不是在它出现的句柄或URL中)，您必须了解编码。我们必须意识到这一点，尤其是在字符串操作期间。我特意选择了一个名字中带有特殊字符的用户来证明这是可行的。</p><p id="b51b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是我们最终为Mandrill API准备的数据:</p><p id="065b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们添加了一个新的<em class="jd"> format_data_for_mail </em>函数，同时对<em class="jd"> parse_tweets </em>函数进行了一些修改。我们正在创建Mandrill API所需的两个结构，输出看起来与预期的一样:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="26bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">电子邮件模板格式化输出</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es px"><img src="../Images/b6862b73627dfbb3501233f1cf2b7ea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KeBIApxU3Y6RupIda_zUtA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">有了好的、合理的数据格式，我们就可以开始添加一些必要的项目来实现这个功能。第一个是将个人资料图像URL替换为我们将在邮件中使用的URL。我们将使用<em class="jd">替换</em>字符串方法切换到<em class="jd">_合理_小</em>变量，而不是使用<em class="jd">_正常</em>变量。</figcaption></figure><p id="1ea3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代替这张图片:</p><p id="c3a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ju" href="https://pbs.twimg.com/profile_images/3756620250/89414fa14149981c265064e6c1084348_normal.png" rel="noopener ugc nofollow" target="_blank">https://PBS . twimg . com/profile _ images/3756620250/89414 fa 14149981 c 265064 E6 c 1084348 _ normal . png</a></p><p id="50bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用这张图片:</p><p id="50ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ju" href="https://pbs.twimg.com/profile_images/3756620250/89414fa14149981c265064e6c1084348_reasonably_small.png" rel="noopener ugc nofollow" target="_blank">https://PBS . twimg . com/profile _ images/3756620250/89414 fa 14149981 c 265064 e6c 1084348 _ limited _ small . png</a></p><p id="dbf2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将通过以下方式完成:</p><p id="7abb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们有点厌倦了看到<em class="jd"> favicon.ico </em>文件的404状态代码，所以我们将通过在我们的<em class="jd"> app.yaml </em>中添加一个处理程序和一个占位符图像来修复它:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="7f3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在cron目录的根目录下放置一个<em class="jd"> favicon.ico </em>并重新部署。它可以只是一个单色方块，因为它不会被任何人看到(如果你愿意，你可以使用类似<a class="ae ju" href="http://www.favicon.cc/" rel="noopener ugc nofollow" target="_blank">http://www.favicon.cc/</a>的东西)。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="ad66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们希望能够显示包含在邮件中的推文中的图像(以及后来的视频等)。回顾前面提到的<em class="jd">状态/user_timeline </em>文档(<a class="ae ju" href="https://dev.twitter.com/rest/reference/get/statuses/user_timeline" rel="noopener ugc nofollow" target="_blank">这里是</a>)你会注意到，我们没有在Tweet对象中预期的任何<a class="ae ju" href="https://dev.twitter.com/overview/api/entities-in-twitter-objects" rel="noopener ugc nofollow" target="_blank">实体</a>，比如<em class="jd"> media_url </em>。</p><p id="3baa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然前面提到的关于<em class="jd">状态/user_timeline </em> <strong class="ih hj">的文档没有提到<em class="jd"> include_entities </em>参数，但是如果你传递<em class="jd"> include_entities=true </em>你看起来确实得到了实体</strong>！</p><p id="18b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这意味着您将获得一个媒体对象，然后您可以使用它来扩展并包含在您最终的电子邮件中:</p><p id="2034" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将从<em class="jd"> media_url_https </em>开始并使用它。这是在<strong class="ih hj">实体&gt;媒体&gt; media_url_https </strong>下。我们还应该小心解析，因为显然只有一些Tweets会有这个对象。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="bb7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将向<em class="jd"> parse_tweets </em>函数添加以下内容:</p><p id="7b4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，在Mandrill中更新我们的模板，让它看起来更接近我们想要看到的邮件。如前所述，我不打算做创建它的演练，因为它非常无聊，而且是一堆试错:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="9fe6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将它复制/粘贴到一个Mandrill模板中，并更新您一直用来测试的小<em class="jd"> mailme.py </em>脚本，如下所示:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="d027" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该能够生成一封非常好看的电子邮件，如下所示:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="2a7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">电子邮件模板测试</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es py"><img src="../Images/5f27da9b0a73e04ed732edd1992d44ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yqoP3eEtU5l7w0xWcNamWg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">哇，这看起来不错！有很多粗糙的边缘，但在大多数情况下，我们已经填充了所有的数据，我们有正确的文本和超链接，以及正确的转发和收藏计数。这看起来也很好地遵循了展示指南，比我见过的许多网站都要好。</figcaption></figure><p id="dc4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，还剩下什么？让我们看看我们以前的积压:</p><p id="041e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[代理]保护API代理</p><ul class=""><li id="26a3" class="ma mb hi ih b ii ij im in iq mc iu md iy me jc mf mg mh mi bi translated">[代理]将API代理中的凭据移动到KMS</li><li id="1af4" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">[前端]更多用户界面清理/工作</li><li id="b598" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">[前端]缩小/清理CSS/JS以限制请求大小</li><li id="ea21" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">[前端]图标路线+文件</li><li id="c5e6" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">添加日志记录/监控/指标</li><li id="b258" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">让我们将其简化为以下启动标准:</li></ul><p id="7749" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[proxy]保护API代理:我们可以保护用于邮件发送者的后端代理，但是对于typeahead我们基本上没有什么可做的，因为它必须公开暴露。我们可以添加一些推荐人检查和端点过滤，但这两者都需要派生npm模块，并创建比我们希望在这一层承担的更多的工作。很重要的一点是，我们要事先设定预算和每日限额，这样如果它受到冲击，我们就不会被收费，它就会停止接受请求。也许我们会在发布前进一步降低这些。</p><ul class=""><li id="e28a" class="ma mb hi ih b ii ij im in iq mc iu md iy me jc mf mg mh mi bi translated">[proxy]将API代理中的凭证移动到KMS:没有公开暴露的内容，并且凭证与邮件程序使用的凭证是分开的(为了速率限制和一般的良好分离实践)。有一个JS库，所以稍后实现它不会花费太多时间。在某些时候这样做仍然是好的，但是在这个时候会被忽略。</li><li id="5127" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">我们将暂时放弃其余的前端任务，因为这些任务非常容易在以后重新访问。我们已经解决了favicon的烦恼！</li><li id="0299" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">我们有一个合理的伐木开始。此时，我们将放弃监控和度量，并遵从内置。</li><li id="ac9a" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">这是一个24小时的项目，我们不能承担太多！</li></ul><p id="8164" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Cron调度和频率</p><h1 id="c37c" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">现在我们有了一些可用的模板和数据来填充它，我们需要调度cron来匹配所需的频率，并更新我们的应用程序来支持频率路径。注册后，我们将允许<strong class="ih hj">日报</strong>和<strong class="ih hj">周刊</strong>。我们需要为此进行调度，并让我们的应用程序了解正在运行的是哪一个。</h1><p id="9664" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">我们将首先更新我们的<em class="jd"> cron.yaml </em>，然后通过我们的小应用程序线程化它:</p><p id="7d95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将更新我们的各种函数，以了解<em class="jd">频率</em>。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="38f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前言:我已经以一种非常快速的方式把这个通过了。这既不干净也不是最佳选择。如果你正在寻找美丽的代码，请认真地看看其他地方。</p><blockquote class="ne nf ng"><p id="8fed" class="if ig jd ih b ii ij ik il im in io ip nh ir is it ni iv iw ix nj iz ja jb jc hb bi translated">请注意，我们现在有两个端点来告诉我们哪个是哪个邮件程序，还有几个频率变量和参数正在传递。</p></blockquote><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="b42c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">新的端点应该只正确地呈现来自该频率的Tweets，并且只呈现选择了特定频率的订户。</p><p id="bd7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">心轴连接</p><h1 id="1d2b" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">在我们称之为“完成”之前，最后一项工作是从我们在<em class="jd"> mailme.py </em>脚本中的启动代码开始连接Mandrill，并将其构建到我们的预定作业(<em class="jd"> main.py </em>)中。</h1><p id="7d3a" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">首先，我们将添加我们的Mandrill API的关键和文件到KMS，按照原来的步骤备份在后端部分。创建新的<em class="jd">密钥</em> (mandrill)并将加密文件上传到GCS。我们还将授予IAM角色相同的权限(授予对SA的加密/解密访问权限)。这样，我们将从KMS更新我们的凭证获取函数，使其更加通用，如下所示:</p><p id="1493" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并更新调用函数以传入两个参数。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="ad86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的邮件功能将相当简单，因为我们已经按照要求对数据进行了切片。它看起来会像这样:</p><p id="ac78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">老实说，差不多就是这样。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="nk nl l"/></div></figure><p id="5d20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果有人想要所有样本文件的完整回购，可以在GitHub <a class="ae ju" href="https://github.com/drewrothstein/simplebirdmail" rel="noopener ugc nofollow" target="_blank">这里</a>找到。注意，实际运行时需要做一些小的改动。这些位置很容易更新。</p><p id="a17d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最终建筑</p><h1 id="6317" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">我们最终得到了一张类似这样的照片:</h1><p id="5ba8" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">架构图</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lz"><img src="../Images/e1e4e738935107e76913f64fe42fb10f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iwHcIuIJj3aC246PsO9hew.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">限制</figcaption></figure><h1 id="37b8" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">考虑到组装的速度，当前设计的规模有一些非常严重的限制。幸运的是，所用服务的大多数价格/等级将首先受到影响:</h1><p id="daac" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">mandrill:2000封电子邮件(免费试用)</p><ul class=""><li id="6134" class="ma mb hi ih b ii ij im in iq mc iu md iy me jc mf mg mh mi bi translated">MailChimp: 2，000名订户(永远免费)</li><li id="f476" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">Twitter: 1500个请求/15分钟(不确定提出请求的流程)</li><li id="c7a1" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">谷歌云平台:我在GAE设定了100美元/天的限额(在GCP设定了100美元/月的预算)</li><li id="e0e3" class="ma mb hi ih b ii mj im mk iq ml iu mm iy mn jc mf mg mh mi bi translated">从架构上来说，扩展这个有几个问题；主要是计划作业的设置。它同步执行所有操作，因此在获取和传递各种API请求时不会伸缩。这些都需要拆分和线程化；可能是某种持续的轮询和缓存更新，以存储来自各种API的数据，这样就不需要实时调用它们。重写它可能是最有意义的，因为在这一点上它也是相当混乱的。</li></ul><p id="3194" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不担心任何这在这个时候，因为我可以很快关闭整个事情(这是一个按钮在GAE，禁用应用程序，已经过测试)。</p><p id="a9f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总结</p><h1 id="807e" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">这很酷，在大约24小时内，我在谷歌云平台上学到了很多东西:谷歌应用引擎、Stackdriver、谷歌KMS、<em class="jd"> gcloud </em>和<em class="jd"> gsutil </em>以及各种SDK。此外，我们还连接了MailChimp、Twitter和Mandrill APIs。这不是什么革命性的东西，但它是一个有趣的项目，可以构建、尝试和记录。</h1><p id="a8c3" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated">反馈</p><h1 id="da17" class="kr ks hi bd kt ku lu kw kx ky lv la lb lc lw le lf lg lx li lj lk ly lm ln lo bi translated">如果有人能做到这一步，我真的会感到惊讶，但如果你做到了，我希望这是有趣的，鼓舞人心的，和/或在某些方面有帮助的。随时在Twitter(<a class="ae ju" href="https://twitter.com/mediocrity" rel="noopener ugc nofollow" target="_blank">@平庸</a>)联系我，让我知道你的想法。</h1><p id="8f79" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi">I would genuinely be surprised if anyone made it this far but if you have I hope this was interesting, inspiring, and/or helpful in some way. Feel free to reach out to me on Twitter (<a class="ae ju" href="https://twitter.com/mediocrity" rel="noopener ugc nofollow" target="_blank">@mediocrity</a>) and let me know what you think.</p></div></div>    
</body>
</html>