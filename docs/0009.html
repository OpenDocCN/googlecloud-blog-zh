<html>
<head>
<title>Deploying Dart onto Google Compute Engine with continuous integration and deployment using Codeship.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Codeship将Dart部署到Google计算引擎上，并进行持续集成和部署。</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/deploying-dart-onto-google-compute-engine-with-continuous-integration-and-deployment-using-codeship-90cc45d6652e?source=collection_archive---------0-----------------------#2015-06-04">https://medium.com/google-cloud/deploying-dart-onto-google-compute-engine-with-continuous-integration-and-deployment-using-codeship-90cc45d6652e?source=collection_archive---------0-----------------------#2015-06-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="60d7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">哇，多么拗口的标题。试着说10次。</p><p id="330c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您会注意到，将Dart部署到Google云上的方法并不多见。App Engine不支持托管虚拟机，虽然在技术上支持Dart，但它尚未退出测试，所以我不信任它。</p><p id="aed9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">将Dart部署到您的服务器的一种方法是安装Dart、FTP stuff并运行dart bin/server.dart。</p><p id="a396" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我个人讨厌这种方法，我喜欢在部署之前让一切自动化和测试。</p><p id="6fde" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我希望每天向主分支提交100次，对每一次提交运行100次单元测试，如果都通过了，那么我希望代码自动部署到生产中。</p><p id="263c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们如何实现Dart部署的涅槃？让我们假设您已经准备好了Dart服务器应用程序，并且已经准备好了某种单元测试(即使您没有也没关系！，只需跳过本教程的持续集成部分)</p><p id="7d96" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个教程很长，如果你迷路了，请留下一些反馈，告诉我哪里可以做得更好！</p><p id="fdbe" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">第一步是让某种CI(持续集成)系统运行起来。这将在您推送到github或bitbucket存储库时运行您的测试。</p><p id="7f0d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我最近用过的最好的CI工具之一是Codeship。</p><figure class="jl jm jn jo fd jp jq jr ih js jt paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es jk"><img src="../Images/a54b81ebd4d8ac80724bfb0ee59276b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*sodwATXn9cERe9fwLCDt4w.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">Codeship.com</figcaption></figure><h1 id="87a2" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated"><strong class="ak">在代码船上设置Dart</strong></h1><p id="16e2" class="pw-post-body-paragraph im in hi io b ip lc ir is it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj hb bi translated">注册Codeship时，请连接您的Github或Bitbucket帐户。当需要配置项目时，选择Dart作为技术。</p><p id="04d2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请注意，当前的Codeship SDK已经过时，因此您必须在配置期间安装最新版本的Dart。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es lh"><img src="../Images/1dd8dd9ba7a568882d2b889ddbb7e098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9m-zNF73Vmu48c2Bpw53Yw.png"/></div></div></figure><pre class="jl jm jn jo fd li lj lk ll aw lm bi"><span id="b411" class="ln kf hi lj b fi lo lp l lq lr">wget <a class="ae ls" href="https://storage.googleapis.com/dart-archive/channels/stable/release/latest/sdk/dartsdk-linux-x64-release.zip" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/dart-archive/channels/stable/release/latest/sdk/dartsdk-linux-x64-release.zip</a><br/>unzip -o dartsdk-linux-x64-release.zip -d ~<br/>pub get</span></pre><p id="d577" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这只是告诉Codeship下载最新的sdk，解压并运行pub get on它。</p><p id="58f4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，如果您有单元测试，您可以告诉Codeship在测试配置管道部分运行它们。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es lt"><img src="../Images/ab001f794aed2ee4e936842fce73e2e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ocrKvaZM13ceL32RH_-rRg.png"/></div></div></figure><p id="43a2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我这里只有dart test/all.dart来运行我的dart单元测试。</p><p id="ed9c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">点击“保存”,转到“仪表板”,按照入门步骤推进您的项目。忽略它可能向您询问的任何部署选项，我们稍后将再次讨论。</p><p id="6398" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对你的主分支进行git推送，让codeship发挥它的魔力。如果一切顺利，你会看到这个。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es lu"><img src="../Images/278c0bdaf224f87b6fe811fd11fa25c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u4OqsnD7ujFJLz1B5VVnJQ.png"/></div></div></figure><p id="791e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果失败了，看看是什么测试失败了，并修复它。这是生产前的第一道(如果不是最后一道)防线，所以一定要通过！</p><h2 id="8127" class="ln kf hi bd kg lv lw lx kk ly lz ma ko ix mb mc ks jb md me kw jf mf mg la mh bi translated"><strong class="ak">太好了，CI现在设置好了！</strong></h2><p id="361f" class="pw-post-body-paragraph im in hi io b ip lc ir is it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj hb bi translated">很好，现在CI已经设置好了，可以开始工作了。你写代码，你推动，你测试运行，如果一切顺利，Codeship给你绿灯，你是清白的。</p><p id="5302" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在怎么办？我如何将它部署到谷歌计算引擎(GCE)</p><h1 id="57a0" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated"><strong class="ak">为飞镖设置GCE</strong></h1><p id="97fc" class="pw-post-body-paragraph im in hi io b ip lc ir is it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj hb bi translated">我将假设您没有GCE服务器设置。让我们带你走一遍。</p><p id="c791" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">转到console.developers.com，为您的Dart应用程序创建一个新项目。单击左上角的蓝色新建项目按钮。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es mi"><img src="../Images/2e7ffb7dd8fa4bbb879652a4323aabd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d2A-0DhE4fbcgJF532q9UQ.png"/></div></div></figure><p id="1971" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在左侧边栏中，单击虚拟机实例。</p><p id="0075" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">并单击新建实例。</p><p id="02e3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">按照下面的屏幕截图设置您的新实例。出于测试目的，我们将使用ubuntu 14.04LTS的微实例。</p><p id="10f5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在还不要点击创建！跟着截图走</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es mj"><img src="../Images/7e7fbbdc3f59e43c96ce6b49b57604e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UAjesF9d0kjLyD3zXjq_6A.png"/></div></div></figure><p id="e4ef" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在点击创建之前，请点击管理磁盘、网络、访问和安全选项蓝色链接。</p><p id="c2f9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后点击访问和安全，并在这里添加您的公共ssh密钥。</p><p id="f23a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要在mac上获得ssh密钥，请尝试以下命令。它通常应该显示您的公钥</p><pre class="jl jm jn jo fd li lj lk ll aw lm bi"><span id="0887" class="ln kf hi lj b fi lo lp l lq lr">cat ~/.ssh/id_rsa.pub</span></pre><p id="92de" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">一旦你有了它，把它放在框里，用户名框会自动填充。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es mk"><img src="../Images/1cb9cbf04a0b53142937cf1c5174ccb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z7Otg8mv__zw1q1Ck13Tqg.png"/></div></div></figure><p id="83ba" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这之后，你就可以走了。显示您登录ssh的用户名。点击创建，看它去！</p><p id="a6f6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">一两分钟后，你会看到你的仪表板与你的真棒新GCE服务器运行。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es ml"><img src="../Images/ce479a2b275632effe89738b936850e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yt3hWgpMaPjogL5WpkinSQ.png"/></div></div></figure><h1 id="e246" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated"><strong class="ak">在GCE机器上设置Docker</strong></h1><p id="7b27" class="pw-post-body-paragraph im in hi io b ip lc ir is it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj hb bi translated">Docker是一种在虚拟化安全容器中运行应用程序的简单方法。用软件污染主机系统的日子已经一去不复返了，现在您只需要一个包含您的应用程序及其所有依赖项的Docker实例。</p><p id="1639" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在GCE机器上安装Docker非常简单。</p><p id="0af5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">SSH到您的机器中，</p><pre class="jl jm jn jo fd li lj lk ll aw lm bi"><span id="63f3" class="ln kf hi lj b fi lo lp l lq lr">ssh (username)@ip</span></pre><p id="8754" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">并遵循以下步骤</p><h2 id="26ea" class="ln kf hi bd kg lv lw lx kk ly lz ma ko ix mb mc ks jb md me kw jf mf mg la mh bi translated">在Ubuntu上安装Docker</h2><p id="7d7c" class="pw-post-body-paragraph im in hi io b ip lc ir is it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj hb bi translated">确保您已经安装了Ubuntu版本的必备软件。然后，使用来自https://docs.docker.com/installation/ubuntulinux/<a class="ae ls" href="https://docs.docker.com/installation/ubuntulinux/" rel="noopener ugc nofollow" target="_blank">的以下步骤安装Docker</a></p><p id="e090" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">验证您已经安装了wget。</p><pre class="jl jm jn jo fd li lj lk ll aw lm bi"><span id="b04e" class="ln kf hi lj b fi lo lp l lq lr">$ which wget</span></pre><p id="8d9e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果没有安装wget，请在更新管理器后安装它:</p><pre class="jl jm jn jo fd li lj lk ll aw lm bi"><span id="3662" class="ln kf hi lj b fi lo lp l lq lr">$ sudo apt-get update $ sudo apt-get install wget</span></pre><p id="1042" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">获取最新的Docker包。</p><pre class="jl jm jn jo fd li lj lk ll aw lm bi"><span id="7daa" class="ln kf hi lj b fi lo lp l lq lr">$ wget -qO- <a class="ae ls" href="https://get.docker.com/" rel="noopener ugc nofollow" target="_blank">https://get.docker.com/</a> | sh</span></pre><p id="dbfe" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">系统会提示您输入sudo密码。然后，它下载并安装Docker及其依赖项。</p><p id="d86b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">验证docker安装正确。</p><pre class="jl jm jn jo fd li lj lk ll aw lm bi"><span id="4847" class="ln kf hi lj b fi lo lp l lq lr">$ sudo docker run hello-world</span></pre><p id="45bb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">该命令下载一个测试映像，并在容器中运行它。</p><p id="af61" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">完美。如果你跟着做，并且所有这些都有效，你做得很好！</p><h2 id="9766" class="ln kf hi bd kg lv lw lx kk ly lz ma ko ix mb mc ks jb md me kw jf mf mg la mh bi translated"><strong class="ak">准备GCE接受代码船部署</strong></h2><p id="1099" class="pw-post-body-paragraph im in hi io b ip lc ir is it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj hb bi translated">现在，在我们离开ssh之前，请转到您的主目录(~/)并创建一个名为dart的文件夹。(mkdir飞镖)</p><p id="00fd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在一个新的标签中，回到Codeship，进入项目设置，点击常规。</p><p id="3b3d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从这里获取Codeship的公共ssh密钥。这将让Codeship轻松部署到您的服务器上。</p><p id="771d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后回到您的终端，在中打开allowed_hosts。ssh并粘贴来自codeship的密钥</p><pre class="jl jm jn jo fd li lj lk ll aw lm bi"><span id="b4b4" class="ln kf hi lj b fi lo lp l lq lr">vim ~/.ssh/allowed_hosts</span></pre><p id="a0fc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">嘣！</p><p id="40e0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">概括地说，您已经设置了Docker并允许Codeship访问您的GCE。这将使它能够进行连续部署，这是我们接下来要设置的。</p><h1 id="44e8" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">设置Dart应用程序以支持Docker</h1><p id="b0e0" class="pw-post-body-paragraph im in hi io b ip lc ir is it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj hb bi translated">为了让Docker了解你的申请，你需要建立一个Docker文件。Dockerfile是一个简单的脚本，它告诉Docker要安装什么，如何运行您的应用程序，以及要暴露哪些端口。在项目目录的根目录下创建一个docker文件。</p><p id="432a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们的Dart特定docker文件如下所示。</p><pre class="jl jm jn jo fd li lj lk ll aw lm bi"><span id="c56a" class="ln kf hi lj b fi lo lp l lq lr">FROM google/dart</span><span id="0970" class="ln kf hi lj b fi mm lp l lq lr">WORKDIR /app</span><span id="fc85" class="ln kf hi lj b fi mm lp l lq lr">ADD pubspec.* /app/</span><span id="e337" class="ln kf hi lj b fi mm lp l lq lr">RUN pub get</span><span id="1c82" class="ln kf hi lj b fi mm lp l lq lr">ADD . /app</span><span id="916f" class="ln kf hi lj b fi mm lp l lq lr">RUN pub get — offline</span><span id="8f2f" class="ln kf hi lj b fi mm lp l lq lr">CMD []</span><span id="c369" class="ln kf hi lj b fi mm lp l lq lr">EXPOSE 3030</span><span id="a4df" class="ln kf hi lj b fi mm lp l lq lr">ENTRYPOINT [“/usr/bin/dart”, “bin/server.dart”]</span></pre><p id="5e92" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">来自google/dart </strong>告诉Docker我们想使用google/dart docker的基本映像。更多细节可以在这里找到【https://registry.hub.docker.com/u/google/dart/ T2】</p><p id="3359" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> WORKDIR /app </strong>正在Docker容器中创建一个名为app的目录。</p><p id="7313" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">添加pubspec。* /app/ </strong>正在将pubspec文件添加到app文件夹中。</p><p id="edba" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">跑酒馆get </strong>就是跑酒馆get。</p><p id="a304" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">添加。/app </strong>正在将您的其余文件添加到app目录中</p><p id="5613" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们跑了两次酒馆，找出为什么<a class="ae ls" href="https://registry.hub.docker.com/u/google/dart/" rel="noopener ugc nofollow" target="_blank">https://registry.hub.docker.com/u/google/dart/</a></p><p id="b76d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来我们<strong class="io hj">暴露端口3030 </strong>。如果您的应用程序使用不同的端口，那么在这里更改它。</p><p id="4ab2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最后，我们告诉Docker如何通过<strong class="io hj">入口点</strong>运行我们的应用。通过以文件作为参数执行dart命令。</p><p id="577e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">犯这个推那个。由于我们没有对代码做任何修改，你的单元测试应该会通过，Codeship应该会给你一个绿灯。</p><p id="c0d2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，是时候部署它了！</p><h1 id="78ec" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">使用Codeship持续部署到GCE</h1><p id="1d2b" class="pw-post-body-paragraph im in hi io b ip lc ir is it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj hb bi translated">在Codeship中，转到项目设置和部署。</p><p id="98d0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">单击自定义脚本作为您的部署管道</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es mn"><img src="../Images/092a1a459279324dc6edd43c95a95543.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-6vgWWajVRkXIPGWWNz_NQ.png"/></div></div></figure><p id="0518" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这里，您将看到一个用于输入部署脚本的框。这个脚本很简单，只包含几个命令。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es mo"><img src="../Images/8bda9f2fa49e57c22e824a525e70f60c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e8s3g6HMM2C-KqqxhuOPVw.png"/></div></div></figure><p id="5470" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，<strong class="io hj"> rsync -av </strong>将Codeship在每次推送时创建的克隆目录中的所有文件复制到我们之前在您的主机GCE系统上创建的dart文件夹中。</p><p id="ff96" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，我们通过ssh运行一些命令。这些命令基本上是我们将cd运行到dart目录中，构建docker映像，停止所有以前运行的docker实例，并在映像内绑定到端口3030的端口3030上运行docker应用程序。</p><pre class="jl jm jn jo fd li lj lk ll aw lm bi"><span id="33d7" class="ln kf hi lj b fi lo lp l lq lr">rsync -av ~/clone/ username@ip:dart</span><span id="a47c" class="ln kf hi lj b fi mm lp l lq lr">ssh username@ip ‘cd dart &amp;&amp; docker build -t app . &amp;&amp; docker stop $(docker ps -a -q) &amp;&amp; docker run -d -p 3030:3030 app’</span></pre><p id="e444" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">命令摘要</p><pre class="jl jm jn jo fd li lj lk ll aw lm bi"><span id="914d" class="ln kf hi lj b fi lo lp l lq lr">cd dart <br/>#change into the dart folder that has all the source code</span><span id="896b" class="ln kf hi lj b fi mm lp l lq lr">docker build -t app .  <br/>#build the current folder into an image called app</span><span id="4678" class="ln kf hi lj b fi mm lp l lq lr">docker stop $(docker ps -a -q) <br/>#stop all currently running docker instances</span><span id="3d3a" class="ln kf hi lj b fi mm lp l lq lr">docker run -d -p 3030:3030 app <br/>#run the newly created app image. binding to port 3030 on host system to port 3030 in docker image</span></pre><p id="b5b6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请记住，如果您使用了不同的端口，或者想要绑定到主机系统上的不同端口，请在脚本中进行更改。</p><h1 id="8418" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">现在一起测试它</h1><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es mp"><img src="../Images/4934a64a3a0c962f89c35bdb16a1bb47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MkeJD9yLge3DC1NHHM7ggQ.jpeg"/></div></div></figure><p id="241b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在是我们测试整个流程的时候了。最简单的方法就是在Codeship中点击重启构建。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es mq"><img src="../Images/4012772419ec8883ee8003c65836ee9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*kL_vSFLi-e2FVxEtsUnsPw.png"/></div></figure><p id="5eaa" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">点击重启将运行所有的单元测试。如果通过，它将运行您的部署工作流，瞧！访问您的ip:port，您将看到您的Dart应用程序正在运行！</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es mr"><img src="../Images/fda7bba00ec80b2dc39a938aff008370.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*taurI7Wyfd14jdl0azlhbA.png"/></div></div></figure><h1 id="cdb8" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">摘要</h1><p id="8c4d" class="pw-post-body-paragraph im in hi io b ip lc ir is it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj hb bi translated">有点漫长，但值得一试。这将为您节省无数时间，当您在周五晚上对系统进行快速更改并想要部署它时。Codeship可以轻松确保您的代码不会在生产中崩溃，Dart结合GCE的强大功能将使您的应用程序飞起来。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es ms"><img src="../Images/c031b3a5e0b240cbbea62533a8efb61d.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*mHB3OhZDUgUYcsuxDAH6wg.jpeg"/></div></figure></div></div>    
</body>
</html>