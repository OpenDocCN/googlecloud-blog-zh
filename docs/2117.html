<html>
<head>
<title>Looker — self-hosted installation on GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">looker—GCP上的自托管安装</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/looker-self-hosted-installation-on-gcp-7e6a5050784a?source=collection_archive---------0-----------------------#2022-02-21">https://medium.com/google-cloud/looker-self-hosted-installation-on-gcp-7e6a5050784a?source=collection_archive---------0-----------------------#2022-02-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="cd3f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Looker是Google Cloud的云原生企业商务智能平台，支持在您需要时随时随地访问近乎实时的数据。</p><p id="681c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以选择Looker托管解决方案(Looker管理所有组件)和客户托管解决方案(您拥有自己的环境)。这两种解决方案之间的选择取决于需求。例如，您可能有不允许您使用Looker宿主的安全要求。使用Looker hosted解决方案，您不必担心安装、升级和扩展，并且解决问题的时间也更快。借助客户托管的解决方案，您可以完全控制自己的基础架构。</p><p id="c6e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将描述在GCP上安装Looker的必要步骤。</p><p id="19cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以在单个虚拟机上安装Looker，但这仅适用于小型工作负载数据库。对于生产环境，更好的解决方案是虚拟机群集，如下图所示。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/51255be62385bc92cc462e1a51ba6b03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6wSHdGSpWT9V4SpUeexWsg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">虚拟机集群</figcaption></figure><p id="21e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将Looker作为跨多个虚拟机的实例集群运行是一种灵活的模式，它受益于服务故障转移和冗余。水平可伸缩性提供了更高的吞吐量，而不会产生过多的垃圾收集成本。</p><h2 id="b8f5" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated"><strong class="ak">集群注意事项</strong></h2><ul class=""><li id="ed6b" class="ko kp hi ih b ii kq im kr iq ks iu kt iy ku jc kv kw kx ky bi translated"><strong class="ih hj"> OS和发行</strong></li></ul><p id="608a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Looker运行在最常见的Linux版本上:RedHat、SUSE和Debian/Ubuntu。Linux的GCP发行版与Looker兼容。Debian/Ubuntu是使用最广泛的Linux版本。Looker运行在Java虚拟机(JVM)中。选择发行版时，检查OpenJDK 8的版本是否是最新的。</p><ul class=""><li id="79a9" class="ko kp hi ih b ii ij im in iq kz iu la iy lb jc kv kw kx ky bi translated"><strong class="ih hj"> CPU和内存</strong></li></ul><p id="1486" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于生产使用16x64节点(16个CPU和64gb RAM)，这是价格和性能之间的良好平衡。配置超过64 GB的RAM会影响性能，因为垃圾收集事件是单线程的，并且对于多达50个用户的配置，会暂停所有其他线程，所以Looker建议运行单个服务器</p><ul class=""><li id="ff9a" class="ko kp hi ih b ii ij im in iq kz iu la iy lb jc kv kw kx ky bi translated"><strong class="ih hj">磁盘存储</strong></li></ul><p id="33b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">100 GB的磁盘空间通常足以满足生产系统的需求。</p><ul class=""><li id="852e" class="ko kp hi ih b ii ij im in iq kz iu la iy lb jc kv kw kx ky bi translated"><strong class="ih hj">容量</strong></li></ul><p id="3acf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当需要更多容量时，您应该向群集中添加16x64节点，而不是将节点大小增加到16x64以上。</p><ul class=""><li id="b6b4" class="ko kp hi ih b ii ij im in iq kz iu la iy lb jc kv kw kx ky bi translated"><strong class="ih hj">文件系统</strong></li></ul><p id="58cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Looker节点需要共享文件系统的某些部分(LookML模型、Looker模型开发人员、Git服务器连接)。文件系统必须与POSIX兼容。</p><ul class=""><li id="fc56" class="ko kp hi ih b ii ij im in iq kz iu la iy lb jc kv kw kx ky bi translated"><strong class="ih hj">数据库</strong></li></ul><p id="41c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Looker的元数据需要集中，所以其内部数据库必须迁移到云SQL (MySQL)。</p><p id="1e65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Looker需要Git服务来提供LookML文件的版本管理。支持GitHub、GitLab、BitBucket等。</p><h1 id="8e4d" class="lc ju hi bd jv ld le lf jz lg lh li kd lj lk ll kg lm ln lo kj lp lq lr km ls bi translated"><strong class="ak">可扩展性</strong></h1><p id="8197" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">您可以在实例组配置中指定集群中的节点数量。目前，Looker还没有一个干净的方法来优雅地终止一个节点。</p><p id="0389" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以自动放大，但是缩小应该手动进行，并且非常小心。</p><p id="f68e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-从负载平衡器目录中删除节点</p><p id="fc16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-等待用户开始新的会话(通常为15、20分钟)</p><p id="745e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-使节点脱机</p><h1 id="44a5" class="lc ju hi bd jv ld le lf jz lg lh li kd lj lk ll kg lm ln lo kj lp lq lr km ls bi translated"><strong class="ak">升级</strong></h1><ul class=""><li id="ed66" class="ko kp hi ih b ii kq im kr iq ks iu kt iy ku jc kv kw kx ky bi translated">创建一个新的形象</li><li id="300c" class="ko kp hi ih b ii lw im lx iq ly iu lz iy ma jc kv kw kx ky bi translated">永远记住升级虚拟机的最重要的规则:永远不能将两个版本的基于虚拟机的Looker连接到同一个数据库。这将损坏数据库并使其不可用。</li><li id="5564" class="ko kp hi ih b ii lw im lx iq ly iu lz iy ma jc kv kw kx ky bi translated">安全进行的最快方法是将我们的实例组“扩展”到0个节点。在实例组的编辑模式中进行更改。</li><li id="e3a7" class="ko kp hi ih b ii lw im lx iq ly iu lz iy ma jc kv kw kx ky bi translated">备份您的数据库</li><li id="f5c9" class="ko kp hi ih b ii lw im lx iq ly iu lz iy ma jc kv kw kx ky bi translated">使用新映像重新创建实例组</li></ul><h1 id="2f92" class="lc ju hi bd jv ld le lf jz lg lh li kd lj lk ll kg lm ln lo kj lp lq lr km ls bi translated"><strong class="ak">网络</strong></h1><p id="76f0" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">Looker在端口9999上侦听HTTPS请求。Looker使用一个自签名证书，其常用名为self-signed.looker.com。</p><p id="8bc8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Looker API监听端口19999。</p><h2 id="731e" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">内部数据库连接</h2><p id="550e" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">必须启用私有服务访问，以便使用私有IP从计算引擎实例连接到云SQL。您的VM实例必须与您的云SQL实例位于同一区域。</p><h2 id="bb43" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">外部服务</h2><p id="66cc" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">Looker的遥测和许可证服务器可通过HTTPS在公共互联网上获得。必须允许从Looker节点到ping.looker.com:443和license.looker.com:443的流量。</p><h2 id="8df4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">SMTP服务</h2><p id="4a43" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">默认情况下，Looker通过SendGrid发送邮件。这可能需要将smtp.sendgrid.net:587加入允许名单。</p><p id="dc44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">集群节点将通过消息代理服务相互通信，该服务使用端口1551和61616。必须在群集节点之间打开端口1551和61616。</p><h1 id="50a5" class="lc ju hi bd jv ld le lf jz lg lh li kd lj lk ll kg lm ln lo kj lp lq lr km ls bi translated">数据库ˌ资料库</h1><p id="d272" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">建议使用远程MySQL数据库(在Google Cloud中，使用Cloud SQL)。</p><h1 id="d60e" class="lc ju hi bd jv ld le lf jz lg lh li kd lj lk ll kg lm ln lo kj lp lq lr km ls bi translated"><strong class="ak">监控</strong></h1><p id="1503" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">可以使用云监控或JMX。</p><p id="3da6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> JMX </strong></p><p id="69f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认情况下，JMX未启用。要启用它，需要修改启动脚本</p><p id="9139" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae mb" href="https://docs.looker.com/setup-and-management/on-prem-install/monitoring-instance" rel="noopener ugc nofollow" target="_blank">https://docs . looker . com/setup-and-management/on-prem-install/monitoring-instance</a></p><p id="dc7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">云监控</strong></p><p id="6764" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">建议至少对以下性能指标进行收集、绘制图表并发出警报:</p><ul class=""><li id="15f7" class="ko kp hi ih b ii ij im in iq kz iu la iy lb jc kv kw kx ky bi translated">CPU利用率:负载和CPU利用率百分比</li><li id="b947" class="ko kp hi ih b ii lw im lx iq ly iu lz iy ma jc kv kw kx ky bi translated">内存利用率:已用总内存和已用交换内存</li><li id="d9ed" class="ko kp hi ih b ii lw im lx iq ly iu lz iy ma jc kv kw kx ky bi translated">磁盘使用</li></ul><h1 id="c684" class="lc ju hi bd jv ld le lf jz lg lh li kd lj lk ll kg lm ln lo kj lp lq lr km ls bi translated"><strong class="ak">测井</strong></h1><p id="d952" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">可以在启动脚本中配置日志记录选项，例如日志文件的存储位置、级别和日志格式。</p><h1 id="9876" class="lc ju hi bd jv ld le lf jz lg lh li kd lj lk ll kg lm ln lo kj lp lq lr km ls bi translated"><strong class="ak">安全</strong></h1><ul class=""><li id="b1f1" class="ko kp hi ih b ii kq im kr iq ks iu kt iy ku jc kv kw kx ky bi translated">Looker使用安全连接来查询云SQL和云文件存储。</li><li id="3d7e" class="ko kp hi ih b ii lw im lx iq ly iu lz iy ma jc kv kw kx ky bi translated">管理员可以按用户或组设置粒度权限，并可以限制访问</li><li id="5827" class="ko kp hi ih b ii lw im lx iq ly iu lz iy ma jc kv kw kx ky bi translated">所有静态数据都经过加密。</li><li id="4a8a" class="ko kp hi ih b ii lw im lx iq ly iu lz iy ma jc kv kw kx ky bi translated">只允许Looker服务器使用的IP地址使用您的MySQL用户帐户。</li></ul><h1 id="c503" class="lc ju hi bd jv ld le lf jz lg lh li kd lj lk ll kg lm ln lo kj lp lq lr km ls bi translated"><strong class="ak"> IAC </strong></h1><p id="deb8" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">你可以用Terraform在GCP上安装Looker。需要以下模块:</p><ul class=""><li id="0c5b" class="ko kp hi ih b ii ij im in iq kz iu la iy lb jc kv kw kx ky bi translated">数据库模块</li><li id="d4d6" class="ko kp hi ih b ii lw im lx iq ly iu lz iy ma jc kv kw kx ky bi translated">文件存储模块</li><li id="6712" class="ko kp hi ih b ii lw im lx iq ly iu lz iy ma jc kv kw kx ky bi translated">DNS模块</li><li id="41c7" class="ko kp hi ih b ii lw im lx iq ly iu lz iy ma jc kv kw kx ky bi translated">托管区域模块</li><li id="ee89" class="ko kp hi ih b ii lw im lx iq ly iu lz iy ma jc kv kw kx ky bi translated">实例组模块</li><li id="a52d" class="ko kp hi ih b ii lw im lx iq ly iu lz iy ma jc kv kw kx ky bi translated">负载平衡器模块</li><li id="b83b" class="ko kp hi ih b ii lw im lx iq ly iu lz iy ma jc kv kw kx ky bi translated">秘密模块</li><li id="9f7b" class="ko kp hi ih b ii lw im lx iq ly iu lz iy ma jc kv kw kx ky bi translated">SSl证书模块</li></ul><p id="a4b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考文献</strong></p><div class="mc md ez fb me mf"><a href="https://help.looker.com/hc/en-us/articles/4404034035987-Customer-Hosted-Architecture-Solutions-Overview" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab dw"><div class="mh ab mi cl cj mj"><h2 class="bd hj fi z dy mk ea eb ml ed ef hh bi translated">客户托管架构解决方案:概述</h2><div class="mm l"><h3 class="bd b fi z dy mk ea eb ml ed ef dx translated">本文是由多个部分组成的系列文章的一部分，讨论Looker的托管、部署方法和最佳…</h3></div><div class="mn l"><p class="bd b fp z dy mk ea eb ml ed ef dx translated">help.looker.com</p></div></div><div class="mo l"><div class="mp l mq mr ms mo mt jn mf"/></div></div></a></div><div class="mc md ez fb me mf"><a href="https://help.looker.com/hc/en-us/articles/4403392016019-Customer-Hosted-Architecture-Solutions-Patterns-and-Practices" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab dw"><div class="mh ab mi cl cj mj"><h2 class="bd hj fi z dy mk ea eb ml ed ef hh bi translated">客户托管架构解决方案:模式和实践</h2><div class="mm l"><h3 class="bd b fi z dy mk ea eb ml ed ef dx translated">本文是由多个部分组成的系列文章的一部分，讨论Looker的托管、部署方法和最佳…</h3></div><div class="mn l"><p class="bd b fp z dy mk ea eb ml ed ef dx translated">help.looker.com</p></div></div><div class="mo l"><div class="mu l mq mr ms mo mt jn mf"/></div></div></a></div><div class="mc md ez fb me mf"><a href="https://docs.looker.com/data-modeling/getting-started/setting-up-git-connection" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab dw"><div class="mh ab mi cl cj mj"><h2 class="bd hj fi z dy mk ea eb ml ed ef hh bi translated">设置和测试Git连接</h2><div class="mm l"><h3 class="bd b fi z dy mk ea eb ml ed ef dx translated">设置和测试Git连接查看器提供了一种开发模式，让您可以在安全的环境中开发您的模型…</h3></div><div class="mn l"><p class="bd b fp z dy mk ea eb ml ed ef dx translated">docs.looker.com</p></div></div><div class="mo l"><div class="mv l mq mr ms mo mt jn mf"/></div></div></a></div><div class="mc md ez fb me mf"><a href="https://community.looker.com/general-looker-administration-35/using-gitlab-for-version-control-in-looker-8199" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab dw"><div class="mh ab mi cl cj mj"><h2 class="bd hj fi z dy mk ea eb ml ed ef hh bi translated">在Looker | Looker社区中使用GitLab进行版本控制</h2><div class="mm l"><h3 class="bd b fi z dy mk ea eb ml ed ef dx translated">使用这篇文章和Looker文档设置版本控制来配置你的版本控制…</h3></div><div class="mn l"><p class="bd b fp z dy mk ea eb ml ed ef dx translated">community.looker.com</p></div></div><div class="mo l"><div class="mw l mq mr ms mo mt jn mf"/></div></div></a></div><div class="mc md ez fb me mf"><a href="https://help.looker.com/hc/en-us/articles/360057499914" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab dw"><div class="mh ab mi cl cj mj"><h2 class="bd hj fi z dy mk ea eb ml ed ef hh bi translated">在Looker中使用云源代码库进行版本控制</h2><div class="mm l"><h3 class="bd b fi z dy mk ea eb ml ed ef dx translated">本文旨在与Looker文档页面结合使用，以设置和测试Git…</h3></div><div class="mn l"><p class="bd b fp z dy mk ea eb ml ed ef dx translated">help.looker.com</p></div></div><div class="mo l"><div class="mx l mq mr ms mo mt jn mf"/></div></div></a></div><div class="mc md ez fb me mf"><a href="https://help.looker.com/hc/en-us/articles/4404416923283#h_01FBSNBCJKPR3554EVNC0676AE" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab dw"><div class="mh ab mi cl cj mj"><h2 class="bd hj fi z dy mk ea eb ml ed ef hh bi translated">客户托管架构解决方案:组件演练</h2><div class="mm l"><h3 class="bd b fi z dy mk ea eb ml ed ef dx translated">本文是由多个部分组成的系列文章的一部分，讨论Looker的托管、部署方法和最佳…</h3></div><div class="mn l"><p class="bd b fp z dy mk ea eb ml ed ef dx translated">help.looker.com</p></div></div><div class="mo l"><div class="my l mq mr ms mo mt jn mf"/></div></div></a></div><div class="mc md ez fb me mf"><a href="https://docs.looker.com/setup-and-management/on-prem-install/monitoring-instance" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab dw"><div class="mh ab mi cl cj mj"><h2 class="bd hj fi z dy mk ea eb ml ed ef hh bi translated">监视旁观者</h2><div class="mm l"><h3 class="bd b fi z dy mk ea eb ml ed ef dx translated">虽然Looker应用程序监控似乎不是严格要求的，但设置它是非常重要的。在…</h3></div><div class="mn l"><p class="bd b fp z dy mk ea eb ml ed ef dx translated">docs.looker.com</p></div></div></div></a></div></div></div>    
</body>
</html>