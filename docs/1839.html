<html>
<head>
<title>Using Cloud Pub/Sub from Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Kotlin的云发布/订阅</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/using-cloud-pub-sub-from-kotlin-d501f7d65e24?source=collection_archive---------0-----------------------#2021-03-30">https://medium.com/google-cloud/using-cloud-pub-sub-from-kotlin-d501f7d65e24?source=collection_archive---------0-----------------------#2021-03-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/4a6033e4ac6c6f3b6da523f99699c128.png" data-original-src="https://miro.medium.com/v2/resize:fit:348/0*XRk7MwMn9TycGfnL"/></div></figure><figure class="in io ip iq fd ij er es paragraph-image"><div class="er es im"><img src="../Images/1cb723b5c8903b3f78bf267f919b8a97.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/0*IMpDYU04xDIy2jTq"/></div></figure><h1 id="f3ca" class="ir is hi bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo bi translated">为什么Kotlin在服务器端？</h1><p id="afc5" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">关于谷歌产品，<a class="ae kn" href="https://kotlinlang.org/" rel="noopener ugc nofollow" target="_blank"> Kotlin </a>似乎是最知名的构建Android应用程序的语言。但是Kotlin可爱的类型安全和代码简洁特性在服务器端也非常有效。因为它在JVM上编译和运行，所以很容易把它放到任何运行Java应用程序的地方。</p><p id="65f7" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated">谢天谢地，使用现有的为Java编写的发布/订阅库也很容易。</p><p id="9ee3" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated"><em class="kt">(请注意，目前这还没有得到官方支持，但是如果你正在尝试的话，希望这能让你上手！)</em></p><h1 id="6010" class="ir is hi bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo bi translated">项目设置</h1><p id="638d" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">可以创建使用Maven和Gradle构建的Kotlin项目，但是Gradle是Kotlin的首选和“本地”选择，所以我将继续这样做。</p><p id="5c8a" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated">第一步是使用<a class="ae kn" href="https://www.jetbrains.com/idea/" rel="noopener ugc nofollow" target="_blank"> IntelliJ IDEA </a>或<a class="ae kn" href="https://developer.android.com/studio" rel="noopener ugc nofollow" target="_blank"> Android Studio </a>创建一个用Gradle构建的Kotlin命令行项目。确保制作一个控制台应用程序，并设置一个JDK。(不一定要11。)</p><figure class="in io ip iq fd ij er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es ku"><img src="../Images/5ce4492c2a1bf6d20a62832ea9586c72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IjrEfgE0F_XGCmDw"/></div></div></figure><p id="e8eb" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated">第二页没有太多变化:</p><figure class="in io ip iq fd ij er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es ku"><img src="../Images/cbbbabff7797f42a8de11b2ceb248a84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*I0SipFG9_r3bnKQ5"/></div></div></figure><p id="7fe5" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated">要使用发布/订阅库，我们必须将它们添加到我们的Gradle构建配置中。编辑<strong class="jr hj"> build.gradle.kts </strong>文件，添加如下<strong class="jr hj">实现</strong>行:</p><figure class="in io ip iq fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="67ce" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated">当然，这是截至本文的当前版本；您可能应该访问<a class="ae kn" href="https://mvnrepository.com/artifact/com.google.cloud/google-cloud-pubsub" rel="noopener ugc nofollow" target="_blank">发布/订阅库</a>的Maven中心条目，并查看最新版本。</p><p id="78cc" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated"><em class="kt">(如果您有Gradle构建错误，请注意最近的IntelliJ更新导致了其中一些错误；确保你在2020.3.1+上。)</em></p><p id="55f9" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated">现在，您应该能够调用Java发布/订阅库了，如下所示:</p><figure class="in io ip iq fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="a686" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated">编译应该会成功，尽管现在还做不了多少！</p><h1 id="5146" class="ir is hi bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo bi translated">与发布/订阅接口</h1><p id="51f1" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">现在你的基本项目已经就绪，你可以使用Java APIs了，但是要保持Kotlin的简洁和类型安全，这是我们所熟悉和喜爱的。例如，该函数将开始监听订阅，为收到的每条消息调用消息接收方，直到发生异常。</p><figure class="in io ip iq fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="4f5c" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated">您可以在类似下面的示例中使用该函数，它将简单地接收和确认消息，并偶尔(每10秒一次)打印已接收消息的数量:</p><figure class="in io ip iq fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><h1 id="a428" class="ir is hi bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo bi translated">后续步骤</h1><p id="2a9d" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">从这里，您可以开始为您的消息模式创建流畅的数据类。我上面给出的例子也非常简单，可能不太地道(抱歉有点生疏了！)它们或许可以使用科特林流运算符等进行改进。Kotlin延续也可以很好地用于处理异步通信。</p><p id="24d8" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated">参见<a class="ae kn" href="https://github.com/feywind/kotlin-pubsub" rel="noopener ugc nofollow" target="_blank">一个在本地仿真器上运行的完整示例</a>。</p><p id="f64d" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated">你在服务器端用过Kotlin吗？请随时对这篇文章发表评论，或者对你在谷歌云平台上发现的关于Kotlin的有趣/有前途的事情发表评论！</p></div></div>    
</body>
</html>