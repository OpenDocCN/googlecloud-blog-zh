<html>
<head>
<title>Asset Tracking using Cameras, IoT, Machine Learning and Edge Computing.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用相机、物联网、机器学习和边缘计算进行资产跟踪。</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/image-tracking-using-iot-machine-learning-and-edge-computing-8ad7e298b041?source=collection_archive---------2-----------------------#2019-02-19">https://medium.com/google-cloud/image-tracking-using-iot-machine-learning-and-edge-computing-8ad7e298b041?source=collection_archive---------2-----------------------#2019-02-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/57cdfa3f700cc27dc77ca3494e5c13a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BUXGTRRir7UtRmGt3c9Szg.png"/></div></div></figure><div class=""/><p id="7a99" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">一项涉及带摄像头的ESP32的实验，一个在边缘运行Tensorflow推论的Raspberry Pi，充当云物联网核心网关和云上存储所有数据的无服务器层。</strong></p><p id="faf1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本教程结束时，看看我们完成的应用程序是什么样子的:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es jo"><img src="../Images/ad89ddac698b2c5da3faf09ef74f4bb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hLntUmTJkDa2P3BLrFAmqw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">本地web界面</figcaption></figure><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es jx"><img src="../Images/0abf0766beb6a1b3cc9e73158879d1ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sKHk4eZSMlnjSlRv5LwSTg.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">在线Web界面</figcaption></figure><h2 id="102c" class="jy jz ht bd ka kb kc kd ke kf kg kh ki jb kj kk kl jf km kn ko jj kp kq kr ks bi translated">什么是边缘计算？</h2><p id="d296" class="pw-post-body-paragraph iq ir ht is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">我们从使用运行在中央数据中心的本地服务器转移到处理和存储我们所有数据的远程服务器，我们称之为云计算。迁移到云的一些原因是为了易用性、可伸缩性和降低维护我们服务的所有基础设施的成本。</p><p id="463e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但在某些情况下，我们仍然需要在事情发生的附近处理数据，这就是我们所说的边缘计算。</p><p id="90eb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用边缘计算有许多原因，这里我们可以看到一些可以应用边缘计算的场景，本文的示例将介绍其中一些场景:</p><ul class=""><li id="bca4" class="ky kz ht is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated"><strong class="is hu">响应时间和访问系统非常重要，即使在互联网中断的情况下也是如此</strong>:例如，对于家庭自动化而言，当您在室内但互联网中断时无法控制您的房子，但您仍然希望通过云在室外访问您的房子，这是没有意义的。此外，在自动驾驶汽车的背景下，事情需要在本地处理，并有即时响应时间，以可靠地工作并避免重大问题。</li><li id="33dc" class="ky kz ht is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated"><strong class="is hu">使用更少的网络带宽</strong>:这可以在网飞看到，他们使用分布在全球许多城市的本地缓存来降低整体网络传输成本和与视频流相关的负载，也给我们的用户带来了更好的整体体验。</li><li id="2264" class="ky kz ht is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated"><strong class="is hu">隐私</strong> : <strong class="is hu"> </strong>有时，数据应该只靠近用户，将最少量的数据发送到云，目的是改善用户体验，比如让用户能够远程控制。</li><li id="2570" class="ky kz ht is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated"><strong class="is hu">当在云中处理一切变得过于昂贵时</strong>:如果我们可以在本地处理一些工作负载，然后只将重要数据发送到云中，我们就可以节省大量成本。在云中运行机器学习或处理图像数据可能非常昂贵，无论是在带宽方面还是在处理能力方面，所以如果我们可以在本地运行，我们可以获得很多收益并节省成本。</li></ul><p id="eef8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里的想法是使用一些廉价的相机，它们为我们提供了一个获取图像的接口，一个本地服务器，它搜索那些本地相机并使用机器学习和计算机视觉处理它们的图像，然后将处理后的数据发送到云端，这样我们就可以通过了解图像的内容来监控相机并将其视为传感器。我们可以用它来跟踪房子或建筑物上的人，如果野生动物出现在我们的房子外面或公共场所，我们就会收到警报，甚至可以训练一个定制模型，只允许授权人员在某个地方走动。将相机用作传感器有许多使用案例。</p><p id="b47e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本教程中，我们将使用一些带有集成摄像头的<strong class="is hu"> ESP32模块作为我们的廉价wifi摄像头。使用一个<strong class="is hu"> Raspberry Pi </strong>板作为本地服务器(你可以使用你的电脑代替)，它将使用<strong class="is hu"> Tensorflow </strong>和一些预制模型运行图像分类，这些模型足以对图像上的对象进行分类和检测。使用<strong class="is hu">云物联网核心</strong>并利用新的<strong class="is hu">网关</strong>功能，将分类数据安全地发送到云，因此本地服务器可以代表摄像头模块将数据发送到云。然后，使用<strong class="is hu"> Firebase云函数</strong>以基于事件的方式处理数据，这些函数基本上将数据存储在<strong class="is hu"> Firebase </strong>上，以便在部署在<strong class="is hu"> Firebase主机</strong>上的web界面上将数据提供给互联网连接用户。此外，本地服务器将提供本地web界面来监控摄像机。</strong></p><p id="b45f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里是我们架构的概述:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/57cdfa3f700cc27dc77ca3494e5c13a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BUXGTRRir7UtRmGt3c9Szg.png"/></div></div></figure><p id="2b0f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在简要介绍了边缘计算和我们的项目之后，让我们开始用固件对我们的相机进行编程，以提供图像服务。</p><h2 id="d886" class="jy jz ht bd ka kb kc kd ke kf kg kh ki jb kj kk kl jf km kn ko jj kp kq kr ks bi translated"><strong class="ak">使用PlatformIO闪烁ESP32摄像头模块</strong></h2><p id="30b4" class="pw-post-body-paragraph iq ir ht is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">现在有很多带集成摄像头的ESP32模块，价格从9美元到15美元不等。在这里你可以看到一些可以用于这个项目的在线销售的模型。我个人用的是ESP32Cam和M5Stack Cam。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lm"><img src="../Images/1dcbfda172689d2cae06217a26450d6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jR2ozcYQrpzSvkvc0539yg.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">M5Stack Cam在左侧，ESP32Cam在右侧</figcaption></figure><p id="7516" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个项目中，我使用Espressif模块的本地开发框架— <strong class="is hu"> ESP-IDF </strong>为摄像机编写了固件。我之所以选择这款，是因为它能更好地访问电路板的所有功能，并且有更多如何使用ESP32连接摄像机的示例。通常使用ESP-IDF有点困难，但是使用<strong class="is hu"> PlatformIO </strong>会使开始使用它变得容易得多。</p><div class="hh hi ez fb hj ln"><a href="https://github.com/espressif/esp-idf" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hu fi z dy ls ea eb lt ed ef hs bi translated">espressif/esp-idf</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">Espressif物联网开发框架。ESP32的官方开发框架。- espressif/esp-idf</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">github.com</p></div></div><div class="lw l"><div class="lx l ly lz ma lw mb hp ln"/></div></div></a></div><p id="f7ac" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> PlatformIO </strong>是一套用于嵌入式设备开发的跨平台工具。它支持许多不同的物联网开发平台和框架，也支持社区制作的大量库，可以轻松用于您的项目。</p><p id="1d79" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我建议安装Visual Studio代码(VSCode) IDE和PlatformIO插件来开始使用它。只需按照下面链接中的步骤操作:</p><div class="hh hi ez fb hj ln"><a href="https://platformio.org/platformio-ide" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hu fi z dy ls ea eb lt ed ef hs bi translated">PlatformIO:面向物联网开发的开源生态系统</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">跨平台构建系统和库管理器。跨平台IDE和统一调试器。远程单元测试和…</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">platformio.org</p></div></div><div class="lw l"><div class="mc l ly lz ma lw mb hp ln"/></div></div></a></div><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es md"><img src="../Images/5549b7d8c770050bc173dbfb242873dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*pYwZqgA-LWlaKPREVtvOLQ.png"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">安装PlatformIO VSCode插件</figcaption></figure><p id="e37c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个项目的代码可以在下面的Github链接中找到。克隆或下载项目代码，在IDE上打开<strong class="is hu"> esp32-camera-firmware </strong>文件夹。</p><div class="hh hi ez fb hj ln"><a href="https://github.com/alvarowolfx/gcloud-iot-edge-tensorflow" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hu fi z dy ls ea eb lt ed ef hs bi translated">alvarowolfx/g cloud-IOT-edge-tensor flow</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">使用边缘计算和计算机视觉的资产跟踪。-alvarowolfx/g cloud-IOT-edge-tensor flow</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">github.com</p></div></div><div class="lw l"><div class="me l ly lz ma lw mb hp ln"/></div></div></a></div><p id="3fe9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要设置项目，必须进行一些配置更改。最重要的是wifi凭证，可以在<strong class="is hu"> sdkconfig.h </strong>文件中找到:<strong class="is hu"> CONFIG_WIFI_SSID </strong>和<strong class="is hu"> CONFIG_WIFI_PASSWORD </strong>。此外，在<strong class="is hu"> platformio.ini </strong>文件中，有一个环境配置用于选择您正在使用的主板型号，可以是ESP32-Cam或ESP32 M5Stack。</p><p id="8a46" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您使用的是ESP32-Cam板，您将需要一个3.3v FTDI模块来连接到该模块并刷新固件。只需将模块上的<strong class="is hu"> UOT </strong>和<strong class="is hu"> UOR </strong>引脚连接到FTDI模块上的<strong class="is hu"> RX </strong>和<strong class="is hu"> TX </strong>以及为电路板供电所需的ping、3.3v和GND。然后将引脚<strong class="is hu"> IO2 </strong>和<strong class="is hu"> IO0 </strong>连接到<strong class="is hu"> GND </strong>上，使电路板进入闪存模式并能够对其进行编程。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mf"><img src="../Images/eb10f667da83978adcf733cd2e77af15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qs6Irsmrnmopjq1zg6e3Dw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">ESP32Cam通过定制的3d打印外壳与FTDI模块和其他摄像机连接。</figcaption></figure><p id="6c16" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该固件基本上提供了一个HTTP端点来从该模块获取图像，并且还为网关发布了一个mDNS服务来查询和查找所有可用于处理图像的摄像机。设备发布一个<strong class="is hu"> _camera </strong>服务，使用<strong class="is hu"> _tcp </strong>协议，每个设备的实例名基于ESP32的内部芯片ID。</p><p id="6aa1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要查询mDNS服务，我们可以在下面的命令中使用命令<strong class="is hu"> dns-sd </strong>，我们可以在输出中看到，它找到了两个运行我们所需服务的相机设备:</p><pre class="jp jq jr js fd mg mh mi mj aw mk bi"><span id="dd07" class="jy jz ht mh b fi ml mm l mn mo">$ dns-sd -B _camera._tcp .<br/>Browsing for _camera._tcp<br/>DATE: - -Sun 16 Dec 2018 - -<br/>19:55:04.135 …STARTING…<br/>Timestamp A/R Flags if Domain Service Type Instance Name<br/>19:55:04.136 Add 3 6 local. _camera._tcp. indoor-camera-ec5d<br/>19:55:04.137 Add 2 6 local. _camera._tcp. indoor-camera-60d8</span></pre><p id="0d75" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要查看某些图像，只需访问<strong class="is hu"> {INSTANCE_NAME}。local/jpg </strong>在浏览器中查看摄像机图像。以URL为例，根据上面的输出，这些URL是有效的:</p><pre class="jp jq jr js fd mg mh mi mj aw mk bi"><span id="e2cd" class="jy jz ht mh b fi ml mm l mn mo"><a class="ae mp" href="http://indoor-camera-ec5d.local/jpg" rel="noopener ugc nofollow" target="_blank">http://indoor-camera-ec5d.local/jpg</a><br/><a class="ae mp" href="http://indoor-camera-60d8.local/jpg" rel="noopener ugc nofollow" target="_blank">http://indoor-camera-60d8.local/jpg</a></span></pre><p id="20ed" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们的摄像机节点已经启动并运行，我们可以前进到我们的网关。</p><h2 id="50c1" class="jy jz ht bd ka kb kc kd ke kf kg kh ki jb kj kk kl jf km kn ko jj kp kq kr ks bi translated"><strong class="ak">使用谷歌云配置网关和设备</strong></h2><p id="435a" class="pw-post-body-paragraph iq ir ht is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">本地服务器将充当网关，并代表传感器节点发送数据。谷歌云刚刚在云物联网核心上推出了一项新功能，使我们能够创建网关来实现这一点，因此这是学习这一点的绝佳机会。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mq"><img src="../Images/c423c22dfbe0a06ebe7bf7b57f430e79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gr3byVX2qYpN-Dkcrb3Yag.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">云物联网核心网关架构。</figcaption></figure><div class="hh hi ez fb hj ln"><a href="https://cloud.google.com/iot/docs/how-tos/gateways/" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hu fi z dy ls ea eb lt ed ef hs bi translated">概述|谷歌云物联网核心|谷歌云</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">谷歌云提供安全、开放、智能和变革性的工具，帮助企业实现现代化，以适应当今的…</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">cloud.google.com</p></div></div></div></a></div><p id="891e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但首先，我们需要设置一些资源来开始使用云物联网核心。让我们来看一下在Google Cloud上完成这项工作所需的步骤:</p><ul class=""><li id="7177" class="ky kz ht is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated">启用云物联网核心和PubSub。</li><li id="5079" class="ky kz ht is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated">在PubSub上创建遥测和状态主题，用于云物联网核心。</li><li id="939f" class="ky kz ht is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated">出于调试目的，创建对上述主题的订阅。</li><li id="e59f" class="ky kz ht is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated">创建云物联网核心注册表，该注册表将包含所有受管设备。</li><li id="55ec" class="ky kz ht is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated">为网关生成密钥对证书以连接到云。</li><li id="e216" class="ky kz ht is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated">使用上述密钥注册云物联网网关。</li></ul><p id="1d70" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我在项目存储库上提供了一个脚本，我们可以用它来自动化所有这些步骤。这样，我们只需要像这样执行它就可以设置好一切:</p><pre class="jp jq jr js fd mg mh mi mj aw mk bi"><span id="b29a" class="jy jz ht mh b fi ml mm l mn mo">./setup.sh PROJECT_NAME</span></pre><p id="d715" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行该脚本将创建一些额外的文件，<strong class="is hu"> ec_public.pem </strong>和<strong class="is hu"> ec_private.pem </strong>证书，这些文件将在以后使用。公共证书与网关相关联，并在云物联网核心上注册以验证网关连接，私有证书将由网关用于发送数据。</p><p id="16f1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，要在云物联网核心上注册设备并绑定到网关，项目存储库中有一个脚本可用于简化此任务:</p><pre class="jp jq jr js fd mg mh mi mj aw mk bi"><span id="78a9" class="jy jz ht mh b fi ml mm l mn mo">./register-device.sh PROJECT_NAME DEVICE_ID</span></pre><p id="a1d6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">只有注册的设备才能通过网关发送数据，因此我们需要注册所有的ESP32摄像机并将其与网关绑定。之后，我们可以讨论网关的实现。</p><h2 id="0ae0" class="jy jz ht bd ka kb kc kd ke kf kg kh ki jb kj kk kl jf km kn ko jj kp kq kr ks bi translated"><strong class="ak">使用Tensorflow和NodeJS的网关</strong></h2><p id="3808" class="pw-post-body-paragraph iq ir ht is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">该网关基本上必须使用mDNS搜索本地摄像头，对图像进行分类，将数据发送到云端，并提供一个web接口来本地访问数据。该项目的代码也可以在Github的<strong class="is hu"> edge-server </strong>文件夹中找到。</p><div class="hh hi ez fb hj ln"><a href="https://github.com/alvarowolfx/gcloud-iot-edge-tensorflow" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hu fi z dy ls ea eb lt ed ef hs bi translated">alvarowolfx/g cloud-IOT-edge-tensor flow</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">使用边缘计算和计算机视觉的资产跟踪。-alvarowolfx/g cloud-IOT-edge-tensor flow</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">github.com</p></div></div><div class="lw l"><div class="me l ly lz ma lw mb hp ln"/></div></div></a></div><p id="0d32" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我选择<strong class="is hu"> NodeJS </strong>是因为在我看来这是入门Tensorflow最简单的方法之一。有一个名为<strong class="is hu"> @tensorflow/models </strong>的NPM包，它包含了许多预先制作的机器学习模型，可以用于许多不同的目的和数据类型。你可以看看网站，了解更多信息。</p><div class="hh hi ez fb hj ln"><a href="https://js.tensorflow.org/#getting-started" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hu fi z dy ls ea eb lt ed ef hs bi translated">TensorFlow.js</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">一个WebGL加速的、基于浏览器的JavaScript库，用于训练和部署ML模型</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">js.tensorflow.org</p></div></div><div class="lw l"><div class="mr l ly lz ma lw mb hp ln"/></div></div></a></div><div class="hh hi ez fb hj ln"><a href="https://github.com/tensorflow/tfjs-models" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hu fi z dy ls ea eb lt ed ef hs bi translated">张量流/tfjs-模型</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">TensorFlow.js的预训练模型。通过在GitHub上创建帐户，为tensorflow/tfjs-models开发做出贡献。</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">github.com</p></div></div><div class="lw l"><div class="ms l ly lz ma lw mb hp ln"/></div></div></a></div><p id="588b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是一个与我之前描述的流程密切相关的项目中可以找到的类的分解。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mt"><img src="../Images/f6a51fd38a9f6e6a1b4fa2467922df86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kh3FfmzLlym5EDEhoNzfDA.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">项目架构</figcaption></figure><ul class=""><li id="0312" class="ky kz ht is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated"><strong class="is hu"> DeviceListener: </strong>负责使用mDNS搜索摄像机，维护本地网络上的设备列表，并在设备在线或离线时发出事件。</li><li id="2e73" class="ky kz ht is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated"><strong class="is hu"> ImageClassifier: </strong>接收图像并使用Tensorflow检测物体。对于这个项目，我使用了<strong class="is hu"> CocoSSD </strong>预训练模型，它可以在<strong class="is hu"> tfjs-models </strong>包中获得。</li><li id="ad92" class="ky kz ht is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated"><strong class="is hu"> CloudIoTCoreGateway </strong>:处理与云物联网核心的所有通信和认证，并充当云物联网核心网关。</li><li id="4546" class="ky kz ht is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated"><strong class="is hu"> WebInterface </strong>:提供一个web服务器，它提供一个web UI和一个实时引擎，使用<a class="ae mp" href="http://socket.io" rel="noopener ugc nofollow" target="_blank"> socket.io </a>与浏览器同步数据。</li><li id="05a2" class="ky kz ht is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated"><strong class="is hu"> EdgeServer </strong>:使用上述所有类，从活动设备获取图像，将这些图像通过分类器，然后将数据发送到云物联网核心，并将数据提供给本地web接口。</li></ul><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mu"><img src="../Images/a518038caf55bb51ab961c15b15c8352.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SdUZzo48UC78rGOAxgPd8g.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">EdgeServer初始化。</figcaption></figure><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mv"><img src="../Images/709b13385396d83979103d801f4d18e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3SkysQOgsThoXdM--WvTsw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">EdgeServer主循环。</figcaption></figure><p id="3ced" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要运行服务器，只需使用NPM安装项目依赖项并运行服务器。要在Linux上运行，我们需要安装一些mDNS依赖项，以便能够在本地发现服务。</p><pre class="jp jq jr js fd mg mh mi mj aw mk bi"><span id="0b4b" class="jy jz ht mh b fi ml mm l mn mo"># Install libavahi to make mDNS work.<br/>sudo apt-get install libavahi-compat-libdnssd-dev</span><span id="42f7" class="jy jz ht mh b fi mw mm l mn mo"># Install dependencies and run the server<br/>npm install<br/>node index.js</span></pre><p id="a783" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，网关正在从摄像头收集数据，将处理后的数据发送到云，并且还拥有一个本地web UI，默认情况下运行在端口3000上。在web界面上，您可以访问以查看摄像机图像和分类结果。下面是它工作的一个例子。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es jo"><img src="../Images/ad89ddac698b2c5da3faf09ef74f4bb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hLntUmTJkDa2P3BLrFAmqw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">本地web界面</figcaption></figure><h2 id="1c7c" class="jy jz ht bd ka kb kc kd ke kf kg kh ki jb kj kk kl jf km kn ko jj kp kq kr ks bi translated"><strong class="ak">【额外】使用Tensorflow.js fork进行树莓Pi </strong></h2><p id="faaf" class="pw-post-body-paragraph iq ir ht is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">如果您正在您的计算机上使用这个服务器代码，您可以跳到下一节，因为这是特定于Raspberry Pi的。有一个额外的步骤要在Raspberry Pi上运行，因为ARM板没有预构建的本地库可用，只有Python绑定可用。实际上，如果没有这个，你也可以在Raspberry Pi上运行，但是性能不会和使用本地库一样。因此，我必须从源代码构建<strong class="is hu"> libtensorflow </strong>才能进行这些优化。</p><p id="9076" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我做了一个与Raspberry Pi兼容的tfjs-node 的分支，并且我已经向库所有者发送了一个Pull请求，但是在我写这篇文章的时候，它还没有被接受。</p><div class="hh hi ez fb hj ln"><a href="https://github.com/alvarowolfx/tfjs-node" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hu fi z dy ls ea eb lt ed ef hs bi translated">alvarowolfx/tfjs-节点</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">TensorFlow支持的JavaScript库，用于在Node.js. - alvarowolfx/tfjs-node上训练和部署ML模型</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">github.com</p></div></div><div class="lw l"><div class="mx l ly lz ma lw mb hp ln"/></div></div></a></div><p id="9cc9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您正在您的计算机上使用这个服务器代码，您可以跳到下一节，因为这是特定于Raspberry Pi的。要使用我的fork，您必须构建库并在本地使用。为此，只需遵循以下说明:</p><pre class="jp jq jr js fd mg mh mi mj aw mk bi"><span id="a4e1" class="jy jz ht mh b fi ml mm l mn mo"># Download source<br/>git clone <a class="ae mp" href="https://github.com/alvarowolfx/tfjs-node" rel="noopener ugc nofollow" target="_blank">https://github.com/alvarowolfx/tfjs-node</a><br/>cd tfjs-node<br/>git checkout add-armv7l-binding # branch with fix</span><span id="7adf" class="jy jz ht mh b fi mw mm l mn mo"># Install library dependencies<br/>sudo npm i -g yarn yalc<br/>npm install<br/>npm run publish-local</span><span id="7c29" class="jy jz ht mh b fi mw mm l mn mo"># Now enter the project folder<br/>yalc add <a class="ae mp" href="http://twitter.com/tensorflow/tfjs-node" rel="noopener ugc nofollow" target="_blank">@tensorflow/tfjs-node</a><br/>npm install</span></pre><p id="0231" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就这样，你现在可以在Raspberry Pi上运行网关代码了。</p><h2 id="07ec" class="jy jz ht bd ka kb kc kd ke kf kg kh ki jb kj kk kl jf km kn ko jj kp kq kr ks bi translated"><strong class="ak">使用云功能和在线web界面处理数据。</strong></h2><p id="3988" class="pw-post-body-paragraph iq ir ht is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">下一步是通过云物联网核心处理接收到的数据，在这种情况下，我们将使用Firebase云功能。</p><p id="cd59" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Firebase Cloud Function是一个在云中执行代码的无服务器解决方案。在这种特殊情况下，由于云物联网核心向PubSub主题发送数据，因此我们将部署一个对这些主题的新消息做出反应的功能，并将数据保存在Firebase数据库中。云函数的代码也可以在Github的<strong class="is hu">函数</strong>文件夹中找到。</p><div class="hh hi ez fb hj ln"><a href="https://github.com/alvarowolfx/gcloud-iot-edge-tensorflow" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab dw"><div class="lp ab lq cl cj lr"><h2 class="bd hu fi z dy ls ea eb lt ed ef hs bi translated">alvarowolfx/g cloud-IOT-edge-tensor flow</h2><div class="lu l"><h3 class="bd b fi z dy ls ea eb lt ed ef dx translated">使用边缘计算和计算机视觉的资产跟踪。-alvarowolfx/g cloud-IOT-edge-tensor flow</h3></div><div class="lv l"><p class="bd b fp z dy ls ea eb lt ed ef dx translated">github.com</p></div></div><div class="lw l"><div class="me l ly lz ma lw mb hp ln"/></div></div></a></div><p id="0f19" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">信不信由你，下面是用云函数处理输入数据的所有代码。基本上，我们听取云物联网核心上设置的<strong class="is hu">遥测</strong>和<strong class="is hu">状态</strong>主题，然后我们更新Firebase上的数据。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es my"><img src="../Images/346885c52e001d618ce87e99c85a6e86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ie8Er-9sqNVgp4ko9LnyLg.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">云函数的代码。</figcaption></figure><p id="7498" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">同样在我们项目的<strong class="is hu"> public </strong>文件夹中，你可以找到我们将要在<strong class="is hu"> Firebase Hosting </strong>上发布的web界面，并访问存储在Firebase中的数据。</p><p id="9e41" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了部署我们的功能和web界面，我们需要<em class="mz"> Firebase命令行工具。</em>为此，运行以下命令进行安装。</p><pre class="jp jq jr js fd mg mh mi mj aw mk bi"><span id="e2c3" class="jy jz ht mh b fi ml mm l mn mo">npm install -g firebase-tools</span></pre><p id="fb2e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，要用我们的项目配置firebase，部署功能和web界面，首先去<a class="ae mp" href="https://console.firebase.google.com/u/0/" rel="noopener ugc nofollow" target="_blank">console.firebase.google.com</a>，把你的谷歌云项目关联到Firebase上的一个新项目。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es na"><img src="../Images/33d626060019e57d9d3f007b9f62df00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cY-GxMB1E4BFCHsVeSC6sA.png"/></div></div></figure><p id="be4d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，在项目根文件夹中，遵循以下说明:</p><pre class="jp jq jr js fd mg mh mi mj aw mk bi"><span id="ac1e" class="jy jz ht mh b fi ml mm l mn mo"># Authenticate with Google and set up the command line tools.<br/>firebase login</span><span id="1b35" class="jy jz ht mh b fi mw mm l mn mo"># choose your firebase project name, to associate the local project <br/>firebase user --add</span><span id="3bb2" class="jy jz ht mh b fi mw mm l mn mo"># Install all the cloud functions dependencies<br/>cd functions &amp;&amp; npm install</span><span id="12c5" class="jy jz ht mh b fi mw mm l mn mo"># Deploy our functions and webapp<br/>firebase deploy</span></pre><p id="af33" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用部署的函数，您已经设置好接收和存储网关发送的所有数据。此外，web界面将在<a class="ae mp" href="https://YOUR_PROJECT_NAME.firebaseapp.com," rel="noopener ugc nofollow" target="_blank">https://YOUR _ PROJECT _ name . Firebase app . com上提供，</a>您可以访问并查看Firebase上的所有数据存储。在我的例子中，网址是https://gcloud-iot-edge.firebaseapp.com。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es jx"><img src="../Images/0abf0766beb6a1b3cc9e73158879d1ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sKHk4eZSMlnjSlRv5LwSTg.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">在线Web界面</figcaption></figure><p id="3235" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在这个项目的一切都准备好了。我们使用许多令人惊叹的工具创建了一个端到端的边缘计算解决方案，从Tensorflow的机器学习，到我们相机的固件，NodeJs的服务器端代码，以及为我们的最终用户制作的一些精美的web界面。</p><h2 id="f9f9" class="jy jz ht bd ka kb kc kd ke kf kg kh ki jb kj kk kl jf km kn ko jj kp kq kr ks bi translated"><strong class="ak">结论</strong></h2><p id="7fde" class="pw-post-body-paragraph iq ir ht is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">希望通过这篇文章，你在实践中对边缘计算项目所涉及的部分有了一个很好的了解。有很多不同的场景可以应用这些概念，也可以使用相机作为传感器。我添加了一些未来的想法来改善当前的项目，如果你有更多的想法，请告诉我。</p><ul class=""><li id="7405" class="ky kz ht is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated"><strong class="is hu">使用姿势检测模型</strong>:我们可以识别工作场所可能发生的事故，例如通过对图像进行分类，寻找摔倒的人。</li></ul><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nb"><img src="../Images/9061834fcebb3090ccaf92705c5a5147.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MVMJUEDZ5qnzf0q0NhUqYw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">基于张量流的姿态检测模型</figcaption></figure><ul class=""><li id="3f2d" class="ky kz ht is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated"><strong class="is hu">触发</strong>和<strong class="is hu">警报</strong>取决于何时在一个房间中发现一组班级。</li></ul><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nc"><img src="../Images/ea1721b202db3af7beaac4366eb0bfe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l4d5nqmBz8H9i4_JjVEqkw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">使用Firebase消息传送发送警报</figcaption></figure><ul class=""><li id="fb23" class="ky kz ht is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated"><strong class="is hu">训练定制模型:</strong>我们可以使用定制模型来识别建筑物上的特定人，例如，如果在给定的房间中发现未经授权的人，就发送警报。</li></ul><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nd"><img src="../Images/9f5fa18807f08633cd8effa527870d15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ribej43ezsygy2fv1Cgx5Q.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">使用迁移学习来训练自定义模型。</figcaption></figure><p id="057e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">参考文献:</strong></p><ul class=""><li id="5a63" class="ky kz ht is b it iu ix iy jb la jf lb jj lc jn ld le lf lg bi translated"><a class="ae mp" href="https://www.iotforall.com/edge-computing-benefits/" rel="noopener ugc nofollow" target="_blank">我们为什么需要边缘计算？|云计算|面向所有人的物联网</a></li><li id="c28f" class="ky kz ht is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated"><a class="ae mp" href="https://www.seeedstudio.com/ESP32-CAM-Development-Board-with-camer-p-3153.html" rel="noopener ugc nofollow" target="_blank">https://www . seeed studio . com/ESP32-CAM-Development-Board-with-camer-p-3153 . html</a></li><li id="2333" class="ky kz ht is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated"><a class="ae mp" href="https://www.cnx-software.com/2018/09/30/esp32-cam-esp32-camera-board/" rel="noopener ugc nofollow" target="_blank">https://www . cnx-software . com/2018/09/30/esp32-cam-esp32-camera-board/</a></li><li id="ca44" class="ky kz ht is b it lh ix li jb lj jf lk jj ll jn ld le lf lg bi translated"><a class="ae mp" href="http://jamesthom.as/blog/2018/08/07/machine-learning-in-node-dot-js-with-tensorflow-dot-js/" rel="noopener ugc nofollow" target="_blank">http://jamesthom . as/blog/2018/08/07/machine-learning-in-node-dot-js-with-tensor flow-dot-js/</a></li></ul><blockquote class="ne nf ng"><p id="abe4" class="iq ir mz is b it iu iv iw ix iy iz ja nh jc jd je ni jg jh ji nj jk jl jm jn hb bi translated">你喜欢这个帖子吗？所以不要忘了让你的拍手继续👏下面，推荐一下，分享给你的朋友。</p><p id="9359" class="iq ir mz is b it iu iv iw ix iy iz ja nh jc jd je ni jg jh ji nj jk jl jm jn hb bi translated">你用这个教程做了什么好事吗？显示在下面的评论部分。</p><p id="9590" class="iq ir mz is b it iu iv iw ix iy iz ja nh jc jd je ni jg jh ji nj jk jl jm jn hb bi translated">如果你有任何问题，请在评论中留言，我会尽力帮助你。</p></blockquote></div></div>    
</body>
</html>