<html>
<head>
<title>Choosing the right load balancer in Google Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Google Cloud中选择合适的负载平衡器</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/choosing-the-right-load-balancer-9ec909148a85?source=collection_archive---------1-----------------------#2020-04-14">https://medium.com/google-cloud/choosing-the-right-load-balancer-9ec909148a85?source=collection_archive---------1-----------------------#2020-04-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="711c" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在云中烹饪</h2></div><p id="d30a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">作者:<a class="ae jt" href="https://twitter.com/pvergadia" rel="noopener ugc nofollow" target="_blank">普里扬卡·韦尔加迪亚</a>，<a class="ae jt" href="https://twitter.com/swongful" rel="noopener ugc nofollow" target="_blank">王从希</a></p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es ju"><img src="../Images/c4bcbde49cdae22ad3e3f5c644ded927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*aogq0U1NY2JEfA9jWI4-8g.gif"/></div></div></figure><h1 id="617f" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">介绍</h1><p id="9c6d" class="pw-post-body-paragraph ix iy hi iz b ja ky ij jc jd kz im jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">“<a class="ae jt" rel="noopener" href="/@pvergadia/get-cooking-in-cloud-an-introduction-5b3b90de534e">在云中烹饪</a>”是一个博客和<a class="ae jt" href="https://www.youtube.com/playlist?list=PLIivdWyY5sqIOyeovvRapCjXCZykZMLAe" rel="noopener ugc nofollow" target="_blank">视频</a>系列，帮助企业和开发者在谷歌云上构建商业解决方案。在这个系列中，我们计划确定开发人员希望在Google cloud上构建的特定主题。一旦确定，我们就以此为主题制作一个迷你系列。</p><p id="58f8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个迷你系列中，我们将讨论Google云负载平衡。</p><ol class=""><li id="4ffd" class="ld le hi iz b ja jb jd je jg lf jk lg jo lh js li lj lk ll bi translated">选择正确的负载平衡器(本文)</li><li id="db5d" class="ld le hi iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><a class="ae jt" rel="noopener" href="/google-cloud/application-capacity-optimizations-with-global-load-balancing-e0aa079d2c25">通过全局负载平衡优化应用容量</a></li><li id="e559" class="ld le hi iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><a class="ae jt" rel="noopener" href="/google-cloud/capacity-management-with-load-balancing-32bd22a716a7">负载平衡的容量管理</a></li><li id="732b" class="ld le hi iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><a class="ae jt" rel="noopener" href="/google-cloud/container-load-balancing-on-google-kubernetes-engine-gke-4cbfaa80a6f6">GKE网络端点组的负载均衡</a></li></ol><p id="7a8b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我们将介绍Google云平台中不同的负载平衡选项。使用一个用例示例，我们将帮助您定义选择正确的负载平衡选项的过程。</p><h1 id="4699" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">看看这个视频</h1><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="lr ls l"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">视频—选择合适的负载平衡器</figcaption></figure><h1 id="d10b" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">你会学到什么</h1><ul class=""><li id="5209" class="ld le hi iz b ja ky jd kz jg lx jk ly jo lz js ma lj lk ll bi translated">什么是负载平衡？</li><li id="e253" class="ld le hi iz b ja lm jd ln jg lo jk lp jo lq js ma lj lk ll bi translated">为什么负载平衡很重要？</li><li id="a867" class="ld le hi iz b ja lm jd ln jg lo jk lp jo lq js ma lj lk ll bi translated">不同的负载平衡选项</li><li id="652a" class="ld le hi iz b ja lm jd ln jg lo jk lp jo lq js ma lj lk ll bi translated">如何选择正确的负载平衡选项</li></ul><h1 id="6aae" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">背景</h1><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es mb"><img src="../Images/0ff1ee4e1ecc791d407e6baabbd74666.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/1*LfLwJc7CP9tDemqJqfZymA.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">beyond Treat——您的素食狗零食一站式商店！</figcaption></figure><p id="e8b9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">想象你负责一个复杂的网站，<strong class="iz hj"> Beyond Treat </strong>(你的素食狗零食一站式商店)。而且是网上热播！它继续面临着高流量，你不确定你的网站后端能否处理来自世界各地的流量。您知道您需要使用负载平衡器，但是选项令人困惑。很难确切地知道如何确定一个满足您需求的负载平衡体系结构，并找出您需要的先决条件，以获得最佳性能，同时又不会对您的钱包造成太大影响。</p><h1 id="1fa7" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">什么是负载平衡？</h1><p id="d86e" class="pw-post-body-paragraph ix iy hi iz b ja ky ij jc jd kz im jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">首先，您需要知道什么是负载平衡，以及为什么它对您的应用程序的持久成功如此重要。</p><blockquote class="mc"><p id="da4d" class="md me hi bd mf mg mh mi mj mk ml js dx translated">负载平衡是在您的服务器网络中分配流量的过程，以确保系统不会不堪重负，并且所有请求都能轻松高效地得到处理。</p></blockquote><p id="b35d" class="pw-post-body-paragraph ix iy hi iz b ja mm ij jc jd mn im jf jg mo ji jj jk mp jm jn jo mq jq jr js hb bi translated">现代高流量网站服务于来自用户或客户端的数十万(如果不是数百万的话)并发请求，并以快速可靠的方式返回正确的文本、图像、视频或应用程序数据。你可能都有过这样的经历:访问你最喜欢的网站，却要等待很长时间，出现连接超时错误，或者图像和视频缓冲。很多时候，这是因为网站后端无法经济高效地扩展以满足如此高的流量。</p><p id="ef41" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里合乎逻辑的答案是添加更多的后端服务器来帮助服务流量。但下一个问题是，如何根据容量和健康状况将流量分配给这些后端服务器？</p><p id="5c6c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是负载平衡引起轰动的地方。负载平衡是在您的服务器网络中分配流量的过程，以确保系统不会不堪重负，并且所有请求都能轻松高效地得到处理。</p><h1 id="aa95" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">为什么负载平衡很重要？</h1><p id="1703" class="pw-post-body-paragraph ix iy hi iz b ja ky ij jc jd kz im jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">负载平衡之所以重要，有很多原因。负载平衡器允许您:</p><ul class=""><li id="73a8" class="ld le hi iz b ja jb jd je jg lf jk lg jo lh js ma lj lk ll bi translated">在单个或多个区域中分布负载平衡的资源</li><li id="c1ac" class="ld le hi iz b ja lm jd ln jg lo jk lp jo lq js ma lj lk ll bi translated">满足您的高可用性要求</li><li id="a608" class="ld le hi iz b ja lm jd ln jg lo jk lp jo lq js ma lj lk ll bi translated">通过智能自动扩展来扩展或缩减您的资源</li><li id="e625" class="ld le hi iz b ja lm jd ln jg lo jk lp jo lq js ma lj lk ll bi translated">并使用云内容交付网络(CDN)实现最佳内容交付</li></ul><p id="7171" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">借助Google Cloud负载平衡，您可以在一个每秒可以响应超过100万次查询的系统上，尽可能靠近您的用户提供内容！</p><h1 id="4be6" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">不同的负载平衡选项</h1><p id="1a42" class="pw-post-body-paragraph ix iy hi iz b ja ky ij jc jd kz im jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">要决定哪个负载平衡器最适合您的实现，您需要考虑您是否需要</p><ol class=""><li id="4ec8" class="ld le hi iz b ja jb jd je jg lf jk lg jo lh js li lj lk ll bi translated"><strong class="iz hj">全局</strong>或<strong class="iz hj">区域</strong>负载均衡。全局负载平衡意味着后端端点位于多个区域。区域负载平衡意味着后端端点位于单个区域。</li></ol><p id="abaa" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.<strong class="iz hj">外部</strong>或i <strong class="iz hj">内部</strong>负载均衡</p><p id="4a52" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.您服务的是哪种<strong class="iz hj">流量</strong>？HTTP，HTTPS，SSL，TCP，UDP等。</p><h1 id="b639" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">如何决定使用哪个负载均衡器？</h1><p id="9234" class="pw-post-body-paragraph ix iy hi iz b ja ky ij jc jd kz im jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">很明显，对于Beyond Treat，有许多负载平衡选项，这取决于他们在架构中的确切位置需要负载平衡器。</p><p id="f651" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">他们将使用<strong class="iz hj"> <em class="mr">外部</em> </strong>负载平衡器将来自互联网的流量分配到他们的谷歌云网络，并使用<strong class="iz hj"> <em class="mr">内部</em> </strong>负载平衡器在他们的GCP网络内分配流量。</p><h2 id="7302" class="ms kh hi bd ki mt mu mv km mw mx my kq jg mz na ks jk nb nc ku jo nd ne kw nf bi translated">外部负载平衡器</h2><p id="7bcb" class="pw-post-body-paragraph ix iy hi iz b ja ky ij jc jd kz im jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">外部负载平衡包括四个选项:</p><ol class=""><li id="6693" class="ld le hi iz b ja jb jd je jg lf jk lg jo lh js li lj lk ll bi translated"><strong class="iz hj"> HTTP(S)负载平衡</strong>对于HTTP或HTTPS流量，</li><li id="6c02" class="ld le hi iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><strong class="iz hj"> TCP代理</strong>,用于80和8080以外端口的TCP流量，无SSL卸载</li><li id="cbc8" class="ld le hi iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><strong class="iz hj"> SSL代理</strong>用于80或8080以外端口上的SSL卸载。</li><li id="a14d" class="ld le hi iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><strong class="iz hj">TCP/UDP流量的网络负载平衡</strong>。</li></ol><h2 id="5630" class="ms kh hi bd ki mt mu mv km mw mx my kq jg mz na ks jk nb nc ku jo nd ne kw nf bi translated"><strong class="ak">网络负载均衡器</strong></h2><p id="1f6b" class="pw-post-body-paragraph ix iy hi iz b ja ky ij jc jd kz im jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">当<strong class="iz hj">全球</strong> HTTP(S)负载平衡器用于第7层流量，并使用谷歌网络边缘的谷歌前端引擎构建时，<strong class="iz hj">区域</strong>网络负载平衡器用于第4层流量，并使用<em class="mr">磁悬浮</em>构建。</p><blockquote class="mc"><p id="3afb" class="md me hi bd mf mg mh mi mj mk ml js dx translated">网络负载平衡器用于第4层流量</p></blockquote><p id="d33f" class="pw-post-body-paragraph ix iy hi iz b ja mm ij jc jd mn im jf jg mo ji jj jk mp jm jn jo mq jq jr js hb bi translated">磁悬浮是什么？</p><blockquote class="ng nh ni"><p id="3782" class="ix iy mr iz b ja jb ij jc jd je im jf nj jh ji jj nk jl jm jn nl jp jq jr js hb bi translated">谷歌在2008年建立了Maglev，以平衡所有进入数据中心的流量，并将流量分配给网络边缘的前端引擎。流量被分发到一组区域性后端实例。</p></blockquote><p id="d125" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Maglev打破了传统的负载平衡器，因为它是基于软件的，并在主动-主动横向扩展架构中运行。Maglev将流量均匀地分布在数百个后端上，并将意外故障对面向连接的协议的负面影响降至最低。它非常适合基于L4的轻量级负载平衡，在这种情况下，您希望将客户端IP地址一直保留到后端实例，并在这些实例上执行TLS终止。</p><h2 id="8d46" class="ms kh hi bd ki mt mu mv km mw mx my kq jg mz na ks jk nb nc ku jo nd ne kw nf bi translated">HTTP(S)负载平衡器</h2><blockquote class="mc"><p id="a838" class="md me hi bd mf mg mh mi mj mk ml js dx translated">第7层流量的全局HTTP(S)负载平衡</p></blockquote><p id="61ee" class="pw-post-body-paragraph ix iy hi iz b ja mm ij jc jd mn im jf jg mo ji jj jk mp jm jn jo mq jq jr js hb bi translated">谷歌将负载平衡推到前端服务器的边缘网络，而不是使用传统的基于DNS的方法。因此，<strong class="iz hj">全局</strong>负载平衡能力可以在单个任播虚拟IPv4或IPv6地址之后。这意味着您可以在多个区域部署容量，而不必修改DNS条目或为新区域添加新的负载平衡器IP地址。因此，很明显，使用<a class="ae jt" href="https://cloud.google.com/load-balancing/docs/https" rel="noopener ugc nofollow" target="_blank">全局HTTP(S)负载平衡</a>，您将获得跨区域故障转移和溢出！</p><blockquote class="mc"><p id="4801" class="md me hi bd mf mg mh mi mj mk ml js dx translated">通过全局HTTP(S)负载平衡，您可以实现跨区域故障转移和溢出！</p></blockquote><p id="924d" class="pw-post-body-paragraph ix iy hi iz b ja mm ij jc jd mn im jf jg mo ji jj jk mp jm jn jo mq jq jr js hb bi translated">在最接近终端用户的区域中的实例出现故障或缺乏容量的情况下，分发算法自动将流量定向到具有可用容量的下一个最近的实例。我们将在接下来的两篇文章中对此进行更多的讨论。</p><h2 id="aa5e" class="ms kh hi bd ki mt mu mv km mw mx my kq jg mz na ks jk nb nc ku jo nd ne kw nf bi translated">基于代理的负载平衡器(TCP和SSL)</h2><p id="4541" class="pw-post-body-paragraph ix iy hi iz b ja ky ij jc jd kz im jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">谷歌云还为TCP和SSL流量提供基于代理的负载平衡器，它们使用相同的全球分布式基础设施。</p><blockquote class="mc"><p id="7731" class="md me hi bd mf mg mh mi mj mk ml js dx translated">当您处理TCP流量并且不需要SSL卸载时，请使用TCP代理负载平衡器。</p></blockquote><p id="ec5c" class="pw-post-body-paragraph ix iy hi iz b ja mm ij jc jd mn im jf jg mo ji jj jk mp jm jn jo mq jq jr js hb bi translated">一般来说，使用它们的决定取决于您是否需要SSL卸载。你可以在下面的链接中找到更多信息。</p><blockquote class="mc"><p id="80a7" class="md me hi bd mf mg mh mi mj mk ml js dx translated">当您处理TCP流量并需要SSL卸载时，请使用SSL代理负载平衡器。</p></blockquote><p id="d1e9" class="pw-post-body-paragraph ix iy hi iz b ja mm ij jc jd mn im jf jg mo ji jj jk mp jm jn jo mq jq jr js hb bi translated">现在，让我们回到超越治疗。在Beyond Treat的例子中，我们只接收HTTP和HTTPS流量，所以他们会选择HTTPS负载均衡器。但是，像大多数公司一样，该网站也有私有工作负载，如应用服务器，需要保护免受公共互联网的影响。这些服务需要在只能由内部实例访问的私有虚拟IP背后扩展和增长。为此，他们的最佳选择是基于谷歌Andromeda网络虚拟化堆栈的<strong class="iz hj">区域</strong>第7层<strong class="iz hj">内部</strong>负载平衡。</p><h2 id="3a6c" class="ms kh hi bd ki mt mu mv km mw mx my kq jg mz na ks jk nb nc ku jo nd ne kw nf bi translated">内部负载平衡器</h2><p id="d7a6" class="pw-post-body-paragraph ix iy hi iz b ja ky ij jc jd kz im jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">与HTTP(S)负载均衡器和网络负载均衡器类似，<a class="ae jt" href="https://cloud.google.com/load-balancing/docs/l7-internal" rel="noopener ugc nofollow" target="_blank">内部L7负载均衡器</a>既不是硬件设备，也不是基于实例的解决方案，并且可以支持您所需的每秒连接数量，因为在您的客户端和后端实例之间的路径上没有负载均衡器。</p><blockquote class="mc"><p id="557d" class="md me hi bd mf mg mh mi mj mk ml js dx translated">内部第7层负载平衡器每秒可以支持您需要的任意数量的连接！</p></blockquote><p id="0097" class="pw-post-body-paragraph ix iy hi iz b ja mm ij jc jd mn im jf jg mo ji jj jk mp jm jn jo mq jq jr js hb bi translated">在接下来的几篇文章中，我们将跟踪Beyond Treat的发展，甚至会经历不可预测的流量高峰…比如当国际狗日和big bone treat订单增加时😃。这使得他们的网站成为解释你所拥有的所有负载平衡选项的理想候选。但是当然，您可以将这些文章中描述的原则应用于各种工作负载。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es nm"><img src="../Images/0a9dd51108f69c284636194e1102c436.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TTUArfpyYhGvsoLJaLrzaA.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">Beyond Treats体系结构看起来像这样，内部负载平衡器用于内部流量，外部全局HTTPS负载平衡器用于传入流量</figcaption></figure><h1 id="b419" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">结论</h1><p id="9a85" class="pw-post-body-paragraph ix iy hi iz b ja ky ij jc jd kz im jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">好了，你有它，负载平衡解构！敬请关注<a class="ae jt" rel="noopener" href="/@pvergadia/get-cooking-in-cloud-an-introduction-5b3b90de534e">云烹饪系列</a>中的更多文章，并查看下面的参考资料了解更多细节。</p><h1 id="e4fd" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">后续步骤和参考:</h1><ul class=""><li id="ef1e" class="ld le hi iz b ja ky jd kz jg lx jk ly jo lz js ma lj lk ll bi translated">在<a class="ae jt" href="https://medium.com/google-cloud" rel="noopener">谷歌云平台媒体</a>上关注这个博客系列。</li><li id="563e" class="ld le hi iz b ja lm jd ln jg lo jk lp jo lq js ma lj lk ll bi translated">参考:<a class="ae jt" href="https://cloud.google.com/load-balancing/docs/choosing-load-balancer" rel="noopener ugc nofollow" target="_blank">选择负载均衡器</a></li><li id="353a" class="ld le hi iz b ja lm jd ln jg lo jk lp jo lq js ma lj lk ll bi translated">关注<a class="ae jt" href="https://www.youtube.com/watch?v=pxp7uYUjH_M" rel="noopener ugc nofollow" target="_blank">获取云端烹饪</a>视频系列，订阅谷歌云平台YouTube频道</li><li id="84f6" class="ld le hi iz b ja lm jd ln jg lo jk lp jo lq js ma lj lk ll bi translated">想要更多的故事？在<a class="ae jt" rel="noopener" href="/@pvergadia/">媒体</a>和<a class="ae jt" href="https://twitter.com/pvergadia" rel="noopener ugc nofollow" target="_blank">推特</a>上关注我。</li><li id="e089" class="ld le hi iz b ja lm jd ln jg lo jk lp jo lq js ma lj lk ll bi translated">请和我们一起欣赏这部迷你剧，并了解更多类似的谷歌云解决方案:)</li></ul></div></div>    
</body>
</html>