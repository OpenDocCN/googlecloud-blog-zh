# 谷歌云生产指南

> 原文：<https://medium.com/google-cloud/production-guideline-9d5d10c8f1e?source=collection_archive---------0----------------------->

在过去的几年里，我发现自己给许多使用谷歌云的公司提供了一些建议，告诉他们在进入生产阶段时需要考虑的基本问题。基于生产就绪的良好实践和通常被破坏的步骤，我整理了一个在生产之前要完成的行动列表。尽管这个列表特别提到了 Google Cloud，但是它在 Google Cloud 之外仍然是有用和适用的。

## 设计和开发

*   拥有可重现的构建，您的构建不应该需要访问外部服务，也不应该受到外部系统中断的影响。
*   在设计时为您的服务定义和设置 SLO。
*   记录您所依赖的外部服务的可用性预期。
*   通过不依赖单一全局资源来避免单点故障。当资源不可用时，复制资源或具有适当的后备(例如，硬编码值)。

## 结构管理

*   静态、小型和非机密配置可以是命令行标志。对于其他所有事情，使用配置交付服务。
*   在配置系统不可用的情况下，动态配置应该有一个合理的后备。
*   开发环境配置不应该从生产配置继承。这可能导致从开发访问生产服务，并可能导致隐私问题和数据泄漏。
*   记录可以动态配置的内容，并解释在配置交付系统不可用时的回退行为。

## 发布管理

*   记录关于您的发布过程的所有细节。记录发布如何影响 SLO(例如，由于缓存未命中导致的临时更高延迟)。
*   记录你的金丝雀释放过程。
*   有一个金丝雀分析计划和设置机制，以自动恢复金丝雀，如果可能的话。
*   确保回滚可以使用与推出相同的过程。

## 可观察性

*   确保从二进制文件中收集并导出 SLO 所需的指标集合。
*   确保客户端和服务器端的可观测性数据是可以区分的。这对于调试生产中的问题非常重要。
*   调整警报以减少工作量，例如删除由常规事件触发的警报。
*   如果您使用 Stackdriver，请在仪表板中包含 GCP 平台指标。为您的 GCP 依赖项设置警报。
*   总是传播传入的跟踪上下文。请参见 gRPC 的`grpc-trace-bin`元数据关键字，HTTP 请求的`X-Cloud-Trace-Context`报头。即使您没有参与跟踪，这也将允许 GCP 调试生产问题。
*   启用 Stackdriver Profiler 以优化 CPU 使用。

## 安全和保护

*   确保所有外部请求都已加密。
*   确保您的生产项目具有正确的 IAM 配置。
*   使用项目来完全隔离资源。
*   使用项目中的网络来隔离虚拟机实例组。
*   使用云 VPN 安全地连接远程网络。
*   记录和监控用户数据访问。确保记录和审核所有用户数据访问。
*   确保调试端点受到 ACL 的限制。
*   净化用户输入。对用户输入有负载大小限制。
*   确保您的服务可以有选择地阻止每个用户的传入流量。这允许在不影响其他用户的情况下阻止滥用情况。
*   避免触发大量内部扇出的外部端点。

## 容量规划

*   记录您的服务如何扩展。示例:用户数量、传入负载的大小、传入消息的数量。
*   记录服务的资源需求。示例:专用虚拟机实例的数量、扳手实例的数量、GPU 或 TPU 等专用硬件。
*   记录资源限制:资源类型、区域等。
*   记录配额限制以创建新资源。例如，如果您通过 API 创建新的实例，请记录 GCE API 的速率限制。
*   在可能的情况下，考虑对性能回归进行负载测试。