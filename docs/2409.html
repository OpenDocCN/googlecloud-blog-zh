<html>
<head>
<title>GCP Cloud Composer — Save Development Time</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GCP云编辑器——节省开发时间</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/gcp-cloud-composer-save-development-time-3738e0391808?source=collection_archive---------1-----------------------#2022-10-09">https://medium.com/google-cloud/gcp-cloud-composer-save-development-time-3738e0391808?source=collection_archive---------1-----------------------#2022-10-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3b1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">一般来说，在Google cloud composer(Managed air flow)上工作的新开发人员遵循的一种常见方法是使用</em> <strong class="ih hj"> <em class="jd">迭代试凑法</em> </strong> <em class="jd">进行开发，直到</em> <strong class="ih hj"> <em class="jd"> DAG导入错误</em> </strong> <em class="jd">消失。</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/b3c77e165f9322c9bdf20e02cbc97b76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zc33U35K5-0WecK_7v4bnQ.png"/></div></div></figure><p id="dfcc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是由于不正确的库导入导致的DAG导入错误的示例</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jq"><img src="../Images/38d720bef2eacc0cfd2f12edf265e011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zeCof-zwBmTh3Y6J.png"/></div></div></figure></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><blockquote class="jy jz ka"><p id="2b60" class="if ig jd ih b ii ij ik il im in io ip kb ir is it kc iv iw ix kd iz ja jb jc hb bi translated">为什么这不是一个好方法？<br/> 1。它可以很容易地创建一个<strong class="ih hj">无休止的循环，直到DAG开始工作<br/> 2。开发时间</strong>的<strong class="ih hj">量大幅度增加<br/> 3。这个过程<strong class="ih hj">适得其反</strong></strong></p></blockquote><p id="559d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通常在具有较低规格的c组件环境和许多开发用户中，调度程序需要花费更长的时间来解析DAG，这又增加了周转时间</p></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><h2 id="ad42" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated">利用独立气流</h2><p id="2a25" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">当您从pip发行版安装airflow作为示例时，它会设置一个本地airflow目录和一个轻量级服务器以供使用</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es le"><img src="../Images/9dcfb3c248632801aeebc124273feaea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aqeb8UiV62NC09cnFxa3zg.png"/></div></div></figure><p id="fc4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">气流配置文件</strong>具有气流的配置属性。下面是<strong class="ih hj"> dags_folder </strong>的本地unix路径配置</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lf"><img src="../Images/ecdf4e8c426e8e1b6f2dc162eb7921b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*92snT-tQ6FZ5CbnZ08grcQ.png"/></div></div></figure><p id="c91e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要启动<strong class="ih hj">独立服务器</strong>，只需运行命令下的<strong class="ih hj">，这将启动在<strong class="ih hj">端口8080 </strong>上运行的本地气流服务器。</strong></p><pre class="jf jg jh ji fd lg lh li lj aw lk bi"><span id="11fe" class="ke kf hi lh b fi ll lm l ln lo">airflow standalone</span></pre><p id="faac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">默认用户将是<strong class="ih hj"> admin </strong>，密码将出现在<strong class="ih hj">standalone _ admin _ password . txt</strong>中，如上图截图</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lp"><img src="../Images/486d5a1c86e35f524e60ed38dab9e33d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k05kylYeNgEV3hr_8m_zvg.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">气流独立用户界面</figcaption></figure><p id="8a88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简单地创建所需的<strong class="ih hj"> DAGs </strong>并将其放入<strong class="ih hj"> dags_folder </strong>中，如上所述</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lu"><img src="../Images/b185725206d72adea48347703566568d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C7yD2lVI-7ZZZIjYlLKwow.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">简单DAG示例— Bash操作符模板— simple_dag.py</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lv"><img src="../Images/194ab719fd90963a051b74abeb6bd2ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*q1zh1p-UpcAQz7B26YCbYw.png"/></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">Bash模板文件</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lw"><img src="../Images/95da37e353b70291fbfbc830e53cda61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5WkavMeq9BK2Z-pIjJnmtw.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">在局部气流上执行</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lx"><img src="../Images/126c3aa59bd29d8779a71c5e42feba7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cZm0Sll07EGSvXHvmnj6CQ.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">任务的呈现模板</figcaption></figure><p id="db1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这可能是一种更快的方法，可以让事情向前发展，加快试凑法的速度。</p><p id="c5a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于airflow独立版是轻量级的，由一个用户使用，DAG解析时间相对较快。</p></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><blockquote class="jy jz ka"><p id="6ac4" class="if ig jd ih b ii ij ik il im in io ip kb ir is it kc iv iw ix kd iz ja jb jc hb bi translated">在DAG被上传到composer bucket之前，是否可以做更多类似于编译java代码并获得编译时错误的事情？</p></blockquote></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><h2 id="7fff" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated">将DAG作为Python文件运行</h2><p id="f94e" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">将DAG文件作为python可执行文件运行</p><pre class="jf jg jh ji fd lg lh li lj aw lk bi"><span id="325a" class="ke kf hi lh b fi ll lm l ln lo">python simple_dag.py</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ly"><img src="../Images/a21ea5ad70453663270dfc4cdcb3ed2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tY5ZP2qBenrfi0tmWwksTQ.png"/></div></div></figure><p id="2a8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">语法或声明中的任何错误都会立即被发现。</p><p id="4aa1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于Composer环境，DAG文件可以添加到除/<strong class="ih hj">DAGs/</strong>like/<strong class="ih hj">data/</strong>之外的不同文件夹，并且可以运行以下命令来捕获语法错误</p><pre class="jf jg jh ji fd lg lh li lj aw lk bi"><span id="2ff1" class="ke kf hi lh b fi ll lm l ln lo">gcloud composer environments run &lt;environment&gt; dags list -- -subdir &lt;home/airflow/gcs/data/&gt;</span></pre></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><h2 id="002e" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated">列出Dag的导入错误</h2><p id="8014" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">为了在不将Dag上传到Dag文件夹的情况下快速测试Dag，可以运行以下命令来捕获任何语法问题</p><pre class="jf jg jh ji fd lg lh li lj aw lk bi"><span id="9359" class="ke kf hi lh b fi ll lm l ln lo">airflow dags list-import-errors -- -subdir &lt;folder other than DAGs folder&gt;</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lz"><img src="../Images/9a36d2220b25fd041304b0c050204dc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qb9ponKkhfC2zzCj1kPMoQ.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">列表-导入-错误输出</figcaption></figure><p id="a41a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述命令也可以在composer环境中以类似的语法执行</p><p id="4230" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">reference—<a class="ae ma" href="https://cloud.google.com/sdk/gcloud/reference/composer/environments/run" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/SDK/g cloud/reference/composer/environments/run</a></p></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><h2 id="db2d" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated">测试DAG运行</h2><p id="9bc7" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">运行以下命令有助于验证提供的文件夹中的DAG并执行提到的DAG。</p><pre class="jf jg jh ji fd lg lh li lj aw lk bi"><span id="5f0d" class="ke kf hi lh b fi ll lm l ln lo">airflow dags test simple_templated_bash_dag_1 2022–10–09 -- -subdir /home/murlik/gcp-code-repo/composer</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mb"><img src="../Images/952ce04d4aee626bb8302abbcf1e96d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8MADlx42mGEEIN83twm5QA.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">DAG的执行日志</figcaption></figure></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><h2 id="c837" class="ke kf hi bd kg kh ki kj kk kl km kn ko iq kp kq kr iu ks kt ku iy kv kw kx ky bi translated">测试特定任务实例</h2><p id="a201" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">运行<strong class="ih hj"> airflow task test </strong>命令还可以提供一种快速测试任务实例执行的方法，而无需在composer环境中触发</p><pre class="jf jg jh ji fd lg lh li lj aw lk bi"><span id="40d9" class="ke kf hi lh b fi ll lm l ln lo">airflow tasks test simple_templated_bash_dag bash_task 2022–10–09</span></pre><p id="f9e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述命令也可以传递<strong class="ih hj"> —细分器</strong>参数</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mc"><img src="../Images/e7b19e1b1e29dcbea001ed5caddf3386.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HvR0Pj7snxLHFeWvrugMvA.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx translated">气流任务实例的快速测试</figcaption></figure><p id="2479" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该命令也可以在composer中执行，如下所示</p><pre class="jf jg jh ji fd lg lh li lj aw lk bi"><span id="5a13" class="ke kf hi lh b fi ll lm l ln lo">gcloud composer environments run &lt;environment name&gt; tasks test -- &lt;parameters&gt;</span></pre></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><p id="5f69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用上述技术，可以节省宝贵的时间，加快开发过程。</p><p id="c791" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，Airflow 1和air flow 2之间的命令存在一些差异，请查看文档以了解与版本相关的命令语法(下面参考资料中的链接)</p><p id="2941" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一定要试一下</p></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><p id="bb63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考资料</strong>:<a class="ae ma" href="https://cloud.google.com/sdk/gcloud/reference/composer/environments/run" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/SDK/g cloud/reference/composer/environments/run</a><br/><a class="ae ma" href="https://airflow.apache.org/docs/apache-airflow/stable/cli-and-env-variables-ref.html" rel="noopener ugc nofollow" target="_blank">https://air flow . Apache . org/docs/Apache-air flow/stable/CLI-and-env-variables-ref . html</a><br/><a class="ae ma" href="https://airflow.apache.org/docs/apache-airflow/stable/start.html" rel="noopener ugc nofollow" target="_blank">https://air flow . Apache . org/docs/Apache-air flow/stable/start . html</a></p></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><p id="2195" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">链接手柄—<a class="ae ma" href="https://www.linkedin.com/in/murli-krishnan-a1319842/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/murli-krishnan-a1319842/</a></p></div></div>    
</body>
</html>