# 利用预算保护您的云支出

> 原文：<https://medium.com/google-cloud/budgets-setting-up-a-budget-d219beb83d29?source=collection_archive---------1----------------------->

TL；灾难恢复—预算和警报可能是掌控谷歌云成本的第一步。如果你在乎钱，你绝对应该建立一个预算。在这篇文章中，我分解了一个预算，并展示了如何建立一个预算。

![](img/4ad9a54ad209f5b766b6c9bc170bf0b8.png)

*预算和警报非常适合 FinOps 生命周期的通知阶段，以实现可见性*

云之所以伟大，是因为它非常容易启动虚拟机，使用托管数据仓库，甚至创建一个全局复制的关系数据库(这仍然让我感到惊讶)。但是，虽然你或你的工程团队可能更乐意创造和摆弄这些资源，但它们需要钱，必须有人来买单。让我们再看一看预算是由什么组成的，以及如何建立预算(如果你只是想知道如何做，请随意跳过)。

# 你所说的“预算”是什么？

预算是控制成本的第一个也是最简单的方法。有了所有可能在云上花钱的方式，你会想要确保你可以跟踪它。一旦预算到位，您就可以自由启动实验和生产功能，更好地了解正在发生的事情。

它们实际上不会限制你的使用量(我们将在另一篇文章中讨论如何做到这一点)，但它们会根据你的成本发送警报。现在，关键的想法是，当您达到**范围**中资源的成本**量**的任何**阈值**时，**预算**会发送**警报**。我们来分析一下。

**预算**

这就是我们正在讨论的，它以一个名称(以及一个惟一的 ID)开始。您可以(而且肯定应该)创建多个预算，并且预算与一个计费帐户相关联，该帐户是您所有云成本的去向。如果您使用多个计费帐户(提示:每个组织尝试合并到一个计费帐户)，您可以在每个帐户上设置预算。你也可以自动设置这些，而不是手动设置，但是现在让我们坚持基础知识，在另一篇文章中再来讨论。

**金额**

每个预算还可以有一个金额，该金额将以您的帐单帐户的货币表示。你可以指定一个确切的金额，比如 1000 美元，或者选择“上个月的花费”。如果您选择“上个月”选项，金额将根据您上个月的消费自动更新。此外，如果您希望根据点数计算使用量(使用折扣、促销等),您可以选择将点数包括在您的金额中。)还是没有。我们还将在以后的文章中讨论没有金额的预算。

**阈值**

每个预算可以有多个阈值，每个阈值实质上是预算金额的一个百分比(或者您可以直接指定金额，两种方式都一样)。因此，1000 美元预算的 50%阈值将在 500 美元处触发。因为你可以增加倍数，你可以设置 25%、50%、75%和 100%的阈值，以确保你一个月的支出都在正轨上。

![](img/05f1c2b746025d7dc124cda21ca3b274.png)

*1000 美元预算的一些阈值示例*

每个阈值也可以是实际的或预测的。简单地说，实际阈值是基于实际成本的。也就是说，当你花了 1000 美元时，你将达到 1000 美元预算的 100%。另一方面，预测是指谷歌云(使用科学、机器学习，也许还有一些魔法)估计到月底你会花那么多钱。比如，如果你在 1000 美元的预算上设置了 100%的预测阈值，那么一旦谷歌云**预测到**你这个月的花费将是 1000 美元，警报就会触发。预测阈值有助于了解您的成本趋势并获得早期警报。

**警报**

默认情况下，警报是发送给该计费帐户的所有计费帐户管理员和计费帐户用户的电子邮件。电子邮件提醒很简单，但是描述性的，给你确切的信息，你需要知道发生了什么。

![](img/307eef6e4d0f2e3778c7c45fccc6c1a1.png)

*一封实际预算电子邮件，尽管我更改了账单账户 ID*

首先，我们可以看到计费帐户是 Billing-Reports-Demo，我们有 ID 以备需要。然后是预算金额和预算命中率，1000 美元预算的 50%。最后，我们知道这是 7 月份的警报，该警报是在 7 月 8 日发出的。

注意:花些时间为你的预算想一个好的命名方案；一个为将要收到它们的人工作的人。警报包含关键信息，但是如果预算名称不是描述性的，那么追踪成本的来源可能会更加困难。

如果我在整个 7 月份只预计花费 1000 美元，然后在 8 天后收到这个警告，很有可能会发生一些意外的费用。还好我收到了警报，这样我就能知道发生了什么事！除了发送电子邮件，我们还可以做更多的事情，我将在接下来的帖子中介绍。

**范围**

每个预算都有一个关联的范围，默认情况下，这是整个计费帐户。这将包括所有项目和谷歌云服务附属于该计费帐户。为了获得更细的粒度，您可以指定项目、产品或标签。对于项目和产品，您可以选择包含某些项目和产品，因此您可能有一个涵盖所有生产项目的预算，还有一个专门针对数据科学项目的 BigQuery 成本的预算。你可能听说过[构建你的谷歌云资源以匹配你的实际组织](https://www.youtube.com/watch?v=NOOhDq1JyIM)是多么重要，当你看着建立预算时，这是相当明显的！

![](img/ee5449bb27f5eddb169508cfb0368ad0.png)

*一个合理的(和简化的)例子，说明你如何像你的(可能不太简单的)组织一样组织你的谷歌云资源*

你还可以将预算限制在[资源标签](https://cloud.google.com/compute/docs/labeling-resources)，这是组织资源的另一个重要部分。目前这仅限于一个标签，但这是一个为任何工作设定预算的好方法，比如你可以给你所有的资源标上“env:production”或“team:infra”。除此之外，您还可以将范围扩大到子帐户，这是针对经销商的。

# 制定预算

好了，有了所有的背景信息，建立一个预算是超级快的！首先，你需要是一个账单账户管理员(或者有一个自定义角色，拥有适当的 billing.budget [权限](https://cloud.google.com/iam/docs/understanding-roles#billing-roles))。然后你只需要在控制台中我最喜欢的地方，账单页面，选择“预算&提醒”。

![](img/41e36582d21d273327ffbbbc25a04df3.png)

*主机的计费部分是我的最爱是不是很奇怪？我觉得那很奇怪*

如果你已经有了一些预算，它们会和门槛值以及你当前的支出金额一起列在这个页面上。

![](img/5de2d99ddf3b0bac0eca12edd61054d3.png)

*到目前为止，我已经在 1000 美元的预算上花了将近 80 美元，远远低于第一个 50%的门槛*

您可以点击现有的预算进行编辑，但只需点击“创建预算”即可开始制定新的预算。第一步是命名您的预算并选择您的范围。对于这个新预算，让我们关注一下我们所有的 BigQuery 支出。我将保持所有项目的范围，并从产品列表中选择 BigQuery。

![](img/6c8c3cff802464c8866eee4458eebd79.png)

在我发表这篇文章的时候，可能会有超过 750 个选项

接下来，我们将进入第二页:金额。如上所述，您可以指定一个确切的金额，或者将预算动态设置为上个月的支出。因为我的 BigQuery 每月预算是 500 美元(这是我刚刚做的)，我将把它放进去，并允许包括积分。这样，如果我在某个月收到了价值 200 美元的积分，我就可以在 BigQuery 上花 700 美元，而且不会超出预算。

![](img/0dfa86ddebc9e9f253101d7e1bb5f6ed.png)

选择上个月的支出可以让我更好地了解我的成本逐月波动的情况

在最后一页，我们可以添加多个阈值，这样我们就可以获得每个阈值的警报。我将设置 50%、90%和 100%，这样我就可以控制我的成本，另外再设置一个 120%的预测值。如果我得到了 120%的预测成本，这是一个很好的信号，表明我应该投入到我的项目中，并弄清楚发生了什么。

![](img/015fce424031b886f87008e54f514f9f.png)

*看到底部的选项了吗？我们将在下一篇博文中讨论这些内容！*

就这样，我们做了一个新的预算！当我们的成本上升时，每个计费帐户管理员或计费帐户用户都将开始收到警报，我们可以将这些作为良好的信号，以确保我们在正轨上。

![](img/ec3ea85ed72123c12b5664200aa47f8d.png)

*你应该考虑多个预算来跟踪不同的范围*

一个重要的注意事项是，计费数据有时需要一点时间来报告，这意味着如果您的成本快速上升，预算可能会有点落后。这就是预测阈值的用处，因此您可以提前做好准备。

电子邮件提醒是控制成本的一种快速简单的方法，但它也只是预算工作的开始。在下一篇(希望更短)帖子中，我们将讨论如何添加更多的人，而不仅仅是计费帐户管理员/用户。之后，我们将看看如何利用预算来采取更多的行动，而不仅仅是发送一个通知。