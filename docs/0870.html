<html>
<head>
<title>Analysing 1.2M Ethereum contracts in 20 seconds using Eveem and BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Eveem和BigQuery在20秒内分析120万份以太坊合约</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/analysing-1-2m-mainnet-contracts-in-20-seconds-using-eveem-and-bigquery-f69b6d66c7b2?source=collection_archive---------0-----------------------#2019-01-03">https://medium.com/google-cloud/analysing-1-2m-mainnet-contracts-in-20-seconds-using-eveem-and-bigquery-f69b6d66c7b2?source=collection_archive---------0-----------------------#2019-01-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7d6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上个月，我向Eveem.org发布了一个API，它允许对以太坊合约进行简单的静态分析。</p><p id="ca7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你去:</p><p id="6d50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="http://eveem.org/code/0x06012c8cf97bead5deae237070f9587f8e7a266d.json" rel="noopener ugc nofollow" target="_blank">http://eveem . org/code/0x 06012 c8 cf 97 bead 5 deae 237070 f 9587 F8 e7a 266d . JSON</a></p><p id="b33d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您将在那里找到一个JSON文件，所有的函数都被反编译成一种相对容易分析的中间语言。例如，你可以构建一个像https://showme-1389.appspot.com/<a class="ae jd" href="https://showme-1389.appspot.com/" rel="noopener ugc nofollow" target="_blank">这样的工具，向你展示一些关于智能合约的有趣事实。</a></p><p id="de2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种中间表示还有一个更酷的地方——它使得合同的安全性分析变得非常容易和快速。</p><p id="324f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">而且，由于所有的契约都已经被反编译了，所以批量反编译是可能的。</p><p id="ad03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最初，我是在一个控制台上使用一个python脚本一个接一个地检查所有的合同。这对我来说很方便，但不允许其他人使用这项技术——如果通过API访问120万份合同，速度会非常慢。</p><p id="5566" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">幸运的是，在EthSingapore期间，来自谷歌的<a class="ae jd" href="http://twitter.com/AllenDay" rel="noopener ugc nofollow" target="_blank"> Allen Day </a>向我介绍了BigQuery，你可能从他们最近关于以太坊数据集的声明中知道。</p><p id="6875" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">BigQuery最酷的地方是——它是一个为数据的顺序访问和批量操作而设计的数据库。换句话说——如果您有一个数据集，BigQuery在获取随机行方面不是很好，但是如果您想要访问所有的行，并在其中执行一些操作，这将是非常令人惊讶的。</p><p id="8b89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更酷的是——它支持UDF(用户定义函数),但不仅仅是普通的UDF。BigQuery完全支持Javascript(通过扩展——WASM ),所以如果你写一个脚本来做一些数据分析，在几秒钟内对整个数据集运行它是非常容易的。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/3415d40c5da4db55bf3cb5b8d4be6b15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YEd-vWKpVVOYd8oxHJzhIA.png"/></div></div></figure><p id="ea0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你会问，这有多微不足道？</p><p id="2abc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我只花了几个小时就将所有反编译契约的数据集上传到BigQuery，并编写了<a class="ae jd" href="https://github.com/kolinko/asterix" rel="noopener ugc nofollow" target="_blank">Asterix</a>——一个在所有反编译契约中寻找所有开放的自毁的示例脚本。</p><p id="f4a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你问有多快？</p><p id="3b51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行一个查询需要23秒，该查询返回匹配给定模式的所有合同——在open self-destructs的情况下，它会发现mainnet上现在大约有700个合同处于活动状态，任何人都可以在任何时候杀死它们。额外的500份合同也可能被取消，但有一些条件适用。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jq"><img src="../Images/0e8c5b40ace7d0c1614370c00e27cb1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gn7IV1YOQT8lhLbaoBR9hg.png"/></div></div></figure><p id="ab02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，下一步是什么？</p><p id="8416" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经公开了数据集:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jr"><img src="../Images/18f986b99a46cf4bcf876520acad2cb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lz_nLTC2-myggvwWWXZPUQ.png"/></div></div></figure><p id="0722" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Asterix在这里是完全开源的:</p><p id="dae9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://github.com/kolinko/asterix" rel="noopener ugc nofollow" target="_blank">https://github.com/kolinko/asterix</a></p><p id="2e44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果有人感兴趣，不妨一试！你可以先浏览一下<a class="ae jd" href="https://cloud.google.com/bigquery/docs/quickstarts" rel="noopener ugc nofollow" target="_blank"> BigQuery quickstarts </a>，这大约需要1-2个小时。在你熟悉它们之后，<a class="ae jd" href="https://github.com/kolinko/asterix" rel="noopener ugc nofollow" target="_blank">获取Asterix </a>并运行它以获得带有自毁的合同的完整列表。</p><p id="8b74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您对一些更深入的分析感兴趣，请查看<a class="ae jd" href="https://github.com/kolinko/asterix/blob/master/showme.js" rel="noopener ugc nofollow" target="_blank"> showme.js文件</a>。您还需要熟悉Eveem提供的中间语言——<a class="ae jd" href="https://github.com/kolinko/showmewhatyougot" rel="noopener ugc nofollow" target="_blank">showme python演示</a>应该会有所帮助。</p><p id="4801" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">关闭思路</strong></p><p id="4247" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Eveem仍然是一项正在进行的工作，并且遗漏了许多东西——许多契约和函数没有完全反编译。它也遗漏了一些东西。例如，在safesub库的情况下，它通常不会显示在减法之前进行了检查，所以你会得到大量的误报。</p><p id="06d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">坦白说——这是我写过的最鼓舞人心也最吓人的工具。给定一个漏洞，你可以编写一个类似于你用<a class="ae jd" href="https://github.com/ConsenSys/mythril-classic" rel="noopener ugc nofollow" target="_blank"> Mythril </a>或<a class="ae jd" href="https://github.com/trailofbits/manticore" rel="noopener ugc nofollow" target="_blank">蝎狮</a>所做的扫描器，并立即得到一个带有该漏洞的所有活动合同的列表。</p><p id="cad5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这也让人想知道在这种情况下如何进行合理的漏洞利用披露——显然，找到与任何重要以太网或流量相关的合同，然后找到它们的所有者似乎是正确的事情。</p><p id="ecb9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该工具还有其他潜在的有趣用途——在已部署的契约中找出模式。如果你曾经好奇有多少合同使用某种编程模式(如可升级性，或管理交易所之间的套利，或某种循环)，这可能是第一个让你这么容易就弄明白的工具。</p><p id="b25a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在此基础上还可以构建另一个有趣的东西:现在很容易就能找出一个契约调用了哪些其他契约。人们可以编写一个脚本，对它们之间的所有连接进行静态分析。像<a class="ae jd" href="http://www.bloxy.info/" rel="noopener ugc nofollow" target="_blank"> Bloxy.info </a>这样的网站已经通过分析交易动态地做到了这一点，但似乎没有人静态地做到这一点。我想知道会有什么结果。</p><p id="16c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">玩得开心！:)</p></div></div>    
</body>
</html>