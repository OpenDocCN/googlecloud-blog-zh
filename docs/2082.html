<html>
<head>
<title>Day #17 with Workflows: Sending an email with SendGrid</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">工作流的第17天:使用SendGrid发送电子邮件</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/day-17-with-workflows-sending-an-email-with-sendgrid-ceb0c706ded2?source=collection_archive---------3-----------------------#2022-02-01">https://medium.com/google-cloud/day-17-with-workflows-sending-an-email-with-sendgrid-ceb0c706ded2?source=collection_archive---------3-----------------------#2022-02-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="63a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于通知目的，尤其是以异步方式，电子邮件是一个很好的解决方案。我想在<a class="ae jd" href="https://cloud.google.com/workflows" rel="noopener ugc nofollow" target="_blank">谷歌云工作流程</a>中添加一个电子邮件通知步骤。由于GCP没有电子邮件服务，我查看了云中可用的各种电子邮件服务:SendGrid、Mailgun、Mailjet，甚至快速运行了一个Twitter，以查看野外的人们在使用什么。我用SendGrid做了实验，这个过程非常简单，因为我可以通过创建一个API密匙，用cURL命令发送我的第一封电子邮件，快速地<a class="ae jd" href="https://docs.sendgrid.com/for-developers/sending-email/api-getting-started" rel="noopener ugc nofollow" target="_blank">开始</a>。</p><p id="4dd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我需要从我的工作流定义中调用这个API。这其实也很简单。让我们看看实际情况:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="3149" class="jn jo hi jj b fi jp jq l jr js">- retrieve_api_key:<br/>    assign:<br/>        - SENDGRID_API_KEY: "MY_API_KEY"<br/>- send_email:<br/>    call: http.post<br/>    args:<br/>        url: https://api.sendgrid.com/v3/mail/send<br/>        headers:<br/>            Content-Type: "application/json"<br/>            Authorization: ${"Bearer " + SENDGRID_API_KEY}<br/>        body:<br/>            personalizations:<br/>                - to:<br/>                    - email: to@example.com<br/>            from:<br/>                email: from@example.com<br/>            subject: Sending an email from Workflows<br/>            content:<br/>                - type: text/plain<br/>                  value: Here's the body of my email<br/>    result: email_result<br/>- return_result:<br/>    return: ${email_result.body}</span></pre><p id="3f6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj"> retrieve_api_key </strong>步骤中，我简单地硬编码了SendGrid API键。然而，您当然可以将该秘密存储在Secret Manager中，然后通过Workflows Secret Manager连接器获取密钥(这可能值得专门撰写一篇文章！)</p><p id="559d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，在<strong class="ih hj"> send_email </strong>步骤中，我准备向SendGrid API端点发送HTTP POST请求。我使用SendGrid API键指定内容类型，当然还有授权。接下来，我准备请求的正文，描述我的电子邮件，带有一个我在SendGrid中定义的注册电子邮件用户的<strong class="ih hj"> from </strong>字段，一个对应于收件人的<strong class="ih hj"> to </strong>字段，一个电子邮件<strong class="ih hj">主题</strong>和<strong class="ih hj">正文</strong>(这里只是纯文本)。差不多就是这样了！我只是将SendGrid文档中的<a class="ae jd" href="https://app.sendgrid.com/guide/integrate/langs/curl" rel="noopener ugc nofollow" target="_blank"> cURL示例</a>中发送的JSON主体翻译成了YAML(使用一个方便的JSON到YAML的转换)</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="a9c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ka">原载于https://glaforge.appspot.com</em><a class="ae jd" href="https://glaforge.appspot.com/article/sending-an-email-with-sendgrid-from-workflows" rel="noopener ugc nofollow" target="_blank"><em class="ka"/></a><em class="ka">。</em></p></div></div>    
</body>
</html>