<html>
<head>
<title>Cloud Function Buildpacks!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云函数Buildpacks！</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/cloud-function-buildpacks-ebba8e5e382?source=collection_archive---------2-----------------------#2020-11-10">https://medium.com/google-cloud/cloud-function-buildpacks-ebba8e5e382?source=collection_archive---------2-----------------------#2020-11-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3d60e9a5822076b67819a55f989e6914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o1qj91ot3JbcH2FKmFbymA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">格兰特在一个<strong class="bd iu">集装箱</strong>堆场前拿着一张云运行贴纸</figcaption></figure><p id="1ec0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Google Cloud的Buildpacks是一种创建安全的、生产就绪的容器映像<strong class="ix hj">而无需Dockerfile </strong>的简单方法。</p><p id="7120" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它们是开源的，在生产中使用云功能和应用引擎。</p><p id="db39" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我将介绍如何使用<strong class="ix hj">函数框架</strong>在容器中构建一个<strong class="ix hj">云函数</strong>，这样您就可以在本地测试您的函数，或者在其他容器环境中托管您的代码(比如Cloud Run)。</p><blockquote class="jt ju jv"><p id="1284" class="iv iw jw ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated">注意:云函数CLI/API在后台以这种方式<a class="ae ka" href="https://cloud.google.com/functions/docs/building" rel="noopener ugc nofollow" target="_blank">构建容器。</a></p></blockquote><h2 id="6cc8" class="kb kc hi bd iu kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">1.下载pack CLI</h2><p id="ac72" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">安装<code class="du la lb lc ld b">pack</code> CLI <a class="ae ka" href="https://buildpacks.io/docs/tools/pack/#install" rel="noopener ugc nofollow" target="_blank">🔗</a>:</p><pre class="le lf lg lh fd li ld lj lk aw ll bi"><span id="f28e" class="kb kc hi ld b fi lm ln l lo lp">brew install buildpacks/tap/pack</span></pre><h2 id="39b2" class="kb kc hi bd iu kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">2.构建您的容器</h2><p id="dee1" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">用<code class="du la lb lc ld b">pack build</code>构建当前目录:</p><blockquote class="jt ju jv"><p id="58f2" class="iv iw jw ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated">这假设你的当前目录有云函数的源代码。如果你没有函数，这里有一个节点的<a class="ae ka" href="https://github.com/GoogleCloudPlatform/functions-framework-nodejs#quickstart-set-up-a-new-project" rel="noopener ugc nofollow" target="_blank">例子。</a></p></blockquote><pre class="le lf lg lh fd li ld lj lk aw ll bi"><span id="99ca" class="kb kc hi ld b fi lm ln l lo lp">pack build \<br/>--builder gcr.io/buildpacks/builder:v1 \<br/>--env GOOGLE_FUNCTION_SIGNATURE_TYPE=http \<br/>--env GOOGLE_FUNCTION_TARGET=helloWorld \<br/> my-func</span></pre><p id="bab7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该命令将基于您的源代码(通过语言切换)检测必要的构建器，并使用Ubuntu、公共系统库、您的应用程序依赖项和您的源代码构建您的容器。</p><p id="e567" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">函数使用以下配置构建环境变量:</p><ul class=""><li id="32b6" class="lq lr hi ix b iy iz jc jd jg ls jk lt jo lu js lv lw lx ly bi translated"><code class="du la lb lc ld b">GOOGLE_FUNCTION_SIGNATURE_TYPE</code> : <code class="du la lb lc ld b">http</code>、<code class="du la lb lc ld b">event</code>或<code class="du la lb lc ld b">cloudevent</code></li><li id="9ae1" class="lq lr hi ix b iy lz jc ma jg mb jk mc jo md js lv lw lx ly bi translated"><code class="du la lb lc ld b">GOOGLE_FUNCTION_TARGET</code>:函数名，如<code class="du la lb lc ld b">helloWorld</code></li></ul><p id="60d8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">更多构建配置选项在GitHub <a class="ae ka" href="https://github.com/GoogleCloudPlatform/buildpacks#functions-framework-buildpacks" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><h2 id="ae26" class="kb kc hi bd iu kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">3.运行您的容器</h2><p id="5a8c" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">构建完容器后(<code class="du la lb lc ld b">my-func</code>，运行容器:</p><p id="c988" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du la lb lc ld b">docker run --rm -p 8080:8080 my-func</code></p><p id="033a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Docker将运行用函数框架和Buildpacks构建的容器。测试暴露端口8080上的容器:<code class="du la lb lc ld b">localhost:8080</code></p><blockquote class="jt ju jv"><p id="d7d2" class="iv iw jw ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated">这里的<code class="du la lb lc ld b">--rm</code>标志在退出后清理容器。</p></blockquote><h1 id="c6e7" class="me kc hi bd iu mf mg mh kg mi mj mk kk ml mm mn kn mo mp mq kq mr ms mt kt mu bi translated">感谢阅读！</h1><p id="43f2" class="pw-post-body-paragraph iv iw hi ix b iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">如果你喜欢这篇文章，我强烈推荐你观看马特·索尔多的视频:</p><figure class="le lf lg lh fd ij"><div class="bz dy l di"><div class="mv mw l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">Google Cloud上的构建包</figcaption></figure><p id="9af1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">并查看GCP构建包的源代码:</p><blockquote class="mx"><p id="9631" class="my mz hi bd na nb nc nd ne nf ng js dx translated"><a class="ae ka" href="https://github.com/GoogleCloudPlatform/buildpacks" rel="noopener ugc nofollow" target="_blank">https://github.com/GoogleCloudPlatform/buildpacks</a></p></blockquote></div></div>    
</body>
</html>