<html>
<head>
<title>A to Z of Google Cloud Platform a personal selection — G — Global load balancing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google云平台的a到Z个人精选— G —全局负载均衡</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/a-to-z-of-google-cloud-platform-a-personal-selection-g-global-load-balancing-82e1b8550298?source=collection_archive---------0-----------------------#2016-01-31">https://medium.com/google-cloud/a-to-z-of-google-cloud-platform-a-personal-selection-g-global-load-balancing-82e1b8550298?source=collection_archive---------0-----------------------#2016-01-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="922e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在设计全球可访问的应用程序时，我遇到的两个最常见的难题是，如何确保在前端负载平衡服务横向扩展时不会出现与DNS传播相关的奇怪现象，以及如何将最终用户定向到离他们最近的区域的服务。目标是解决这两个问题，而不必在基础设施服务上花费过多的精力来解决它们。</p><p id="c954" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我喜欢的是，使用GCP负载平衡，这些问题大多是现成的。(正如我所知道的每种情况一样，也有极端情况！)</p><p id="9f96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">具体来说，下面的负载平衡组件很好地解决了这个问题(尽管乍一看文档中的图表，它看起来可能比实际情况更复杂！)</p><ul class=""><li id="d433" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">全局转发规则</li><li id="fbe6" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">URL映射</li><li id="ed2e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">后端服务</li></ul><p id="dc4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要了解这些服务如何优雅地解决问题，我们首先需要了解负载平衡组件如何协同工作，因此我只是从文档中摘录了GCP负载平衡如何工作的描述:</p><ol class=""><li id="cf87" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc jr jj jk jl bi translated">一个<a class="ae js" href="https://cloud.google.com/compute/docs/load-balancing/http/global-forwarding-rules" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">全局转发规则</strong> </a>将传入的请求定向到一个<a class="ae js" href="https://cloud.google.com/compute/docs/load-balancing/http/target-proxies" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">目标HTTP(s)代理</strong> </a>。</li><li id="3df4" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated">目标HTTP(s)代理对照<a class="ae js" href="https://cloud.google.com/compute/docs/load-balancing/http/url-map" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> URL映射</strong> </a>检查每个请求，以确定请求的适当<a class="ae js" href="https://cloud.google.com/compute/docs/load-balancing/http/backend-service" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">后端服务</strong> </a>。</li><li id="f3e8" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated">后端服务根据其连接的后端的服务容量、区域和实例健康状况，将每个请求定向到适当的后端。使用HTTP <a class="ae js" href="https://cloud.google.com/compute/docs/load-balancing/health-checks" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">健康检查</strong> </a>或HTTPS健康检查来验证每个后端实例的健康状况。如果后端服务被配置为使用后者，请求将在到达后端实例的途中被加密。</li></ol><p id="5914" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您已经了解了流程，让我们简单介绍一下我在开始时提到的组件，看看它们如何帮助解决我描述的棘手问题。</p><p id="7be1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae js" href="https://cloud.google.com/compute/docs/load-balancing/http/global-forwarding-rules" rel="noopener ugc nofollow" target="_blank">全局转发规则</a>提供单个全局IP地址，这意味着当负载平衡器扩展时，IP地址不会发生变化，从而避免了DNS传播问题。医生非常清楚地解释了我刚才吐出的血液流:</p><p id="3e81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae js" href="https://cloud.google.com/compute/docs/load-balancing/http/backend-service" rel="noopener ugc nofollow" target="_blank">后端服务</a>是<em class="jt">的一个</em>集中式服务，管理一组<a class="ae js" href="https://cloud.google.com/compute/docs/instance-groups/" rel="noopener ugc nofollow" target="_blank">处理用户请求的实例</a>。(在试图描述这一点时，医生可能会遇到有点笨拙的imho)。该服务知道哪些实例是可用的和健康的，它们可以处理的流量，以及它们当前正在处理多少流量。</p><p id="8d33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好吧，但是为什么我要叫他们出来？文件上说你可以在特定的区域配置后端，但关键是这些区域可以在不同的区域。是的，它内置于开箱即用的负载平衡服务中，允许您在特定地区和区域设置后端服务，然后使用url映射的魔力，您现在可以将流量定向到适当的后端，即将欧洲用户定向到欧洲地区的后端服务，将美国用户定向到美国地区的后端服务</p><p id="f3ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在设置跨区域设置时，您所关心的是将用户引导到最近的区域，那么概括地说，您需要采取的步骤是:</p><ol class=""><li id="d7a5" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc jr jj jk jl bi translated">在您想要的区域中的分区中设置您的实例和实例组(我将跳过配置健康检查等细节，这是所需步骤的总结！)</li><li id="811a" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated">设置防火墙规则</li><li id="3b01" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated">设置保留的静态全局IP地址</li><li id="1dcb" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated">创建具有关联全局转发规则的负载平衡器</li><li id="7fe6" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated">关联IP地址</li><li id="474a" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated">设置协议和证书</li><li id="c329" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc jr jj jk jl bi translated">为每个区域创建两个后端，并添加到负载平衡器</li></ol><p id="0491" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样！这个场景真的就这样了。如果您的用户在使用负载平衡器时来自欧洲，那么他们将被定向到欧洲的实例，而来自美国的用户将被定向到美国的实例</p><p id="b321" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一步一步的演练见<a class="ae js" href="https://cloud.google.com/compute/docs/load-balancing/http/cross-region-example" rel="noopener ugc nofollow" target="_blank">这里</a></p><p id="8db3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是URL映射呢？他们在那里施展魔法，但在这种情况下，默认的URL映射会为您处理这些问题，因此除了设置后端服务之外，您实际上不需要做任何特殊的事情，这并不复杂(请看示例)</p><p id="ff3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用下面的gcloud命令，您可以看到确实有一个默认的URL映射:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="5864" class="kd ke hi jz b fi kf kg l kh ki">$ gcloud compute url-maps list</span></pre><p id="924c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">官方文档中的这张图片以图形方式展示了所有这些是如何组合在一起的:</p><figure class="ju jv jw jx fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kj"><img src="../Images/51715bdfcec6673cc19b37f0f4bfaeff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D96IS1dzkFwEOxF8NjmMeQ.png"/></div></div></figure><p id="240a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以你可以看到URL地图真的很时髦，而且它是所有酷的魔法真正发生的地方(反正我是这么认为的)。在我在这篇文章中谈论的场景中，细节是如此抽象，以至于你甚至不知道URL映射在那里做它的事情。</p><p id="af6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在许多情况下，虽然您想要进行更复杂的路由，但是您需要使用<a class="ae js" href="https://cloud.google.com/compute/docs/reference/latest/urlMaps" rel="noopener ugc nofollow" target="_blank"> URL映射资源</a>来配置URL映射，这些资源是您在创建URL映射时需要使用的属性</p><p id="bbdd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是我觉得下面的图片简洁地展示了当你需要建立基于内容的规则时，URL映射是如何工作的，而不是挠头。</p><figure class="ju jv jw jx fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kr"><img src="../Images/2a53a98c717ea38b5999aba990b81f3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EWDSTnTsSydzT3HNoUJYmg.png"/></div></div></figure><p id="a7a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这篇文章有助于理解GCP的负载平衡产品如何以一种非常优雅的方式解决一个难题。</p></div></div>    
</body>
</html>