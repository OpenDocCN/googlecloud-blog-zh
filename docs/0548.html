<html>
<head>
<title>Stackdriver Profiler</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">堆栈驱动分析器</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/stackdriver-profiler-671fb481236d?source=collection_archive---------0-----------------------#2018-03-29">https://medium.com/google-cloud/stackdriver-profiler-671fb481236d?source=collection_archive---------0-----------------------#2018-03-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="772e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最近在我的<a class="ae jd" href="http://opencensus.io" rel="noopener ugc nofollow" target="_blank">公开普查</a>探险中，我在杂草丛生的地方。所以当Google昨天发布<a class="ae jd" href="http://cloud.google.com/profiler" rel="noopener ugc nofollow" target="_blank"> Stackdriver Profiler </a>的时候，我碰巧有一个Kubernetes引擎集群和一堆代码。</p><p id="6c66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里有一个关于使用Golang和Node的Stackdriver Profiler的快速链接。JS代码。我的一位同事建议我也向您推荐<a class="ae jd" href="https://cloud.google.com/profiler/docs/quickstart" rel="noopener ugc nofollow" target="_blank">快速入门</a>。</p><h2 id="3e73" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">设置</h2><p id="37f6" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">至少你需要一个谷歌云平台项目来启用Stackdriver Profiler。</p><p id="8e9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想用容器进行测试，您也需要一个服务帐户，并且它必须额外拥有角色<code class="du ke kf kg kh b">roles\cloudprofiler.agent</code>。</p><p id="c2a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想要将容器部署到Kubernetes引擎，请确保您有一个集群，并且您已经将服务帐户的密钥作为机密上传到集群。</p><blockquote class="ki kj kk"><p id="ea0c" class="if ig kl ih b ii ij ik il im in io ip km ir is it kn iv iw ix ko iz ja jb jc hb bi translated"><strong class="ih hj">注意</strong>如果您只是将上述角色添加到帐户中，则不需要重新上传密钥。</p></blockquote><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="35a4" class="je jf hi kh b fi kx ky l kz la">export GOOGLE_PROJECT_ID=[[GOOGLE_PROJECT_ID]]</span><span id="17f0" class="je jf hi kh b fi lb ky l kz la">gcloud services enable cloudprofiler.googleapis.com \<br/>--project=${GOOGLE_PROJECT_ID}</span></pre><p id="211e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kl">创建服务账户:</em></p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="19c3" class="je jf hi kh b fi kx ky l kz la">ROBOT=[[YOUR-ROBOT-NAME]]<br/>EMAIL=${GOOGLE_PROJECT_ID}.iam.gserviceaccount.com</span><span id="79f5" class="je jf hi kh b fi lb ky l kz la">gcloud iam service-accounts create ${ROBOT} \<br/>--display-name=${ROBOT} \<br/>--project=${GOOGLE_PROJECT_ID}</span><span id="3452" class="je jf hi kh b fi lb ky l kz la">gcloud iam service-accounts keys create ./${ROBOT}.key.json \<br/>--iam-account=${ROBOT}@${EMAIL} \<br/>--project=${GOOGLE_PROJECT_ID}</span><span id="4710" class="je jf hi kh b fi lb ky l kz la">gcloud projects add-iam-policy-binding ${GOOGLE_PROJECT_ID} \<br/>--member=serviceAccount:${ROBOT}@${EMAIL} \<br/>--role=roles/cloudprofiler.agent</span></pre><p id="565f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kl">上传服务账号密钥到Kubernetes: </em></p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="0c5b" class="je jf hi kh b fi kx ky l kz la">kubectl create secret generic ${ROBOT}-key \<br/>--from-file=${ROBOT}.key.json=${PWD}/${ROBOT}.key.json</span></pre><h2 id="d18c" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">戈朗</h2><p id="2104" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">主页面:</p><figure class="kp kq kr ks fd lc"><div class="bz dy l di"><div class="ld le l"/></div></figure><blockquote class="ki kj kk"><p id="c971" class="if ig kl ih b ii ij ik il im in io ip km ir is it kn iv iw ix ko iz ja jb jc hb bi translated"><strong class="ih hj"> NB </strong>:不要的话省略属性<code class="du ke kf kg kh b">DebugLogging: true</code>。</p></blockquote><p id="a852" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该能够:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="2371" class="je jf hi kh b fi kx ky l kz la">go get ./...<br/>go run main.go</span></pre><p id="dc02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后点击端点几次:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="dd8d" class="je jf hi kh b fi kx ky l kz la">curl http://localhost:8080</span></pre><p id="dfd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并且，通过云控制台中的Stackdriver Profiler用户界面:</p><p id="8e4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">https://console.cloud.google.com/profiler?project=${GOOGLE_PROJECT_ID}</p><figure class="kp kq kr ks fd lc er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lf"><img src="../Images/7e33a1e790839cd37a201a29b6689e85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gtv2NGuce6rokg74ahP1og.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">堆栈驱动程序分析器:线程</figcaption></figure><p id="4f58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并且:</p><figure class="kp kq kr ks fd lc er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lq"><img src="../Images/add89dde8903f6b0395ca5dd253ca5e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5IPJg9pKhHBKYXRPBwGGHw.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">堆栈驱动程序分析器:堆</figcaption></figure><p id="8edb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想将应用程序容器化:</p><p id="3198" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Dockerfile:</p><figure class="kp kq kr ks fd lc"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="6c8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="c65a" class="je jf hi kh b fi kx ky l kz la">CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .</span><span id="1110" class="je jf hi kh b fi lb ky l kz la">docker build \<br/>--tag=gcr.io/${GOOGLE_PROJECT_ID}/golang-profiler \<br/>.</span><span id="8025" class="je jf hi kh b fi lb ky l kz la">gcloud docker -- push gcr.io/${GOOGLE_PROJECT_ID}/golang-profiler</span><span id="6506" class="je jf hi kh b fi lb ky l kz la">docker run \<br/>--env=GOOGLE_PROJECT_ID=${GOOGLE_PROJECT_ID} \<br/>--env=GOOGLE_APPLICATION_CREDENTIALS=/key.json \<br/>--volume=$PWD/${ROBOT}.key.json:/key.json \<br/>--publish=8080:8080 \<br/>gcr.io/${GOOGLE_PROJECT_ID}/golang-profiler</span></pre><p id="f812" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并且:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="c47b" class="je jf hi kh b fi kx ky l kz la">curl <a class="ae jd" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a></span></pre><p id="88be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该会继续看到生成的探查器数据。</p><p id="0f32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想将映像部署到Kubernetes:</p><p id="aafd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">部署. yaml:</p><figure class="kp kq kr ks fd lc"><div class="bz dy l di"><div class="ld le l"/></div></figure><blockquote class="ki kj kk"><p id="5c4f" class="if ig kl ih b ii ij ik il im in io ip km ir is it kn iv iw ix ko iz ja jb jc hb bi translated"><strong class="ih hj"> NB </strong>你将需要用它们的值替换变量:<code class="du ke kf kg kh b">${ROBOT}</code>在第16+28行；而<code class="du ke kf kg kh b">$(GOOGLE_PROJECT_ID}</code>在19+30线。</p></blockquote><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="876e" class="je jf hi kh b fi kx ky l kz la">kubectl apply --filename=deployment.yaml</span></pre><p id="e2fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了避免在Kubernetes上部署时打开防火墙来访问您的服务，您可以通过任何(我们将使用第一个)节点对服务的节点端口进行端口转发:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="9618" class="je jf hi kh b fi kx ky l kz la">NODE_HOST=$(\<br/>  kubectl get nodes \<br/>  --output=jsonpath="{.items[0].metadata.name}")<br/>NODE_PORT=$(\<br/>  kubectl get services/golang-profiler \<br/>  --output=jsonpath="{.spec.ports[0].nodePort}")</span><span id="5632" class="je jf hi kh b fi lb ky l kz la">gcloud compute ssh ${NODE_HOST} \<br/>--project=${GOOGLE_PROJECT_ID} \<br/>--ssh-flag="-L ${NODE_PORT}:localhost:${NODE_PORT}"</span></pre><p id="6b2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="fd2c" class="je jf hi kh b fi kx ky l kz la">curl http://localhost:${NODE_PORT}</span></pre><p id="dfa0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，您应该会继续看到生成的分析器数据。如果这不起作用，您可以遵循Pod的日志:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="62f7" class="je jf hi kh b fi kx ky l kz la">POD=$(\<br/>  kubectl get pods \<br/>  --selector=app=golang-profiler \<br/>  --output=jsonpath="{.items[0].metadata.name}")<br/>kubectl logs pod/${POD} --follow</span></pre><p id="b346" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成后，您可以删除部署:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="c808" class="je jf hi kh b fi kx ky l kz la">kubectl delete --filename=deployment.yaml</span></pre><h2 id="8cd9" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">节点。射流研究…</h2><p id="e602" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">server.js:</p><figure class="kp kq kr ks fd lc"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="f89c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">package.json:</p><figure class="kp kq kr ks fd lc"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="2e5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您在本地安装了节点和npm，则:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="6e58" class="je jf hi kh b fi kx ky l kz la">npm install<br/>npm start</span></pre><p id="6611" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并且:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="f1a1" class="je jf hi kh b fi kx ky l kz la">curl http://localhost:8080</span></pre><p id="f21f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并且:</p><p id="d2e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">https://console.cloud.google/com/profiler?project=${GOOGLE_PROJECT_ID}</p><figure class="kp kq kr ks fd lc er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lf"><img src="../Images/b811d63f4a412d3455788d0ebc77634d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d1ZcY_jerwdrKgkoFntmqA.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">堆栈驱动程序分析器:堆</figcaption></figure><p id="4929" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想将应用程序容器化:</p><p id="7045" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Dockerfile:</p><figure class="kp kq kr ks fd lc"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="99cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="fcce" class="je jf hi kh b fi kx ky l kz la">docker build \<br/>--tag=gcr.io/${GOOGLE_PROJECT_ID}/nodejs-profiler \<br/>.</span><span id="b51c" class="je jf hi kh b fi lb ky l kz la">gcloud docker -- push gcr.io/${GOOGLE_PROJECT_ID}/nodejs-profiler</span><span id="6ddd" class="je jf hi kh b fi lb ky l kz la">docker run \<br/>--env=GOOGLE_PROJECT_ID=${GOOGLE_PROJECT_ID} \<br/>--env=GOOGLE_APPLICATION_CREDENTIALS=/key.json \<br/>--volume=$PWD/${ROBOT}.key.json:/key.json \<br/>--publish=8080:8080 \<br/>gcr.io/${GOOGLE_PROJECT_ID}/nodejs-profiler</span></pre><p id="8cf8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并且:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="3bbf" class="je jf hi kh b fi kx ky l kz la">curl http://localhost:8080</span></pre><p id="cbcf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不起作用:-(</p><p id="6b2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经向工程部门提交了一份报告。</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="95d4" class="je jf hi kh b fi kx ky l kz la">Server on :8080<br/>WARN:<a class="ae jd" href="http://twitter.com/google" rel="noopener ugc nofollow" target="_blank">@google</a>-cloud/profiler: Failed to create profile, waiting 199ms to try again: Error: Forbidden<br/>WARN:<a class="ae jd" href="http://twitter.com/google" rel="noopener ugc nofollow" target="_blank">@google</a>-cloud/profiler: Failed to create profile, waiting 1.2s to try again: Error: Forbidden<br/>WARN:<a class="ae jd" href="http://twitter.com/google" rel="noopener ugc nofollow" target="_blank">@google</a>-cloud/profiler: Failed to create profile, waiting 1.3s to try again: Error: Forbidden<br/>WARN:<a class="ae jd" href="http://twitter.com/google" rel="noopener ugc nofollow" target="_blank">@google</a>-cloud/profiler: Failed to create profile, waiting 466ms to try again: Error: Forbidden<br/>WARN:<a class="ae jd" href="http://twitter.com/google" rel="noopener ugc nofollow" target="_blank">@google</a>-cloud/profiler: Failed to create profile, waiting 2.8s to try again: Error: Forbidden</span></pre><p id="43a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我调整了代码来调用一个不同的GCP服务，这是可行的，所以这是关于containerised Node、版本(<code class="du ke kf kg kh b">node:carbon</code>)或其他不太明显的东西使它不可行。</p><p id="1ddb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我从工程部门得到更新时，我会更新这篇文章。</p><p id="cb48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">更新时间:18–03–29 17:48</strong></p><p id="cbe3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个侧写员证实了文档中有错误。节点。JS启动功能取<code class="du ke kf kg kh b">{projectID, serviceContext}</code>。所以，这里是修正后的server.js:</p><figure class="kp kq kr ks fd lc"><div class="bz dy l di"><div class="ld le l"/></div></figure><blockquote class="ki kj kk"><p id="fea2" class="if ig kl ih b ii ij ik il im in io ip km ir is it kn iv iw ix ko iz ja jb jc hb bi translated"><strong class="ih hj"> NB </strong>第11–18行包含正确定位的(并重命名为另一个bug) <code class="du ke kf kg kh b">ProjectId</code>和值。</p></blockquote><p id="7463" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="f96b" class="je jf hi kh b fi kx ky l kz la">docker build \<br/>--tag=gcr.io/${GOOGLE_PROJECT_ID}/nodejs-profiler \<br/>.<br/>gcloud docker -- push gcr.io/${GOOGLE_PROJECT_ID}/nodejs-profiler</span><span id="0d40" class="je jf hi kh b fi lb ky l kz la">docker run \<br/>--env=GOOGLE_PROJECT_ID=${GOOGLE_PROJECT_ID} \<br/>--env=GOOGLE_APPLICATION_CREDENTIALS=/key.json \<br/>--volume=$PWD/${ROBOT}.key.json:/key.json \<br/>--publish=8080:8080 \<br/>gcr.io/${GOOGLE_PROJECT_ID}/nodejs-profiler</span></pre><p id="f397" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，当您运行代码并使用以下命令访问端点时:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="ccf2" class="je jf hi kh b fi kx ky l kz la">curl http://localhost:8080</span></pre><p id="bffc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该会看到类似如下的内容:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="9d22" class="je jf hi kh b fi kx ky l kz la">nodejs-profiler@0.0.1 start /usr/src/app<br/>&gt; node server.js</span><span id="630a" class="je jf hi kh b fi lb ky l kz la">[nodejs-profiler:global] ProjectID: ${GOOGLE_PROJECT_ID}<br/>Server on :8080<br/>[nodejs-profiler:handle] Entered<br/>[nodejs-profiler:handle] Exited<br/>[nodejs-profiler:handle] Entered<br/>[nodejs-profiler:handle] Exited<br/>[nodejs-profiler:handle] Entered<br/>[nodejs-profiler:handle] Exited<br/>[nodejs-profiler:handle] Entered<br/>[nodejs-profiler:handle] Exited</span></pre><p id="438c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并且:</p><figure class="kp kq kr ks fd lc er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lr"><img src="../Images/99b667e9fbfe46b170db662bf06541ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ueSHaxGkcX5DFd6YpUF0EA.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">堆栈驱动程序分析器:堆</figcaption></figure><p id="3387" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并且使用以下deployment.yaml:</p><figure class="kp kq kr ks fd lc"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="55cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用以下工具部署到Kubernetes:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="0e28" class="je jf hi kh b fi kx ky l kz la">kubectl apply --filename=deployment.yaml</span></pre><p id="4c9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了避免在Kubernetes上部署时打开防火墙来访问您的服务，您可以通过任何(我们将使用第一个)节点对服务的节点端口进行端口转发:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="fca2" class="je jf hi kh b fi kx ky l kz la">NODE_HOST=$(\<br/>  kubectl get nodes \<br/>  --output=jsonpath="{.items[0].metadata.name}")<br/>NODE_PORT=$(\<br/>  kubectl get services/nodejs-profiler \<br/>  --output=jsonpath="{.spec.ports[0].nodePort}")</span><span id="a555" class="je jf hi kh b fi lb ky l kz la">gcloud compute ssh ${NODE_HOST} \<br/>--project=${GOOGLE_PROJECT_ID} \<br/>--ssh-flag="-L ${NODE_PORT}:localhost:${NODE_PORT}"</span></pre><p id="23e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="9a5b" class="je jf hi kh b fi kx ky l kz la">curl <a class="ae jd" href="http://localhost:${NODE_PORT}" rel="noopener ugc nofollow" target="_blank">http://localhost:${NODE_PORT}</a></span></pre><p id="21be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，您应该会继续看到生成的分析器数据。如果这不起作用，您可以遵循Pod的日志:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="c283" class="je jf hi kh b fi kx ky l kz la">POD=$(\<br/>  kubectl get pods \<br/>  --selector=app=nodejs-profiler \<br/>  --output=jsonpath="{.items[0].metadata.name}")<br/>kubectl logs pod/${POD} --follow</span></pre><p id="ae99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成后，您可以删除部署:</p><pre class="kp kq kr ks fd kt kh ku kv aw kw bi"><span id="83aa" class="je jf hi kh b fi kx ky l kz la">kubectl delete --filename=deployment.yaml</span></pre><h2 id="580c" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">结论</h2><p id="f3a0" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">Stackdriver Profiler是对Stackdriver服务集的有力补充，它为开发人员提供了另一种在生产时识别应用程序性能问题的工具。</p><p id="23d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅此而已！</p></div></div>    
</body>
</html>