<html>
<head>
<title>Top Cloud Deploy Features - 2022</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">2022年云部署的主要特性</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/top-cloud-deploy-features-2022-eeb4721513a3?source=collection_archive---------0-----------------------#2022-10-19">https://medium.com/google-cloud/top-cloud-deploy-features-2022-eeb4721513a3?source=collection_archive---------0-----------------------#2022-10-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ad2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Google Cloud Deploy本身相对于Google Cloud Platform(GCP)来说是一个新产品。让我们从为什么我们需要Google Cloud Deploy以及Cloud Deploy可以帮助我们解决哪些问题开始。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/73e9914944009577fa71cad01e46d2c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6FnjI_2SfyJSmvbPN9PGfA.png"/></div></div></figure><blockquote class="jp jq jr"><p id="c240" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated"><strong class="ih hj">Google Cloud Deploy概述(如果您已经熟悉Cloud Deploy，请跳过此部分)</strong></p></blockquote><p id="5617" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您已经编写了代码并将应用程序容器化。现在缺少的是我们如何部署应用程序。<strong class="ih hj"> Cloud Deploy </strong>是一款面向GKE /安索斯的全托管持续交付解决方案，可以帮助您。</p><p id="cf6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="js">“斯卡福德”是什么？</em> </strong></p><p id="d8ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jw" href="https://skaffold.dev/docs/" rel="noopener ugc nofollow" target="_blank">ska fold</a>是Google <a class="ae jw" href="https://github.com/GoogleContainerTools/skaffold" rel="noopener ugc nofollow" target="_blank">开源的</a>命令行工具，方便了Kubernetes-native应用程序的持续开发。Skaffold处理构建、推送和部署应用程序的工作流，并为创建CI/CD管道提供构建块。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jx"><img src="../Images/dfd7f6c1e9a0594b500c5037605657c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*6QA46PhSgmIOmpDHkGrezQ.gif"/></div></div></figure><blockquote class="jp jq jr"><p id="87a3" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated"><strong class="ih hj">问题1:我可以在哪里使用Cloud Deploy部署我的应用程序？</strong></p></blockquote><p id="5da4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Google Cloud Deploy让您的应用程序进入您的目标运行时环境。运行时定义了计算资源及其管理方式。您可以使用一个<strong class="ih hj"><em class="js">ska fold . YAML</em></strong>配置文件来部署您的容器映像和清单。</p><p id="1632" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Google Cloud Deploy可以将您的应用程序部署到以下任何运行时环境中:</p><ul class=""><li id="e0a3" class="jy jz hi ih b ii ij im in iq ka iu kb iy kc jc kd ke kf kg bi translated"><a class="ae jw" href="https://cloud.google.com/deploy/docs/gke-targets" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">GKE</strong></a><strong class="ih hj"><br/></strong><em class="js">Google Cloud Deploy允许您将基于容器的工作负载部署到任何</em> <a class="ae jw" href="https://cloud.google.com/kubernetes-engine/docs/concepts/kubernetes-engine-overview" rel="noopener ugc nofollow" target="_blank"> <em class="js"> Google Kubernetes引擎</em> </a> <em class="js">集群。当您部署到GKE目标时，所有Google Cloud Deploy功能都受支持。</em></li><li id="a2bb" class="jy jz hi ih b ii kh im ki iq kj iu kk iy kl jc kd ke kf kg bi translated"><a class="ae jw" href="https://cloud.google.com/deploy/docs/anthos-targets" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">Anthos</strong></a><strong class="ih hj"><br/></strong><em class="js">Google Cloud Deploy允许您将基于容器的工作负载部署到您可以使用</em><a class="ae jw" href="https://cloud.google.com/anthos/multicluster-management/gateway/using" rel="noopener ugc nofollow" target="_blank"><em class="js">Connect</em></a><em class="js">gateway访问的任何Anthos用户集群。</em></li><li id="ad60" class="jy jz hi ih b ii kh im ki iq kj iu kk iy kl jc kd ke kf kg bi translated"><a class="ae jw" href="https://cloud.google.com/deploy/docs/run-targets" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">云运行</strong></a><strong class="ih hj">(Pre-GA)<br/></strong><em class="js">Google Cloud Deploy允许您将基于容器的工作负载部署到任何</em> <a class="ae jw" href="https://cloud.google.com/run/docs/deploying" rel="noopener ugc nofollow" target="_blank"> <em class="js">云运行服务</em> </a> <em class="js">。当您部署到云运行目标时，所有Google Cloud Deploy特性都受支持。</em></li></ul><blockquote class="jp jq jr"><p id="78d6" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">问题2:我如何检查我的部署的合理性？我可以在部署后自动运行测试吗？</p></blockquote><p id="321d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以使用您自己的测试映像在部署上运行验证测试。在<strong class="ih hj">"</strong><em class="js">ska ffold apply</em><strong class="ih hj">"</strong>执行成功完成后，Cloud Deploy在自己的执行环境中运行<em class="js"> skaffold verify </em>命令。验证步骤应该在"<em class="js">ska fold . YAML</em>"中与部署本身一起定义。为Google Cloud Deploy目标启用部署验证包括向交付管道进程中的给定目标(或多个目标)添加一个<code class="du km kn ko kp b"><a class="ae jw" href="https://cloud.google.com/deploy/docs/config-files#pipeline_definition_and_progression" rel="noopener ugc nofollow" target="_blank">verify: true</a></code> <a class="ae jw" href="https://cloud.google.com/deploy/docs/config-files#pipeline_definition_and_progression" rel="noopener ugc nofollow" target="_blank">属性</a>。</p><pre class="je jf jg jh fd kq kp kr ks aw kt bi"><span id="ddeb" class="ku kv hi kp b fi kw kx l ky kz">apiVersion: deploy.cloud.google.com/v1<br/>kind: DeliveryPipeline<br/>metadata:<br/> name: my-demo-app<br/>description: main application pipeline<br/>serialPipeline:<br/> stages:<br/> - targetId: dev<br/>   profiles: []<br/>   strategy:<br/>     standard:<br/>       verify: true<br/> - targetId: prod<br/>   profiles: []<br/>   strategy:<br/>     standard:<br/>       verify: false</span></pre><p id="4cdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个配置中，部署验证在<code class="du km kn ko kp b">dev</code>目标上启用，但在<code class="du km kn ko kp b">prod</code>目标上不启用。注意，<code class="du km kn ko kp b">verify: false</code>相当于省略了<code class="du km kn ko kp b">verify</code>属性或者整个<code class="du km kn ko kp b">strategy</code>节。</p><p id="1791" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是一个包含<code class="du km kn ko kp b">verify</code>节的示例<code class="du km kn ko kp b">skaffold.yaml</code></p><pre class="je jf jg jh fd kq kp kr ks aw kt bi"><span id="5207" class="ku kv hi kp b fi kw kx l ky kz">apiVersion: skaffold/v3alpha1<br/>kind: Config<br/>build:<br/>  artifacts:<br/>    - image: integration-test<br/>      context: integration-test<br/>manifests:<br/>  rawYaml:<br/>  - kubernetes.yaml<br/>deploy:<br/>  kubectl: {}<br/><strong class="kp hj">verify</strong>:<br/>- name: verify-integration-test<br/>  container:<br/>    name: integration-test<br/>    image: integration-test<br/>    command: ["./test-systems.sh"]<br/>- name: verify-endpoint-test<br/>  container:<br/>    name: alpine<br/>    image: alpine<br/>    command: ["/bin/sh"]<br/>    args: ["-c", "wget $ENDPOINT_URL"]</span></pre><blockquote class="jp jq jr"><p id="916e" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated"><strong class="ih hj">问题3:我可以使用terraform来管理云部署服务吗？</strong></p></blockquote><p id="3ac6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了控制台和gcloud方法，Google Terraform Provider还添加了云部署资源。</p><ul class=""><li id="2e6d" class="jy jz hi ih b ii ij im in iq ka iu kb iy kc jc kd ke kf kg bi translated"><strong class="ih hj">Google _ cloud _ deploy _ delivery _ pipeline<br/></strong><em class="js">交付管道定义了skaffold配置可以通过其进行的管道。</em></li></ul><pre class="je jf jg jh fd kq kp kr ks aw kt bi"><span id="7bb9" class="ku kv hi kp b fi kw kx l ky kz"><strong class="kp hj">resource</strong> "google_cloud_deploy_delivery_pipeline" "pipeline" {<br/>  name          = "dev-${local.name_suffix}"<br/>  description   = "Dev Pipeline"<br/>  serial_pipeline {<br/>    stages {<br/>      target_id = "dev"<br/>    }<br/>  }<br/>  annotations = {<br/>    generated-by = "magic-modules"<br/>  }<br/>  labels = {<br/>    env = "dev"<br/>  }<br/>  region        = "us-central1"<br/>}</span></pre><ul class=""><li id="e4a4" class="jy jz hi ih b ii ij im in iq ka iu kb iy kc jc kd ke kf kg bi translated"><strong class="ih hj">Google _ cloud _ deploy _ target<br/></strong></li></ul><pre class="je jf jg jh fd kq kp kr ks aw kt bi"><span id="95cf" class="ku kv hi kp b fi kw kx l ky kz">resource "google_cloud_deploy_target" "pipeline" {<br/>  name        = "tf-test-tf-test%{random_suffix}"<br/>  description = "Target Prod Cluster"<br/>  annotations = {<br/>    generated-by = "magic-modules"<br/>    another      = "one"<br/>  }<br/>  labels = {<br/>    env = "prod"<br/>  }<br/>  gke {<br/>    cluster = "projects/%{project}/locations/us-central1/clusters/prod"<br/>  }<br/>  execution_configs {<br/>    usages          = ["RENDER"]<br/>    service_account = data.google_compute_default_service_account.default.email<br/>  }<br/>  execution_configs {<br/>    usages          = ["DEPLOY"]<br/>    service_account = "example@appspot.gserviceaccount.com"<br/>  }<br/>}</span><span id="9f31" class="ku kv hi kp b fi la kx l ky kz">data "google_compute_default_service_account" "default" {<br/>  <br/>}</span></pre><blockquote class="jp jq jr"><p id="6915" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated"><strong class="ih hj">其他有价值的特性</strong></p></blockquote><ul class=""><li id="f2f2" class="jy jz hi ih b ii ij im in iq ka iu kb iy kc jc kd ke kf kg bi translated">您可以使用Cloud Deploy为云构建操作配置<a class="ae jw" href="https://cloud.google.com/deploy/docs/deploying-application#change_the_deployment_timeout" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">超时</strong> </a>。</li><li id="8af4" class="jy jz hi ih b ii kh im ki iq kj iu kk iy kl jc kd ke kf kg bi translated">如果您使用Kubernetes清单为每个发布创建一个发布，那么Cloud Deploy可以自动生成一个“<strong class="ih hj"> <em class="js"> skaffold.yaml </em> </strong>”文件。</li><li id="8f63" class="jy jz hi ih b ii kh im ki iq kj iu kk iy kl jc kd ke kf kg bi translated">现在您可以比较不同的Kubernetes和Skaffold配置文件之间的差异。</li><li id="645f" class="jy jz hi ih b ii kh im ki iq kj iu kk iy kl jc kd ke kf kg bi translated">现在支持暂停或放弃一个版本。</li></ul><p id="c58f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考文献</strong></p><div class="lb lc ez fb ld le"><a href="https://skaffold.dev/docs/" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab dw"><div class="lg ab lh cl cj li"><h2 class="bd hj fi z dy lj ea eb lk ed ef hh bi translated">斯卡福德文件</h2><div class="ll l"><h3 class="bd b fi z dy lj ea eb lk ed ef dx translated">Skaffold是一个命令行工具，有助于Kubernetes本地应用程序的持续开发。斯卡福德…</h3></div><div class="lm l"><p class="bd b fp z dy lj ea eb lk ed ef dx translated">斯卡福德开发公司</p></div></div></div></a></div><div class="lb lc ez fb ld le"><a href="https://cloud.google.com/deploy/docs/overview" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab dw"><div class="lg ab lh cl cj li"><h2 class="bd hj fi z dy lj ea eb lk ed ef hh bi translated">Google Cloud Deploy概述</h2><div class="ll l"><h3 class="bd b fi z dy lj ea eb lk ed ef dx translated">Google Cloud Deploy是一项托管服务，可以自动将您的应用交付给一系列目标…</h3></div><div class="lm l"><p class="bd b fp z dy lj ea eb lk ed ef dx translated">cloud.google.com</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls jn le"/></div></div></a></div><div class="lb lc ez fb ld le"><a href="https://cloud.google.com/deploy/docs/verify-deployment" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab dw"><div class="lg ab lh cl cj li"><h2 class="bd hj fi z dy lj ea eb lk ed ef hh bi translated">验证您的部署|谷歌云部署</h2><div class="ll l"><h3 class="bd b fi z dy lj ea eb lk ed ef dx translated">预览此产品包含在Google Cloud服务条款的正式发布前产品条款中。正式上市前的产品…</h3></div><div class="lm l"><p class="bd b fp z dy lj ea eb lk ed ef dx translated">cloud.google.com</p></div></div><div class="ln l"><div class="lt l lp lq lr ln ls jn le"/></div></div></a></div></div></div>    
</body>
</html>