<html>
<head>
<title>Full relational diagram for Bitcoin public data on Google BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google BigQuery上比特币公共数据的完整关系图</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/full-relational-diagram-for-bitcoin-public-data-on-google-bigquery-3c4772af6325?source=collection_archive---------2-----------------------#2021-02-12">https://medium.com/google-cloud/full-relational-diagram-for-bitcoin-public-data-on-google-bigquery-3c4772af6325?source=collection_archive---------2-----------------------#2021-02-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bbeb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">找到一个比特币数据的完整关系图，这些数据来自一个令人惊叹的开源项目<a class="ae jd" href="https://github.com/blockchain-etl/bitcoin-etl" rel="noopener ugc nofollow" target="_blank">https://github.com/blockchain-etl/bitcoin-etl</a>。如果你更喜欢处理星型或雪花型模式，请查看我的<a class="ae jd" href="https://rifkiamil.medium.com/simplified-relational-diagram-for-bitcoin-public-data-on-google-bigquery-a13fe7c3e007" rel="noopener">简化关系图</a>。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/6a2ed7e769b07be98bc5cc4ea917a265.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sl3uCSP1qTxB4iP-W5KL-w.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">互动图可以找到https://dbdiagram.io/d/6026650980d742080a3a482c<a class="ae jd" href="https://dbdiagram.io/d/6026650980d742080a3a482c" rel="noopener ugc nofollow" target="_blank">的</a></figcaption></figure><h1 id="dfc9" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">crypto_bitcoin.transactions中的两个记录类型字段</h1><p id="53fe" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">由于每个比特币交易可以将钱从多个钱包(输入)转移到多个钱包(输出)，我们需要能够将这些数据存储在crypto_bitcoin.transactions上的两个记录类型字段中。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kx"><img src="../Images/396ada0ebe16721abbe1af03df2b8d23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wem0EuLnyQNPq9tEx_6D4g.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">交易.输入和交易.输出</figcaption></figure><h1 id="cf29" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated"><strong class="ak">使用视图的规范化模式</strong></h1><p id="3fd3" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">如果您仍然喜欢使用表连接而不是数组/UNNEST函数，那么crypto_bitcoin.input和crypto_bitcoin.output可能会有所帮助。</p><p id="3992" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">crypto_bitcoin.input是使用数据crypto_bitcoin.transactions的视图</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ky kz l"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">请注意，您不需要在事务和输入上使用表连接</figcaption></figure><p id="fe86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">crypto_bitcoin.output是使用数据crypto_bitcoin.transactions的视图</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ky kz l"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">请注意，您不需要在事务和输出中使用表连接</figcaption></figure><h1 id="bf67" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated"><strong class="ak">分区表——保持低成本和快速查询！</strong></h1><ul class=""><li id="bae8" class="la lb hi ih b ii ks im kt iq lc iu ld iy le jc lf lg lh li bi translated">当使用crypto_bitcoin.blocks和crypto_bitcoin.transactions时，尝试使用分区字段<strong class="ih hj"> block_timestamp_month </strong>。这将加快您的查询并降低您的成本。在YYYY-MM-DD中，DD始终为01。</li></ul><pre class="jf jg jh ji fd lj lk ll lm aw ln bi"><span id="b3cc" class="lo jv hi lk b fi lp lq l lr ls">WHERE transactions.block_timestamp_month = '2018-02-01'<br/>WHERE blocks.block_timestamp_month = '2010-12-01'</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lt"><img src="../Images/0fd8f7b1aceada58c8d4c71963ca0e0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wui2bTBiIy-3_hTOnyRGZg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">可以在details选项卡下找到已分区表的设置</figcaption></figure><p id="77d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">带有分区字段的SQL</strong></p><p id="ea17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用分区字段尝试这个查询。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ky kz l"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lu"><img src="../Images/6ba5af8bc3b66998c6589e19c86ed9dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F0wlX01bc9-R5WS0Lj3Uqg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">具有分区字段的161 MiB</figcaption></figure><p id="3a2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">没有分区字段的SQL</strong></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lv"><img src="../Images/291a116420d490b6d19b752a5fd232ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zuZe3XW6M8mv2ib70FS5uA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">412.3 GiB ( 421，888 MiB)，无分区字段</figcaption></figure></div></div>    
</body>
</html>