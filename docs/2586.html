<html>
<head>
<title>Terraform Modules</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">地形模块</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/terraform-modules-29a1282c6a7f?source=collection_archive---------2-----------------------#2022-12-02">https://medium.com/google-cloud/terraform-modules-29a1282c6a7f?source=collection_archive---------2-----------------------#2022-12-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bc22" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文描述了Terraform中模块的使用和好处，以及它的实现。</p><p id="22a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Terraform使用模块实现了DRY(不要重复自己)原则，通过它可以对资源集合进行分组，以便以后重用。模块与编程语言中用于避免代码重复的函数非常相似。</p><p id="bb5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">为什么要在Terraform中使用模块？</strong></p><ul class=""><li id="7906" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><strong class="ih hj">可读</strong>:通过调用源模块消除代码行。</li><li id="b496" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><strong class="ih hj">可重用</strong>:模块可以一次编写，多次重用。</li><li id="642c" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><strong class="ih hj">摘要</strong>:将配置分离成逻辑单元。</li></ul><p id="418d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文结束时，您将能够:</p><ul class=""><li id="1283" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">定义/创建模块。</li><li id="8e4b" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">使用模块重用配置</li><li id="bfe3" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">使用输入变量来参数化您的配置和输出，以将资源属性传递到模块外部。</li></ul><p id="c4d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 1。在地形中定义模块:</strong></p><p id="9456" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Terraform预装在云壳中。通过在云shell中运行<em class="jr"> terraform </em>来验证Terraform是否可用。您也可以通过运行<em class="jr"> terraform — version来检查Terraform的版本。</em></p><ol class=""><li id="7da5" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc js jj jk jl bi translated">创建terraform文件的目录。</li><li id="9d7e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc js jj jk jl bi translated">每个目录都有自己的<em class="jr"> main.tf </em>文件。</li><li id="ea83" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc js jj jk jl bi translated">在<em class="jr"> main.tf </em>文件中编写代码来创建您的需求。</li></ol><p id="766e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，如果您想要创建一个网络配置文件，创建一个<em class="jr"> network.tf </em>文件并编写以下代码。</p><pre class="jt ju jv jw fd jx jy jz bn ka kb bi"><span id="8851" class="kc kd hi jy b be ke kf l kg kh"># Create network<br/>resource "google_compute_network" "net1" {<br/>name = "net1"<br/>auto_create_subnetworks = "true"<br/>}<br/># Add a firewall rule on net1<br/>resource "google_compute_firewall" "net1-allow-http-ssh-rdp-icmp" {<br/>name = "net1-allow-http-ssh-rdp-icmp"<br/>network = google_compute_network.net1.self_link<br/>allow {<br/>protocol = "tcp"<br/>ports = ["22", "80", "3389"]<br/>}<br/>allow {<br/>protocol = "icmp"<br/>}<br/>source_ranges = ["0.0.0.0/0"]<br/></span></pre><p id="3a50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。使用模块复用配置:</strong></p><p id="3250" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">若要使用模块，请调用模块来引用模块块中的代码。</p><p id="facc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">父模块使用source参数调用已定义的模块。运行<em class="jr"> terraform init </em>命令下载配置引用的任何模块。指定源参数，即定义模块源位置的强制元参数。</p><p id="9d7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jr">模块来源:</em></p><p id="0bcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">本地路径:</strong></p><p id="d76f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用于引用与调用模块存储在同一目录中的模块。</p><pre class="jt ju jv jw fd jx jy jz bn ka kb bi"><span id="acac" class="kc kd hi jy b be ke kf l kg kh">module "web-server"{<br/>source = ./server<br/>}</span></pre><p id="1d61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">使用公共注册表中的模块:</strong></p><p id="75d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jr">地形注册表:</em> </strong></p><p id="2c74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它包含各种基础设施模块的公共可用模块的注册表。</p><p id="5e3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">来源名称格式:<strong class="ih hj"> <em class="jr"> </em> </strong> <em class="jr">名称空间/名称/提供者</em></p><p id="0f4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jr"> Github注册表:</em> </strong></p><p id="fa19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要使用这个，直接输入源代码所在的Github URL。</p><p id="7da4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行命令<em class="jr"> terraform init </em>安装提供者二进制文件并初始化新的terraform配置。一旦所有的代码都被写入各自的文件，现在通过运行命令<em class="jr"> terraform apply，</em>来应用您的配置。</p><p id="86ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3。使用输入变量来参数化您的配置和输出，以将资源属性传递到模块外部。</strong></p><p id="0633" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">变量帮助您在不改变源代码的情况下定制模块的各个方面。它们在处理不同的环境(如生产、开发和试运行)时非常有用。</p><ol class=""><li id="a89d" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc js jj jk jl bi translated">用变量替换模块中的硬编码值。</li></ol><pre class="jt ju jv jw fd jx jy jz bn ka kb bi"><span id="2596" class="kc kd hi jy b be ke kf l kg kh">resource "google_compute_network" "net1"{<br/>name = var.&lt;variable_name&gt;<br/>}</span></pre><p id="f165" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.创建一个文件<em class="jr"> variable.tf </em>，并在文件中声明变量。</p><pre class="jt ju jv jw fd jx jy jz bn ka kb bi"><span id="194d" class="kc kd hi jy b be ke kf l kg kh">variable "&lt;variable_name&gt;" {<br/>type = string<br/>description = "description about the variable"<br/>}</span></pre><p id="b83d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.调用模块时，传递输入变量的值。</p><pre class="jt ju jv jw fd jx jy jz bn ka kb bi"><span id="2b1f" class="kc kd hi jy b be ke kf l kg kh">module "prod_network"{<br/>source = ./network<br/>&lt;variable_name&gt; = "mynet1"<br/>}</span></pre><p id="1c5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(将<em class="jr"> &lt; variable_name &gt; </em>替换为您想要赋予变量的名称。)</p><p id="52fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在运行时向变量传递值是不可能的。因此，为了将资源参数从一个模块传递到另一个模块，参数被配置为Terraform中的输出值。</p><ol class=""><li id="9c8a" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc js jj jk jl bi translated">若要从模块传递属性，请将属性的名称声明为输出值，以便在模块外部公开它。</li><li id="b69e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc js jj jk jl bi translated">将该属性名定义为需要使用该值的模块中的变量。</li><li id="4977" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc js jj jk jl bi translated">当调用需要使用该值的模块时，请参考输出值。</li></ol><p id="690b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jr">注意:</em>可以使用格式<em class="jr">模块引用输出值。&lt;模块名称&gt;。&lt;输出值&gt;。</em></p><p id="98b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结论:</strong></p><p id="f5ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Terraform中，模块的概念用于重用配置，并编写有效、可重用和可读的代码。此外，考虑编写模块的最佳实践。</p></div></div>    
</body>
</html>