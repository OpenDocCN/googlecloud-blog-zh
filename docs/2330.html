<html>
<head>
<title>Litmus Chaos Tests (CPU &amp; Memory) in GKE (Google Kubernetes Engine)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">石蕊混沌测试(CPU和内存)在GKE(谷歌Kubernetes引擎)</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/litmus-chaos-tests-cpu-memory-in-gke-google-kubernetes-engine-fef586888a50?source=collection_archive---------1-----------------------#2022-08-26">https://medium.com/google-cloud/litmus-chaos-tests-cpu-memory-in-gke-google-kubernetes-engine-fef586888a50?source=collection_archive---------1-----------------------#2022-08-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/c9aa8283fb8a4aebfdd142375a146ea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NAUHHd3KSwJZmct729VeIA.png"/></div></div></figure><div class=""/><p id="b0d3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，为什么要进行混沌测试？这是为了在不断增长的大规模分布式软件系统中建立信心和测试可靠性，模拟灾难性事件(删除/CPU压力/内存压力)的诱导..)可能发生在生产环境中。</p><p id="6e4c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">其次，在具备操作Google Kubernetes引擎(<a class="ae jo" href="https://cloud.google.com/kubernetes-engine" rel="noopener ugc nofollow" target="_blank"> GKE </a>)、Litmus Chaos工具(<a class="ae jo" href="https://litmuschaos.io" rel="noopener ugc nofollow" target="_blank"> LitmusChaos </a>)、<a class="ae jo" href="https://helm.sh" rel="noopener ugc nofollow" target="_blank"> Helm </a>或<a class="ae jo" href="https://kubernetes.io/docs/tasks/tools/#kubectl" rel="noopener ugc nofollow" target="_blank"> Kubectl </a>的知识的前提下，下面举例说明。</p><p id="ee8a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将通过CPU和内存压力实验，在节点级别测试GKE集群的可靠性。为了达到这个目的，我们在星团里安装了LitmusChaos中心和混沌代理。</p><p id="b593" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建GKE集群:</p><p id="364f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要创建GKE集群，请确保您的项目已启用计费，启用Kubernetes引擎<a class="ae jo" href="https://cloud.google.com/endpoints/docs/openapi/enable-api" rel="noopener ugc nofollow" target="_blank"> API的</a>，并确保您有可用的<a class="ae jo" href="https://cloud.google.com/docs/quota" rel="noopener ugc nofollow" target="_blank">配额</a>。</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="6c13" class="jy jz ht ju b fi ka kb l kc kd">gcloud container clusters create &lt;CLUSTER_NAME&gt; --zone "us-central1-c" --machine-type "e2-custom-4-4096" --image-type "UBUNTU_CONTAINERD" --num-nodes "2" --node-locations "us-central1-c"</span></pre><p id="2146" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">连接到已安装的群集:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="97ff" class="jy jz ht ju b fi ka kb l kc kd">gcloud container clusters get-credentials &lt;CLUSTER_NAME&gt; --zone us-central1-c --project &lt;PROJECT_NAME&gt;</span></pre><p id="ead5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">列出节点和命名空间的详细信息:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="e35e" class="jy jz ht ju b fi ka kb l kc kd">kubectl get nodes<br/>kubectl get ns</span></pre><p id="ed14" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用Helm或Kubectl安装Litmus ChaosCenter:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="a731" class="jy jz ht ju b fi ka kb l kc kd">helm repo add litmuschaos <a class="ae jo" href="https://litmuschaos.github.io/litmus-helm/" rel="noopener ugc nofollow" target="_blank">https://litmuschaos.github.io/litmus-helm/</a><br/>helm repo list</span></pre><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ke"><img src="../Images/b1e3b9a8dcfcdd010b7301ce0b7040f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i1FOTm_1dW4J5Z-rg-Tsgw.png"/></div></div></figure><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="43af" class="jy jz ht ju b fi ka kb l kc kd"># You can use any of your convenient NameSpace<br/>kubectl create ns litmus<br/>helm install chaos litmuschaos/litmus --namespace=litmus</span></pre><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ke"><img src="../Images/5022870e11b07f2e56a8e94cb967099b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MZDqaxvuLmGzmjtQvkAolA.png"/></div></div></figure><p id="5eff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装Litmus ChaosCenter的kubectl命令:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="58bb" class="jy jz ht ju b fi ka kb l kc kd">kubectl apply -f <a class="ae jo" href="https://litmuschaos.github.io/litmus/2.12.0/litmus-2.12.0.yaml" rel="noopener ugc nofollow" target="_blank">https://litmuschaos.github.io/litmus/2.12.0/litmus-2.12.0.yaml</a></span></pre><p id="0824" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以通过以下方式验证Litmus工具的安装</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="70d0" class="jy jz ht ju b fi ka kb l kc kd">kubectl get pods -n litmus<br/>kubectl get svc -n litmus</span></pre><p id="74b9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您应该看到litmusportal-frontend-service和其他四个依赖服务作为pods运行。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kf"><img src="../Images/8a58c196ef1b045bfe658acadce27a50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ECIh_4i217liuI5kRAqisw.png"/></div></div></figure><p id="f30f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为前端服务和服务器服务创建Google云防火墙规则，以允许来自互联网的连接访问Litmus ChaosCenter:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="cd12" class="jy jz ht ju b fi ka kb l kc kd">gcloud compute firewall-rules create &lt;NAME_FRONTEND_SERVICE&gt; --allow tcp:&lt;TCP_PORT&gt;<br/>gcloud compute firewall-rules create &lt;NAME_SERVER_SERVICE&gt; --allow tcp:&lt;FIRST_TCP_PORT&gt;</span></pre><blockquote class="kg kh ki"><p id="b6f4" class="iq ir kj is b it iu iv iw ix iy iz ja kk jc jd je kl jg jh ji km jk jl jm jn hb bi translated">Litmus ChaosCenter的URL可以从下面的命令中获得。输出格式将类似于(示例)http://172.17.0.3:31186</p></blockquote><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="a2c2" class="jy jz ht ju b fi ka kb l kc kd">LITMUS_PORTAL_NAMESPACE=litmus<br/>export NODE_NAME=$(kubectl -n $LITMUS_PORTAL_NAMESPACE get pod  -l "component=litmusportal-frontend" -o=jsonpath='{.items[*].spec.nodeName}')<br/>export EXTERNAL_IP=$(kubectl -n $LITMUS_PORTAL_NAMESPACE get nodes $NODE_NAME -o jsonpath='{.status.addresses[?(@.type=="ExternalIP")].address}')<br/>export NODE_PORT=$(kubectl -n $LITMUS_PORTAL_NAMESPACE get -o jsonpath="{.spec.ports[0].nodePort}" services litmusportal-frontend-service)<br/>echo "URL: http://$EXTERNAL_IP:$NODE_PORT"</span></pre><p id="a8a9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面提供了默认凭据，但是在第一次尝试登录时会要求您更改密码</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="1554" class="jy jz ht ju b fi ka kb l kc kd">Username: admin<br/>Password: litmus</span></pre><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kn"><img src="../Images/961ccf87a6e56c7942eb6c3dcef20235.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V5IHZTEA6Q6t5zksduybrw.png"/></div></div></figure><p id="b8bc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们将通过注入<a class="ae jo" href="https://litmuschaos.github.io/litmus/experiments/categories/nodes/node-cpu-hog/" rel="noopener ugc nofollow" target="_blank"> CPU </a>和<a class="ae jo" href="https://litmuschaos.github.io/litmus/experiments/categories/nodes/node-memory-hog/" rel="noopener ugc nofollow" target="_blank">内存</a>压力来测试GKE节点的可靠性。您应该会在处于活动状态的ChaosDelegates下看到自代理。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ko"><img src="../Images/bbd517af6dad831b8ddd21155a282180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qgU-01TBVl09VvBvIPN7RQ.png"/></div></div></figure><p id="7877" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">单击安排混乱场景并选择自我代理作为代理。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ko"><img src="../Images/8df07f0c398b984493d805e0c554ede0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3LCe8o7dZbJbSPKP9arnPA.png"/></div></div></figure><p id="a5c9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以选择预定义的场景、自带场景、使用模板或从<a class="ae jo" href="https://hub.litmuschaos.io" rel="noopener ugc nofollow" target="_blank"> ChaosHub </a>中选择。我选择了ChaosHub。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ko"><img src="../Images/623b60b0be42f7e0822a9c6db2de94c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T7JTaQzB6xAKsjnb6IydHQ.png"/></div></div></figure><p id="0b7f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">选择通用/节点cpu-hog和通用/节点内存-hog</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kp"><img src="../Images/9b8e9a0ccd9378fd52c1004389133745.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l3ztYyYQOGGXiGvIkf4HCQ.png"/></div></div></figure><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kq"><img src="../Images/d67c18f0b2a49ed88ce39b757afb4d39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yrxCyfgcYsXvvJft-dM9LA.png"/></div></div></figure><p id="18a8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">弹性分数是在Kubernetes系统上执行不同的混沌场景时，混沌场景的弹性的度量。权重优先级通常分为三个级别:0-3(低优先级)、4-6(中优先级)、7-10(高优先级)。</p><p id="0959" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ChaosHub是一个可以进行各种实验的市场。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kp"><img src="../Images/4cc266653345b1abaa7dfb6b213871af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KA1xwX3oIBZIDHfcq0cCWg.png"/></div></div></figure><p id="4385" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以编辑序列来选择同时运行cpu和内存，或者依次运行每一个。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kr"><img src="../Images/060f33dd5c653db0e9abc85ec55d61a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5D0VaZxW7ZoZxYgggxZY0Q.png"/></div></div></figure><p id="d94b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">单击编辑YAML -&gt;并将环境变量TARGET_NODES更改为GKE节点名称。通过用逗号分隔，可以有多个节点。</p><p id="498b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦您按照要求安排并验证了细节，您就可以单击finish来运行实验了。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kr"><img src="../Images/df78ac97efda033259ecedc58fc60c00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xgRL8be8kzLZ5Br3cdA35Q.png"/></div></div></figure><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="1f0d" class="jy jz ht ju b fi ka kb l kc kd">kubectl get pods -n litmus</span></pre><p id="49b7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以看到豆荚弹出，并导致CPU和内存的压力。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ks"><img src="../Images/df35deae38e5a2d681936c7add592c61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QDcYtpd5zU-afCD17ZJElw.png"/></div></div></figure><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="ba4f" class="jy jz ht ju b fi ka kb l kc kd">kubectl top nodes</span></pre><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kt"><img src="../Images/6e90d981610b2dcd03e0b0ba494af364.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cNlZjBHaC6aGNc_hLYUKRA.png"/></div></div></figure><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kr"><img src="../Images/f5b98ad2a365ee2e04e5b37b8d476792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*klRCyF9j-A_S-wyRSHBn6Q.png"/></div></div></figure><p id="203d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行实验的全面细节可以在图形视图和表格视图中找到。在执行过程中，日志已经被记录并实时呈现，随后也会出现混乱结果。您可以在上面的图像中看到，裁决正在等待，这表明工作正在进行中。</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ku"><img src="../Images/4bddcbfbf37d19bafd6359d4ab25204d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dXBFGYPD2AaK8imoNluesQ.png"/></div></div></figure><p id="f2cf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">场景完成后，将生成报告，该报告可在“统计数据”部分下的“分析”中找到。在上面的场景中，弹性得分为100%(CPU压力为10分，内存压力为10分)，这表明GKE节点对于倾向于该特定实验的定义配置具有高效的弹性。</p><p id="429a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这为我们带来了GKE节点中混沌测试(CPU/内存)的完成。此外，Litmus tool具有与<a class="ae jo" href="https://docs.litmuschaos.io/docs/integrations/prometheus" rel="noopener ugc nofollow" target="_blank">普罗米修斯</a>和<a class="ae jo" href="https://docs.litmuschaos.io/docs/integrations/grafana" rel="noopener ugc nofollow" target="_blank">格拉夫纳</a>集成的能力。你可以从<a class="ae jo" href="https://docs.litmuschaos.io/docs/introduction/what-is-litmus" rel="noopener ugc nofollow" target="_blank"> Litmus </a>工具的文档部分获得更多细节。</p></div><div class="ab cl kv kw gp kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hb hc hd he hf"><p id="6d40" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">………..感谢您访问博客，祝您有美好的一天！…………</p></div></div>    
</body>
</html>