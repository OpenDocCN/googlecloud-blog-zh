<html>
<head>
<title>Let Google do Secret Management</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让谷歌做秘密管理</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/let-google-do-secret-management-22319fcfc4fb?source=collection_archive---------0-----------------------#2020-01-26">https://medium.com/google-cloud/let-google-do-secret-management-22319fcfc4fb?source=collection_archive---------0-----------------------#2020-01-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="dc82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将谈论谷歌的<a class="ae jd" href="https://cloud.google.com/secret-manager/" rel="noopener ugc nofollow" target="_blank"> Secret Manager </a>服务，并展示在GCP管理密码/令牌是多么容易。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/efa5e9bc36518f6b6cdc22e6efad47ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uXtjhG6leQnhBvUB.jpg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">照片由<a class="ae jd" href="https://unsplash.com/@usinglight" rel="noopener ugc nofollow" target="_blank">斯蒂芬·斯坦鲍尔</a>在<a class="ae jd" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="bfac" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">问题</h1><p id="bed0" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">管理机密和共享机密(如数据库密码、令牌等..)是一个难题，无法保护令牌会导致一些严重的问题。</p><p id="921a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个示例场景—当开发一个应用程序时，它可能需要连接到一个数据库，或者需要一些证书，或者需要令牌(例如，Slack令牌)来进行API调用。将这些密钥放在源代码中并不是一个好的做法，因为它们永远存在于源代码中，并且对所有能够访问源代码的人都是可见的。有时，开发人员将这些密钥保存在单独的本地文件中(添加到。gitignore)并使用不同的方法(如聊天、电子邮件等)共享这些密钥...这种方法仍然不好，因为秘密令牌是明文形式的，并且分散在团队成员之间。当一名团队成员转到另一个团队或另一个地方时，你如何处理这种情况？很难轮换密钥并与所有需要的团队成员再次共享它们。</p><p id="eb51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在<a class="ae jd" href="https://12factor.net/config" rel="noopener ugc nofollow" target="_blank">12factor.net</a>阅读更多关于为什么密钥应该与代码分开</p><h1 id="43a4" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">解决办法</h1><p id="2934" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">解决这个问题的方法是类似<a class="ae jd" href="https://www.vaultproject.io/" rel="noopener ugc nofollow" target="_blank"> Hashicorp Vault </a>、<a class="ae jd" href="https://github.com/GoogleCloudPlatform/berglas" rel="noopener ugc nofollow" target="_blank"> Berglas </a>、<a class="ae jd" href="https://cloud.google.com/secret-manager/" rel="noopener ugc nofollow" target="_blank"> Google Secret Manager </a>、<a class="ae jd" href="https://aws.amazon.com/secrets-manager/" rel="noopener ugc nofollow" target="_blank"> AWS Secret Manager </a>等秘密管理工具。其中一个流行的工具是Hashicorp Vault，但是一个团队必须建立和管理他们自己的基础设施。</p><p id="8bb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本帖中，我们将了解Google托管秘密管理解决方案— <a class="ae jd" href="https://cloud.google.com/secret-manager/" rel="noopener ugc nofollow" target="_blank"> Secret Manager </a>，并了解存储和检索密钥和密码有多简单。</p><h1 id="0d36" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">什么是秘密经理？</h1><p id="f36e" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">Google Secret Manager是Google Cloud Platform的新成员，可以存储API密钥、密码、证书、敏感字符串等...你可以在这里阅读谷歌秘密管理器的发布说明<a class="ae jd" href="https://cloud.google.com/secret-manager/docs/release-notes" rel="noopener ugc nofollow" target="_blank">，在这里</a>阅读定价<a class="ae jd" href="https://cloud.google.com/secret-manager/pricing" rel="noopener ugc nofollow" target="_blank"/></p><p id="8e3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Google Secret Manager的访问控制与Cloud IAM集成在一起，项目所有者可以控制谁可以阅读这些秘密。</p><p id="a253" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">roles/Secret manager . admin</strong>:该角色提供管理秘密的完全访问权限。具有此角色的人员(或服务帐户)可以对机密执行CRUD(创建、读取、更新和删除)操作。</p><p id="682e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">roles/Secret manager . Secret accessor</strong>:该角色提供读取秘密的权限。具有此角色的人(或服务帐户)可以读取秘密值存储，如API密钥。</p><p id="b0cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">roles/Secret manager . viewer</strong>:该角色提供查看秘密元数据的权限。具有此角色的人员(或服务帐户)可以读取机密元数据，但不能读取存储的值。</p><p id="7554" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们已经熟悉了Google Secret Manager，让我们与这个服务进行交互。</p><h1 id="bb80" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">与Secret Manager交互</h1><h1 id="a82a" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">先决条件</h1><p id="5cc5" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">本帖假设如下:</p><ol class=""><li id="5499" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">我们已经有了一个项目所有者角色的GCP项目。</li><li id="93a8" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">Google Cloud SDK ( <code class="du ll lm ln lo b">gcloud</code>)安装在您的工作站上。如果没有，那就参考我之前的博客-<a class="ae jd" href="https://pbhadani.com/posts/getting-started-wth-google-cloud-sdk/" rel="noopener ugc nofollow" target="_blank">Google Cloud SDK入门</a>。</li></ol><p id="69ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意</strong>:您也可以使用<a class="ae jd" href="https://cloud.google.com/shell/" rel="noopener ugc nofollow" target="_blank"> Google Cloud Shell </a>来运行<code class="du ll lm ln lo b">gcloud</code>命令。</p><h1 id="e8e6" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">启用秘密API</h1><p id="61d6" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">为了与Google Secret Manager交互，我们需要启用这个API。<br/>运行以下命令来启用这个API。</p><pre class="jf jg jh ji fd lp lo lq lr aw ls bi"><span id="d079" class="lt jv hi lo b fi lu lv l lw lx">$ gcloud services enable secretmanager.googleapis.com --project=workshop-demo-23345</span></pre><p id="88c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">输出</strong></p><pre class="jf jg jh ji fd lp lo lq lr aw ls bi"><span id="f89c" class="lt jv hi lo b fi lu lv l lw lx">Operation "operations/acf.xxxxxxf-xxxx-xxxx-xxxx-xxxxxxx" finished successfully.</span></pre><h1 id="50bd" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">创造一个秘密</h1><p id="2e4e" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">运行下面的<code class="du ll lm ln lo b">gcloud</code>命令来创建一个秘密。</p><pre class="jf jg jh ji fd lp lo lq lr aw ls bi"><span id="d1d2" class="lt jv hi lo b fi lu lv l lw lx">gcloud secrets create demo-secret --replication-policy="automatic"</span></pre><p id="0803" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">输出</strong></p><pre class="jf jg jh ji fd lp lo lq lr aw ls bi"><span id="0156" class="lt jv hi lo b fi lu lv l lw lx">Created secret [demo-secret].</span></pre><p id="787f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注:</strong> <br/> 1。这就产生了一个空的秘密，可以保存多个秘密版本(实际上是敏感信息)。<br/> 2。在这个例子中，我们使用<code class="du ll lm ln lo b">--replication-policy</code>作为<code class="du ll lm ln lo b">automatic</code>，但是也可以用<code class="du ll lm ln lo b">user-managed</code>来指定你想要放置秘密的位置。</p><h1 id="25e4" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">向机密添加值</h1><p id="ae22" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">秘密版本包含实际的敏感值。</p><pre class="jf jg jh ji fd lp lo lq lr aw ls bi"><span id="13fa" class="lt jv hi lo b fi lu lv l lw lx">echo "my_super_secret_string" | gcloud secrets versions add 'demo-secret' --data-file=-</span></pre><p id="f894" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">输出</strong></p><pre class="jf jg jh ji fd lp lo lq lr aw ls bi"><span id="74c2" class="lt jv hi lo b fi lu lv l lw lx">Created version [1] of the secret [demo-secret].</span></pre><p id="56c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">添加另一版本或更新秘密值</strong></p><pre class="jf jg jh ji fd lp lo lq lr aw ls bi"><span id="7f3c" class="lt jv hi lo b fi lu lv l lw lx">echo "secret_update" | gcloud secrets versions add 'demo-secret' --data-file=-</span></pre><p id="18fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">输出</strong></p><pre class="jf jg jh ji fd lp lo lq lr aw ls bi"><span id="89cf" class="lt jv hi lo b fi lu lv l lw lx">Created version [2] of the secret [demo-secret].</span></pre><h1 id="ae4c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">读取秘密值</h1><p id="da97" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">我们可以访问最新的或特定的秘密版本</p><p id="e125" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">获取最新秘密版本</strong></p><pre class="jf jg jh ji fd lp lo lq lr aw ls bi"><span id="3bf1" class="lt jv hi lo b fi lu lv l lw lx">gcloud secrets versions access latest --secret='demo-secret'</span></pre><p id="8eb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">输出</strong>T5】访问特定秘密版本</p><pre class="jf jg jh ji fd lp lo lq lr aw ls bi"><span id="4f31" class="lt jv hi lo b fi lu lv l lw lx">gcloud secrets versions access 1 --secret='demo-secret'</span></pre><p id="b8d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">输出</strong></p><p id="930f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>切勿在应用程序中打印秘密值。</p><p id="c45c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">类似地，我们可以使用<code class="du ll lm ln lo b">gcloud</code>命令或应用程序中的客户端库在需要时获取秘密值，而不是放入源代码或某种属性文件中。</p><h1 id="1fac" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">结论</h1><p id="aeb0" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">Google Secret Manager使开发人员能够以一种简单的方式存储和共享API密钥、密码等，而不必管理诸如Vault等工具</p><p id="0954" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您有反馈或问题，请通过<a class="ae jd" href="https://linkedin.com/in/pradeepbhadani" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或<a class="ae jd" href="https://twitter.com/bhadanipradeep" rel="noopener ugc nofollow" target="_blank"> Twitter </a>联系我</p></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><p id="d073" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mf">原载于</em><a class="ae jd" href="https://pbhadani.com/posts/google-secret-manager/" rel="noopener ugc nofollow" target="_blank"><em class="mf">https://pbhadani.com</em></a><em class="mf">。</em></p></div></div>    
</body>
</html>