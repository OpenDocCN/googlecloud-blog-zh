<html>
<head>
<title>Artifact Registry: the new way to keep your App artifacts and Docker Images on GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">工件注册:在GCP上保存你的应用工件和Docker图片的新方法</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/artifact-registry-the-new-way-to-keep-your-app-artifacts-and-docker-images-on-gcp-d1a72da09ff9?source=collection_archive---------0-----------------------#2020-04-18">https://medium.com/google-cloud/artifact-registry-the-new-way-to-keep-your-app-artifacts-and-docker-images-on-gcp-d1a72da09ff9?source=collection_archive---------0-----------------------#2020-04-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div class="er es hg"><img src="../Images/d3a4d1d7a3b31a5bae6dd126017bef36.png" data-original-src="https://miro.medium.com/v2/resize:fit:256/format:webp/1*VIMgEPCE_6u3vF-dm8fnpg.png"/></div></figure><div class=""/></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><p id="1fe1" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">2020年11月更新</p><p id="4db7" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><a class="ae jr" href="https://cloud.google.com/blog/products/devops-sre/artifact-registry-is-ga" rel="noopener ugc nofollow" target="_blank">神器注册表现在GA </a>！</p><p id="da37" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">* 2021年10月更新:</p><p id="5557" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><a class="ae jr" href="https://cloud.google.com/blog/products/application-development/node-python-and-javarepos-are-generally-available" rel="noopener ugc nofollow" target="_blank">语言包的工件注册表现已正式发布</a></p><p id="1259" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi">— :: —</p><p id="b6d9" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">今天，当你需要在GCP上存储你的Docker图片时，你可以使用GCR(谷歌容器注册)。这非常方便，因为您将在GCP生态系统中使用完全集成的服务，这已经很容易由GCP IAM管理。</p><p id="9054" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">通常，Doker图像并不是您需要保存的唯一工件，使用Jfrog Artifactory或Sonatype Nexus这样的应用程序来管理jar文件、npm等工件是很常见的。你也可以使用GCS来维护那些工件，正如这里显示的<a class="ae jr" href="https://cloud.google.com/cloud-build/docs/building/store-build-artifacts" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="ecd5" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">谷歌最近推出了<strong class="iv hq">工件注册表</strong>(̵c̵u̵r̵r̵e̵n̵t̵l̵y̵̵i̵n̵̵b̵e̵t̵a̵)̵，2020年11月正式发布)，使你能够集中存储工件并建立依赖关系，作为集成的谷歌云体验的一部分。</p><p id="e812" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">AR是Container Registry的发展，当它成为GA时，它将取代GCR，所以了解一下它的特性会很有好处。</p><p id="48fb" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Artifact Registry为管理包和Docker容器映像提供了一个单一的位置。您可以:</p><ul class=""><li id="d7bd" class="js jt hp iv b iw ix ja jb je ju ji jv jm jw jq jx jy jz ka bi translated">管理整个工件生命周期—存储、管理和保护您的工件。</li><li id="fae2" class="js jt hp iv b iw kb ja kc je kd ji ke jm kf jq jx jy jz ka bi translated">集成到您的环境中—使用您现有的CI/CD工具来上传和下载工件。利用与云身份和访问管理以及Google云产品的紧密集成，或者将其他工具与Artifact Registry集成。</li><li id="29f4" class="js jt hp iv b iw kb ja kc je kd ji ke jm kf jq jx jy jz ka bi translated">在单个Google Cloud项目中创建多个区域性存储库。</li><li id="3003" class="js jt hp iv b iw kb ja kc je kd ji ke jm kf jq jx jy jz ka bi translated">在项目或存储库级别控制访问。</li><li id="3da8" class="js jt hp iv b iw kb ja kc je kd ji ke jm kf jq jx jy jz ka bi translated">VPC服务中的安全库控制着安全边界。</li></ul><p id="4d6d" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Artifact Registry与Cloud Build和其他持续交付和持续集成系统集成，以存储来自您的构建的包。您还可以存储用于生成和部署的可信依赖项。</p><p id="acb4" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">下面我将向您展示如何为Docker容器和Java工件创建AR。</p><h1 id="d9b4" class="kg kh hp bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">码头工人</h1><p id="e1d5" class="pw-post-body-paragraph it iu hp iv b iw le iy iz ja lf jc jd je lg jg jh ji lh jk jl jm li jo jp jq hb bi translated">第一步:</p><p id="f17a" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">向工件注册表验证:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="9221" class="ls kh hp lo b fi lt lu l lv lw">gcloud beta auth configure-docker us-central1-docker.pkg.dev</span></pre><p id="d7c0" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">第二步:</p><p id="6573" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Docker需要访问工件注册表来推和拉图像。您可以使用独立的Docker凭证助手工具<code class="du lx ly lz lo b">docker-credential-gcr</code>来配置您的工件注册表凭证，以便与Docker一起使用，而不需要使用<code class="du lx ly lz lo b">gcloud</code>。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="6784" class="ls kh hp lo b fi lt lu l lv lw">VERSION=2.0.0<br/>OS=linux  # or "darwin" for OSX, "windows" for Windows.<br/>ARCH=amd64  # or "386" for 32-bit OSs<br/><br/>curl -fsSL "https://github.com/GoogleCloudPlatform/docker-credential-gcr/releases/download/v${VERSION}/docker-credential-gcr_${OS}_${ARCH}-${VERSION}.tar.gz" \<br/>  | tar xz --to-stdout ./docker-credential-gcr \<br/>  &gt; /usr/bin/docker-credential-gcr &amp;&amp; chmod +x /usr/bin/docker-credential-gcr</span></pre><p id="8cd0" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">您可以在此找到关于如何安装此工具<a class="ae jr" href="https://github.com/GoogleCloudPlatform/docker-credential-gcr" rel="noopener ugc nofollow" target="_blank">的更多信息</a></p><p id="9d67" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">第三步:</p><p id="325b" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">将Docker配置为在与工件注册中心交互时使用您的工件注册中心凭证</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="feec" class="ls kh hp lo b fi lt lu l lv lw">docker-credential-gcr configure-docker --registries=us-central1-docker.pkg.dev<!-- --> </span></pre><p id="910b" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">现在你应该可以走了，用你的<code class="du lx ly lz lo b">docker push</code> &amp; <code class="du lx ly lz lo b">docker tag</code> &amp; <code class="du lx ly lz lo b">docker pull</code>命令；)</p><h1 id="1a40" class="kg kh hp bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">Java 语言(一种计算机语言，尤用于创建网站)</h1><p id="3791" class="pw-post-body-paragraph it iu hp iv b iw le iy iz ja lf jc jd je lg jg jh ji lh jk jl jm li jo jp jq hb bi translated">下面的步骤将向您展示如何创建maven repo并推送您的工件。要知道maven还在ALPHA，随时可以换。</p><p id="2d8b" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">第一步:</p><p id="accf" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">授予Cloud SDK访问Google Cloud的权限</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="9dd5" class="ls kh hp lo b fi lt lu l lv lw">gcloud auth application-default login</span></pre><p id="7da2" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">第二步:</p><p id="e9a5" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">创建maven存储库</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="3dbb" class="ls kh hp lo b fi lt lu l lv lw">gcloud beta artifacts repositories create quickstart-maven-repo --repository-format=maven \<br/>--location=us-central1 [--description="Maven repository"]</span></pre><p id="6c69" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">对于docker容器，您只需更改<code class="du lx ly lz lo b">--repository-format=docker</code></p><p id="1bec" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">您可以使用验证它是否是正确创建的</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="566f" class="ls kh hp lo b fi lt lu l lv lw">gcloud beta artifacts repositories list</span></pre><p id="65c5" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">要简化gcloud命令，您可以使用以下命令设置默认repo和位置:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="b7eb" class="ls kh hp lo b fi lt lu l lv lw">gcloud config set artifacts/repository quickstart-maven-repo</span></pre><p id="395d" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">和</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="32d8" class="ls kh hp lo b fi lt lu l lv lw">gcloud config set artifacts/location us-central1</span></pre><p id="67cf" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">第三步:</p><p id="32ff" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">将配置添加到pom.xml中</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="58b1" class="ls kh hp lo b fi lt lu l lv lw">&lt;distributionManagement&gt;<br/>  &lt;snapshotRepository&gt;<br/>    &lt;id&gt;artifact-registry&lt;/id&gt;<br/>    &lt;url&gt;artifactregistry://us-central1-maven.pkg.dev/<strong class="lo hq">PROJECT</strong>/quickstart-maven-repo&lt;/url&gt;<br/>  &lt;/snapshotRepository&gt;<br/>  &lt;repository&gt;<br/>    &lt;id&gt;artifact-registry&lt;/id&gt;<br/>    &lt;url&gt;artifactregistry://us-central1-maven.pkg.dev/<strong class="lo hq">PROJECT</strong>/quickstart-maven-repo&lt;/url&gt;<br/>  &lt;/repository&gt;<br/>&lt;/distributionManagement&gt;<br/><br/>&lt;repositories&gt;<br/>  &lt;repository&gt;<br/>    &lt;id&gt;artifact-registry&lt;/id&gt;<br/>    &lt;url&gt;artifactregistry://us-central1-maven.pkg.dev/<strong class="lo hq">PROJECT</strong>/quickstart-maven-repo&lt;/url&gt;<br/>    &lt;releases&gt;<br/>      &lt;enabled&gt;true&lt;/enabled&gt;<br/>    &lt;/releases&gt;<br/>    &lt;snapshots&gt;<br/>      &lt;enabled&gt;true&lt;/enabled&gt;<br/>    &lt;/snapshots&gt;<br/>  &lt;/repository&gt;<br/>&lt;/repositories&gt;<br/><br/>&lt;build&gt;<br/>  &lt;extensions&gt;<br/>    &lt;extension&gt;<br/>      &lt;groupId&gt;com.google.cloud.artifactregistry&lt;/groupId&gt;<br/>      &lt;artifactId&gt;artifactregistry-maven-wagon&lt;/artifactId&gt;<br/>      &lt;version&gt;2.0.1&lt;/version&gt;<br/>    &lt;/extension&gt;<br/>  &lt;/extensions&gt;<br/>&lt;/build&gt;</span></pre><p id="f14e" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">您可以使用以下命令轻松生成此配置</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="6177" class="ls kh hp lo b fi lt lu l lv lw">gcloud beta artifacts print-settings mvn</span></pre><p id="d77a" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">第四步:</p><p id="1e5c" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">现在，您将能够使用<code class="du lx ly lz lo b">mvn deploy</code>和<code class="du lx ly lz lo b">mvn release</code>命令来推动工件</p><p id="44fd" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">就是这样！</p><h2 id="7fe3" class="ls kh hp bd ki ma mb mc km md me mf kq je mg mh ku ji mi mj ky jm mk ml lc mm bi translated">摘要</h2><p id="c56c" class="pw-post-body-paragraph it iu hp iv b iw le iy iz ja lf jc jd je lg jg jh ji lh jk jl jm li jo jp jq hb bi translated">在本文中，您将看到如何使用新的GCP工件注册中心轻松地集成和管理您的工件，因此您将不需要任何其他外部工件管理器工具。</p><p id="bfd2" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">GCP AR也将在未来取代我们目前的GCR，所以即使在这个早期阶段的Beta/Alpha，也要密切关注它。</p><p id="dc1e" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">我希望你喜欢它！</p><p id="653c" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">请让我知道你的想法！</p><p id="2c7b" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">来源:</p><p id="8263" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><a class="ae jr" href="https://cloud.google.com/artifact-registry/docs/overview" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/artifact-registry/docs/overview</a></p><p id="943f" class="pw-post-body-paragraph it iu hp iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><a class="ae jr" href="https://cloud.google.com/artifact-registry/docs/java/quickstart" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/artifact-registry/docs/Java/quick start</a></p></div></div>    
</body>
</html>