<html>
<head>
<title>Deconstructing Chatbots: Understanding Fulfillment by integrating Dialogflow with Google Calendar</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解构聊天机器人:通过集成Dialogflow和Google Calendar理解实现</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/deconstructing-chatbots-understanding-fulfillment-by-integrating-dialogflow-with-google-calendar-dde40a3856ff?source=collection_archive---------4-----------------------#2019-05-21">https://medium.com/google-cloud/deconstructing-chatbots-understanding-fulfillment-by-integrating-dialogflow-with-google-calendar-dde40a3856ff?source=collection_archive---------4-----------------------#2019-05-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/78f3f99e64deaa321884e1da7197b527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ScD72WY6wOs2tpyOxK8bKw.png"/></div></div></figure><div class=""/><h1 id="c261" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">介绍</h1><p id="7c54" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在本文中，我们将了解Dialogflow如何与后端系统连接，以提供对用户问题的丰富和动态的响应。我们将使用我们在之前的实验中创建的同一代理“预约计划程序”。在代理的GCP项目中，我们将启用谷歌日历API和一个服务帐户来访问谷歌日历。然后，我们创建实施，并使用我们为日历访问生成的凭证将它与实施连接起来。最后，我们将测试日历邀请是否是根据用户请求设置的。</p><h1 id="fd83" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">你会学到什么</h1><ul class=""><li id="59e5" class="km kn ht jq b jr js jv jw jz ko kd kp kh kq kl kr ks kt ku bi translated">什么是满足感</li><li id="7b60" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">如何为Google日历设置服务帐户</li><li id="d99f" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">如何设置谷歌日历</li><li id="68df" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">如何在Dialogflow中启用实施</li><li id="e571" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">如何测试履行情况</li></ul><h1 id="7ae0" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">先决条件</h1><ul class=""><li id="5d89" class="km kn ht jq b jr js jv jw jz ko kd kp kh kq kl kr ks kt ku bi translated">对话流的基本概念和结构。关于介绍基本对话设计的Dialogflow教程视频，请查看<a class="ae la" href="https://www.youtube.com/watch?v=O00K10xP5MU&amp;list=PLIivdWyY5sqK5SM34zbkitWLOV-b3V40B&amp;index=1" rel="noopener ugc nofollow" target="_blank">解构聊天机器人系列</a>。</li><li id="9023" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">我们将使用我们在<a class="ae la" rel="noopener" href="/@pvergadia/deconstructing-chatbots-build-an-appointment-scheduler-with-dialogflow-2ee08614b630">这篇</a>文章中构建的同一个约会调度聊天机器人，并在此基础上理解实体。</li><li id="0e25" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">也浏览一下“<a class="ae la" rel="noopener" href="/google-cloud/deconstructing-chatbots-understanding-entities-in-dialogflow-a5d3d4c0fe8d">解构聊天机器人:理解Dialogflow </a>中的实体”这篇文章。</li><li id="e547" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">如果你有兴趣按照视觉指导来做，可以看看youtube上的这一集解构聊天机器人。</li></ul><figure class="lb lc ld le fd hk"><div class="bz dy l di"><div class="lf lg l"/></div></figure><h1 id="88cf" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">什么是充实？</h1><p id="6873" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">Fulfillment是作为webhook部署的代码，它允许您的Dialogflow代理在一个意图接一个意图的基础上调用业务逻辑。在对话期间，fulfillment允许您使用Dialogflow的自然语言处理提取的信息来生成动态响应或触发后端操作。</p><p id="529e" class="pw-post-body-paragraph jo jp ht jq b jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ll kj kk kl hb bi translated">大多数对话流代理利用履行。以下是您可以使用实施来扩展座席的一些实例:</p><ul class=""><li id="a4af" class="km kn ht jq b jr lh jv li jz lm kd ln kh lo kl kr ks kt ku bi translated">基于从数据库中查找的信息生成动态响应。</li><li id="cfe4" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">根据客户要求的产品下订单。</li><li id="51d0" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">执行游戏的规则和获胜条件。</li></ul><h1 id="7046" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">启用日历API</h1><ul class=""><li id="6ace" class="km kn ht jq b jr js jv jw jz ko kd kp kh kq kl kr ks kt ku bi translated">在<a class="ae la" href="https://console.dialogflow.com/" rel="noopener ugc nofollow" target="_blank"> Dialogflow的控制台</a>，进入设置⚙，在常规选项卡下，你会看到带有谷歌云链接的项目ID部分，以打开谷歌云控制台。打开谷歌云。</li></ul><figure class="lb lc ld le fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lp"><img src="../Images/3737464a303b4b257a61d0674201c026.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cAJ3-beTSMfj6tkh"/></div></div></figure><ul class=""><li id="7a1b" class="km kn ht jq b jr lh jv li jz lm kd ln kh lo kl kr ks kt ku bi translated">在云控制台中，转到菜单图标☰&gt; API和服务&gt;库</li><li id="550a" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">搜索Google Calendar API，然后<strong class="jq hu"> Enable </strong>在你的云项目上启用API。</li></ul><h1 id="bd14" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">设置服务帐户</h1><ul class=""><li id="6478" class="km kn ht jq b jr js jv jw jz ko kd kp kh kq kl kr ks kt ku bi translated">在菜单图标<strong class="jq hu">下☰ </strong>点击<strong class="jq hu">API&amp;服务</strong>然后点击<strong class="jq hu">凭证</strong></li><li id="334f" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">点击<strong class="jq hu">创建凭证</strong>，然后点击<strong class="jq hu">服务账户密钥</strong>。</li></ul><figure class="lb lc ld le fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lq"><img src="../Images/ebdfb252be700256fe2675313f65eeb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YRS-8dwiu3wL0_Wl"/></div></div></figure><ul class=""><li id="1d95" class="km kn ht jq b jr lh jv li jz lm kd ln kh lo kl kr ks kt ku bi translated">在Create service account key下，从下拉列表中选择New Service Account，并输入AppointmentCalendar作为名称，然后单击Create。在弹出窗口中，选择<strong class="jq hu">创建无角色</strong>。</li><li id="1dd8" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">一个JSON文件将被下载到您的计算机上，您将需要在下面的设置部分。</li></ul><figure class="lb lc ld le fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lr"><img src="../Images/2386c8f687ef395706b7db8dd98086d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rJCBKcWlCHujfsSE"/></div></div></figure><h1 id="18ca" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">日历设置</h1><ul class=""><li id="1ac4" class="km kn ht jq b jr js jv jw jz ko kd kp kh kq kl kr ks kt ku bi translated"><a class="ae la" href="https://calendar.google.com/" rel="noopener ugc nofollow" target="_blank">打开谷歌日历</a>。在左侧，点击“添加日历”旁边的三个点，然后选择“新建日历”</li></ul><figure class="lb lc ld le fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ls"><img src="../Images/01237b5857e4488df3fce69791bfdb67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uLh6kaTITvXeofR5"/></div></div></figure><ul class=""><li id="f671" class="km kn ht jq b jr lh jv li jz lm kd ln kh lo kl kr ks kt ku bi translated">输入约会日历作为日历的名称，然后选择创建日历。</li><li id="ea38" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">接下来，单击新创建的“约会日历”，您会看到它出现在左栏的“我的日历设置”列表中。</li><li id="b0cf" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">从我们作为服务帐户设置的一部分下载的json文件中复制client_email。</li></ul><figure class="lb lc ld le fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lp"><img src="../Images/4fc108c2204a0ff2ac57bce8d6e90209.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4vpBnk2m6EAA3oQL"/></div></div></figure><ul class=""><li id="c149" class="km kn ht jq b jr lh jv li jz lm kd ln kh lo kl kr ks kt ku bi translated">将从上一步复制的client_email粘贴到“与特定人员共享”部分的“添加人员”字段中，然后在“权限”下拉列表中选择“更改事件”,并选择“发送”。</li></ul><figure class="lb lc ld le fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lp"><img src="../Images/f77e955a151a9ef71d616e3ce59aa273.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*q83rI-KoMgVBlbre"/></div></div></figure><ul class=""><li id="8cd7" class="km kn ht jq b jr lh jv li jz lm kd ln kh lo kl kr ks kt ku bi translated">仍在“设置”中，向下滚动并复制“集成日历”部分中的日历ID。</li></ul><figure class="lb lc ld le fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lp"><img src="../Images/ac8e29d1ab39acf521be61f5134b27d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iHb3mXrFD0uBUYfB"/></div></div></figure><h1 id="fcdc" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">在Dialoflow中设置履行</h1><h2 id="edca" class="lt ir ht bd is lu lv lw iw lx ly lz ja jz ma mb je kd mc md ji kh me mf jm mg bi translated">将服务帐户和日历ID添加到实现</h2><ul class=""><li id="1a12" class="km kn ht jq b jr js jv jw jz ko kd kp kh kq kl kr ks kt ku bi translated">导航至Dialogflow代理“预约日程安排程序”并点击“<a class="ae la" href="https://console.dialogflow.com/api-client/#/agent//fulfillment" rel="noopener ugc nofollow" target="_blank">履行</a>”</li><li id="d549" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated"><strong class="jq hu">通过切换开关启用</strong>内联代码编辑器。</li></ul><figure class="lb lc ld le fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lr"><img src="../Images/900c0e7e98dc2ac6f982846d4dd95934.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hSRQJStUxKWUWrqF"/></div></div></figure><ul class=""><li id="d037" class="km kn ht jq b jr lh jv li jz lm kd ln kh lo kl kr ks kt ku bi translated">使用以下代码更新index.js文件。</li></ul><figure class="lb lc ld le fd hk"><div class="bz dy l di"><div class="mh lg l"/></div></figure><ul class=""><li id="555f" class="km kn ht jq b jr lh jv li jz lm kd ln kh lo kl kr ks kt ku bi translated">在index.js中，更新您的日历并从前面的部分复制，替换<strong class="jq hu"> &lt;插入您的日历ID &gt; </strong></li><li id="3296" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">还要用JSON文件的内容更新“serviceAccount”常量。替换<strong class="jq hu"> &lt;在这里插入你的JSON文件内容</strong></li><li id="e001" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">(可选)如果不在PST中，请根据您日历的“约会日历”时区更改以下字段(以下是CST的示例):</li></ul><p id="a436" class="pw-post-body-paragraph jo jp ht jq b jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ll kj kk kl hb bi translated">const timeZone = '美洲/芝加哥'；</p><p id="f4da" class="pw-post-body-paragraph jo jp ht jq b jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ll kj kk kl hb bi translated">const time zone offset = '-05:00 '；</p><ul class=""><li id="11cf" class="km kn ht jq b jr lh jv li jz lm kd ln kh lo kl kr ks kt ku bi translated">点击页面底部的<strong class="jq hu">部署</strong>。</li></ul><h2 id="5a4d" class="lt ir ht bd is lu lv lw iw lx ly lz ja jz ma mb je kd mc md ji kh me mf jm mg bi translated">启用实施响应</h2><ul class=""><li id="e3ab" class="km kn ht jq b jr js jv jw jz ko kd kp kh kq kl kr ks kt ku bi translated">导航到对话流"<strong class="jq hu">意图</strong>"</li><li id="3395" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">点击<strong class="jq hu">预约</strong>意向。</li><li id="c795" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">向下滚动到Fulfillment并切换“<strong class="jq hu">启用意向的webhook调用</strong></li></ul><figure class="lb lc ld le fd hk er es paragraph-image"><div class="er es mi"><img src="../Images/f02d4eb8788c66913ac64790b653bd6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/0*4JNheBAoa_jc7Wa2"/></div></figure><ul class=""><li id="a3f5" class="km kn ht jq b jr lh jv li jz lm kd ln kh lo kl kr ks kt ku bi translated">点击<strong class="jq hu">保存</strong>保存对代理的修改。</li><li id="838c" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">每当云功能发生变化时，点击实现下的<strong class="jq hu">部署</strong>。</li></ul><h1 id="e86c" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">测试你的聊天机器人！</h1><p id="09cf" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">让我们来测试我们的聊天机器人，你可以在模拟器中测试它，或者使用我们在以前的代码实验室中学到的web或google home集成。</p><ul class=""><li id="e8ff" class="km kn ht jq b jr lh jv li jz lm kd ln kh lo kl kr ks kt ku bi translated">用户:“明天下午2点预约车辆登记”</li><li id="06fb" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">聊天机器人回应:“好吧，让我看看我们是否能把你安排进去。4月24日下午2点可以！."</li></ul><figure class="lb lc ld le fd hk er es paragraph-image"><div class="er es mj"><img src="../Images/15108d723458d83ca7be508b89e1384e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/0*hQAzXno1UAaP1CWm"/></div></figure><ul class=""><li id="ae29" class="km kn ht jq b jr lh jv li jz lm kd ln kh lo kl kr ks kt ku bi translated">日历预订响应:</li></ul><figure class="lb lc ld le fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lp"><img src="../Images/8b19ce0a8b07ccea9495b57529b90c71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CwwxFHbpt-K5eW3u"/></div></div></figure><h1 id="b2e1" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">恭喜你！</h1><p id="e55d" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">您使用内嵌编辑器创建了一个实现，并与Google Calendar集成。想想更多这样的整合。</p><h1 id="2040" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">后续步骤</h1><ul class=""><li id="62a8" class="km kn ht jq b jr js jv jw jz ko kd kp kh kq kl kr ks kt ku bi translated">点击查看Dialogflow网站<a class="ae la" href="https://cloud.google.com/dialogflow-enterprise/" rel="noopener ugc nofollow" target="_blank">获取文档、API和更多内容。</a></li><li id="5030" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">关注<a class="ae la" href="https://www.youtube.com/watch?v=O00K10xP5MU&amp;list=PLIivdWyY5sqK5SM34zbkitWLOV-b3V40B&amp;index=1" rel="noopener ugc nofollow" target="_blank">解构聊天机器人</a>视频系列，订阅谷歌云平台youtube频道</li><li id="ad01" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">想要更多的故事？查看我的<a class="ae la" rel="noopener" href="/@pvergadia/">媒体</a>，<a class="ae la" href="https://twitter.com/pvergadia" rel="noopener ugc nofollow" target="_blank">在twitter上关注我</a>。</li><li id="aea7" class="km kn ht jq b jr kv jv kw jz kx kd ky kh kz kl kr ks kt ku bi translated">试试<a class="ae la" href="https://dialogflow.com/" rel="noopener ugc nofollow" target="_blank"> Dialogflow </a>，它是<strong class="jq hu">免费</strong>打造的一个bot！看看这个。</li></ul></div></div>    
</body>
</html>