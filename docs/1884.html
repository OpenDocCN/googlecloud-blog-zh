<html>
<head>
<title>Cloud Workflows Continuous Deployment with GitHub Actions!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过GitHub操作持续部署云工作流！</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/cloud-workflows-continuous-deployment-with-github-actions-514866c9250?source=collection_archive---------2-----------------------#2021-05-18">https://medium.com/google-cloud/cloud-workflows-continuous-deployment-with-github-actions-514866c9250?source=collection_archive---------2-----------------------#2021-05-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/fa5e139ec516f7e79f4fda7081596be5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qxl9qcOxwnPHDulLDnhosw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">GitHub →云工作流</figcaption></figure><p id="e971" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">作为一名工程师，我发现大多数有趣的问题都以<em class="js">“如果”</em>开头。</p><p id="c98f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我喜欢在GitHub上为我的云工作流保存YAML文件。但是，我必须记住每次修改工作流时都要将它部署到Google Cloud。</p><p id="eaaf" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">那是一种痛苦。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="d87c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果 …</p><ul class=""><li id="a819" class="ka kb hi iw b ix iy jb jc jf kc jj kd jn ke jr kf kg kh ki bi translated">每当我们<strong class="iw hj">在<strong class="iw hj"> GitHub repo </strong>中更新</strong>一个工作流文件时</li><li id="31da" class="ka kb hi iw b ix kj jb kk jf kl jj km jn kn jr kf kg kh ki bi translated">然后我们的<strong class="iw hj">云工作流程</strong>会自动<strong class="iw hj">更新</strong>到Google Cloud</li></ul><blockquote class="ko kp kq"><p id="f458" class="iu iv js iw b ix iy iz ja jb jc jd je kr jg jh ji ks jk jl jm kt jo jp jq jr hb bi translated">(即无需使用<code class="du ku kv kw kx b">gcloud</code>手动更新工作流程)</p></blockquote><p id="4437" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">借助一些方便的工具，我们可以做到这一点！让我告诉你怎么做:</p><h1 id="3ddd" class="ky kz hi bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">目标</h1><p id="3355" class="pw-post-body-paragraph iu iv hi iw b ix lw iz ja jb lx jd je jf ly jh ji jj lz jl jm jn ma jp jq jr hb bi translated">为了自动部署到云工作流，我们需要创建一个GitHub动作来监听主分支的推送并运行<code class="du ku kv kw kx b">gcloud workflows deploy</code>。GitHub上的操作如下所示:</p><figure class="mc md me mf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/b478de297cff6ee5a22ab515817f2bbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fYDGtoQxaEFlyaeqvdB7yg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">GitHub工作流成功运行的图像。</figcaption></figure><h1 id="38ef" class="ky kz hi bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">设置</h1><h2 id="8a8f" class="mg kz hi bd la mh mi mj le mk ml mm li jf mn mo lm jj mp mq lq jn mr ms lu mt bi translated">1.创建云工作流</h2><p id="d4fa" class="pw-post-body-paragraph iu iv hi iw b ix lw iz ja jb lx jd je jf ly jh ji jj lz jl jm jn ma jp jq jr hb bi translated">首先，我们需要在GitHub repo中创建一个云工作流文件。让我们用经典的<code class="du ku kv kw kx b"><em class="js">myFirstWorkflow.workflows.yaml</em></code>:</p><figure class="mc md me mf fd ij"><div class="bz dy l di"><div class="mu mv l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">一个简单的云工作流，通过搜索星期几获得维基百科的结果。</figcaption></figure><h2 id="4185" class="mg kz hi bd la mh mi mj le mk ml mm li jf mn mo lm jj mp mq lq jn mr ms lu mt bi translated">2.创建GitHub操作来部署云工作流</h2><p id="0a84" class="pw-post-body-paragraph iu iv hi iw b ix lw iz ja jb lx jd je jf ly jh ji jj lz jl jm jn ma jp jq jr hb bi translated">接下来，我们将通过两个步骤为我们的回购创建GitHub操作:</p><figure class="mc md me mf fd ij"><div class="bz dy l di"><div class="mu mv l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated"><code class="du ku kv kw kx b">.github/workflows/deploy-cloud-workflow.yaml</code></figcaption></figure><p id="5bd6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">该操作包含以下步骤:</p><ul class=""><li id="7a22" class="ka kb hi iw b ix iy jb jc jf kc jj kd jn ke jr kf kg kh ki bi translated"><em class="js">步骤1: </em>设置方便的<code class="du ku kv kw kx b"><a class="ae mw" href="https://github.com/google-github-actions/setup-gcloud" rel="noopener ugc nofollow" target="_blank">setup-gcloud</a></code> <a class="ae mw" href="https://github.com/google-github-actions/setup-gcloud" rel="noopener ugc nofollow" target="_blank">动作</a>以在我们的GitHub工作流中启用<code class="du ku kv kw kx b">gcloud</code>。</li><li id="3ab9" class="ka kb hi iw b ix kj jb kk jf kl jj km jn kn jr kf kg kh ki bi translated"><em class="js">第2步:</em>运行<code class="du ku kv kw kx b">gcloud workflows deploy</code>命令，将源代码、项目和服务帐户等配置存储为GitHub机密。</li></ul><blockquote class="ko kp kq"><p id="5873" class="iu iv js iw b ix iy iz ja jb jc jd je kr jg jh ji ks jk jl jm kt jo jp jq jr hb bi translated">如果您想要在云工作流中部署不同的工作流名称，或者使用不同的YAML文件，请确保在此文件中更改您的设置。</p></blockquote><h2 id="f9ff" class="mg kz hi bd la mh mi mj le mk ml mm li jf mn mo lm jj mp mq lq jn mr ms lu mt bi translated">3.使用服务帐户授权GitHub操作</h2><p id="1898" class="pw-post-body-paragraph iu iv hi iw b ix lw iz ja jb lx jd je jf ly jh ji jj lz jl jm jn ma jp jq jr hb bi translated">现在，棘手的部分是允许GitHub在没有您的干预或凭证的情况下代表您部署云工作流。</p><p id="f90c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在上一步中，我们告诉GitHub动作使用一个服务帐户🤖<em class="js"> </em>储存在GitHub的秘密。我们需要实际设置:</p><p id="c601" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里有一个方便的脚本，用于创建一个具有更新云工作流所需的IAM角色的服务帐户。我们将使用<a class="ae mw" href="https://cli.github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub CLI </a>，<code class="du ku kv kw kx b">gh</code>，将这些属性添加到我们的GitHub repo中。</p><figure class="mc md me mf fd ij"><div class="bz dy l di"><div class="mu mv l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">setup_iam.sh</figcaption></figure><p id="3517" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这个脚本中，我们将向GitHub添加一个角色为<code class="du ku kv kw kx b">workflows.editor</code>和<code class="du ku kv kw kx b">iam.serviceAccountUser</code>的服务帐户密钥，这样GitHub Actions就可以拥有部署我们工作流的权限。</p><h1 id="5fce" class="ky kz hi bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">工作流程</h1><p id="c8c1" class="pw-post-body-paragraph iu iv hi iw b ix lw iz ja jb lx jd je jf ly jh ji jj lz jl jm jn ma jp jq jr hb bi translated">现在，有了这个设置，我们可以简单地推进到我们的主分支，看到我们的GitHub动作在后台工作。我们甚至可以查看日志，查看所有执行的历史记录。太棒了。</p><p id="92d1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里有一张gif图片，展示了GitHub上的动作:</p><figure class="mc md me mf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/5eaa2b7e529a676e9b3a8899094f37f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wxi6bZQPSpc_SOwWdLSW2A.gif"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">部署云工作流操作</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="cdb8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">感谢阅读！有点meta吧？如果你喜欢这篇文章，请鼓掌(或两下)👏。</p><p id="f52a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">或许你也可以看看其他相关的帖子:</p><ul class=""><li id="8ad5" class="ka kb hi iw b ix iy jb jc jf kc jj kd jn ke jr kf kg kh ki bi translated"><a class="ae mw" rel="noopener" href="/google-cloud/call-a-workflow-from-a-function-51fc7fc8e1ff">🚀从函数中调用工作流！</a></li></ul></div></div>    
</body>
</html>