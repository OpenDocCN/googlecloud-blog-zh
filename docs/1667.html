<html>
<head>
<title>Working with Cloud Spanner and Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用云扳手和Java</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/working-with-cloud-spanner-and-java-16e44ebc63b6?source=collection_archive---------3-----------------------#2020-11-16">https://medium.com/google-cloud/working-with-cloud-spanner-and-java-16e44ebc63b6?source=collection_archive---------3-----------------------#2020-11-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="dfc4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经在以前的帖子中讨论了Google Cloud Spanner的架构细节，现在是时候更深入地讨论使用Google Cloud Spanner构建应用程序的细节了。</p><p id="699d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您决定在Cloud Spanner上构建您的应用程序，您可以依赖ANSI 2011 SQL支持和多种语言的客户端库。有很棒的教程可以帮助你入门，尽管它们没有深入讨论使用Java时的不同选项；通过客户端库的数据操作语言或变体，或者通过两个JDBC驱动程序的SQL/DML。</p><p id="90f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不打算深入讨论这些概念，但是我希望提供足够的信息来帮助您理解作为使用Cloud Spanner的Java开发人员的不同选择。为了确保我得到了正确的细节，这篇文章和为它编写的代码<a class="ae jd" href="https://github.com/helix-collective/spanner-dml-mutations-examples/tree/master" rel="noopener ugc nofollow" target="_blank">(你可以在这里克隆)</a>得到了Java专家<a class="ae jd" rel="noopener" href="/@prunge_24023">彼得·龙格</a>(更恰当的说法是<a class="ae jd" href="https://github.com/prunge-helix" rel="noopener ugc nofollow" target="_blank"> prunge-helix on Github </a>)的技术支持</p><p id="eb6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用与Google Cloud Spanner入门指南相同的模式，这在Cloud Spanner文档中的<a class="ae jd" href="https://cloud.google.com/spanner/docs/schema-and-data-model#creating-interleaved-tables" rel="noopener ugc nofollow" target="_blank">模式和数据模型</a>页面上有详细解释。</p><p id="2e31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们实际上是在创建一个音乐应用程序，我们的目录包含了歌手及其专辑的详细信息。歌手和专辑之间强大的父子关系非常适合一种独特的云扳手优化，称为交叉表，这在该页面上有描述，非常值得理解。</p><h1 id="4a72" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">示例和选项</h1><h1 id="d416" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">ORMs和JDBC司机</h1><p id="9417" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">如果你是一个经验丰富的Java程序员，使用ORM或<a class="ae jd" href="https://cloud.google.com/spanner/docs/jdbc-drivers" rel="noopener ugc nofollow" target="_blank"> JDBC驱动</a>与Cloud Spanner交互可能更容易或更相关。</p><p id="d1bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ORMs还可以让你用自己选择的语言在Cloud Spanner中操作数据变得更加容易，而不必编写DML。在许多情况下，这些都是现有Cloud Spanner APIs的包装。例如在带有spring的Java中，spring-Cloud-GCP-starter-data-Spanner使用云Spanner API(com . Google . Cloud . Spanner . *)来执行语句。</p><p id="b66d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当遵循现代编程实践时，与在代码中散布DML相比，使用ORM与数据库进行交互要容易和一致得多。因为ORM经常使用现有的客户机库，所以使用DML的所有好处都要比使用变体的好处多。得到了维护。</p><p id="ff8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于带有SpringData的ORM，我们将首先创建歌手表:</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="7e26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将创建相册表:</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="eee7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，我们必须创建接口:</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="3c0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们可以使用这些表格:</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="a58d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有两个JDBC驱动程序，包括一个由谷歌编写的开源驱动程序。它利用客户端库连接到Cloud Spanner，并允许您执行SQL和扩展DML。</p><p id="2e07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您的语句需要在执行前将许多对象保存在内存中，那么使用JDBC驱动程序对数据库执行语句可能会更有效。需要多个连接、分组和聚合的大型语句可能很难用面向对象的方式管理，而编写包含这些操作的单个DML语句可能更简单。但是，从执行的角度来看，后一个例子在ORM和DML中不会大致相同</p><p id="fab3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，如果您正在连接一个现成的应用程序，最简单的集成可能是通过JDBC驱动程序进行连接。</p><h1 id="6ca1" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">关于SQL/DML的快速说明</h1><p id="3de6" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">Cloud Spanner支持ANSI 2011兼容SQL，使您能够使用声明性SQL语句查询数据库，这些语句指定了您想要检索的数据。</p><p id="8c4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有<a class="ae jd" href="https://cloud.google.com/spanner/docs/sql-best-practices" rel="noopener ugc nofollow" target="_blank"> SQL最佳实践</a>可以帮助Cloud Spanner以最高效的方式找到相关数据，了解Cloud Spanner如何执行SQL语句可以大大提高性能。例如，使用参数和辅助索引是提高查询性能的两种方法。</p><h1 id="156e" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">数据操作语言(DML)和分区DML</h1><p id="9ea5" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">DML可用于在云控制台、gcloud命令行工具和客户端库中插入、更新和删除语句。DML是为事务处理设计的，其中<a class="ae jd" href="https://cloud.google.com/spanner/docs/dml-partitioned" rel="noopener ugc nofollow" target="_blank">分区DML </a>是为批量更新和删除设计的，对并发事务处理的影响最小。在分区DML中，这是通过对键空间进行分区并在单独的、较小范围的事务中的分区上运行语句来实现的。</p><p id="e7a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">DML语句在读写事务内部执行，只在您访问的列上获取锁。对于读取，共享锁用于确保一致性，写入或修改会导致排他锁。</p><p id="6491" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下<a class="ae jd" href="https://cloud.google.com/spanner/docs/dml-best-practices" rel="noopener ugc nofollow" target="_blank"> DML最佳实践</a>将有助于提高性能，并最大限度地减少锁定。</p><p id="dab1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们将通过使用Java JDBC来执行DDL和DML语句，来执行ORM示例中说明的相同步骤</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="c7b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">突变</p><p id="56fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个突变代表一系列的插入、更新和删除，Cloud Spanner原子地应用到Cloud Spanner数据库中的不同行和表。这些是通过<a class="ae jd" href="https://cloud.google.com/spanner/docs/modify-mutation-api" rel="noopener ugc nofollow" target="_blank">突变API </a>执行的。</p><p id="686e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然您可以通过使用<a class="ae jd" href="https://cloud.google.com/spanner/docs/reference/rpc/google.spanner.v1#google.spanner.v1.CommitRequest" rel="noopener ugc nofollow" target="_blank"> gRPC </a>或<a class="ae jd" href="https://cloud.google.com/spanner/docs/reference/rest/v1/projects.instances.databases.sessions/commit" rel="noopener ugc nofollow" target="_blank"> REST </a>来提交突变，但是更常见的是通过客户端库访问API。</p><p id="9e2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想更深入地研究这个话题，Peter Runge将在下周发表一篇关于DML和突变的文章。</p><p id="c2da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于这是第三个例子，我们将假设您已经创建了表，并通过使用突变API向我们的歌手和专辑表添加数据来节省一些时间</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="d39f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你只是想使用标准客户端库，那么<a class="ae jd" href="https://cloud.google.com/spanner/docs/getting-started/java" rel="noopener ugc nofollow" target="_blank">入门指南</a>会带你浏览我们下面引用的同一个例子，代码是发布在github 上的<a class="ae jd" href="https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/spanner/cloud-client/src/main/java/com/example/spanner/SpannerSample.java" rel="noopener ugc nofollow" target="_blank"/></p><p id="b0c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ORM和JDBC驱动程序也使用客户端库，所以您也可以使用它们来执行DDL:</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="km kn l"/></div></figure></div></div>    
</body>
</html>