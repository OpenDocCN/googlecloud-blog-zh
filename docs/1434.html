<html>
<head>
<title>Google Cloud Data Catalog — Live Sync Your On-Prem Hive Server Metadata Changes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google云数据目录—实时同步您的本地配置单元服务器元数据更改</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-cloud-data-catalog-live-sync-your-on-prem-hive-server-metadata-changes-4f5e661626d8?source=collection_archive---------2-----------------------#2020-05-19">https://medium.com/google-cloud/google-cloud-data-catalog-live-sync-your-on-prem-hive-server-metadata-changes-4f5e661626d8?source=collection_archive---------2-----------------------#2020-05-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="a136" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">代码示例提供了一种实用的方法，说明如何将元数据更改从本地配置单元服务器增量接收到Google Cloud Data Catalog中</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/dca5293a153c943a699bc579c3dd4499.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lmfO_Hng2r0-bfEjakHz6g.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">背景由<a class="ae jn" href="https://unsplash.com/@jjying?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> JJ颖</a>上<a class="ae jn" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><blockquote class="jo jp jq"><p id="a168" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated"><strong class="ju hj">免责声明:所有表达的观点均为我个人观点，仅代表我个人……</strong>。<strong class="ju hj">它们来自参与开发完全可操作的示例连接器的经验，可从:</strong><a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors" rel="noopener ugc nofollow" target="_blank"><strong class="ju hj">github</strong></a><strong class="ju hj">获得。</strong></p></blockquote><h1 id="cc9a" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">挑战</h1><p id="e336" class="pw-post-body-paragraph jr js hi ju b jv lg ij jx jy lh im ka li lj kd ke lk ll kh ki lm ln kl km kn hb bi translated">进入大数据世界绝非易事，数据量可能会很快失控。看看<a class="ae jn" href="https://eng.uber.com/uber-big-data-platform/" rel="noopener ugc nofollow" target="_blank">优步的故事</a>，关于他们如何使用Hadoop生态系统处理100的数据，想象一下，如果每次他们将他们的本地元数据同步到数据目录时，都执行完整的运行，那将是不切实际的。</p><p id="5c32" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka li kc kd ke lk kg kh ki lm kk kl km kn hb bi translated">我们需要一种方法来监视在Hive服务器上执行的更改，每当表或数据库被修改时，我们就捕获这种更改，并将其增量地保存在我们的数据目录中。</p><blockquote class="lo"><p id="22de" class="lp lq hi bd lr ls lt lu lv lw lx kn dx translated">如果您错过了<a class="ae jn" rel="noopener" href="/google-cloud/google-cloud-data-catalog-keep-up-with-your-on-prem-hive-server-237edd1a1888">上一篇文章</a>，我们展示了将本地配置单元元数据摄取到数据目录中，在这种情况下，我们没有使用增量解决方案。</p></blockquote><p id="569b" class="pw-post-body-paragraph jr js hi ju b jv ly ij jx jy lz im ka li ma kd ke lk mb kh ki lm mc kl km kn hb bi translated"><strong class="ju hj">为了掌握情况，一个完整的运行用了~ </strong> <code class="du md me mf mg b"><strong class="ju hj">1000</strong></code> <strong class="ju hj">表用了差不多20分钟，即使只有1个表发生了变化。在优步的故事中，这一点都不好玩，对吗？</strong></p><blockquote class="jo jp jq"><p id="064d" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated"><em class="hi">旁注:本文假设您对什么是数据目录和配置单元有所了解。如果您想了解更多关于数据目录的信息，请阅读</em> <a class="ae jn" href="https://cloud.google.com/data-catalog/" rel="noopener ugc nofollow" target="_blank"> <em class="hi">官方文档</em> </a> <em class="hi">。</em></p></blockquote></div><div class="ab cl mh mi gp mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hb hc hd he hf"><h1 id="c962" class="ko kp hi bd kq kr mo kt ku kv mp kx ky io mq ip la ir mr is lc iu ms iv le lf bi translated">实时同步架构</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mt"><img src="../Images/749bbdd0193e1126b33802bf5ddc2f3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wLFfvDdEn9DMYtn-jqF_0w.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">实时同步架构</figcaption></figure><p id="30a6" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka li kc kd ke lk kg kh ki lm kk kl km kn hb bi translated">有多种方法可以监听在Hive服务器上执行的更改，本文比较了两种方法:<a class="ae jn" href="https://towardsdatascience.com/apache-hive-hooks-and-metastore-listeners-a-tale-of-your-metadata-903b751ee99f" rel="noopener" target="_blank"> Hive挂钩x Hive Metastore监听器</a>。</p><p id="b2d6" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka li kc kd ke lk kg kh ki lm kk kl km kn hb bi translated">所展示的架构使用了一个<code class="du md me mf mg b">Hive Metastore Listener</code>，这是为了简化已经解析的元数据。</p><h2 id="ebdb" class="mu kp hi bd kq mv mw mx ku my mz na ky li nb nc la lk nd ne lc lm nf ng le nh bi translated"><strong class="ak">本地Hadoop环境端</strong></h2><p id="8040" class="pw-post-body-paragraph jr js hi ju b jv lg ij jx jy lh im ka li lj kd ke lk ll kh ki lm ln kl km kn hb bi translated">这里的主要组件是一个用Java编写的代理，它监听5个Metastore事件:<code class="du md me mf mg b">onAlterTable</code>、<code class="du md me mf mg b">onCreateTable</code>、<code class="du md me mf mg b">onCreateDatabase</code>、<code class="du md me mf mg b">onDropTable</code>、<code class="du md me mf mg b">onDropDatabase</code>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ni"><img src="../Images/ff468aad70bd0ca157dad02a244c435b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CbHKtUfLojTNrEWwMua-hg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">onCreateTable —为了更好的可读性，隐藏了其他事件</figcaption></figure><p id="5ad2" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka li kc kd ke lk kg kh ki lm kk kl km kn hb bi translated">这是一段非常简单的代码，它获取事件并将其发送到PubSub主题。关于如何设置和其他事件的详细信息，请查看<a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-hive/tree/master/hive-metastore-listener" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>。</p><blockquote class="jo jp jq"><p id="4ddd" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">代理在Hive Metastore进程中运行，该进程必须位于能够访问Google Cloud项目的网络中，并且在其中设置的服务帐户需要主题中的发布/订阅发布者角色。</p></blockquote><h2 id="ced0" class="mu kp hi bd kq mv mw mx ku my mz na ky li nb nc la lk nd ne lc lm nf ng le nh bi translated"><strong class="ak">谷歌云平台端</strong></h2><p id="3554" class="pw-post-body-paragraph jr js hi ju b jv lg ij jx jy lh im ka li lj kd ke lk ll kh ki lm ln kl km kn hb bi translated">这里的主要组件是<strong class="ju hj"> PubSub </strong>和<strong class="ju hj"> Hive到数据目录连接器</strong>。</p><ul class=""><li id="5c94" class="nj nk hi ju b jv jw jy jz li nl lk nm lm nn kn no np nq nr bi translated"><strong class="ju hj"> PubSub </strong>:作为<strong class="ju hj"> </strong>持久事件摄取和交付系统层。</li><li id="9200" class="nj nk hi ju b jv ns jy nt li nu lk nv lm nw kn no np nq nr bi translated"><strong class="ju hj">连接器(Scrape/Prepare/Ingest) </strong>:这一层将Hive Metastore消息转换为数据目录资产，并持久化它——有关其工作原理的详细信息，请查看本文中的<a class="ae jn" rel="noopener" href="/google-cloud/google-cloud-data-catalog-keep-up-with-your-on-prem-hive-server-237edd1a1888">。</a></li></ul><p id="2888" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka li kc kd ke lk kg kh ki lm kk kl km kn hb bi translated">我们还有<strong class="ju hj">云运行</strong>、<strong class="ju hj">、</strong>，它作为边车web服务器接收来自<strong class="ju hj"> PubSub </strong>的消息并触发<strong class="ju hj">连接器</strong>。</p><p id="8e04" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka li kc kd ke lk kg kh ki lm kk kl km kn hb bi translated">这是一段非常简单的代码，它从<code class="du md me mf mg b">hive2datacatalog</code> Python模块调用<code class="du md me mf mg b">Synchronizer</code>类，从而触发<code class="du md me mf mg b">Scrape</code> / <code class="du md me mf mg b">Prepare</code> / <code class="du md me mf mg b">Ingest</code>步骤。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nx"><img src="../Images/e84e82c3cda228deef2df92b0ae5d8e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*yx2ATqL5Hg8SPHw3j3l7vg.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">云跑边车</figcaption></figure><blockquote class="jo jp jq"><p id="450e" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">有关如何设置云运行侧车的详细信息，请查看连接器<a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-hive" rel="noopener ugc nofollow" target="_blank"> github repo </a>。</p></blockquote></div><div class="ab cl mh mi gp mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hb hc hd he hf"><h1 id="24df" class="ko kp hi bd kq kr mo kt ku kv mp kx ky io mq ip la ir mr is lc iu ms iv le lf bi translated">触发连接器</h1><p id="434a" class="pw-post-body-paragraph jr js hi ju b jv lg ij jx jy lh im ka li lj kd ke lk ll kh ki lm ln kl km kn hb bi translated">让我们创建一个新的<code class="du md me mf mg b">database</code>和<code class="du md me mf mg b">table</code>来看看它是如何工作的</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ny"><img src="../Images/18065b4500dde68bc24f16ce13b10200.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*aGGh0Hug301cKRvWMth8Eg.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">Hive服务器终端</figcaption></figure><p id="a105" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka li kc kd ke lk kg kh ki lm kk kl km kn hb bi translated">检查配置单元Metastore日志，我们可以看到两条消息被发送到PubSub</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nz"><img src="../Images/41a2530adc0933bdd8d49546085dcd41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gv7V1l-_N-BtA9DJX56W_w.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">Hive Metastore日志—为了提高可读性，某些数据被隐藏起来</figcaption></figure><p id="1014" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka li kc kd ke lk kg kh ki lm kk kl km kn hb bi translated">转到云运行，我们可以查看执行日志</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es oa"><img src="../Images/5005df3f73bf3b2415319778f0f8bc62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*RxEKn86ZWnp9D3sUfwfkoA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">云运行日志-为了提高可读性，某些行被抑制</figcaption></figure><h2 id="8353" class="mu kp hi bd kq mv mw mx ku my mz na ky li nb nc la lk nd ne lc lm nf ng le nh bi translated">结果</h2><p id="d9ce" class="pw-post-body-paragraph jr js hi ju b jv lg ij jx jy lh im ka li lj kd ke lk ll kh ki lm ln kl km kn hb bi translated">最后，让我们使用数据目录用户界面打开新条目</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ob"><img src="../Images/d45e9d375a5a8c2f9596d52b7ba83e20.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/format:webp/1*0gLauoWL1UgOGexAJqWcGw.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">中型数据库条目</figcaption></figure><div class="iy iz ja jb fd ab cb"><figure class="oc jc od oe of og oh paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><img src="../Images/2c228ee20d078ec1846f7e99e9fe0a52.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/format:webp/1*pEw1h0ftii8PEpxrRw-J9w.png"/></div></figure><figure class="oc jc oi oe of og oh paragraph-image"><img src="../Images/d335ee0f91c84560d99bbfc8389a48c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*4-BNPT50DhPPqiTEdIk3gg.png"/><figcaption class="jj jk et er es jl jm bd b be z dx oj di ok ol translated">张贴表格条目</figcaption></figure></div><p id="5a4e" class="pw-post-body-paragraph jr js hi ju b jv jw ij jx jy jz im ka li kc kd ke lk kg kh ki lm kk kl km kn hb bi translated">几秒钟之内，我们就可以搜索新创建的条目。</p></div><div class="ab cl mh mi gp mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hb hc hd he hf"><h1 id="63e8" class="ko kp hi bd kq kr mo kt ku kv mp kx ky io mq ip la ir mr is lc iu ms iv le lf bi translated">样本连接器</h1><p id="bb10" class="pw-post-body-paragraph jr js hi ju b jv lg ij jx jy lh im ka li lj kd ke lk ll kh ki lm ln kl km kn hb bi translated">本文中讨论的所有主题都包含在一个连接器示例中，该示例可在GitHub上获得:<a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-hive" rel="noopener ugc nofollow" target="_blank"> <strong class="ju hj">蜂巢连接器</strong> </a>。请随意获取并按照说明运行。顺便说一下，欢迎捐款！</p><blockquote class="jo jp jq"><p id="3047" class="jr js jt ju b jv jw ij jx jy jz im ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated"><em class="hi">其根据Apache License Version 2.0获得许可，按“原样”分发，没有任何形式的明示或暗示的保证或条件。</em></p></blockquote></div><div class="ab cl mh mi gp mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hb hc hd he hf"><h1 id="ac03" class="ko kp hi bd kq kr mo kt ku kv mp kx ky io mq ip la ir mr is lc iu ms iv le lf bi translated">结束语</h1><p id="10c7" class="pw-post-body-paragraph jr js hi ju b jv lg ij jx jy lh im ka li lj kd ke lk ll kh ki lm ln kl km kn hb bi translated">在本文中，我们已经介绍了如何以可扩展和高效的方式，将元数据从Hive逐步引入Google Cloud Data Catalog，使用户能够集中管理他们的元数据。请继续关注新的帖子，展示如何在其他源系统上做同样的事情！干杯！</p><h1 id="1152" class="ko kp hi bd kq kr ks kt ku kv kw kx ky io kz ip la ir lb is lc iu ld iv le lf bi translated">参考</h1><ul class=""><li id="def0" class="nj nk hi ju b jv lg jy lh li om lk on lm oo kn no np nq nr bi translated"><strong class="ju hj">Connector git hub Repo</strong>:<a class="ae jn" href="https://github.com/GoogleCloudPlatform/datacatalog-connectors-hive" rel="noopener ugc nofollow" target="_blank">https://git hub . com/GoogleCloudPlatform/data catalog-connectors-hive</a></li><li id="d337" class="nj nk hi ju b jv ns jy nt li nu lk nv lm nw kn no np nq nr bi translated"><strong class="ju hj">数据目录GA博客帖子</strong>:<a class="ae jn" href="https://cloud.google.com/blog/products/data-analytics/data-catalog-metadata-management-now-generally-available" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/blog/products/Data-analytics/Data-Catalog-metadata-management-now-general-available</a></li><li id="6028" class="nj nk hi ju b jv ns jy nt li nu lk nv lm nw kn no np nq nr bi translated"><strong class="ju hj">数据目录正式文件</strong>:<a class="ae jn" href="https://cloud.google.com/data-catalog/" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/data-catalog/</a></li><li id="4547" class="nj nk hi ju b jv ns jy nt li nu lk nv lm nw kn no np nq nr bi translated"><strong class="ju hj">代码示例</strong>:<a class="ae jn" href="https://cloud.google.com/data-catalog/docs/how-to/custom-entries#data-catalog-custom-entry-python" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/data-catalog/docs/how-to/custom-entries # data-catalog-custom-entry-python</a></li><li id="6c94" class="nj nk hi ju b jv ns jy nt li nu lk nv lm nw kn no np nq nr bi translated"><strong class="ju hj">Hive hooks x Hive Metastore Listeners post</strong>:<a class="ae jn" href="https://towardsdatascience.com/apache-hive-hooks-and-metastore-listeners-a-tale-of-your-metadata-903b751ee99f" rel="noopener" target="_blank">https://towards data sciences . com/Apache-Hive-hooks-and-Metastore-Listeners-a-tale-of-of-to-towers-of-to-towers-of-to-towers-to-towers-to-towers-to-towers-to-towers-to-towers-</a></li></ul></div></div>    
</body>
</html>