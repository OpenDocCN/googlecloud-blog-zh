<html>
<head>
<title>Deploying to Microk8s with Anthos Config Management</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Anthos配置管理部署到Microk8s</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/deploying-to-microk8s-with-anthos-config-management-49a39ac821ce?source=collection_archive---------0-----------------------#2020-11-23">https://medium.com/google-cloud/deploying-to-microk8s-with-anthos-config-management-49a39ac821ce?source=collection_archive---------0-----------------------#2020-11-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div class="er es hg"><img src="../Images/bd8e1f6a5e2fa725183d328b7e478b86.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*0_A9RyhgzOv53VG4DrV3SQ.png"/></div></figure><div class=""/><p id="7c1d" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><a class="ae jk" href="https://cloud.google.com/anthos/config-management" rel="noopener ugc nofollow" target="_blank"> Anthos配置管理</a>使您能够为您的混合云和多云Kubernetes部署大规模自动化策略和安全性。在高层次上，您将Kubernetes代码提交到一个中央Git存储库，然后Anthos Config Management将代码部署到所有注册的集群。简而言之，Anthos配置管理允许您将GitOps实践引入到多云容器管理的世界中。</p><p id="ad5c" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">基于GKE的集群和<a class="ae jk" href="https://cloud.google.com/anthos/docs/setup/attached-clusters" rel="noopener ugc nofollow" target="_blank"> Anthos附属集群</a>都支持Anthos配置管理，这是一个部署选项，将Anthos的范围扩展到运行在其他云环境中的Kubernetes集群。虽然我通常使用GKE集群，但我决定尝试将Microk8s集群附加到Anthos。<a class="ae jk" href="https://microk8s.io/" rel="noopener ugc nofollow" target="_blank"> Microk8s </a>是一个在物联网和边缘环境中看到的Kubernetes平台。虽然Microk8s本身不是官方支持的Anthos平台，但是您可以尝试使用MicroK8s来了解更多关于Anthos配置管理的知识，并了解它如何为组织带来好处。</p><p id="b8f8" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">该项目使用以下谷歌云服务:</p><ul class=""><li id="47a4" class="jl jm hp io b ip iq it iu ix jn jb jo jf jp jj jq jr js jt bi translated"><a class="ae jk" href="https://cloud.google.com/compute" rel="noopener ugc nofollow" target="_blank">计算引擎</a>为单节点Microk8s集群提供Ubuntu实例。Ubuntu将使用<a class="ae jk" href="https://cloudinit.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> cloud-init </a>安装Microk8s并生成shell脚本和其他文件以节省时间。</li><li id="4749" class="jl jm hp io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated"><a class="ae jk" href="https://cloud.google.com/source-repositories" rel="noopener ugc nofollow" target="_blank">云资源存储库</a>将提供基于Git的存储库，我们将把工作负载提交给它。</li><li id="f4e6" class="jl jm hp io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated"><a class="ae jk" href="https://cloud.google.com/anthos/config-management" rel="noopener ugc nofollow" target="_blank"> Anthos配置管理</a>将执行从存储库到Microk8s集群的部署。</li></ul><h1 id="599f" class="jz ka hp bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">先来一张图</h1><p id="cec1" class="pw-post-body-paragraph im in hp io b ip kx ir is it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj hb bi translated">下面是这些组件如何组合在一起的示意图。</p><figure class="ld le lf lg fd hk er es paragraph-image"><div class="er es lc"><img src="../Images/54a47e001e2c297e0541bb8a8e8fc70e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*jI5tuw9XNOi8e6OZY0BN7g.png"/></div></figure><ul class=""><li id="b061" class="jl jm hp io b ip iq it iu ix jn jb jo jf jp jj jq jr js jt bi translated">创建一个工作站实例，Terraform从该实例中用于部署四件事情:(1)一个IAM服务帐户，(2)一个使用由服务帐户提供的权限的带有Microk8s的Google计算引擎实例，(3)一个由云源存储库提供的Kubernetes配置报告，以及(4)一个公共/私有密钥对。</li><li id="a13e" class="jl jm hp io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">GCE实例将使用服务帐户密钥向GKE中心注册Microk8s集群。尽管在本演练中我们将使用Microk8s而不是GKE，但是GKE中心作为一个注册点，使集群对Anthos可用。</li><li id="6ab6" class="jl jm hp io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">公钥/私钥对中的公钥将被注册到存储库中，而私钥将被注册到Microk8s集群中。</li><li id="7df1" class="jl jm hp io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">Anthos配置管理将被配置为指向存储库和分支来轮询更新。</li><li id="ceb1" class="jl jm hp io b ip ju it jv ix jw jb jx jf jy jj jq jr js jt bi translated">当Kubernetes YAML文档被推送到存储库的适当分支时，Anthos Config Management将使用私钥连接到存储库，检测针对分支的提交，获取文件并将文档应用到Microk8s集群。</li></ul><p id="f92d" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果你想了解更多，请查看这个库。您将找到关于如何使用Anthos Config Management构建如上所示的基础设施并将应用程序部署到Microk8s的说明。</p><h1 id="d40f" class="jz ka hp bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">几句结束语</h1><p id="8f9c" class="pw-post-body-paragraph im in hp io b ip kx ir is it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj hb bi translated">Anthos配置管理使您能够将代码从Git存储库部署到已经向Anthos注册的Kubernetes集群。Google Cloud目前支持GKE、AKS和EKS集群，但是您也可以尝试其他兼容的集群，包括Microk8s。</p><p id="1cd5" class="pw-post-body-paragraph im in hp io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个例子展示了如何注册一个Microk8s集群，以便从云资源存储库提供的存储库中接收部署。您可以将它扩展到更大数量的集群，所有集群都可以从对存储库的提交中接收更新。简而言之，Anthos配置管理允许您将Git-ops实践带到Kubernetes部署的世界中。</p></div></div>    
</body>
</html>