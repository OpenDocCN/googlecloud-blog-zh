<html>
<head>
<title>Fabric on Google Cloud Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云平台上的Fabric</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/fabric-on-google-cloud-platform-97525323457c?source=collection_archive---------0-----------------------#2018-06-04">https://medium.com/google-cloud/fabric-on-google-cloud-platform-97525323457c?source=collection_archive---------0-----------------------#2018-06-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d11b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢IBM工程师编写了一个<a class="ae jd" href="https://helm.sh/" rel="noopener ugc nofollow" target="_blank">掌舵</a> <a class="ae jd" href="https://github.com/IBM-Blockchain/ibm-container-service" rel="noopener ugc nofollow" target="_blank">图表</a>来部署<a class="ae jd" href="https://www.hyperledger.org/projects/fabric" rel="noopener ugc nofollow" target="_blank">结构</a>作为IBM区块链平台的一部分。将它移植到<a class="ae jd" href="http://cloud.google.com/kubernetes-engine" rel="noopener ugc nofollow" target="_blank"> Kubernetes引擎</a>相对简单，尽管目前这只是一个工作的结构网络，我现在需要配置工具(<a class="ae jd" href="https://www.hyperledger.org/projects/composer" rel="noopener ugc nofollow" target="_blank"> Composer </a>)。</p><h2 id="17a2" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">库伯内特发动机</h2><p id="a9f4" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">给自己创造一个Kubernetes。我正在尝试开拓，所以我使用了一个区域集群，并启用了新的Kubernetes监控功能。</p><p id="9f39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">更新</strong>:所以，我没那么先锋，<a class="ae jd" href="https://cloudplatform.googleblog.com/2018/06/Regional-clusters-in-Google-Kubernetes-Engine-are-now-generally-available.html'" rel="noopener ugc nofollow" target="_blank">区域集群现在GA </a> :-)耶！</p><p id="63e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这一切似乎都工作得很好，类似于:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="ae1f" class="je jf hi kj b fi kn ko l kp kq">PROJECT=[[YOUR-PROJECT]]<br/>REGION=[[YOUR-REGION]]<br/>CLUSTER=[[YOUR-CLUSTER]]<br/>BILLING=[[YOUR-BILLING]]<br/>LATEST=1.10.2-gke.3</span><span id="a5df" class="je jf hi kj b fi kr ko l kp kq">WORKDIR=[[YOUR-WORKDIR]]</span><span id="3c4e" class="je jf hi kj b fi kr ko l kp kq">mkdir -p /tmp/${WORKDIR} &amp;&amp; cd /tmp/${WORKDIR}</span><span id="5edd" class="je jf hi kj b fi kr ko l kp kq">gcloud projects create ${PROJECT}</span><span id="58c8" class="je jf hi kj b fi kr ko l kp kq">gcloud beta billing projects link ${PROJECT} \<br/>--billing-account=${BILLING}</span><span id="510d" class="je jf hi kj b fi kr ko l kp kq">gcloud services enable container.googleapis.com \<br/>--project=$PROJECT</span><span id="cff3" class="je jf hi kj b fi kr ko l kp kq">gcloud beta container clusters create $CLUSTER \<br/>--username="" \<br/>--cluster-version=${LATEST} \<br/>--machine-type=custom-1-4096 \<br/>--image-type=COS \<br/>--num-nodes=1 \<br/>--enable-autorepair \<br/>--enable-autoscaling \<br/>--enable-autoupgrade \<br/>--enable-stackdriver-kubernetes \<br/>--min-nodes=1 \<br/>--max-nodes=2 \<br/>--region=${REGION} \<br/>--project=${PROJECT} \<br/>--preemptible \<br/>--scopes="<a class="ae jd" href="https://www.googleapis.com/auth/cloud-platform" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/cloud-platform</a>"</span><span id="a57c" class="je jf hi kj b fi kr ko l kp kq">gcloud beta container clusters get-credentials $CLUSTER \<br/>--project=${PROJECT} \<br/>--region=${REGION}</span><span id="344f" class="je jf hi kj b fi kr ko l kp kq">kubectl create clusterrolebinding $(whoami)-cluster-admin-binding \<br/>--clusterrole=cluster-admin \<br/>--user=$(gcloud config get-value account)</span><span id="a00a" class="je jf hi kj b fi kr ko l kp kq">kubectl create clusterrolebinding kube-dashboard-admin \<br/>--clusterrole=cluster-admin \<br/>--serviceaccount=kube-system:kubernetes-dashboard</span></pre><p id="cbfe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该能够:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="b198" class="je jf hi kj b fi kn ko l kp kq">kubectl cluster-info<br/>kubectl get nodes</span></pre><p id="d2aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">掌舵图需要一个Kubernetes持久卷，即<code class="du ks kt ku kj b">ReadWriteMany</code>。这在目前的谷歌云平台上并不容易…咳…谷歌…咳…</p><p id="dbb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们将使用NFS来提供多读功能。具有讽刺意味的是，我们将要使用的NFS解决方案本身是由谷歌持久磁盘支持的。让我们创建NFS服务器，因为舵图依赖于它。</p><h2 id="9c29" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">网络文件系统</h2><p id="5af5" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">感谢<a class="ae jd" href="https://github.com/mappedinn" rel="noopener ugc nofollow" target="_blank"> mappedinn </a>，我用他们的回购<code class="du ks kt ku kj b"><a class="ae jd" href="https://github.com/mappedinn/kubernetes-nfs-volume-on-gke" rel="noopener ugc nofollow" target="_blank">kubernetes-nfs-volume-on-gke</a></code>得到了这个设置。这使用了谷歌的<code class="du ks kt ku kj b"><a class="ae jd" href="https://console.cloud.google.com/gcr/images/google-containers/GLOBAL/volume-nfs?gcrImageListsize=50" rel="noopener ugc nofollow" target="_blank">volume-nfs</a></code>图片，效果很好。</p><p id="a9e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建底层持久磁盘:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="799f" class="je jf hi kj b fi kn ko l kp kq">ZONE=${REGION}-c</span><span id="cca5" class="je jf hi kj b fi kr ko l kp kq">gcloud compute disks create nfs-disk \<br/>--project=${PROJECT} \<br/>--zone=${ZONE} \<br/>--type=pd-standard \<br/>--size=10GB</span></pre><p id="c942" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后应用下面的部署并为您的Kubernetes集群提供服务。部署使用Google托管的<code class="du ks kt ku kj b">volume-nfs</code>映像创建NFS服务，并将服务绑定到持久磁盘:</p><figure class="ke kf kg kh fd kv"><div class="bz dy l di"><div class="kw kx l"/></div></figure><blockquote class="ky kz la"><p id="90a3" class="if ig lb ih b ii ij ik il im in io ip lc ir is it ld iv iw ix le iz ja jb jc hb bi translated"><strong class="ih hj">注意</strong>如果您更喜欢使用SSD持久磁盘而不是标准(HDD)持久磁盘，请将部署脚本中的第7行“<code class="du ks kt ku kj b">default</code>”替换为“<code class="du ks kt ku kj b">ssd</code>”，并在应用部署之前，将以下文件应用到您的集群，以将SSD注册为存储类:</p></blockquote><figure class="ke kf kg kh fd kv"><div class="bz dy l di"><div class="kw kx l"/></div></figure><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lf"><img src="../Images/2d9a70b227715f08deec446c67c7aa81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ML3tbqguPnrf2sezKRYp-w.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">Kubernetes引擎:存储(“固态硬盘”和“标准”)</figcaption></figure><p id="f5e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="be07" class="je jf hi kj b fi kn ko l kp kq">kubectl apply --filename=nfs-deployment.yaml<br/>kubectl apply --filename=nfs-service.yaml</span></pre><p id="6c3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将产生一个NFS服务，可通过Kubernetes服务的DNS名称:<code class="du ks kt ku kj b">nfs.default.svc.cluster.local</code>访问。</p><p id="49f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好的。你不应该为NFS创建一个<code class="du ks kt ku kj b">PersistentVolume</code>或者<code class="du ks kt ku kj b">PersistentVolumeClaim</code>，因为它们将会使用舵图表来创建。下面先睹为快，看看掌舵图部署后的持续量声明。您将在下一步中这样做:</p><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lq"><img src="../Images/1928bd30267ed040d37352f04a019117.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9lrfFpu0ruFD1ydYXJlmJw.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">Kubernetes引擎:存储</figcaption></figure><h2 id="c368" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">舵</h2><p id="f087" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">下载并解压缩最新的Helm二进制文件(<a class="ae jd" href="https://github.com/kubernetes/helm/releases" rel="noopener ugc nofollow" target="_blank">版本</a>)，将其添加到您的PATH中，并将Helm's Tiller安装到Kubernetes集群中。假设我们在<code class="du ks kt ku kj b">${WORKDIR}</code>并且你把头盔拉进了<code class="du ks kt ku kj b">${WORKDIR}/linux-amd64</code>:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="bf1f" class="je jf hi kj b fi kn ko l kp kq">PATH=$PATH:$PWD/linux-amd64<br/>helm version</span></pre><blockquote class="ky kz la"><p id="d17d" class="if ig lb ih b ii ij ik il im in io ip lc ir is it ld iv iw ix le iz ja jb jc hb bi translated"><strong class="ih hj"> NB </strong> Helm有适用于OSX和Windows的二进制文件，我将把非Linux的具体指令留给你来完成。</p></blockquote><p id="d955" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果——很可能——您正在使用一个位于RBAC的Kubernetes(引擎)集群，我建议您按照以下步骤将Helm's Tiller安装到集群中:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="882e" class="je jf hi kj b fi kn ko l kp kq">kubectl create serviceaccount tiller \<br/>--namespace=kube-system</span><span id="33bf" class="je jf hi kj b fi kr ko l kp kq">kubectl create clusterrolebinding tiller \<br/>--clusterrole cluster-admin \<br/>--serviceaccount=kube-system:tiller</span><span id="1194" class="je jf hi kj b fi kr ko l kp kq">helm init --service-account=tiller</span></pre><p id="b6ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这应该会返回:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="e46d" class="je jf hi kj b fi kn ko l kp kq">$HELM_HOME has been configured at /usr/local/google/home/dazwilkin/.helm.</span><span id="d714" class="je jf hi kj b fi kr ko l kp kq">Tiller (the Helm server-side component) has been installed into your Kubernetes Cluster.</span><span id="c8e4" class="je jf hi kj b fi kr ko l kp kq">Please note: by default, Tiller is deployed with an insecure 'allow unauthenticated users' policy.<br/>For more information on securing your installation see: <a class="ae jd" href="https://docs.helm.sh/using_helm/#securing-your-helm-installation" rel="noopener ugc nofollow" target="_blank">https://docs.helm.sh/using_helm/#securing-your-helm-installation</a><br/>Happy Helming!</span></pre><p id="c4b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，克隆我的GitHub repo(感谢IBM的同事为我们做了98%的工作):</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="b8f2" class="je jf hi kj b fi kn ko l kp kq">git clone <a class="ae jd" href="https://github.com/DazWilkin/ibm-blockchain-network.git" rel="noopener ugc nofollow" target="_blank">https://github.com/DazWilkin/ibm-blockchain-network.git</a></span></pre><p id="bc51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是不要切换到克隆创建的<code class="du ks kt ku kj b">ibm-blockchain-network</code>目录；留在母体内(<code class="du ks kt ku kj b">${WORKDIR}</code>)。</p><blockquote class="ky kz la"><p id="64b3" class="if ig lb ih b ii ij ik il im in io ip lc ir is it ld iv iw ix le iz ja jb jc hb bi translated"><strong class="ih hj">可选</strong>:在展开<code class="du ks kt ku kj b">helm lint ibm-blockchain-network</code>之前，在图表上运行舵面是一个好习惯</p><p id="80f6" class="if ig lb ih b ii ij ik il im in io ip lc ir is it ld iv iw ix le iz ja jb jc hb bi translated"><strong class="ih hj">可选</strong>:在将部署应用到集群之前，最好先“试运行”部署。这是Helm的一个有用特性，为您提供了一种查看适用于您的集群的Kubernetes规范的方式:<code class="du ks kt ku kj b">helm install --dry-run — debug ibm-blockchain-network</code>。</p></blockquote><p id="1ddb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你对结果有信心时:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="5ae7" class="je jf hi kj b fi kn ko l kp kq">helm install ibm-blockchain-network</span></pre><p id="6e3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Helm会将该图表应用到您的Kubernetes，并为您提供其工作的列举:</p><figure class="ke kf kg kh fd kv"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="1106" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以检查Kubernetes引擎工作负载的云控制台:</p><p id="cf8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">【https://console.cloud.google.com/kubernetes/workload】</p><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lr"><img src="../Images/2a2540a3346659658f2cdcf6b9a74e8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NmwIQOeCRKKQpptCbu_3Ng.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">Kubernetes引擎:工作负载</figcaption></figure><p id="57df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和服务:</p><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ls"><img src="../Images/55d2c545b621bd649ba6e3490c4d143a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2f4k1Bxj5iY9lyrx3Y1vOQ.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">Kubernetes引擎:服务</figcaption></figure><p id="bff1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">部署的各种容器创建了一堆日志。下面是由<code class="du ks kt ku kj b">ibm-blockchain-network-utils</code> Pod创建的<code class="du ks kt ku kj b">bootstrap</code>容器:</p><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lt"><img src="../Images/61d62ae80fae5c11ca9e835f00bf80b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMx_irPaqOhPthsXV9HnTw.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">云日志记录</figcaption></figure><p id="aa0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于<code class="du ks kt ku kj b">configtxgen</code>:</p><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lu"><img src="../Images/a104c6f6dc7ecd180931860b2f345fac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ybFcvQ8Q_SqDFQnMHpuTdw.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">云日志记录</figcaption></figure><p id="e652" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于<code class="du ks kt ku kj b">cryptogen</code>:</p><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lv"><img src="../Images/8fd3b22bcd32f0b67f75bf9ffbf9b73b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bx-f10G8PcpQOb9HX4SdXA.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">云日志记录</figcaption></figure><p id="3440" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于<code class="du ks kt ku kj b">ca</code>:</p><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lu"><img src="../Images/f8633ece48265c4edc48bcda2d9f5833.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UrosXL_VnzVxgkgjpWItrA.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">云日志记录</figcaption></figure><p id="6538" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于<code class="du ks kt ku kj b">orderer</code>:</p><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lq"><img src="../Images/c0530fa81d6d5d9b84a5ce039068a4ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*teNe1DpPPIDzD1tWNVG3hw.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">云日志记录</figcaption></figure><p id="a005" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以及类似于<code class="du ks kt ku kj b">org2peer1</code>的<code class="du ks kt ku kj b">org1peer1</code>:</p><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lq"><img src="../Images/2ffd76b1cc2b79025b013cd9e4741ba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K7-ADiaGXsi9WE-zE0t7zA.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">云日志记录</figcaption></figure><h2 id="af48" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">舵表|删除</h2><p id="e0af" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">您可以通过以下方式列出和删除已部署的图表:</p><figure class="ke kf kg kh fd kv"><div class="bz dy l di"><div class="kw kx l"/></div></figure><blockquote class="ky kz la"><p id="80e4" class="if ig lb ih b ii ij ik il im in io ip lc ir is it ld iv iw ix le iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>在这个例子中，目前还没有一种简单的方法来获取动态生成的图表名称(比如<code class="du ks kt ku kj b">solitary-possum</code>)。因此，要删除一个图表，您需要执行<code class="du ks kt ku kj b">list</code>来识别它的名称。</p></blockquote><h2 id="7747" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">删除NFS服务</h2><p id="4a8a" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">完成后，不要忘记删除NFS部署:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="b4a5" class="je jf hi kj b fi kn ko l kp kq">kubectl delete --filename=nfs-deployment.yaml<br/>kubectl delete --filename=nfs-service.yaml</span></pre><h2 id="6722" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">删除Kubernetes</h2><p id="e5a9" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">您可以重击您的集群:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="d36b" class="je jf hi kj b fi kn ko l kp kq">gcloud beta container clusters delete ${CLUSTER} \<br/>--region=${REGION} \<br/>--project=${PROJECT}</span></pre><h2 id="962c" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">Stackdriver Kubernetes监控</h2><p id="63fe" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">既然我们讨论了日志，我已经提到我部署了集群来支持新的<a class="ae jd" href="https://cloud.google.com/kubernetes-monitoring/" rel="noopener ugc nofollow" target="_blank"> Stackdriver Kubernetes监控</a>。</p><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lr"><img src="../Images/1d50fbc8c2505accc93bc1f6fc13c899.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6GrbD0ybwLEoTGJKIs65Tg.png"/></div></div></figure><h2 id="320f" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">容器优化操作系统(COS)</h2><p id="aa03" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">除了需要创建NFS服务之外，图表部署到Kubernetes引擎所需的唯一其他更改是对Composer配置的调整。IBM-区块链-网络-utils工作负载创建了包括<code class="du ks kt ku kj b">bootstrap</code>在内的3个pod。<code class="du ks kt ku kj b">bootstrap</code>有一个名为<code class="du ks kt ku kj b">composer-credentials</code>的卷，它被挂载到节点(主机)的根目录(<code class="du ks kt ku kj b">/</code>)下。</p><p id="d82d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://cloud.google.com/container-optimized-os/docs/" rel="noopener ugc nofollow" target="_blank">容器优化操作系统</a>是为了安全而构建的，该操作系统包含最少量的额外工具。您可以在这里看到根目录(<code class="du ks kt ku kj b">/</code>)被挂载为只读“以保持完整性”。因此，图表被修改为使用<code class="du ks kt ku kj b">/tmp/composer</code>而不是<code class="du ks kt ku kj b">/composer</code>。您可以在区块链-utils.yaml的第20–22行看到这种变化:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="63c4" class="je jf hi kj b fi kn ko l kp kq">- name: composer-credentials<br/>    hostPath:<br/>      path: /tmp/composer</span></pre><p id="5642" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">而且还在<code class="du ks kt ku kj b">blockchain-debug-nfs.yaml</code>里。等等什么？</p><h2 id="ea99" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">排除故障</h2><p id="6f58" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">我最近提供了一些调试Kubernetes部署的例子。在这种情况下，我希望确保NFS服务正常工作。如果它工作正常，容器将能够访问它的卷装载。</p><p id="b393" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了证实这一点，我在舵图中添加了一个模板。这个模板叫做<code class="du ks kt ku kj b">blockchain-nfs.debug.yaml</code>。在图表中包含这一点有两个好处。首先，它可以使用Helm的变量替换。第二，它将所有东西放在一起，并确保调试部署与图表一起创建|删除。</p><p id="2fde" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">区块链调试:</p><figure class="ke kf kg kh fd kv"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="5ac9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">NFS体积由第34–36行中定义的<code class="du ks kt ku kj b">PersistentVolumeClaim</code>引用。您会注意到，在调试部署到Kubernetes引擎时为什么会失败时，我添加了第二个(非NFS)卷<code class="du ks kt ku kj b">composer-credentials</code>(因为COS和不允许前面解释的<code class="du ks kt ku kj b">/</code>)。</p><p id="e2b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最棒的是，一旦部署完毕，我们就可以获得生成的Pod(！)命名并执行到它的(Alpine) shell中，并枚举目录的内容:</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="adaf" class="je jf hi kj b fi kn ko l kp kq">kubectl exec \<br/>--stdin \<br/>--tty \<br/>$(\<br/>  kubectl get pods \<br/>  --selector=name=ibm-blockchain-network-debug-nfs \<br/>  --output=jsonpath="{.items[0].metadata.name}"\<br/>) \<br/>--container=debug \<br/>-- /bin/ash -c "ls -la /shared &amp;&amp; ls -la /home/composer"</span></pre><p id="1f71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将返回:</p><figure class="ke kf kg kh fd kv"><div class="bz dy l di"><div class="kw kx l"/></div></figure><h2 id="004e" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">结论</h2><p id="f6b7" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">Helm是一个很好的工具，比我想象的更容易使用。</p><p id="2c2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我也在为万亿美元的掌舵人T4图表T5工作。</p><p id="b63d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">IBM的Helm图表旨在将Fabric部署到IBM的Kubernetes服务，但是，因为Kubernetes就是Kubernetes，正如您所看到的，将该图表转换到Kubernetes引擎上也很简单。</p><p id="5a64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望从IBM人员那里了解更多关于如何将Hyperledger Compose集成到这个部署中，然后我会更新这篇文章。</p></div></div>    
</body>
</html>