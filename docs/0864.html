<html>
<head>
<title>BigQuery public datasets metadata</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">BigQuery公共数据集元数据</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/bigquery-public-datasets-metadata-788c2c3897b2?source=collection_archive---------0-----------------------#2018-12-22">https://medium.com/google-cloud/bigquery-public-datasets-metadata-788c2c3897b2?source=collection_archive---------0-----------------------#2018-12-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4f31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我创建了公共BigQuery表，其中包含关于BigQuery公共数据集的元数据。众所周知，BigQuery拥有包含不同性质和大小的数据的公共数据集。例如，有比特币和以太坊交易，来自世界银行的数据，关于专利的数据，各种(主要是美国)机构，如劳动或森林统计的Bereau等。由于它们是公开的，这意味着任何拥有谷歌云账户的人都可以查询它们，并且在消耗了1TB的免费月配额后，只需为查询的数据量付费。</p><p id="4e15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">公共数据集是完美的资源，如果:</p><p id="df6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-您刚开始使用BigQuery，没有合适的数据来使用和尝试BigQuery功能</p><p id="d3b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-您希望将公共数据集中的数据用于(严肃的)研究还是仅仅为了娱乐</p><p id="f60d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于BigQuery公共数据集的一些资源可以在这里找到:</p><p id="01ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://cloud.google.com/bigquery/public-data/" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/bigquery/public-data/</a>—如何从BigQuery和公共数据集开始的一般指南</p><p id="3d69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">https://www.reddit.com/r/bigquery/wiki/datasets<a class="ae jd" href="https://www.reddit.com/r/bigquery/wiki/datasets" rel="noopener ugc nofollow" target="_blank"/>—公共数据集列表及相关信息(来源)</p><p id="e044" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">【https://console.cloud.google.com/marketplace/browse? T4】filter = solution-type:dataset—公共数据集和综合信息的列表，以及一些示例查询。</p><p id="eb25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我写这篇文章的原因是，我正在查看至少每天更新的公共数据集表，但从这些可用的信息中我很难找到。当然，我尝试过在BigQuery中随机查看几个表来获取信息，但大多数都没有更新，手动完成需要很长时间。因为每个表都包含一些元数据，如大小、行数、创建/修改日期，所以我编写了简单的Python脚本来从公共数据集的表中提取信息，并将其全部放入一个表中。完整代码在Github<a class="ae jd" href="https://github.com/zdenulo/bigquery_public_datasets_metadata" rel="noopener ugc nofollow" target="_blank">https://Github . com/zde nulo/big query _ public _ datasets _ metadata</a>上</p><p id="b357" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">获取数据的核心代码是这样的:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="0946" class="jn jo hi jj b fi jp jq l jr js">import datetime<br/>import logging<br/><br/>from google.cloud import bigquery<br/><br/>from settings import *<br/><br/>projects = [<br/>    'bigquery-public-data',<br/>]<br/><br/><br/>def get_bq_data():<br/>    """Gets metadata from public BigQuery datasets"""<br/>    data = []<br/>    for project in projects:<br/>        client = bigquery.Client(project=project)<br/>        datasets = client.list_datasets()<br/><br/>        for dataset in datasets:<br/>            dataset_id = dataset.dataset_id<br/>            dataset_ref = client.get_dataset(dataset_id)<br/>            tables = client.list_tables(dataset_id)<br/>            for table in tables:<br/>                full_table_id = table.full_table_id.replace(':', '.')<br/>                table_ref = client.get_table(full_table_id)<br/><br/>                item = {'dataset_id': dataset_id,<br/>                        'project_id': project,<br/>                        'table_id': table_ref.table_id,<br/>                        'dataset_description': dataset_ref.description,<br/>                        'table_modified': table_ref.modified.strftime("%Y-%m-%d %H:%M:%S"),<br/>                        'table_created': table_ref.created.strftime("%Y-%m-%d %H:%M:%S"),<br/>                        'table_description': table_ref.description,<br/>                        'table_num_bytes': table_ref.num_bytes,<br/>                        'table_num_rows': table_ref.num_rows,<br/>                        'table_partitioning_type': table_ref.partitioning_type,<br/>                        'table_type': table_ref.table_type,<br/>                        }<br/>                data.append(item)<br/>    return data</span></pre><p id="70ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为除了“bigquery-public-data”之外，还有其他GCP项目也有公共数据，所以我将遍历项目，然后是数据集，最后是表。当BigQuery数据集被公开时，属于该数据集的所有表都是公开的。我正在把信息编入词典。我将在其他文章中描述整个过程。</p><p id="4b03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的包含带元数据的表的公共数据集在这里:<a class="ae jd" href="https://console.cloud.google.com/bigquery?p=adventures-on-gcp&amp;d=bigquery_public_datasets&amp;page=dataset" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com/bigquery?p = GCP上的冒险&amp;d = big query _ public _ datasets&amp;page = dataset</a></p><p id="593c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有了这些数据，您可以获得一些关于数据集的基本有用信息:</p><h2 id="eb91" class="jn jo hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">获取最新更新的表格</h2><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="5ef4" class="jn jo hi jj b fi jp jq l jr js">SELECT dataset_id, table_id, table_created, table_modified  <br/>FROM `adventures-on-gcp.bigquery_public_datasets.bq_public_metadata`<br/>ORDER BY table_modified DESC</span></pre><figure class="je jf jg jh fd kn er es paragraph-image"><div class="er es km"><img src="../Images/9907bb60aa4420c5683b0f8f61d61430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/0*agIQO_7xabqkjnag.png"/></div></figure><h2 id="811d" class="jn jo hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">今天更新的表格</h2><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="ef92" class="jn jo hi jj b fi jp jq l jr js">SELECT dataset_id, table_id, table_created, table_modified <br/>FROM `adventures-on-gcp.bigquery_public_datasets.bq_public_metadata`<br/>WHERE CAST(table_modified AS DATE) = CURRENT_DATE()<br/>ORDER BY table_modified DESC</span></pre><p id="eb9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天更新了1499个表中的108个</p><h2 id="113d" class="jn jo hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">最大尺寸的桌子</h2><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="b8b4" class="jn jo hi jj b fi jp jq l jr js">SELECT dataset_id, table_id, table_num_bytes,<br/>table_num_bytes / 1000000000 AS size_in_GB<br/>FROM `adventures-on-gcp.bigquery_public_datasets.bq_public_metadata`<br/>ORDER BY table_num_bytes DESC<br/>LIMIT 10</span></pre><figure class="je jf jg jh fd kn er es paragraph-image"><div class="er es km"><img src="../Images/75ededcc8be13674f3699f348e12b317.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/0*zsph51khQU8mliAW.png"/></div></figure><h2 id="66d5" class="jn jo hi bd jt ju jv jw jx jy jz ka kb iq kc kd ke iu kf kg kh iy ki kj kk kl bi translated">行数最多的表格</h2><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="3892" class="jn jo hi jj b fi jp jq l jr js">SELECT dataset_id, table_id, table_num_rows <br/>FROM `adventures-on-gcp.bigquery_public_datasets.bq_public_metadata`<br/>ORDER BY table_num_rows DESC<br/>LIMIT 10</span></pre><figure class="je jf jg jh fd kn er es paragraph-image"><div class="er es kq"><img src="../Images/fd0fc4d6fe670181f7238e0406f8b35d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/0*Ft5471FHbdedVKyr.png"/></div></figure><p id="193d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">整个管道是无服务器处理的一个很好的例子，由云调度程序的发布/订阅触发的云功能组成(目前每4小时一次)。在云函数中，数据从BigQuery中获取，然后以JSON格式存储在Google云存储中的文件中，最后加载到BigQuery中。表格内容每次都会被覆盖。</p><p id="5f41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这将为您提供更多关于BigQuery公共数据集的见解和信息。</p></div></div>    
</body>
</html>