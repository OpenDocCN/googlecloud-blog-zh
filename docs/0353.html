<html>
<head>
<title>Google DLP API — Sample Groovy (Java) integration client code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google DLP API —示例Groovy (Java)集成客户端代码</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-dlp-api-sample-groovy-java-integration-client-code-98e7a309fa0?source=collection_archive---------0-----------------------#2017-08-03">https://medium.com/google-cloud/google-dlp-api-sample-groovy-java-integration-client-code-98e7a309fa0?source=collection_archive---------0-----------------------#2017-08-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2f33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我的第一篇中帖。我在<a class="ae jd" href="http://www.hafiz.com.ng" rel="noopener ugc nofollow" target="_blank">http://www.hafiz.com.ng</a>有一个博客，所以它回避了为什么我也开始在媒体上写作的问题。简单。我现在的意图是继续在我当前的博客上发布个人的和非专业的东西，而我的媒体帖子将只包含技术和职业相关的内容。也就是说，让我们直接进入这篇文章的主题。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><p id="7be9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本周在工作中，我不得不将一个Groovy客户端集成到<a class="ae jd" href="https://cloud.google.com/dlp/demo/" rel="noopener ugc nofollow" target="_blank">谷歌新生的DLP(数据丢失预防)API </a>。我不得不承认这是我最近不得不做的最困难的事情之一。有趣的是，尽管解决集成的主要挑战非常困难，但解决方案却非常简单。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jl"><img src="../Images/6fade8598dfa1fa9866990c6cd596f40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E9WDTtcqIbwL7S9pBSMx6Q.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">通过Google的数据丢失防护(DLP) API编辑的带有敏感信息的文本</figcaption></figure><p id="27cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我写这篇文章，不是因为API难搞。不。我是因为在寻找整合挑战的解决方案的时候，老实说，这在当时是相当令人生畏的，我承诺如果我能够克服它们，我会发一个帖子。所以让我们开始吧。</p><h1 id="3fde" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">挑战1</h1><p id="fffa" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">我花了相当长的时间才找到正确的客户端库来促进与API的通信。似乎有太多的Google仓库名称中带有DLP，所以我浪费了相当多的时间来摆弄错误的库，直到我在GitHub上找到这个<a class="ae jd" href="https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/dlp" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> DLP API示例</strong> </a>。</p><p id="2cd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我找到这个样本之前，我花了几个小时试图找出这个DLP客户端库，这是我在Google上找到的第一个结果。不幸的是，我在网上找不到任何使用过它的样本。因此，我艰难地在JAVADOCs 中寻找<a class="ae jd" href="https://developers.google.com/resources/api-libraries/documentation/dlp/v2beta1/java/latest/overview-summary.html" rel="noopener ugc nofollow" target="_blank">并编写试错法代码，看看我是否能找出集合在一起形成完整解决方案的类和方法；一切都无济于事。</a></p><p id="5209" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">解决方案1 </strong></p><p id="09ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">解决方案是找到<a class="ae jd" href="https://github.com/GoogleCloudPlatform/java-docs-samples/blob/master/dlp" rel="noopener ugc nofollow" target="_blank">这个GitHub repo </a>，它包含使用Google DLP API的样本代码。一旦我找到它，我所要做的就是理解代码并使它适应我的用例。</p><p id="4c01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤很简单:</p><ul class=""><li id="9655" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated">按照GitHub自述文件中的说明，将<a class="ae jd" href="https://github.com/GoogleCloudPlatform/google-cloud-java/tree/master/google-cloud-dlp" rel="noopener ugc nofollow" target="_blank">开源DLP客户端库</a>作为依赖项添加到您的项目中</li></ul><pre class="jm jn jo jp fd ln lo lp lq aw lr bi"><span id="98c7" class="ls kc hi lo b fi lt lu l lv lw">compile <strong class="lo hj">'com.google.cloud:google-cloud-dlp:0.21.1-alpha'</strong></span></pre><ul class=""><li id="5562" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated">前面引用的示例使用这个客户端库进行数据检查和编辑。请随意将代码复制并粘贴到您的项目中，并根据您的环境进行调整。你可以在这个GitHub repo文件夹中找到<a class="ae jd" href="https://github.com/GoogleCloudPlatform/java-docs-samples/tree/master/dlp/src/main/java/com/example/dlp" rel="noopener ugc nofollow" target="_blank">示例代码文件。</a></li></ul><h1 id="2763" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">挑战2</h1><p id="2afe" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">一旦我成功地将DLP客户端库包含在我的项目中，就该对它进行测试了，看看它是否真的适合我。在这个示例的帮助下，我很快地整理了一些代码，满足了DLP inspect方法的所有输入要求，并在调试模式下运行了我的项目。这是关键时刻。</p><p id="78a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">令我沮丧的是，在向DLP API发送HTTP请求时，客户端库代码中抛出了一个神秘的“NoSuchMethod”异常。</p><p id="4859" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">方案二</strong></p><p id="7ad7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，我又一次点击了搜索引擎，这次是以无与伦比的劲头。幸运的是，有成千上万的其他开发人员在我之前发起了这场战争，并且都活了下来。我花了不到30分钟就摆脱了这个困境。</p><p id="0364" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我发现这个异常是由于我的Grails项目中包含的Guava库版本的一些问题造成的(在StackOverflow页面)。我所要做的就是在我的项目中再包含一个依赖项，它指定了一个比我的scrap项目中默认包含的更高版本的Guava库(20.0)。***)</p><pre class="jm jn jo jp fd ln lo lp lq aw lr bi"><span id="6381" class="ls kc hi lo b fi lt lu l lv lw">compile <strong class="lo hj">'com.google.guava:guava:20.0'</strong></span></pre><p id="9262" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此时，我能够在我的机器上成功地测试样本代码。找到了。当我的调试器在尝试与DLP API通信时，没有抛出另一个神秘的异常，而是向我展示了美丽的JSON响应，它的到来标志着我作为一名程序员毕生奋斗的这一集的结束时，我感觉自己像是美国总统。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es lx"><img src="../Images/32839fe9a06d4b0214694cd3e9d791bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X_I4ujy5A2WZHhJLk8F1NQ.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">一行来统治他们所有人</figcaption></figure></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><p id="d378" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个集成过程中，我面临了另一个挑战，它与Google DLP API或客户端库没有直接关系。</p><h1 id="8cd0" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">挑战3</h1><p id="bc29" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">在将DLP API客户端库依赖引用从我的scrap项目复制到主项目的gradle构建脚本之后，我无法再构建我的项目了(<a class="ae jd" href="https://stackoverflow.com/questions/10519558/createprocess-error-206-the-filename-or-extension-is-too-long-when-running-main" rel="noopener ugc nofollow" target="_blank">参见StackOverflow链接，了解我所面临的确切问题</a>)。</p><p id="a825" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">方案三</strong></p><p id="6a4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">原来，这个问题是由于Windows操作系统对要在该操作系统上执行的任何应用程序的路径长度的限制。解决方案是…我不会浪费时间来谈论它，因为我对它如何解决问题只有一个基本的了解。链接到<a class="ae jd" href="https://github.com/grails/grails-core/issues/9300" rel="noopener ugc nofollow" target="_blank">解决我问题的方法就在这里</a>。我所做的只是将下一个代码片段(逐字)粘贴到我的build.gradle文件的根级别。对于根级别，我的意思是代码片段的任何部分都不存在于任何其他代码块中。</p><p id="6757" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嘿，在编写代码之前，我认为值得一提的是，这个问题的许多其他答案都建议在构建脚本中添加一个“pathingJar”任务(而不是这个解决方案中的“launcherJar”任务)。我从我的编译器那里得到的错误非常清楚地表明，任务不能被创建，因为“任务‘pathing jar’已经存在”。</p><p id="15c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我花了相当多的时间试图找到一种方法来编辑或覆盖默认的pathingJar任务，但都没有成功。在此期间，我学会了如何列出我的gradle项目中的所有构建任务和依赖项。我显然有一些关于Gradle build工具的资料要读:@</p><pre class="jm jn jo jp fd ln lo lp lq aw lr bi"><span id="ea50" class="ls kc hi lo b fi lt lu l lv lw">task launcherJar(type: Jar) {<br/>    def gradleUserHome = new File(gradle.getGradleUserHomeDir(), "caches")<br/><br/>    def relativeClasspathEntries = configurations.runtime.files.collect {<br/>        new File(gradleUserHome.getAbsolutePath()).toURI().<br/>                relativize(new File(it.getAbsolutePath()).toURI()).getPath()<br/>    }<br/>    appendix = "launcher"<br/>    destinationDir = gradleUserHome<br/>    doFirst {<br/>        manifest {<br/>            attributes "Class-Path": relativeClasspathEntries.join(" ")<br/>        }<br/>    }<br/>}<br/><br/>compileGroovy{<br/>  dependsOn launcherJar<br/>    FileCollection collection = files(launcherJar.archivePath);<br/>    def finCollection = collection<br/>    doLast {<br/>        classpath = finCollection<br/>    }<br/>}<br/><br/>bootRun{<br/>    doFirst{<br/>        //The main build directories aren't collected so they are added manually<br/>        FileCollection collection = files("${project.rootDir}/build/classes/main") + files("${project.rootDir}/build/resources/main") + files(launcherJar.archivePath)<br/>        println collection.files<br/>        classpath = collection<br/>    }<br/>}</span></pre></div></div>    
</body>
</html>