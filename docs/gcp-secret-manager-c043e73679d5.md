# GCP:秘密经理

> 原文：<https://medium.com/google-cloud/gcp-secret-manager-c043e73679d5?source=collection_archive---------2----------------------->

![](img/9e567080a476ef72821312583274ee0c.png)

几个月前，谷歌与我们分享了一项名为 Secret Manager 的服务。它已经酝酿了一段时间，街上已经在谈论了。

坦率地说，GCP 的秘密管理(用户名、密码、密钥等)简直是一场噩梦。围绕这一问题的解决方案涉及加密和解密层，并不时使用一两个第三方工具来使其工作。你可以想象，这里有很多挑战。首先，复杂的层次和工具的捆绑需要管理时间和精力，而没有人真正拥有这些时间和精力。当您试图让您的应用程序具有可移植性时，这个问题变得更加复杂。谁在何时访问什么的可见性和透明度差也是一个问题。正如你已经知道的，移动按键一点也不好玩。

如此忠于生态系统的开发者们试图用云 KMS 来解决这个问题。

平心而论，[云 KMS](https://cloud.google.com/kms) 在这里确实尝试过创新，但是，总感觉像一个方塞在一个圆洞里。它很笨重，使用起来很复杂，而且总是带你进行不必要的冒险。你可能读到这里会想，这是一个人的观点，但实际上不是。谷歌自己也承认:

> 一个密钥管理系统，如[云 KMS](https://cloud.google.com/kms) ，允许你管理加密密钥，并使用它们来加密或解密数据。但是，您不能查看、提取或导出密钥材料本身。
> 
> 同样，您可以使用密钥管理系统在传输或存储敏感数据之前对其进行加密。然后，您可以在使用敏感数据之前对其进行解密。以这种方式使用密钥管理系统来保护秘密更加复杂并且效率更低。

这并不是说[云 KMS](https://cloud.google.com/kms) 是一个无用的工具。不要！只是，虽然它是一个伟大的工具，但并不是所有的用例都适合 KMS。有时你只需要访问你的秘密，你不想所有的加密解密业务。

如果你使用过 [Hashicorp 金库](https://www.vaultproject.io/)，你就知道你到底错过了什么。

输入秘密经理！

> Secret Manager 允许您以二进制 blobs 或文本字符串的形式存储、管理和访问[机密](https://cloud.google.com/secret-manager/docs/overview#secret)。有了适当的权限，您可以查看机密的内容。

这里有很多好处。秘密现在可以锚定在一个集中的真相源中，使用一个完全托管的服务。除此之外，我们现在可以接入[云 IAM](https://cloud.google.com/iam) 来管理授权。这是“便携性”事业的巨大胜利。

让我们也谈一谈版本控制。CI/CD(持续集成和持续交付)管道已经使版本化有点像主食。今天，一般的构建管道会有从`dev`到`prod`的多个版本，以及介于两者之间的所有版本。因为这样的数据库将是不同的，密钥将是唯一的，用户名将是共享的，并且密码将是不同的。为了便于集中管理，一个键-值对可以有一个带有多个值的键(根据定义，它们是一对……没有吗？).无论如何，这个特性是必要的还是我们都有点多余的？绝对有必要！同一个密钥需要不同的凭证的情况有很多次。例如，作为一种最佳实践，有一句名言是这样说的，“不要使用开发人员证书去开发！”。或者反之亦然！因此，在 CI/CD 管道中，您可能希望将所有东西都隔离开来，但保留静态变量。

话虽如此，如果你想看看秘密经理的行动，这里有一个[运行的例子](/google-cloud/gcp-deploying-to-app-engine-from-github-using-cloud-build-df2582f968c7)。我在一个相对便携的解决方案上使用了 spring cloud 和 Secret Manager，以及 Spring-Cloud-GCP-Secret-Manager。这里 Secret Manager 的必要性在于，我们需要将数据库机密附加到 Github 上的公共 repo 上托管的 CI/CD 构建管道中。测试和工作像一个魅力！