<html>
<head>
<title>Put your Aurelia app on Google App Engine with free SSL certificates from Letsencrypt</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Letsencrypt提供的免费SSL证书将您的Aurelia应用程序放在Google应用程序引擎上</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/put-your-aurelia-app-on-google-app-engine-with-free-ssl-certificates-from-letsencrypt-704de4581d4a?source=collection_archive---------0-----------------------#2016-02-21">https://medium.com/google-cloud/put-your-aurelia-app-on-google-app-engine-with-free-ssl-certificates-from-letsencrypt-704de4581d4a?source=collection_archive---------0-----------------------#2016-02-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/70d6b6a1e20947b189fe4c0423fb23ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:596/format:webp/0*QuZghvuyUWuAdWrT.jpg"/></div></figure><figure class="in io ip iq fd ij er es paragraph-image"><div class="er es im"><img src="../Images/64a1256aae32286a50f4187b6bbd184a.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*JBAG_3t3-MU0TpUV22qx7A.png"/></div></figure><figure class="in io ip iq fd ij er es paragraph-image"><div class="er es ir"><img src="../Images/ce59799c75e8660ab7fea8d07040815c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/0*lcD4KTmbzRqjZjQ9.png"/></div></figure><p id="b733" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated"><strong class="iu hj">编辑:2017年9月16日</strong> : <br/> Google现在在App Engine中有了一个非常方便的<a class="ae jq" href="https://cloudplatform.googleblog.com/2017/09/introducing-managed-SSL-for-Google-App-Engine.html?m=1" rel="noopener ugc nofollow" target="_blank">托管SSL证书服务</a>。<br/>就用那个！免费的！<br/>这篇文章的大部分内容仍然有些道理...但是一定要研究Aurelia CLI，让事情对你自己来说更容易些。</p><p id="9285" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">我最近决定把我的Aurelia应用程序放在Google App Engine上，因为静态页面是免费的，只要GAE没有服务器。</p><p id="03cc" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">考虑到Aurelia应用程序本质上是静态网页(从传统的“需要服务器端工作来生成”与“不需要服务器端工作”的角度来看)，这听起来很完美。</p><p id="a299" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">我还想确保我有SSL，因为<a class="ae jq" href="https://letsencrypt.org/" rel="noopener ugc nofollow" target="_blank">让我们加密</a>提供免费的SSL证书，这个解决方案确实很好地结合在一起。</p><p id="b21e" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">下面是我为使它工作而采取的步骤。这主要是笔记，以便我自己记住它，而不是全面的教程，所以祝你好运，如果你跟随我的脚步。我真的不能给你提供任何支持，但我经常在<a class="ae jq" href="https://gitter.im/Aurelia/Discuss" rel="noopener ugc nofollow" target="_blank"> Aurelia Gitter </a>中，以<em class="jr"> @egeland的身份。过来打个招呼。</em></p><h2 id="659e" class="js jt hi bd ju jv jw jx jy jz ka kb kc jd kd ke kf jh kg kh ki jl kj kk kl km bi translated">Aurelia应用程序必须捆绑</h2><p id="0346" class="pw-post-body-paragraph is it hi iu b iv kn ix iy iz ko jb jc jd kp jf jg jh kq jj jk jl kr jn jo jp hb bi translated">为了在任何地方部署应用程序，您确实需要捆绑它。我按照<a class="ae jq" href="http://www.onsentipster.com/blog/2016-02-10-tech-rewrite-aurelia.html#lessons" rel="noopener ugc nofollow" target="_blank">这些步骤</a>让我的捆绑工作。一旦你把你的应用程序导出到<code class="du ks kt ku kv b">export/</code>目录，你就准备好进入有趣的部分了。</p><h2 id="7431" class="js jt hi bd ju jv jw jx jy jz ka kb kc jd kd ke kf jh kg kh ki jl kj kk kl km bi translated">必须安装Letsencrypt</h2><p id="346d" class="pw-post-body-paragraph is it hi iu b iv kn ix iy iz ko jb jc jd kp jf jg jh kq jj jk jl kr jn jo jp hb bi translated">我没有包括如何设置letsencrypt的信息，你可以从他们的文档中找到。</p><h1 id="1304" class="kw jt hi bd ju kx ky kz jy la lb lc kc ld le lf kf lg lh li ki lj lk ll kl lm bi translated">Google应用程序引擎设置</h1><p id="0dda" class="pw-post-body-paragraph is it hi iu b iv kn ix iy iz ko jb jc jd kp jf jg jh kq jj jk jl kr jn jo jp hb bi translated">有很多关于如何设置GAE的文档，所以这是我在配置方面需要的一个快速总结。</p><h2 id="94e5" class="js jt hi bd ju jv jw jx jy jz ka kb kc jd kd ke kf jh kg kh ki jl kj kk kl km bi translated">使用GAE配置文件设置您的应用程序</h2><p id="8bb6" class="pw-post-body-paragraph is it hi iu b iv kn ix iy iz ko jb jc jd kp jf jg jh kq jj jk jl kr jn jo jp hb bi translated">通过将<code class="du ks kt ku kv b">app.yaml</code>文件和letsencrypt的<code class="du ks kt ku kv b">.well-known</code>目录添加到<code class="du ks kt ku kv b">build/export.json</code>中，在导出中包含该文件:</p><pre class="in io ip iq fd ln kv lo lp aw lq bi"><span id="35ba" class="js jt hi kv b fi lr ls l lt lu">{<br/> “list”: [<br/> “index.html”,<br/><strong class="kv hj"> “app.yaml”,</strong><br/> “config.js”,<br/> “favicon.ico”,<br/> “robots.txt”,<br/> <strong class="kv hj">“.well-known/acme-challenge/**”,</strong><br/>// more files …</span></pre><p id="76dd" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated"><code class="du ks kt ku kv b"><strong class="iu hj">app.yaml</strong></code>应该是这样的:</p><pre class="in io ip iq fd ln kv lo lp aw lq bi"><span id="959f" class="js jt hi kv b fi lr ls l lt lu">application: my-application</span><span id="5e62" class="js jt hi kv b fi lv ls l lt lu">runtime: python27<br/>api_version: 1<br/>threadsafe: true</span><span id="105e" class="js jt hi kv b fi lv ls l lt lu">default_expiration: “30d”</span><span id="ca56" class="js jt hi kv b fi lv ls l lt lu">handlers:<br/># re-direct to index.html if no path is given<br/>- url: /<br/> static_files: index.html<br/> upload: index.html</span><span id="2579" class="js jt hi kv b fi lv ls l lt lu"># get correct mimetype for acme-challenge, needed for letsencrypt<br/>- url: /.well-known/acme-challenge/(.*)<br/> mime_type: text/plain<br/> static_files: .well-known/acme-challenge/\1<br/> upload: .well-known/acme-challenge/(.*)</span><span id="8d3f" class="js jt hi kv b fi lv ls l lt lu"># access the static resources in the root directory<br/>- url: /(.*)<br/> static_files: \1<br/> upload: (.*)</span><span id="06fd" class="js jt hi kv b fi lv ls l lt lu"># redefine skip_files<br/>skip_files:<br/>- ^(.*/)?#.*#$<br/>- ^(.*/)?.*~$<br/>- ^(.*/)?.*\.py[co]$<br/>- ^(.*/)?.*/RCS/.*$</span></pre><h2 id="838e" class="js jt hi bd ju jv jw jx jy jz ka kb kc jd kd ke kf jh kg kh ki jl kj kk kl km bi translated">将你的应用上传到GAE</h2><p id="f602" class="pw-post-body-paragraph is it hi iu b iv kn ix iy iz ko jb jc jd kp jf jg jh kq jj jk jl kr jn jo jp hb bi translated">我在应用程序的<code class="du ks kt ku kv b">package.json</code>的<code class="du ks kt ku kv b">scripts</code>部分放了两行代码:</p><pre class="in io ip iq fd ln kv lo lp aw lq bi"><span id="8d7c" class="js jt hi kv b fi lr ls l lt lu">“deploy”: “gulp export &amp;&amp; appcfg.py -V v1 update export/”,<br/>“postdeploy”: “gulp unbundle”</span></pre><p id="6553" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">注意‘v1’可能会自动递增，这样您就可以获得GAE的版本/回滚功能。对于我的简单应用程序，我不关心这些，所以我只是不断地重新部署' v1 '。</p><p id="270f" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">使用以下命令运行部署脚本</p><pre class="in io ip iq fd ln kv lo lp aw lq bi"><span id="c15d" class="js jt hi kv b fi lr ls l lt lu">$ npm run -s deploy</span></pre><p id="bf4a" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">它需要运行一次，这样你就知道你的应用程序在HTTP上工作，在我们弄乱SSL和Letsencrypt之前。</p><h2 id="f140" class="js jt hi bd ju jv jw jx jy jz ka kb kc jd kd ke kf jh kg kh ki jl kj kk kl km bi translated">设置Letsencrypt</h2><p id="ef05" class="pw-post-body-paragraph is it hi iu b iv kn ix iy iz ko jb jc jd kp jf jg jh kq jj jk jl kr jn jo jp hb bi translated"><strong class="iu hj">配置文件(</strong> <code class="du ks kt ku kv b"><strong class="iu hj">cli.ini</strong></code> <strong class="iu hj"> ): </strong></p><pre class="in io ip iq fd ln kv lo lp aw lq bi"><span id="7366" class="js jt hi kv b fi lr ls l lt lu">config-dir = /home/example/ssl/letsencrypt/config<br/>work-dir = /home/example/ssl/letsencrypt/work<br/>logs-dir = /home/example/ssl/letsencrypt/logs</span><span id="5011" class="js jt hi kv b fi lv ls l lt lu"># make sure to use valid email and domains!<br/>email = <a class="ae jq" href="mailto:frode@onsentipster.com" rel="noopener ugc nofollow" target="_blank">myaddress@example.com</a><br/>domains = site.example.com</span><span id="d937" class="js jt hi kv b fi lv ls l lt lu">text = True<br/>agree-tos = True<br/>verbose = True</span><span id="80b7" class="js jt hi kv b fi lv ls l lt lu">authenticator = manual</span></pre><p id="fefd" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated"><strong class="iu hj">向Letsencrypt申请证书</strong></p><p id="1499" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">在单独的shell会话中，因为您需要在应用程序的会话中做一些工作，所以运行</p><pre class="in io ip iq fd ln kv lo lp aw lq bi"><span id="63be" class="js jt hi kv b fi lr ls l lt lu">$ letsencrypt certonly -c ./cli.ini</span></pre><p id="99bc" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">按照提示操作，您应该会看到如下内容:</p><pre class="in io ip iq fd ln kv lo lp aw lq bi"><span id="ca7e" class="js jt hi kv b fi lr ls l lt lu">Make sure your web server displays the following content at<br/><a class="ae jq" href="http://admin.onsentipster.com/.well-known/acme-challenge/74W5HaD0c5ja5tWqlI09iXpXeY3GxI8Ix4FtRZFZXmY" rel="noopener ugc nofollow" target="_blank">http://site.example.com/.well-known/acme-challenge/54W5HaD0c5ja5tWqlI09iXpXeY3GxI8Ix4FtRZFZXmY</a> before continuing:</span><span id="1bfa" class="js jt hi kv b fi lv ls l lt lu">54W5HaD0c5ja5tWqlI09iXpXeY3GxI8Ix4FtRZFZXmY.Z9RAU1fXh5Srfn11JkM8nC-X2LWOP540MoH2JuBNJhg</span><span id="94bc" class="js jt hi kv b fi lv ls l lt lu">If you don’t have HTTP server configured, you can run the following<br/>command on the target server (as root):</span><span id="9bb1" class="js jt hi kv b fi lv ls l lt lu">mkdir -p /tmp/letsencrypt/public_html/.well-known/acme-challenge<br/>cd /tmp/letsencrypt/public_html<br/><strong class="kv hj">printf “%s” 54W5HaD0c5ja5tWqlI09iXpXeY3GxI8Ix4FtRZFZXmY.Z9RAU1fXh5Srfn11JkM8nC-X2LWOP540MoH2JuBNJhg &gt; .well-known/acme-challenge/54W5HaD0c5ja5tWqlI09iXpXeY3GxI8Ix4FtRZFZXmY</strong><br/># run only once per server:<br/>$(command -v python2 || command -v python2.7 || command -v python2.6) -c \ <br/>“import BaseHTTPServer, SimpleHTTPServer; \ <br/>s = BaseHTTPServer.HTTPServer((‘’, 80), SimpleHTTPServer.SimpleHTTPRequestHandler); \ <br/>s.serve_forever()” <br/>Press ENTER to continue</span></pre><p id="907b" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">将相当于粗体的行(无换行符)复制到Aurelia应用程序的shell会话中，为Letsencrypt创建令牌。</p><p id="0d5f" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">再次部署您的应用程序，然后测试令牌是否可用:</p><pre class="in io ip iq fd ln kv lo lp aw lq bi"><span id="e8d4" class="js jt hi kv b fi lr ls l lt lu">$ curl <a class="ae jq" href="http://admin.onsentipster.com/.well-known/acme-challenge/74W5HaD0c5ja5tWqlI09iXpXeY3GxI8Ix4FtRZFZXmY" rel="noopener ugc nofollow" target="_blank">http://site.example.com/.well-known/acme-challenge/54W5HaD0c5ja5tWqlI09iXpXeY3GxI8Ix4FtRZFZXmY</a></span></pre><p id="9faa" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">如果是，很好，回到Letsencrypt shell会话并按Enter键。</p><p id="aa72" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">如果一切顺利，您应该会收到一条高兴的消息，告诉您证书已经准备好了:</p><pre class="in io ip iq fd ln kv lo lp aw lq bi"><span id="b6ff" class="js jt hi kv b fi lr ls l lt lu">Congratulations! Your certificate and chain have been saved at <strong class="kv hj">/home/example/ssl/letsencrypt/config/live/site.example.com/fullchain.pem</strong>. Your cert will expire on 2016–09–21. To obtain a new version of the certificate in the future, simply run Let’s Encrypt again.</span></pre><h2 id="6424" class="js jt hi bd ju jv jw jx jy jz ka kb kc jd kd ke kf jh kg kh ki jl kj kk kl km bi translated">将证书添加到GAE</h2><p id="bfbd" class="pw-post-body-paragraph is it hi iu b iv kn ix iy iz ko jb jc jd kp jf jg jh kq jj jk jl kr jn jo jp hb bi translated">您需要准备好证书和密钥。GAE的密钥格式不同，所以您需要转换它。</p><p id="e81b" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated"><strong class="iu hj">将私钥转换成GAE可以阅读的形式:</strong></p><pre class="in io ip iq fd ln kv lo lp aw lq bi"><span id="d00c" class="js jt hi kv b fi lr ls l lt lu">$ openssl rsa -inform pem -in ~/ssl/letsencrypt/config/live/site.example.com/privkey.pem -outform pem</span></pre><p id="7b1d" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">上述命令将以GAE期望的格式输出您的密钥。</p><p id="6c8c" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">去你的谷歌应用引擎<a class="ae jq" href="https://console.cloud.google.com/appengine/settings/certificates" rel="noopener ugc nofollow" target="_blank">控制台</a>。</p><p id="0f70" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">点击<strong class="iu hj">上传新证书</strong>，填写表单:</p><figure class="in io ip iq fd ij er es paragraph-image"><div class="er es lw"><img src="../Images/e4f6661251509074c7ba98e84e1c50e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*dGdWlHwYfbdoFF7W6rK73Q.png"/></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">填写后保存！</figcaption></figure><p id="1ec2" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">请注意，我们使用<code class="du ks kt ku kv b">fullchain.pem</code>文件获取证书，并在中粘贴来自上述<em class="jr"> openssl </em>步骤的私钥输出。</p><p id="a341" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">确保您将<a class="ae jq" href="https://cloud.google.com/appengine/docs/python/console/using-custom-domains-and-ssl" rel="noopener ugc nofollow" target="_blank">自定义域</a>设置为实际<strong class="iu hj">使用</strong>证书，保存并检查您的应用程序中是否有可爱的绿色挂锁:</p><figure class="in io ip iq fd ij er es paragraph-image"><div class="er es mb"><img src="../Images/5645f97a085e3cc052213e20aa5d9d49.png" data-original-src="https://miro.medium.com/v2/resize:fit:168/format:webp/1*_OkHbadT5yCVEzGpRCF7bQ.png"/></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">啊……耶！</figcaption></figure><p id="26c6" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">应该就这些吧！</p><p id="2471" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">祝你好运！！</p><h2 id="8670" class="js jt hi bd ju jv jw jx jy jz ka kb kc jd kd ke kf jh kg kh ki jl kj kk kl km bi translated">更新</h2><p id="99e4" class="pw-post-body-paragraph is it hi iu b iv kn ix iy iz ko jb jc jd kp jf jg jh kq jj jk jl kr jn jo jp hb bi translated">似乎通过安装<code class="du ks kt ku kv b">gcloud</code>工具包，一些GAE步骤现在需要稍微做些改变。</p><ul class=""><li id="64df" class="mc md hi iu b iv iw iz ja jd me jh mf jl mg jp mh mi mj mk bi translated">从您的<code class="du ks kt ku kv b">app.yaml</code>文件中删除<code class="du ks kt ku kv b">application: my-application</code>条目</li></ul><p id="311a" class="pw-post-body-paragraph is it hi iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp hb bi translated">运行以下命令，确保您使用gcloud登录</p><pre class="in io ip iq fd ln kv lo lp aw lq bi"><span id="97eb" class="js jt hi kv b fi lr ls l lt lu">$ gcloud auth login</span></pre><ul class=""><li id="9ff8" class="mc md hi iu b iv iw iz ja jd me jh mf jl mg jp mh mi mj mk bi translated">使用上传您的应用程序</li></ul><pre class="in io ip iq fd ln kv lo lp aw lq bi"><span id="a5fe" class="js jt hi kv b fi lr ls l lt lu">CLOUDSDK_CORE_PROJECT=’my-application’ gcloud app deploy</span></pre><ul class=""><li id="e405" class="mc md hi iu b iv iw iz ja jd me jh mf jl mg jp mh mi mj mk bi translated">其他都应该是一样的——如果我错过了什么，请告诉我！</li></ul></div></div>    
</body>
</html>