<html>
<head>
<title>Connecting your Visualization Software to Hadoop on Google Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将您的可视化软件连接到Google Cloud上的Hadoop</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/connecting-your-visualization-software-to-hadoop-on-google-cloud-f50279d83f2?source=collection_archive---------2-----------------------#2020-04-30">https://medium.com/google-cloud/connecting-your-visualization-software-to-hadoop-on-google-cloud-f50279d83f2?source=collection_archive---------2-----------------------#2020-04-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="50b4" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">第2部分—实践</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/fae0cd4f55126a41ec6e08a04a109cb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v1YJ9EU7qajT_pnADruKdQ.png"/></div></div></figure><h1 id="ef91" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">概观</h1><p id="2444" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">本文档是帮助您构建端到端解决方案的第二部分，该解决方案可帮助数据分析师使用商业智能(BI)工具安全地访问数据。该解决方案使用Hadoop生态系统中熟悉的开源工具和Tableau作为BI工具。</p><p id="8b75" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">在<a class="ae ks" rel="noopener" href="/@david.cueva/connecting-your-visualization-software-to-hadoop-on-google-cloud-64b55f536fab">的第一部分</a>中，您关注于架构定义、其组件以及它们之间的交互。在本文中，您将逐步了解在Google Cloud上从构成端到端Hive拓扑的架构中设置组件的过程。</p><p id="7dd8" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">本文面向设置环境的操作员和IT管理员，该环境为数据分析师使用的BI工具提供数据和处理功能。在整篇文章中，您将使用“Mary”作为数据分析师的虚构用户身份。这个用户身份集中在由<a class="ae ks" href="https://knox.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Knox </a>和<a class="ae ks" href="https://ranger.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Ranger </a>使用的LDAP目录中。您也可以配置LDAP组，但是该任务不在本文的讨论范围之内。</p><h1 id="2273" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">目标</h1><ul class=""><li id="a0f0" class="kt ku hi jr b js jt jw jx ka kv ke kw ki kx km ky kz la lb bi translated">创建端到端设置，允许BI工具使用Hadoop环境中的数据。</li><li id="652f" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">验证和授权用户请求。</li><li id="29f0" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">在BI工具和集群之间建立并使用安全的通信通道。</li></ul><h1 id="fdf1" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">费用</h1><p id="8348" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">本文使用Google Cloud的付费组件，包括:</p><ul class=""><li id="1951" class="kt ku hi jr b js kn jw ko ka lh ke li ki lj km ky kz la lb bi translated"><a class="ae ks" href="https://cloud.google.com/dataproc/pricing?hl=bg" rel="noopener ugc nofollow" target="_blank"> Dataproc </a></li><li id="49f0" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated"><a class="ae ks" href="https://cloud.google.com/sql/pricing" rel="noopener ugc nofollow" target="_blank">云SQL </a></li><li id="cc5f" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated"><a class="ae ks" href="https://cloud.google.com/storage/pricing" rel="noopener ugc nofollow" target="_blank">云存储</a></li><li id="dc23" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated"><a class="ae ks" href="https://cloud.google.com/compute/network-pricing" rel="noopener ugc nofollow" target="_blank">网络出口</a></li></ul><h1 id="3390" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">开始之前</h1><h2 id="35a6" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">设置项目</h2><p id="db61" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">1.在云控制台的项目选择器页面上，选择或创建云项目。</p><pre class="je jf jg jh fd ly lz ma mb aw mc bi"><span id="d5f2" class="lk ig hi lz b fi md me l mf mg"><em class="mh">Note: If you don’t plan to keep the resources that you create in this procedure, create a project instead of selecting an existing project. After you finish these steps, you can delete the project, removing all resources associated with the project.</em></span></pre><p id="8305" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated"><a class="ae ks" href="https://console.cloud.google.com/projectselector2/home/dashboard?_ga=2.16426303.820133692.1587377411-71235912.1585654570&amp;_gac=1.195935838.1584696876.Cj0KCQjw09HzBRDrARIsAG60GP9u6OBk_qQ02rkzBXpwpMd6YZ30A2D4gSl2Wwte1CqPW_sY6mH_xbIaAmIgEALw_wcB" rel="noopener ugc nofollow" target="_blank">转到项目选择器页面</a></p><p id="544f" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.确保您的Google Cloud项目启用了计费。<a class="ae ks" href="https://cloud.google.com/billing/docs/how-to/modify-project" rel="noopener ugc nofollow" target="_blank">了解如何确认您的项目已启用计费。</a></p><p id="9d43" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.在云控制台中，激活云外壳。</p><p id="7607" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated"><a class="ae ks" href="https://console.cloud.google.com/?cloudshell=true&amp;_ga=2.43377068.820133692.1587377411-71235912.1585654570&amp;_gac=1.118947195.1584696876.Cj0KCQjw09HzBRDrARIsAG60GP9u6OBk_qQ02rkzBXpwpMd6YZ30A2D4gSl2Wwte1CqPW_sY6mH_xbIaAmIgEALw_wcB" rel="noopener ugc nofollow" target="_blank">激活云壳</a></p><p id="ba86" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">在云控制台的底部，一个<a class="ae ks" href="https://cloud.google.com/shell/docs/features" rel="noopener ugc nofollow" target="_blank">云Shell </a>会话启动并显示一个命令行提示符。Cloud Shell是一个Shell环境，已经安装了Cloud SDK，包括<code class="du mi mj mk lz b"><a class="ae ks" href="https://cloud.google.com/sdk/gcloud" rel="noopener ugc nofollow" target="_blank">gcloud</a></code>命令行工具，并且已经为您的当前项目设置了值。会话初始化可能需要几秒钟时间。</p><p id="402d" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">4.启用Dataproc、云SQL和<a class="ae ks" href="https://cloud.google.com/kms" rel="noopener ugc nofollow" target="_blank">云密钥管理服务(KMS) </a>的云API:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="7bc9" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">5.在Cloud Shell中，使用ID your project以及Dataproc集群所在的区域和分区设置环境变量:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="06ea" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">随意选择不同的地区和区域，但是在本文的整个脚本中保持不变。</p><h2 id="a608" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">设置服务帐户</h2><p id="4633" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">1.在Cloud Shell中，创建一个<a class="ae ks" href="https://docs.google.com/document/d/1rYxu2xBZsDgNo_-Ex4jb_3YxwL6cWab8QzFiY33_qWA/edit#" rel="noopener ugc nofollow" target="_blank">服务帐户</a>，该帐户将由涉及可视化安全性的不同产品使用。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="0539" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.向服务帐户添加以下角色:</p><ul class=""><li id="5be3" class="kt ku hi jr b js kn jw ko ka lh ke li ki lj km ky kz la lb bi translated"><a class="ae ks" href="https://cloud.google.com/dataproc/docs/concepts/iam/iam#roles" rel="noopener ugc nofollow" target="_blank"> Dataproc Worker </a>:创建和管理Dataproc集群。</li><li id="3ed2" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated"><a class="ae ks" href="https://cloud.google.com/sql/docs/mysql/project-access-control#roles" rel="noopener ugc nofollow" target="_blank">云SQL编辑器</a>:供Ranger使用<a class="ae ks" href="https://cloud.google.com/sql/docs/mysql/sql-proxy" rel="noopener ugc nofollow" target="_blank">云SQL代理</a>连接其数据库。</li><li id="236e" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated"><a class="ae ks" href="https://cloud.google.com/kms/docs/reference/permissions-and-roles#predefined_roles" rel="noopener ugc nofollow" target="_blank">云KMS密钥解密器</a>:解密之前用KMS加密的密码。</li></ul><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h1 id="5919" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">创建后端集群</h1><h2 id="17a4" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">创建Ranger数据库实例</h2><p id="fdb5" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">1.运行以下命令创建一个MySQL实例来存储Apache Ranger策略。该命令创建一个名为<code class="du mi mj mk lz b">cloudsql-mysql</code>的实例，其<a class="ae ks" href="https://cloud.google.com/sql/docs/mysql/instance-settings#tier-values" rel="noopener ugc nofollow" target="_blank">机器类型</a>类型<code class="du mi mj mk lz b">db-n1-standard-1</code>位于由<code class="du mi mj mk lz b">${REGION} </code>变量指定的<a class="ae ks" href="https://cloud.google.com/sql/docs/mysql/instance-settings#region-values" rel="noopener ugc nofollow" target="_blank">区域</a>中。更多信息参见<a class="ae ks" href="https://cloud.google.com/sql/docs/mysql/create-instance#create-2nd-gen" rel="noopener ugc nofollow" target="_blank">云SQL文档</a>。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="b6b2" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.为从任何主机(<code class="du mi mj mk lz b">‘root‘@’%’</code>)连接的用户<code class="du mi mj mk lz b">root</code>设置实例密码。您可以使用自己的密码或下面提供的示例密码。确保至少使用八个字符，包括至少一个字母和一个数字。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h2 id="0685" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">加密密码</h2><p id="1238" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">在本节中，您将创建一个<a class="ae ks" href="https://cloud.google.com/kms/docs/object-hierarchy#key" rel="noopener ugc nofollow" target="_blank">密钥</a>来加密Ranger和MySQL的密码。为了防止泄漏，密钥存在于<a class="ae ks" href="https://cloud.google.com/kms/docs" rel="noopener ugc nofollow" target="_blank">密钥管理服务(KMS) </a>中，您不能查看、提取或导出密钥位本身。</p><p id="93a7" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">您使用密钥加密密码，并将其写入文件。然后，您将这些文件上传到一个云存储桶中，以便代表集群的服务帐户可以访问它们。</p><p id="4196" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">服务帐户可以解密这些文件，因为它有<code class="du mi mj mk lz b">cloudkms.cryptoKeyDecrypter </code>角色，可以访问文件和密钥。在不太可能的情况下，文件被泄漏，攻击者没有角色和密钥将无法解密它。</p><p id="1478" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">作为额外的安全措施，你为每个服务创建单独的密码文件，以最小化爆炸半径，以防密码本身被泄露。</p><p id="ac1a" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">有关密钥管理的更多信息，请参见<a class="ae ks" href="https://cloud.google.com/kms/docs/concepts" rel="noopener ugc nofollow" target="_blank"> KMS文档</a>。</p><p id="4740" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">1.在Cloud Shell中，创建一个<a class="ae ks" href="https://cloud.google.com/kms/docs/object-hierarchy#key_ring" rel="noopener ugc nofollow" target="_blank">密钥管理服务(KMS)密钥环</a>来保存您的密钥:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="ec14" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.创建一个<a class="ae ks" href="https://cloud.google.com/kms/docs/object-hierarchy#key" rel="noopener ugc nofollow" target="_blank">密钥管理服务(KMS)加密密钥</a>来加密您的密码:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="50ac" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.使用密钥加密您的Ranger管理员用户的密码。您可以使用自己的密码或下面提供的示例密码。确保至少使用八个字符，包括至少一个字母和一个数字。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="689b" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">4.使用密钥加密您的Ranger数据库管理员用户的密码:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="2fd4" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">5.使用以下密钥加密您的MySQL root密码:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="1309" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">6.<a class="ae ks" href="https://cloud.google.com/storage/docs/creating-buckets#storage-create-bucket-gsutil" rel="noopener ugc nofollow" target="_blank">创建云存储桶</a>存储加密密码文件:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="8121" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">7.将加密的密码文件上传到云存储桶。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h2 id="30ba" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">创建集群</h2><p id="3485" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">在本节中，您将创建一个支持Ranger的后端集群。有关Dataproc中Ranger可选组件的更多信息，请参见<a class="ae ks" href="https://cloud.google.com/dataproc/docs/concepts/components/ranger" rel="noopener ugc nofollow" target="_blank"> Dataproc Ranger组件文档页</a>。</p><p id="26f2" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">1.在Cloud Shell中，<a class="ae ks" href="https://cloud.google.com/storage/docs/creating-buckets#storage-create-bucket-gsutil" rel="noopener ugc nofollow" target="_blank">创建一个云存储桶</a>来存储Apache Solr审计日志:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="4f0c" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.导出创建集群所需的所有变量。为了方便起见，这里重复了之前设置的一些变量，因此您可以根据需要修改它们。</p><p id="5c88" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">新的变量是:</p><ul class=""><li id="0e2e" class="kt ku hi jr b js kn jw ko ka lh ke li ki lj km ky kz la lb bi translated">后端集群的名称</li><li id="4071" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">加密密钥的URI，以便服务帐户可以解密密码</li><li id="e190" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">包含加密密码的文件的URI</li></ul><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="1a0e" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">如果您使用了不同的密钥环、密钥或文件名，请在相应的变量中替换它们。</p><p id="3ad6" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.运行以下命令创建后端Dataproc集群:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="2911" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">最后三行是在HTTP模式下配置HiveServer2的Hive属性，这样Apache Knox就可以通过HTTP调用Apache Hive。</p><p id="cc46" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">以下是命令中出现的其他参数:</p><ul class=""><li id="2c21" class="kt ku hi jr b js kn jw ko ka lh ke li ki lj km ky kz la lb bi translated">启用Apache Ranger及其Solr依赖项</li><li id="b969" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated"><code class="du mi mj mk lz b">— enable-component-gateway</code>(可选)使<a class="ae ks" href="https://cloud.google.com/dataproc/docs/concepts/accessing/dataproc-gateways" rel="noopener ugc nofollow" target="_blank"> Dataproc组件网关</a>能够使Ranger和其他Hadoop用户界面直接从云控制台中的集群页面可用，而无需通过SSH隧道连接到后端主节点。</li><li id="5e9d" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated"><code class="du mi mj mk lz b">— scopes=default,sql-admin</code>授权Apache Ranger访问其云SQL数据库。</li></ul><p id="7515" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">可以包含其他参数和属性来创建外部配置单元metastore，该配置单元metastore在任何给定集群的生命周期之后仍然存在，并且可以跨多个集群使用。更多信息请参见<a class="ae ks" href="https://cloud.google.com/solutions/using-apache-hive-on-cloud-dataproc" rel="noopener ugc nofollow" target="_blank">在云上使用Apache Hive data proc文档</a>。</p><p id="5dc9" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">考虑到<code class="du mi mj mk lz b">gcloud dataproc jobs submit hive</code> <a class="ae ks" href="https://cloud.google.com/sdk/gcloud/reference/dataproc/jobs/submit/hive" rel="noopener ugc nofollow" target="_blank">命令</a>使用Hive二进制传输，与HTTP模式下配置的HiveServer2不兼容。因此，您必须直接在Beeline上运行该文档中的表创建示例。</p><h2 id="db3f" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">创建一个样本配置单元表</h2><p id="29b6" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">1.在Cloud Shell中，创建一个云存储桶来存储一个样本<a class="ae ks" href="https://parquet.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Parquet </a>文件:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="f876" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.将公开可用的拼花地板样本文件复制到您的存储桶中:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="0304" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.使用SSH连接到您在上一节中创建的后端集群的主节点。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="43d7" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">您的集群主节点的名称是集群的名称后跟<code class="du mi mj mk lz b"> -m</code>。对于高可用性集群，该名称有一个附加后缀<a class="ae ks" href="https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/high-availability#instance_names" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="7c33" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">如果这是第一次从Cloud Shell连接到您的主节点，将提示您生成SSH密钥。</p><p id="c83c" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">或者，您可以使用SSH从云控制台的<strong class="jr hj">data proc/Cluster Details/VM Instances下连接到您的名称节点。</strong></p><p id="72f9" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">4.进入SSH命令提示符后，使用预安装在主节点上的<a class="ae ks" href="https://cwiki.apache.org/confluence/display/Hive/HiveServer2+Clients#HiveServer2Clients-Beeline%E2%80%93CommandLineShell" rel="noopener ugc nofollow" target="_blank"> Apache Beeline </a>连接到本地HiveServer2。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="82ba" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">这个命令将启动Beeline CLI，并在一个环境变量中传递您的Google Cloud项目的名称。</p><p id="b92f" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">请注意，Hive不执行任何用户身份验证，但是它需要一个用户身份来执行大多数任务。这里的<code class="du mi mj mk lz b">admin</code>用户是配置在Hive中的默认用户。来自BI工具的请求的用户认证由本文后面用Apache Knox配置的身份提供者处理。</p><p id="4a92" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">5.在Beeline CLI中，使用之前在配置单元存储桶中复制的拼花文件创建一个表。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="c3cd" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">6.验证是否正确创建了该表:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="2e21" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">7.退出直线CLI:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="abee" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">8.记下后端主机的内部DNS名称。在下一节中，您将使用这个名称作为<code class="du mi mj mk lz b">&lt;backend-master-internal-dns-name&gt;</code>来配置Knox拓扑，然后在Ranger中配置服务。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="34a3" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">9.退出SSH命令行:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h1 id="538f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">创建代理群集</h1><p id="21ae" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">在本节中，您将使用<a class="ae ks" href="https://github.com/GoogleCloudDataproc/initialization-actions/tree/master/knox" rel="noopener ugc nofollow" target="_blank"> Apache Knox初始化操作</a>创建代理集群。</p><h2 id="4544" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">创建拓扑</h2><p id="1803" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">1.在Cloud Shell中，克隆data proc<a class="ae ks" href="https://github.com/GoogleCloudDataproc/initialization-actions" rel="noopener ugc nofollow" target="_blank">initial ization-actions GitHub仓库</a>。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="9b34" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.为后端群集创建拓扑:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="1032" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">Apache Knox将使用文件名作为拓扑的URL路径。这里，您更改了名称来表示名为<code class="du mi mj mk lz b">hive-us-transactions</code>的拓扑，以访问我们在上一节中加载到Hive的虚构事务的数据。</p><p id="f570" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.编辑拓扑文件:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="7c2a" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">花点时间观察一下<a class="ae ks" href="https://knox.apache.org/books/knox-1-1-0/user-guide.html#Topology+Descriptors" rel="noopener ugc nofollow" target="_blank">拓扑描述符</a>文件。这个文件定义了一个指向一个或多个后端服务的拓扑。使用示例值配置了两个服务:<a class="ae ks" href="https://hadoop.apache.org/docs/r1.0.4/webhdfs.html" rel="noopener ugc nofollow" target="_blank"> WebHDFS </a>和HIVE。该文件还为该拓扑和授权ACL中的服务定义了身份验证提供者。</p><p id="49ba" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">4.Apache Knox通过ACL提供服务级别的粗略授权。添加data analyst示例LDAP用户身份“<code class="du mi mj mk lz b">mary</code>”，以便她可以通过Knox访问Hive后端服务。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="a9e4" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">5.将配置单元url更改为指向后端群集配置单元服务。您可以在文件的最底部找到配置单元服务定义，就在WebHDFS服务的下面。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="e6bf" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">用您在上一节中获得的后端集群的内部DNS名称替换<code class="du mi mj mk lz b">&lt;backend-master-internal-dns-name&gt;</code>占位符。</p><p id="de25" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">6.保存文件并<a class="ae ks" href="https://stackoverflow.blog/2017/05/23/stack-overflow-helping-one-million-developers-exit-vim/" rel="noopener ugc nofollow" target="_blank">关闭编辑器</a>。</p><p id="1d2a" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">此时，您可以通过重复本节中的步骤来创建额外的拓扑，并为每个拓扑创建一个独立的XML描述符。</p><p id="0eda" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">在随后的部分中，您将这些文件复制到云存储桶中。要在创建代理集群后创建新的拓扑或更改它们，请修改文件并再次将它们上传到bucket。初始化操作创建一个cron作业，该作业定期将bucket中的更改复制到代理集群。</p><h2 id="60f0" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">配置SSL/TLS证书</h2><p id="a322" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">当客户端与Apache Knox通信时，它们将使用SSL/TLS证书。初始化操作可以生成自签名证书，或者您可以提供CA签名的证书。</p><p id="c4f3" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">要生成自签名证书，请遵循以下说明:</p><p id="816a" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">1.在云Shell中编辑Apache Knox常规配置文件:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="c3c9" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.用主节点的外部DNS名称替换<code class="du mi mj mk lz b">HOSTNAME</code>，作为<code class="du mi mj mk lz b">certificate_hostname</code>属性的值。出于演示目的，使用<code class="du mi mj mk lz b">localhost</code>。这个值需要您在本地机器和代理集群之间创建一个SSH隧道，这将在本文后面介绍。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="29d7" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">注意，该文件还包含用于加密BI工具将用来与代理集群通信的证书的<code class="du mi mj mk lz b">master_key</code>。默认情况下，这个键是单词<code class="du mi mj mk lz b">secret</code>。</p><p id="0b40" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.保存文件并关闭编辑器。</p><p id="20b0" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">另一方面，如果您提供自己的证书，您可以在属性<code class="du mi mj mk lz b">custom_cert_name</code>中指定它。</p><h2 id="6540" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">启动代理集群</h2><p id="8131" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">1.在Cloud Shell中，创建一个云存储桶，以将上一节中的配置提供给Knox初始化操作:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="2165" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.将Knox初始化操作文件夹中的所有文件复制到桶中:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="8ec6" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.导出创建集群所需的所有变量。为了方便起见，这里重复了之前设置的一些变量，以便您可以根据需要修改它们。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="c211" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">4.创建代理群集:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h2 id="4d5e" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">通过代理验证连接</h2><p id="6ff6" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">1.创建代理集群后，使用SSH从云外壳连接到其主节点:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="ae84" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.从代理群集主节点SSH命令提示符运行查询:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="4a2f" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">让我们分析一下这个命令:</p><ul class=""><li id="c43d" class="kt ku hi jr b js kn jw ko ka lh ke li ki lj km ky kz la lb bi translated"><code class="du mi mj mk lz b">beeline</code>命令使用<code class="du mi mj mk lz b">localhost</code>而不是DNS内部名称，因为您在配置Knox时生成的证书将<code class="du mi mj mk lz b">localhost</code>指定为主机名。如果您使用自己的DNS名称或证书，请使用相应的主机名。</li><li id="fcdc" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">端口是<code class="du mi mj mk lz b">8443</code>，对应Apache Knox默认的SSL端口。</li><li id="57b4" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">下一行启用SSL，并为客户端应用程序(如Beeline)使用的SSL信任存储提供路径和密码。</li><li id="e7bd" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated"><code class="du mi mj mk lz b">transportMode</code>线应该看起来很熟悉。它指示请求应该通过HTTP发送，并为HiveServer2服务提供路径。请注意，路径由关键字<code class="du mi mj mk lz b">gateway</code>组成，后面是您在上一节中定义的拓扑名称，后面是在所述拓扑中配置的服务名称，在本例中是<code class="du mi mj mk lz b">hive</code>。</li><li id="86fb" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">使用<code class="du mi mj mk lz b">-e</code>参数，您可以提供在Hive上运行的查询。如果省略，您将在Beeline CLI中打开一个交互式会话。</li><li id="f619" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">使用<code class="du mi mj mk lz b">-n</code>参数，您可以提供一个用户身份和密码。在这种情况下，您使用的是默认的Hive <code class="du mi mj mk lz b">admin</code>用户。在接下来的部分中，您将创建一个分析师用户身份，并为此用户设置凭据和授权策略。</li></ul><h2 id="0d77" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">将用户添加到身份验证存储</h2><p id="dae2" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">默认情况下，Knox包括一个基于<a class="ae ks" href="https://shiro.apache.org/" rel="noopener ugc nofollow" target="_blank">阿帕奇·希罗</a>的认证提供者，该认证提供者配置有针对<a class="ae ks" href="https://directory.apache.org/apacheds/" rel="noopener ugc nofollow" target="_blank"> ApacheDS </a> LDAP存储的基本认证。在本节中，您将向此身份验证存储添加一个示例data analyst用户身份“<code class="du mi mj mk lz b">mary</code>”。</p><ol class=""><li id="1c97" class="kt ku hi jr b js kn jw ko ka lh ke li ki lj km mn kz la lb bi translated">在代理主节点SSH命令提示符下，安装LDAP实用程序:</li></ol><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="4462" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.为新用户“<code class="du mi mj mk lz b">mary</code>”创建一个LDAP数据交换格式(LDIF)文件:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="e8ab" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.将用户ID添加到LDAP目录:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="b914" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated"><code class="du mi mj mk lz b">-D</code>参数指定访问目录时要绑定的可分辨名称(DN ),它必须是目录中已经存在的用户身份，在本例中是用户<code class="du mi mj mk lz b">admin</code>。</p><p id="5dd9" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">4.验证是否添加了新用户:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="5424" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">5.记下代理主机的内部DNS名称。在下一节中，您将使用这个名称作为<code class="du mi mj mk lz b">&lt;proxy-master-internal-dns-name&gt;</code>来配置LDAP同步。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="90a4" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">6.退出SSH命令行</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h1 id="5cac" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">设置授权</h1><h2 id="fa5d" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">将用户身份同步到Ranger</h2><p id="42bc" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">为了确保Ranger策略适用于Knox使用的相同用户身份，配置<a class="ae ks" href="https://docs.cloudera.com/HDPDocuments/HDP3/HDP-3.1.5/configuring-ranger-authe-with-unix-ldap-ad/content/ranger_ad_integration_ranger_usersync.html" rel="noopener ugc nofollow" target="_blank"> Ranger UserSync守护进程</a>来同步Knox正在使用的相同目录中的身份。</p><p id="f54d" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">在这个例子中，您连接到Apache Knox默认可用的本地LDAP，但是在生产环境中，您应该设置一个外部身份目录。您可以在谷歌云的<a class="ae ks" href="https://knox.apache.org/books/knox-1-4-0/user-guide.html#Authentication" rel="noopener ugc nofollow" target="_blank"> Apache Knox用户指南</a>和<a class="ae ks" href="https://cloud.google.com/identity" rel="noopener ugc nofollow" target="_blank">云身份</a>、<a class="ae ks" href="https://cloud.google.com/managed-microsoft-ad/docs" rel="noopener ugc nofollow" target="_blank">托管活动目录</a>和<a class="ae ks" href="https://cloud.google.com/solutions/federating-gcp-with-active-directory-introduction" rel="noopener ugc nofollow" target="_blank">联合AD </a>文档中找到更多信息。</p><p id="711a" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">1.使用SSH连接到之前创建的后端集群的主节点</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="0a49" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.编辑用户同步配置文件:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="b8e2" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.设置以下LDAP属性的值。确保您正在修改的是<code class="du mi mj mk lz b">user</code>属性，而不是<code class="du mi mj mk lz b">group</code>属性，它们具有相似的名称。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="0e69" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">用代理服务器的内部DNS名称替换<code class="du mi mj mk lz b">&lt;proxy-master-internal-dns-name&gt;</code>占位符，这是在上一节中获得的。</p><p id="574b" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">请注意，这是同步用户和组的完整LDAP配置的子集。更多信息见本文件。</p><p id="5020" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">4.保存文件并关闭编辑器。</p><p id="5726" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">5.重新启动Ranger用户同步守护程序:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="232d" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">您可以在<code class="du mi mj mk lz b">/var/log/ranger-usersync/</code>下的日志文件中验证用户身份，包括数据分析师Mary的身份是否正确同步</p><h2 id="880b" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">创建管理员策略</h2><p id="904f" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated"><strong class="jr hj">配置ranger服务</strong></p><p id="9a44" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">1.在主节点SSH命令提示符下，编辑Ranger配置单元配置:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="580a" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.编辑<code class="du mi mj mk lz b">ranger.plugin.hive.service.name</code>属性的<code class="du mi mj mk lz b">&lt;value&gt;</code>:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="fa62" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.保存文件并关闭编辑器。</p><p id="73e8" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">4.重新启动HiveServer2管理服务。您已经准备好创建Ranger策略。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="f624" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated"><strong class="jr hj">在管理员管理界面设置服务</strong></p><p id="6aa4" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">1.在浏览器中，导航到云控制台中的<a class="ae ks" href="https://console.cloud.google.com/dataproc" rel="noopener ugc nofollow" target="_blank"> Dataproc页面</a>。</p><p id="eed1" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">单击后端集群名称，然后单击<strong class="jr hj"> Web界面</strong>。</p><p id="dfcf" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">因为您使用<a class="ae ks" href="https://cloud.google.com/dataproc/docs/concepts/accessing/dataproc-gateways" rel="noopener ugc nofollow" target="_blank">组件网关</a>创建了集群，所以您应该会看到集群中安装的Hadoop组件的列表。</p><p id="87f3" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">点击<strong class="jr hj"> Ranger </strong>链接，打开Ranger UI。</p><p id="a464" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">如果您不想使用组件网关创建集群，那么您可以创建一个从您的工作站到后端主节点的SSH隧道。Ranger UI在<a class="ae ks" href="https://docs.cloudera.com/HDPDocuments/HDP3/HDP-3.1.5/administration/content/ranger-ports.html" rel="noopener ugc nofollow" target="_blank">端口6080 </a>上可用。您需要创建一个防火墙规则来打开该端口的入口。</p><p id="c7f8" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.使用用户<code class="du mi mj mk lz b">admin</code>和您之前定义的Ranger管理员密码登录Ranger。Ranger UI显示服务管理器屏幕，其中包含服务列表。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mo"><img src="../Images/e85a54d0b2e6126bad1ca5c0baf5efbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qrbOLLxeGOjnpOPDDs8fQQ.png"/></div></div></figure><p id="896a" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.单击配置单元组中的加号创建新的配置单元服务</p><p id="c110" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">4.用以下值填写表单:</p><ul class=""><li id="1e1d" class="kt ku hi jr b js kn jw ko ka lh ke li ki lj km ky kz la lb bi translated">服务名称:<code class="du mi mj mk lz b">ranger-hive-service-01</code>。这是您先前在<code class="du mi mj mk lz b">ranger-hive-security.xml</code>配置文件中定义的名称。</li><li id="8668" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">用户名:<code class="du mi mj mk lz b">admin</code></li><li id="8885" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">密码:<code class="du mi mj mk lz b">admin-password</code></li><li id="efcd" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">jdbc.driverClassName:保留默认值<code class="du mi mj mk lz b">org.apache.hive.jdbc.HiveDriver</code></li><li id="6f28" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">jdbc.url: <code class="du mi mj mk lz b">jdbc:hive2://&lt;backend-master-internal-dns-name&gt;:10000/;transportMode=http;httpPath=cliservice</code></li></ul><p id="ac48" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">将<code class="du mi mj mk lz b">&lt;backend-master-internal-dns-name&gt;</code>占位符替换为您在上一节中获得的名称。</p><p id="f9d7" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">5.点击<strong class="jr hj">添加</strong>按钮。</p><p id="3df2" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">记住<a class="ae ks" href="https://stackoverflow.com/questions/33270255/apache-ranger-multiple-policy-repo-for-hive-plugin" rel="noopener ugc nofollow" target="_blank">每个Ranger插件安装只支持一个Hive服务</a>。配置附加Hive服务的一个简单方法是启动附加后端集群，每个集群都有自己的Ranger插件。这些集群可以共享同一个Ranger DB，因此无论何时从任何集群访问Ranger Admin UI，您都可以获得所有服务的统一视图。</p><p id="2632" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated"><strong class="jr hj">设置游侠策略</strong></p><p id="316b" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">该策略允许sample analyst LDAP用户"<code class="du mi mj mk lz b">mary</code>"访问Hive表的特定列:</p><p id="e982" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">1.返回服务管理器屏幕，单击您刚刚创建的服务的名称。</p><p id="8299" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">Ranger Admin显示策略屏幕。</p><p id="c209" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.点击<strong class="jr hj">添加新策略</strong>按钮。</p><p id="cae5" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">根据该策略，您将授予Mary仅查看表事务中的列<code class="du mi mj mk lz b">submissionDate</code>和<code class="du mi mj mk lz b">transactionType</code>的权限。</p><p id="bbd4" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.用以下值填写表单:</p><ul class=""><li id="393b" class="kt ku hi jr b js kn jw ko ka lh ke li ki lj km ky kz la lb bi translated">策略名称:任何名称，例如<code class="du mi mj mk lz b">allow-tx-columns</code></li><li id="cfb5" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">数据库:<code class="du mi mj mk lz b">default</code></li><li id="5ca3" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">表:<code class="du mi mj mk lz b">transactions</code></li><li id="35c3" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">蜂巢柱:<code class="du mi mj mk lz b">submissionDate, transactionType</code></li></ul><p id="ab38" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">允许条件:</p><ul class=""><li id="490a" class="kt ku hi jr b js kn jw ko ka lh ke li ki lj km ky kz la lb bi translated">选择用户:<code class="du mi mj mk lz b">mary</code></li><li id="efe2" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">权限:<code class="du mi mj mk lz b">select</code></li></ul><p id="2e12" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">4.点击屏幕底部的<strong class="jr hj">添加</strong></p><p id="870a" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated"><strong class="jr hj">用直线测试策略</strong></p><p id="0eb3" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">1.回到主节点SSH命令提示符，使用用户“<code class="du mi mj mk lz b">mary</code>”输入直线CLI。请注意，密码不是强制的。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="0578" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.运行以下查询以验证它是否被Ranger阻止。(包括<code class="du mi mj mk lz b">transactionAmount</code>列，Mary不允许选择):</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="8a43" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">您应该得到一个<strong class="jr hj">权限被拒绝</strong>错误。</p><p id="aab2" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.运行以下查询以验证Ranger是否允许:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="b28d" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">4.退出直线CLI。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="1653" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">5.退出SSH命令行。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="3ecb" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">6.回到Ranger UI，点击顶部的<strong class="jr hj">审计</strong>选项卡。你应该看到<strong class="jr hj">被拒绝</strong>和<strong class="jr hj">被允许</strong>的事件。您可以根据之前定义的服务名过滤事件，例如:<code class="du mi mj mk lz b">ranger-hive-service-01</code>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mp"><img src="../Images/466dbe57b401312cd7ae789c87e0e3b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bK8SLOlp_LH46I1HQf0KiA.png"/></div></div></figure><h1 id="ebf7" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">从BI工具连接</h1><p id="d5b3" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">本文的最后一步是从BI工具(如Tableau和Looker)中查询Hive数据。我们使用Tableau作为BI工具的示例，所以我们假设您的工作站上运行着Tableau Desktop。</p><h2 id="b414" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">创建防火墙规则</h2><ol class=""><li id="17bd" class="kt ku hi jr b js jt jw jx ka kv ke kw ki kx km mn kz la lb bi translated">记下你的<a class="ae ks" href="https://www.google.com/search?q=what+is+my+ip+address" rel="noopener ugc nofollow" target="_blank">公共IP地址</a>。</li><li id="a12c" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km mn kz la lb bi translated">在Cloud Shell中，创建一个防火墙规则，打开TCP端口<code class="du mi mj mk lz b">8443</code>以便从您的工作站进入。</li></ol><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="98d2" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">用您的公共IP替换<code class="du mi mj mk lz b">&lt;your-public-ip&gt;</code>占位符。</p><p id="c78e" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.将防火墙规则中的网络标记应用到代理群集主节点:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="2b12" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">4.记下代理群集主节点的外部IP地址；您将在接下来的步骤中使用它:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h2 id="f65e" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">创建SSH隧道</h2><p id="0ea9" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">只有当您使用对<code class="du mi mj mk lz b">localhost</code>有效的自签名证书时，才需要此步骤。如果您使用自己的证书或主节点有自己的外部DNS名称，您可以跳过这一步。</p><p id="5c05" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">1.在Cloud Shell中，生成创建隧道的命令:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="d9c6" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.在您的工作站上安装<a class="ae ks" href="https://cloud.google.com/sdk/docs" rel="noopener ugc nofollow" target="_blank"> Google Cloud SDK </a>。</p><p id="947a" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.运行<code class="du mi mj mk lz b">gcloud init</code>来验证您的用户帐户并授予访问权限。</p><p id="744b" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">4.在您的工作站中打开一个终端。</p><p id="b0f4" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">5.创建到转发端口<code class="du mi mj mk lz b">8443</code>的SSH隧道。</p><p id="b209" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">6.复制第一步中生成的命令，并将其粘贴到工作站终端。运行命令。</p><p id="560e" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">7.让终端保持打开状态，以便隧道保持活动状态。</p><h2 id="1968" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">连接到配置单元</h2><p id="eda0" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">1.在您的工作站上安装<a class="ae ks" href="https://www.cloudera.com/downloads/connectors/hive/odbc/2-6-4.html" rel="noopener ugc nofollow" target="_blank"> Hive ODBC驱动程序</a>。</p><p id="5752" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.打开Tableau Desktop，如果它已打开，请重新启动它。</p><p id="ce3e" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.在主屏幕上的<strong class="jr hj">连接/至服务器</strong>下，选择<strong class="jr hj">更多… </strong></p><p id="fb4c" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">4.搜索并选择<strong class="jr hj"> Cloudera Hadoop </strong>。</p><p id="7caf" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">5.按如下方式填写字段:</p><ul class=""><li id="555b" class="kt ku hi jr b js kn jw ko ka lh ke li ki lj km ky kz la lb bi translated">服务器:<code class="du mi mj mk lz b">localhost</code>如果你创建了一个隧道，或者你的主节点外部DNS名称如果没有。</li><li id="f2cf" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">端口:<code class="du mi mj mk lz b">8443</code></li><li id="0afe" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">类型:<code class="du mi mj mk lz b">HiveServer2</code></li><li id="4908" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">身份验证:用户名和密码</li><li id="3191" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">用户名:<code class="du mi mj mk lz b">mary</code></li><li id="cda7" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">密码:<code class="du mi mj mk lz b">mary-password</code></li><li id="ed6e" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">HTTP路径:<code class="du mi mj mk lz b">gateway/hive-us-transactions/hive</code></li><li id="a7b0" class="kt ku hi jr b js lc jw ld ka le ke lf ki lg km ky kz la lb bi translated">需要SSL: <code class="du mi mj mk lz b">yes</code></li></ul><p id="a87c" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">请注意，您使用示例data analyst LDAP用户<code class="du mi mj mk lz b">mary</code>作为用户身份。</p><p id="6317" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">6.点击<strong class="jr hj">签到。</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mq"><img src="../Images/2104688059c858f7afd87f6349992996.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u5w6v4jFJ_l3o__t1QCvqQ.png"/></div></div></figure><h2 id="353c" class="lk ig hi bd ih ll lm ln il lo lp lq ip ka lr ls it ke lt lu ix ki lv lw jb lx bi translated">查询配置单元数据</h2><p id="c146" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">1.在<strong class="jr hj">数据源</strong>界面，点击<strong class="jr hj">选择方案</strong> a并搜索<code class="du mi mj mk lz b">default</code>。</p><p id="7b27" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">2.双击<code class="du mi mj mk lz b">default</code>模式名称。</p><p id="5c9e" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated"><strong class="jr hj">工作台</strong>面板加载。</p><p id="ac92" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">3.在<strong class="jr hj">表</strong>面板中，双击<strong class="jr hj">新建自定义SQL </strong>。</p><p id="5a92" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated"><strong class="jr hj">编辑自定义SQL </strong>窗口打开。</p><p id="c32f" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">4.输入以下查询:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="cafd" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">5.点击<strong class="jr hj">确定。</strong></p><p id="22e5" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">查询的元数据是从配置单元中检索的。</p><p id="6dd2" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">6.点击<strong class="jr hj">立即更新</strong>按钮。</p><p id="a0cf" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">Tableau从Hive中检索数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mr"><img src="../Images/78c2d010559e945b11e03c2e39a4535c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LRvuW4aqN3JfF8uBotXdew.png"/></div></div></figure><p id="1707" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">7.现在尝试从<code class="du mi mj mk lz b">transactions</code>表中选择所有列。在<strong class="jr hj">表</strong>面板中，再次双击<strong class="jr hj">新建自定义SQL </strong>。<strong class="jr hj">编辑自定义SQL </strong>窗口打开。</p><p id="c135" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">8.输入以下查询:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="f310" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">9.点击<strong class="jr hj">确定</strong>。您会得到一条错误消息:</p><p id="667e" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated"><code class="du mi mj mk lz b">Permission denied: user [mary] does not have [SELECT] privilege on [default/transactions/*]</code>。</p><p id="cf2f" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">这是意料之中的，因为Mary没有被Ranger授权读取<code class="du mi mj mk lz b">transactionAmount</code>列。这样，您可以限制Tableau用户可以访问的数据。</p><p id="4494" class="pw-post-body-paragraph jp jq hi jr b js kn ju jv jw ko jy jz ka kp kc kd ke kq kg kh ki kr kk kl km hb bi translated">为了能够看到所有的列，对用户重复这些步骤<code class="du mi mj mk lz b">admin</code>。</p><h1 id="9677" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">结论</h1><p id="3920" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">在这些文章中，您已经看到了如何从BI工具访问Hive数据。您已经将Tableau配置为通过安全通道与运行在Dataproc集群上的Apache Knox进行通信，并且已经使用LDAP目录对用户进行了身份验证。最后，您已经设置了一个Hive服务，它可以在Dataproc后端集群中处理请求，通过Apache Ranger中定义的授权策略进一步保护数据。</p></div></div>    
</body>
</html>