<html>
<head>
<title>Things I wish I knew about Google Cloud Pub/Sub: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于谷歌云发布/订阅，我希望知道的事情:第1部分</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/things-i-wish-i-knew-about-google-cloud-pub-sub-852fac1ffbc6?source=collection_archive---------0-----------------------#2020-12-03">https://medium.com/google-cloud/things-i-wish-i-knew-about-google-cloud-pub-sub-852fac1ffbc6?source=collection_archive---------0-----------------------#2020-12-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b368" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">发布/订阅似乎是一个简单的话题，但实际上有相当多的微妙之处需要考虑。可能会忽略一些细节，而这些细节可能会让你的体验更流畅、更便宜、更少挫败感。为此，Google Cloud Pub/Sub客户端库的开发人员关系团队正在启动一个博客系列，提供一些您可能会觉得有用的信息和技巧。</p><p id="2ee6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">事不宜迟…！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/11d37575fb55650d219ab8bd12487ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*aryNpjtAU4mkKF-LXzCM6Q.png"/></div></figure><h1 id="484e" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">什么是Google Cloud Pub/Sub？</h1><h2 id="30e2" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">Google Cloud Pub/Sub是一个托管的、全球可用的消息服务，可以根据需求自动扩展。</h2><p id="993d" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">为了从最基本的角度理解该服务，请熟悉四个关键组件:主题、订阅、发布者客户端和订阅者客户端。</p><ul class=""><li id="6c9e" class="lc ld hi ih b ii ij im in iq le iu lf iy lg jc lh li lj lk bi translated">发布/订阅客户端向<strong class="ih hj">主题</strong>发布消息。</li><li id="18c7" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">发布/订阅客户端接收来自<strong class="ih hj">订阅</strong>的消息。您可以为同一主题创建多个订阅，在这种情况下，每个订阅都会获得该主题中所有消息的副本。一些初学者认为人们会从<strong class="ih hj">主题</strong>中提取信息，这是不可能的——<strong class="ih hj">主题</strong>仅用于发布。<strong class="ih hj">订阅</strong>是您接收所有消息的地方。</li><li id="4edf" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">您的应用程序可以创建多个<strong class="ih hj">发布/订阅客户端</strong>来跨不同的进程发布到一个主题。(下面提到了一些注意事项。)</li><li id="8590" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">您的应用程序还可以为单个订阅创建多个<strong class="ih hj">订阅者客户端</strong>，在这种情况下，消息传递会在它们之间实现负载平衡。消息被发送到<strong class="ih hj">订阅</strong>的一个客户端，而不是所有客户端。</li></ul><h1 id="f066" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">如何调用发布/订阅API？</h1><h2 id="dfc4" class="kj jm hi bd jn kk kl km jr kn ko kp jv iq kq kr jz iu ks kt kd iy ku kv kh kw bi translated">你可以通过<a class="ae lq" href="http://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">谷歌云控制台</a>和<a class="ae lq" href="https://cloud.google.com/sdk" rel="noopener ugc nofollow" target="_blank">云SDK </a>以及<a class="ae lq" href="https://cloud.google.com/pubsub/docs/quickstart-client-libraries" rel="noopener ugc nofollow" target="_blank">官方客户端库</a>使用Pub/Sub。访问Pub/Sub API最常见的方式是通过客户端库，有8种语言可用(<a class="ae lq" href="https://cloud.google.com/pubsub/docs/quickstart-client-libraries#cpp" rel="noopener ugc nofollow" target="_blank"> C++ </a>、<a class="ae lq" href="https://cloud.google.com/pubsub/docs/quickstart-client-libraries#c" rel="noopener ugc nofollow" target="_blank"> C# </a>、<a class="ae lq" href="https://cloud.google.com/pubsub/docs/quickstart-client-libraries#pubsub-client-libraries-go" rel="noopener ugc nofollow" target="_blank"> Go </a>、<a class="ae lq" href="https://cloud.google.com/pubsub/docs/quickstart-client-libraries#java" rel="noopener ugc nofollow" target="_blank"> Java </a>、<a class="ae lq" href="https://cloud.google.com/pubsub/docs/quickstart-client-libraries#node.js" rel="noopener ugc nofollow" target="_blank"> Node </a>、<a class="ae lq" href="https://cloud.google.com/pubsub/docs/quickstart-client-libraries#php" rel="noopener ugc nofollow" target="_blank"> PHP </a>、<a class="ae lq" href="https://cloud.google.com/pubsub/docs/quickstart-client-libraries#pubsub-client-libraries-python" rel="noopener ugc nofollow" target="_blank"> Python </a>、<a class="ae lq" href="https://cloud.google.com/pubsub/docs/quickstart-client-libraries#ruby" rel="noopener ugc nofollow" target="_blank"> Ruby </a>)。</h2><p id="d665" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">这些库提供了符合语言习惯的方法来创建主题、发布主题消息、创建主题订阅以及从订阅接收消息。这些客户端是手写的，构建在<a class="ae lq" href="https://github.com/googleapis/java-pubsub/tree/master/proto-google-cloud-pubsub-v1/src/main" rel="noopener ugc nofollow" target="_blank">自动生成的库</a>之上，这些库公开了可从发布/订阅服务器获得的基本RPC方法。这使我们能够添加一些有用的功能，主要是提高吞吐量、最小化延迟，并使处理传入消息变得更容易。</p><p id="4938" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为库缓存像认证令牌这样的信息，所以我们建议在一个进程中对每个资源只实例化一个Pub/Sub客户机实例，而不是创建多个客户机。这因语言而异；例如，Java使用单独的客户端类，而Node有一个PubSub类，应该为每个进程、每个Pub/Sub服务器连接创建；然后用于创建发布和订阅的客户端。</p><p id="0303" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Node中，它可能看起来像这样:</p><pre class="je jf jg jh fd lr ls lt lu aw lv bi"><span id="af86" class="kj jm hi ls b fi lw lx l ly lz">let pubSubClient, topic;</span><span id="267c" class="kj jm hi ls b fi ma lx l ly lz">async function main() {<br/>  pubSubClient = new PubSub();<br/>  topic = pubSubClient.topic(‘myTopic’);<br/>  topic.publish(Buffer.from(‘test!’));<br/>  await doOtherWork();<br/>}</span><span id="2a09" class="kj jm hi ls b fi ma lx l ly lz">async function doOtherWork() {<br/>  // ...<br/>  topic.publish(Buffer.from(‘also test!’));<br/>  // ...<br/>}</span><span id="ab3e" class="kj jm hi ls b fi ma lx l ly lz">main().catch(console.error);</span></pre><p id="6b1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个库都有一个功能更全的Quickstart，用于更全面的示例；比如<a class="ae lq" href="https://github.com/googleapis/nodejs-pubsub#quickstart" rel="noopener ugc nofollow" target="_blank">节点快速启动</a>。</p><p id="5279" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您想更好地控制我们的客户端库中没有的特性，您可以使用自动生成的库、<a class="ae lq" href="https://cloud.google.com/pubsub/docs/reference/rest" rel="noopener ugc nofollow" target="_blank"> REST </a>或<a class="ae lq" href="https://cloud.google.com/pubsub/docs/reference/rpc" rel="noopener ugc nofollow" target="_blank"> RPC </a>存根来构建自己的客户端库。但是，我们强烈建议您寻找一种客户端库本身支持的方法。如果找不到，请在GitHub或<a class="ae lq" href="https://issuetracker.google.com/issues?q=componentid:187173" rel="noopener ugc nofollow" target="_blank"> Buganizer </a>上的相应库添加一个错误报告。</p><h1 id="f31d" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">还会有更多</h1><p id="ecbe" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">感谢您的阅读，请期待来自发布/订阅开发者关系团队的未来帖子(Part <a class="ae lq" rel="noopener" href="/google-cloud/things-i-wish-i-knew-about-google-cloud-pub-sub-part-2-b037f1f08318"> 2 </a>，<a class="ae lq" rel="noopener" href="/google-cloud/things-i-wish-i-knew-about-pub-sub-part-3-b8947b49224b"> 3 </a>)，这些帖子将帮助您更加轻松地使用发布/订阅！我们也很乐意听到你关于你想讨论的话题，或者你对这个帖子有什么意见！</p></div></div>    
</body>
</html>