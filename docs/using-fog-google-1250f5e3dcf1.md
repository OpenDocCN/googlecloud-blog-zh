# 使用谷歌雾

> 原文：<https://medium.com/google-cloud/using-fog-google-1250f5e3dcf1?source=collection_archive---------0----------------------->

![](img/a7a6bd2b167a6d84e0ef22ed71d6dce9.png)

树林里的雾。

两周前，我开始试验[雾](https://github.com/fog/fog)，特别是[雾-谷歌](https://github.com/fog/fog-google)。我在之前的一份工作中使用了 fog 和 AWS，想看看对谷歌云平台的支持是否具有可比性。

我不得不说这个实验很艰难。Fog 的任务并不令人羡慕，它试图为大量具有不同功能和理念的云提供商提供一个逻辑统一的接口。此外，因为这是 Ruby，所以它应该在保持最小惊奇原则的同时做到这一点。这可能是一项不可能完成的任务。也就是说，我能够使用计算引擎创建一个虚拟机，并使用 fog 将一个文件上传到云存储，所以我知道基本的工作。

# 证明

有许多方法可以使用 fog 设置身份验证。我选择使用一个和其他点文件一起保存的 YAML 文件。

一个例子。雾文件

唯一棘手的是弄清楚`google_client_email`键是什么。这是自动生成的服务帐户 id，看起来像电子邮件地址。您可以从云控制台中的服务帐户页面获得此信息。我使用了默认配置，但是如果你需要的话,`.fog`文件允许你有多种配置。例如，我可以想象拥有阶段、生产和开发配置会很方便。

# 云存储

将文件上传到云存储的代码很简单。

使用 fog 上传文件的基本脚本

您需要做的就是连接到存储，创建一个桶，然后将您想要上传的对象放入桶中。您可以使用其他方法，但是 API 可能不完全直观。我建议查看[储雾文档](http://fog.io/storage/)以了解最佳实践。

使用 fog 在计算引擎上创建虚拟机是一个两步过程。首先，创建一个磁盘，然后创建一个使用该磁盘的服务器。

下面是创建磁盘的代码。

在 Google 计算引擎上初始化和创建磁盘

第 1 行到第 6 行连接到 Google 计算引擎，并设置稍后使用的常量。创建磁盘的方法采用选项哈希。我指定了桌子名称、大小、区域(使用常量)和操作系统映像。调用此方法开始创建磁盘，但磁盘不一定准备好立即挂载。所以我使用`disk.wait_for`来暂停我的脚本，直到磁盘准备好。

创建磁盘后，我可以在创建新虚拟机时使用它。

用 fog-google 创建一个 Google 计算引擎虚拟机。(以上脚本的后半部分。)

就像磁盘创建服务器创建需要一个选项散列。我指定了比创建磁盘更多的选项。我像对待磁盘一样传递名称和计算区域。我还传递了一个包含我刚刚创建的磁盘的磁盘数组。我必须指定机器的类型，并且我可以传入 ssh 密钥，这样一旦它准备好了，我就可以 ssh 到服务器。在调用`servers.create`之后，我等待服务器准备好，然后退出我的脚本。

# 结论

这是一篇关于雾和雾的超级基础介绍——谷歌。雾已经存在很长时间了，有许多教程涵盖了更具体的场景。雾-谷歌有一些粗糙的地方，但我知道几个人正在积极地工作，我希望也能贡献一些。

10/28/16

*原载于 2016 年 10 月 28 日【www.thagomizer.com】[](http://www.thagomizer.com/blog/2016/10/28/using-fog-google.html)**。***