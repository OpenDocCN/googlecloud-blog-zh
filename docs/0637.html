<html>
<head>
<title>A few helpful CLI snippets when developing with Docker, Git, &amp; Google Cloud Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Docker、Git和Google云平台开发时，一些有用的CLI片段</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/a-few-helpful-cli-snippets-when-developing-with-docker-git-google-cloud-platform-5761b6102f3d?source=collection_archive---------0-----------------------#2018-06-08">https://medium.com/google-cloud/a-few-helpful-cli-snippets-when-developing-with-docker-git-google-cloud-platform-5761b6102f3d?source=collection_archive---------0-----------------------#2018-06-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="c2fc" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated"><strong class="il hj">前言<br/> </strong> <em class="hi">我主要是给自己记下这些，也是为了和社区分享。随着时间的推移，我会组织、记录并将其转移到Github repo。我也很乐意收集你用过的，留下评论，我会把它们加进去。</em></p></blockquote><p id="1c5b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">这些是我在使用Node.js开发dockerized应用程序时使用的随机CLI片段，部署在Kubernetes上，通常在Google云平台上。您可以假设它们都是单行CLI命令。</p><p id="d971" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">我通常会在我的<code class="du jk jl jm jn b">.zshrc</code>(或<code class="du jk jl jm jn b">.bashrc</code>)文件中为一些更常用的命令添加一个别名(CLI快捷方式)。</p><p id="a19f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">例如，要为用于检查pod的常见Kubernetes命令添加别名:</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="e677" class="jw jx hi jn b fi jy jz l ka kb"># original CLI command:<br/>$ kubectl get pods</span><span id="5721" class="jw jx hi jn b fi kc jz l ka kb"># shorter alias<br/>$ kp</span></pre><p id="9949" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">要创建这个，打开<code class="du jk jl jm jn b">~/.zshrc</code>并添加下面一行</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="7e59" class="jw jx hi jn b fi jy jz l ka kb"># Example aliases<br/># alias zshconfig="mate ~/.zshrc"<br/># alias ohmyzsh="mate ~/.oh-my-zsh"</span><span id="15c2" class="jw jx hi jn b fi kc jz l ka kb">alias kp="kubectl get pods"</span></pre><p id="95d5" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">然后你只需要输入<code class="du jk jl jm jn b">kp</code>来检查你的豆荚。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><p id="0a9f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">从当前文件夹中获取当前的github项目名称</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="3067" class="jw jx hi jn b fi jy jz l ka kb">export DEPLOYMENT=$(basename -s .git `git config --get remote.origin.url`)</span></pre><p id="b006" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">获取当前的谷歌云项目</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="8a62" class="jw jx hi jn b fi jy jz l ka kb">export PROJECT_ID=$(gcloud config get-value project)</span></pre><p id="0022" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">在当前启用git的文件夹中构建一个docker映像，用project-id、git repo名称和当前git头进行标记</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="1688" class="jw jx hi jn b fi jy jz l ka kb">export IMAGE_NAME=gcr.io/$(gcloud config get-value project)/$DEPLOYMENT:$(git rev-parse HEAD)</span></pre><p id="ae28" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">从上面您刚刚创建的自定义图像名称构建一个Docker容器</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="89a9" class="jw jx hi jn b fi jy jz l ka kb">docker build -t $IMAGE_NAME .</span></pre><p id="9141" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">运行一个Docker容器，从自定义镜像名，自动从当前文件夹命名为github repo name</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="8fd1" class="jw jx hi jn b fi jy jz l ka kb">export DPORT=5000 &amp;&amp; docker run --rm -p $DPORT:$DPORT --name $(basename -s .git `git config --get remote.origin.url`) $IMAGE_NAME</span></pre><p id="a194" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">或者，如果您设置了部署环境:</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="6115" class="jw jx hi jn b fi jy jz l ka kb">export DPORT=5000 &amp;&amp; docker run --rm -p $DPORT:$DPORT --name $DEPLOYMENT $IMAGE_NAME</span></pre><p id="d3dd" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">再进一步，打开浏览器自动到<a class="ae kk" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000 </a>(或者你设置的端口)。docker启动后如果没有自动刷新浏览器。</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="aa70" class="jw jx hi jn b fi jy jz l ka kb">export DPORT=5000 &amp;&amp; open <a class="ae kk" href="http://localhost:$DPORT" rel="noopener ugc nofollow" target="_blank">http://localhost:$DPORT</a> &amp;&amp; docker run --rm -p $DPORT:$DPORT --name $(basename -s .git `git config --get remote.origin.url`) $IMAGE_NAME</span></pre><p id="c9db" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">将新的Docker映像推送到Google Cloud container注册表</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="97e8" class="jw jx hi jn b fi jy jz l ka kb">gcloud docker -- push $IMAGE_NAME</span></pre><p id="dbfb" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">用容器的新版本更新正在运行的部署</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="c1ff" class="jw jx hi jn b fi jy jz l ka kb">kubectl set image deployment/$DEPLOYEMENT $DEPLOYMENT=$IMAGE_NAME</span></pre><p id="36f0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">查看节点的当前分配资源的清理摘要</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="767a" class="jw jx hi jn b fi jy jz l ka kb">kubectl describe nodes | grep -A 4 "Allocated resources"</span></pre><figure class="jo jp jq jr fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kl"><img src="../Images/270c2b78e46be13fceff23b069d23041.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*72NAE9HQF07nIvKMf9SL4A.png"/></div></div></figure></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><p id="717c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">观察某个舱的日志。如果pod中有多个容器，您需要在末尾添加容器名称。</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="8e59" class="jw jx hi jn b fi jy jz l ka kb">kubectl logs -f pod-name-here</span></pre></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><p id="c006" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">使用<strong class="il hj"> </strong> <a class="ae kk" href="https://getcaptain.co/" rel="noopener ugc nofollow" target="_blank"> <strong class="il hj">船长</strong> </a>轻松启动/停止码头集装箱。在MacOS上的任务栏中提供最近容器的菜单。(我不是附属机构或赞助商)</p><figure class="jo jp jq jr fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kt"><img src="../Images/015c14d456155dfc3d5f9b3f7ead2d59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H3HRk3IywL2ROarULKer2w.png"/></div></div></figure></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><p id="dcbb" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">从当前路径中递归删除所有的<code class="du jk jl jm jn b">node_modules</code>目录。当你需要备份你的项目，或者移动到一台新的笔记本电脑上时，这是一个很好的选择。通过usb备份成千上万的小文件需要很长时间。这不会搜索您的整个计算机，只在当前路径下，所以从单个项目根运行它，只删除那个项目的node_modules，或者更高，做您的所有项目。</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="8e1a" class="jw jx hi jn b fi jy jz l ka kb">find . -name “node_modules” -type d -prune -exec rm -rf ‘{}’ +</span></pre><p id="d7fa" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">把MacOS上那些烦人的<code class="du jk jl jm jn b">.DS_Store</code>文件都删了。这将搜索您的整个硬盘驱动器，而不仅仅是当前路径。这不会阻止它们随着时间的推移被重新创造出来。</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="7883" class="jw jx hi jn b fi jy jz l ka kb">sudo find / -name ".DS_Store" -depth -exec rm {} \;</span></pre><p id="6568" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">这只是一个随机纱线(npm)提示，用于以图形方式检查应用程序package.json中的包更新。添加<code class="du jk jl jm jn b">--latest</code>标志以强制检查最新的主要版本。</p><blockquote class="if ig ih"><p id="0696" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated"><strong class="il hj">侧提示(或bug <em class="hi">？</em> ) </strong> — <em class="hi">当您运行此命令时，它不会列出beta/@next版本，但如果您当前安装了某个软件包的beta版本，并且该beta版本有更新，它会在列表中弹出，但会提供升级到最新的主(非beta)版本。如果你看到这个，不要从那里更新，但你会知道一个新的测试版出来了。查看下面关于</em> <code class="du jk jl jm jn b"><em class="hi">npm dist-tags</em></code> <em class="hi">的提示，看看如何查看最新的测试版。</em></p></blockquote><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="2654" class="jw jx hi jn b fi jy jz l ka kb">yarn upgrade-interactive --latest</span></pre><p id="a438" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">当检查所有的库发布标签时，包括beta等，这个是有用的(npm/Node.js)。因为<code class="du jk jl jm jn b">yarn upgrade-interactive</code>命令不会显示测试版标签。将<code class="du jk jl jm jn b">&lt;package name&gt;</code>换成实际名称，示例如下:</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="91fb" class="jw jx hi jn b fi jy jz l ka kb">npm dist-tags ls &lt;package name&gt; </span></pre><p id="fc95" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">检查<code class="du jk jl jm jn b">typescript</code>的发布标签</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="6b87" class="jw jx hi jn b fi jy jz l ka kb">npm dist-tags ls typescript</span><span id="bc67" class="jw jx hi jn b fi kc jz l ka kb"># output:</span><span id="4afc" class="jw jx hi jn b fi kc jz l ka kb">beta: 2.0.0<br/>insiders: 2.9.1-insiders.20180525<br/>latest: 2.9.1<br/>next: 3.0.0-dev.20180608<br/>rc: 2.9.0-rc</span></pre><p id="046a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">您也可以使用下面的<code class="du jk jl jm jn b">yarn info</code>命令，但是与<code class="du jk jl jm jn b">npm dist-tags ls</code>相比，输出略显荒谬</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="367e" class="jw jx hi jn b fi jy jz l ka kb"># for version specific info:<br/>yarn info typescript versions</span><span id="6db4" class="jw jx hi jn b fi kc jz l ka kb"># or all package info:<br/>yarn info typescript</span></pre></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><p id="80bd" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">在Kubernetes/GCP上轻松部署</strong>新版本的应用<strong class="il hj">。</strong>这篇文章太长，参见<a class="ae kk" rel="noopener" href="/google-cloud/easily-deploy-new-versions-of-code-to-kubernetes-on-gcp-with-a-single-command-ff920a367cf1">这篇文章</a>。</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><blockquote class="if ig ih"><p id="56b2" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">请在评论中发表任何补充意见！</p></blockquote></div></div>    
</body>
</html>