<html>
<head>
<title>Set up Google Cloud GPU for fast.ai for v1 and v2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为v1和v2的fast.ai设置Google Cloud GPU</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/set-up-google-cloud-gpu-for-fast-ai-45a77fa0cb48?source=collection_archive---------0-----------------------#2017-11-30">https://medium.com/google-cloud/set-up-google-cloud-gpu-for-fast-ai-45a77fa0cb48?source=collection_archive---------0-----------------------#2017-11-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/ca909d286e7bb07a2a61cbbc5d8003d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/1*FWtcNp8YJYpBvtV0RgklMA.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">GCP</figcaption></figure><p id="e6e2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇博文是为了给这个伟大的课程<a class="ae jo" href="http://www.fast.ai/" rel="noopener ugc nofollow" target="_blank"> fast.ai </a>设置Google Cloud GPU实例，但是一些实践仍然适用于一般目的。我纠结了几天才让它起作用，所以想写个帖子总结一下这几个步骤。</p><p id="aa59" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个帖子和<a class="jp jq ge" href="https://medium.com/u/27098dfa58c0?source=post_page-----45a77fa0cb48--------------------------------" rel="noopener" target="_blank"> Amulya Aankul </a>的博客文章<a class="ae jo" href="https://towardsdatascience.com/running-jupyter-notebook-in-google-cloud-platform-in-15-min-61e16da34d52" rel="noopener" target="_blank">在谷歌云平台上用15分钟</a>运行Jupyter笔记本，给了<a class="ae jo" href="http://forums.fast.ai/t/how-to-set-up-env-using-google-cloud/2585/29?u=nok" rel="noopener ugc nofollow" target="_blank"> Sabastian </a>很多荣誉。我只是把他们两个结合起来，建立了这个伟大的课程。</p><p id="4d1b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完成所有设置不超过30分钟，您就可以享受课程了。:)</p><p id="b84a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意:这篇文章最初是针对v1的，但是针对v2的设置要简单得多，只需在连接实例之后运行bash脚本即可。</p></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><h1 id="1149" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated"><strong class="ak">创建谷歌云GPU实例</strong></h1><ol class=""><li id="81eb" class="kw kx hi is b it ky ix kz jb la jf lb jj lc jn ld le lf lg bi translated"><strong class="is hj">增加额度</strong></li></ol><p id="b8b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了有GPU可用，需要申请增加GPU配额，默认为0。我花了5分钟完成这个过程并获得批准，比AWS快多了。</p><p id="762a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">转到配额→您需要升级您的帐户以便拥有可用的GPU增加您想要的区域的配额，请在此处<a class="ae jo" href="https://cloud.google.com/compute/docs/gpus/" rel="noopener ugc nofollow" target="_blank">选择您想要使用的区域</a>。</p><p id="2371" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">(尽量不要过于咄咄逼人地要求大量的GPU配额，因为从其他经验来看，他们可能会要求你提前支付。我觉得从1 K80开始就足够好了)</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lh"><img src="../Images/8b5839f4aae5550c51904f55cc14e145.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vq3yWWpbAjk5NJivq3vFVw.png"/></div></div></figure><p id="8299" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 2。创建一个谷歌云平台(GCP)实例</strong></p><p id="df5d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在GCP控制台的<a class="ae jo" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">主页中，有一些您想要复制到文本文件中的信息。复制您的项目ID，因为您稍后在SSH到您的实例时会用到它。(对我来说，项目ID是无尽-火-xxxxxxx)</a></p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lq"><img src="../Images/576befad245b00012da9b55469d6c587.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yhKBCXKosCmI1__RORc27Q.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">GCP主页</figcaption></figure><p id="58fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在可以开始创建实例。单击出现在左侧的“计算引擎”。</p><ol class=""><li id="1514" class="kw kx hi is b it iu ix iy jb lr jf ls jj lt jn ld le lf lg bi translated">单击创建实例</li></ol><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lu"><img src="../Images/ed4cb2a015a435f4b6a00b115d271afc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hPpN2Mrs9sIS-Fjxz8CNEA.png"/></div></div></figure><ol class=""><li id="4d94" class="kw kx hi is b it iu ix iy jb lr jf ls jj lt jn ld le lf lg bi translated">命名您的实例，选择您想要的区域(确保它有可用的GPU)</li><li id="b871" class="kw kx hi is b it lv ix lw jb lx jf ly jj lz jn ld le lf lg bi translated">选择特斯拉K80作为GPU</li></ol><p id="a49d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">找到GPU在哪里并不容易，但它们实际上是隐藏的，点击“定制”，你就可以将GPU添加到你的实例中。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/17a8f5be42cdb4bd0f92a80b6ff4398d.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*3JhuhUpQy4O5-0RW_lAQnQ.png"/></div></figure><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es mb"><img src="../Images/153f90832a4f445cbc91d49bcd8a3508.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*IBPTl2CcbU0ZIcVMq2tDNg.png"/></div></figure><p id="c6dc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.把启动盘换成Ubuntu 16.04</p><p id="ecde" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">确保你有正确的图像Ubuntu 16.04，并使其成为一个固态硬盘，默认是硬盘。价格其实变化不大，选个SSD就好！(建议获取至少25GB，注意后期只能增加SSD不能减少SSD)</p><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/d4f9d5b52ee7ceb9c063181542719f3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*hB6IknE92T2VQiD5e5V_2g.png"/></div></figure><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es md"><img src="../Images/c91e274e8d694bbb1caa0e2dbd5e443d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*cVwkgESeZsIyTPDyECz-4A.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">选Ubuntu 16.04，想做SSD就做吧(推荐)</figcaption></figure><p id="fac6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.差不多完成了</p><p id="7b43" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您只需要勾选HTTP流量，因为稍后我们将在浏览器中使用Jupyter Notebook访问该实例。您可能还想取消勾选“删除实例时删除引导磁盘”来保持您的存储活着，即使你杀了你的实例。现在你完成了，点击创建一个实例！</p><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es me"><img src="../Images/7ff12c5ee77c7ae229c5ff572499f8c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*FzZUKUj48YMIa7eEN9q0Bg.png"/></div></figure><p id="2d14" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">设置GCP就是这么简单，如果你想要一个静态IP，请到<a class="ae jo" href="https://towardsdatascience.com/running-jupyter-notebook-in-google-cloud-platform-in-15-min-61e16da34d52" rel="noopener" target="_blank">伟大的博客文章</a>看看你还能做什么。</p><h1 id="c965" class="jy jz hi bd ka kb mf kd ke kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv bi translated">与您的实例连接</h1><p id="c49f" class="pw-post-body-paragraph iq ir hi is b it ky iv iw ix kz iz ja jb mk jd je jf ml jh ji jj mm jl jm jn hb bi translated">现在我们需要在本地机器上连接我们的远程实例。因为我是一个Window用户，并且我一直在遵循Jeremy的教程，所以我使用Cygwin来运行我的bash脚本。如果你还没有这样做，请查看<a class="ae jo" href="http://course.fast.ai/lessons/aws.html" rel="noopener ugc nofollow" target="_blank">教程</a>或者直接安装<a class="ae jo" href="https://www.cygwin.com/" rel="noopener ugc nofollow" target="_blank"> Cygwin </a>(确保你已经安装了64位版本和“wget”！).</p><p id="0fd7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第一步</strong> <a class="ae jo" href="https://cloud.google.com/sdk/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">安装Google Cloud SDK </strong> </a></p><p id="2b4d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它类似于“aws”包，它是一个与谷歌云交互的命令行界面，我们将需要它来SSH我们的实例。</p><p id="b981" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我不会花时间来解释如何安装它。请遵循此处的说明<a class="ae jo" href="https://cloud.google.com/sdk/downloads" rel="noopener ugc nofollow" target="_blank">，文档非常简单。</a></p><p id="42b8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第二步</strong> <br/> SSH进入实例。打开Cygwin或者你可能只是打开谷歌云SDK外壳。INSTANCE_NAME是我之前让你复制下来的，它在你的主页上。</p><pre class="li lj lk ll fd mn mo mp mq aw mr bi"><span id="59b4" class="ms jz hi mo b fi mt mu l mv mw">gcloud compute ssh INSTANCE_NAME (In my case, it is instance-1)</span></pre><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es mx"><img src="../Images/480811c4e6e664c17e379f5b6034fe94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*-wabG1n0SCRVD6H60f6hfQ.png"/></div></figure><p id="e734" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤2.5 </strong></p><p id="8ff5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你做的是v2。请完成这一步并转到第6步，您可以忽略其余部分。</p><p id="3d07" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最初，您只需运行此脚本，即可完成Paperspace，但如果您使用的是GCP虚拟机，则需要对脚本稍作修改，我已经在Github中修改了脚本，因此您可以模仿相同的步骤:</p><pre class="li lj lk ll fd mn mo mp mq aw mr bi"><span id="a3db" class="ms jz hi mo b fi mt mu l mv mw"><strong class="mo hj">git clone </strong><a class="ae jo" href="https://github.com/noklam/learning_fastai.git" rel="noopener ugc nofollow" target="_blank"><strong class="mo hj">https://github.com/noklam/learning_fastai.git</strong></a><strong class="mo hj"><br/>bash learning_fastai/paperspace</strong></span></pre><p id="ed03" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第三步</strong></p><p id="2f98" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些步骤是复制自<a class="ae jo" href="http://forums.fast.ai/t/how-to-set-up-env-using-google-cloud/2585/29?u=nok" rel="noopener ugc nofollow" target="_blank">论坛的帖子</a>，再次感谢Sabastian。<br/>下载安装CUDA、Anaconda等的脚本:<br/> <code class="du my mz na mo b">wget <a class="ae jo" href="https://raw.githubusercontent.com/fastai/courses/master/setup/install-gpu.sh" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/fastai/courses/master/setup/install-gpu.sh</a></code></p><p id="d2db" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第四步</strong> <br/>运行脚本:<br/> <code class="du my mz na mo b">sudo sh install-gpu.sh</code> <br/> <strong class="is hj">最后你需要为jupyter笔记本选择一个密码</strong>。该脚本还克隆了<code class="du my mz na mo b"><a class="ae jo" href="https://github.com/fastai/courses/." rel="noopener ugc nofollow" target="_blank">https://github.com/fastai/courses/</a></code> <a class="ae jo" href="https://github.com/fastai/courses/." rel="noopener ugc nofollow" target="_blank">中的课程材料。</a></p><p id="96e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤5 </strong> <br/>使用重启命令或控制台上的重置选项重启:<br/> <code class="du my mz na mo b">sudo reboot</code></p><p id="21b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤6 </strong> <br/>使用控制台或命令行创建一个防火墙规则，用于从您的本地机器访问端口8888(您将使用端口8888来访问您的笔记本电脑):</p><p id="5dea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">PROJECT是显示在您的控制台主页上的项目ID，我之前要求您复制下来。</p><p id="6a4c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你的_IP是你本地机器的IP，你可以做cmd.exe→ipconfig来检查你的本地IP是什么，如果你不知道的话。</p><p id="1698" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">(似乎他们删除了beta命令，我还没有测试它。万一失败了，去控制台，VPC网络→防火墙规则，添加一个允许tcp:8888的规则，在上面添加自己的ip)</p><pre class="li lj lk ll fd mn mo mp mq aw mr bi"><span id="7810" class="ms jz hi mo b fi mt mu l mv mw">export PROJECT="project_name"<br/>export YOUR_IP="enter_the_ip_of_your_local_machine"<br/>gcloud compute --project "${PROJECT}" firewall-rules create "jupyter" --allow tcp:8888 --direction "INGRESS" --priority "1000" --network "default" --source-ranges "${YOUR_IP}" --target-tags "jupyter"</span><span id="05c4" class="ms jz hi mo b fi nb mu l mv mw">(Thanks for Rahul for adding this commands)</span><span id="2542" class="ms jz hi mo b fi nb mu l mv mw"><a class="ae jo" rel="noopener" href="/@rahulpopuri/hi-nok-ac2615dbdc55?source=post_info_responses---------12----------------">gcloud compute instances add-tags &lt;instance_name&gt; — tags jupyter</a></span></pre><p id="fddc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第7步</strong> <br/>检查CUDA安装是否正确:</p><pre class="li lj lk ll fd mn mo mp mq aw mr bi"><span id="db90" class="ms jz hi mo b fi mt mu l mv mw">sudo modprobe nvidia<br/>nvidia-smi</span></pre><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es nc"><img src="../Images/147fb6440c6c02a875a6d94265565a19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VuZnJzTAtxmAkrEdroBaiA.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">英伟达-smi</figcaption></figure><p id="4231" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第八步</strong> <br/>运行jupyter笔记本:<br/> <code class="du my mz na mo b">jupyter notebook --ip=0.0.0.0 --port=8888</code> <br/>注意终端中显示的令牌。使用实例的外部IP转到笔记本。您可以在控制台中找到实例的外部IP。</p><p id="22ed" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">xxx.xxx.xxx.xxx:8888是你笔记本的链接。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es nd"><img src="../Images/38e9c02ee21075b6417f6f7aa2c65cf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rBtJmL_JJxsgaDVCqtE5SA.png"/></div></div></figure><p id="b7fe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您需要一个令牌来登录您的笔记本。</p><p id="f52f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你的令牌在这里:</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ne"><img src="../Images/a60d39a6553d0f479886571dcd5bdca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*imJXMpAHJrS_zMHbsHL00w.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">代币</figcaption></figure><p id="c883" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们都完成了设置，您可以使用GPU驱动的机器访问笔记本电脑。GCP最大的好处是你有300美元的免费积分，这足够你浏览笔记本了(如果没有，只需再申请一个gmail，就能多获得300美元！)</p><p id="ab12" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你有任何问题，请告诉我！</p></div></div>    
</body>
</html>