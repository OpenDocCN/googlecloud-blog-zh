<html>
<head>
<title>Cloud IoT step-by-step: Quality of life tip - The command line</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云物联网循序渐进:生活质量提示-命令行</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/cloud-iot-step-by-step-quality-of-life-tip-the-command-line-ce23046867d4?source=collection_archive---------0-----------------------#2019-02-01">https://medium.com/google-cloud/cloud-iot-step-by-step-quality-of-life-tip-the-command-line-ce23046867d4?source=collection_archive---------0-----------------------#2019-02-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/56391ffab97bfef736fc9d05e53e860b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nxYhguUdEZZqi6XXgGjx0Q.png"/></div></div></figure><p id="44a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">嗨，朋友们！</p><p id="f6bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我想讨论一个关于使用谷歌云平台的生活质量的话题。我在我的<a class="ae jo" rel="noopener" href="/@GabeWeiss/cloud-iot-step-by-step-connecting-raspberry-pi-python-2f27a2893ab5">之前的</a> <a class="ae jo" rel="noopener" href="/@GabeWeiss/cloud-iot-step-by-step-cloud-to-device-communication-655a92d548ca">帖子</a>中提到过，在命令行上使用<a class="ae jo" href="https://cloud.google.com/sdk/install" rel="noopener ugc nofollow" target="_blank">谷歌云SDK </a>作为一种快速检查你的消息是否正确地从你的设备向Pub/Sub发送遥测数据的方式。对于其中的一些工作(实际上是大部分)，使用命令行比使用UI/控制台更快。</p><p id="c178" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于这个快速演示，我只想带您在命令行上完成我们在前两个教程中完成的任务:连接设备并发送遥测数据，将消息发送回您的设备，以及部署云功能。</p><p id="9ce4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你对UI完全满意，那也没问题，这就是为什么我们两个都有。但是使用命令行通常会更快，并且您在命令行上所做的所有工作都可以编写脚本，所以如果您是一个喜欢自动化的人，了解这些东西是很有好处的。希望通过学习我之前的教程，您会对我们将要使用命令行做的事情有一个熟悉的了解。</p><h1 id="f667" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">目录:</h1><ul class=""><li id="1a7d" class="kn ko hi is b it kp ix kq jb kr jf ks jj kt jn ku kv kw kx bi translated"><a class="ae jo" href="#016c" rel="noopener ugc nofollow">安装和配置GCloud SDK </a></li><li id="8646" class="kn ko hi is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx bi translated"><a class="ae jo" href="#cd26" rel="noopener ugc nofollow">在GCP创建发布/订阅和物联网核心对象</a></li><li id="e432" class="kn ko hi is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx bi translated"><a class="ae jo" href="#8958" rel="noopener ugc nofollow">向您的设备发送消息并部署云功能</a></li></ul><h2 id="016c" class="ld jq hi bd jr le lf lg jv lh li lj jz jb lk ll kd jf lm ln kh jj lo lp kl lq bi translated">安装和配置GCloud SDK</h2><p id="f1fe" class="pw-post-body-paragraph iq ir hi is b it kp iv iw ix kq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">第一步，安装gcloud SDK。它需要Python，所以如果你还没有Python，先安装它。它还需要一个谷歌云项目，所以如果你还没有，就<a class="ae jo" rel="noopener" href="/h2/2f27a2893ab5#7f07">建立一个</a>。除了创建项目之外，不需要做任何事情。然后按照此处的说明<a class="ae jo" href="https://cloud.google.com/sdk/install" rel="noopener ugc nofollow" target="_blank">进行安装。最后一步是让你运行<code class="du lu lv lw lx b">gcloud init</code>，让你来处理。很快，它会问你:</a></p><ol class=""><li id="c8d7" class="kn ko hi is b it iu ix iy jb ly jf lz jj ma jn mb kv kw kx bi translated"><code class="du lu lv lw lx b">Pick a configuration to use</code>。如果您以前从未这样做过，这可能不会出现，它可能会让您创建一个新的配置。</li><li id="9e13" class="kn ko hi is b it ky ix kz jb la jf lb jj lc jn mb kv kw kx bi translated"><code class="du lu lv lw lx b">Choose account to perform operations</code>。选择与您创建的Google云平台帐户/项目相关的电子邮件。如果您最近没有登录，此步骤可能会弹出一个浏览器窗口，要求您登录该帐户。否则，您应该会看到一条显示<code class="du lu lv lw lx b">You are logged in as: [email]</code>的消息。</li><li id="b90a" class="kn ko hi is b it ky ix kz jb la jf lb jj lc jn mb kv kw kx bi translated">下一条信息取决于你使用GCP的程度。可能是<code class="du lu lv lw lx b">This account has lots of projects! Listing them all can take a while</code>。其中的选项包括输入项目ID(可以从<a class="ae jo" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">控制台</a>获得)、创建新项目或全部列出。否则，您应该只看到您拥有的项目列表。选择您创建的一个。正如您所注意到的，您也可以从这里创建一个项目，但是我发现无论如何在控制台中打开项目还是很有用的。</li><li id="5fc3" class="kn ko hi is b it ky ix kz jb la jf lb jj lc jn mb kv kw kx bi translated"><code class="du lu lv lw lx b">Do you want to configure a default Compute Region and Zone?</code>我这样做是因为我通常不在我的项目中使用多区域，这样可以减少运行所需的标志。点击<code class="du lu lv lw lx b">Y</code>弹出所有区域。选一个离你最近的。一般哪个分区域都无所谓。因此，例如<code class="du lu lv lw lx b">us-central1-a</code>实际上与<code class="du lu lv lw lx b">us-central1-b</code>相同。对于产品来说，您可能希望在使用默认区域时更加小心一些，但是对于这一点来说，这是很好的。注意:并非所有地区都支持所有云产品，因此您可能会发现您选择的地区不适用于物联网产品。例如，物联网核心(当前)的唯一有效区域是<code class="du lu lv lw lx b">asia-east1</code>、<code class="du lu lv lw lx b">europe-west1</code>、<code class="du lu lv lw lx b">us-central1</code>。</li></ol><p id="aef6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在选择(或不选择)您的默认区域后，您应该会看到一串以<code class="du lu lv lw lx b">Some things to try next</code>结尾的输出和一些尝试。为了确认安装正确，运行<code class="du lu lv lw lx b">gcloud --version</code>，你会看到输出<code class="du lu lv lw lx b">Google Cloud SDK nnn.n.n</code>中包含了一些其他的东西。如果你看不到，说明某些东西没有正确安装，请确保你有权限在你的机器上安装这些东西。</p><p id="6d23" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们准备好出发了！在任何时候，如果您想探索一点，您总是可以通过<code class="du lu lv lw lx b">--help</code>标志来查看哪些组或命令是可用的。</p><h2 id="cd26" class="ld jq hi bd jr le lf lg jv lh li lj jz jb lk ll kd jf lm ln kh jj lo lp kl lq bi translated">在GCP创建发布/订阅和物联网核心对象</h2><p id="6d38" class="pw-post-body-paragraph iq ir hi is b it kp iv iw ix kq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">从我的第一个物联网教程开始，我们得到了一个从一无所有到与互联网对话的设备。查看设置和测试所需的命令行命令:</p><ol class=""><li id="310d" class="kn ko hi is b it iu ix iy jb ly jf lz jj ma jn mb kv kw kx bi translated">为我们的遥测数据创建一个发布/订阅主题。<br/> <code class="du lu lv lw lx b">gcloud pubsub topics create telemetry-topic</code></li><li id="5fe9" class="kn ko hi is b it ky ix kz jb la jf lb jj lc jn mb kv kw kx bi translated">创建一个发布/订阅订阅，这样我们就可以确认遥测技术已写入我们的主题。<br/> <code class="du lu lv lw lx b">gcloud pubsub subscriptions create telemetry-subscription —-topic=telemetry-topic</code></li><li id="4034" class="kn ko hi is b it ky ix kz jb la jf lb jj lc jn mb kv kw kx bi translated">创建一个物联网核心注册表来保存您的设备<br/> <code class="du lu lv lw lx b">gcloud iot registries create device-registry —-region=us-central1 —-event-notification-config=topic=telemetry-topic</code></li><li id="f85d" class="kn ko hi is b it ky ix kz jb la jf lb jj lc jn mb kv kw kx bi translated">创建自己的物联网设备(需要安装<a class="ae jo" href="https://www.openssl.org/source/" rel="noopener ugc nofollow" target="_blank">openSSL</a>)<br/><code class="du lu lv lw lx b">openssl req -x509 -newkey rsa:2048 -keyout demo_private.pem -nodes -out demo.pub -subj “/CN=unused”<br/><br/>gcloud iot devices create device-first --region=us-central1 --registry=device-registry --public-key=path=./demo.pub,type=rsa-x509-pem</code></li><li id="9529" class="kn ko hi is b it ky ix kz jb la jf lb jj lc jn mb kv kw kx bi translated">将测试消息发布到发布/订阅主题<br/> <code class="du lu lv lw lx b">gcloud pubsub topics publish telemetry-topic --message=red</code></li><li id="1727" class="kn ko hi is b it ky ix kz jb la jf lb jj lc jn mb kv kw kx bi translated">阅读发布到发布/订阅订阅的消息<br/> <code class="du lu lv lw lx b">gcloud pubsub subscriptions pull --auto-ack telemetry-subscription</code></li></ol><p id="05c3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一切都准备好了！前四个部分取代了我的第一个教程<a class="ae jo" rel="noopener" href="/@GabeWeiss/cloud-iot-step-by-step-connecting-raspberry-pi-python-2f27a2893ab5">中的所有云项目设置部分。我添加了最后两个用于发布/订阅交互，因为它们对于测试任何下游的东西非常有用，而不需要打开和关闭设备。</a></p><p id="e5a3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">别忘了，你仍然需要从谷歌放入<code class="du lu lv lw lx b">demo_private.pem</code>和获取<code class="du lu lv lw lx b">roots.pem</code>，并把这两个放在设备上，让设备上的任何东西真正工作。</p><h2 id="8958" class="ld jq hi bd jr le lf lg jv lh li lj jz jb lk ll kd jf lm ln kh jj lo lp kl lq bi translated">向您的设备发送消息并部署云功能</h2><p id="2c52" class="pw-post-body-paragraph iq ir hi is b it kp iv iw ix kq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">在第二篇教程中，我们从控制台做了一些事情，这些事情我们可以像从命令行一样(或者更容易)做。</p><ol class=""><li id="a6bd" class="kn ko hi is b it iu ix iy jb ly jf lz jj ma jn mb kv kw kx bi translated">向特定设备发送配置消息<br/> <code class="du lu lv lw lx b">gcloud iot devices configs update --config-data=”red” --device=device-first --region=us-central1 --registry=device-registry</code></li><li id="0d8b" class="kn ko hi is b it ky ix kz jb la jf lb jj lc jn mb kv kw kx bi translated">向特定设备发送命令<br/> <code class="du lu lv lw lx b">gcloud iot devices commands send — command-data=”red” --device=device-first --region=us-central1 --registry=device-registry</code> <br/> <strong class="is hj">注意这个</strong>，如果设备离线，或者如果在线但没有订阅命令MQTT主题(<code class="du lu lv lw lx b">/devices/device-first/commands/#</code>)那么你会得到一个错误消息(不会伤害任何东西，只是让你知道它没有到达设备)。您不会收到配置消息错误，因为配置会被存储，并在设备连接到物联网核心时发送到设备。</li><li id="b584" class="kn ko hi is b it ky ix kz jb la jf lb jj lc jn mb kv kw kx bi translated">部署一个<a class="ae jo" href="https://cloud.google.com/functions/getting-started/" rel="noopener ugc nofollow" target="_blank">谷歌云功能</a>。在你已经创建了package.json和index.js的目录中:<br/> <code class="du lu lv lw lx b">gcloud functions deploy test-function --region=us-central1 --entry-point=updateDevice --trigger-http</code> <br/>现在这里有很多东西要解包。另一篇博文的主题。这只是在控制台中执行我们在教程中所做的事情，但是从命令行执行。</li><li id="76a8" class="kn ko hi is b it ky ix kz jb la jf lb jj lc jn mb kv kw kx bi translated">调用一个云函数<br/>从技术上来说我们没有这样做，因为我们使用了一个HTTP函数，你可以打开它的目标URL。但是如果你想的话，你可以… <br/> <code class="du lu lv lw lx b">gcloud functions call test-function --region=us-central1</code> <br/>注意，根据你的函数所做的事情，它可能会崩溃或者做一些意想不到的事情，因为它期望的是输入。从命令行调用函数假设您在请求体中发送数据。例如，我们在第二篇博客中写的代码使用GET变量，这是不能从命令行完成的。</li></ol><h2 id="bef1" class="ld jq hi bd jr le lf lg jv lh li lj jz jb lk ll kd jf lm ln kh jj lo lp kl lq bi translated">包扎</h2><p id="1c10" class="pw-post-body-paragraph iq ir hi is b it kp iv iw ix kq iz ja jb lr jd je jf ls jh ji jj lt jl jm jn hb bi translated">所以我们有它！熟悉命令行尤其会加快开发速度。能够弹出一个新设备来测试一些干净的东西，或者推出一个新版本的云功能(特别是让你的本地磁盘版本与你在控制台UI中的任何东西保持同步)是非常有价值的。</p><p id="c86b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">显然，正如我之前提到的，还有很多，我只是列出了我们在之前的教程中使用命令行所做的事情。在未来的教程中，我将尝试在有简单的命令行时调用我正在谈论的任何部署或调用。</p><figure class="md me mf mg fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/75dd9b707837c97a094746b07fa1e3e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/format:webp/1*BQSQ0BQbC_B9SoGZiBtInA.png"/></div></figure><p id="e4b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后一点，如果你开始习惯命令行，但是讨厌一遍又一遍的初始化，你也可以使用云Shell。在控制台的右上角，寻找云壳图标(它是左边的图标)。它在控制台中打开一个shell，这个shell是针对您的项目环境预先配置的。非常方便。关于这一点也有一整篇文章的内容，幸运的是，你可以在这里找到我的队友写的。</p><p id="e9cd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我知道你对这些教程的看法，以及你接下来想看到什么，或者在下面的评论中，或者在<a class="ae jo" href="https://twitter.com/GabeWeiss_" rel="noopener ugc nofollow" target="_blank">推特</a>上关注我。我的DMs打开了！</p></div></div>    
</body>
</html>