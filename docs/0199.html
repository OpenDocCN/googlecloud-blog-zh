<html>
<head>
<title>How to reduce latency of your Google Cloud Endpoints APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何减少Google Cloud端点API的延迟</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-reduce-latency-of-your-google-cloud-endpoints-apis-5bbe66385e32?source=collection_archive---------0-----------------------#2017-01-30">https://medium.com/google-cloud/how-to-reduce-latency-of-your-google-cloud-endpoints-apis-5bbe66385e32?source=collection_archive---------0-----------------------#2017-01-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/29da85c0496ba5d13484efe73115945a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k-3krRW7G5OtBXmmfS5uWA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">信用:<a class="ae iu" href="https://unsplash.com/@tomeversley" rel="noopener ugc nofollow" target="_blank">汤姆·埃弗斯利</a></figcaption></figure><p id="5973" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我使用<a class="ae iu" href="https://cloud.google.com/endpoints/" rel="noopener ugc nofollow" target="_blank">谷歌云端点</a>为Android &amp; IOS等端点构建强大的API已经有两年了。</p><p id="8970" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你从来没有听说过谷歌云终端，你可能听说过<a class="ae iu" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a> (GCP)，这基本上相当于亚马逊网络服务，由谷歌制造。</p><p id="9dcc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，Google Cloud Endpoints(GCP提供的服务之一)帮助你轻松地创建自己的API，允许你的终端(Android、IOS、Javascript等)访问你的后端。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div class="er es jt"><img src="../Images/66fe828fc64b01c1f691f76b5dc6ead6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*NN-AYT5wZp2MTD_v_9TfnQ.png"/></div></figure><p id="169a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，<strong class="ix hj">有一些优化</strong>可以充分利用Google Cloud端点并提高您自己的API的性能。</p><h1 id="6dc0" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">1.保持实例的活力</h1><p id="d544" class="pw-post-body-paragraph iv iw hi ix b iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo la jq jr js hb bi translated">如你所知，谷歌云端点运行在谷歌应用引擎实例上。因此，当一个实例没有被使用时，它会在一段时间后自动关闭，并在必要时启动(传入的http请求等)。</p><p id="e763" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是appengine实例的启动时间可能会很长。我注意到有时候，它会超过7秒…</p><p id="5059" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要解决这个问题，一个简单的技巧是创建一个cron任务，让cron.xml: 中的<em class="lb">实例</em> <strong class="ix hj">保持活动</strong></p><pre class="ju jv jw jx fd lc ld le lf aw lg bi"><span id="a3ef" class="lh jz hi ld b fi li lj l lk ll">&lt;cron&gt;<br/>    &lt;url&gt;/Cron/KeepAliveInstance&lt;/url&gt;<br/>    &lt;description&gt;Keep alive instance&lt;/description&gt;<br/>    <strong class="ld hj">&lt;schedule&gt;every 1 minutes&lt;/schedule&gt;</strong><br/>&lt;/cron&gt;</span></pre><p id="34ee" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，如果有太多的请求需要处理，您可以在启动新实例时告诉Google <em class="lb">，使用<strong class="ix hj"> appengine-web.xml中的“min-pending-latency”参数。</strong>此<strong class="ix hj"> </strong>值取决于您的<em class="lb">平均延迟时间</em>，您可以在API上注意到:</em></p><pre class="ju jv jw jx fd lc ld le lf aw lg bi"><span id="2813" class="lh jz hi ld b fi li lj l lk ll">&lt;automatic-scaling&gt;<em class="lb"><br/>    </em><strong class="ld hj">&lt;min-pending-latency&gt;3000ms&lt;/min-pending-latency&gt;</strong><br/>&lt;/automatic-scaling&gt;</span></pre><h1 id="83af" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">2.小心使用Memcache</h1><p id="f912" class="pw-post-body-paragraph iv iw hi ix b iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo la jq jr js hb bi translated">我强烈推荐阅读这篇解释如何使用Memcache的文档。过去，我在Memcache中设置我的每个数据存储实体，告诉自己这样会更快…#失败</p><p id="af1a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">基本上，如果您提供从不(或很少)改变的数据，请对这些数据使用Memcache。否则，不要。</p><p id="57e6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，在我的应用程序CookMinute上，每个食谱都是每天下载并存储在用户的手机中的(感谢<a class="ae iu" href="https://realm.io/" rel="noopener ugc nofollow" target="_blank">领域</a>)。所以<em class="lb">我只设置了</em> <strong class="ix hj">实体</strong>作为<strong class="ix hj"> </strong> Memcache的一部分。</p><h1 id="4b2d" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">3.提高实例性能(不需要)</h1><p id="744e" class="pw-post-body-paragraph iv iw hi ix b iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo la jq jr js hb bi translated">如果您的API具有高处理能力，您可以增加appengine实例的实例类<a class="ae iu" href="https://cloud.google.com/appengine/docs/about-the-standard-environment#instance_classes" rel="noopener ugc nofollow" target="_blank">。然而，这也会增加成本。</a></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/dcb1172256b1113d36fa975b0a585636.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4wjLgJ7mbDxHXvki2nTbUQ.png"/></div></div></figure><pre class="ju jv jw jx fd lc ld le lf aw lg bi"><span id="0152" class="lh jz hi ld b fi li lj l lk ll">&lt;appengine-web-app&gt;<br/>    &lt;application&gt;${app.id}&lt;/application&gt;<br/>    <strong class="ld hj">&lt;instance-class&gt;F2&lt;/instance-class&gt;</strong><br/>&lt;/appengine-web-app&gt;</span></pre><h1 id="2f58" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">结果</h1><p id="aba4" class="pw-post-body-paragraph iv iw hi ix b iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo la jq jr js hb bi translated">我已经用为我的应用注册新用户的<em class="lb"> API测试了这些优化。使用stack driver Trace(Console =&gt;stack driver =&gt;Trace)生成统计信息，并且<strong class="ix hj">实例类是F1 </strong>。</em></p><h2 id="70a1" class="lh jz hi bd ka ln lo lp ke lq lr ls ki jg lt lu km jk lv lw kq jo lx ly ku lz bi translated">优化前</h2><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ma"><img src="../Images/791850be920b6dfb54c2e522f40a657c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LCzMmdqbCpTok-hPIQIIEw.png"/></div></div></figure><h2 id="2317" class="lh jz hi bd ka ln lo lp ke lq lr ls ki jg lt lu km jk lv lw kq jo lx ly ku lz bi translated">优化后</h2><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/a9238b18f7ed1af13f18fe05f93277f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TvE719y_8Ca7hhZJn1-b0w.png"/></div></div></figure><p id="f0a6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如您所看到的，延迟已经减少并且更加平滑，特别是因为<strong class="ix hj">总是有一个实例可以处理请求。</strong></p><p id="fd1d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">哦，关于费用，嗯，我还没有支付任何费用，因为我从来没有超过免费配额</p><p id="2802" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你有一些关于Google Cloud端点API的建议或提示，请在评论中告诉我！</p><p id="9ac6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">菲尔，方正@</strong><a class="ae iu" href="http://www.cookminute.com/?utm_source=Medium&amp;utm_medium=Article&amp;utm_campaign=Medium" rel="noopener ugc nofollow" target="_blank"><strong class="ix hj">cook minute</strong></a><strong class="ix hj">兼手机发烧友。</strong></p></div></div>    
</body>
</html>