<html>
<head>
<title>GCP — Cloud Workflows — Orchestrate in declarative way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GCP —云工作流—以声明方式进行编排</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/gcp-cloud-workflows-orchestrate-in-declarative-way-3cfacda25028?source=collection_archive---------2-----------------------#2022-11-03">https://medium.com/google-cloud/gcp-cloud-workflows-orchestrate-in-declarative-way-3cfacda25028?source=collection_archive---------2-----------------------#2022-11-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="49bd" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated"><strong class="il hj">云工作流</strong>宣布自2021年1月起正式发布，该产品正式发布已近一年。云工作流是GCP业务流程选项中新增的工具包之一。</p><p id="7173" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated"><strong class="il hj"> Cloud composer </strong>一直是GCP平台中满足任何管道编排需求的主要竞争者。<strong class="il hj">云作曲家V1 </strong>需要供应和管理整个PaaS平台。这也带来了全天候运行composer平台的额外成本。作曲家V2的出现使得很多管理方面变得简单了。</p></blockquote><p id="b3b8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">本博客重点关注云工作流的详细概述、与Cloud Composer的比较以及云工作流适合并提供更好替代方案的一些使用案例。</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h2 id="0a46" class="jr js hi bd jt ju jv jw jx jy jz ka kb jh kc kd ke ji kf kg kh jj ki kj kk kl bi translated"><strong class="ak">简介</strong></h2><p id="9f29" class="pw-post-body-paragraph ii ij hi il b im km io ip iq kn is it jh ko iw ix ji kp ja jb jj kq je jf jg hb bi translated">云工作流是<strong class="il hj">配置驱动(YAML/JSON)的无服务器编排工具。</strong></p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kr"><img src="../Images/d4ca97e64114868b4014b37f49a002ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O6_1dFq-K_LEDDHCEJ0zSQ.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">云工作流</figcaption></figure><p id="7cad" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">云工作流中的每个<strong class="il hj">工作流</strong>都可以被认为是<strong class="il hj">步骤的序列。<br/> </strong>在<strong class="il hj">步骤</strong>中的每个<strong class="il hj">步骤</strong>代表需要执行的<strong class="il hj">动作。</strong></p><p id="7a79" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">工作流中的<strong class="il hj">步骤</strong>可以执行<strong class="il hj">执行调用</strong>，<strong class="il hj">控制步骤</strong>(迭代，条件执行..)、<strong class="il hj">错误处理和调用其他子工作流</strong></p><p id="9678" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">云工作流通过<strong class="il hj"> HTTP执行调用</strong>提供<strong class="il hj">与<strong class="il hj"> GCP服务(连接器)、本地或其他云中的服务</strong>的集成</strong>。</p><p id="5d6a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">云工作流可以有可选的<strong class="il hj">云调度器触发器</strong>来按计划执行，或者<strong class="il hj">可以对事件弧触发器支持的事件</strong>做出反应</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h2 id="7866" class="jr js hi bd jt ju jv jw jx jy jz ka kb jh kc kd ke ji kf kg kh jj ki kj kk kl bi translated"><strong class="ak">开始—创建和执行</strong></h2><p id="b67e" class="pw-post-body-paragraph ii ij hi il b im km io ip iq kn is it jh ko iw ix ji kp ja jb jj kq je jf jg hb bi translated">工作流需要提供<strong class="il hj"> YAML/JSON配置</strong>，可以通过以下方式之一创建</p><p id="e83c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">云控制台—内嵌编辑器<br/> gcloud命令<br/> Terraform (IaaC —基础设施即代码)</p><p id="9eb7" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">例如，我们将使用云工作流<strong class="il hj">将json文件从GCS bucket加载到BigQuery表</strong>，并在加载完成后<strong class="il hj">刷新基表上的物化视图</strong>。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lh"><img src="../Images/1d643d5e3025cb1ee0264a22d2913f52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HA23nd_lSxmSoUgnC7fS2Q.png"/></div></div></figure><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es li"><img src="../Images/bdf27da0c506d04503a586b97347fa18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zZqmudpT1VH8VjHK29UjtQ.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">Workflow.yaml —第1部分</figcaption></figure><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lj"><img src="../Images/61296bbdf8a4f572f6d3cb648f638b34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O1Y3D8A3ptDONTIy5C3M6A.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">Workflow.yaml —第2部分</figcaption></figure><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lk"><img src="../Images/3b3385626cc5557fa41f763e72137b1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l_wiItvfiTuCbLceyadE9g.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">Workflow.yaml —第3部分</figcaption></figure><p id="22b8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">隐含地按照申报的顺序依次执行</strong>。</p><p id="3992" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">可以使用gcloud命令部署工作流，如下所示</p><pre class="ks kt ku kv fd ll lm ln lo aw lp bi"><span id="44fb" class="jr js hi lm b fi lq lr l ls lt">gcloud workflows deploy wf_bq_load_process --location us-central1 --source=workflow.yaml</span></pre><p id="2579" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">成功部署工作流后，它将在工作流控制台中可见。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lu"><img src="../Images/7c28c5ca86223a9a93d247f7d7f29bdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fdTZtefP13kiAhwxIc2ZnA.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">Google云控制台—工作流列表</figcaption></figure><p id="439f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">工作流显示配置的详细指标、日志、触发器和源</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lv"><img src="../Images/671ba5daf078159332ebb8009b13c816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dRSLzJOPX58MtTZ_d6CFtQ.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">工作流程的图形表示</figcaption></figure><p id="7a5b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">可以从控制台或使用gcloud命令执行工作流，如下所示</p><pre class="ks kt ku kv fd ll lm ln lo aw lp bi"><span id="edf9" class="jr js hi lm b fi lq lr l ls lt">gcloud workflows execute wf_bq_load_process --location us-central1</span></pre><p id="a3ab" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">可以在云控制台中检查执行情况，如下所示</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lw"><img src="../Images/9d890427404787ef5a46126bdfcbc6f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KtyAHJunaZ0HJLkOOgSdzQ.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">执行细节</figcaption></figure></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h2 id="6df8" class="jr js hi bd jt ju jv jw jx jy jz ka kb jh kc kd ke ji kf kg kh jj ki kj kk kl bi translated"><strong class="ak">操作类型</strong></h2><p id="c378" class="pw-post-body-paragraph ii ij hi il b im km io ip iq kn is it jh ko iw ix ji kp ja jb jj kq je jf jg hb bi translated"><strong class="il hj">呼叫步骤:</strong></p><p id="3dc9" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">云工作流的核心是<strong class="il hj">调用</strong>步骤。调用步骤可以用来调用API端点。<br/>呼叫步骤分为3类呼叫<br/> 1。<strong class="il hj"> API端点</strong>(外部—内部/其他云)或<a class="ae lx" href="https://cloud.google.com/workflows/docs/reference/googleapis" rel="noopener ugc nofollow" target="_blank"> <strong class="il hj">连接器</strong> </a>(用于与GCP服务交互)<br/> 2 .<strong class="il hj">调用子工作流</strong> <br/> 3。<strong class="il hj">调用系统定义函数</strong>，如<strong class="il hj"> sys.log </strong>记录活动</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es ly"><img src="../Images/64b87716f4f9b773ad9722adba6b1cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TZGBpSaT3l0dqffhEUz8Ig.png"/></div></div></figure><p id="fd4c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">控制流程</strong></p><p id="1cdd" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">云工作流可以被认为是以声明方式编写的<strong class="il hj">程序。</strong><strong class="il hj">控制流程步骤</strong>有助于不同的功能，如循环、决策、跳过步骤、依赖性或调用另一个子工作流/工作流</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lz"><img src="../Images/f7416a3f8ced07aff8690c3c8f99ac07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9O8h4fddXz7v45JS6EBASA.png"/></div></div></figure><p id="39fe" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">错误处理流程</strong></p><p id="3904" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">云工作流通过(<strong class="il hj">尝试</strong>、<strong class="il hj">除</strong>和<strong class="il hj">提升</strong>步骤)的方式处理执行中的错误</p><p id="deec" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">变量和参数(步间通信)</strong></p><p id="5dea" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">对于工作流或子工作流，可以通过使用变量(<a class="ae lx" href="https://cloud.google.com/workflows/docs/reference/syntax/variables#variable-names" rel="noopener ugc nofollow" target="_blank"> <strong class="il hj">赋值</strong> </a>步骤)或运行时参数(<a class="ae lx" href="https://cloud.google.com/workflows/docs/reference/syntax/runtime-args" rel="noopener ugc nofollow" target="_blank"> <strong class="il hj">参数</strong> </a>)来实现步骤之间的通信。</p><p id="ada0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">变量</strong>可用于存储API调用的响应，并相应地采取后续步骤。</p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h2 id="ab2c" class="jr js hi bd jt ju jv jw jx jy jz ka kb jh kc kd ke ji kf kg kh jj ki kj kk kl bi translated"><strong class="ak">与Cloud Composer的比较</strong></h2><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es ma"><img src="../Images/e190557077d8690e1462afbac98c1525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7LK-CoV3IpdUORMnPBxpgg.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">云工作流与云合成器</figcaption></figure><blockquote class="if ig ih"><p id="854c" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">Cloud composer附带了一套非常丰富的操作器和传感器，并与许多内部和外部GCP产品广泛集成。</p></blockquote></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h2 id="cf79" class="jr js hi bd jt ju jv jw jx jy jz ka kb jh kc kd ke ji kf kg kh jj ki kj kk kl bi translated"><strong class="ak">云工作流的使用案例</strong></h2><p id="82c3" class="pw-post-body-paragraph ii ij hi il b im km io ip iq kn is it jh ko iw ix ji kp ja jb jj kq je jf jg hb bi translated">云工作流的典型用例包括<br/> 1。<strong class="il hj">事件驱动的编排</strong> —通常在事件驱动的系统设计中，云工作流提供了一种非常轻量级的方式来连接服务和编排流程<br/> 2。<strong class="il hj">带人工干预的编排— </strong>云工作流提供了实现回调的特性，回调可以等待api端点的响应，通常用于具有人工批准步骤的操作。<br/> 3。<strong class="il hj">轻量级流程编排— </strong>适用于对数据管道有轻量级流程编排要求的组织，其中cloud composer计费可能是一个问题<br/> 4。<strong class="il hj">过程自动化<br/> 5。实时处理</strong></p></div><div class="ab cl jk jl gp jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="hb hc hd he hf"><h2 id="df43" class="jr js hi bd jt ju jv jw jx jy jz ka kb jh kc kd ke ji kf kg kh jj ki kj kk kl bi translated"><strong class="ak">参考文献</strong></h2><p id="d268" class="pw-post-body-paragraph ii ij hi il b im km io ip iq kn is it jh ko iw ix ji kp ja jb jj kq je jf jg hb bi translated"><strong class="il hj">工作流执行— Python客户端参考</strong><a class="ae lx" href="https://cloud.google.com/python/docs/reference/workflows/latest" rel="noopener ugc nofollow" target="_blank">https://Cloud . Google . com/Python/docs/Reference/Workflows/latest</a><br/><strong class="il hj">g Cloud CLI工作流参考—</strong><a class="ae lx" href="https://cloud.google.com/sdk/gcloud/reference/workflows" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/sdk/gcloud/reference/workflows</a><br/><strong class="il hj">ML实现与云工作流</strong>—<a class="ae lx" href="https://cloud.google.com/community/tutorials/ml-pipeline-with-workflows" rel="noopener ugc nofollow" target="_blank">https://Cloud . Google . com/community/tutorials/ML-pipeline-with-Workflows</a><br/><strong class="il hj">event arc与云工作流</strong> 【T32</p></div></div>    
</body>
</html>