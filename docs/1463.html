<html>
<head>
<title>BigQuery Dataset Metadata Queries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">BigQuery数据集元数据查询</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/bigquery-dataset-metadata-queries-8866fa947378?source=collection_archive---------0-----------------------#2020-06-08">https://medium.com/google-cloud/bigquery-dataset-metadata-queries-8866fa947378?source=collection_archive---------0-----------------------#2020-06-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/cd056a99a907be80e13377a1252e4106.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*MAwXGcIgP7zPiL859x7DtQ.png"/></div></figure><p id="18ca" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在BigQuery中使用表时，您需要了解数据集结构，无论它是公共的还是您设置的，并且您想要检查它。这是一个共享查询的快捷方式，您可以使用它来提取数据集和表中的元数据。</p><p id="bcd0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在下面的例子中，我使用big query public<a class="ae jk" href="http://console.cloud.google.com/marketplace/details/stack-exchange/stack-overflow" rel="noopener ugc nofollow" target="_blank">Stack Overflow</a>数据库来演示这些命令。根据需要为正在使用的数据集和表更改名称。</p><h1 id="a564" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">数据集元数据</h1><p id="07f6" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">获取数据集中所有表的列表以及相应的信息。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="3dff" class="kx jm hi kt b fi ky kz l la lb">SELECT *<br/>FROM bigquery-public-data.stackoverflow.INFORMATION_SCHEMA.TABLES</span></pre><p id="e421" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">运行时查询处理了10MB，列结果包括:</p><ul class=""><li id="7261" class="lc ld hi io b ip iq it iu ix le jb lf jf lg jj lh li lj lk bi translated">表_目录(目录的名称)</li><li id="6374" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">table_schema(数据集名称)</li><li id="5680" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">表名</li><li id="943f" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">表格类型</li><li id="b3ae" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">is _ insertable _ into</li><li id="07cb" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">是类型化的</li><li id="ae96" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">创建时间(日期时间格式)</li></ul><p id="449f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">其他表详细信息，包括行数和表数据大小。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="0a91" class="kx jm hi kt b fi ky kz l la lb">SELECT *<br/>FROM bigquery-public-data.stackoverflow.__TABLES__</span></pre><p id="fca4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="lq">注，其两条下划线在</em>两侧的<em class="lq">表上方。</em></p><p id="d90f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">运行时处理的查询0B和列结果包括:</p><ul class=""><li id="04c4" class="lc ld hi io b ip iq it iu ix le jb lf jf lg jj lh li lj lk bi translated">project_id(与模式中的table_catalog相同)</li><li id="4fc8" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">dataset_id(与模式中的table_schema相同)</li><li id="0f8a" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">table_id(与模式中的table_name相同)</li><li id="de9c" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">创建时间(时间戳格式)</li><li id="02e1" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">上次修改时间(时间戳格式)</li><li id="f5e4" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">行计数</li><li id="1cb7" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">大小_字节</li><li id="4059" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">类型</li></ul><p id="1e4d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在上面的查询中，我对查询进行了如下修改，使timestamp为datetime格式，size_bytes为GB。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="c343" class="kx jm hi kt b fi ky kz l la lb">SELECT project_id, dataset_id, table_id as table_name, CAST(TIMESTAMP_MILLIS(creation_time) AS DATETIME) as creation_time,  CAST(TIMESTAMP_MILLIS(last_modified_time) AS DATETIME) as last_modified_time, row_count, size_bytes / POW(10,9) as GB, type<br/>FROM bigquery-public-data.stackoverflow.__TABLES__</span></pre><p id="1292" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我还将<em class="lq"> table_id </em>改为<em class="lq"> table_name </em>，以便更容易与本文中的第一个查询合并。合并时，我可以省略<em class="lq">项目id </em>和<em class="lq">表格目录</em>，因为它们是多余的。</p><h1 id="5aeb" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">表元数据</h1><p id="1ed7" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">要获得数据集中特定表的详细信息，请从<em class="lq"> stackoverflow </em>数据集中使用<em class="lq"> posts_questions </em>表提取表名并包含在以下查询中，如下例所示。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="74b2" class="kx jm hi kt b fi ky kz l la lb">SELECT *<br/>FROM bigquery-public-data.stackoverflow.INFORMATION_SCHEMA.COLUMNS<br/>WHERE TABLE_NAME = '<a class="ae jk" href="http://twitter.com/tablename" rel="noopener ugc nofollow" target="_blank">p</a>osts_questions'</span></pre><p id="626a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">运行时查询处理了10MB，列结果包括:</p><ul class=""><li id="a369" class="lc ld hi io b ip iq it iu ix le jb lf jf lg jj lh li lj lk bi translated">表_目录(目录的名称)</li><li id="c4a0" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">table_schema(数据集名称)</li><li id="69f5" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">表名</li><li id="01aa" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">列名</li><li id="8937" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">序数_位置</li><li id="28dc" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">is_nullable(对/错)</li><li id="430e" class="lc ld hi io b ip ll it lm ix ln jb lo jf lp jj lh li lj lk bi translated">数据类型</li></ul><h1 id="8b9f" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">费用</h1><p id="866a" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">关于成本的另一个注意事项是，BQ免费提供每月处理的查询数据的前1TB。除此之外，这取决于你的定价模式。针对INFORMATION_SCHEMA的按需查询至少会产生10MB的数据处理费用，即使处理的字节数更少。对于统一费率定价，这些消耗BQ位。需要注意的是，这些查询不会被存储，所以每次运行查询时都会向您收费。基本上，运行元数据查询通常是名义上的。如果您想更深入地了解潜在的查询成本，请查看此<a class="ae jk" href="https://cloud.google.com/bigquery/pricing" rel="noopener ugc nofollow" target="_blank"> BQ定价资源</a>。</p><h1 id="7ba7" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">包裹</h1><p id="8ed8" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">上面回顾了从BigQuery中提取数据集和表元数据的几个关键查询。还有其他视图，如数据集作业、预留和例程，您可以在<a class="ae jk" href="https://cloud.google.com/bigquery/docs/information-schema-views" rel="noopener ugc nofollow" target="_blank">信息模式指南</a>中获得更多信息和详细信息。视图有助于您对正在使用的数据集和表的结构有一个全面的了解，以便您可以计划如何最好地参与。</p></div></div>    
</body>
</html>