<html>
<head>
<title>Google Pub/Sub Lite for Kafka Users</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向Kafka用户的Google发布/订阅建兴</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-pub-sub-lite-for-kafka-users-dec8a7cfc5e5?source=collection_archive---------0-----------------------#2021-01-25">https://medium.com/google-cloud/google-pub-sub-lite-for-kafka-users-dec8a7cfc5e5?source=collection_archive---------0-----------------------#2021-01-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/98863ad41b2589a1701ec427c678c9d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*dJQvTTFW-5QIvvyehmoy-Q.png"/></div></figure></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><p id="ef6e" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">本指南已被添加到我们的服务文档中- <a class="ae jr" href="https://cloud.google.com/pubsub/lite/docs/kafka-migration" rel="noopener ugc nofollow" target="_blank">请在那里阅读</a>以获得包含有线协议支持等新功能的最新版本。</p></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><p id="34d2" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Pub/Sub Lite是Cloud Pub/Sub团队的一项新服务，旨在提供一种替代的、以成本为中心的Pub/Sub系统。特别是，它为出于价格原因考虑运行自己的单区域Apache Kafka集群的用户提供了托管服务。这篇文章比较了Pub/Sub Lite、Pub/Sub和自我管理的Kafka配置，并演示了如何在Pub/Sub Lite上测试您当前的Kafka工作负载。</p><p id="d5fb" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Pub/Sub Lite与Kafka共享比Cloud Pub/Sub更多的高级概念，是一个通过前进偏移跟踪进度的分区日志。正因为如此，它拥有与Kafka更相似的API，用户可以使用<a class="ae jr" href="https://github.com/googleapis/java-pubsublite-kafka" rel="noopener ugc nofollow" target="_blank"> Kafka客户端API</a>发布和消费消息。</p></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><h1 id="01ed" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">Pub/Sub Lite与卡夫卡的显著区别</strong></h1><p id="4701" class="pw-post-body-paragraph it iu hi iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq hb bi translated">虽然Pub/Sub Lite在概念上类似于Apache Kafka，但它是一个不同的系统，其API更侧重于数据摄取。虽然这些差异对于流的接收和处理来说是无关紧要的，但是在许多特定的用例中它们是非常重要的。</p><p id="286e" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hj">作为数据库的卡夫卡</strong></p><p id="9676" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Pub/Sub Lite不支持事务发布或日志压缩，这些是Kafka的特性，当您将Kafka用作数据库而不是消息传递系统时，这些特性通常更有用。如果这描述了您的用例，您应该考虑运行自己的Kafka集群或使用托管Kafka解决方案，如<a class="ae jr" href="http://confluent.io/cloud" rel="noopener ugc nofollow" target="_blank"> Confluent Cloud </a>。如果这两个都不是一个选项，您还可以考虑使用像<a class="ae jr" href="https://cloud.google.com/spanner" rel="noopener ugc nofollow" target="_blank"> Cloud Spanner </a>这样的水平可伸缩数据库，并使用行键将表按提交时间戳排序以进行重复数据删除。</p><p id="a103" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hj">与Kafka流的兼容性</strong></p><p id="3f71" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Kafka streams是一个建立在Kafka之上的数据处理系统。虽然它允许注入消费者客户端，但是它需要访问所有管理操作，并使用Kafka的事务数据库属性来存储内部元数据。<a class="ae jr" href="https://beam.apache.org" rel="noopener ugc nofollow" target="_blank"> Apache Beam </a>是一个类似的流数据处理系统，集成了Kafka、Pub/Sub和Pub/Sub Lite，以及其他数据源和汇点。波束管道也可以通过<a class="ae jr" href="https://cloud.google.com/dataflow" rel="noopener ugc nofollow" target="_blank">数据流</a>以完全管理的方式运行。</p><p id="2ad4" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hj">监控</strong></p><p id="60b0" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Kafka客户端能够读取服务器端指标。在发布/订阅Lite中，与发布者和订阅者行为相关的指标通过<a class="ae jr" href="https://cloud.google.com/monitoring/api/metrics_gcp#gcp-pubsublite" rel="noopener ugc nofollow" target="_blank">云监控</a>公开，无需额外配置。</p></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><h1 id="15a1" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">管理和配置</strong></h1><p id="549c" class="pw-post-body-paragraph it iu hi iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq hb bi translated"><strong class="iv hj">产能管理</strong></p><p id="764c" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Kafka主题的容量通常由集群的容量决定。复制、键压缩和批处理设置将决定为Kafka集群上的任何给定主题提供服务所需的容量，但是对主题本身没有直接的吞吐量限制。相比之下，发布/订阅Lite主题的存储和吞吐量必须明确定义。Pub/Sub Lite主题容量由分区数量和每个分区的可调读写存储<a class="ae jr" href="https://cloud.google.com/pubsub/lite/docs/topics#creating_lite_topics" rel="noopener ugc nofollow" target="_blank">容量决定。</a></p><p id="a7de" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hj">认证和安全</strong></p><p id="2601" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Apache Kafka支持几种开放的身份验证和加密机制。使用发布/订阅建兴，认证是基于GCP的IAM系统。通过<a class="ae jr" href="https://cloud.google.com/security/encryption-at-rest" rel="noopener ugc nofollow" target="_blank">静态加密</a>和<a class="ae jr" href="https://cloud.google.com/security/encryption-in-transit" rel="noopener ugc nofollow" target="_blank">传输</a>来确保安全性。</p><p id="1316" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hj">配置选项</strong></p><p id="daa2" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Kafka有大量控制主题结构、限制和代理属性的配置选项。下面列出了一些对数据摄取有用的常见方法，以及它们在发布/订阅Lite中的对等用法。注意，作为一个受管系统，用户不需要关心许多代理属性。</p><p id="b958" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><em class="kv">auto . create . topics . enable</em></p><p id="59d8" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">没有对等物可用。应该使用管理API预先创建主题。类似地，在与管理API一起使用之前，必须创建订阅(大致相当于使用者组)。</p><p id="10f7" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><em class="kv"> retention.bytes </em></p><p id="b705" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">在Pub/Sub Lite中等价的是每个分区的<a class="ae jr" href="https://cloud.google.com/pubsub/lite/docs/topics#creating_lite_topics" rel="noopener ugc nofollow" target="_blank">存储</a>，这是每个主题的属性。</p><p id="3e5d" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><em class="kv"> retention.ms </em></p><p id="e069" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">在Pub/Sub Lite中的等效项是<a class="ae jr" href="https://cloud.google.com/pubsub/lite/docs/topics#creating_lite_topics" rel="noopener ugc nofollow" target="_blank">消息保持期</a>，这是一个基于主题的属性。</p><p id="ec26" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><em class="kv"> flush.ms，ack</em></p><p id="1055" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">这些是不可配置的，但是在保证发布被持久保存到复制存储之前，发布不会被确认。</p><p id="0332" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><em class="kv">最大消息字节数</em></p><p id="d6ab" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">这是不可配置的，3.5 MiB是可以发送到发布/订阅建兴的最大消息大小。以可重复的方式<a class="ae jr" href="https://cloud.google.com/pubsub/lite/quotas#resource_quotas" rel="noopener ugc nofollow" target="_blank">计算消息大小</a>。</p><p id="9a67" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><em class="kv"> key.serializer，value.serializer，key.deserializer，value.deserializer </em></p><p id="5365" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Pub/Sub Lite具体实现了<code class="du kw kx ky kz b">Producer&lt;byte[], byte[]&gt;</code>和<code class="du kw kx ky kz b">Consumer&lt;byte[], byte[]&gt;</code>。任何序列化(可能会失败)都应该由用户代码执行。</p><p id="0d79" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><em class="kv">重试次数</em></p><p id="62ef" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Pub/Sub Lite使用流式传输协议，并将无限期重试短暂的发布错误，如不可用。任何到达最终用户代码的故障都是永久性的。</p><p id="3f02" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><em class="kv">批量</em></p><p id="6b9c" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">批处理设置可在<a class="ae jr" href="https://cloud.google.com/pubsub/lite/docs/publishing#batching_messages" rel="noopener ugc nofollow" target="_blank">客户端创建时</a>进行配置。</p><p id="4eb6" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><em class="kv">消息.时间戳.类型</em></p><p id="1174" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">当使用消费者实现时，将选择事件时间戳(如果存在)，否则使用发布时间戳。使用数据流时，发布和事件时间戳都可用。</p><p id="43e2" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><em class="kv"> max.partition.fetch.bytes，max.poll.records </em></p><p id="1c25" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><a class="ae jr" href="https://cloud.google.com/pubsub/lite/docs/subscribing#using_flow_control" rel="noopener ugc nofollow" target="_blank">流量控制设置</a>可在客户端创建时配置。</p><p id="89b5" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><em class="kv"> enable.auto.commit </em></p><p id="8513" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">自动提交可在客户端创建时配置。</p><p id="4501" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><em class="kv">使能幂等</em></p><p id="cdec" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">目前不支持此功能。</p><p id="1a0b" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><em class="kv">自动补偿复位</em></p><p id="37be" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">目前不支持此功能。</p></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><h1 id="b99b" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">发布/订阅精简版入门</strong></h1><p id="c4fd" class="pw-post-body-paragraph it iu hi iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq hb bi translated">Pub/Sub Lite工具使得测试当前在Pub/Sub Lite上运行的Kafka工作负载变得很容易。如果您在一个消费者组中有多个任务在阅读一个多生产者Kafka主题，那么修改您的代码以使用Pub/Sub Lite运行只需要很少的更改。这些概述如下。</p><h2 id="d795" class="la jt hi bd ju lb lc ld jy le lf lg kc je lh li kg ji lj lk kk jm ll lm ko ln bi translated">创建发布/订阅资源</h2><p id="cd00" class="pw-post-body-paragraph it iu hi iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq hb bi translated">要使用Pub/Sub Lite接收和处理数据，您需要分别创建一个<a class="ae jr" href="https://cloud.google.com/pubsub/lite/docs/topics#console" rel="noopener ugc nofollow" target="_blank">主题</a>和<a class="ae jr" href="https://cloud.google.com/pubsub/lite/docs/subscriptions" rel="noopener ugc nofollow" target="_blank">订阅</a>。在创建主题时，您应该确保它有足够的水平并行度(分区)来处理您的峰值发布负载。如果您的峰值发布吞吐量是X MiB/s，那么您应该为您的主题提供X/4个分区，每个分区有4 MiB/s的容量(默认)。</p><h2 id="84e4" class="la jt hi bd ju lb lc ld jy le lf lg kc je lh li kg ji lj lk kk jm ll lm ko ln bi translated">从卡夫卡复制数据</h2><p id="5330" class="pw-post-body-paragraph it iu hi iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq hb bi translated">Pub/Sub Lite 的Kafka Connect <a class="ae jr" href="https://github.com/GoogleCloudPlatform/pubsub/tree/master/kafka-connector" rel="noopener ugc nofollow" target="_blank">连接器由Pub/Sub团队维护，是将数据复制到Pub/Sub Lite的最简单方法。为了进行实验，您可以专门运行<code class="du kw kx ky kz b">copy_tool</code> </a><a class="ae jr" href="https://github.com/GoogleCloudPlatform/pubsub/blob/master/kafka-connector/copy_tool.py" rel="noopener ugc nofollow" target="_blank">脚本</a>，它将在单机配置中下载并在本地运行Kafka Connect。开始前，确保您按照<a class="ae jr" href="https://github.com/GoogleCloudPlatform/pubsub/tree/master/kafka-connector#pre-running-steps" rel="noopener ugc nofollow" target="_blank">预运行步骤</a>正确配置认证。一个示例<code class="du kw kx ky kz b">properties</code>文件如下所示:</p><pre class="lo lp lq lr fd ls kz lt lu aw lv bi"><span id="e92c" class="la jt hi kz b fi lw lx l ly lz">name=PubSubLiteSourceConnector</span><span id="c8f7" class="la jt hi kz b fi ma lx l ly lz">connector.class=com.google.pubsublite.kafka.source.PubSubLiteSourceConnector</span><span id="96c1" class="la jt hi kz b fi ma lx l ly lz">pubsublite.project=my-project</span><span id="7d88" class="la jt hi kz b fi ma lx l ly lz">pubsublite.location=europe-south7-q</span><span id="8ae6" class="la jt hi kz b fi ma lx l ly lz">pubsublite.subscription=my-subscription</span><span id="4887" class="la jt hi kz b fi ma lx l ly lz">kafka.topic=my-kafka-topic</span></pre><p id="ae9a" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">这将在运行时将发布到kafka主题的所有数据镜像到Pub/Sub Lite。<a class="ae jr" href="http://kafka.apache.org/documentation.html#connect_running" rel="noopener ugc nofollow" target="_blank"> Kafka Connect文档</a>提供了有关如何为集群运行Kafka Connect作业的更多信息。</p><p id="6f00" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">一旦您开始复制数据，您应该能够看到Pub/Sub Lite主题的<a class="ae jr" href="https://cloud.google.com/monitoring/api/metrics_gcp#gcp-pubsublite" rel="noopener ugc nofollow" target="_blank">topic/publish _ message _ count metrics</a>在<a class="ae jr" href="https://console.cloud.google.com/monitoring/metrics-explorer" rel="noopener ugc nofollow" target="_blank"> metrics explorer控制台</a>中增长，因为您的Kafka主题的积压被复制。</p><h2 id="269b" class="la jt hi bd ju lb lc ld jy le lf lg kc je lh li kg ji lj lk kk jm ll lm ko ln bi translated">从发布/订阅建兴读取数据</h2><p id="ce5a" class="pw-post-body-paragraph it iu hi iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq hb bi translated">Pub/Sub团队维护了一个<a class="ae jr" href="https://github.com/googleapis/java-pubsublite-kafka#instructions-for-pubsub-lite-kafka-usage" rel="noopener ugc nofollow" target="_blank"> Kafka消费者API实现</a>，它允许您从Pub/Sub Lite中读取数据，只需对现有代码进行最小的修改。</p><p id="950b" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">为此，您将使用同一接口的特定于Pub/Sub Lite的实现替换<code class="du kw kx ky kz b">KafkaConsumer&lt;byte[],byte[]&gt;</code>的所有实例。首先，您必须确保没有客户端代码引用具体的<code class="du kw kx ky kz b">KafkaConsumer</code>实现——相反，您应该用<code class="du kw kx ky kz b">Consumer&lt;byte[],byte[]&gt;</code>接口替换它们。接下来，您应该按照上面链接中的详细描述来构造您的<a class="ae jr" href="https://cloud.google.com/pubsub/lite/docs/samples/pubsublite-kafka-consumer" rel="noopener ugc nofollow" target="_blank">发布/订阅Lite消费者</a>实现，并将其传递到您的代码中。</p><p id="d5d7" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">当您调用<code class="du kw kx ky kz b">poll()</code>时，您现在将从Pub/Sub Lite而不是Kafka检索消息。请注意，Pub/Sub Lite <code class="du kw kx ky kz b">Consumer</code>不会自动为您创建订阅:您必须<a class="ae jr" href="https://cloud.google.com/pubsub/lite/docs/subscriptions" rel="noopener ugc nofollow" target="_blank">使用UI或gcloud提前创建订阅</a>。</p><p id="3f17" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">当您接收消息并提交偏移量时，您可以通过查看metrics explorer控制台中的<a class="ae jr" href="https://cloud.google.com/monitoring/api/metrics_gcp#gcp-pubsublite" rel="noopener ugc nofollow" target="_blank">subscription/backlog _ message _ count</a>度量来监控您的<code class="du kw kx ky kz b">Consumers</code>在backlog中的进度。</p><h2 id="3ade" class="la jt hi bd ju lb lc ld jy le lf lg kc je lh li kg ji lj lk kk jm ll lm ko ln bi translated">将数据写入发布/订阅Lite</h2><p id="1b8a" class="pw-post-body-paragraph it iu hi iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq hb bi translated">一旦所有的<code class="du kw kx ky kz b">Consumers</code>都迁移到从发布/订阅建兴读取数据，您就可以开始将<code class="du kw kx ky kz b">Producers</code>迁移到发布/订阅建兴。类似于<code class="du kw kx ky kz b">Consumer</code>的情况，您可以用<code class="du kw kx ky kz b">Producer&lt;byte[],byte[]&gt;</code>替换<code class="du kw kx ky kz b">KafkaProducer&lt;byte[], byte[]&gt;</code>的所有用户，这是一个无操作的更改。然后，按照<a class="ae jr" href="https://github.com/googleapis/java-pubsublite-kafka#instructions-for-pubsub-lite-kafka-usage" rel="noopener ugc nofollow" target="_blank">指令</a>，你可以构建一个<a class="ae jr" href="https://cloud.google.com/pubsub/lite/docs/samples/pubsublite-kafka-producer" rel="noopener ugc nofollow" target="_blank">发布/订阅建兴生产者</a>实现，并将其传递给你的代码。当您调用<code class="du kw kx ky kz b">send()</code>时，数据将被发送到Pub/Sub Lite。当您更新您的生产者作业时，您的从Pub/Sub Lite读取的消费者将会对数据是通过Kafka发送(并通过Kafka Connect复制到Pub/Sub Lite)还是直接发送到Pub/Sub Lite感到矛盾。让Kafka和Pub/Sub Lite制作人同时运行不是问题。</p></div></div>    
</body>
</html>