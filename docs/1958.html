<html>
<head>
<title>Running AlphaFold with Google Cloud Life Sciences</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用谷歌云生命科学运行AlphaFold</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/running-alphafold-with-google-cloud-life-sciences-7219db6ca99e?source=collection_archive---------2-----------------------#2021-09-10">https://medium.com/google-cloud/running-alphafold-with-google-cloud-life-sciences-7219db6ca99e?source=collection_archive---------2-----------------------#2021-09-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/cf5bd95dd311856020d55d75aa6219cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8INdiiGRXcSAN749zxd1Kg.jpeg"/></div></div></figure><h1 id="1f4e" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">阿尔法折叠</h1><p id="19c6" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">AlphaFold是DeepMind开发的一个人工智能模型，用于预测蛋白质的三维结构。第一个AlphaFold(版本1)于2018年发布，随后是2020年的版本2。作为一项创新发明，它吸引了全世界的关注，据说它解决了生物学中一个50年的重大挑战。DeepMind也于2021年在GitHub上发布了AlphaFold。预计这将使每个人手头都有AlphaFold，在不久的将来，它将有可能阐明未知蛋白质的功能，加速新药的开发，并治疗许多人的疾病。</p><p id="7e21" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">AlphaFold在GitHub上发布后，研究机构和许多个人立即在他们的博客上发布了在云和本地服务器上运行AlphaFold的步骤。然而，要运行AlphaFold，你需要从互联网上下载2.2 TB+的数据库文件，并将其存储在服务器的磁盘上。它还需要一定的CPU、内存或GPU，因此构建和配置一个云服务器来使用AlphaFold并保持它长时间运行是不舒服的。</p><p id="6d8d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在这篇文章中，我将解释在不设置虚拟服务器(计算引擎VM实例)的情况下在Google Cloud上运行AlphaFold的步骤。</p><p id="90bf" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj"> <em class="kr">免责声明</em> </strong> <em class="kr">:本文假设你对Linux OS、Docker、Google Cloud有一定的背景知识。请注意，这篇文章不是一个完整的操作手册，一些步骤已经被省略。</em></p></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><h1 id="3f0e" class="iq ir hi bd is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn bi translated">仅第一次准备</h1><p id="fac6" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">为首次准备创建一个虚拟机实例。这是因为您需要首先临时使用VM实例来创建磁盘映像。</p><p id="100b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">准备步骤如下。</p><ol class=""><li id="a1f5" class="le lf hi jq b jr km jv kn jz lg kd lh kh li kl lj lk ll lm bi translated">创建一个AlphaFold容器映像，并在容器注册表中注册它</li><li id="2b7a" class="le lf hi jq b jr ln jv lo jz lp kd lq kh lr kl lj lk ll lm bi translated">下载数据库文件并将磁盘转换为映像</li><li id="964f" class="le lf hi jq b jr ln jv lo jz lp kd lq kh lr kl lj lk ll lm bi translated">启用云生命科学API</li><li id="f8a3" class="le lf hi jq b jr ln jv lo jz lp kd lq kh lr kl lj lk ll lm bi translated">安装dsub</li><li id="6a54" class="le lf hi jq b jr ln jv lo jz lp kd lq kh lr kl lj lk ll lm bi translated">创建一个在容器内部运行的脚本</li></ol><p id="5f8e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">以上步骤最多需要2个虚拟机实例。后续步骤假设在云壳上操作。</p><p id="6559" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">那么，让我们按顺序办理手续。</p><h2 id="d4a0" class="ls ir hi bd is lt lu lv iw lw lx ly ja jz lz ma je kd mb mc ji kh md me jm mf bi translated">1.创建一个AlphaFold容器映像，并在容器注册表中注册它</h2><p id="83b8" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated"><a class="ae mg" href="https://cloud.google.com/compute/docs/instances/create-start-instance" rel="noopener ugc nofollow" target="_blank">创建一个计算引擎虚拟机实例</a>。<a class="ae mg" href="https://cloud.google.com/compute/docs/disks/add-persistent-disk" rel="noopener ugc nofollow" target="_blank">将一个2.2 TB或更大的磁盘</a>连接到这个虚拟机，并将其挂载到虚拟机实例上。以下是在命令行上的us-central1-a区域中创建虚拟机实例的命令示例。请注意，引导磁盘大小为100 GB，并创建一个3000 GB的非引导磁盘。虚拟机启动后，您需要格式化并挂载非引导磁盘。详见<a class="ae mg" href="https://cloud.google.com/compute/docs/disks/add-persistent-disk#format_and_mount_linux" rel="noopener ugc nofollow" target="_blank">文件</a>。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="7263" class="ls ir hi mm b fi mq mr l ms mt">gcloud compute instances create &lt;INSTANCE_NAME&gt; \<br/> --zone=us-central1-a \<br/> --machine-type=e2-standard-8 \<br/> --boot-disk-size=100GB \<br/> --create-disk=mode=rw,size=3000,type=projects/&lt;PROJECT_ID&gt;/zones/us-central1-a/diskTypes/pd-balanced,name=alphafold-data,device-name=alphafold-data</span></pre><p id="82ca" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">你也可以从谷歌云控制台做同样的事情。</p><p id="18ff" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在Google Cloud中，“<a class="ae mg" href="https://cloud.google.com/compute/docs/regions-zones/global-regional-zonal-resources" rel="noopener ugc nofollow" target="_blank">图片是全局资源</a>”。您只需在一个地方创建一个映像，就可以在世界上的任何地区使用该映像。因此，您可以在任何区域创建VM实例。</p><p id="890b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">SSH登录到您创建的VM实例，从GitHub克隆AlphaFold，构建一个容器映像并<a class="ae mg" href="https://cloud.google.com/container-registry/docs/pushing-and-pulling" rel="noopener ugc nofollow" target="_blank">将其推送到容器注册表</a>。执行以下命令。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="6584" class="ls ir hi mm b fi mq mr l ms mt"># install git<br/>sudo apt-get update<br/>sudo apt-get install git</span><span id="8b4d" class="ls ir hi mm b fi mu mr l ms mt"># install docker<br/>sudo apt-get install \<br/>    apt-transport-https \<br/>    ca-certificates \<br/>    curl \<br/>    gnupg \<br/>    lsb-release</span><span id="acbd" class="ls ir hi mm b fi mu mr l ms mt">curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><span id="3870" class="ls ir hi mm b fi mu mr l ms mt">echo \<br/>  "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/debian \<br/>  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null<br/>sudo apt-get update<br/>sudo apt-get install docker-ce docker-ce-cli containerd.io</span><span id="cca2" class="ls ir hi mm b fi mu mr l ms mt"># make docker available with general user privilege<br/>sudo gpasswd -a $(whoami) docker</span><span id="416f" class="ls ir hi mm b fi mu mr l ms mt"># docker build, tag and push<br/>git clone <a class="ae mg" href="https://github.com/deepmind/alphafold.git" rel="noopener ugc nofollow" target="_blank">https://github.com/deepmind/alphafold.git</a><br/>cd alphafold<br/>docker build -f docker/Dockerfile -t alphafold .<br/>docker tag alphafold gcr.io/&lt;PROJECT_ID&gt;/alphafold<br/>docker push gcr.io/&lt;PROJECT_ID&gt;/alphafold</span></pre><h2 id="abc1" class="ls ir hi bd is lt lu lv iw lw lx ly ja jz lz ma je kd mb mc ji kh md me jm mf bi translated">2.下载数据库文件，将磁盘转换成图像</h2><p id="e4e2" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">运行脚本以下载数据库文件，指定挂接磁盘的路径。MOUNT_POINT指定装载3000GB磁盘的路径。见<a class="ae mg" href="https://cloud.google.com/compute/docs/disks/add-persistent-disk#format_and_mount_linux" rel="noopener ugc nofollow" target="_blank">此处</a>了解如何挂载额外的非引导磁盘。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="2873" class="ls ir hi mm b fi mq mr l ms mt">sudo apt-get install rsync<br/>sudo apt-get install aria2<br/>cd scripts<br/>./download_all_data.sh &lt;MOUNT_POINT&gt;</span></pre><p id="c033" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">下载需要2-3个小时才能完成。下载后，磁盘上的结构如下。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="ef5e" class="ls ir hi mm b fi mq mr l ms mt">/                             # Total: ~ 2.2 TB (download:438GB)<br/>  bfd/                                   #~1.7TB (download:271.6GB)<br/>        # 6 files.<br/>  mgnify/                                # ~64GB (download:32.9GB)<br/>        mgy_clusters_2018_12.fa<br/>  params/                                # ~3.5GB (download:3.5GB)<br/>        # 5 CASP14 models,<br/>        # 5 pTM models,<br/>        # LICENSE,<br/>        # = 11 files.<br/>  pdb70/                                 # ~56GB (download:19.5GB)<br/>        # 9 files.<br/>  pdb_mmcif/                             # ~206GB (download:46GB)<br/>        mmcif_files/<br/>            # About 180,000 .cif files.<br/>        obsolete.dat<br/>  small_bfd/                             # ~17GB (download:9.6GB)<br/>        bfd-first_non_consensus_sequences.fasta<br/>  uniclust30/                            # ~86GB (download:24.9GB)<br/>        uniclust30_2018_08/<br/>            # 13 files.<br/>  uniref90/                              # ~58GB (download:29.7 GB)<br/>        uniref90.fasta</span></pre><p id="308b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">下载完成后，您可以<a class="ae mg" href="https://cloud.google.com/sdk/gcloud/reference/compute/instances/detach-disk" rel="noopener ugc nofollow" target="_blank">分离磁盘</a>，然后<a class="ae mg" href="https://cloud.google.com/compute/docs/images/create-delete-deprecate-private-images#create_image" rel="noopener ugc nofollow" target="_blank">从磁盘</a>创建一个映像。您可以在Google Cloud控制台或命令行上创建图像。</p><p id="b675" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果您使用命令行运行它:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="4202" class="ls ir hi mm b fi mq mr l ms mt">gcloud compute images create &lt;IMAGE_NAME&gt; --source-disk &lt;DISK_NAME&gt;</span></pre><p id="6e14" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">一旦创建了映像，就不再需要VM实例了，所以删除它。<a class="ae mg" href="https://cloud.google.com/compute/docs/instances/deleting-instance" rel="noopener ugc nofollow" target="_blank">删除一个虚拟机实例</a>也非常容易。如果使用命令行删除实例:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="c36c" class="ls ir hi mm b fi mq mr l ms mt">gcloud compute instances delete &lt;INSTANCE_NAME&gt;</span></pre><p id="95d9" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">您可以在云壳上执行以下操作。如何使用云壳，请参考以下文档。</p><p id="c613" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><a class="ae mg" href="https://cloud.google.com/shell/docs/launching-cloud-shell" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/shell/docs/launching-cloud-shell</a></p><h2 id="b412" class="ls ir hi bd is lt lu lv iw lw lx ly ja jz lz ma je kd mb mc ji kh md me jm mf bi translated">3.启用云生命科学API</h2><figure class="mh mi mj mk fd ij er es paragraph-image"><div class="er es mv"><img src="../Images/ca50cc4e1899313a4a0450249ef299bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:464/0*1Adqj-vz69UlG5rk"/></div><figcaption class="mw mx et er es my mz bd b be z dx translated">云生命科学</figcaption></figure><p id="720c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">谷歌云生命科学是一套用于管理、处理和转换生命科学数据的服务和工具。以下步骤中使用的“dsub”调用Google Cloud Life Sciences API，所以让我们在这里<a class="ae mg" href="https://cloud.google.com/endpoints/docs/openapi/enable-api" rel="noopener ugc nofollow" target="_blank">启用API </a>。您可以从Google Cloud控制台或命令行启用API。</p><p id="0d98" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果您使用命令行运行它:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="1273" class="ls ir hi mm b fi mq mr l ms mt">gcloud services enable lifesciences.googleapis.com</span></pre><h2 id="59d3" class="ls ir hi bd is lt lu lv iw lw lx ly ja jz lz ma je kd mb mc ji kh md me jm mf bi translated">4.安装dsub</h2><figure class="mh mi mj mk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es na"><img src="../Images/f418c367195d3fe0e91d5fdeb1d5c6aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FwdJaOQ_JqvUfezi"/></div></div></figure><p id="a332" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">dsub是Google开发的命令行工具，用于运行各种生物信息学软件。dsub可以从指定的映像创建一个容器，并执行其中的任何命令或脚本。</p><p id="4bb5" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">此外，dsub还具有诸如挂载磁盘以便可以从容器中访问它，将放置在Google Cloud Storage (GCS)中的文件放入容器中，并将容器中处理的结果带出到GCS中的功能。</p><p id="f692" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">很多生物信息学工具都是容器化的，需要读写大量数据，所以dsub这样的工具非常有用。</p><p id="3828" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">dsub可以很容易地用pip安装。要使用Python的venv进行安装，请遵循以下步骤。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="9f66" class="ls ir hi mm b fi mq mr l ms mt">python3 -m venv env<br/>source env/bin/activate<br/>pip install dsub</span></pre><p id="077f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">有关dsub的更多信息，请参见GitHub。</p><p id="a9d4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">【https://github.com/DataBiosphere/dsub T4】</p><h2 id="d9d7" class="ls ir hi bd is lt lu lv iw lw lx ly ja jz lz ma je kd mb mc ji kh md me jm mf bi translated">5.创建要在容器内部执行的脚本</h2><p id="4612" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">创建一个要在容器内部执行的脚本文件。用文件名“<strong class="jq hj"> alphafold.sh </strong>”保存以下内容。可以看到很多参数，但只是运行“/app/run_alphafold.sh”。${}中包含的变量是从后面描述的dsub命令的参数中传递的。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="c621" class="ls ir hi mm b fi mq mr l ms mt">cd /app/alphafold</span><span id="685b" class="ls ir hi mm b fi mu mr l ms mt">/app/run_alphafold.sh \<br/> --fasta_paths=${FASTA} \<br/> --uniref90_database_path=${DB}/uniref90/uniref90.fasta \<br/> --mgnify_database_path=${DB}/mgnify/mgy_clusters_2018_12.fa \<br/> --pdb70_database_path=${DB}/pdb70/pdb70 \<br/> --data_dir=${DB} \<br/> --template_mmcif_dir=${DB}/pdb_mmcif/mmcif_files \<br/> --obsolete_pdbs_path=${DB}/pdb_mmcif/obsolete.dat \<br/> --uniclust30_database_path=${DB}/uniclust30/uniclust30_2018_08/uniclust30_2018_08 \<br/> --bfd_database_path=${DB}/bfd/bfd_metaclust_clu_complete_id30_c90_final_seq.sorted_opt \<br/> --output_dir=${OUT_PATH} \<br/> --model_names=model_1,model_2,model_3,model_4,model_5 \<br/> --max_template_date=2020–05–14 \<br/> --preset=full_dbs \<br/> --benchmark=False \<br/> --logtostderr</span></pre><p id="1c1d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，您只需完成第一次所需的准备工作。</p><p id="977c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">到目前为止，工作应该已经创建了以下资源。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="23c2" class="ls ir hi mm b fi mq mr l ms mt">・ The container image is registered in the container registry.<br/>・ The disk image is created.</span></pre><h1 id="aeb9" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">运行AlphaFold</h1><p id="3d1b" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">现在你可以运行AlphaFold了。到目前为止的准备工作只在开始时做一次。之后，您可以通过以下简单的步骤运行AlphaFold任意次。</p><ol class=""><li id="35fe" class="le lf hi jq b jr km jv kn jz lg kd lh kh li kl lj lk ll lm bi translated">将氨基酸序列(FASTA文件)保存在GCS中</li><li id="d993" class="le lf hi jq b jr ln jv lo jz lp kd lq kh lr kl lj lk ll lm bi translated">执行AlphaFold</li></ol><p id="b248" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">让我们看一下每个程序。</p><h2 id="c352" class="ls ir hi bd is lt lu lv iw lw lx ly ja jz lz ma je kd mb mc ji kh md me jm mf bi translated">1.将氨基酸序列(FASTA文件)保存在GCS中</h2><p id="fb8c" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">准备将作为AlphaFold输入数据的氨基酸序列。氨基酸序列数据通常是字母文本的形式。创建一个样本文件，并将其复制到GCS。用文件名“<strong class="jq hj"> all0174.fasta </strong>”保存以下数据。以第一个“&gt;”开头的行是注释行，氨基酸序列在下一行之后描述。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="dbb6" class="ls ir hi mm b fi mq mr l ms mt">&gt;all0174<br/>MTEADSSVLQIWGGHPLQGHVKISGAKNSALVIMAGALLCSGDCRIRNVPLLADVERMGEVISALGVRLTRQADIIDINASEIKTSKAPYELVTQLRASFFAIGAILARLGVAQMPLPGGCAIGARPVDLHVRGLQAMGAEVQIEHGICNAYVPGSGGRLKGAKIYLDTPSVGATETLMMAATLADGETILENAAREPEVVDLANFCKAMGANIQGAGTSTITIVGVPKLHSVDYSIIPDRIEAGTFLVAGAITRSEITLSSVVPEHLIPLIAKLRDIGVTIIEESPDCLRILPAEILKATDIDTLPHPGFPTDMQAPFMALLTLAEGDSIINESVFENRLRHASELNRLGADIRVKGNTAFVRGVPLLSGAPVIGTDLRASAALVIAGLAAEGKTTIQGLHHLDRGYDQIDVKLQQLGAKILRVREEPANAEVAVNNNVSPASIST</span></pre><p id="4ce4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">首先，你要创建一个GCS桶。如果您使用命令行:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="787d" class="ls ir hi mm b fi mq mr l ms mt">gsutil mb gs://&lt;PROJECT_ID&gt;-alphafold</span></pre><p id="5f27" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">将您创建的FASTA文件复制到GCS bucket下的输入文件夹中。您可以使用命令行来执行它:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="0c72" class="ls ir hi mm b fi mq mr l ms mt">gsutil cp all0174.fasta gs://&lt;PROJECT_ID&gt;-alphafold/input/</span></pre><h2 id="f772" class="ls ir hi bd is lt lu lv iw lw lx ly ja jz lz ma je kd mb mc ji kh md me jm mf bi translated">2.运行AlphaFold</h2><p id="3030" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">使用下面的dsub命令执行AlphaFold。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="5e4e" class="ls ir hi mm b fi mq mr l ms mt">dsub --provider google-cls-v2 \<br/> --project &lt;PROJECT_ID&gt; \<br/> --zones &lt;ZONE_NAME&gt; \<br/> --logging gs://&lt;PROJECT_ID&gt;-alphafold/logs \<br/> --image=gcr.io/&lt;PROJECT_ID&gt;/alphafold:latest \<br/> --script=alphafold.sh \<br/> --input FASTA=gs://&lt;PROJECT_ID&gt;-alphafold/input/all0174.fasta \<br/> --mount DB="&lt;IMAGE_URL&gt; 3000" \<br/> --output-recursive OUT_PATH=gs://&lt;PROJECT_ID&gt;-alphafold/output \<br/> --machine-type n1-standard-8 \<br/> --boot-disk-size 100 \<br/> --subnetwork &lt;SUBNET_NAME&gt;</span></pre><p id="5703" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">参数描述:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="3bf5" class="ls ir hi mm b fi mq mr l ms mt">--provider google-cls-v2: Google Cloud Life Sicences API (v2)<br/>--project: PROJECT ID<br/>--zones: ZONE NAME (wildcard "*" is possible. e.g. "us-central1-*")<br/>--logging: Log output destination folder<br/>--image: AlphaFold Container Image URL on GCR<br/>--script: Script file name created earlier<br/>--input: Path of the FASTA file uploaded to GCS<br/>--mount: URL of the created disk image (*1)<br/>--output-recursive: Path of GCS where the artifacts are output<br/>--machine-type: n1-standard-8<br/>--boot-disk-size: 100 GB<br/>--subnetwork: Subnetwork name if it’s not "default"</span><span id="bb12" class="ls ir hi mm b fi mu mr l ms mt">*1:<br/>URL of the disk image can be found with the following command.<br/>gcloud compute images list --no-standard-images --uri</span></pre><p id="8499" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">当提交dsub命令时，可以看到作业id。您可以使用此作业id，通过以下命令来检查正在运行的作业的状态。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="029b" class="ls ir hi mm b fi mq mr l ms mt">dstat --provider google-cls-v2 --project &lt;PROJECT_ID&gt; --jobs &lt;JOB_ID&gt;</span></pre><p id="04bc" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">您也可以使用ddel命令取消作业。该命令如下所示:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="4acb" class="ls ir hi mm b fi mq mr l ms mt">ddel --provider google-cls-v2 --project &lt;PROJECT_ID&gt; --jobs &lt;JOB_ID&gt;</span></pre><p id="c74b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">该命令仅使用CPU，但也可以使用GPU高速处理。例如，如果您使用一个NVIDIA K80，请使用以下参数运行dsub命令:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="34a9" class="ls ir hi mm b fi mq mr l ms mt">--accelerator-type nvidia-tesla-k80<br/>--accelerator-count 1</span></pre><p id="69fc" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">您可以在以下URL查看GPU可以使用的区域和GPU类型。</p><p id="61cc" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><a class="ae mg" href="https://cloud.google.com/compute/docs/gpus/gpu-regions-zones" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/compute/docs/GPU/GPU-regions-zones</a></p><p id="6e53" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">此外，<a class="ae mg" href="https://cloud.google.com/compute/docs/instances/preemptible" rel="noopener ugc nofollow" target="_blank">可抢占的虚拟机</a>降低了成本。可抢占的虚拟机是寿命短、价格合理的计算引擎虚拟机实例。如果您想使用一个可抢占的VM，添加以下参数并运行dsub。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="919b" class="ls ir hi mm b fi mq mr l ms mt">--preemptible</span></pre></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><h1 id="7066" class="iq ir hi bd is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn bi translated">可视化预测的3D结构</h1><p id="68a2" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">AlphaFold可能需要几十分钟到几个小时才能完成。当该命令完成时，包含作为AlphaFold预测结果的蛋白质结构的文件(PDB文件)被输出到dsub的output-recursive参数指定的文件夹下。<br/>下载一个。pdb文件并将其可视化。<br/>有很多处理PDB文件的软件，也有几个网站，你只需上传文件就可以轻松地看到3D结构。例如，有以下网站。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="cdf1" class="ls ir hi mm b fi mq mr l ms mt"><a class="ae mg" href="https://www.rcsb.org/3d-view" rel="noopener ugc nofollow" target="_blank">https://www.rcsb.org/3d-view</a><br/><a class="ae mg" href="https://molstar.org/viewer/" rel="noopener ugc nofollow" target="_blank">https://molstar.org/viewer/</a><br/><a class="ae mg" href="https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?mmdbid=1TUP" rel="noopener ugc nofollow" target="_blank">https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?mmdbid=1TUP</a></span></pre><p id="fa2b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">你可以想象任何一个有类似操作的网站。从“打开文件”菜单中选择PDB文件，然后单击“应用”查看3D结构，如下所示。</p><figure class="mh mi mj mk fd ij er es paragraph-image"><div class="ab fe cl nb"><img src="../Images/d0ffa41e971a59c272588cb7d8162255.png" data-original-src="https://miro.medium.com/v2/0*sBq6zMDcubs715uw"/></div></figure></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><h1 id="2961" class="iq ir hi bd is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn bi translated">结论</h1><p id="e558" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">使用这里介绍的dsub命令运行AlphaFold的成本很低，因为您不必让虚拟服务器一直运行。如果将GPU+preemptable作为一个集合使用，那么在加快进程的同时，能够以较低的成本执行。</p><p id="63a4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">而我这次用的是dsub，同样的事情不用dsub单独用云生命科学也能实现。</p><p id="8d7c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">谷歌云提供了多种支持生命科学的解决方案。详情请参考以下文件。</p><p id="858b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><a class="ae mg" href="https://cloud.google.com/life-sciences/docs/how-tos" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/life-sciences/docs/how-tos</a></p></div></div>    
</body>
</html>