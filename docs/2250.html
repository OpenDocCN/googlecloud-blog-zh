<html>
<head>
<title>Accelerate Translation for Oracle to BigQuery migration using Interactive SQL Translation.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Interactive SQL转换加速Oracle到BigQuery迁移的转换。</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/accelerate-translation-for-oracle-to-bigquery-migration-using-interactive-sql-translation-c421f9beea5d?source=collection_archive---------1-----------------------#2022-07-06">https://medium.com/google-cloud/accelerate-translation-for-oracle-to-bigquery-migration-using-interactive-sql-translation-c421f9beea5d?source=collection_archive---------1-----------------------#2022-07-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b869" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在数据库或数据仓库迁移、翻译或转换引擎上加速整体采用和现代化。它模拟从源引擎到云上相应目标的特征映射转换的已知模式。</p><p id="e02a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最近，我们宣布了面向BigQuery多个数据源的interactive SQL Translator的公共预览版。在这些博客中，我们将查看一些最佳实践和SQL实用程序，以加速从Oracle到BigQuery迁移的SQL转换。我们将主要关注交互式sql翻译，即利用BigQuery控制台和动态翻译代码。</p><p id="914d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经有了详细的SQL转换模式<a class="ae jd" href="https://cloud.google.com/architecture/dw2bq/oracle/oracle-bq-sql-translation-reference.pdf" rel="noopener ugc nofollow" target="_blank"> publish </a>，作为从Oracle到BigQuery迁移的映射特性\功能的一部分。</p><p id="7204" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面让我们考虑从Oracle到BigQuery的转换的Oracle PL\SQL块。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="0f28" class="jn jo hi jj b fi jp jq l jr js">DECLARE<br/>cntr number := 0;<br/>BEGIN<br/>FOR indx IN <strong class="jj hj">(select col1 from sample1)</strong><br/>loop<br/>cntr := indx.col1 + 1;<br/>end loop;<br/>END ;</span></pre><p id="fad5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在为循环翻译<em class="jt">时，</em>翻译引擎试图将其转换为游标内的结构数组。作为交互接口的一部分，底层翻译引擎不知道列col1的数据类型，因此无法猜测它或有效地转换它。</p><figure class="je jf jg jh fd jv er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es ju"><img src="../Images/186999a9560178b1b097aef0fb14123b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a7zzOaHywvMlBT6UGIFqPw.png"/></div></div></figure><h2 id="4e86" class="jn jo hi bd kc kd ke kf kg kh ki kj kk iq kl km kn iu ko kp kq iy kr ks kt ku bi translated">在交互式翻译期间添加表DDL</h2><p id="d9eb" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">如果我们将表DDL作为翻译的一部分，底层翻译引擎将会很好地了解表的结构，并做出明智的翻译决定。在表格方面添加额外的元数据丰富了翻译引擎，以做出决策并全面加速迁移。</p><figure class="je jf jg jh fd jv er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es la"><img src="../Images/ae81fa4075a4f46190c107abaac81440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bhj5wVcDWv-XJxEZ57mKDg.png"/></div></div></figure><h2 id="370b" class="jn jo hi bd kc kd ke kf kg kh ki kj kk iq kl km kn iu ko kp kq iy kr ks kt ku bi translated">生成DDL : Oracle作为源</h2><p id="b56e" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">如果我们能够基于Oracle中程序块的依赖关系动态生成表DDL，那么它将通过针对pl\sql程序块的interactive sql转换来加速整体转换。以下代码片段使用Oracle中的DBMS_METADATA和ALL_DEPENDENCIES来生成过程中相关表引用的DDL。</p><p id="2aa5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当前输入是硬编码的，需要作为SQL的一部分传递，如<strong class="ih hj">突出显示的</strong>。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="b140" class="jn jo hi jj b fi jp jq l jr js">SET LONG 200000;<br/>set pages 50000;<br/>set lines 32767;<br/>set heading off;</span><span id="f4a9" class="jn jo hi jj b fi lb jq l jr js">--set option to disable unnecessary tags with DDL<br/>EXEC dbms_metadata.set_transform_param(dbms_metadata.session_transform,'TABLESPACE',false);</span><span id="b95f" class="jn jo hi jj b fi lb jq l jr js">EXEC dbms_metadata.set_transform_param(dbms_metadata.session_transform,'STORAGE',false);</span><span id="e93f" class="jn jo hi jj b fi lb jq l jr js">EXEC dbms_metadata.set_transform_param(dbms_metadata.session_transform,'SEGMENT_ATTRIBUTES',false);</span><span id="14db" class="jn jo hi jj b fi lb jq l jr js">EXEC dbms_metadata.set_transform_param(dbms_metadata.session_transform,'SQLTERMINATOR',true);</span><span id="134b" class="jn jo hi jj b fi lb jq l jr js">WITH INPUT<br/>AS<br/>(<br/>SELECT<strong class="jj hj"> 'SAMPLE1' AS SCHEMA , 'SAMPLE_PROC'</strong> AS PROC_NAME FROM DUAL --input values<br/>) ,<br/>DEPENDENT_OBJ AS<br/>(SELECT DISTINCT REFERENCED_TYPE , REFERENCED_NAME , REFERENCED_OWNER<br/>FROM ALL_DEPENDENCIES , INPUT<br/>WHERE REFERENCED_TYPE IN ('TABLE','SYNONYM')<br/>AND OWNER = UPPER(INPUT.SCHEMA)<br/>AND TYPE IN  ( 'FUNCTION', 'PACKAGE BODY' , 'PACKAGE','PROCEDURE')<br/>AND NAME = UPPER(INPUT.PROC_NAME)) ,<br/>ALL_TBL_DEPENDENT AS<br/>(<br/>SELECT DISTINCT DECODE(REFERENCED_TYPE,'SYNONYM',SYN.TABLE_OWNER,REFERENCED_OWNER) AS REFERENCED_OWNER ,<br/>DECODE(REFERENCED_TYPE,'SYNONYM',SYN.TABLE_NAME,REFERENCED_NAME) AS REFERENCED_NAME<br/>FROM DEPENDENT_OBJ LEFT OUTER JOIN ALL_SYNONYMS SYN ON SYN.SYNONYM_NAME = REFERENCED_NAME  AND SYN.OWNER = REFERENCED_OWNER)<br/>SELECT REPLACE(DBMS_METADATA.get_ddl ('TABLE', REFERENCED_NAME , REFERENCED_OWNER),'"') FROM ALL_TBL_DEPENDENT;</span></pre><p id="4a06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它将为我们生成表DDL，以便在Interactive SQL控制台中作为Oracle到BigQuery迁移的一部分使用。它避免了手动检查表和生成DDL开销。</p><figure class="je jf jg jh fd jv er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es lc"><img src="../Images/1953d2838f125f251c383b1d03f7ba85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pdpukgTVfHOcV2v8LvNhFA.png"/></div></div></figure><p id="1110" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，我们还有<a class="ae jd" href="https://cloud.google.com/bigquery/docs/generate-metadata" rel="noopener ugc nofollow" target="_blank">批处理模式</a>，用于捕获作为dumper一部分的对象元数据，并将其用作整体代码转换策略的批处理翻译的一部分。</p><p id="f310" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Interactive SQL翻译提供了加速从不同来源到BigQuery的翻译的功能。添加表DDL丰富了转换，提高了转换率，加快了整体迁移。</p></div></div>    
</body>
</html>