<html>
<head>
<title>Why Google Cloud Spanner and ways you can access it with Zero to minimal app-code change.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么要使用Google Cloud Spanner，以及如何通过零到最小的应用程序代码更改来访问它。</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/why-google-cloud-spanner-and-ways-you-can-access-it-with-zero-to-minimal-app-code-change-aef72c700013?source=collection_archive---------0-----------------------#2021-01-26">https://medium.com/google-cloud/why-google-cloud-spanner-and-ways-you-can-access-it-with-zero-to-minimal-app-code-change-aef72c700013?source=collection_archive---------0-----------------------#2021-01-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="b05c" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated"><strong class="ak"> <em class="jd">为什么要用谷歌云扳手？</em>T3】</strong></h1><p id="0403" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">许多组织开始时规模很小，采用简单的体系结构，包括选择传统的RDBMS引擎，但是随着他们的产品越来越受欢迎，他们在选择数据库引擎时面临的主要挑战是:</p><ol class=""><li id="43b4" class="kc kd hi jg b jh ke jl kf jp kg jt kh jx ki kb kj kk kl km bi translated">通过分布式扩展确保可靠的性能。</li><li id="5378" class="kc kd hi jg b jh kn jl ko jp kp jt kq jx kr kb kj kk kl km bi translated">对系统故障有弹性的应用数据。</li><li id="15d9" class="kc kd hi jg b jh kn jl ko jp kp jt kq jx kr kb kj kk kl km bi translated">通过限制延迟来改善用户体验。</li><li id="9717" class="kc kd hi jg b jh kn jl ko jp kp jt kq jx kr kb kj kk kl km bi translated">高可用性SLA。</li></ol><p id="74da" class="pw-post-body-paragraph je jf hi jg b jh ke jj jk jl kf jn jo jp ks jr js jt kt jv jw jx ku jz ka kb hb bi translated">关系数据库引擎缺乏线性扩展的能力，也无法满足数百万/数十亿并发用户对应用程序的可靠性能访问，并且总是受限于CAP定理，也称为Brewer定理。CAP定理是这样一个概念:分布式数据库系统只能有三个保证中的两个:一致性、可用性或分区容差保证。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/291367f736d1c4c220ffe299d4e79c31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rUVHO9HH9MVtZix9_tjsiw.png"/></div></div></figure><p id="ee99" class="pw-post-body-paragraph je jf hi jg b jh ke jj jk jl kf jn jo jp ks jr js jt kt jv jw jx ku jz ka kb hb bi translated">因此，大多数组织只剩下两种选择，主要是RDBMS或NoSQL数据库结构。但是，过渡到NoSQL平台不仅需要在一致性或可用性级别做出妥协，还需要应用程序开发人员在应用层转换和修改数据，从而导致更多工程工作和架构复杂性的增加，影响新应用程序模块版本的上市时间，这可能会严重削弱他们在市场中的竞争力。</p><p id="1436" class="pw-post-body-paragraph je jf hi jg b jh ke jj jk jl kf jn jo jp ks jr js jt kt jv jw jx ku jz ka kb hb bi translated">这就是Google Cloud Spanner的用武之地，它是唯一的企业级、全球分布式关系数据库服务，提供高度一致的事务，并横向扩展到数千个节点，实现快速应用程序开发，解决性能和规模挑战。因此，结合了关系和非关系数据库结构的优点。</p><blockquote class="lh li lj"><p id="d86b" class="je jf lk jg b jh ke jj jk jl kf jn jo ll ks jr js lm kt jv jw ln ku jz ka kb hb bi translated"><strong class="jg hj">谷歌云扳手破帽了吗？</strong></p><p id="c589" class="je jf lk jg b jh ke jj jk jl kf jn jo ll ks jr js lm kt jv jw ln ku jz ka kb hb bi translated"><strong class="jg hj">简而言之:</strong>不，这是谷歌的工程壮举，他们能够借助其跨谷歌数据中心的超快速全球专用冗余网络，将网络分区容忍度‘P’的可能性降至最低。</p></blockquote></div><div class="ab cl lo lp gp lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="hb hc hd he hf"><h1 id="b566" class="if ig hi bd ih ii lv ik il im lw io ip iq lx is it iu ly iw ix iy lz ja jb jc bi translated"><strong class="ak">那么，访问它有多容易呢？</strong></h1><p id="272b" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">Google Cloud Spanner具有关系语义:模式和增强的数据类型。它支持使用标准ANSI 2011 SQL的查询，因此，它只是标准SQL，而不是定制的类似SQL的查询语言。将云扳手数据库与您的应用程序集成有多种方式:</p><h2 id="8934" class="ma ig hi bd ih mb mc md il me mf mg ip jp mh mi it jt mj mk ix jx ml mm jb mn bi translated"><a class="ae mo" href="https://cloud.google.com/spanner/docs/use-hibernate" rel="noopener ugc nofollow" target="_blank">用云扳手休眠ORM</a></h2><p id="d4b5" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">云扳手兼容<a class="ae mo" href="https://hibernate.org/orm/" rel="noopener ugc nofollow" target="_blank"> Hibernate ORM 5.4 </a>使用<a class="ae mo" href="https://github.com/GoogleCloudPlatform/google-cloud-spanner-hibernate" rel="noopener ugc nofollow" target="_blank">云扳手方言</a>。因此，使用标准Hibernate和Java持久性注释为最常见的条目类型和关系生成SQL、DML和DDL语句。因此，利用hibernate ORM的应用程序可以很容易地过渡到Cloud Spanner，只需零到最小的代码更改，因为hibernate的代码是独立于数据库的，当您更改oracle、mysql等数据库时，不需要更改<strong class="jg hj"> hql </strong>查询。敬云扳手。</p><blockquote class="lh li lj"><p id="267b" class="je jf lk jg b jh ke jj jk jl kf jn jo ll ks jr js lm kt jv jw ln ku jz ka kb hb bi translated">hibernate使用<strong class="jg hj"> hql (hibernate查询语言)</strong>，类似于sql，但是hibernate的hql提供了对<strong class="jg hj">多态查询</strong>的全面支持。</p></blockquote><h2 id="a747" class="ma ig hi bd ih mb mc md il me mf mg ip jp mh mi it jt mj mk ix jx ml mm jb mn bi translated"><a class="ae mo" href="https://github.com/cloudspannerecosystem/pgadapter" rel="noopener ugc nofollow" target="_blank">从PostgreSQL过渡到云扳手</a></h2><p id="1b75" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">Google工程师已经编写了一个代理，将Postgres wire协议转换为Cloud Spanner等价物。通过运行这个代理，任何Postgres客户机只需将其出站端口指向这个代理的入站端口，就可以无缝地运行。在此，我将带您了解它的基本设置和配置过程:</p><ul class=""><li id="dd2f" class="kc kd hi jg b jh ke jl kf jp kg jt kh jx ki kb mp kk kl km bi translated">从GitHub下载/克隆<a class="ae mo" href="https://github.com/cloudspannerecosystem/pgadapter.git" rel="noopener ugc nofollow" target="_blank"> PGAdapter代理</a>。</li></ul><pre class="kw kx ky kz fd mq mr ms mt aw mu bi"><span id="4933" class="ma ig hi mr b fi mv mw l mx my"> $ git clone <a class="ae mo" href="https://github.com/cloudspannerecosystem/pgadapter.git" rel="noopener ugc nofollow" target="_blank">https://github.com/cloudspannerecosystem/pgadapter.git</a></span></pre><ul class=""><li id="b1ab" class="kc kd hi jg b jh ke jl kf jp kg jt kh jx ki kb mp kk kl km bi translated">确保安装了Maven，这样您就可以构建<strong class="jg hj">Google Cloud Spanner PostgreSQL Adaptor。</strong></li></ul><pre class="kw kx ky kz fd mq mr ms mt aw mu bi"><span id="fdaf" class="ma ig hi mr b fi mv mw l mx my"><strong class="mr hj">$</strong> brew install maven<br/><strong class="mr hj">pgadapter$</strong> mvn package</span><span id="22af" class="ma ig hi mr b fi mz mw l mx my">[<strong class="mr hj">INFO</strong>] Replacing original artifact with shaded artifact.</span><span id="60ee" class="ma ig hi mr b fi mz mw l mx my">[<strong class="mr hj">INFO</strong>] Replacing /Users/ravishgarg/pgadapter/target/google-cloud-spanner-pgadapter-2.0.0-SNAPSHOT.jar with /Users/ravishgarg/pgadapter/target/google-cloud-spanner-pgadapter-2.0.0-SNAPSHOT-shaded.jar</span><span id="409d" class="ma ig hi mr b fi mz mw l mx my">[<strong class="mr hj">INFO</strong>] Replacing original source artifact with shaded source artifact.</span><span id="b0a7" class="ma ig hi mr b fi mz mw l mx my">[<strong class="mr hj">INFO</strong>] Replacing /Users/ravishgarg/pgadapter/target/google-cloud-spanner-pgadapter-2.0.0-SNAPSHOT-sources.jar with /Users/ravishgarg/pgadapter/target/google-cloud-spanner-pgadapter-2.0.0-SNAPSHOT-shaded-sources.jar</span><span id="3b04" class="ma ig hi mr b fi mz mw l mx my">[<strong class="mr hj">INFO</strong>] <strong class="mr hj">-----------------------------------------------------------</strong></span><span id="39a0" class="ma ig hi mr b fi mz mw l mx my">[<strong class="mr hj">INFO</strong>] <strong class="mr hj">BUILD SUCCESS</strong></span><span id="f75a" class="ma ig hi mr b fi mz mw l mx my">[<strong class="mr hj">INFO</strong>] <strong class="mr hj">-----------------------------------------------------------</strong></span></pre><ul class=""><li id="226f" class="kc kd hi jg b jh ke jl kf jp kg jt kh jx ki kb mp kk kl km bi translated">设置您的谷歌云扳手实例和数据库。</li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es na"><img src="../Images/16fdb13c4fe01e03df34e7c7b745c96e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tslGlFSb291eLgpE_J1U5w.png"/></div></div><figcaption class="nb nc et er es nd ne bd b be z dx translated">云扳手实例<strong class="bd ih">“测试-1”</strong></figcaption></figure><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es nf"><img src="../Images/b7a7c617ec82ed795a6cf512e9279240.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6biMc1NhrkOK35Iynb_Fmw.png"/></div></div><figcaption class="nb nc et er es nd ne bd b be z dx translated"><strong class="bd ih">“sampledb”</strong>可访问谷歌服务账户的数据库</figcaption></figure><ul class=""><li id="4a2a" class="kc kd hi jg b jh ke jl kf jp kg jt kh jx ki kb mp kk kl km bi translated">为Google服务帐户创建并下载证书密钥，该帐户已被授权访问我们的Cloud Spanner“sampledb”数据库。</li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es ng"><img src="../Images/251e909470fcc879a8b0446022642870.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yKzTFDgnbVpykSXDe3vdPQ.png"/></div></div><figcaption class="nb nc et er es nd ne bd b be z dx translated">下载服务帐户的凭据</figcaption></figure><ul class=""><li id="289a" class="kc kd hi jg b jh ke jl kf jp kg jt kh jx ki kb mp kk kl km bi translated">PostgreSQL适配器既可以作为独立进程启动，也可以作为进程内服务器启动。因此，启动代理作为独立的进程，并与云扳手数据库连接。这里:<br/><strong class="jg hj">-p</strong>&lt;project name&gt;<br/><strong class="jg hj">-I</strong>&lt;instance id&gt;<br/><strong class="jg hj">-d</strong>&lt;databasename&gt;<br/><strong class="jg hj">-c</strong>&lt;凭证路径&gt; <br/> <strong class="jg hj"> -s </strong> &lt;代理的入站端口。默认5432。&gt;</li></ul><pre class="kw kx ky kz fd mq mr ms mt aw mu bi"><span id="b8cc" class="ma ig hi mr b fi mv mw l mx my"><strong class="mr hj">pgadapter$</strong> cd target</span><span id="a8d6" class="ma ig hi mr b fi mz mw l mx my"><strong class="mr hj">target$</strong> java -jar google-cloud-spanner-pgadapter-2.0.0-SNAPSHOT.jar -p  raves-ce -i test-1 -d sampledb -c /Users/ravishgarg/Downloads/credentials.json -s 5434</span><span id="2716" class="ma ig hi mr b fi mz mw l mx my">Specified command metadata file metadata/command_metadata.json not found! Ignoring commands metadata file.</span><span id="efea" class="ma ig hi mr b fi mz mw l mx my">Jan 25, 2021 12:58:38 PM com.google.cloud.spanner.pgadapter.ProxyServer startServer</span><span id="f571" class="ma ig hi mr b fi mz mw l mx my"><strong class="mr hj">INFO:</strong> Server is starting on port 5434</span></pre><ul class=""><li id="14e0" class="kc kd hi jg b jh ke jl kf jp kg jt kh jx ki kb mp kk kl km bi translated">特此编写一个基本的Python代码，导入“google-cloud-spanner”和“psycopg 2”PostgreSQL数据库适配器，提供Python DB API 2.0的完整实现，并且仍然能够查询Google Cloud Spanner数据库。</li></ul><pre class="kw kx ky kz fd mq mr ms mt aw mu bi"><span id="7bbd" class="ma ig hi mr b fi mv mw l mx my">import psycopg2<br/>from google.cloud import spanner</span><span id="079c" class="ma ig hi mr b fi mz mw l mx my">conn = psycopg2.connect(<br/>       host = "127.0.0.1",<br/>       database = "sampledb",<br/>       port = 5434<br/>       )</span><span id="2794" class="ma ig hi mr b fi mz mw l mx my">cur = conn.cursor()<br/>cur.execute("Select id, author from stories limit 5")</span><span id="2254" class="ma ig hi mr b fi mz mw l mx my">rows = cur.fetchall()<br/>for r in rows:<br/>    print("ID: {}".format(r[0]))<br/>    print("Author Name: {} \n".format(r[1]))</span><span id="38c1" class="ma ig hi mr b fi mz mw l mx my">conn.commit()<br/>cur.close()<br/>conn.close()</span><span id="d415" class="ma ig hi mr b fi mz mw l mx my"><strong class="mr hj">&lt;&lt; OUTPUT &gt;&gt;</strong><br/><em class="lk">ID:400163<br/>Author Name:zsection</em></span><span id="24c9" class="ma ig hi mr b fi mz mw l mx my"><em class="lk">ID:6863703<br/>Author Name:zt</em></span><span id="8c5c" class="ma ig hi mr b fi mz mw l mx my"><em class="lk">ID:8085837<br/>Author Name:zt</em></span><span id="c6cf" class="ma ig hi mr b fi mz mw l mx my"><em class="lk">ID:6455532<br/>Author Name:zupancik</em></span><span id="87ae" class="ma ig hi mr b fi mz mw l mx my"><em class="lk">ID:6471689<br/>Author Name:zupancik</em></span></pre><h2 id="0799" class="ma ig hi bd ih mb mc md il me mf mg ip jp mh mi it jt mj mk ix jx ml mm jb mn bi translated"><a class="ae mo" href="https://cloud.google.com/spanner/docs/reference/libraries" rel="noopener ugc nofollow" target="_blank">云扳手客户端库</a></h2><p id="c780" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">此外，Google提供了对客户端库(基于gRPC)的广泛支持:C#、Go、Java、node.js、PHP、Python和Ruby。</p><h1 id="6706" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">总结</h1><p id="d1bf" class="pw-post-body-paragraph je jf hi jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hb bi translated">Google Cloud Spanner不仅仅是一个非常强大的关系数据库引擎，而且操作起来非常简单，只需要零到最小的应用程序重构。此外，Spanner已经在Google经过了实战检验，因此，Spanner是您下一个项目的绝佳选择的理由(双关语)也更加充分了。</p></div></div>    
</body>
</html>