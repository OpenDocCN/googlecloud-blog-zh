<html>
<head>
<title>JWT, Google Cloud API, NLP, Delphi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JWT，谷歌云API，自然语言处理，德尔福</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/jwt-google-cloud-api-nlp-delphi-c9f6073e127b?source=collection_archive---------1-----------------------#2018-05-31">https://medium.com/google-cloud/jwt-google-cloud-api-nlp-delphi-c9f6073e127b?source=collection_archive---------1-----------------------#2018-05-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f702" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗨！</p><p id="ab64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上周的<a class="ae jd" rel="noopener" href="/@Zawuza/media-hackday-2018-9c566ec7f4ce">黑客马拉松</a>上，我们试图建立一个文本处理的解决方案。这并没有发生，但我从Delphi学会了如何使用Google NLP API，我认为这值得分享。这些说明也适用于其他Google Cloud API，但不是全部，因为不同的API有不同的认证方法。</p><p id="e48b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，少说话，多编码！开始吧！</p><h2 id="d569" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">启用API</h2><p id="f694" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">首先，你需要注册一个谷歌云。这个过程我就不描述了，只有一点你需要知道，这需要你的信用卡。之后你应该在这里着陆:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ke"><img src="../Images/b93f76a527b51153f629c288fdb09766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5tcc41DGGtSWEGYenxNxYw.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">谷歌云控制台主页</figcaption></figure><p id="4532" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是点击“创建项目”。如你所见，我有一个叫做“默认”。让我们打开它，您将看到您的项目的仪表板:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ke"><img src="../Images/e0ad7dbb71c04c0fe6d83bdcbd6251a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_KNDaxHqzTd2Fe4V8qOpgQ.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">仪表盘</figcaption></figure><p id="d818" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在点击“转到API概述”:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ke"><img src="../Images/a54f365927d34b48cb13b4e48c98a793.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZJLvLXC-AoAqiL1ynj39Cw.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">API仪表板</figcaption></figure><p id="eec7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击“库”，找到“自然语言API”</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ke"><img src="../Images/ac5ca27d22843e3cdf6b4e72dc66c699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gkCa6DcGgK3iVLkA5g6p9A.png"/></div></div></figure><p id="ed4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在点击这个，然后点击“启用”按钮。注意:所有进一步的步骤都要花钱(但是如果你已经注册试用，你就有300美元的信用额度)</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ke"><img src="../Images/38ab5fffec63cedf0ebb45ab026c9a65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tAka-RQBf9TneW3YKVNyvw.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">e-e-e-能！</figcaption></figure><h2 id="ccb7" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">获取凭据</h2><p id="f308" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">在API dashboard中，单击“凭据”，然后单击“创建凭据”，并选择“服务帐户密钥”:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ke"><img src="../Images/accb16ec33e64d498aff5ef7a8c7d4ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MymWgxXr-2zhRQygHsRolQ.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">凭据视图</figcaption></figure><p id="3114" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">填写所有字段并选择“JSON”</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ke"><img src="../Images/396cc4c904af9b2c3557e81392ae8eed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3E_l5MWqRs2JVi21N6rnbg.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">我不确定“角色”框中应该有什么</figcaption></figure><p id="b50c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，您会得到一个JSON文件:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ku"><img src="../Images/81169118c0075f087a2423b2bea64a59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*btelE50t6UW9-UqX-otifA.png"/></div></div></figure><p id="d45b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个文件非常秘密，把它保存在没有人能找到的地方。</p><h2 id="6748" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">准备</h2><p id="855d" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">要创建JWT，您需要创建一个JSON Web签名，该签名可以使用RSA密钥创建。要获得正确的RSA密钥，您需要复制您的秘密JSON文件的值“private_key ”,并用换行符替换所有的“\n”。最后，您应该得到以下内容:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es kv"><img src="../Images/fea82f9887cceaed5522d8946a104d8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xz74mDykF-LHinolKrJ5VA.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">该键被禁用，但为了确保安全，我添加了一个黑色矩形</figcaption></figure><p id="b61e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你还需要两样东西:</p><ol class=""><li id="256b" class="kw kx hi ih b ii ij im in iq ky iu kz iy la jc lb lc ld le bi translated"><a class="ae jd" href="https://github.com/paolo-rossi/delphi-jose-jwt" rel="noopener ugc nofollow" target="_blank">德尔菲穆和JWT图书馆</a></li><li id="e0e7" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">OpenSSL动态链接库</li></ol><h2 id="2ae4" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">从Delphi调用API</h2><p id="52ad" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">现在我们准备调用NLP API。该过程有三个步骤:生成JWT、获取访问令牌和调用API。</p><p id="7081" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看第一步:</p><h2 id="0921" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">JWT一代</h2><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="3473" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，首先你需要创建一个有一些声明的JWT。声明只是一个“字段”,令牌中有一些数据，但有几个标准的声明，如作为属性实现的IssuedAt。但是也可以添加非标准权利要求。谷歌要求我们提供一些声明:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lm"><img src="../Images/84cacfac17d46c1ec4fb8d405a35e3c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-kJeK1hyueFj6FM3-66I8g.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">来源:<a class="ae jd" href="https://developers.google.com/identity/protocols/OAuth2ServiceAccount" rel="noopener ugc nofollow" target="_blank">谷歌API认证手册</a></figcaption></figure><p id="b1fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以从您的秘密JSON文件的“client_email”字段中获取您的客户端电子邮件地址:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es ln"><img src="../Images/58ac52492f6427cc9b8dedb58c9bdf26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*tbN8X7Cn1Dunckbc9NdvMQ.png"/></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">像这样</figcaption></figure><p id="04c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这段代码中，我们生成了一个半小时的令牌。</p><p id="f80e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们创建一个JSON Web签名，用我们在使用RSA256算法之前创建的RSA密钥对令牌进行签名，RSA 256算法是唯一可用于Google API认证的算法。</p><p id="22d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们有一个TJOSEBytes类型的LCompactedToken。</p><h2 id="248e" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">访问令牌请求</h2><p id="df87" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">让我们来看看这一步:</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="ec53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要将我们的JWT以申请表格式(在维基百科中有更多<a class="ae jd" href="https://en.wikipedia.org/wiki/POST_(HTTP)#Use_for_submitting_web_forms" rel="noopener ugc nofollow" target="_blank">)发送到一个预定义的地址，其中有两个字段:grant_type和我们的JWT断言。关于这方面的信息也可以在</a><a class="ae jd" href="https://developers.google.com/identity/protocols/OAuth2ServiceAccount" rel="noopener ugc nofollow" target="_blank">谷歌认证手册</a>中找到:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lo"><img src="../Images/8ebcaeb387559b57e92176ff82d7ebec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5yzsH9_JLs29hoO5U7OO-Q.png"/></div></div><figcaption class="kq kr et er es ks kt bd b be z dx translated">来自手动</figcaption></figure><p id="09fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们从响应中提取一个字段“access_key ”,它就是我们的访问键。</p><h2 id="6488" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">进行API调用</h2><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="706d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们可以使用API了。我们获得了一个访问令牌，需要将其添加到“授权”头中。所有其他事情只是请求结构的一部分。在这种情况下，我提取语法并分析句子“你好，我的名字是Elise”的情感，并将输出打印到控制台。关于谷歌云NLP的更多信息，你可以在它的<a class="ae jd" href="https://cloud.google.com/natural-language/docs/" rel="noopener ugc nofollow" target="_blank">文档</a>中找到。</p><p id="5d4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是一个演示的截图:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lp"><img src="../Images/e7312831cf9c8dce68950def86a71907.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xkx124l-7VvZrF5Hyi9jwg.png"/></div></div></figure><p id="cebb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在GitHub库中找到这个控制台应用程序，在你将你的密钥添加为“key.txt”并在代码中填写你的客户端电子邮件后，它应该会工作。这个演示有一些内存泄漏，写得很糟糕，但它只是从我的黑客马拉松代码的一部分构建的演示，所以不要复制粘贴:)</p><p id="0ff2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望，这篇文章能对某人有所帮助！今天就到这里:)</p><p id="1d83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">P.S .如果你知道某个框架让它变得更简单，请在评论中给我建议:)</p></div></div>    
</body>
</html>