<html>
<head>
<title>New Updates on Pub/Sub to BigQuery Dataflow Templates from GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">来自GCP的BigQuery数据流模板的发布/订阅的新更新</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/new-updates-to-pub-sub-to-bigquery-templates-7844444e6068?source=collection_archive---------1-----------------------#2019-04-18">https://medium.com/google-cloud/new-updates-to-pub-sub-to-bigquery-templates-7844444e6068?source=collection_archive---------1-----------------------#2019-04-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bb67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">作者:</strong></p><p id="3e4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们很高兴地宣布Cloud Pub/Sub to BigQuery模板的几个新特性，包括对订阅(！idspnonenote)的支持。！！)以及一些错误处理方面的改进。我们将在下面详细介绍这些更新。</p><h1 id="24ed" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">各位订阅！</h1><p id="68b5" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">过去，Pub/Sub to BigQuery数据流模板只支持使用参数<code class="du kh ki kj kk b">inputTopic</code>从Pub/Sub主题中读取消息。我们已经创建了第二个数据流模板，它使用参数<code class="du kh ki kj kk b">inputSubscription</code>从发布/订阅订阅中读取消息。我们在数据流控制台的<code class="du kh ki kj kk b">CREATE JOB FROM TEMPLATE</code>按钮下将这两个模板描述为“BigQuery的云发布/订阅”和“BigQuery的云发布/订阅主题”。生成这两个模板的代码也可以在<a class="ae jd" href="https://github.com/GoogleCloudPlatform/DataflowTemplates/blob/master/src/main/java/com/google/cloud/teleport/templates/PubSubToBigQuery.java" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。请注意，在主题上使用订阅的注意事项是，订阅只能读取一次，而主题可以读取多次。因此，订阅模板不能支持读取同一订阅的多个并发管道。</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kl"><img src="../Images/d2aac20ac988cb60b3d4af62fc104b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kwd4x_7KqkFK--1rPcjEvg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">大查询模板的发布/订阅现在在订阅和主题之间进行了描述</figcaption></figure><p id="0754" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从订阅或主题中读取消息后，其余的细节基本保持不变。</p><ol class=""><li id="395f" class="lb lc hi ih b ii ij im in iq ld iu le iy lf jc lg lh li lj bi translated">用户为输入消息指定一个现有的BigQuery表。这是使用<code class="du kh ki kj kk b">outputTableSpec</code>参数指定的。与所有管道一样，用户需要指定一个GCS桶位置来写入/暂存临时文件。</li><li id="8b00" class="lb lc hi ih b ii lk im ll iq lm iu ln iy lo jc lg lh li lj bi translated">(可选)如果用户希望在插入BigQuery之前对他或她的消息做进一步的修改，他或她可以在Google云存储中包含一个javascript转换文件。这可以使用参数- <code class="du kh ki kj kk b">javascriptTextTransformGCSPath</code>来指定。然后使用属性- <code class="du kh ki kj kk b">javascriptTextTransformFunctionName</code>指定JavaScript文件中的实际函数名。</li><li id="c6cf" class="lb lc hi ih b ii lk im ll iq lm iu ln iy lo jc lg lh li lj bi translated">死信BigQuery表是自动创建的，用于捕获由于各种原因失败的消息，这些原因包括:消息模式与BigQuery表模式不匹配、格式错误的JSON以及在通过JavaScript函数转换时抛出错误的消息。在我们最新的更新中，我们更有力地捕捉到了这样的错误——在过去，许多这样的错误会无休止地重试。用户也可以使用参数<code class="du kh ki kj kk b">outputDeadletterTable</code>指定他们自己的死信表(死信模式见<a class="ae jd" href="https://github.com/GoogleCloudPlatform/DataflowTemplates/blob/master/src/main/resources/schema/pubsubmessage_deadletter_table_schema.json" rel="noopener ugc nofollow" target="_blank"> Github </a>)。</li></ol><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es lp"><img src="../Images/6e0dfb0e1fb0061e89debbcfb3d3d51a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qQ5czelXjcPLXK4Mn49Lsw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">BigQuery数据流管道的PubSub订阅的示例模板设置，带有用于修改pub sub消息的可选javascript函数</figcaption></figure><h1 id="b428" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">未来数据流管道+功能</h1><p id="47ba" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我们的数据流模板可以在数据流用户界面上的<code class="du kh ki kj kk b">CREATE JOB FROM TEMPLATE</code>按钮下访问，或者可以在<a class="ae jd" href="https://github.com/GoogleCloudPlatform/DataflowTemplates/tree/master/src/main/java/com/google/cloud/teleport/templates" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到开源的模板，以便根据用户的需要进行进一步定制(参见此<a class="ae jd" href="https://github.com/GoogleCloudPlatform/DataflowTemplates/blob/master/src/main/java/com/google/cloud/teleport/templates/PubSubToBigQuery.java" rel="noopener ugc nofollow" target="_blank">链接</a>获取BigQuery代码的云发布订阅)。请关注GCP团队在数据流模板方面的进一步努力。</p></div></div>    
</body>
</html>