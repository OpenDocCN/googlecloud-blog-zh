<html>
<head>
<title>Cloud Connectivity | GCP and Azure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云连接| GCP和Azure</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/cloud-connectivity-gcp-and-azure-9b9727847fb3?source=collection_archive---------0-----------------------#2022-12-04">https://medium.com/google-cloud/cloud-connectivity-gcp-and-azure-9b9727847fb3?source=collection_archive---------0-----------------------#2022-12-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5fdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇博客文章中，让我们通过VPN配置谷歌云平台(GCP)和Azure之间的连接的详细步骤，以便您可以将您的工作负载从Azure迁移到GCP，或者跨两个平台运行多云工作负载。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/c5f748e14159db7b3adda99bf1bbdf53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*An1TePlLNbNbb5LXokoVfQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">GCP和Azure之间的站点到站点连接</figcaption></figure><h1 id="3213" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">开始之前</h1><ol class=""><li id="4531" class="kr ks hi ih b ii kt im ku iq kv iu kw iy kx jc ky kz la lb bi translated">一个Azure帐户，有一个活跃的订阅和一个关于GCP的项目。</li><li id="e9c5" class="kr ks hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">请确保您拥有必要的管理员角色，以按照这些链接执行以下活动:<a class="ae lh" href="https://cloud.google.com/iam/docs/job-functions/networking" rel="noopener ugc nofollow" target="_blank"> GCP </a>和<a class="ae lh" href="https://learn.microsoft.com/en-us/azure/role-based-access-control/overview" rel="noopener ugc nofollow" target="_blank"> Azure </a>。</li><li id="8e26" class="kr ks hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">VPC网络(Azure上的虚拟网络)和子网已经在GCP和Azure中创建。</li><li id="89f5" class="kr ks hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">在GCP上，必须为Azure和GCP之间的流量(入站和出站)添加防火墙规则。</li><li id="e90e" class="kr ks hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">在Azure上，应该为流量和子网传播配置安全组。</li><li id="965c" class="kr ks hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">VPN设备的面向外部的公共IPv4地址。</li></ol><h1 id="7fa0" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">拓扑学</h1><p id="4e52" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">这里有一个图表，展示了GCP和Azure之间的连接，以及使其工作的各种组件。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ll"><img src="../Images/6daa628cef149a1356692fe486a4bdfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-0XVeSgUFFuMafCgyQw6Dw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><strong class="bd jv">GCP和Azure之间的IPSec VPN隧道</strong></figcaption></figure><ul class=""><li id="ae71" class="kr ks hi ih b ii ij im in iq lm iu ln iy lo jc lp kz la lb bi translated"><strong class="ih hj">谷歌云VPC网络:</strong>单个谷歌云项目中的单个虚拟网络。</li><li id="7ab4" class="kr ks hi ih b ii lc im ld iq le iu lf iy lg jc lp kz la lb bi translated"><strong class="ih hj">外部IP地址或Google Cloud对等地址:</strong>对等VPN设备使用的外部IP地址，用于与Google Cloud建立HA VPN。外部IP地址是自动分配的，Google Cloud项目中的每个网关接口一个。</li><li id="b583" class="kr ks hi ih b ii lc im ld iq le iu lf iy lg jc lp kz la lb bi translated"><strong class="ih hj">动态路由:</strong>使用<a class="ae lh" href="https://wikipedia.org/wiki/Border_Gateway_Protocol" rel="noopener ugc nofollow" target="_blank">边界网关协议(BGP) </a>的谷歌云VPN动态路由。注意HA VPN只支持动态路由。</li><li id="3c01" class="kr ks hi ih b ii lc im ld iq le iu lf iy lg jc lp kz la lb bi translated"><strong class="ih hj"> HA VPN: </strong>这是一个高可用性云VPN，让我们能够通过IPsec VPN连接将内部网络安全地连接到我们在GCP的私有网络。</li><li id="b76c" class="kr ks hi ih b ii lc im ld iq le iu lf iy lg jc lp kz la lb bi translated"><strong class="ih hj">虚拟网络网关:</strong> Azure VPN网关提供客户场所和Azure之间的跨场所连接。我们部署我们的<a class="ae lh" href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways" rel="noopener ugc nofollow" target="_blank">虚拟网络网关</a>，它将用于创建到我们的Google环境的VPN隧道。这将被部署到“网关子网”</li><li id="9c7d" class="kr ks hi ih b ii lc im ld iq le iu lf iy lg jc lp kz la lb bi translated"><strong class="ih hj">站点到站点(IPsec): </strong>由“VPN网关”、“本地网关”和“连接”组成，允许通过公共互联网在Azure的VNet和内部位置之间发送加密流量。</li></ul><h2 id="bab4" class="lq ju hi bd jv lr ls lt jz lu lv lw kd iq lx ly kh iu lz ma kl iy mb mc kp md bi translated">把手放在某物或者某人身上</h2><p id="4486" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">现在让我们在两端实现VPN隧道。</p><ol class=""><li id="60b1" class="kr ks hi ih b ii ij im in iq lm iu ln iy lo jc ky kz la lb bi translated">登录到<a class="ae lh" href="https://portal.azure.com/" rel="noopener ugc nofollow" target="_blank"> Azure门户</a></li><li id="77a6" class="kr ks hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">创建虚拟网络网关</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es me"><img src="../Images/a54bc16465f29431bf798d5b3589ea2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Liiy9VS4fAg2JOfF6SvwdA.png"/></div></div></figure><p id="b606" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.接下来，我在GCP上创建一个VPN连接。首先，我选择VPN连接的类型为高可用性(HA)，</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mf"><img src="../Images/3a7b3724f483488d589c37ddff90b723.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kMXbnrPQ_lutKj9sCAbr_w.png"/></div></div></figure><p id="ad78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我创建一个云HA VPN网关。我提供了一个名称(gcp-vpn-gateway)、一个VPC (vpc-1)和一个地区(us-east1)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mg"><img src="../Images/108a99724ef8d45466aa512d45ff5cd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a3XHDqBJXupvvbg25ScROw.png"/></div></div></figure><p id="a491" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.创建VPN网关后，会为其分配两个公共IP地址。请记下IP，因为我们稍后会用到它们。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mh"><img src="../Images/b72885d42787f18492aab54fd1241134.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ijqg_ggNlup7toswg7Dt7g.png"/></div></div></figure><p id="f1d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.现在让我们创建对等配置。我选择<strong class="ih hj">添加对等VPN网关</strong>并选择一个接口。在对等VPN网关接口下，对于接口0的IP地址，我添加了之前创建的外部虚拟专用网关的IP地址。</p><p id="46d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mi">您可以按照相同的步骤添加额外的隧道以实现高可用性或增加容量。</em></p><p id="1c14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">创建对等VPN网关:</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mj"><img src="../Images/1bb354ebdd1450f6578e51c130f0c964.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y7U1DmWvgWAW9aJETE__xQ.png"/></div></div></figure><p id="6cb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.接下来，我选择添加VPN隧道并配置BGP会话。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mk"><img src="../Images/a243dabd207aa9403611e1824ddc35df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BsKzBTfOvBaEZ-BZg2tr2Q.png"/></div></div></figure><p id="1225" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.在GCP创建BGP会话</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ml"><img src="../Images/f1e79fcbb06323004605e962ba822eb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uYpq9spfiIIENpoSal7Bkg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mm"><img src="../Images/a478182846c015be3a205321daa6b33c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gvZ--OF7h_v_Iaqlv4o2PQ.png"/></div></div></figure><p id="e2d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.用GCP信息创建本地网关网络</p><p id="78bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用gcp信息创建了一个本地网络网关，我们可以为第二个本地网络网关重复相同的步骤，为第二个IP地址提供高可用性或额外的容量。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mn"><img src="../Images/ee4f33e93a3c607964a6c524ae8732b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x2SwfZe9oPAlAsW6L06VVA.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mo"><img src="../Images/3cab17f84ee13610aa3f704447c401a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*AotlF5h6TfOvLI-l-mJ8Vg.png"/></div></figure><p id="0bf9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.使用虚拟网络网关和本地网络网关创建连接</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mp"><img src="../Images/464d942304de1f4cebccbece8f89451e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ftHCkDCOCxP7sLc4_AhCyg.png"/></div></div></figure><p id="4227" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.验证连通性</p><p id="80a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此时，您的VPN连接应该显示一个状态为“已建立”的隧道，</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mq"><img src="../Images/aae95c9743d71575bb6edbe82e282b34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zJAYnPXpCy8UgBtiq7kSBA.png"/></div></div></figure><p id="d7c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">返回Azure并验证连接状态是否显示为已连接。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mr"><img src="../Images/e4b1c1666258b11952c22453eb50f9e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fu0aULZY2wKkpYkYWNiFiw.png"/></div></div></figure><h2 id="10a2" class="lq ju hi bd jv lr ls lt jz lu lv lw kd iq lx ly kh iu lz ma kl iy mb mc kp md bi translated"><strong class="ak">结论</strong></h2><p id="9e3b" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">在这篇博客中，我们了解了在Azure和GCP之间创建站点到站点VPN的先决条件。此外，我们还讨论了在Azure和GCP之间创建IPSec VPN隧道的详细步骤</p><h2 id="7e4b" class="lq ju hi bd jv lr ls lt jz lu lv lw kd iq lx ly kh iu lz ma kl iy mb mc kp md bi translated">最佳实践</h2><div class="ms mt ez fb mu mv"><a href="https://cloud.google.com/architecture/best-practices-vpc-design" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab dw"><div class="mx ab my cl cj mz"><h2 class="bd hj fi z dy na ea eb nb ed ef hh bi translated">VPC设计的最佳实践和参考架构|云架构中心|谷歌…</h2><div class="nc l"><h3 class="bd b fi z dy na ea eb nb ed ef dx translated">本指南介绍了虚拟私有云设计的最佳实践和典型企业架构…</h3></div><div class="nd l"><p class="bd b fp z dy na ea eb nb ed ef dx translated">cloud.google.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj jn mv"/></div></div></a></div><h2 id="0e47" class="lq ju hi bd jv lr ls lt jz lu lv lw kd iq lx ly kh iu lz ma kl iy mb mc kp md bi translated">限制</h2><div class="ms mt ez fb mu mv"><a href="https://cloud.google.com/network-connectivity/docs/vpn/quotas" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab dw"><div class="mx ab my cl cj mz"><h2 class="bd hj fi z dy na ea eb nb ed ef hh bi translated">配额和限制|云VPN |谷歌云</h2><div class="nc l"><h3 class="bd b fi z dy na ea eb nb ed ef dx translated">警告:某些经典VPN功能已被否决。有关更多信息，请参见经典VPN部分弃用…</h3></div><div class="nd l"><p class="bd b fp z dy na ea eb nb ed ef dx translated">cloud.google.com</p></div></div><div class="ne l"><div class="nk l ng nh ni ne nj jn mv"/></div></div></a></div><h2 id="825a" class="lq ju hi bd jv lr ls lt jz lu lv lw kd iq lx ly kh iu lz ma kl iy mb mc kp md bi translated">参考</h2><div class="ms mt ez fb mu mv"><a href="https://cloud.google.com/network-connectivity/docs/vpn/concepts/overview" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab dw"><div class="mx ab my cl cj mz"><h2 class="bd hj fi z dy na ea eb nb ed ef hh bi translated">云VPN概述|谷歌云</h2><div class="nc l"><h3 class="bd b fi z dy na ea eb nb ed ef dx translated">本页描述与Google Cloud VPN相关的概念。有关云VPN文档中使用的术语的定义，请参阅…</h3></div><div class="nd l"><p class="bd b fp z dy na ea eb nb ed ef dx translated">cloud.google.com</p></div></div><div class="ne l"><div class="nl l ng nh ni ne nj jn mv"/></div></div></a></div><div class="ms mt ez fb mu mv"><a href="https://cloud.google.com/network-connectivity/docs/vpn/how-to/configuring-peer-gateway" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab dw"><div class="mx ab my cl cj mz"><h2 class="bd hj fi z dy na ea eb nb ed ef hh bi translated">配置对等VPN网关|谷歌云</h2><div class="nc l"><h3 class="bd b fi z dy na ea eb nb ed ef dx translated">本页描述了完成VPN配置的步骤。要完成您的配置，请配置…</h3></div><div class="nd l"><p class="bd b fp z dy na ea eb nb ed ef dx translated">cloud.google.com</p></div></div><div class="ne l"><div class="nm l ng nh ni ne nj jn mv"/></div></div></a></div><div class="ms mt ez fb mu mv"><a href="https://learn.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab dw"><div class="mx ab my cl cj mz"><h2 class="bd hj fi z dy na ea eb nb ed ef hh bi translated">关于Azure VPN网关</h2><div class="nc l"><h3 class="bd b fi z dy na ea eb nb ed ef dx translated">VPN网关通过公共网络在Azure虚拟网络和本地位置之间发送加密流量…</h3></div><div class="nd l"><p class="bd b fp z dy na ea eb nb ed ef dx translated">learn.microsoft.com</p></div></div><div class="ne l"><div class="nn l ng nh ni ne nj jn mv"/></div></div></a></div></div></div>    
</body>
</html>