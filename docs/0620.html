<html>
<head>
<title>Service Accounts on Google Cloud Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云平台上的服务账户</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/service-accounts-on-google-cloud-platform-add6ab4ec4fe?source=collection_archive---------1-----------------------#2018-05-26">https://medium.com/google-cloud/service-accounts-on-google-cloud-platform-add6ab4ec4fe?source=collection_archive---------1-----------------------#2018-05-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5d2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我与客户一起工作时，经常会发生这样的情况，他们没有太多使用谷歌云平台的经验，即他们通常会注册和创建项目，将开发人员添加到项目中，但例如，如果他们想要给开发人员细粒度的访问权限，设置服务帐户就不那么简单了。所以在这篇文章中，我想给出一个关于服务账户的概述，这是谷歌云平台开发中经常使用的功能，它是为非开发人员编写的。</p><h1 id="e310" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">什么是服务帐户？</h1><p id="fac2" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">服务帐户类似于普通用户帐户，不同之处在于通常在访问GCP产品的代码中使用。正如用户可以有不同的角色一样，服务帐户也是如此。用于验证GCP的数据作为密钥(实际上是json或p12格式的文件)提供，然后可以在代码中使用。因此，当用户通过电子邮件和密码进行身份验证时，服务帐户通过密钥文件进行身份验证。因为它是文件，可以很容易地复制，共享等，你的项目的安全性可能会受到影响，所以要小心你的服务帐户文件存储在哪里，你如何共享它们，以及与你共享它们的人在哪里使用它们，我们是他们保存它们。</p><p id="2576" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">服务帐户管理属于IAM &amp; admin部分</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es kg"><img src="../Images/fdb5851f400a3d06c753490caaf74e7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*2pOWSgny9FpAxLIh.png"/></div></figure><h1 id="dbda" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">如何设置服务帐户</h1><p id="b327" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">这是服务帐户列表，如下图所示，有2个服务帐户，我们将创建一个新帐户，为此，请单击“创建服务帐户”按钮。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es ko"><img src="../Images/db0d63d3f3cab69164ec30b04bfca6df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/0*iXmIPrzwirq2ZeA5.png"/></div></figure><p id="0d34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在弹出窗口中，有一些东西需要设置:</p><p id="ea10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-服务帐户名称-这只是将显示的名称，因此请为其提供一些有意义的描述，尤其是如果您有多个帐户要轻松导航的话。在这种情况下，我假设想要创建一些脚本或服务，它们将在服务器上运行，并从第三方API获取数据，上传到云存储，然后上传到BigQuery。</p><p id="79f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-服务帐户ID-最初这是从服务帐户名称派生的，但如果您愿意，可以更改，从技术上讲，这并不重要。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es kp"><img src="../Images/d105aecca3d91b8570fa3f35d3b39f3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/0*b_z_KhKDOpJhKflr.png"/></div></figure><p id="074a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-角色-您可以在此为该服务帐户定义多个角色。在这个例子中，我将为BigQuery和云存储添加角色。自然，所有这些角色可能都不容易理解，我想最好的资源是这篇综合文章，其中解释了所有可能的角色<a class="ae kq" href="https://cloud.google.com/iam/docs/understanding-roles" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/iam/docs/understanding-roles</a>。</p><p id="64a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您点击选择一个角色字段时，将弹出一个小窗口，显示产品及其角色的列表。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es kp"><img src="../Images/617e8b7db211d7be67e88e1e242415be.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/0*E_Qw3JSlyS64HJ24.png"/></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es kp"><img src="../Images/99819f6fef835e18ce4ebd8cbf205ab8.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/0*poEMQ6cHpdpxxuBs.png"/></div></figure><p id="e8ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后一件事是检查选项提供一个新的私钥，当你点击保存按钮，json文件将被下载。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es kp"><img src="../Images/a53ae7c1ed67c6e37d0178e0578d2487.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/0*NGg4B2rPZvZ6e35h.png"/></div></figure><p id="466a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建后的消息。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es kp"><img src="../Images/1ed0f0f82ab1a2c39fad1d88bfea7204.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/0*MJplhT2vtI6PAciF.png"/></div></figure><p id="d92b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是服务帐户文件密钥的内容。</p><pre class="kh ki kj kk fd kr ks kt ku aw kv bi"><span id="9be6" class="kw je hi ks b fi kx ky l kz la">{<br/>  "type": "service_account",<br/>  "project_id": "just-some-project",<br/>  "private_key_id": "e5703451d59c7f1152517122a9e8824",<br/>  "private_key": "-----BEGIN PRIVATE KEY-----<br/>MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCgGPVstF25mezs<br/>SrIQ+jW0neRqEaCi3800d5Sm5F36cq2vTl9kFkahz4zmQiyNqgyBayQbipHJxVV0<br/>feI65nh+BXj4nX2ZC1vLGRIlcRwzauW/58wcMAtaTPRstXwk/LkJJURG1klSF+kD<br/>p3bD6VzpE5nJt396jy0g7q/Mlh/gGNzTS05BsWHl4+iurtlqCzB5XKiKpDlF9CC8<br/>sa/tAvex1mCuUgjZKcMMpqSOuVVFQeyk9xx6TO3GbQfYvHPwpZBrEY14Aplw2Ikg<br/>4qiQHBVSBACA9LHRTRHYGmwvrAYx7sWQk8WI9Q/oN5xzZOp5rrWJGl1XZxlryLKL<br/>tOTQPCFPAgMBAAECggEAB4t1kXRkkFkdLbuNbbhk7IieWZNQFyzl3kmeY0kS1rkt<br/>zzupyi00ke6WjMlkkR6I7VZvwq6ClVgr4UwHa9AtsH6wh0LgxuQepNEfJk2QzymD<br/>/0m8uD1ZY52JzU+2NIYGcFRlxdLWbLx8ujPbqHroaoGGd1ei9dMmhM1K0qDmiqh+<br/>L6xhEoujxySgYobDk5ZZt3EbG1N6N4D+C+/6mguakXKU2nl7kyEGngykOij67L+C<br/>nnK/4R4HHUNU5YOTriq+7WYNwMOzHrVT5z41+0yG3FJvIZ0Iy57x5RNw5xVHoYNn<br/>iX8m7jLQ/ByHCeJ9HcqUdIj3ovkvtTS2zsozaCiVHQKBgQDVsKwBp8KbgaC9xluY<br/>NuN88t/m6SPvBn9k4xaLnvQkjCO/LKOlRsxSPzmxzTc7lOocVXsr7IyzoDH4QMpo<br/>yjbajjqvcUG2L2oE1iG9nKLtTC2iaeR/OPJRRagvPhgPe8cskqy/I60tlfvgr7kB<br/>zRftCcJXTI3J94gFzd0tnEB9awKBgQC/y9U9MLrm0aQk9+VWJDMn9X0/6qSXaxRK<br/>DOlijUjWSvGPOZ+hetueDZnZyBSjuFjcX8hV2qMn2TDPnd/KxGxhuB8Xe6ExTWnT<br/>B6SHT3BpG6+4u9atuoSUY6AYGbFCP2v7jf2FTPXoAn<br/>C2Z+XuND4t7wlxxIDxRzaBx95wwmEkrm0A2uNcpy1z2kPYGKS/U8blnGC8ie7anT<br/>g89mor9s2Vkno6rJ+r0nOtzy<br/>-----END PRIVATE KEY-----<br/>",<br/>  "client_email": "data-ingestion-pipeline@756.iam.gserviceaccount.com",<br/>  "client_id": "109097848740185",<br/>  "auth_uri": "https://accounts.google.com/o/oauth2/auth",<br/>  "token_uri": "https://accounts.google.com/o/oauth2/token",<br/>  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",<br/>  "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/data-ingestion-pipeline%40r756.iam.gserviceaccount.com"<br/>}</span></pre><p id="981a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我前面所写的，下载的文件在客户端库中用于访问GCP服务。当然，最重要的是保证该文件的安全，因为任何获得该文件的人都可以根据授予该服务帐户的权限和角色访问您的GCP产品或访问数据。</p><h1 id="e047" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">服务帐户的常见操作</h1><p id="2ffa" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">在服务帐户列表中。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es ko"><img src="../Images/9f343b678c4c1708409966911e17a9fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/0*IWVSlK8tTMsZw4ok.png"/></div></figure><p id="599b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你点击设置，你可以选择编辑，删除和创建密钥</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es lb"><img src="../Images/05e28683af46ddb0bfeb7eaa539cd527.png" data-original-src="https://miro.medium.com/v2/resize:fit:396/format:webp/0*fVeldZvqjnlsiWfu.png"/></div></figure><p id="624b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">编辑</strong> —为您提供更改服务帐户描述的可能性</p><p id="208f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">删除</strong> —删除服务账号</p><p id="cf1b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">创建密钥</strong> —这提供了新的密钥/文件。这意味着一个服务帐户可以有多个密钥/文件。点击垃圾桶，你可以删除它们。如果您认为密钥/文件已经泄露，这是您应该做的第一件事。</p><p id="4648" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其他常见的事情是修改为服务帐户分配的角色。</p><p id="3c6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您转到IAM部分时，您将看到帐户列表，包括用户和服务帐户。现在，根据屏幕分辨率，您可能需要向右移动底部的滑块，以进入选项:)。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es ko"><img src="../Images/40a5a9c8c95390688226aae4d443b933.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/0*jkSBZ9eThJcfp50B.png"/></div></figure><p id="630a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以看到分配的角色以及编辑或删除角色的选项。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es lc"><img src="../Images/53890aec4a55fda21f62e5dfde8b4df7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/0*3K7zsiH6Qt7e2PDi.png"/></div></figure><p id="78c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您点击笔(编辑)时，您可以删除、更改或添加与创建时类似的角色。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es ld"><img src="../Images/a4a097ed55025f5803a1aa829e779955.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/0*ahFaYb_xA4X__hA0.png"/></div></figure><p id="ed8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想在此介绍的服务帐户的最后一个功能是分配对服务帐户的访问权限。基本上，当您创建服务帐户时，您可以为一个或多个用户帐户分配访问权限。使用此功能，您可以有选择地授予开发人员对服务帐户的访问权限，而无需授予他们对所有帐户的一般访问权限。当他们有权访问服务帐户时，他们可以修改它、更改角色等。</p><p id="67cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要将用户分配到服务帐户，请转到服务帐户列表，选中您要分配访问权限服务帐户，然后单击右上角显示信息面板。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es ko"><img src="../Images/17206873f7c58ae8e69d5ef5cba849ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/0*L1DIXF9H5AdTb-me.png"/></div></figure><p id="4399" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在分配用户的弹出窗口中，您需要输入用户的电子邮件(您还需要单击它)并选择一个或多个角色。这里只有3组角色:项目、服务帐户和IAM，选择后，它们将仅应用于此服务帐户，而不是整个项目。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es le"><img src="../Images/b45d3a8218ba3e49efa164cf0b5ffe2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/0*h5mPp_5HL-7uXOu2.png"/></div></figure><p id="1778" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加后，您可以在角色下看到分组的成员。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es lf"><img src="../Images/f4fecf7870186c9c9eff8197451a1a2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/0*6szdYhu7asShUSIN.png"/></div></figure><p id="e3f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您切换“显示继承的权限”时，您还可以看到继承的权限，即具有隐式访问此服务帐户的角色的成员。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es lg"><img src="../Images/3ffbf625a04211f1a57286088584e967.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/0*9zSSeJXch9-78JPg.png"/></div></figure><p id="4d33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这篇文章能让你更清楚地了解什么是服务账户以及如何处理它们。</p><p id="4fce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我正在策划关于谷歌云平台<a class="ae kq" href="https://www.gcpweekly.com/" rel="noopener ugc nofollow" target="_blank">https://www.gcpweekly.com/</a>的每周时事通讯。如果您想在每周一收到与GCP相关的新闻和文章，请订阅。</p></div></div>    
</body>
</html>