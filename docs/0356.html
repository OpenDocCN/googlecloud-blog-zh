<html>
<head>
<title>Creating a GCP type provider in 6 ( well 7) easy steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过6个简单的步骤创建GCP类型的提供者</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/creating-a-gcp-type-provider-in-6-well-7-easy-steps-19e6c59e1ae8?source=collection_archive---------0-----------------------#2017-08-12">https://medium.com/google-cloud/creating-a-gcp-type-provider-in-6-well-7-easy-steps-19e6c59e1ae8?source=collection_archive---------0-----------------------#2017-08-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="0f34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你使用GCP的部署管理器，你可能已经意识到或者没有意识到你可以通过创建一个类型提供者来扩展APi。</p><p id="32d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">类型提供者(引用足够简洁的文档)向部署管理器公开第三方API的所有资源，作为您可以在配置中使用的基本类型。</p><p id="799d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注册和使用类型提供者的步骤相当简单，因为我自己有理由这样做，所以我想我应该在这里记下这些步骤。</p><ol class=""><li id="985f" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">首先声明你的类型。</li></ol><ul class=""><li id="9307" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc jm jj jk jl bi translated">类型是支持CRUD方法的API。</li><li id="0aca" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc jm jj jk jl bi translated">你的API必须有一个描述你的API的文档。部署管理器支持<a class="ae js" href="https://github.com/OAI/OpenAPI-Specification" rel="noopener ugc nofollow" target="_blank"> OpenAPI规范</a> v 1.2和2.0或<a class="ae js" href="https://developers.google.com/discovery/v1/reference/apis" rel="noopener ugc nofollow" target="_blank"> Google Discovery </a>文档。</li></ul><p id="46ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.让您的API可以通过公共端点访问。允许你在GCP建立你的API的GCP服务是<a class="ae js" href="https://cloud.google.com/endpoints/docs/" rel="noopener ugc nofollow" target="_blank">云端点</a>和<a class="ae js" href="https://cloud.google.com/apigee-api-management/" rel="noopener ugc nofollow" target="_blank"> Apigee </a></p><p id="283d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.如果您的API需要认证，请阅读部署管理器文档的这一节</p><p id="d08b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.测试时使用<a class="ae js" href="https://cloud.google.com/sdk" rel="noopener ugc nofollow" target="_blank">g cloud CLI</a>——所以要确保设置好了</p><p id="eff0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.为您的提供商选择一个<a class="ae js" href="https://cloud.google.com/deployment-manager/docs/configuration/type-providers/creating-type-provider#name" rel="noopener ugc nofollow" target="_blank">名称</a></p><p id="779f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.现在，您有了名称、描述符文档和任何身份验证细节，创建了您的类型提供者</p><p id="2eda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的例子中，我将在我的一个项目中使用一个现有的Google API来创建一个类型提供者。为什么？他们已经建立了API，这篇文章是关于类型提供者的！总有一天我会回来，另一次我会谈论我在云端点上的冒险经历，我不想让这篇文章脱轨！</p><p id="8a69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，在计算引擎上选择发现文档的位置可以在这里找到<a class="ae js" href="https://content.googleapis.com/discovery/v1/apis/" rel="noopener ugc nofollow" target="_blank">和</a></p><p id="881a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将使用的发现文档的URl是:</p><p id="afd4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae js" href="https://www.googleapis.com/discovery/v1/apis/compute/beta/rest" rel="noopener ugc nofollow" target="_blank">https://www . Google APIs . com/discovery/v1/APIs/compute/beta/rest</a></p><p id="8e47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实际上，在最初尝试时，我遇到了一些语法相关的问题，在调试时，我发现了<a class="ae js" href="https://developers.google.com/discovery/v1/reference/apis/getRest" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/discovery/v1/reference/APIs/getRest</a>，这是一个很好的页面，可以让您检索特定版本的Google API。我喜欢它，所以我把它留在这里让你开心。</p><p id="fc51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为什么不看看这个在你做的时候还在这里😀</p><p id="810b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将使用gcloud CLI，因为我已经通过了身份验证，所以不需要担心身份验证部分。(我喜欢gcloud命令，它让事情变得如此简单)</p><p id="9a8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将调用我的类型提供者<strong class="ih hj"> <em class="jt">我的计算类型</em> </strong></p><p id="ad17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将在我的项目<strong class="ih hj"> <em class="jt"> sharedresources </em> </strong>中注册它，因此我使用gcloud命令将我的工作项目设置为:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="9945" class="kd ke hi jz b fi kf kg l kh ki">$ gcloud config set project sharedresources</span></pre><p id="93c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注册我的类型提供程序:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="e0ae" class="kd ke hi jz b fi kf kg l kh ki">$ gcloud alpha deployment-manager type-providers create my-compute-type --api-options-file=config.yaml <!-- -->descriptor-url=’https://www.googleapis.com/discovery/v1/apis/compute/beta/rest'</span></pre><p id="6119" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(我使用的api-options-file将一些输入映射映射到路径参数)</p><p id="d2e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我已经创建了一个类型提供者，我该如何使用它呢？</p><p id="bfa8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就像对待任何其他类型一样，但有一点要注意！</p><p id="df05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您很可能希望与其他项目共享您的新类型，因此要做到这一点，您需要确保希望使用该类型的项目的<a class="ae js" href="https://cloud.google.com/deployment-manager/docs/access-control#access_control_for_deployment_manager" rel="noopener ugc nofollow" target="_blank">Google API服务帐户</a>被授予该类型已注册的项目的<strong class="ih hj"><em class="jt">deployment manager . type viewer</em></strong>role<strong class="ih hj"><em class="jt"/></strong></p><p id="c8e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是第七步</p><p id="467b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，您需要登录到控制台，确保您位于注册了该类型的项目中。所以在我的例子中，这个项目共享资源。导航到IAM菜单，为将调用该类型的项目添加<a class="ae js" href="https://cloud.google.com/deployment-manager/docs/access-control#access_control_for_deployment_manager" rel="noopener ugc nofollow" target="_blank">Google API服务帐户</a>，并授予它<strong class="ih hj"><em class="jt">deployment manager . type viewer</em></strong>角色(这可以在other下找到)</p><p id="be9e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，这有点麻烦，不太容易扩展，所以在我的<a class="ae js" href="https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy#organizations" rel="noopener ugc nofollow" target="_blank"> GCP组织</a>中，我实际上有以下项目配置</p><figure class="ju jv jw jx fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kj"><img src="../Images/777e06de3655a7a9675b74d7a16ee921.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aqTMJ8Mv3ZLwfLyW."/></div></div></figure><p id="8484" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">属于projectcreation项目的<a class="ae js" href="https://cloud.google.com/deployment-manager/docs/access-control#access_control_for_deployment_manager" rel="noopener ugc nofollow" target="_blank">Google API服务帐户</a>已经被授予组织级别的部署管理器类型查看者角色。这就是为什么我不需要在每个项目上明确地授予它这个权限，它需要通过一个部署管理配置来部署资源，因为这个权限是继承的。</p><figure class="ju jv jw jx fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kr"><img src="../Images/bb3365326566e2ee9a637396fc85ccaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VyA4fdHyHQDjEbo5v5imfA.png"/></div></div></figure><p id="1d42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建一个调用新注册类型的配置。因此，在我的示例中，我的YAML配置如下所示:</p><figure class="ju jv jw jx fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kr"><img src="../Images/fc8df35d27cabd82c1765a6f878b6fe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3Y2O93tFUAWw143L."/></div></div></figure><p id="9db2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(ps。你真的应该使用python，但YAML更清楚地看到配置的突出部分)</p><p id="a72f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了部署我的配置，我使用以下命令</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="7731" class="kd ke hi jz b fi kf kg l kh ki">gcloud deployment-manager deployments create my-demo-project-instance --config=my-instance-config.yaml</span></pre><p id="6b5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将在我的<strong class="ih hj"> <em class="jt">项目中创建部署创建</em> </strong>项目。部署中声明的资源在本例中是在<strong class="ih hj"> <em class="jt"> targetproject </em> </strong>项目中创建的实例(确保服务帐户有创建实例的权限)</p><figure class="ju jv jw jx fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es ks"><img src="../Images/f258d663abd9ac77193da3cb94367299.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JA3uSSnxe6OT4pHF."/></div></div></figure><p id="04ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你知道了。</p><p id="ce72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我结束之前:</p><p id="295a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设您已经对部署管理器有了基本的了解，那么您真的需要阅读5页文档:</p><p id="92f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae js" href="https://cloud.google.com/deployment-manager/docs/configuration/type-providers/creating-type-provider" rel="noopener ugc nofollow" target="_blank">添加API作为类型提供者</a></p><p id="d51e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae js" href="https://cloud.google.com/deployment-manager/docs/configuration/type-providers/calling-type-provider" rel="noopener ugc nofollow" target="_blank">在配置中调用类型提供者</a></p><p id="3df4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae js" href="https://cloud.google.com/deployment-manager/docs/configuration/sharing-types-across-projects" rel="noopener ugc nofollow" target="_blank">跨项目共享类型</a></p><p id="c034" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae js" href="https://cloud.google.com/deployment-manager/docs/configuration/type-providers/process-adding-api" rel="noopener ugc nofollow" target="_blank">一个用于添加API的分页器</a></p><p id="a226" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和<a class="ae js" href="https://cloud.google.com/deployment-manager/docs/configuration/type-providers/best-practices-api" rel="noopener ugc nofollow" target="_blank">添加类型提供者的最佳实践</a></p><p id="7dd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我还想对部署管理团队中的Adam &amp; Kyle说几句话😀谢谢你的帮助，让这个工作如我所愿。</p></div></div>    
</body>
</html>