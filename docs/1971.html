<html>
<head>
<title>Kaniko and Google Container Registry without gcloud sdk and Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">没有gcloud sdk和Docker的Kaniko和Google容器注册表</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/kaniko-and-google-container-registry-without-gcloud-sdk-and-docker-1e1799ccef85?source=collection_archive---------0-----------------------#2021-09-29">https://medium.com/google-cloud/kaniko-and-google-container-registry-without-gcloud-sdk-and-docker-1e1799ccef85?source=collection_archive---------0-----------------------#2021-09-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="63ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天我面临着一个挑战，我们在一个运行在<a class="ae jd" href="https://cloud.google.com/run" rel="noopener ugc nofollow" target="_blank"> Cloud Run </a>上的小型微服务上为Google Cloud的IAM创建了一个访问令牌。用例是一个小的令牌交换服务，它允许从一个应用程序交换一个令牌来交换一个IAM访问令牌。</p><p id="be4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一步中，我想在我们的<a class="ae jd" href="https://github.com/GoogleContainerTools/kaniko" rel="noopener ugc nofollow" target="_blank"> Kaniko </a>构建中使用这个令牌将一个Docker映像推送到我的项目的<a class="ae jd" href="https://cloud.google.com/container-registry" rel="noopener ugc nofollow" target="_blank">容器注册表</a>中。但是我如何向Kaniko提供访问令牌呢？由于我在其上运行构建的构建代理没有安装Docker，这个问题变得更加糟糕。</p><p id="c781" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通常我会调用gcloud auth configure-docker。但是由于gcloud目前不支持直接提供访问令牌，所以我必须想出另一种方法来实现我的目标。</p><p id="c4fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以我构建了一个小的变通脚本，它创建了一个直接包含访问令牌的Docker配置，而不需要调用<code class="du je jf jg jh b">gcloud auth configure-docker.</code><br/>。GCR服务期望在<strong class="ih hj">授权</strong>头中提供的用户名和密码组合包含作为用户名的gclouddockertoken和作为密码的访问令牌。下面的脚本获取这些参数，base64对它们进行编码，并将配置直接写入到<code class="du je jf jg jh b">˜/.docker/config.json</code>中。</p><figure class="ji jj jk jl fd jm"><div class="bz dy l di"><div class="jn jo l"/></div></figure><p id="78bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成后，通过这个小的变通方法，您可以使用自己的令牌针对GCR进行身份验证，而不需要安装Docker CLI或Docker守护程序。<br/>这种方法应该适用于Docker生态系统中依赖于config.json中的访问配置的许多工具。</p></div></div>    
</body>
</html>