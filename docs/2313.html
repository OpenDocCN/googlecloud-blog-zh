<html>
<head>
<title>Running Eclipse HONO and Ditto on Google Cloud (1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在谷歌云上运行Eclipse HONO和Ditto)</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/running-eclipse-hono-and-ditto-on-google-cloud-1-d47504fecc7?source=collection_archive---------2-----------------------#2022-08-20">https://medium.com/google-cloud/running-eclipse-hono-and-ditto-on-google-cloud-1-d47504fecc7?source=collection_archive---------2-----------------------#2022-08-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1873" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Eclipse <a class="ae jd" href="https://www.eclipse.org/hono/" rel="noopener ugc nofollow" target="_blank"> HONO </a>是一个开源的物联网后端，它将大量的物联网设备连接到后端。Eclipse <a class="ae jd" href="https://www.eclipse.org/ditto/" rel="noopener ugc nofollow" target="_blank"> Ditto </a>是一个开源的数字双胞胎服务。将Eclipse HONO和Ditto连接在一起有助于为物联网应用提供端到端的设备云通信。</p><p id="a74e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个博客系列是为了记录我在配置和运行Eclipse HONO和Google Cloud时的心得。最终目标是</p><ul class=""><li id="5a2b" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">让一个设备模拟器向Eclipse HONO发送遥测数据，并通过简单的配置将它们接收到Google云服务中。</li><li id="e803" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">允许设备从云中接收命令并做出响应。</li><li id="8d20" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">研究如何安全地集成Eclipse Ditto和Google Cloud。</li></ul><p id="dd58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇博客假设你有一个计费启用谷歌云项目，并熟悉云壳。以下命令在云壳中执行。</p><h1 id="22c5" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">创建一个VPC网络</h1><p id="03fc" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">首先创建一个自动模式的VPC网络来运行我们的Eclipse集群。我还创建了默认的防火墙规则，允许来自外部的SSH/ICMP流量进行测试。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="18b2" class="le jt hi la b fi lf lg l lh li">export PROJECT_ID=&lt;YOUR PROJECT ID&gt;<br/>export VPC_NAME=eclipse-vpc<br/>gcloud compute networks create $VPC_NAME — project=$PROJECT_ID — subnet-mode=auto — mtu=1460 — bgp-routing-mode=regional</span><span id="5bc2" class="le jt hi la b fi lj lg l lh li">gcloud compute firewall-rules create ${VPC_NAME}-allow-custom \<br/>--project=${PROJECT_ID} \<br/>--network=projects/${PROJECT_ID}/global/networks/${VPC_NAME} \<br/>--direction=INGRESS — priority=65534 \<br/>--source-ranges=10.128.0.0/9 — action=ALLOW — rules=all</span><span id="811b" class="le jt hi la b fi lj lg l lh li">gcloud compute firewall-rules create ${VPC_NAME}-allow-icmp \<br/>--project=${PROJECT_ID} \<br/>--network=projects/${PROJECT_ID}/global/networks/${VPC_NAME} \<br/>--direction=INGRESS — priority=65534 \<br/>--source-ranges=0.0.0.0/0 — action=ALLOW — rules=icmp</span><span id="5c79" class="le jt hi la b fi lj lg l lh li">gcloud compute firewall-rules create ${VPC_NAME}-allow-ssh \<br/>--project=${PROJECT_ID} \<br/>--network=projects/${PROJECT_ID}/global/networks/${VPC_NAME} \<br/>--direction=INGRESS — priority=65534 \<br/>--source-ranges=0.0.0.0/0 — action=ALLOW — rules=tcp:22</span></pre><p id="cbbe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将创建一个私有的GKE集群，为了允许集群与互联网对话，以便它可以从DockerHub等外部容器注册表中提取映像，我需要在VPC创建一个云NAT和云路由器。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="0cdf" class="le jt hi la b fi lf lg l lh li">export ROUTER_NAME=eclipse-router<br/>export NAT_NAME=eclipse-nat<br/>export VPC_NAME=eclipse-vpc</span><span id="d9d4" class="le jt hi la b fi lj lg l lh li">gcloud compute routers create ${ROUTER_NAME} \<br/>--project=${PROJECT_ID} — region=asia-east1 \<br/>--network=${VPC_NAME}</span><span id="2a6d" class="le jt hi la b fi lj lg l lh li">gcloud compute routers nats create ${NAT_NAME} \<br/>--router=${ROUTER_NAME} \<br/>--auto-allocate-nat-external-ips \<br/>--nat-all-subnet-ip-ranges \<br/>--enable-logging — region asia-east1 — project ${PROJECT_ID}</span></pre><h1 id="8642" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">创建GKE集群</h1><p id="4f30" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">在这里，我启用了集群自动扩展和节点自动配置，以允许GKE集群在需要时进行横向扩展。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="28c2" class="le jt hi la b fi lf lg l lh li">gcloud beta container — project ${PROJECT_ID} clusters create “eclipse-cluster” \<br/>--zone “asia-east1-a” \<br/>--machine-type “e2-standard-4” \<br/>--image-type “COS_CONTAINERD” \<br/>--disk-type “pd-standard” — disk-size “500” \<br/>--scopes "https://www.googleapis.com/auth/cloud-platform" \<br/>--logging=SYSTEM,WORKLOAD — monitoring=SYSTEM \<br/>--enable-private-nodes \<br/>--master-ipv4-cidr “172.16.200.0/28” \<br/>--enable-master-global-access \<br/>--enable-ip-alias --network “projects/${PROJECT_ID}/global/networks/${VPC_NAME}” \<br/>--subnetwork “projects/${PROJECT_ID}/regions/asia-east1/subnetworks/${VPC_NAME}” \<br/>--no-enable-master-authorized-networks \<br/>--addons HorizontalPodAutoscaling,HttpLoadBalancing,GcePersistentDiskCsiDriver \<br/>--enable-autoprovisioning \<br/>--min-cpu 1 — max-cpu 64 \<br/>--min-memory 1 — max-memory 512 \<br/>--autoprovisioning-scopes=https://www.googleapis.com/auth/cloud-platform \<br/>--enable-autoprovisioning-autorepair \<br/>--enable-autoprovisioning-autoupgrade — autoprovisioning-max-surge-upgrade 1 — autoprovisioning-max-unavailable-upgrade 0 \<br/>--enable-vertical-pod-autoscaling \<br/>--enable-shielded-nodes \<br/>--tags “http-server”,”https-server” \<br/>--node-locations “asia-east1-a”</span></pre><h1 id="12d1" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">设置Eclipse HONO和同上</h1><p id="380f" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">既然我们已经准备好并运行了GKE，我们可以安装并设置Eclipse HONO和同上。</p><p id="b8e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先连接到新创建的GKE集群。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="cb00" class="le jt hi la b fi lf lg l lh li">gcloud container clusters get-credentials eclipse-cluster — zone asia-east1-a — project ${PROJECT_ID}</span></pre><p id="abf4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按照<a class="ae jd" href="https://www.eclipse.org/packages/packages/cloud2edge/installation/" rel="noopener ugc nofollow" target="_blank">本安装指南</a>安装HONO，同上</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="484a" class="le jt hi la b fi lf lg l lh li">NS=cloud2edge<br/>RELEASE=c2e<br/>kubectl create namespace $NS</span><span id="a06c" class="le jt hi la b fi lj lg l lh li">helm install -n $NS --wait --timeout 15m --set hono.useLoadBalancer=true --set ditto.nginx.service.type=LoadBalancer \<br/>$RELEASE eclipse-iot/cloud2edge</span></pre><p id="cf24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">等待安装完成，您应该会看到类似的输出。</p><figure class="kv kw kx ky fd ll er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lk"><img src="../Images/beca8557f5aadbc976760fcbb4bc87e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X27R-NO6ZmEIXTcH"/></div></div></figure><p id="994c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经准备好了GKE集群，在下一集里，我将在HONO和Ditto之间建立连接，并在一个HONO租户中创建一个设备来验证HONO和Ditto之间的集成。</p><p id="c13c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" rel="noopener" href="/google-cloud/running-eclipse-hono-and-ditto-on-google-cloud-2-3e8ad69efeb7">第二部分</a></p></div></div>    
</body>
</html>