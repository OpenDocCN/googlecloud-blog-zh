<html>
<head>
<title>How to configure autoscaling — Google Compute Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何配置自动缩放— Google计算引擎</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-configure-autoscaling-google-compute-engine-f3ae932fe0f9?source=collection_archive---------0-----------------------#2016-02-07">https://medium.com/google-cloud/how-to-configure-autoscaling-google-compute-engine-f3ae932fe0f9?source=collection_archive---------0-----------------------#2016-02-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9dd0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">作者:</em><a class="ae je" href="https://www.linkedin.com/in/manoj7city" rel="noopener ugc nofollow" target="_blank"><em class="jd">Manoj Kumar</em></a><em class="jd">，Powerupcloud首席云架构师。最初发表于2016年2月7日blog.powerupcloud.com</em><em class="jd"/><a class="ae je" href="http://blog.powerupcloud.com/2016/02/07/how-to-configure-autoscaling-google-compute-engine/" rel="noopener ugc nofollow" target="_blank"><em class="jd">。</em></a></p></div><div class="ab cl jf jg gp jh" role="separator"><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk jl"/><span class="ji bw bk jj jk"/></div><div class="hb hc hd he hf"><p id="fafb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们<a class="ae je" href="http://blog.powerupcloud.com/2015/09/03/gohf_case_study/" rel="noopener ugc nofollow" target="_blank">在Google Cloud上管理一个巨大的活动网站</a>时，我们必须确保web层能够自动扩展，以承受twitter和电视频道等营销活动导致的流量突然激增。AWS自动缩放的分步指南多如牛毛，但我们找不到类似的谷歌云文章。但是谷歌云的<a class="ae je" href="https://cloud.google.com/docs/" rel="noopener ugc nofollow" target="_blank">文档</a>非常棒，仅次于AWS。因为我们已经为一个繁忙的网站配置了自动缩放，并且已经看到了它的运行，我们认为记录它将有助于将来的某个人。接下来是一系列带有最小注释的截图，解释了如何在Google cloud中配置autoscaling。</p><h2 id="f0bb" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">为图像准备一个实例</h2><p id="1b63" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated"><a class="ae je" href="https://cloud.google.com/compute/docs/autoscaler/" rel="noopener ugc nofollow" target="_blank"> Autoscaler </a>需要一个可用的映像，当满足某些条件时，它可以从该映像中动态旋转实例。在这个例子中，我们将考虑一个简单的Apache/PHP服务器进行自动缩放，并相应地准备一个映像。</p><ul class=""><li id="f4fc" class="km kn hi ih b ii ij im in iq ko iu kp iy kq jc kr ks kt ku bi translated">启动您偏好的实例类型</li><li id="630c" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">安装Apache、PHP和其他必要的包</li><li id="c025" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">部署代码并测试它是否工作</li><li id="4058" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">如果需要实例在启动期间执行某些任务，请添加启动脚本。例如，您可能希望从git存储库中获取最新的代码，并在启动时进行部署。</li></ul><p id="4775" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦所有这些都做了，去实例设置和禁用删除启动盘选项时，实例被删除。是的，我们将删除这个实例，并用它制作一个图像。</p><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es la"><img src="../Images/b467ccdaf3b01caaedd6e236afe8d45d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QJXnrAp9WZmKe_48.png"/></div></div></figure><p id="6d7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在删除该实例，但不删除为其提供动力的引导磁盘。</p><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lm"><img src="../Images/829201aa05e1dc92a10e67bccbbb4215.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2IfQUwcqhKxaVL8S.png"/></div></div></figure><p id="dea3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从这个磁盘创建一个新映像。</p><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ln"><img src="../Images/2e71bc5d2a8a8d3fe3e954e5dbaf3857.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*L3ylsphQOFaymYCJ.png"/></div></div></figure><p id="17aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查图像是否已创建。</p><figure class="lb lc ld le fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es la"><img src="../Images/3b6ab51a1fdce1e9bc37cfb002fffa29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZQkzCYPtyaoJRa0n.png"/></div></div></figure><h2 id="252e" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">创建实例模板</h2><p id="0c42" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">到目前为止，我们有一个引导盘，从中我们可以旋转实例，但谷歌云不知道你想旋转什么样的实例。什么尺寸，什么型号？这就是实例模板介入的地方。我们需要根据需要创建一个实例模板。</p><p id="35e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在GCE控制台中，转到<a class="ae je" href="https://console.cloud.google.com/project/_/compute/instanceTemplates/list?_ga=1.17308798.637619450.1440397583" rel="noopener ugc nofollow" target="_blank">实例模板</a>页面。单击创建新的实例模板。为例程模板填充以下信息:</p><ul class=""><li id="f441" class="km kn hi ih b ii ij im in iq ko iu kp iy kq jc kr ks kt ku bi translated">名字</li><li id="ba5d" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">机器类型</li><li id="2df6" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">引导磁盘(这是我们在上一步中创建的磁盘)</li><li id="6e2c" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">允许通行。HTTP/HTTPS或者别的什么，根据你的需要。</li><li id="22bf" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">如果您想与其他Google云服务通信，请允许API访问</li><li id="8661" class="km kn hi ih b ii kv im kw iq kx iu ky iy kz jc kr ks kt ku bi translated">创建模板</li></ul><figure class="lb lc ld le fd lf er es paragraph-image"><div class="er es lo"><img src="../Images/a0330afc071a344bc575d3e393892f44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/0*7fOkURKblwF92L0x.png"/></div></figure><h2 id="a763" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">创建实例组</h2><p id="6f46" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">Google Cloud的<a class="ae je" href="https://cloud.google.com/compute/docs/instance-groups/" rel="noopener ugc nofollow" target="_blank">实例组</a>要么是托管组，要么是非托管组。在计算引擎的情况下，我们需要具有共同特征并且可以根据特定条件扩展的托管实例组。一个实例组依赖于一个实例模板，我们已经处理了这个模板。现在让我们创建实例组</p><figure class="lb lc ld le fd lf er es paragraph-image"><div class="er es lp"><img src="../Images/222641050fc243d4d7adfc8d19bd4a71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/0*_t3144BHXQbB7d-3.png"/></div></figure><h2 id="2fbf" class="jm jn hi bd jo jp jq jr js jt ju jv jw iq jx jy jz iu ka kb kc iy kd ke kf kg bi translated">创建负载平衡器</h2><p id="1490" class="pw-post-body-paragraph if ig hi ih b ii kh ik il im ki io ip iq kj is it iu kk iw ix iy kl ja jb jc hb bi translated">横向扩展通常依赖于负载平衡，我们需要一个这样的负载平衡。因此，让我们继续配置一个。与基本的AWS ELB或Azure负载平衡器相比，Google Compute的负载平衡器先进了几个数量级。稍后会详细介绍。为了这篇文章，我将使用一个网络负载平衡器-</p><figure class="lb lc ld le fd lf er es paragraph-image"><div class="er es lq"><img src="../Images/f9386073bb134faeb0cbfef4bd52155b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/0*dcMyPMwR4Ff_VJEt.png"/></div></figure><p id="4bcc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一个-</p><figure class="lb lc ld le fd lf er es paragraph-image"><div class="er es lr"><img src="../Images/bdda0b9f9bcaab48ef3e1487cb16ecc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/0*6Sjk3DpYGQM2Gk3Z.png"/></div></figure><p id="3d54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大概就是这样。现在，您的应用程序将根据您的配置进行伸缩。希望这有用！</p></div></div>    
</body>
</html>