<html>
<head>
<title>Stackdriver Monitoring Automation Part 3: Uptime Checks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">堆栈驱动程序监控自动化第3部分:正常运行时间检查</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/stackdriver-monitoring-automation-part-3-uptime-checks-476b8507f59c?source=collection_archive---------3-----------------------#2018-09-28">https://medium.com/google-cloud/stackdriver-monitoring-automation-part-3-uptime-checks-476b8507f59c?source=collection_archive---------3-----------------------#2018-09-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ba46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章是Stackdriver自动化系列的第3部分。在<a class="ae jd" rel="noopener" href="/google-cloud/stackdriver-automation-part-1-stackdriver-groups-8e51f0aa9b03">第1部分</a>和<a class="ae jd" rel="noopener" href="/google-cloud/stackdriver-automation-part-2-alerting-policies-9f42068603c4">第2部分</a>中，我分别介绍了Stackdriver组和警报策略的自动化管理。在这篇文章中，我将详细介绍可以用来自动化运行时间检查管理的步骤。阅读第1部分了解背景知识和先决条件。</p><h1 id="3d64" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">正常运行时间检查</h1><p id="802a" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated"><a class="ae jd" href="https://cloud.google.com/monitoring/uptime-checks/" rel="noopener ugc nofollow" target="_blank">正常运行时间检查</a>让您通过HTTP、HTTPS或TCP健康检查来验证服务的可用性。Stackdriver通过从世界各地访问应用程序的前端并报告结果(如延迟和响应代码)来提供这种服务。您可以使用此服务来了解您的用户是否可以从全球各地访问该服务。</p><p id="8dc9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，我基于我在第1部分和第2部分中描述的apache基础设施创建了一个正常运行时间检查。该应用程序本身是一个简单的网站，由负载平衡器后面的apache服务器托管。我创建了一个简单的HTTP正常运行时间检查来了解我的用户是否可以访问服务。</p><p id="c8ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://cloud.google.com/monitoring/api/ref_v3/rest/v3/projects.uptimeCheckConfigs/create" rel="noopener ugc nofollow" target="_blank">projects . uptimecheckconfigs . create</a>API列出了创建运行时间检查所需的以下值。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="7b24" class="kq jf hi km b fi kr ks l kt ku">{<br/>  "name": string,<br/>  "displayName": string,<br/>  "period": string,<br/>  "timeout": string,<br/>  "contentMatchers": [<br/>    {<br/>      object(ContentMatcher)<br/>    }<br/>  ],<br/>  "selectedRegions": [<br/>    enum(UptimeCheckRegion)<br/>  ],<br/>  "isInternal": boolean,<br/>  "internalCheckers": [<br/>    {<br/>      object(InternalChecker)<br/>    }<br/>  ],</span><span id="8576" class="kq jf hi km b fi kv ks l kt ku">// Union field resource can be only one of the following:<br/>  "monitoredResource": {<br/>    object(MonitoredResource)<br/>  },<br/>  "resourceGroup": {<br/>    object(ResourceGroup)<br/>  }<br/>  // End of list of possible types for union field resource.</span><span id="45f9" class="kq jf hi km b fi kv ks l kt ku">// Union field check_request_type can be only one of the following:<br/>  "httpCheck": {<br/>    object(HttpCheck)<br/>  },<br/>  "tcpCheck": {<br/>    object(TcpCheck)<br/>  }<br/>  // End of list of possible types for union field check_request_type.<br/>}</span></pre><p id="d121" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我使用了<a class="ae jd" href="https://cloud.google.com/monitoring/api/ref_v3/rest/v3/projects.uptimeCheckConfigs/create" rel="noopener ugc nofollow" target="_blank">projects . uptimecheckconfigs . create</a>文档中的“Try this API”侧栏来测试这些值。我将模板分成了jinja模板和yaml文件，这样我就可以重用jinja模板进行任何其他的正常运行时间检查。</p><p id="0ab9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">stack driver _ uptimecheckconfigs . jinja</strong></p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="a6b5" class="kq jf hi km b fi kr ks l kt ku">{% set PREFIX = env["deployment"] %}<br/>{% set UPTIME_CHECKS = properties["uptimechecks"] %}<br/>{% set PROJECT = env["project"] %}</span><span id="c8de" class="kq jf hi km b fi kv ks l kt ku">resources:<br/>{% for uptimecheck in UPTIME_CHECKS %}<br/>- name: {{ PREFIX }}-uptimecheck-{{ loop.index }}<br/>  type: gcp-types/monitoring-v3:monitoring.projects.uptimeCheckConfigs.create<br/>  properties:<br/>    parent: projects/{{ PROJECT }}<br/>    displayName: {{ uptimecheck.name }}<br/>    period: {{ uptimecheck.period }}<br/>    timeout: {{ uptimecheck.timeout }}<br/>    monitoredResource: {{ uptimecheck.monitoredResource }}<br/>    httpCheck: {{ uptimecheck.httpCheck }}<br/>{% endfor %}</span></pre><p id="0426" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，我创建的yaml能够在Uptime Checks块下创建多个正常运行时间检查。我针对我的负载平衡器的URL创建了一个标准的httpCheck，它在API中表示为monitoredResource对象。</p><p id="c480" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">stack driver _ uptimecheckconfigs . YAML</strong></p><p id="d9c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请将您的项目标识值与您的GCP项目标识值以及您的主机URL值一起输入</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="6981" class="kq jf hi km b fi kr ks l kt ku">imports:<br/>- path: stackdriver_uptimecheckconfigs.jinja<br/>resources:<br/>- name: create_uptimechecks<br/>  type: stackdriver_uptimecheckconfigs.jinja<br/>  properties:<br/>    uptimechecks:<br/>    - name: "1 - Website uptime check [global]"<br/>      period: "60s"<br/>      timeout: "10s"<br/>      monitoredResource:<br/>        type: "uptime_url"<br/>        labels:<br/>          project_id: YOUR_PROJECT_ID<br/>          host: "35.241.47.194"<br/>      httpCheck:<br/>        path: "/"<br/>        port: 80</span></pre><p id="392b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在<a class="ae jd" href="https://github.com/charlesbaer/stackdriver-automation" rel="noopener ugc nofollow" target="_blank"> github repo </a>上找到jinja和yaml文件。</p><p id="46bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后一步是使用下面的gcloud命令行来实际创建Stackdriver正常运行时间检查。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="d505" class="kq jf hi km b fi kr ks l kt ku">$ gcloud deployment-manager deployments create website-uptimecheck --config stackdriver_uptimecheckconfigs.yaml </span><span id="d53c" class="kq jf hi km b fi kv ks l kt ku">                                                                                          <br/>Create operation operation-1537814541833-576a2597f1329-1faf3a15-f226e553 completed successfully.<br/>NAME                         TYPE                                                                   STATE      ERRORS  INTENT<br/>website-uptimecheck-uptimecheck-1  gcp-types/monitoring-v3:monitoring.projects.uptimeCheckConfigs.create  COMPLETED  []</span></pre><p id="4d0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦创建了运行时间检查，我就使用Stackdriver监控控制台来验证运行时间检查是否已经成功创建。请记住，当您第一次创建运行时间检查时，根据<a class="ae jd" href="https://cloud.google.com/monitoring/uptime-checks/management#before_you_begin" rel="noopener ugc nofollow" target="_blank">文档</a>开始报告状态可能需要25分钟。</p><figure class="kh ki kj kk fd kx er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es kw"><img src="../Images/1397bb04573f7c2d312a000ef6a52b6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KNNyBNEApUdEv45bZD-JXg.png"/></div></div></figure><p id="0484" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，正常运行时间检查处于活动状态，可以与警报策略结合使用，以便在正常运行时间检查失败或延迟超出容许范围时通知您。</p><h1 id="c4e9" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">结论:Stackdriver监控自动化系列</h1><p id="a9b2" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">Stackdriver监控自动化系列到此结束。在本系列中，我介绍了通过Google Cloud Deployment Manager创建Stackdriver监控组件的步骤和方法。在第一篇文章中，我创建了一个Stackdriver组，用于将要监控的资源作为一个实体进行分组。在第二篇文章中，我创建了Stackdriver警报策略来定义何时发送警报以及发送什么警报。在第三篇文章中，我创建了Stackdriver正常运行时间检查来提供最终用户体验的基本情况。您可以使用这些步骤和配置文件作为模板，在您的环境中自动部署Stackdriver监控资源。</p><p id="d23e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本系列的其他文章和下面的参考资料中阅读更多关于Stackdriver监控自动化的内容。</p><ul class=""><li id="5bf8" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated"><a class="ae jd" rel="noopener" href="/google-cloud/stackdriver-automation-part-1-stackdriver-groups-8e51f0aa9b03"> Stackdriver自动化第1部分:Stackdriver集团</a></li><li id="6cce" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae jd" rel="noopener" href="/@charles.baer/stackdriver-automation-part-2-alerting-policies-9f42068603c4">堆栈驱动自动化第2部分:堆栈驱动警报策略</a></li></ul><p id="9e2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参考资料:</p><ul class=""><li id="b097" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated"><a class="ae jd" href="https://cloud.google.com/monitoring/docs/" rel="noopener ugc nofollow" target="_blank">堆栈驱动程序监控文档</a></li><li id="713d" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae jd" href="https://cloud.google.com/monitoring/api/ref_v3/rest/" rel="noopener ugc nofollow" target="_blank">栈驱动监控API文档</a></li><li id="3666" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae jd" href="https://cloud.google.com/monitoring/api/v3/filters" rel="noopener ugc nofollow" target="_blank">堆栈驱动监控过滤器</a></li><li id="9222" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae jd" href="https://cloud.google.com/monitoring/api/metrics_gcp" rel="noopener ugc nofollow" target="_blank">堆栈驱动程序监控指标</a></li><li id="4f2e" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae jd" href="https://cloud.google.com/deployment-manager/docs/" rel="noopener ugc nofollow" target="_blank">谷歌云部署管理器</a></li><li id="ec80" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated"><a class="ae jd" href="https://github.com/GoogleCloudPlatform/deploymentmanager-samples" rel="noopener ugc nofollow" target="_blank">部署管理器示例</a></li></ul></div></div>    
</body>
</html>