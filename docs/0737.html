<html>
<head>
<title>Serverless CI/CD — Google Cloud Build</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器CI/CD — Google云构建</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/serverless-ci-cd-google-cloud-build-5b0c92d95d14?source=collection_archive---------0-----------------------#2018-08-27">https://medium.com/google-cloud/serverless-ci-cd-google-cloud-build-5b0c92d95d14?source=collection_archive---------0-----------------------#2018-08-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="360a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如你从<a class="ae jd" rel="noopener" href="/google-cloud/updated-zero-to-continuous-delivery-with-gcp-10a1de80454c">我以前的博客</a>中看到的，我是<a class="ae jd" href="https://www.atlassian.com/continuous-delivery/ci-vs-ci-vs-cd" rel="noopener ugc nofollow" target="_blank">持续部署</a>的忠实粉丝。一般来说，我希望利用开源平台来提供工具，以帮助构建和部署应用程序，工具如<a class="ae jd" href="https://jenkins.io/" rel="noopener ugc nofollow" target="_blank">詹金斯</a>，特别是<a class="ae jd" href="https://github.com/jenkinsci/kubernetes-plugin" rel="noopener ugc nofollow" target="_blank"> Kubernetes插件，用于基于临时容器的构建代理</a>。</p><p id="a8ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是……我也热衷于允许企业通过尽可能利用平台(<a class="ae jd" href="https://en.wikipedia.org/wiki/Platform_as_a_service" rel="noopener ugc nofollow" target="_blank"> PaaS </a>或类似平台)来专注于他们的核心价值主张。利用技术解决方案意味着企业可以让员工专注于关键功能，让运营团队专注于管理平台的核心，让云提供商管理其余部分。</p><p id="ad80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">CI/CD工具是许多组织需要的基础设施之一(特别是如果他们希望审查部署质量或部署节奏)，但管理这些“内部感觉”系统可能会占用您的系统管理员/操作员/ SRE员工的一些时间。</p><p id="7231" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<a class="ae jd" href="https://cloud.withgoogle.com/next18/sf/" rel="noopener ugc nofollow" target="_blank"> Google Cloud Next 2018 </a>期间，谷歌宣布了其<a class="ae jd" href="https://cloud.google.com/serverless/" rel="noopener ugc nofollow" target="_blank">无服务器产品</a>中的大量产品/功能。我决定尝试的第一个工具是<a class="ae jd" href="https://cloud.google.com/cloud-build/" rel="noopener ugc nofollow" target="_blank"> Google Cloud Build </a>。</p><p id="5b72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文的剩余部分提供了一个使用Google Cloud Build构建NodeJS express应用程序的运行示例。</p><p id="c61f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">TL；DR —本文附带的GitHub repo</p><div class="je jf ez fb jg jh"><a href="https://github.com/clos-consultancy/gcp-cloud-build" rel="noopener  ugc nofollow" target="_blank"><div class="ji ab dw"><div class="jj ab jk cl cj jl"><h2 class="bd hj fi z dy jm ea eb jn ed ef hh bi translated">clos-咨询/GCP-云构建</h2><div class="jo l"><h3 class="bd b fi z dy jm ea eb jn ed ef dx translated">博客的GCP云构建示例。通过创建以下帐户，为clos-consultancy/GCP-cloud-build开发做出贡献…</h3></div><div class="jp l"><p class="bd b fp z dy jm ea eb jn ed ef dx translated">github.com</p></div></div><div class="jq l"><div class="jr l js jt ju jq jv jw jh"/></div></div></a></div><p id="aa91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我创建了一个真正标准的NodeJS express应用程序。为了运行单元测试，我决定利用<a class="ae jd" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a>。</p><p id="cd76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是应用程序的package.json</p><figure class="jx jy jz ka fd kb"><div class="bz dy l di"><div class="kc kd l"/></div></figure><p id="837a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那里没什么特别的。</p><p id="c3dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，对于应用程序，我们没有利用任何谷歌云工具来编写我们的应用程序。让我们的应用保持良好的平台无关性。</p><p id="68f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我非常喜欢代码定义的构建管道。Google Cloud Build现在有所不同，它使用了一个名为<a class="ae jd" href="https://cloud.google.com/cloud-build/docs/configuring-builds/create-basic-configuration" rel="noopener ugc nofollow" target="_blank"> cloudbuild.yaml </a>的文件——Cloud Build . YAML文件告知Google构建/测试/部署应用程序的步骤。</p><p id="5907" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是Node应用程序的初始构建文件示例。</p><figure class="jx jy jz ka fd kb"><div class="bz dy l di"><div class="kc kd l"/></div></figure><p id="cc43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">非常简单——我们使用Google Cloud构建来安装我们的依赖项，然后再次使用npm cloud构建来运行我们的测试。</p><p id="4a34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们可以利用GCP命令行<a class="ae jd" href="https://cloud.google.com/cloud-build/docs/running-builds/start-build-manually" rel="noopener ugc nofollow" target="_blank">提交这个构建到谷歌云</a>。</p><pre class="jx jy jz ka fd ke kf kg kh aw ki bi"><span id="7de4" class="kj kk hi kf b fi kl km l kn ko">gcloud builds submit --config cloudbuild.yaml .</span></pre><p id="a3b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:上面的命令假设您已经配置了GCP命令行和目标项目。如果您还没有在云项目上启用云构建API，也不用担心，因为命令行会询问您是否希望启用它。</p><p id="46c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你提交了你的构建，你就可以访问c <a class="ae jd" href="https://console.cloud.google.com/cloud-build/builds" rel="noopener ugc nofollow" target="_blank">音箱并查看你的构建日志</a>。完全无服务器构建，无需监控/维护构建代理！</p><p id="8bf7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然手动提交只能让你到此为止——如果你想自动化，你当然可以写你自己的git挂钩，但是GCP也提供<a class="ae jd" href="https://cloud.google.com/cloud-build/docs/running-builds/automate-builds" rel="noopener ugc nofollow" target="_blank">构建触发器</a>允许你基于Git变化自动触发构建。</p><p id="8901" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当然，对于所有云产品，他们都有基于op-ex的费用—在编写云构建时，每天提供120分钟的免费构建时间。<a class="ae jd" href="https://cloud.google.com/cloud-build/pricing" rel="noopener ugc nofollow" target="_blank">完整的定价详情</a></p><p id="58d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于我们开发和支持的应用程序来说，这只是我们需要考虑的又一个工具。</p><p id="29be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有兴趣听听人们对使用无服务器CI/CD工具的看法。</p></div></div>    
</body>
</html>