<html>
<head>
<title>Experimenting with Cross Cloud Kubernetes Cluster Federation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">尝试跨云Kubernetes集群联盟</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/experimenting-with-cross-cloud-kubernetes-cluster-federation-dfa99f913d54?source=collection_archive---------1-----------------------#2017-02-10">https://medium.com/google-cloud/experimenting-with-cross-cloud-kubernetes-cluster-federation-dfa99f913d54?source=collection_archive---------1-----------------------#2017-02-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="698d" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">什么/为什么？</h1><p id="48a6" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在之前的<!-- -->帖子<!-- -->中，我介绍了一种在现有AWS环境中部署集群的方法，作为我对可集成性问题的回答。</p><p id="aba0" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">那么我接下来最常被问到的问题是什么呢？你看了标题就知道了:</p><blockquote class="kg kh ki"><p id="2526" class="jd je kj jf b jg kb ji jj jk kc jm jn kk kd jq jr kl ke ju jv km kf jy jz ka hb bi translated"><strong class="jf hj">我们能否将Kubernetes跨越多个集群/云？</strong></p></blockquote><p id="639e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">随着越来越多的人将k8s视为下一个大平台，这使他们能够抽象出大量的云/裸机基础设施，这个问题定期出现是公平的。</p><p id="1302" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这是前所未有的公平，因为有巨大的社区努力来实现它，并且在过去的6个月里取得了巨大的进展。</p><p id="0f70" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">所以理论上…是的。现在，它在现实世界中有效吗？我们去看看吧！</p><p id="e68c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">让我把这篇文章的其余部分说清楚:不幸的是，我们将<em class="kj">而不是</em>实现多云Kubernetes的完全自动化。然而，我们将到达这样一个点，您可以以适中的成本运行一个多云联盟，并操纵最基本的原语。对于不工作的，我们会看到解决办法。至少，希望你已经对k8s联盟的现状有所了解。</p><h1 id="a51f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">关于联邦的预备词</h1><p id="c7bc" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">什么是Kubernetes联盟？要回答这个问题，这么说吧，跨越一个全世界独一无二的集群，退一步说，是绝对不可能的。这就是为什么云有区域、az、单元、机架…您必须分割您的基础架构，以便特定的地理区域是构建更大解决方案的构建单位。</p><p id="5a4a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">然而，当你在AWS、Azure或GCP上连接时，你可以跨所有地区创建和管理资源。更好的是，有些服务是全局的(DNS、对象存储…)，在整个环境中共享。</p><p id="2902" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">如果有很多人认为Kubernetes是(您的)可伸缩性问题的解决方案，那么您已经考虑或将考虑在几个区域和az中旋转几个集群。<br/>控制所有星团的“库伯内特”位面是联邦。它提供了集中控制，并将命令分布到所有联合云。</p><p id="90b2" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">TL；DR:如果你使用Kubernetes，如果你想要一个跨多个地区和云的全球应用程序，那么联合就是你要做的。</p><p id="f1d6" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">现在Federation也是Kubernetes生态系统中非常年轻的子项目，距离足够成熟还有很长的路要走。让我们来看看对于那些开始使用k8s或考虑使用k8s的人来说，我们现在处于什么位置。</p><h1 id="724b" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">这个计划</h1><p id="75cc" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在这篇博客中，我们将做以下事情:</p><ol class=""><li id="1689" class="kn ko hi jf b jg kb jk kc jo kp js kq jw kr ka ks kt ku kv bi translated">在亚马逊、Azure和GKE部署Kubernetes集群</li><li id="e1c9" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka ks kt ku kv bi translated">用我们控制的域名创建一个谷歌云域名系统区域</li><li id="0e2c" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka ks kt ku kv bi translated">在GKE安装一个联邦控制面板</li><li id="597a" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka ks kt ku kv bi translated">测试开箱后哪些可行，哪些不可行</li></ol><h1 id="3d1c" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">要求</h1><p id="8713" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">接下来，重要的是:</p><ul class=""><li id="0fc1" class="kn ko hi jf b jg kb jk kc jo kp js kq jw kr ka lb kt ku kv bi translated">你了解Kubernetes 101</li><li id="3aa8" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">你了解k8s联盟的概念</li><li id="24d7" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">您拥有AWS、GCP和Azure的管理员凭据</li><li id="64e1" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">您熟悉可用于部署Kubernetes的工具</li><li id="5e62" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">你有GKE和谷歌云域名系统(或route53或Azure域名系统)的概念</li></ul><h1 id="b2c1" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">前戏</h1><ul class=""><li id="93ec" class="kn ko hi jf b jg jh jk jl jo lc js ld jw le ka lb kt ku kv bi translated">确保你已经安装了Juju。</li></ul><p id="d787" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在Ubuntu上，</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="e7eb" class="lo ig hi lk b fi lp lq l lr ls">sudo apt-add-repository ppa:juju/stable<br/>sudo apt update &amp;&amp; apt upgrade -yqq<br/>sudo apt install -yqq juju </span></pre><p id="296b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">对于其他操作系统，查找<a class="ae lt" href="https://jujucharms.com/docs/2.0/getting-started-general" rel="noopener ugc nofollow" target="_blank">正式文档</a></p><p id="b0e6" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">然后用你的凭证连接到AWS云，阅读<a class="ae lt" href="https://jujucharms.com/docs/2.0/help-aws" rel="noopener ugc nofollow" target="_blank">这一页</a></p><p id="0af5" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">最后，通过<a class="ae lt" href="https://jujucharms.com/docs/2.0/help-azure" rel="noopener ugc nofollow" target="_blank">这个页面</a>连接到Azure</p><ul class=""><li id="e9fb" class="kn ko hi jf b jg kb jk kc jo kp js kq jw kr ka lb kt ku kv bi translated">确保你已经安装了<a class="ae lt" href="https://cloud.google.com/sdk/docs/quickstart-debian-ubuntu" rel="noopener ugc nofollow" target="_blank">谷歌云SDK套件</a></li><li id="09e6" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">最后，复制回购协议，以访问所有的来源</li></ul><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="0125" class="lo ig hi lk b fi lp lq l lr ls">git clone <a class="ae lt" href="https://github.com/madeden/blogposts" rel="noopener ugc nofollow" target="_blank">https://github.com/madeden/blogposts</a> ./<br/>cd blogposts/k8s-federation</span></pre><p id="3e82" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">好吧！让我们现在就结盟吧！</p></div><div class="ab cl lu lv gp lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hb hc hd he hf"><h1 id="535c" class="if ig hi bd ih ii mb ik il im mc io ip iq md is it iu me iw ix iy mf ja jb jc bi translated">部署</h1><p id="7bf3" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在本节中，我们将</p><ul class=""><li id="486c" class="kn ko hi jf b jg kb jk kc jo kp js kq jw kr ka lb kt ku kv bi translated">在Azure、AWS和GKE上部署k8s</li><li id="3c72" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">为联盟安装工具</li><li id="f8b1" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">部署联盟</li></ul><h2 id="9fe6" class="lo ig hi bd ih mg mh mi il mj mk ml ip jo mm mn it js mo mp ix jw mq mr jb ms bi translated">微软Azure</h2><p id="dbb9" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">让我们首先在Azure中生成一个k8s集群:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="a455" class="lo ig hi lk b fi lp lq l lr ls"># Bootstrap the Juju Controller<br/>juju bootstrap azure/westeurope azure \<br/>  --bootstrap-constraints “root-disk=64G mem=8G” \<br/>  --bootstrap-series xenial<br/># Deploy Canonical Distribution of Kubernetes<br/>juju deploy src/bundle/k8s-azure.yaml</span></pre><p id="0e32" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">Azure相对来说旋转起来比较慢，所以你可以让它过去，我们稍后再回来。</p><h2 id="cffd" class="lo ig hi bd ih mg mh mi il mj mk ml ip jo mm mn it js mo mp ix jw mq mr jb ms bi translated">亚马逊AWS</h2><p id="f9aa" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在，在AWS上采取同样的行动</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="4601" class="lo ig hi lk b fi lp lq l lr ls">juju bootstrap aws/us-west-2 aws \<br/>  --bootstrap-constraints "root-disk=64G mem=8G" \<br/>  --bootstrap-series xenial<br/># Deploy Canonical Distribution of Kubernetes<br/>juju deploy src/bundle/k8s-aws.yaml</span></pre><p id="8f1e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这大约需要10分钟，所以让它运行，我们稍后再回来</p><h2 id="2415" class="lo ig hi bd ih mg mh mi il mj mk ml ip jo mm mn it js mo mp ix jw mq mr jb ms bi translated">GKE</h2><p id="f68c" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在这里，我们部署了一个DNS区域和一个小型GKE群集</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="9815" class="lo ig hi lk b fi lp lq l lr ls"># Spin up the DNS Zone<br/>gcloud dns managed-zones create federation \<br/>  --description "Kubernetes federation testing" \<br/>  --dns-name demo.madeden.com<br/># Spin up a GKE cluster<br/>gcloud container clusters create gke \<br/>  --zone=us-east1-b \<br/>  --scopes "cloud-platform,storage-ro,service-control,service-management,<a class="ae lt" href="https://www.googleapis.com/auth/ndev.clouddns.readwrite" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/ndev.clouddns.readwrite</a>" \<br/>  --num-nodes=2</span></pre><p id="c868" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">您将需要一个全球可用的DNS，您可以通过编程来驱动，以操作联盟，这就是为什么我们使用这个谷歌云DNS。它也适用于AWS Route53，但其他集成正在进行中。</p><p id="bd70" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">我必须将它配置为从甘地委派子域，这相当容易，因为谷歌在他们的<a class="ae lt" href="https://cloud.google.com/dns/zones/" rel="noopener ugc nofollow" target="_blank">帮助页面</a>上给了你所有你需要的说明。</p><h1 id="6125" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">联盟</h1><h2 id="67d2" class="lo ig hi bd ih mg mh mi il mj mk ml ip jo mm mn it js mo mp ix jw mq mr jb ms bi translated">安装kubefed</h2><p id="b0c1" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">从1.5开始，Kubernetes提供了一个名为<a class="ae lt" href="https://kubernetes.io/docs/admin/federation/kubefed/" rel="noopener ugc nofollow" target="_blank"> KubeFed </a>的工具来管理联盟的生命周期。</p><p id="fd97" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">安装时使用:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="b95a" class="lo ig hi lk b fi lp lq l lr ls">curl -O <a class="ae lt" href="https://storage.googleapis.com/kubernetes-release/release/v1.5.2/kubernetes-client-linux-amd64.tar.gz" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/kubernetes-release/release/v1.5.2/kubernetes-client-linux-amd64.tar.gz</a><br/>tar -xzvf kubernetes-client-linux-amd64.tar.gz<br/>sudo cp kubernetes/client/bin/kubefed /usr/local/bin<br/>sudo chmod +x /usr/local/bin/kubefed<br/>sudo cp kubernetes/client/bin/kubectl /usr/local/bin<br/>sudo chmod +x /usr/local/bin/kubectl<br/>mkdir -p ~/.kube</span></pre><h2 id="d1fe" class="lo ig hi bd ih mg mh mi il mj mk ml ip jo mm mn it js mo mp ix jw mq mr jb ms bi translated">配置kubectl</h2><p id="1774" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在Azure上，检查您的群集现在是否启动并运行:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="c2db" class="lo ig hi lk b fi lp lq l lr ls"># Switch Juju to the Azure cluster<br/>juju switch azure<br/># Get status<br/>juju status<br/># Which gets you (if finished)<br/>Model    Controller        Cloud/Region      Version<br/>default  azure             azure/westeurope  2.1-beta5</span><span id="f1a2" class="lo ig hi lk b fi mt lq l lr ls">App                Version  Status  Scale  Charm              Store       Rev  OS      Notes<br/>easyrsa            3.0.1    active      1  easyrsa            jujucharms    6  ubuntu  <br/>etcd               2.2.5    active      3  etcd               jujucharms   23  ubuntu  <br/>flannel            0.7.0    active      4  flannel            jujucharms   10  ubuntu  <br/>kubernetes-master  1.5.2    active      1  kubernetes-master  jujucharms   11  ubuntu  exposed<br/>kubernetes-worker  1.5.2    active      3  kubernetes-worker  jujucharms   13  ubuntu  exposed</span><span id="3104" class="lo ig hi lk b fi mt lq l lr ls">Unit                  Workload  Agent  Machine  Public address  Ports           Message<br/>easyrsa/0*            active    idle   0        40.114.244.142                  Certificate Authority connected.<br/>etcd/0                active    idle   1        40.114.247.142  2379/tcp        Healthy with 3 known peers.<br/>etcd/1*               active    idle   2        104.47.167.187  2379/tcp        Healthy with 3 known peers.<br/>etcd/2                active    idle   3        104.47.163.137  2379/tcp        Healthy with 3 known peers.<br/>kubernetes-master/0*  active    idle   4        40.114.243.251  6443/tcp        Kubernetes master running.<br/>  flannel/2           active    idle            40.114.243.251                  Flannel subnet 10.1.96.1/24<br/>kubernetes-worker/0   active    idle   5        104.47.162.134  80/tcp,443/tcp  Kubernetes worker running.<br/>  flannel/1           active    idle            104.47.162.134                  Flannel subnet 10.1.94.1/24<br/>kubernetes-worker/1*  active    idle   6        104.47.162.82   80/tcp,443/tcp  Kubernetes worker running.<br/>  flannel/0*          active    idle            104.47.162.82                   Flannel subnet 10.1.58.1/24<br/>kubernetes-worker/2   active    idle   7        104.47.160.138  80/tcp,443/tcp  Kubernetes worker running.<br/>  flannel/3           active    idle            104.47.160.138                  Flannel subnet 10.1.43.1/24</span><span id="0f81" class="lo ig hi lk b fi mt lq l lr ls">Machine  State    DNS             Inst id    Series  AZ<br/>0        started  40.114.244.142  machine-0  xenial  <br/>1        started  40.114.247.142  machine-1  xenial  <br/>2        started  104.47.167.187  machine-2  xenial  <br/>3        started  104.47.163.137  machine-3  xenial  <br/>4        started  40.114.243.251  machine-4  xenial  <br/>5        started  104.47.162.134  machine-5  xenial  <br/>6        started  104.47.162.82   machine-6  xenial  <br/>7        started  104.47.160.138  machine-7  xenial</span><span id="9840" class="lo ig hi lk b fi mt lq l lr ls">Relation      Provides           Consumes           Type<br/>certificates  easyrsa            etcd               regular<br/>certificates  easyrsa            kubernetes-master  regular<br/>certificates  easyrsa            kubernetes-worker  regular<br/>cluster       etcd               etcd               peer<br/>etcd          etcd               flannel            regular<br/>etcd          etcd               kubernetes-master  regular<br/>cni           flannel            kubernetes-master  regular<br/>cni           flannel            kubernetes-worker  regular<br/>cni           kubernetes-master  flannel            subordinate<br/>kube-dns      kubernetes-master  kubernetes-worker  regular<br/>cni           kubernetes-worker  flannel            subordinate</span></pre><p id="279f" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">现在下载配置文件</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="cec3" class="lo ig hi lk b fi lp lq l lr ls">juju scp kubernetes-master/0:/home/ubuntu/config ./config-azure</span></pre><p id="acb1" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在AWS上重复该操作</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="beea" class="lo ig hi lk b fi lp lq l lr ls">juju switch aws<br/>Model    Controller     Cloud/Region   Version<br/>default  aws            aws/us-west-2  2.1-beta5</span><span id="c015" class="lo ig hi lk b fi mt lq l lr ls">App                Version  Status  Scale  Charm              Store       Rev  OS      Notes<br/>easyrsa            3.0.1    active      1  easyrsa            jujucharms    6  ubuntu  <br/>etcd               2.2.5    active      3  etcd               jujucharms   23  ubuntu  <br/>flannel            0.7.0    active      4  flannel            jujucharms   10  ubuntu  <br/>kubernetes-master  1.5.2    active      1  kubernetes-master  jujucharms   11  ubuntu  exposed<br/>kubernetes-worker  1.5.2    active      3  kubernetes-worker  jujucharms   13  ubuntu  exposed</span><span id="8f6b" class="lo ig hi lk b fi mt lq l lr ls">Unit                  Workload  Agent  Machine  Public address  Ports           Message<br/>easyrsa/0*            active    idle   2        10.0.251.198                    Certificate Authority connected.<br/>etcd/0*               active    idle   1        10.0.252.237    2379/tcp        Healthy with 3 known peers.<br/>etcd/1                active    idle   6        10.0.251.143    2379/tcp        Healthy with 3 known peers.<br/>etcd/2                active    idle   7        10.0.251.31     2379/tcp        Healthy with 3 known peers.<br/>kubernetes-master/0*  active    idle   0        35.164.145.16   6443/tcp        Kubernetes master running.<br/>  flannel/0*          active    idle            35.164.145.16                   Flannel subnet 10.1.37.1/24<br/>kubernetes-worker/0*  active    idle   3        52.27.16.150    80/tcp,443/tcp  Kubernetes worker running.<br/>  flannel/3           active    idle            52.27.16.150                    Flannel subnet 10.1.11.1/24<br/>kubernetes-worker/1   active    idle   4        52.10.62.234    80/tcp,443/tcp  Kubernetes worker running.<br/>  flannel/1           active    idle            52.10.62.234                    Flannel subnet 10.1.43.1/24<br/>kubernetes-worker/2   active    idle   5        52.27.1.171     80/tcp,443/tcp  Kubernetes worker running.<br/>  flannel/2           active    idle            52.27.1.171                     Flannel subnet 10.1.68.1/24</span><span id="99f1" class="lo ig hi lk b fi mt lq l lr ls">Machine  State    DNS            Inst id              Series  AZ<br/>0        started  35.164.145.16  i-0a3fdb3ce9590cb7e  xenial  us-west-2a<br/>1        started  10.0.252.237   i-0dcbd977bee04563b  xenial  us-west-2b<br/>2        started  10.0.251.198   i-04cedb17e22064212  xenial  us-west-2a<br/>3        started  52.27.16.150   i-0f44e7e27f776aebf  xenial  us-west-2b<br/>4        started  52.10.62.234   i-02ff8041a61550802  xenial  us-west-2a<br/>5        started  52.27.1.171    i-0a4505185421bbdaf  xenial  us-west-2a<br/>6        started  10.0.251.143   i-05a855d5c0c6f847d  xenial  us-west-2a<br/>7        started  10.0.251.31    i-03f1aafe15d163a34  xenial  us-west-2a</span><span id="a147" class="lo ig hi lk b fi mt lq l lr ls">Relation      Provides           Consumes           Type<br/>certificates  easyrsa            etcd               regular<br/>certificates  easyrsa            kubernetes-master  regular<br/>certificates  easyrsa            kubernetes-worker  regular<br/>cluster       etcd               etcd               peer<br/>etcd          etcd               flannel            regular<br/>etcd          etcd               kubernetes-master  regular<br/>cni           flannel            kubernetes-master  regular<br/>cni           flannel            kubernetes-worker  regular<br/>cni           kubernetes-master  flannel            subordinate<br/>kube-dns      kubernetes-master  kubernetes-worker  regular<br/>cni           kubernetes-worker  flannel            subordinate</span></pre><p id="59c7" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">和</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="683f" class="lo ig hi lk b fi lp lq l lr ls">juju scp kubernetes-master/0:/home/ubuntu/config ./config-aws</span></pre><p id="f2ea" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">现在是GKE</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="1a1b" class="lo ig hi lk b fi lp lq l lr ls">gcloud container clusters get-credentials gce --zone=us-east1-b</span></pre><p id="cba6" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这最后一个操作将实际创建或修改您的<strong class="jf hj"> ~/。GKE的kube/config </strong>文件，所以您可以直接从kubectl查询上下文。GKE有创建非常长的名字的倾向，我们现在只想要一个短的来减轻我们的命令行负担。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="433c" class="lo ig hi lk b fi lp lq l lr ls"># Identify the cluster name<br/>LONG_NAME=$(kubectl config view -o jsonpath='{.contexts[*].name}')<br/># Replace it in kubeconfig<br/>sed -i "s/$LONG_NAME/gke/g" ~/.kube/config</span></pre><p id="e13a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">现在修改Juju下载的文件，将它们集成到这个配置文件中。</p><p id="3512" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">一些聪明的人构建了一个工具来合并kubeconfig文件:<a class="ae lt" href="https://github.com/Collaborne/load-kubeconfig" rel="noopener ugc nofollow" target="_blank"> load-kubeconfig </a></p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="7777" class="lo ig hi lk b fi lp lq l lr ls"># Install tool <br/>sudo npm install -g load-kubeconfig<br/># Replace the username and context name with our cloud names in both files and combine<br/>for cloud in aws azure<br/>do<br/>  sed -i -e "s/juju-cluster/${cloud}/g" \<br/>    -e "s/juju-context/${cloud}/g" \<br/>    -e "s/ubuntu/${cloud}/g" \<br/>    ./config-${cloud}<br/>  load-kubeconfig ./config-${cloud}<br/>done</span></pre><p id="24ef" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">很好，现在你可以很容易地在3个集群之间切换，只需使用— <strong class="jf hj"> context={gke | aws | azure }。</strong></p><h2 id="5af3" class="lo ig hi bd ih mg mh mi il mj mk ml ip jo mm mn it js mo mp ix jw mq mr jb ms bi translated">标记节点</h2><p id="4790" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">部署Kubernetes联盟的目标之一是确保应用程序的多区域HA。在区域内，您也希望在az之间有HA。因此，您应该考虑为每个AZ部署一个集群。</p><p id="027e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">对于一个联盟来说，没有什么比另一个k8s更像一个k8s集群了。如果不给它一些提示，你就不能指望它有区域意识。这就是我们将在这里做的事情。</p><p id="7b10" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">默认情况下，Juju会给你以下标签:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="a880" class="lo ig hi lk b fi lp lq l lr ls"># AWS<br/>kubectl --context=aws get nodes --show-labels<br/>NAME           STATUS    AGE       LABELS<br/>ip-10-0-1-54   Ready     1d        beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/hostname=ip-10-0-1-54<br/>ip-10-0-1-95   Ready     1d        beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/hostname=ip-10-0-1-95<br/>ip-10-0-2-43   Ready     1d        beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/hostname=ip-10-0-2-43<br/># Azure<br/>kubectl --context=azure get nodes --show-labels<br/>NAME        STATUS    AGE       LABELS<br/>machine-5   Ready     2h        beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/hostname=machine-5<br/>machine-6   Ready     2h        beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/hostname=machine-6<br/>machine-7   Ready     2h        beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/hostname=machine-7</span></pre><p id="ebae" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">你只有3个集群和不同的地区(AWS是美国西部2，Azure是欧盟西部2，GKE是美国东部1)，所以我们会稍微假装一下</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="4e8f" class="lo ig hi lk b fi lp lq l lr ls"># Labelling the nodes of AWS for US West 2a (random pick)<br/>for node in $(kubectl - aws get nodes -o json | jq --raw-output '.items[].metadata.name')<br/>do<br/>  kubectl --context=aws label nodes \<br/>    ${node} \<br/>    failure-domain.beta.kubernetes.io/region=us-west-2<br/>  kubectl --context=aws label nodes \<br/>    ${node} \<br/>    failure-domain.beta.kubernetes.io/zone=us-west-2a<br/>done<br/># Labelling the nodes of Azure for EU West 2a (random pick)<br/>for node in $(kubectl - azure get nodes -o json | jq --raw-output '.items[].metadata.name')<br/>do<br/>  kubectl --context=azure label nodes \<br/>    ${node} \<br/>    failure-domain.beta.kubernetes.io/region=eu-west-2<br/>  kubectl --context=azure label nodes \<br/>    ${node} \<br/>    failure-domain.beta.kubernetes.io/zone=eu-west-2a<br/>done</span></pre><p id="ee9b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated"><strong class="jf hj">注意</strong>:在真实环境中，您将有更多的节点需要配置，并且有更好的策略需要采用。这只是为了解释当您联合集群以管理集群和云的故障时，在k8s中设置这个参数是很重要的。</p><h2 id="4e6c" class="lo ig hi bd ih mg mh mi il mj mk ml ip jo mm mn it js mo mp ix jw mq mr jb ms bi translated">确保集群共享相同的GLBC</h2><p id="c84b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><a class="ae lt" href="https://kubernetes.io/docs/user-guide/federation/federated-ingress/" rel="noopener ugc nofollow" target="_blank">本页</a>明确指出，我们的GLBC在所有集群中必须完全相同。因为您用Juju部署了两个集群，用GKE部署了一个集群，所以现在情况不是这样。虽然Canonical的CDK 100%在上游，但情况几乎是这样。只是标签和一些标记不一样。</p><p id="d9a4" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">因此，以下步骤是可选的。如果不这样做，您将不得不手动向所有集群发布DNS配置和入口。这是唯一的区别。</p><p id="6640" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">让我们删除Azure &amp; AWS集群上的L7 LB，用类似于GKE的其他集群来替换它们</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="5f0b" class="lo ig hi lk b fi lp lq l lr ls">for cluster in aws azure<br/>do<br/>  # Delete old ones<br/>  kubectl --context ${cloud} delete \<br/>    rc/default-http-backend \<br/>    rc/nginx-ingress-controller \<br/>    svc/default-http-backend<br/>  # Replace by new ones taken from GKE<br/>  kubectl --context ${cloud} create -f \<br/>    src/manifests/l7-svc.yaml<br/>  kubectl --context ${cloud} create -f \<br/>    src/manifests/l7-deployment.yaml</span><span id="dd9a" class="lo ig hi lk b fi mt lq l lr ls">done</span></pre><h2 id="a02d" class="lo ig hi bd ih mg mh mi il mj mk ml ip jo mm mn it js mo mp ix jw mq mr jb ms bi translated">正在初始化联盟</h2><p id="58ed" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在我们准备联合我们的集群，这实质上意味着我们添加了一个跨集群控制平面，它本身托管在第三个Kubernetes集群中。</p><p id="8434" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">联合集群带来了一些好处，比如</p><ul class=""><li id="ec8c" class="kn ko hi jf b jg kb jk kc jo kp js kq jw kr ka lb kt ku kv bi translated">能够定义多群集服务、副本集/部署、入口，</li><li id="1c7d" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">区域之间的服务故障转移</li><li id="b970" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">单点服务定义</li></ul><p id="de27" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">您之前安装的Kubefed是联邦生命周期(从初始化到销毁)的官方工具。我们将使用GKE集群来管理我们在Azure和AWS中的两个集群。</p><p id="12f8" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">用以下命令初始化我们的“魔环”的控制平面</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="a486" class="lo ig hi lk b fi lp lq l lr ls">kubefed init magicring \<br/>  --host-cluster-context=gke \<br/>  --dns-zone-name="demo.madeden.net."<br/>Federation API server is running at: 130.211.62.225</span></pre><p id="b162" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">命令很简单，负责安装</p><ul class=""><li id="d18f" class="kn ko hi jf b jg kb jk kc jo kp js kq jw kr ka lb kt ku kv bi translated">主机集群(GKE)中一个名为federation-system的新命名空间</li><li id="7d95" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">联邦的新API服务器</li><li id="4c12" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">联邦的新控制器管理器</li><li id="9360" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">kubeconfig文件中的一个新上下文，专门用于与Kubernetes的这个超级层进行交互，它以联邦名称命名</li></ul><p id="9031" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">为了控制联邦，我们现在可以回到kubectl并切换到它的上下文中</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="764c" class="lo ig hi lk b fi lp lq l lr ls">kubectl config use-context magicring<br/>Switched to context “magicring”.</span></pre><p id="a7f3" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">现在将我们的两个集群添加到魔戒中</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="9a27" class="lo ig hi lk b fi lp lq l lr ls"># add AWS<br/>kubefed join aws \<br/>  --host-cluster-context=gke<br/>cluster "aws" created<br/># Now Azure<br/>kubefed join azure \<br/>  --host-cluster-context=gke<br/>cluster "azure" created</span></pre><p id="775f" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这些命令将根据您的kubeconfig在联邦控制平面中创建一对秘密，以便它可以与各个Kube API服务器进行交互。如果您计划构建跨VPN或复杂网络的联盟，这意味着您必须确保控制平面可以与您部署的各种API端点对话。</p><p id="94b6" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">最后，我们可以用kubectl查询一个新的构造“集群”:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="909a" class="lo ig hi lk b fi lp lq l lr ls">kubectl get clusters<br/>NAME STATUS AGE<br/>aws Ready 1m<br/>azure Ready 1m</span></pre><p id="0037" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">恭喜您，您在不到30分钟的时间内联合了一对Kubernetes集群！！！</p><p id="112d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">现在让我们一起玩吧</p></div><div class="ab cl lu lv gp lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hb hc hd he hf"><h1 id="6de0" class="if ig hi bd ih ii mb ik il im mc io ip iq md is it iu me iw ix iy mf ja jb jc bi translated">部署多云应用程序</h1><p id="e760" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">既然联邦正在运行，让我们尝试部署联邦应该管理的所有原语:</p><ul class=""><li id="9a0b" class="kn ko hi jf b jg kb jk kc jo kp js kq jw kr ka lb kt ku kv bi translated">配额/资源管理的名称空间</li><li id="d46d" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">共享数据的配置映射和机密</li><li id="ae6c" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">应用程序的部署/复制集/复制控制器</li><li id="8299" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">展会服务/入口</li></ul><h2 id="6889" class="lo ig hi bd ih mg mh mi il mj mk ml ip jo mm mn it js mo mp ix jw mq mr jb ms bi translated">名称空间</h2><p id="3538" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">让我们部署一个测试名称空间:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="8e1b" class="lo ig hi lk b fi lp lq l lr ls"># Creation<br/>kubectl --context=magicring create -f src/manifests/test-ns.yaml <br/>namespace "test-ns" created</span><span id="0a76" class="lo ig hi lk b fi mt lq l lr ls"># Check AWS<br/>kubectl --context=aws get ns<br/>NAME             STATUS    AGE<br/>ns/default       Active    3d<br/>ns/kube-system   Active    3d<br/>ns/test-ns       Active    50s</span><span id="b876" class="lo ig hi lk b fi mt lq l lr ls"># Check Azure<br/>kubectl --context=azure get ns<br/>NAME             STATUS    AGE<br/>ns/default       Active    2d<br/>ns/kube-system   Active    2d<br/>ns/test-ns       Active    1m</span></pre><p id="d3c2" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">好的，配额和资源管理的基础在全球范围内都可用。这是一个胜利。</p><h2 id="b208" class="lo ig hi bd ih mg mh mi il mj mk ml ip jo mm mn it js mo mp ix jw mq mr jb ms bi translated">配置映射/机密</h2><p id="e178" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">将测试配置图推送到群集，以确认其工作正常:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="5c5e" class="lo ig hi lk b fi lp lq l lr ls"># Publish<br/>kubectl --context magicring create -f src/manifests/test-configmap.yaml <br/>configmap "test-configmap" created</span><span id="9461" class="lo ig hi lk b fi mt lq l lr ls"># Check AWS<br/>kubectl --context aws get cm <br/>NAME       DATA      AGE<br/>test-configmap   1         55s</span><span id="5b66" class="lo ig hi lk b fi mt lq l lr ls"># Check Azure<br/>kubectl --context azure get cm <br/>NAME       DATA      AGE<br/>test-configmap   1         1m</span></pre><p id="e225" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">好了，我们的配置图已经在所有的云中共享了。我们可以像预期的那样对CMs的配置进行单点控制。</p><p id="0a12" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这也适用于秘密。</p><h2 id="08fe" class="lo ig hi bd ih mg mh mi il mj mk ml ip jo mm mn it js mo mp ix jw mq mr jb ms bi translated">部署/副本集/守护集</h2><p id="0954" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">首先，部署10个微型机器人的副本(CDK的演示应用程序):</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="5c02" class="lo ig hi lk b fi lp lq l lr ls"># Note we are still in the Magic Ring context…<br/>kubectl create -f src/manifests/microbots-deployment.yaml <br/>deployment “microbot” created</span></pre><p id="03d6" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">让我们看看他们去了哪里:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="6d45" class="lo ig hi lk b fi lp lq l lr ls"># Querying the Federation control planed does not work<br/>kubectl get pods -o wide<br/>the server doesn't have a resource type "pods"</span><span id="eaa4" class="lo ig hi lk b fi mt lq l lr ls"># Querying AWS cluster directly<br/>kubectl --context=aws get pods <br/>NAME                             READY     STATUS    RESTARTS   AGE<br/>default-http-backend-wqrmm       1/1       Running   0          1d<br/>microbot-1855935831-6n08n        1/1       Running   0          1m<br/>microbot-1855935831-fvd7q        1/1       Running   0          1m<br/>microbot-1855935831-gg5ql        1/1       Running   0          1m<br/>microbot-1855935831-kltf0        1/1       Running   0          1m<br/>microbot-1855935831-z7zp1        1/1       Running   0          1m</span><span id="8f8d" class="lo ig hi lk b fi mt lq l lr ls"># Now querying Azure directly<br/>kubectl --context=azure get pods <br/>NAME                             READY     STATUS    RESTARTS   AGE<br/>default-http-backend-04njk       1/1       Running   0          1h<br/>microbot-1855935831-19m1p        1/1       Running   0          1m<br/>microbot-1855935831-2gwjt        1/1       Running   0          1m<br/>microbot-1855935831-8k3hc        1/1       Running   0          1m<br/>microbot-1855935831-fgrn0        1/1       Running   0          1m<br/>microbot-1855935831-ggvvf        1/1       Running   0          1m</span></pre><p id="98bf" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">联邦在云之间均匀地共享我们的微型机器人。这是预期的行为。如果我们有更多的集群，每一个都将得到公平份额的豆荚。</p><p id="3b5f" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">然而，值得注意的是，并不是所有的事情都奏效了，尽管在现阶段我还不清楚是哪里出了问题以及后果。日志显示:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="ff9a" class="lo ig hi lk b fi lp lq l lr ls">E0210 10:35:53.691358 1 deploymentcontroller.go:516] Failed to ensure delete object from underlying clusters finalizer in deployment microbot: failed to add finalizer orphan to deployment : Operation cannot be fulfilled on deployments.extensions “microbot”: the object has been modified; please apply your changes to the latest version and try again<br/>E0210 10:35:53.691566 1 deploymentcontroller.go:396] Error syncing cluster controller: failed to add finalizer orphan to deployment : Operation cannot be fulfilled on deployments.extensions “microbot”: the object has been modified; please apply your changes to the latest version and try again</span></pre><p id="c91b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">您可以使用以下工具测试DaemonSets:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="e52f" class="lo ig hi lk b fi lp lq l lr ls">kubectl --context=magicring create -f src/manifests/microbots-ds.yaml <br/>daemonset "microbot-ds" created</span><span id="8da7" class="lo ig hi lk b fi mt lq l lr ls">kubectl --context aws get po -n test-ns<br/>NAME                READY     STATUS    RESTARTS   AGE<br/>microbot-ds-5c25n   1/1       Running   0          48s<br/>microbot-ds-cmvtj   1/1       Running   0          48s<br/>microbot-ds-lp0j0   1/1       Running   0          48s</span><span id="ea80" class="lo ig hi lk b fi mt lq l lr ls">kubectl --context azure get po -n test-ns<br/>NAME                READY     STATUS    RESTARTS   AGE<br/>microbot-ds-bkj34   1/1       Running   0          53s<br/>microbot-ds-r85z4   1/1       Running   0          53s<br/>microbot-ds-w8kxg   1/1       Running   0          53s</span></pre><p id="255a" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">因此，我们擅长应用程序分发。只有2更！</p><h2 id="35b4" class="lo ig hi bd ih mg mh mi il mj mk ml ip jo mm mn it js mo mp ix jw mq mr jb ms bi translated">服务</h2><p id="7f67" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在让我们创建服务:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="b505" class="lo ig hi lk b fi lp lq l lr ls"># Service creation...<br/>kubectl --context=magicring create -f src/manifests/microbots-svc.yaml <br/>service "microbot" created</span></pre><p id="1369" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">不要着急，因为这可能需要几分钟时间…</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="94d9" class="lo ig hi lk b fi lp lq l lr ls"># On AWS<br/>$ kubectl --context=aws get svc<br/>NAME                   CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE<br/>default-http-backend   10.152.183.100   &lt;none&gt;        80/TCP         3d<br/>kubernetes             10.152.183.1     &lt;none&gt;        443/TCP        3d<br/>microbot               10.152.183.173   &lt;none&gt;        80/TCP         1m</span><span id="a275" class="lo ig hi lk b fi mt lq l lr ls"># On Azure<br/>$ kubectl --context=azure get svc<br/>NAME                   CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE<br/>default-http-backend   10.152.183.103   &lt;none&gt;        80/TCP    2d<br/>kubernetes             10.152.183.1     &lt;none&gt;        443/TCP   2d<br/>microbot               10.152.183.153   &lt;none&gt;        80/TCP    1m</span></pre><p id="8f19" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">很好！我们可以再次看到，服务已经如预期的那样在两个集群上复制。联邦正在各地共享服务。</p><p id="94e2" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">更好的是，它还同步了我们在Google Cloud DNS中的DNS区域:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="e11c" class="lo ig hi lk b fi lp lq l lr ls">$ gcloud dns record-sets list  --zone demo-madeden<br/>NAME TYPE TTL DATA<br/>demo.madeden.net. NS 21600 ns-cloud-a1.googledomains.com.,ns-cloud-a2.googledomains.com.,ns-cloud-a3.googledomains.com.,ns-cloud-a4.googledomains.com.<br/>demo.madeden.net. SOA 21600 ns-cloud-a1.googledomains.com. cloud-dns-hostmaster.google.com. 2 21600 3600 259200 300<br/>microbot.default.magicring.svc.eu-west-2a.eu-west-2.demo.madeden.net. CNAME 180 microbot.default.magicring.svc.eu-west-2.demo.madeden.net.<br/>microbot.default.magicring.svc.eu-west-2.demo.madeden.net. CNAME 180 microbot.default.magicring.svc.demo.madeden.net.<br/>microbot.default.magicring.svc.us-west-2.demo.madeden.net. CNAME 180 microbot.default.magicring.svc.demo.madeden.net.<br/>microbot.default.magicring.svc.us-west-2a.us-west-2.demo.madeden.net. CNAME 180 microbot.default.magicring.svc.us-west-2.demo.madeden.net.</span></pre><p id="9414" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">因此，我们可以看到我们的区域配置正用于创建记录。如果我们之前没有配置这些，日志会丢弃一些错误，这些错误就不会被创建。</p><p id="00f8" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">从<service>开始，DNS结构的变化也不值一提。<namespace> .svc.cluster.local到<service>。<namespace>。<federation>. SVC<failure-zone><dns-zone/></failure-zone></federation></namespace></service></namespace></service></p><p id="8018" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">现在，microbot.default.magicring.svc.demo.madeden.net透明地连接到两个集群，这意味着我们在集群之间拥有<strong class="jf hj">全球DNS解析服务</strong>。相当牛逼！</p><h2 id="aac8" class="lo ig hi bd ih mg mh mi il mj mk ml ip jo mm mn it js mo mp ix jw mq mr jb ms bi translated">入口</h2><p id="34fb" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">不幸的是，这并不顺利…</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="367a" class="lo ig hi lk b fi lp lq l lr ls"># deploying Ingress...<br/>kubectl --context=magicring create -f <br/>  src/manifests/microbots-ing.yaml <br/>ingress "microbot-ingress" created</span></pre><p id="75b5" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">检查结果:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="d525" class="lo ig hi lk b fi lp lq l lr ls"># Querying ing on AWS<br/>kubectl --context=aws get ing<br/>NAME               HOSTS                        ADDRESS            PORTS     AGE<br/>microbot-ingress   microbots.demo.madeden.net   10.0.1.95,10....   80        1d<br/># On AWS<br/>kubectl --context=azure get ing<br/>No resources found.<br/># Oups!! <br/>kubectl --context=magicring get ing<br/>NAME               HOSTS                        ADDRESS            PORTS     AGE<br/>microbot-ingress   microbots.demo.madeden.net   10.0.1.95,10....   80        1d<br/>kubectl --context=magicring describe ing microbot-ingress<br/>Name:     microbot-ingress<br/>Namespace:    default<br/>Address:    10.0.1.95,10.0.2.43,10.0.2.43<br/>Default backend:  default-http-backend:80 (&lt;none&gt;)<br/>Rules:<br/>  Host        Path  Backends<br/>  ----        ----  --------<br/>  microbots.demo.madeden.net  <br/>            /   microbot:80 (&lt;none&gt;)<br/>Annotations:<br/>  first-cluster:  aws<br/>Events:<br/>  FirstSeen LastSeen  Count From        SubObjectPath Type    Reason    Message<br/>  --------- --------  ----- ----        ------------- --------  ------    -------<br/>  1d    3m    2 {federated-ingress-controller }     Normal    CreateInCluster Creating ingress in cluster azure<br/>  1d    1m    1 {federated-ingress-controller }     Normal    UpdateInCluster Updating ingress in cluster azure<br/>  1d    1m    6 {federated-ingress-controller }     Normal    CreateInCluster Creating ingress in cluster aws</span></pre><p id="8a75" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">显然这里有一个问题。入口已经<strong class="jf hj"> <em class="kj">而不是</em> </strong>被推送到所有集群。</p><p id="2afb" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">当集群没有部署在GCE/GKE时，这是一个已知的错误(这是迄今为止唯一测试联合的环境)</p><p id="eb34" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">你可以结账</p><ul class=""><li id="98a1" class="kn ko hi jf b jg kb jk kc jo kp js kq jw kr ka lb kt ku kv bi translated"><a class="ae lt" href="https://github.com/kubernetes/kubernetes/issues/33943" rel="noopener ugc nofollow" target="_blank">https://github.com/kubernetes/kubernetes/issues/33943</a></li><li id="328d" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">https://github.com/kubernetes/kubernetes/issues/34291<a class="ae lt" href="https://github.com/kubernetes/kubernetes/issues/34291" rel="noopener ugc nofollow" target="_blank"/></li></ul><p id="593d" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">了解更多细节。</p><p id="07ae" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">如果您想从日志中截取这个错误，</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="2f57" class="lo ig hi lk b fi lp lq l lr ls"># log from the Federation Controller Manager <br/>## And specific for the ingress creation<br/>E0210 08:54:08.464928 1 ingress_controller.go:725] Failed to ensure delete object from underlying clusters finalizer in ingress microbot-ingress: failed to add finalizer orphan to ingress : Operation cannot be fulfilled on ingresses.extensions “microbot-ingress”: the object has been modified; please apply your changes to the latest version and try again<br/>E0210 08:54:08.472338 1 ingress_controller.go:672] Failed to update annotation ingress.federation.kubernetes.io/first-cluster:aws on federated ingress “default/microbot-ingress”, will try again later: Operation cannot be fulfilled on ingresses.extensions “microbot-ingress”: the object has been modified; please apply your changes to the latest version and try again</span></pre><p id="a2ea" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">如果您尝试删除入口，情况最终会变得更糟，此时它根本不会消失，您必须在每个集群上删除。</p><p id="8d7e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">您仍然想要访问入口端点！下面是一个手动解决方法</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="7c5c" class="lo ig hi lk b fi lp lq l lr ls">for cloud in aws azure<br/>do<br/>  kubectl --context=${cloud} create -f src/manifests/microbots-ing.yaml <br/>done</span></pre><p id="dfbc" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">然后，您可以直接在托管区域中公开该服务</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="c230" class="lo ig hi lk b fi lp lq l lr ls"># Identify the public addresses of the workers<br/>juju switch aws<br/>AWS_INSTANCES="$(juju show-status kubernetes-worker --format json | jq --raw-output '.applications.kubernetes-worker".units[]."public-address"' | tr '\n' ' ')"</span><span id="b462" class="lo ig hi lk b fi mt lq l lr ls">juju switch azure<br/>AZURE_INSTANCES="$(juju show-status kubernetes-worker --format json | jq --raw-output '.applications."kubernetes-worker".units[]."public-address"' | tr '\n' ' ')"</span><span id="8780" class="lo ig hi lk b fi mt lq l lr ls"># Create the Zone File<br/>touch /tmp/zone.list<br/>for instance in ${AWS_INSTANCES} ${AZURE_INSTANCES}; <br/>do <br/>  echo "microbots.demo.madeden.net. IN A ${instance}" | tee -a /tmp/zone.list<br/>done</span><span id="76bf" class="lo ig hi lk b fi mt lq l lr ls"># Add a A record to the zone<br/>gcloud dns record-sets import -z demo-madeden \<br/>      --zone-file-format \<br/>      /tmp/zone.list</span></pre><p id="8e57" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">几分钟后，当你将浏览器指向这个端点时，你会看到Microbot网页，均匀地显示来自AWS和Azure实例的podnames。</p><p id="c11b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">因此，您可以创建世界范围的应用程序！！只是它没有像我们希望的那样自动化。</p><p id="e393" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">无论如何，这是90%的工作，这对于一个如此年轻的技术来说是相当惊人的。向开发者致敬！</p></div><div class="ab cl lu lv gp lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hb hc hd he hf"><h1 id="79ca" class="if ig hi bd ih ii mb ik il im mc io ip iq md is it iu me iw ix iy mf ja jb jc bi translated">拆毁</h1><p id="8fa3" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在得出结论之前，我们先来分析一下集群。</p><p id="7b41" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">拆除联邦既快又简单:您只需销毁名称空间！高效，即使正在努力使这个过程变得更好。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="e9a2" class="lo ig hi lk b fi lp lq l lr ls">kubectl --context=magicring delete clusters \<br/>  aws azure<br/>kubectl --context=gke delete namespace \<br/>  federation-system</span></pre><p id="0cee" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">摧毁GKE集群和DNS区域</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="c84e" class="lo ig hi lk b fi lp lq l lr ls">gcloud dns managed-zones delete demo-madeden<br/>gcloud container clusters delete gce --zone=us-east1-b</span></pre><p id="8a9c" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">摧毁2个Juju控制器</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="a9f8" class="lo ig hi lk b fi lp lq l lr ls"># AWS<br/>juju destroy-controller aws --destroy-all-models<br/>WARNING! This command will destroy the "k8s-us-west-2" controller.<br/>This includes all machines, applications, data and other resources.</span><span id="dd37" class="lo ig hi lk b fi mt lq l lr ls">Continue? (y/N):y<br/>Destroying controller<br/>Waiting for hosted model resources to be reclaimed<br/>Waiting on 1 model, 8 machines, 5 applications<br/>Waiting on 1 model, 8 machines, 5 applications<br/>Waiting on 1 model, 8 machines, 5 applications<br/>Waiting on 1 model, 8 machines, 5 applications<br/>Waiting on 1 model, 8 machines, 5 applications<br/>Waiting on 1 model, 8 machines, 5 applications<br/>Waiting on 1 model, 8 machines<br/>Waiting on 1 model, 8 machines<br/>Waiting on 1 model, 1 machine<br/>Waiting on 1 model, 1 machine<br/>Waiting on 1 model<br/>Waiting on 1 model<br/>All hosted models reclaimed, cleaning up controller machines<br/></span><span id="f64f" class="lo ig hi lk b fi mt lq l lr ls"># Azure<br/>juju destroy-controller azure --destroy-all-models<br/>WARNING! This command will destroy the "k8s-us-west-2" controller.<br/>This includes all machines, applications, data and other resources.</span><span id="4c55" class="lo ig hi lk b fi mt lq l lr ls">Continue? (y/N):y<br/>Destroying controller<br/>Waiting for hosted model resources to be reclaimed<br/>Waiting on 1 model, 8 machines, 5 applications<br/>Waiting on 1 model, 8 machines, 5 applications<br/>Waiting on 1 model, 8 machines, 5 applications<br/>Waiting on 1 model, 8 machines, 5 applications<br/>Waiting on 1 model, 8 machines, 5 applications<br/>Waiting on 1 model, 8 machines, 5 applications<br/>Waiting on 1 model, 8 machines<br/>Waiting on 1 model, 8 machines<br/>Waiting on 1 model, 1 machine<br/>Waiting on 1 model, 1 machine<br/>Waiting on 1 model<br/>Waiting on 1 model<br/>All hosted models reclaimed, cleaning up controller machines</span></pre><p id="bb90" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">瞧吧！你已经完成了今天的库伯内特联盟实验。</p></div><div class="ab cl lu lv gp lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hb hc hd he hf"><h1 id="b99a" class="if ig hi bd ih ii mb ik il im mc io ip iq md is it iu me iw ix iy mf ja jb jc bi translated">结论</h1><p id="10ea" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在就在多云/全球范围的解决方案上与联盟合作是否值得？<br/>肯定是的。Kubernetes的这一部分是任何企业现在都在关注的<strong class="jf hj"><em class="kj"/></strong>部分，了解其行为和架构绝对是一个优势。</p><p id="6db7" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">作为一家公司，你应该已经为此做好生产准备了吗？自担风险。</p><p id="ae55" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">Kubefed部署的联邦控制平面(从今天起)可以工作，但是依赖于一个由PV支持的etcd pod。不足以保证生产的稳定性和可靠性。因此，你需要工程来使它更坚固。由于<a class="ae lt" href="https://jujucharms.com/etcd/23" rel="noopener ugc nofollow" target="_blank"> Juju charms </a>可以大规模部署，etcd相对容易管理。但这仍然是一种努力。</p><p id="30f7" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">此外，AWS和GKE/GCE的一些关键功能(如入口分发)还没有准备好，这意味着除非你认真努力开发自己的解决方案，否则很有可能会受到影响。</p><p id="0df2" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">最后，脱离Google Cloud DNS或Route53，目前还没有可用的解决方案。快到了，但还没到。敬请期待*！</p><p id="a704" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">但是，您可以并且应该做的是通过使用<a class="ae lt" href="https://jujucharms.com/canonical-kubernetes/" rel="noopener ugc nofollow" target="_blank"> CDK </a>在每一个云上部署来真正增加k8s的深度，并了解解决方案如何适应这些环境，每种云的优缺点以及机器类型。</p><p id="6c42" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">作为DevOps社区中的个人，您应该与K8s和Federation合作吗？是啊！！！<br/>首先，对于任何有发布应用程序经验的人来说，这真的是一个游戏改变者，而且部署起来并不困难，即使是中等规模。</p><p id="db41" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">那么下一步是什么？到目前为止，我们已经涵盖了</p><ul class=""><li id="177a" class="kn ko hi jf b jg kb jk kc jo kp js kq jw kr ka lb kt ku kv bi translated"><a class="ae lt" href="https://hackernoon.com/installing-a-diy-bare-metal-gpu-cluster-for-kubernetes-364200254187" rel="noopener ugc nofollow" target="_blank">为k8s构建DYI GPU集群</a></li><li id="529f" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated"><a class="ae lt" rel="noopener" href="/@samnco/automate-the-deployment-of-kubernetes-in-existing-aws-infrastructure-aa369df2f651">将k8s与现有基础设施集成</a></li><li id="a6da" class="kn ko hi jf b jg kw jk kx jo ky js kz jw la ka lb kt ku kv bi translated">联邦的现状(本文)</li></ul><p id="2244" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">现在我需要更多的想法。另一个反复出现的问题是关于k8s中的身份管理，这可能是一个主题。</p><p id="d6c5" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">但是如果你有任何我应该做的酷的东西的想法…无论如何，在GitHub (SaMnCo)或# kubernetes-users Slack(Samuel-me)上评论并找到我</p></div></div>    
</body>
</html>