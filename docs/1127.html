<html>
<head>
<title>Express Routing with Google Cloud Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用谷歌云功能的快速路由</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/express-routing-with-google-cloud-functions-36fb55885c68?source=collection_archive---------0-----------------------#2019-08-27">https://medium.com/google-cloud/express-routing-with-google-cloud-functions-36fb55885c68?source=collection_archive---------0-----------------------#2019-08-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1485" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一切之下，用Node编写的Google Cloud函数通过<a class="ae jd" href="https://github.com/GoogleCloudPlatform/functions-framework-nodejs" rel="noopener ugc nofollow" target="_blank">函数框架</a>使用了极简的web框架<a class="ae jd" href="https://github.com/expressjs/express" rel="noopener ugc nofollow" target="_blank"> <em class="je"> Express </em> </a>。</p><p id="3840" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过几行节点，我们可以使用Express的额外功能，比如通过Express routing将URL路由到多个端点。这意味着使用路由请求到像<code class="du jf jg jh ji b">/users</code>、<code class="du jf jg jh ji b">/users/{id}</code>这样的URL。在本文中，我们将学习如何做到这一点！</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jj"><img src="../Images/a7134dc266382e0a54d00b4591888dd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dJSafMdxZkqv-vGBbpBi2Q.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">谷歌云功能在Express应用中调用不同的端点</figcaption></figure><p id="5f70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="je">路由</em>指的是应用程序的端点(URIs)如何响应客户端请求。</p><p id="82ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个路由可以有一个或多个处理函数，当路由匹配时，这些函数按顺序执行。</p><h1 id="5d0a" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">为什么这很重要？</h1><p id="2ae0" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">使用路由有助于构建<strong class="ih hj">逻辑</strong>、<strong class="ih hj"> RESTful </strong> web应用。与使用<code class="du jf jg jh ji b">if</code> / <code class="du jf jg jh ji b">else</code>条件语句或<code class="du jf jg jh ji b">switch</code>语句处理服务路由逻辑不同，我们可以利用Express先进而简单的路由特性！</p><p id="87cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我认为最好用一个比较的例子来说明:</p><h1 id="5761" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">没有快速路由的功能— ❌</h1><p id="473d" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">对于一个“Hello World”应用程序，拥有一个大的函数处理程序是可以接受的。然而，在您的应用程序发展之后，您可能会发现自己正在这样做…</p><figure class="jk jl jm jn fd jo"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">一个谷歌云函数处理器</figcaption></figure><p id="e006" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将您的URL处理程序放在单独的文件中:</p><figure class="jk jl jm jn fd jo"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">API函数路线</figcaption></figure><p id="9a1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如你所见，我们正在用我们的<code class="du jf jg jh ji b">req.url.split('/')[1]</code>创造一个潜在的混乱局面。事实上，这种实现仅限于处理一级路径路由。我们可能有互相重叠的路由案例。我们能避免使用<code class="du jf jg jh ji b">switch</code>语句吗？</p><p id="8a08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是快速路由的用武之地…</p><h1 id="c9f6" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">具有快速路由的功能— ✅️</h1><p id="0a9f" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated"><em class="je"> Express routing </em>内置了<code class="du jf jg jh ji b">express</code>模块，便于与功能框架集成。</p><p id="c6ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要开始，首先明确安装<code class="du jf jg jh ji b">express</code>:</p><p id="c672" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jf jg jh ji b">npm i express</code></p><blockquote class="le lf lg"><p id="ebcf" class="if ig je ih b ii ij ik il im in io ip lh ir is it li iv iw ix lj iz ja jb jc hb bi translated">事实上，您的函数已经在函数框架中使用express了(不管您是否知道)，所以您没有增加额外的依赖性。</p></blockquote><p id="e396" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，将你的方法分成单独的<code class="du jf jg jh ji b">express</code>应用程序。这叫做<em class="je">应用级中间件</em>。</p><p id="bc16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，我们将展示与上面相同的代码，但是使用基本的快速路由而不是一个<code class="du jf jg jh ji b">switch</code>语句:</p><figure class="jk jl jm jn fd jo"><div class="bz dy l di"><div class="lc ld l"/></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">通过快速路由的API路由</figcaption></figure><p id="cb03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们显式地创建了一个<code class="du jf jg jh ji b">express</code>对象，并使用<code class="du jf jg jh ji b"><a class="ae jd" href="http://expressjs.com/en/4x/api.html#app.use" rel="noopener ugc nofollow" target="_blank">app.use</a></code>将路由功能定义为中间件。我们可以很容易地指定URL路径参数，如<code class="du jf jg jh ji b">:id</code>，这些参数将在<code class="du jf jg jh ji b">req.params.id</code>下的处理程序中可用。既然您已经定义了<code class="du jf jg jh ji b">express</code>对象，那么您还可以考虑使用其他中间件，比如<a class="ae jd" href="https://github.com/expressjs/cookie-parser" rel="noopener ugc nofollow" target="_blank">解析cookie</a>，提供静态内容等。</p><p id="d878" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是如何在函数框架中使用快速路由的方法！</p><p id="b513" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢阅读。</p><h2 id="ed21" class="lk ka hi bd kb ll lm ln kf lo lp lq kj iq lr ls kn iu lt lu kr iy lv lw kv lx bi translated">有关于使用节点函数框架的问题吗？</h2><p id="aebb" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">通过在<a class="ae jd" href="https://github.com/GoogleCloudPlatform/functions-framework-nodejs/" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上创建新一期来给我们反馈！我们正在构建更多关于如何使用函数框架的文档，比如使用Docker和使用云事件。</p><h2 id="b798" class="lk ka hi bd kb ll lm ln kf lo lp lq kj iq lr ls kn iu lt lu kr iy lv lw kv lx bi translated"><strong class="ak">了解有关函数框架的更多信息！</strong></h2><p id="7c30" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">查看其他相关资源:</p><ul class=""><li id="2f01" class="ly lz hi ih b ii ij im in iq ma iu mb iy mc jc md me mf mg bi translated">📹<a class="ae jd" href="https://www.youtube.com/watch?v=nld4P0AOt10" rel="noopener ugc nofollow" target="_blank">观看关于快递路线的视频</a></li><li id="2eb0" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">💻<a class="ae jd" href="https://github.com/GoogleCloudPlatform/functions-framework-nodejs" rel="noopener ugc nofollow" target="_blank">在GitHub上浏览函数框架的源代码</a></li><li id="3d27" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">📄<a class="ae jd" href="https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/routes" rel="noopener ugc nofollow" target="_blank">在Mozilla的文档中阅读更多关于快速路由的信息</a></li></ul></div></div>    
</body>
</html>