<html>
<head>
<title>Using single Docker repository with multiple GKE projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在多个GKE项目中使用单个Docker存储库</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/using-single-docker-repository-with-multiple-gke-projects-1672689f780c?source=collection_archive---------3-----------------------#2017-02-10">https://medium.com/google-cloud/using-single-docker-repository-with-multiple-gke-projects-1672689f780c?source=collection_archive---------3-----------------------#2017-02-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="70eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在所有谷歌容器引擎(GKE)教程中，你会看到属于这个项目的Docker资源库:<strong class="ih hj">gcr.io/&lt;你-项目-名称&gt; / </strong>。它的优点是开箱即用，不需要任何设置(当然除了启用GKE本身)。然而，如果你有多个GKE项目使用相同的Docker图像，你该怎么办？例如，使用CI系统构建的Docker映像的测试、试运行和生产环境。不得不推送到多个存储库，并且不得不在Kubernetes YAML文件中指定不同的存储库是很麻烦的。我们希望有一个单一的存储库，我们可以从中部署到多个项目。</p><p id="4258" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">拥有一个单一的存储库很容易——只需创建另一个专门的谷歌云项目，比如说<mycompany-docker>,现在你可以用<strong class="ih hj">gcr.io/&lt;my company-Docker&gt;/</strong>给你的Docker图片加标签，然后推送。然而，如果您试图从另一个项目引用这样的图像，您将得到Kubernetes的错误，而部署说，它不能拉图像。这是意料之中的，当然GKE库是受访问保护的，并且只能从同一个项目中获得。我们想要的是提供对这个Docker存储库的其他项目的读取权限。原来Kubernetes部署是在名为“计算引擎默认服务帐户”的特殊服务帐户下执行的，这就是我们想要授予读取权限的帐户。</mycompany-docker></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/13f832ed5e372d351b9f86d8be4a1997.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dgOca6Na3yMQgEsLA7vgFg.png"/></div></div></figure><p id="ac48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第一步。获取服务帐户ID。<br/> </strong>在云控制台转到你的GKE项目(一个使用Docker映像的项目)，转到“IAM &amp; Admin”选项卡，在服务帐户中找到“计算引擎默认服务帐户”。记下帐户ID，看起来像电子邮件格式。对所有可以访问Docker存储库的项目重复这个步骤。</p><p id="0642" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第二步。将帐户添加到访问列表。</strong> <br/>切换到你的Docker repo项目，进入“IAM和管理标签”，选择“IAM”左侧标签，点击顶部的添加+按钮。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jp"><img src="../Images/61f012886e507b8c8f788e08ed0995b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ikNnrdyJXys5jec9SzACow.png"/></div></div></figure><p id="66f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并将“存储对象查看者”权限授予您在步骤1中记录的所有服务帐户。将服务账户ID复制到“<strong class="ih hj">成员</strong>字段，并在如下所示的菜单中选择权限。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jq"><img src="../Images/baff72e4b0a575b916bac407b834a3f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1RrYialGoMAQi_IfjF76qA.png"/></div></div></figure><p id="92c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样。现在，您可以在Kubernetes YAML配置文件中引用您的中央Docker存储库，并从登台和生产环境中访问它，同时保持该存储库的私有性。</p></div></div>    
</body>
</html>