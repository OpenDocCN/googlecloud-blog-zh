<html>
<head>
<title>Knative v0.16.0 update</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Knative v0.16.0更新</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/knative-v0-16-0-update-5a5690e5354c?source=collection_archive---------4-----------------------#2020-07-22">https://medium.com/google-cloud/knative-v0-16-0-update-5a5690e5354c?source=collection_archive---------4-----------------------#2020-07-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/649ae9b8596972e7b91b6634f9ce39c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b8vQGq4qX-RAgrA-jNr-og.png"/></div></div></figure><p id="e81c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我终于把我的<a class="ae jo" href="https://github.com/meteatamel/knative-tutorial" rel="noopener ugc nofollow" target="_blank"> Knative教程</a>从Knative <code class="du jp jq jr js b">v0.14.0</code>更新到了最新的Knative <code class="du jp jq jr js b">v0.16.0</code> <a class="ae jo" href="https://github.com/knative/serving/releases/tag/v0.16.0" rel="noopener ugc nofollow" target="_blank">版本</a>。由于我跳过了<code class="du jp jq jr js b">v0.15.0</code>，我不确定哪些变化是由于<code class="du jp jq jr js b">v0.15.0</code>对<code class="du jp jq jr js b">v0.16.0</code>。不管怎样，我想在这篇博文中概述一些值得注意的变化。这并不意味着是一份详尽的清单。如果有其他值得注意的变化，请在评论中告诉我。</p><h1 id="e0a4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">糖控制器</h1><p id="fe8c" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">当我更新到<code class="du jp jq jr js b">v0.16.0</code>时，我意识到<code class="du jp jq jr js b">Broker</code>注入默认名称空间不起作用。原来，你需要安装一个新的<code class="du jp jq jr js b">Sugar Controller</code>来进行<code class="du jp jq jr js b">Broker</code>注射。<a class="ae jo" href="https://knative.dev/docs/install/any-kubernetes-cluster/" rel="noopener ugc nofollow" target="_blank">安装控制器</a>页面有更多细节，我的<a class="ae jo" href="https://github.com/meteatamel/knative-tutorial/tree/master/setup" rel="noopener ugc nofollow" target="_blank">设置</a>脚本已经更新，可以安装这个控制器。这是您安装它的方式:</p><pre class="kw kx ky kz fd la js lb lc aw ld bi"><span id="dd99" class="le ju hi js b fi lf lg l lh li">kubectl apply -f \ <a class="ae jo" href="https://github.com/knative/eventing/releases/download/v0.16.0/eventing-sugar-controller.yaml" rel="noopener ugc nofollow" target="_blank">https://github.com/knative/eventing/releases/download/v0.16.0/eventing-sugar-controller.yaml</a></span></pre><p id="d1dd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这允许您:</p><ol class=""><li id="a968" class="lj lk hi is b it iu ix iy jb ll jf lm jj ln jn lo lp lq lr bi translated">当一个名称空间标有<code class="du jp jq jr js b">eventing.knative.dev/injection=enabled</code>时，控制器将在该名称空间中创建一个默认的<code class="du jp jq jr js b">Broker</code>。</li><li id="038c" class="lj lk hi is b it ls ix lt jb lu jf lv jj lw jn lo lp lq lr bi translated">当一个触发器用<code class="du jp jq jr js b">eventing.knative.dev/injection=enabled</code>注释时，控制器将在<code class="du jp jq jr js b">Trigger</code>的名称空间中创建一个由那个<code class="du jp jq jr js b">Trigger</code>命名的<code class="du jp jq jr js b">Broker</code>。</li></ol><h1 id="8638" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">代理注入的名称空间标签</h1><p id="53f6" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">如果你很小心，你已经意识到<code class="du jp jq jr js b">Broker</code>注入的名称空间标签曾经是:</p><pre class="kw kx ky kz fd la js lb lc aw ld bi"><span id="ae55" class="le ju hi js b fi lf lg l lh li">knative-eventing-injection</span></pre><p id="7a9f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，它变成了:</p><pre class="kw kx ky kz fd la js lb lc aw ld bi"><span id="5a90" class="le ju hi js b fi lf lg l lh li">eventing.knative.dev/injection</span></pre><p id="62ec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，为了将<code class="du jp jq jr js b">Broker</code>注入到名称空间中(在本例中为<code class="du jp jq jr js b">default</code>，您必须将您的名称空间标记如下:</p><pre class="kw kx ky kz fd la js lb lc aw ld bi"><span id="226f" class="le ju hi js b fi lf lg l lh li">kubectl label ns default eventing.knative.dev/injection=enabled</span></pre><h1 id="d0db" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">默认代理URL</h1><p id="8201" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">一旦<code class="du jp jq jr js b">Broker</code>启动并运行，您还会意识到默认的<code class="du jp jq jr js b">Broker</code> URL也发生了变化。如果将<code class="du jp jq jr js b">Broker</code>注入到<code class="du jp jq jr js b">default</code>名称空间中，URL应该是这样的:</p><pre class="kw kx ky kz fd la js lb lc aw ld bi"><span id="c7d7" class="le ju hi js b fi lf lg l lh li"><a class="ae jo" href="http://default-broker.default.svc.cluster.local" rel="noopener ugc nofollow" target="_blank">http://default-broker.default.svc.cluster.local</a></span></pre><p id="d772" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，新的网址是:</p><pre class="kw kx ky kz fd la js lb lc aw ld bi"><span id="a1b3" class="le ju hi js b fi lf lg l lh li"><a class="ae jo" href="http://broker-ingress.knative-eventing.svc.cluster.local/default/default" rel="noopener ugc nofollow" target="_blank">http://broker-ingress.knative-eventing.svc.cluster.local/default/default</a></span></pre><p id="d7e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最好记住是否需要向<code class="du jp jq jr js b">Broker</code>发送消息。</p><h1 id="d823" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">GCP API版本</h1><p id="f976" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">如你所知，<a class="ae jo" href="https://github.com/google/knative-gcp" rel="noopener ugc nofollow" target="_blank"> Knative-GCP </a>项目对于将谷歌云事件读入Knative集群非常有用。它还有一个<code class="du jp jq jr js b">v0.16.0</code> <a class="ae jo" href="https://github.com/google/knative-gcp/releases/tag/v0.16.0" rel="noopener ugc nofollow" target="_blank">释放</a>。这样，你现在可以从<code class="du jp jq jr js b">v1alpha1</code>转移到<code class="du jp jq jr js b">v1beta1</code> API。这会影响您定义信号源的时间，例如<code class="du jp jq jr js b">CloudStorageSource</code>。您可以使用较新的API:</p><pre class="kw kx ky kz fd la js lb lc aw ld bi"><span id="d38b" class="le ju hi js b fi lf lg l lh li">apiVersion: events.cloud.google.com/v1beta1<br/>kind: CloudStorageSource<br/>...</span></pre><h1 id="ff63" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">谷歌云事件</h1><p id="5577" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated"><code class="du jp jq jr js b">v0.16.0</code>中另一个值得注意的变化是Knative-GCP现在使用新的CloudEvent属性和数据模式，所有的数据源现在都发出这些cloud event。你可以在<a class="ae jo" href="https://github.com/googleapis/google-cloudevents" rel="noopener ugc nofollow" target="_blank"> google-cloudevents </a>存储库中看到CloudEvents的列表。</p><p id="6233" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，如果您想在云存储中监听存储桶中的文件更新，您可以使用<code class="du jp jq jr js b">com.google.cloud.storage.object.finalize</code>过滤器创建一个触发器:</p><pre class="kw kx ky kz fd la js lb lc aw ld bi"><span id="ad35" class="le ju hi js b fi lf lg l lh li">apiVersion: eventing.knative.dev/v1beta1<br/>kind: Trigger<br/>metadata:<br/>  name: trigger<br/>spec:<br/>  filter:<br/>    attributes:<br/>      type: com.google.cloud.storage.object.finalize</span></pre><p id="b839" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您需要使用<a class="ae jo" href="https://github.com/googleapis/google-cloudevents" rel="noopener ugc nofollow" target="_blank"> google-cloudevents </a>中列出的新CloudEvents。相反，相同的触发器需要在<code class="du jp jq jr js b">google.cloud.storage.object.v1.finalized</code>上过滤:</p><pre class="kw kx ky kz fd la js lb lc aw ld bi"><span id="8306" class="le ju hi js b fi lf lg l lh li">apiVersion: eventing.knative.dev/v1beta1<br/>kind: Trigger<br/>metadata:<br/>  name: trigger<br/>spec:<br/>  filter:<br/>    attributes:<br/>      type: google.cloud.storage.object.v1.finalized</span></pre><h1 id="ece1" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">CloudSchedulerSource更改</h1><p id="6f87" class="pw-post-body-paragraph iq ir hi is b it kr iv iw ix ks iz ja jb kt jd je jf ku jh ji jj kv jl jm jn hb bi translated">最后但同样重要的是，我已经意识到<code class="du jp jq jr js b">CloudSchedulerSource</code>事件略有变化。比如，看看下面这个<code class="du jp jq jr js b">CloudSchedulerSource</code>:</p><pre class="kw kx ky kz fd la js lb lc aw ld bi"><span id="b532" class="le ju hi js b fi lf lg l lh li">apiVersion: events.cloud.google.com/v1beta1<br/>kind: CloudSchedulerSource<br/>metadata:<br/>  name: schedulersource-cy<br/>spec:<br/>  location: "europe-west1"<br/>  data: "Cyprus"<br/>  schedule: "0 17 * * *"<br/>  sink:<br/>    ref:<br/>      apiVersion: eventing.knative.dev/v1beta1<br/>      kind: Broker<br/>      name: default</span></pre><p id="31b2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">过去，您会得到一个在<code class="du jp jq jr js b">Data</code>字段中带有<code class="du jp jq jr js b">Cyprus</code>的CloudEvents。在<code class="du jp jq jr js b">v0.16.0</code>中，您会得到一个值为<code class="du jp jq jr js b">{"custom_data":"Q3lwcnVz"}</code>的<code class="du jp jq jr js b">Data</code>字段。这基本上是<code class="du jp jq jr js b">Cyprus</code> Base64编码，保存在<code class="du jp jq jr js b">custom_data</code>下。当您在代码中解析CloudEvent时，需要考虑到这一点。</p></div><div class="ab cl lx ly gp lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hb hc hd he hf"><p id="f370" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些是在<code class="du jp jq jr js b">v0.16.0</code>中要注意的变化。我错过什么了吗？如果有，请在评论中告诉我或者在Twitter上联系我(<a class="ae jo" href="https://twitter.com/meteatamel" rel="noopener ugc nofollow" target="_blank"> @meteatamel </a>)。</p></div><div class="ab cl lx ly gp lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hb hc hd he hf"><p id="78de" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="me">原发布于</em><a class="ae jo" href="https://atamel.dev/posts/2020/07-22_knative-v0-16-0-update/" rel="noopener ugc nofollow" target="_blank"><em class="me">https://atamel . dev</em></a><em class="me">。</em></p></div></div>    
</body>
</html>