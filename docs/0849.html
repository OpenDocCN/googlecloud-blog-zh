<html>
<head>
<title>Serverless Continuous Integration and OTA update flow for IoT devices using Google Cloud Build and Arduino</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Google Cloud Build和Arduino的物联网设备的无服务器持续集成和OTA更新流程</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/serverless-continuous-integration-and-ota-update-flow-using-google-cloud-build-and-arduino-d5e1cda504bf?source=collection_archive---------0-----------------------#2018-12-14">https://medium.com/google-cloud/serverless-continuous-integration-and-ota-update-flow-using-google-cloud-build-and-arduino-d5e1cda504bf?source=collection_archive---------0-----------------------#2018-12-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="d98c" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">如何在云中持续构建您的固件并自动发送到您的设备。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/5dc7469a89557e7409f90b68a50a4347.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tOVXtfLuYXy_BtnMdVecfA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">项目架构</figcaption></figure><p id="77f4" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">空中添加(OTA)更新是物联网应用成功的重要因素。这是一种确保设备始终保持最新的新设置、安全修复以及向硬件添加新功能的机制，让带来设备的客户对硬件改进感到满意，同时感到更安全。</p><p id="c0c3" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">OTA架构有两个重要部分:</p><ul class=""><li id="5a8b" class="kj kk hi jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated"><strong class="jp hj">远程设备</strong>:负责检查更新，下载新版本并应用于自身。</li><li id="b5d5" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated"><strong class="jp hj">云服务器</strong>:负责构建、分发和管理连接设备的更新。</li></ul><p id="8954" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在这里，我将展示如何使用一些<strong class="jp hj">谷歌云</strong>工具设置初始OTA机制，使用<strong class="jp hj"> Arduino </strong>平台将更新部署到<strong class="jp hj"> ESP8266 </strong>和<strong class="jp hj"> ESP32 </strong>板。</p><p id="e86f" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj"> PlatformIO </strong>将用于构建映像，因为它有一套命令行工具，使我们能够自动为设备生成二进制映像。在Google Cloud上，我们将使用<strong class="jp hj"> Google Cloud Build </strong>，这是一个托管的<strong class="jp hj">持续集成</strong>环境，<strong class="jp hj"> Google Cloud Storage </strong>用于在云上存储二进制映像，<strong class="jp hj"> Cloud Functions </strong>用于处理HTTP请求，查询当前固件版本并管理它们。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/5dc7469a89557e7409f90b68a50a4347.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tOVXtfLuYXy_BtnMdVecfA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">项目架构</figcaption></figure><h1 id="1f66" class="kx ky hi bd kz la lb lc ld le lf lg lh io li ip lj ir lk is ll iu lm iv ln lo bi translated">PlatformIO入门</h1><p id="7b25" class="pw-post-body-paragraph jn jo hi jp b jq lp ij js jt lq im jv jw lr jy jz ka ls kc kd ke lt kg kh ki hb bi translated">PlatformIO是一套用于嵌入式设备开发的跨平台工具。它支持许多不同的物联网开发平台和框架，也支持社区制作的大量库，可以轻松用于您的项目。</p><p id="55a0" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我建议安装Visual Studio代码(VSCode) IDE和PlatformIO插件来开始使用它。只需按照下面链接中的步骤操作:</p><div class="lu lv ez fb lw lx"><a href="https://platformio.org/platformio-ide" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hj fi z dy mc ea eb md ed ef hh bi translated">PlatformIO:面向物联网开发的开源生态系统</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">跨平台构建系统和库管理器。跨平台IDE和统一调试器。远程单元测试和…</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">platformio.org</p></div></div><div class="mg l"><div class="mh l mi mj mk mg ml jh lx"/></div></div></a></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mm"><img src="../Images/3b997dbfd4e8e0f74663b146592eebe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/0*qJkicYOjk2Y8cM9N.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">安装PlatformIO VSCode插件</figcaption></figure><p id="9688" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这个项目的代码可以在下面的Github链接中找到。克隆或下载项目代码，并在IDE上打开它。</p><div class="lu lv ez fb lw lx"><a href="https://github.com/alvarowolfx/gcloud-ota-arduino-update" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hj fi z dy mc ea eb md ed ef hh bi translated">alvarowolfx/g cloud-OTA-arduino-更新</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">在GitHub上创建一个帐户，为alvarowolfx/g cloud-OTA-arduino-update开发做贡献。</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">github.com</p></div></div><div class="mg l"><div class="mn l mi mj mk mg ml jh lx"/></div></div></a></div><p id="e9e0" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><code class="du mo mp mq mr b">platformio.ini</code>文件包含在ESP32和ESP8266板上构建项目的所有配置。此外，这里还列出了项目依赖关系。一个重要的配置是构建标志<code class="du mo mp mq mr b">VERSION</code>，它在项目代码上编译，以标记设备当前运行的版本。因此，每次我们创建一个新的固件版本时，这段代码都应该被删除，以便设备能够正确检查是否需要下载新版本。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><p id="d49d" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">设备代码向后端发出HTTP查询，发送当前版本，检查是否应该下载新版本。此外，还有一个设备内部HTTP处理程序来显示当前版本。为了处理WiFi连接，该项目使用了<strong class="jp hj"> WifiManager </strong>库，它创建了一个接入点来在设备上设置Wifi。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><p id="7e03" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">要部署到主板，您可以使用PlatformIO工具栏上的“构建”和“上传”按钮:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mu"><img src="../Images/ed2ffe85bafc5ebb65da128fcbf4b901.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*8TidpTyScg677OU3lOGWyw.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">图片来自PlatformIO快速入门<a class="ae mv" href="https://docs.platformio.org/en/latest/ide/vscode.html#id2" rel="noopener ugc nofollow" target="_blank">https://docs.platformio.org/en/latest/ide/vscode.html#id2</a></figcaption></figure><h1 id="54e7" class="kx ky hi bd kz la lb lc ld le lf lg lh io li ip lj ir lk is ll iu lm iv ln lo bi translated">设置云构建和Git存储库</h1><p id="629f" class="pw-post-body-paragraph jn jo hi jp b jq lp ij js jt lq im jv jw lr jy jz ka ls kc kd ke lt kg kh ki hb bi translated">要开始使用谷歌云，你可以在云控制台web界面上做所有的事情，但命令行工具是一个更强大的工具，我们需要稍后部署云功能。要使用<code class="du mo mp mq mr b">gcloud</code>命令行工具，<a class="ae mv" href="https://cloud.google.com/sdk/downloads" rel="noopener ugc nofollow" target="_blank">按照这里的说明下载并安装</a>。</p><div class="lu lv ez fb lw lx"><a href="https://console.cloud.google.com/projectcreate" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hj fi z dy mc ea eb md ed ef hh bi translated">谷歌云平台</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">Google云平台让您可以在同一基础设施上构建、部署和扩展应用程序、网站和服务…</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">console.cloud.google.com</p></div></div><div class="mg l"><div class="mw l mi mj mk mg ml jh lx"/></div></div></a></div><div class="lu lv ez fb lw lx"><a href="https://cloud.google.com/sdk/downloads" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hj fi z dy mc ea eb md ed ef hh bi translated">安装Google Cloud SDK | Cloud SDK文档| Google Cloud</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">编辑描述</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">cloud.google.com</p></div></div></div></a></div><p id="cfb1" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">此外，在此之后，您应该验证并创建一个在本教程中使用的项目，用您想要的名称替换<code class="du mo mp mq mr b">YOUR_PROJECT_NAME</code>:</p><pre class="iy iz ja jb fd mx mr my mz aw na bi"><span id="7e0a" class="nb ky hi mr b fi nc nd l ne nf"># Authenticate with Google Cloud:<br/>gcloud auth login<br/># Create cloud project — choose your unique project name:<br/>gcloud projects create YOUR_PROJECT_NAME<br/># Set current project<br/>gcloud config set project YOUR_PROJECT_NAME</span></pre><p id="6ea5" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在让我们创建云构建配置和存储二进制文件的存储桶。遵循以下步骤:</p><p id="84c1" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj">云构建设置:</strong></p><ul class=""><li id="3e2a" class="kj kk hi jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated">打开<a class="ae mv" href="https://console.cloud.google.com/cloud-build" rel="noopener ugc nofollow" target="_blank">云构建页面</a>。</li><li id="203d" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">启用<strong class="jp hj">云构建API </strong>如果尚未启用。</li><li id="5d5f" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">选择<strong class="jp hj">触发器选项卡</strong>。</li><li id="5b93" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">点击<strong class="jp hj">创建触发器</strong>。</li><li id="2e8f" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">现在您可以选择您的Git存储库并向您的提供者进行认证。我用了Github。</li><li id="95d1" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">在最后一步，<strong class="jp hj">触发器设置</strong>，让我们通过git标签创建一个触发器。</li><li id="3971" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">将其命名为“由构建标签触发”。</li><li id="50fc" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">选择<strong class="jp hj">标签</strong>作为<strong class="jp hj">触发类型</strong>。</li><li id="aad1" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">选择<strong class="jp hj"> cloudbuild.yaml </strong>作为<strong class="jp hj">构建配置</strong>类型。</li><li id="1417" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">点击<strong class="jp hj">创建触发器</strong>。</li></ul><p id="1342" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated"><strong class="jp hj">云存储设置</strong>:</p><ul class=""><li id="5956" class="kj kk hi jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated">现在打开<a class="ae mv" href="https://console.cloud.google.com/storage/browser" rel="noopener ugc nofollow" target="_blank">云存储页面</a></li><li id="3a06" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">选择<strong class="jp hj">浏览器标签</strong>。</li><li id="7e47" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">点击<strong class="jp hj">创建存储桶</strong>。</li><li id="b98f" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">创建一个名为<code class="du mo mp mq mr b">YOUR_PROJECT_NAME-firmwares</code>的桶，并选择其他值作为默认值。在我的例子中，这个桶的名字是<code class="du mo mp mq mr b">gcloud-ota-update-firmwares</code>。</li><li id="6cee" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">点击<strong class="jp hj">创建</strong>。</li></ul><p id="7cb5" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们的存储库包含一个cloudbuild.yaml文件，该文件包含构建固件和推送到云存储的所有配置。Cloud Build使用Docker来构建工件，所以我使用了一个包含所有PlatformIO工具的映像，使用我们的<code class="du mo mp mq mr b">platformio.ini</code>文件来构建嵌入式项目。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">云构建文件。</figcaption></figure><p id="025c" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在，每当您将新的标签推送到您的存储库时，它将触发一个基于云构建的构建。您可以在git提供程序的UI上创建标记，也可以使用下面的git命令来完成。</p><pre class="iy iz ja jb fd mx mr my mz aw na bi"><span id="d63f" class="nb ky hi mr b fi nc nd l ne nf">git tag -a v1.0.0 -m "First build"<br/>git push -u origin --tags</span></pre><p id="e3ac" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如果一切正常，当您推送新标签时，您应该会在云构建页面的历史标签上看到一些构建。我们将在文章的最后再次讨论这个问题，看看如何推出新版本。</p><h1 id="bd41" class="kx ky hi bd kz la lb lc ld le lf lg lh io li ip lj ir lk is ll iu lm iv ln lo bi translated">部署云功能</h1><p id="147b" class="pw-post-body-paragraph jn jo hi jp b jq lp ij js jt lq im jv jw lr jy jz ka ls kc kd ke lt kg kh ki hb bi translated">为了控制OTA过程，我们基本上需要两件事情:将固件元数据存储在数据库中，以便我们可以稍后查询最新版本，以及检查是否给定了当前设备版本的方法，检查是否有更新设备的需要。为此，我构建了两个云函数:</p><ul class=""><li id="4346" class="kj kk hi jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated"><strong class="jp hj">insertFirmwaresOnBigquery</strong>:当有新文件上传到云存储时触发该功能。通过这种方式，我们将这些元数据存储在BigQuery上，以便以后可以通过设备变体和固件版本进行查询和过滤。</li></ul><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><ul class=""><li id="4446" class="kj kk hi jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated"><strong class="jp hj"> getDownloadUrl </strong>:这是一个HTTP函数，它接收当前设备版本及其变体(在本例中是esp32或esp8266)。然后，它向BigQuery查询最新版本，并将设备版本与最新固件版本进行比较。</li></ul><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><p id="0430" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在您将需要我们在开始时安装的<code class="du mo mp mq mr b">gcloud</code>工具来部署这些功能。修改文件<code class="du mo mp mq mr b">deploy-prod.sh</code>上的项目ID，并运行它来部署这两个功能。第一次，它可能会要求启用云函数API。确认一下，然后继续这个过程。</p><pre class="iy iz ja jb fd mx mr my mz aw na bi"><span id="5d95" class="nb ky hi mr b fi nc nd l ne nf">./deploy-prod.sh</span></pre><p id="27ba" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">使用这个命令，所有的功能都将部署到我们的架构中，并对事件做出反应。</p><h1 id="a6db" class="kx ky hi bd kz la lb lc ld le lf lg lh io li ip lj ir lk is ll iu lm iv ln lo bi translated">推出新版本</h1><p id="93ad" class="pw-post-body-paragraph jn jo hi jp b jq lp ij js jt lq im jv jw lr jy jz ka ls kc kd ke lt kg kh ki hb bi translated">推送和构建一个可以被设备下载的新版本很简单，只需几个git命令，我们就可以触发一个新的持续集成构建。所以，让我们假设你给设备增加了一个新的功能，比如循环函数上的一个闪烁。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">小代码添加到我们的新固件版本。</figcaption></figure><p id="4e53" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在要创建一个新的版本，更改<code class="du mo mp mq mr b">platformio.ini</code>文件的版本，例如从v1.1.0到v1.2.0，提交更改的文件，标记新的提交，并将所有文件推送到存储库。以下是命令:</p><pre class="iy iz ja jb fd mx mr my mz aw na bi"><span id="fd27" class="nb ky hi mr b fi nc nd l ne nf"># Commit the files<br/>git add src/main.cpp platformio.ini<br/>git commit -m "[feat] Add blink feature"<br/># Tag this commit<br/>git tag -a v1.2.0 -m "Add blink feature"<br/># Send to the repository with the tags<br/>git push -u origin master --tags</span></pre><p id="c658" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这将触发我们的所有进程，当这一切都完成后，您可以使用旧版本重置您的设备，并在日志中看到它将下载新版本并自行重置。如果一切正常，你应该开始看到你的LED闪烁。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ng"><img src="../Images/f0529dfcbc32d048871a2757f1490649.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*0Py3ERCpDyGjKeGlm1sRtw.gif"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">项目构建和接收新固件的设备。</figcaption></figure><h1 id="2fc0" class="kx ky hi bd kz la lb lc ld le lf lg lh io li ip lj ir lk is ll iu lm iv ln lo bi translated">结论</h1><p id="abfc" class="pw-post-body-paragraph jn jo hi jp b jq lp ij js jt lq im jv jw lr jy jz ka ls kc kd ke lt kg kh ki hb bi translated">我希望本教程能够让您大致了解如何实现这一过程的自动化，以实现更好的物联网部署。我们经历了OTA部署过程中的许多环节，但当然，这还太简单了。我们可以通过添加更多功能来改进，例如:</p><ul class=""><li id="daae" class="kj kk hi jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated">发布渠道:不同的设备检查不同的渠道，如生产，测试和阿尔法渠道。通过这种方式，我们可以限制内部设备只能接收公司测试的新版本，然后将该版本推送给所有客户。</li><li id="3118" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">使用设备上的私钥来验证设备是否可以接收这些更新，并使整个过程更加安全。</li><li id="5e96" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated">在一定时间范围内检查更新，并提供用户反馈:当更新到来时，用户可以使用设备，我们应该处理这个问题，并等待用户确认更新过程。这样，我们就不会因为新的更新到来就阻止用户与设备的交互。</li></ul><p id="d822" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">参考资料:</p><ul class=""><li id="69ad" class="kj kk hi jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated"><a class="ae mv" href="https://dzone.com/articles/how-to-approach-ota-updates-for-iot" rel="noopener ugc nofollow" target="_blank">https://dzone . com/articles/how-to-approach-OTA-updates-for-IOT</a></li><li id="86f4" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated"><a class="ae mv" href="https://cloud.google.com/functions/docs/writing" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/functions/docs/writing</a></li><li id="1997" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated"><a class="ae mv" href="https://cloud.google.com/functions/docs/tutorials/storage" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/functions/docs/tutorials/storage</a></li><li id="be18" class="kj kk hi jp b jq ks jt kt jw ku ka kv ke kw ki ko kp kq kr bi translated"><a class="ae mv" href="http://docs.platformio.org/en/latest/userguide/cmd_ci.html" rel="noopener ugc nofollow" target="_blank">http://docs.platformio.org/en/latest</a></li></ul></div></div>    
</body>
</html>