<html>
<head>
<title>Unikernel on Google Compute Engine (Part 1) — Running an OSv Unikernel Tomcat Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google计算引擎上的单核(第1部分)——运行OSv单核Tomcat服务器</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/unikernel-on-google-compute-engine-part-1-running-an-osv-unikernel-tomcat-server-45bd9816910?source=collection_archive---------3-----------------------#2015-11-03">https://medium.com/google-cloud/unikernel-on-google-compute-engine-part-1-running-an-osv-unikernel-tomcat-server-45bd9816910?source=collection_archive---------3-----------------------#2015-11-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/d4a4e1fdbaf5eda1a0c32dbe8fdc5dbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xwT6W6kFiBUyzclqY1wVSg.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">在Google计算引擎上运行Tomcat的OSv单核</figcaption></figure><div class=""/><p id="9fb9" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是一个关于在谷歌计算引擎上运行单内核的简短指南。这里的<a class="ae js" rel="noopener" href="/@darrenrush/after-docker-unikernels-and-immutable-infrastructure-93d5a91c849e#.44qbly84t">是一本很好的入门书</a>，讲述了为什么你应该关注单核。我使用了<a class="ae js" href="http://osv.io/" rel="noopener ugc nofollow" target="_blank"> OSv </a> unikernel，因为它支持Java，而Java是我选择的语言。此外，OSv的图像构建工具<a class="ae js" href="https://github.com/cloudius-systems/capstan" rel="noopener ugc nofollow" target="_blank">绞盘</a>，感觉类似于Docker，所以我觉得我可以很快上手。</p><p id="45c7" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你可能在谷歌计算引擎指南上看到过<a class="ae js" href="https://github.com/cloudius-systems/osv/wiki/Running-OSv-on-Google-Compute-Engine" rel="noopener ugc nofollow" target="_blank">运行OSv，但是说明似乎已经过时了(见</a><a class="ae js" href="https://github.com/cloudius-systems/osv/issues/665" rel="noopener ugc nofollow" target="_blank">期</a>)。目前，绞盘工具在为谷歌计算引擎构建图像时存在问题(参见<a class="ae js" href="https://github.com/cloudius-systems/capstan/issues/146" rel="noopener ugc nofollow" target="_blank">问题</a>)。因此，这次经历并不像我希望的那样简单，但我决心让它成功。</p><h2 id="938d" class="jt ju hx bd jv jw jx jy jz ka kb kc kd jf ke kf kg jj kh ki kj jn kk kl km kn bi translated">在Google计算引擎上运行OSv Tomcat映像</h2><p id="43f6" class="pw-post-body-paragraph iu iv hx iw b ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn ks jp jq jr hb bi translated">以下说明使用了<a class="ae js" href="https://cloud.google.com/sdk/" rel="noopener ugc nofollow" target="_blank"> Google Cloud SDK </a>命令行工具。您可以在<a class="ae js" href="https://console.developers.google.com" rel="noopener ugc nofollow" target="_blank">开发者控制台</a> UI中直接做同样的事情(在最后的附录中可以找到详细信息)。为了减少命令行参数的数量，首先设置默认项目和默认区域(您可以挑选一个适合您的<a class="ae js" href="https://cloud.google.com/compute/docs/zones?hl=en" rel="noopener ugc nofollow" target="_blank">区域</a>)。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="f5ef" class="jt ju hx ky b fi lc ld l le lf">gcloud config set core/project YOUR_PROJECT_ID<br/>gcloud config set compute/zone us-central1-c</span></pre><p id="32a9" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，在您的Google云平台项目中注册公共OSv Tomcat映像:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="560e" class="jt ju hx ky b fi lc ld l le lf">gcloud compute images create osv-v0–23-tomcat \<br/>       --source-uri gs://osv/v0.23/osv-tomcat.gce.tar.gz</span></pre><p id="af7c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，使用该映像创建一个虚拟机实例:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="59db" class="jt ju hx ky b fi lc ld l le lf">gcloud compute instances create osv-tomcat --image osv-v0–23-tomcat</span></pre><p id="6bec" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">很快，对吧？注意新创建的实例的外部IP地址。这很重要！</p><p id="b3b7" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">记住，这个单内核只运行Tomcat，不运行其他任何东西。因此，您将无法SSH到它。要查看实例内部的情况，您需要查看串行端口输出:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="484b" class="jt ju hx ky b fi lc ld l le lf">gcloud compute instances get-serial-port-output osv-tomcat</span></pre><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lg"><img src="../Images/9d87ae828c8f961f5dc760f5861b8af7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oLg10ecAPt7pDgE3AdO9tg.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">串行端口输出示例</figcaption></figure><p id="80fd" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">它开始运行了！从串行端口输出中，我们可以看到Tomcat实例正在监听端口8081。默认情况下，谷歌云平台会阻止该端口的入站流量。您可以通过更新防火墙规则配置来启用该端口:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="4b32" class="jt ju hx ky b fi lc ld l le lf">gcloud compute firewall-rules create allow-8081 — allow tcp:8081</span></pre><p id="f928" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">最后，引用您创建的实例的外部IP，并在您的浏览器中导航到<a class="ae js" href="http://external_ip:8081/" rel="noopener ugc nofollow" target="_blank"> http://EXTERNAL_IP:8081/ </a>。您应该会看到默认的Tomcat页面！</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lh"><img src="../Images/78e061b13ad4acd2bc9caf84901b1647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FZonDZUUXSwC-pHSFdhcSA.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">您应该看到的Tomcat的默认主页</figcaption></figure><h2 id="e100" class="jt ju hx bd jv jw jx jy jz ka kb kc kd jf ke kf kg jj kh ki kj jn kk kl km kn bi translated">下一步是什么？</h2><p id="cd53" class="pw-post-body-paragraph iu iv hx iw b ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn ks jp jq jr hb bi translated">在本系列的下一部分中，我将使用Capstan构建一个定制的OSv unikernel映像，并将其部署到Google Compute Engine上(带有变通办法)。</p></div><div class="ab cl li lj gp lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hb hc hd he hf"><h2 id="0df2" class="jt ju hx bd jv jw jx jy jz ka kb kc kd jf ke kf kg jj kh ki kj jn kk kl km kn bi translated">附录—在浏览器中执行所有操作</h2><p id="c481" class="pw-post-body-paragraph iu iv hx iw b ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn ks jp jq jr hb bi translated">您也可以使用开发人员控制台从浏览器做任何事情。</p><p id="3901" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，导航到<strong class="iw hy">计算引擎</strong> &gt; <strong class="iw hy">图像</strong>，点击<strong class="iw hy">新图像</strong>注册图像:</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lp"><img src="../Images/cbd2760fd53dfbf47ddbad599bb2feeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rDlluCqOXF3zAzGiSK_7Pg.png"/></div></div></figure><p id="38b9" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后，导航到<strong class="iw hy">计算引擎</strong> &gt; <strong class="iw hy">虚拟机实例</strong>，并点击<strong class="iw hy">创建实例</strong>(或<strong class="iw hy">新实例</strong>)使用映像创建一个新的虚拟机实例。确保点击<strong class="iw hy">启动盘</strong> &gt; <strong class="iw hy">更改</strong>指定OSv启动盘镜像:</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lq"><img src="../Images/98f3333d3d043afbbfeb3cdbf2e08b00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ji8W8rox7k1rm_AvmCKJg.png"/></div></div></figure><p id="c381" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">创建实例后，您还可以直接从开发人员控制台访问串行端口输出。单击虚拟机名称osv-tomcat，然后向下滚动并单击<strong class="iw hy">串行控制台输出</strong>:</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lr"><img src="../Images/8bccb499776fd2f1249cc16e74d8521d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XSmQShxbS4t95K2MUntchA.png"/></div></div></figure><p id="da00" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要启用端口8081，导航到<strong class="iw hy">联网</strong> &gt; <strong class="iw hy">默认</strong>网络，点击<strong class="iw hy">添加防火墙规则</strong>:</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ls"><img src="../Images/e805b6b26442e4c4b28a47e19aed531b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8JuAImcjWifv3hjq27le0w.png"/></div></div></figure><p id="85dc" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">就是这样！</p></div></div>    
</body>
</html>