<html>
<head>
<title>Tip #18: Load and use JSON data in your workflow from GCS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">技巧#18:从GCS加载JSON数据并在工作流中使用</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/tip-18-load-and-use-json-data-in-your-workflow-from-gcs-898d8e5927f?source=collection_archive---------3-----------------------#2022-02-03">https://medium.com/google-cloud/tip-18-load-and-use-json-data-in-your-workflow-from-gcs-898d8e5927f?source=collection_archive---------3-----------------------#2022-02-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="315e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">跟进关于在云存储桶中写入和读取JSON文件的<a class="ae jd" rel="noopener" href="/google-cloud/day-16-with-workflows-reading-in-and-writing-a-json-file-to-a-storage-bucket-from-a-workflow-48b85c12d225">文章</a>，我们看到我们可以访问JSON文件的数据，并在我们的工作流中使用它。让我们来看看这个的具体用法。</p><p id="9870" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天，我们将利用这种机制来避免对我们从工作流中调用的API的URL进行硬编码。这样，它使得工作流在不同的环境中更容易移植。</p><p id="313c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们将读取和加载JSON数据的逻辑重组到一个可重用的子工作流中:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="286e" class="jn jo hi jj b fi jp jq l jr js">read_env_from_gcs:<br/>    params: [bucket, object]<br/>    steps:<br/>    - read_from_gcs:<br/>        call: http.get<br/>        args:<br/>            url: ${"<a class="ae jd" href="https://storage.googleapis.com/download/storage/v1/b/" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/download/storage/v1/b/</a>" + bucket + "/o/" + object}<br/>            auth:<br/>                type: OAuth2<br/>            query:<br/>                alt: media<br/>        result: env_file_json_content<br/>    - return_content:<br/>        return: ${env_file_json_content.body}</span></pre><p id="ac33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您用两个参数调用这个子工作流:bucket名称，以及您想要加载的对象或文件名。</p><p id="60aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们从主工作流中使用它。我们需要第一步调用子工作流，从特定的桶中加载特定的文件。下面的子工作流将返回env_details变量中JSON数据的内容。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="27f1" class="jn jo hi jj b fi jp jq l jr js">​​main:<br/>    params: [input]<br/>    steps:<br/>    - load_env_details:<br/>        call: read_env_from_gcs<br/>        args:<br/>            bucket: workflow_environment_info<br/>            object: env-info.json<br/>        result: env_details</span></pre><p id="e75e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设JSON文件包含一个带有SERVICE_URL键的JSON对象，指向一个服务的URL，那么你可以用下面的表达式调用这个服务:${env_details。SERVICE_URL}如下所示。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="f9b2" class="jn jo hi jj b fi jp jq l jr js">- call_service:<br/>        call: http.get<br/>        args:<br/>            url: ${env_details.SERVICE_URL}<br/>        result: service_result<br/>    - return_result:<br/>        return: ${service_result.body}</span></pre><p id="f5e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这对于避免在工作流定义中硬编码某些值非常有用。然而，对于真正的特定于环境的部署，这还不理想，因为您必须指向bucket中的不同文件，或者使用不同的bucket。并且当您调用子工作流时，该信息当前被硬编码在定义中。但是如果您遵循一些映射到环境的项目名称和存储桶名称的命名约定，这是可行的！(即。PROD_bucket vs DEV_bucket，或者PROD-env-info . JSON vs DEV-env-info . JSON)</p><p id="1a56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们等待工作流中环境变量的支持！</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="23eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ka">最初发表于</em><a class="ae jd" href="https://glaforge.appspot.com/article/load-and-use-json-data-in-your-workflow-from-gcs" rel="noopener ugc nofollow" target="_blank">T5【https://glaforge.appspot.com】</a><em class="ka">。</em></p></div></div>    
</body>
</html>