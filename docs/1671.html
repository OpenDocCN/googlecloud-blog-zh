<html>
<head>
<title>How to deduplicate rows in a BigQuery table</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何删除BigQuery表中的重复行</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-de-duplicate-rows-in-a-bigquery-table-55f7d6321626?source=collection_archive---------0-----------------------#2020-11-19">https://medium.com/google-cloud/how-to-de-duplicate-rows-in-a-bigquery-table-55f7d6321626?source=collection_archive---------0-----------------------#2020-11-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="e668" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">重复数据有时会导致错误的合计或结果。在进行任何聚合、连接或计算之前，您可能需要删除这些重复的行。处理重复数据有多种方法，你可以在这篇文章中找到其中一种方法来处理重复的键/列/行。</p></blockquote><p id="683b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">案例一；每个键列只能有一个唯一的行</strong></p><p id="f7ed" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">示例数据:</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es jk"><img src="../Images/c6c2c11949e7c187011bf8bb20a8ad6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:362/format:webp/1*-YbVAc_c3GvwD7YViQpvFw.png"/></div></figure><p id="be13" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">在这里，您可以看到一些完整行的副本，如果完整行是重复的，您可以简单地使用“distinct * ”:</p><pre class="jl jm jn jo fd js jt ju jv aw jw bi"><span id="d6b1" class="jx jy hi jt b fi jz ka l kb kc">select distinct * from ds.duplicates</span></pre><p id="5faa" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">以下查询可用于根据PK列对此表进行重复数据删除:</p><figure class="jl jm jn jo fd jp"><div class="bz dy l di"><div class="kd ke l"/></div></figure><p id="6832" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">您可能已经意识到，我们正在创建一个新表，而不是覆盖现有的表。如果要覆盖已有的表，可以使用与<strong class="il hj">相同的<strong class="il hj">表名</strong>创建或替换</strong>:</p><figure class="jl jm jn jo fd jp"><div class="bz dy l di"><div class="kd ke l"/></div></figure><p id="ab46" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">表中可能有一些额外的列，如“load_date”，案例2和案例3显示了如何使用相同的方法处理这些列。</p><p id="99a5" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">案例二；使用保持最新等标准进行重复数据删除</strong></p><p id="54ae" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">如果您有一些删除标准，如日期列，您可以更改排序键，如下所示:</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es kf"><img src="../Images/af4b55a42067c9d6da64b6221ee9332c.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/format:webp/1*mKy4yaNTuacHaR62gBFm3A.png"/></div></figure><figure class="jl jm jn jo fd jp"><div class="bz dy l di"><div class="kd ke l"/></div></figure><p id="7d00" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">案例三；基于多列进行重复数据删除</strong></p><p id="b700" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">如果您有多个列键或基于某些列删除重复项，则可以在PARTITION BY子句中使用这些列:</p><p id="3ccf" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">示例:根据名字和姓氏进行重复数据删除</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es kg"><img src="../Images/37df9cce3c4fd6e5446b34455601c412.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*cllc0uqpWx6WH93q71vNTg.png"/></div></figure><figure class="jl jm jn jo fd jp"><div class="bz dy l di"><div class="kd ke l"/></div></figure><p id="a8d5" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">请在这个帖子里评论，让我知道你喜欢的方法。</p></div></div>    
</body>
</html>