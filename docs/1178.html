<html>
<head>
<title>Asynchronous Code Execution with Google Cloud Tasks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云任务的异步代码执行</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/asynchronous-code-execution-with-google-cloud-tasks-9b73ceaf48c3?source=collection_archive---------0-----------------------#2019-10-23">https://medium.com/google-cloud/asynchronous-code-execution-with-google-cloud-tasks-9b73ceaf48c3?source=collection_archive---------0-----------------------#2019-10-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/cc2fbbd652003f80420b6aaa545d77d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BFZ7ctPf7fABMDcG6FbZMg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">谷歌云任务</figcaption></figure><p id="096a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">没有一个应用程序是孤岛</strong> —每个重要的应用程序都有依赖关系，并与其他服务共存，共享资源和数据。多年来，消息传递已经从静态的、同步的点对点模型发展成了<em class="js">异步</em>机制。</p><p id="d18e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这篇博文中，我们将了解<strong class="iw hj">什么是</strong>谷歌云任务，一个用于代码执行的异步点对点排队系统，<strong class="iw hj">在哪里</strong>你可以从使用云任务中受益，以及<strong class="iw hj">如何</strong>开始。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="b95c" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated"><strong class="ak"> <em class="ky">什么</em> </strong>是云任务？</h1><p id="9647" class="pw-post-body-paragraph iu iv hi iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr hb bi translated">云任务是Google云平台的一个排队系统服务，用于管理大量分布式任务的执行、调度和交付。</p><p id="b662" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使用云任务，您可以在一个队列中添加数百万个“任务”。您也可以创建许多队列。队列处理队列中的任务，向目标URL发送HTTP请求或执行App Engine应用程序处理程序，具体取决于您的设置。</p><p id="749f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下面是这种关系的示例图。</p><figure class="lf lg lh li fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es le"><img src="../Images/45c8bf7c7dcf4c1ef2d9fc850e17b769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9FXNzILQyAMWUT38YfxO2Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><strong class="bd kc">左:</strong> 8个云任务<br/> <strong class="bd kc">右:</strong>一个监听HTTP请求的服务器(我们的HTTP目标)</figcaption></figure><p id="c87f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使用云任务可以增加应用程序的可靠性、可管理性和响应性。例如，云任务与通过云功能和云运行构建的解耦服务配合得特别好。</p><figure class="lf lg lh li fd ij er es paragraph-image"><div class="er es lj"><img src="../Images/c74407c4f7ca8eaf121ffbb4b8011128.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/0*3LHoVW2a9FhaeJmA"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">提高服务的可靠性</figcaption></figure><p id="e92a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">云任务包括以下功能:</p><h2 id="b72a" class="lk kb hi bd kc ll lm ln kg lo lp lq kk jf lr ls ko jj lt lu ks jn lv lw kw lx bi translated">灵活路由</h2><p id="336b" class="pw-post-body-paragraph iu iv hi iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr hb bi translated">分派可到达GCP和本地系统内任何目标的任务。</p><h2 id="4f72" class="lk kb hi bd kc ll lm ln kg lo lp lq kk jf lr ls ko jj lt lu ks jn lv lw kw lx bi translated">任务卸载</h2><p id="705e" class="pw-post-body-paragraph iu iv hi iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr hb bi translated">将重量级、后台和长时间运行的进程卸载到任务队列，使应用程序能够更好地响应用户。</p><h2 id="8a5b" class="lk kb hi bd kc ll lm ln kg lo lp lq kk jf lr ls ko jj lt lu ks jn lv lw kw lx bi translated">限速</h2><p id="eeea" class="pw-post-body-paragraph iu iv hi iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr hb bi translated">控制向您的服务分派任务的速率，以确保您的微服务不会不堪重负。</p><h2 id="aef1" class="lk kb hi bd kc ll lm ln kg lo lp lq kk jf lr ls ko jj lt lu ks jn lv lw kw lx bi translated">高可靠性</h2><p id="b773" class="pw-post-body-paragraph iu iv hi iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr hb bi translated">由于每项任务都保存在存储中并自动重试，因此您的基础架构可以抵御间歇性故障。</p><h2 id="a818" class="lk kb hi bd kc ll lm ln kg lo lp lq kk jf lr ls ko jj lt lu ks jn lv lw kw lx bi translated">松耦合</h2><p id="369f" class="pw-post-body-paragraph iu iv hi iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr hb bi translated">微服务通常不通过直接的请求/响应相互对话，而是异步的，允许服务独立扩展。云任务通过专用的独立、可配置的任务队列，帮助您更好地构建和扩展应用。</p><p id="0548" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这允许你做一些事情，比如暂停任务队列，或者配置独立的重试策略。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="1ac5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">其他功能包括计划长达30天的任务、队列速率限制、可配置的重试、任务重复数据删除和任务处理程序授权。</p><h1 id="6104" class="ka kb hi bd kc kd ly kf kg kh lz kj kk kl ma kn ko kp mb kr ks kt mc kv kw kx bi translated">您可以在哪里使用云任务？</h1><p id="7f8b" class="pw-post-body-paragraph iu iv hi iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr hb bi translated">云任务可以用来调用<em class="js"> Google App引擎、云运行、云函数、</em>或者任何<em class="js"> HTTP服务器</em>。</p><p id="a36b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">以下是一些使用案例示例:</p><ul class=""><li id="0b0e" class="md me hi iw b ix iy jb jc jf mf jj mg jn mh jr mi mj mk ml bi translated">推送重试的异步图像处理作业。</li><li id="9643" class="md me hi iw b ix mm jb mn jf mo jj mp jn mq jr mi mj mk ml bi translated">以受控且一致的速率从数据库中读取。</li><li id="638b" class="md me hi iw b ix mm jb mn jf mo jj mp jn mq jr mi mj mk ml bi translated">安排在注册试用期后1个月发送电子邮件。</li></ul><p id="0ad2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">那么，你为什么要使用云任务而不是发布/订阅呢？</p><h2 id="5e93" class="lk kb hi bd kc ll lm ln kg lo lp lq kk jf lr ls ko jj lt lu ks jn lv lw kw lx bi translated">发布/订阅与云任务</h2><p id="f69b" class="pw-post-body-paragraph iu iv hi iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr hb bi translated">云发布/订阅和云任务之间的核心区别是隐式和显式调用的概念。</p><p id="af05" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Cloud Pub/Sub支持<strong class="iw hj">隐式</strong>调用:发布者通过发布事件隐式地使订阅者执行。</p><p id="56fc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">相比之下，云任务旨在<strong class="iw hj">显式</strong>调用，发布者保留对执行的完全控制。</p><p id="7ba5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">详细的对比和方便的并排对比可以在<a class="ae mr" href="https://cloud.google.com/tasks/docs/comp-pub-sub" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="0908" class="ka kb hi bd kc kd ly kf kg kh lz kj kk kl ma kn ko kp mb kr ks kt mc kv kw kx bi translated">云任务的工具</h1><p id="e338" class="pw-post-body-paragraph iu iv hi iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr hb bi translated">如何使用云任务？为了控制云任务，您有各种工具，用于手动和编程使用:</p><ul class=""><li id="2e8f" class="md me hi iw b ix iy jb jc jf mf jj mg jn mh jr mi mj mk ml bi translated">谷歌云控制台</li><li id="792a" class="md me hi iw b ix mm jb mn jf mo jj mp jn mq jr mi mj mk ml bi translated">CLI</li><li id="7895" class="md me hi iw b ix mm jb mn jf mo jj mp jn mq jr mi mj mk ml bi translated"><a class="ae mr" href="https://cloud.google.com/tasks/docs/reference/rest/" rel="noopener ugc nofollow" target="_blank">云任务API </a></li></ul><h2 id="59de" class="lk kb hi bd kc ll lm ln kg lo lp lq kk jf lr ls ko jj lt lu ks jn lv lw kw lx bi translated">谷歌云控制台</h2><p id="34ce" class="pw-post-body-paragraph iu iv hi iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr hb bi translated">在<a class="ae mr" href="http://console.cloud.google.com/cloudtasks" rel="noopener ugc nofollow" target="_blank">console.cloud.google.com/cloudtasks</a>，您将看到一个界面，用于查看所有队列和恢复/暂停队列、删除整个队列或单个任务以及清除/删除所有任务的控件。</p><figure class="lf lg lh li fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mw"><img src="../Images/a469bfe8673148af4c17523b9b9a902d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tC6-FEvX_4VbWp4x65lpwg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">队列中运行约10，000个任务的示例</figcaption></figure><h2 id="c025" class="lk kb hi bd kc ll lm ln kg lo lp lq kk jf lr ls ko jj lt lu ks jn lv lw kw lx bi translated">CLI</h2><p id="644a" class="pw-post-body-paragraph iu iv hi iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr hb bi translated">使用云任务最简单的方法之一是使用命令行。</p><p id="ac9d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有了<code class="du ms mt mu mv b">gcloud</code>，你可以用这样的命令轻松地创建任务:</p><pre class="lf lg lh li fd mx mv my mz aw na bi"><span id="0835" class="lk kb hi mv b fi nb nc l nd ne">gcloud tasks queues create "example-queue"<!-- --> </span></pre><blockquote class="nf ng nh"><p id="b748" class="iu iv js iw b ix iy iz ja jb jc jd je ni jg jh ji nj jk jl jm nk jo jp jq jr hb bi translated">忽略关于<code class="du ms mt mu mv b">queue.yaml</code>和<code class="du ms mt mu mv b">queue.xml</code>的警告。</p></blockquote><p id="bfad" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这将创建一个新的队列，它可以包含数千个任务。</p><h2 id="b240" class="lk kb hi bd kc ll lm ln kg lo lp lq kk jf lr ls ko jj lt lu ks jn lv lw kw lx bi translated">云任务API</h2><p id="3a37" class="pw-post-body-paragraph iu iv hi iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr hb bi translated">通过编程，我们可以使用Google API客户端的任务，例如，<a class="ae mr" href="https://github.com/googleapis/nodejs-tasks" rel="noopener ugc nofollow" target="_blank">节点客户端</a>:</p><figure class="lf lg lh li fd ij"><div class="bz dy l di"><div class="nl nm l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">对云任务API的一个非常简单的API请求</figcaption></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="38d5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">感谢阅读！以上是对云任务的简单介绍。</p><h2 id="5de2" class="lk kb hi bd kc ll lm ln kg lo lp lq kk jf lr ls ko jj lt lu ks jn lv lw kw lx bi translated">了解有关云任务的更多信息</h2><ul class=""><li id="1d02" class="md me hi iw b ix kz jb la jf nn jj no jn np jr mi mj mk ml bi translated">🎥<a class="ae mr" href="https://www.youtube.com/watch?v=QZeNIlpQ4pI" rel="noopener ugc nofollow" target="_blank">观看Vinod的云任务介绍</a></li><li id="0ad4" class="md me hi iw b ix mm jb mn jf mo jj mp jn mq jr mi mj mk ml bi translated">💻<a class="ae mr" rel="noopener" href="/google-cloud/develop-your-cloud-tasks-pipeline-locally-with-ngrok-5bee3693600f">使用ngrok在本地调试云任务</a></li><li id="8b2f" class="md me hi iw b ix mm jb mn jf mo jj mp jn mq jr mi mj mk ml bi translated">📑<a class="ae mr" href="http://cloud.google.com/tasks" rel="noopener ugc nofollow" target="_blank">阅读云任务文档</a></li></ul></div></div>    
</body>
</html>