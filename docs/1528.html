<html>
<head>
<title>Why you should treat infrastructure like software</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么您应该像对待软件一样对待基础设施</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/why-should-you-treat-infrastructure-like-software-3865ed0e4b03?source=collection_archive---------1-----------------------#2020-07-21">https://medium.com/google-cloud/why-should-you-treat-infrastructure-like-software-3865ed0e4b03?source=collection_archive---------1-----------------------#2020-07-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="43dd" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">规模季节</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/6246bd259a72726a60dd6e1064911099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*uwuy_aAKkCoeR-tyCTIRqw.gif"/></div></div></figure><h1 id="f14b" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">介绍</h1><p id="bec0" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">“规模季节”是一个博客和视频系列，旨在帮助企业和开发人员在设计模式中构建规模和弹性。在这一系列文章中，我们计划向您介绍一些创建具有弹性和可伸缩性的应用程序的模式和实践，这是许多现代架构实践的两个基本目标。</p><p id="fc9b" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">在第1季中，我们将介绍基础架构自动化和高可用性:</p><ol class=""><li id="9f8d" class="lc ld hi kd b ke kx kh ky kk le ko lf ks lg kw lh li lj lk bi translated"><a class="ae ll" rel="noopener" href="/google-cloud/scale-and-resilience-arent-just-buzzwords-ce748360e80">可扩展和弹性应用的模式</a></li><li id="86d6" class="lc ld hi kd b ke lm kh ln kk lo ko lp ks lq kw lh li lj lk bi translated"><a class="ae ll" href="https://medium.com/p/3865ed0e4b03/edit" rel="noopener">基础设施作为代号</a>(本文)</li><li id="7c4f" class="lc ld hi kd b ke lm kh ln kk lo ko lp ks lq kw lh li lj lk bi translated"><a class="ae ll" href="https://medium.com/p/624a8e3482d6/edit" rel="noopener">不变的基础设施</a></li><li id="49bb" class="lc ld hi kd b ke lm kh ln kk lo ko lp ks lq kw lh li lj lk bi translated"><a class="ae ll" rel="noopener" href="/@swongful/where-to-scale-your-workloads-6420150bf825">在哪里扩展您的工作负载</a></li><li id="61ef" class="lc ld hi kd b ke lm kh ln kk lo ko lp ks lq kw lh li lj lk bi translated"><a class="ae ll" rel="noopener" href="/@swongful/globally-autoscaling-web-services-4b650cc6fc49">全球自动扩展web服务</a></li><li id="4cad" class="lc ld hi kd b ke lm kh ln kk lo ko lp ks lq kw lh li lj lk bi translated"><a class="ae ll" rel="noopener" href="/@swongful/give-your-vms-a-steady-pulse-with-autohealing-and-autoupdates-ae2c0828ecc9">高可用性(自动修复&amp;自动更新)</a></li></ol><p id="9bca" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">在本文中，我将带您了解代码基础设施背后的基础知识。</p><h1 id="1e20" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">看看这个视频</h1><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="lr ls l"/></div></figure><h1 id="528a" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">回顾</h1><p id="8dec" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">在上一篇文章中，我们了解了Critter Junction，这是一家多人游戏公司，在过去的几个月里广受欢迎。在线玩家可以在一个模拟生物的虚拟世界中相互交流。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lt"><img src="../Images/30557afb06ae49b0824bdb9d2a3fd05a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4wvcizUkRl8D-uuHcWQYQA.png"/></div></div></figure><p id="c3f8" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">他们擅长在本地运行单个机器，但无法自动扩展到多个机器来处理流量高峰和低谷。除此之外，他们还面临着业务和运营方面的限制。因此，我们的团队已经介入，帮助他们定义规模和弹性，以及设计最佳实践的3个主题:</p><blockquote class="lu"><p id="83d1" class="lv lw hi bd lx ly lz ma mb mc md kw dx translated">自动化</p><p id="7859" class="lv lw hi bd lx ly lz ma mb mc md kw dx translated">松耦合</p><p id="5ba1" class="lv lw hi bd lx ly lz ma mb mc md kw dx translated">和数据驱动的设计</p></blockquote><h1 id="14f2" class="jj jk hi bd jl jm jn jo jp jq jr js jt io me ip jv ir mf is jx iu mg iv jz ka bi translated">调配基础架构的旧方法</h1><p id="a567" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">虽然Critter Junction传统上在内部运行，但他们刚刚开始移植工作负载，并在云中快速部署新服务器。</p><p id="1867" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">他们习惯于创建基础架构的传统方法，即提交一张票据。有人会将其登录到管理门户网站，并通过一系列步骤来调配基础架构。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mh"><img src="../Images/7fb1e3a3c4b8a1957fa17f492f65a134.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*imrKqGbnmLkPSfTaX3aRqw.png"/></div></div></figure><p id="24ea" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">如果您的足迹相对较小，或者您的基础架构变动很小，这是可行的，这通常是Critter Junction的私有数据中心的情况。在有限的部署规模下，虚拟机可以存在数月到数年。但是现在有了云弹性，虚拟机可以而且应该活得更短。他们不再有硬件贬值的固定成本。相反，你按秒、分钟或小时付费。这里的挑战是，即使需求激增，也要提供出色的用户体验。</p><blockquote class="lu"><p id="f92e" class="lv lw hi bd lx ly lz ma mb mc md kw dx translated">对于成本优化和用户体验而言，能够快速增加资源并将其减少是成败的关键。</p></blockquote><p id="a115" class="pw-post-body-paragraph kb kc hi kd b ke mi ij kg kh mj im kj kk mk km kn ko ml kq kr ks mm ku kv kw hb bi translated">但是对于Critter Junction来说，手动归档票证并尝试大规模复制基础架构非常耗时，并且容易出现人为错误。如果出现高峰，可能需要几个小时甚至几个月才能及时调配基础架构。此外，很难跟踪和审计变更。</p><h1 id="3278" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">基础设施作为代码</h1><p id="5f2f" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">这就是<a class="ae ll" href="https://cloud.google.com/solutions/infrastructure-as-code" rel="noopener ugc nofollow" target="_blank">基础设施即代码(IaC) </a>发挥作用的地方。这是一种像处理应用程序代码一样处理基础设施供应和配置的技术。您可以使用代码自动配置云资源，创建可复制的模板，并将配置文件存储在源代码版本控制中，以便可以发现和审计。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mn"><img src="../Images/e454ed787ab859ac70de08a44ce1125f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tpvGMyPgRU3KFguPidTNFA.png"/></div></div></figure><p id="72d8" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">通过CICD管道实现基础设施自动化意味着对您配置的任何更改都可以自动进行测试和部署。通过采用IaC，Critter Junction能够增强其扩展能力。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mp"><img src="../Images/b8b15c1fc216934d7195605796c60831.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IEuKAdc9Lr3XDlU_uEu-Vg.png"/></div></div></figure><p id="ed21" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated"><a class="ae ll" href="https://cloud.google.com/deployment-manager" rel="noopener ugc nofollow" target="_blank">Google Cloud Deployment Manager</a>是一项IaC服务，它使用基于YAML的声明式配置格式，自动创建和管理Google Cloud资源。从开发/测试到生产，您可以使用简单的配置文件构建包含计算、网络、存储、数据库、用户和权限的可重复环境。</p><p id="481e" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">对于您计划重用的更复杂的架构，您甚至可以将您的配置分解成<a class="ae ll" href="https://cloud.google.com/deployment-manager/docs/step-by-step-guide/create-a-template" rel="noopener ugc nofollow" target="_blank">模板</a>，它们是定义一组资源的独立文件。您可以在不同的部署中重复使用模板，这样可以在复杂的部署中保持一致性。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mq"><img src="../Images/18b28a57cc65b3b2df1f4a45f8f4d895.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qoBjCY0ptBToVHAHpsRDpA.png"/></div></div></figure><h2 id="1507" class="mr jk hi bd jl ms mt mu jp mv mw mx jt kk my mz jv ko na nb jx ks nc nd jz ne bi translated">看起来怎么样</h2><p id="36a7" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">在本例中，该配置文件指定了来自计算引擎和BigQuery的资源，以及提供访问的防火墙规则。</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="aaa7" class="mr jk hi ng b fi nk nl l nm nn">resources:</span><span id="e30f" class="mr jk hi ng b fi no nl l nm nn">- name: vm-created-by-deployment-manager</span><span id="2d6f" class="mr jk hi ng b fi no nl l nm nn">  type: compute.v1.instance</span><span id="ee95" class="mr jk hi ng b fi no nl l nm nn">  properties:</span><span id="9469" class="mr jk hi ng b fi no nl l nm nn">    zone: us-central1-a</span><span id="2c15" class="mr jk hi ng b fi no nl l nm nn">    machineType: zones/us-central1-a/machineTypes/n1-standard-1</span><span id="4a9b" class="mr jk hi ng b fi no nl l nm nn">    disks:<br/>    <br/>    - deviceName: boot</span><span id="6c80" class="mr jk hi ng b fi no nl l nm nn">      type: PERSISTENT</span><span id="40c2" class="mr jk hi ng b fi no nl l nm nn">      boot: true</span><span id="1662" class="mr jk hi ng b fi no nl l nm nn">      autoDelete: true</span><span id="ccf4" class="mr jk hi ng b fi no nl l nm nn">      initializeParams:</span><span id="e97e" class="mr jk hi ng b fi no nl l nm nn">      sourceImage: projects/debian-cloud/global/images/family/debian-9<br/>    networkInterfaces:</span><span id="9c52" class="mr jk hi ng b fi no nl l nm nn">    - network: global/networks/default</span><span id="fc4c" class="mr jk hi ng b fi no nl l nm nn">- name: big-query-dataset</span><span id="ecaa" class="mr jk hi ng b fi no nl l nm nn">  type: bigquery.v2.dataset</span><span id="29af" class="mr jk hi ng b fi no nl l nm nn">  properties:</span><span id="39f9" class="mr jk hi ng b fi no nl l nm nn">  datasetReference:</span><span id="6b22" class="mr jk hi ng b fi no nl l nm nn">  datasetId: example_id</span><span id="20e5" class="mr jk hi ng b fi no nl l nm nn">- name: ssh-firewall-rule</span><span id="2bb7" class="mr jk hi ng b fi no nl l nm nn">  type: compute.v1.firewall</span><span id="1445" class="mr jk hi ng b fi no nl l nm nn">  properties:</span><span id="e578" class="mr jk hi ng b fi no nl l nm nn">   sourceRanges: ["0.0.0.0/0"]</span><span id="bc64" class="mr jk hi ng b fi no nl l nm nn">   allowed:</span><span id="ba72" class="mr jk hi ng b fi no nl l nm nn">   - IPProtocol: TCP</span><span id="b02c" class="mr jk hi ng b fi no nl l nm nn">     ports: ["22"]</span></pre><p id="320d" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">现在，Critter Junction可以使用gcloud SDK来创建、更新和删除部署。</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="f031" class="mr jk hi ng b fi nk nl l nm nn">gcloud deployment-manager deployments create</span><span id="c11b" class="mr jk hi ng b fi no nl l nm nn">gcloud deployment-manager deployments update</span><span id="465d" class="mr jk hi ng b fi no nl l nm nn">gcloud deployment-manager deployments delete</span></pre><p id="7224" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">与此同时，谷歌云控制台以分层视图的形式向他们展示了所有部署的基础设施。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es np"><img src="../Images/1ccdb0f6a5dd346771d646bb37d0e778.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x8mfJpuvqkxOxUX-tEqlVw.png"/></div></div></figure><p id="45e0" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">无论他们需要这样做一次、十次还是一千次，这都允许他们对其资源的生命周期进行粒度控制。例如，他们能够降低成本，每天早上运行一个脚本，启动数百台机器，每天晚上使用相同的脚本将其缩减。</p><h1 id="fe45" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">使用现有工具</h1><p id="91ca" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">因为没有人喜欢对现有的DevOps工作流进行激烈的更改，所以您可以使用其他IAC工具，如Terraform、Chef和Puppet，从一个位置在Google云和本地部署资源。</p><p id="f468" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">像CICD一样，IaC是DevOps的关键实践之一，允许您在关注产品质量的同时实现开发的敏捷性。通过消除基础架构配置中的手动步骤，Critter Junction已经能够在大规模的<em class="mo">试运行、QA和生产环境中实现一致性和部署速度。请继续关注他们的旅程。</em></p><p id="0cf2" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">记住，永远要做架构设计。</p><h1 id="b7ca" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">后续步骤和参考:</h1><ul class=""><li id="747f" class="lc ld hi kd b ke kf kh ki kk nq ko nr ks ns kw nt li lj lk bi translated">在<a class="ae ll" href="https://medium.com/google-cloud" rel="noopener">谷歌云平台媒体</a>上关注这个博客系列。</li><li id="24c3" class="lc ld hi kd b ke lm kh ln kk lo ko lp ks lq kw nt li lj lk bi translated">参考:<a class="ae ll" href="https://cloud.google.com/deployment-manager/docs/quickstart" rel="noopener ugc nofollow" target="_blank">部署管理器快速入门</a></li><li id="cc03" class="lc ld hi kd b ke lm kh ln kk lo ko lp ks lq kw nt li lj lk bi translated">关注<a class="ae ll" href="http://bit.ly/seasonofscale" rel="noopener ugc nofollow" target="_blank">季Scale视频系列</a>，订阅谷歌云平台YouTube频道。</li><li id="24e9" class="lc ld hi kd b ke lm kh ln kk lo ko lp ks lq kw nt li lj lk bi translated">想要更多的故事？在<a class="ae ll" rel="noopener" href="/@swongful">媒体</a>和<a class="ae ll" href="http://twitter.com/swongful" rel="noopener ugc nofollow" target="_blank">推特</a>上给我喊话。</li><li id="dd90" class="lc ld hi kd b ke lm kh ln kk lo ko lp ks lq kw nt li lj lk bi translated">与我们一起享受这个迷你系列的旅程，并了解更多关于谷歌云解决方案的信息。</li></ul></div></div>    
</body>
</html>