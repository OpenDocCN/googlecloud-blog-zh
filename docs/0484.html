<html>
<head>
<title>Cloud Functions Prometheus Exporter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云函数普罗米修斯出口商</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/cloud-functions-prometheus-exporter-545111b8a8a5?source=collection_archive---------0-----------------------#2018-01-04">https://medium.com/google-cloud/cloud-functions-prometheus-exporter-545111b8a8a5?source=collection_archive---------0-----------------------#2018-01-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="767f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">周末，我启动了我的<a class="ae jd" href="https://www.particle.io/products/hardware/photon-wifi-dev-kit" rel="noopener ugc nofollow" target="_blank">光子</a>，并回忆起一篇旧的<a class="ae jd" rel="noopener" href="/@DazWilkin/publishing-photon-events-to-telegraf-and-monitoring-them-with-grafana-b6fc45610a77">帖子</a>，其中我使用<a class="ae jd" href="https://www.influxdata.com/time-series-platform/telegraf/" rel="noopener ugc nofollow" target="_blank"> Telegraf </a> Webhook端点记录光子，以捕捉使用<a class="ae jd" href="https://grafana.com/" rel="noopener ugc nofollow" target="_blank"> Grafana </a>显示的数据。</p><p id="c1d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这一次，我认为使用<a class="ae jd" href="https://cloud.google.com/functions/" rel="noopener ugc nofollow" target="_blank"> Google Cloud Functions </a>作为<a class="ae jd" href="https://prometheus.io/" rel="noopener ugc nofollow" target="_blank"> Prometheus </a> Exporter会很有趣(尽管我不完全确定这是一个有效的|好的用例),它会定期询问光子并使用它们的变量作为度量。</p><p id="4316" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我现在要用一些赏心悦目的东西来逗弄这篇文章的其余部分，明天再充实它。随着Promises代码变得粗糙，我会重视某人对JavaScript的评论，并且我能感觉到有更好的方法来重构它。</p><h2 id="d96d" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">带传感器的照片</h2><p id="32e2" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">这是一张带有<a class="ae jd" href="https://www.adafruit.com/product/3251" rel="noopener ugc nofollow" target="_blank"> Adfruit Si7021 </a>温湿度传感器的光子照片:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ke"><img src="../Images/84d80be71f6736f3f767364d52e63eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fb1xZi9Ig8hZFA4MzwjDMw.jpeg"/></div></div></figure><p id="cd3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是光子的代码:</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="kq kr l"/></div></figure><h2 id="daea" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">格拉夫纳</h2><p id="9cb7" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">运行在一个容器中，自动神奇地查询普罗米修斯目标。上面的图表示温度，下面的图表示湿度。我有3个光子，每个光子都有一个温度-湿度传感器，并分别以“t”和“h”报告读数。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ks"><img src="../Images/81ad29c6d6d94f70d36bc69d5f2f8454.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1UiJt_6QDwIbnRGWuRq4Cg.png"/></div></div></figure><p id="daaf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行Grafana时使用:</p><pre class="kf kg kh ki fd kt ku kv kw aw kx bi"><span id="6eb2" class="je jf hi ku b fi ky kz l la lb">docker run \<br/>--detach \<br/>--publish=3000:3000 \<br/>grafana/grafana</span></pre><p id="de8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后通过<a class="ae jd" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>访问。默认用户名/密码是admin/admin。曾经(！)Prometheus正在运行，点击“添加数据源”并完成如下表格:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lc"><img src="../Images/e795bfe0935d461abd07afcbb24a1f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qafoBrnUIDaW1VAPzNd7ug.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">为普罗米修斯配置的Grafana</figcaption></figure><p id="8b44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您单击“添加”时，您应该会看到:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ks"><img src="../Images/f444f58fdd16fbcfba0055f0738208df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V5wE0rcaSoflWjw1K7262g.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">成功！</figcaption></figure><p id="f52e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击“仪表板”，然后点击“普罗米修斯状态”旁边的“导入”</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lh"><img src="../Images/1b3204e9b816d8bc68d3f2296a493966.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n0Q8ShghtedAMqkdVr-rkg.png"/></div></div></figure><p id="09a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后返回“主页”并选择“普罗米修斯统计”</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es li"><img src="../Images/5c74dd845b25cfbcc37764e1b7d5c43f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qvgCYdfya9DydfV2VxDfEQ.png"/></div></div></figure><p id="32ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该会看到:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lj"><img src="../Images/967dda54c072036fe290c55380d76030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tVvAIG3nd_tZ3ZpOuwHnBQ.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">Grafana w/“普罗米修斯统计”仪表板</figcaption></figure><p id="f54c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们稍后将返回到Grafana来显示粒子(光子)度量。</p><h2 id="d7af" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">普罗米修斯</h2><p id="28bd" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">运行在一个容器中，并配置为监控自身和云功能。在这里，这些指标由particle_gauge过滤，并且只报告“t”(= =温度)值。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lc"><img src="../Images/2f44f25e768a177f227cb885eed52196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gy0RgC3-6WbxxhqzFU2zbw.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">普罗米修斯:图表</figcaption></figure><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ks"><img src="../Images/214f8606c7d9bcf8613dcb639ad526e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4LR7XiZvvjR1AOmrYROAAw.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">普罗米修斯:目标</figcaption></figure><p id="83f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是普罗米修斯的配置。它在本地主机上监控自身，并通过通用端点(无“/指标”)监控云功能，正如其假设的那样(惯例):</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="kq kr l"/></div></figure><p id="33bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行Prometheus，假设prometheus.yml在当前的($PWD)目录中，使用:</p><pre class="kf kg kh ki fd kt ku kv kw aw kx bi"><span id="6240" class="je jf hi ku b fi ky kz l la lb">docker run \<br/>--net=host \<br/>--publish=9090:9090 \<br/>--volume=$PWD/prometheus.yml:/etc/prometheus/prometheus.yml prom/prometheus</span></pre><p id="1f9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“net=host”允许Prometheus运行时将自己称为主机的本地主机。容器的端口似乎在主机的网络上。这允许您在运行Prometheus容器后从主机执行以下操作，以便访问Prometheus自己的指标:</p><pre class="kf kg kh ki fd kt ku kv kw aw kx bi"><span id="642e" class="je jf hi ku b fi ky kz l la lb">curl --silent --request GET http://localhost:9090/metrics</span></pre><h2 id="a470" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">云函数</h2><p id="0775" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">下面是令人难以置信的JavaScript代码，它将<a class="ae jd" href="https://cloud.google.com/deployment-manager/runtime-configurator/" rel="noopener ugc nofollow" target="_blank">谷歌运行时配置</a>、<a class="ae jd" href="https://www.npmjs.com/package/particle-api-js" rel="noopener ugc nofollow" target="_blank">粒子的JavaScript API </a>和<a class="ae jd" href="https://www.npmjs.com/package/prom-client" rel="noopener ugc nofollow" target="_blank">普罗米修斯的Node.js SDK </a>结合成一个云函数:</p><p id="d63e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">package.json:</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="kq kr l"/></div></figure><p id="9328" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">index.js:</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="kq kr l"/></div></figure><p id="2d05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://cloud.google.com/deployment-manager/runtime-configurator/" rel="noopener ugc nofollow" target="_blank">Google Runtime Configurator</a>是<a class="ae jd" href="https://cloud.google.com/deployment-manager/" rel="noopener ugc nofollow" target="_blank">Google Deployment Manager</a>的一个特性，但它对云功能非常有用，因为它提供了一种提取配置数据的方法。在此示例中，运行时配置器“config”用于保存particle.io的用户名和密码凭证:</p><pre class="kf kg kh ki fd kt ku kv kw aw kx bi"><span id="4e8b" class="je jf hi ku b fi ky kz l la lb">PROJECT=[[YOUR-PROJECT-ID]]<br/>USERNAME=[[YOUR-PARTICLE-USERNAME]]<br/>PASSWORD=[[YOUR-PARTICLE-PASSWORD]]</span><span id="6d58" class="je jf hi ku b fi lk kz l la lb">CONFIG=particle</span><span id="2291" class="je jf hi ku b fi lk kz l la lb">gcloud services enable runtimeconfig.googleapis.com \<br/>--project=${PROJECT}</span><span id="0038" class="je jf hi ku b fi lk kz l la lb">gcloud beta runtime-config configs create ${CONFIG} \<br/>--project=${PROJECT}</span><span id="c72f" class="je jf hi ku b fi lk kz l la lb">gcloud beta runtime-config configs variables \<br/>set username ${USERNAME} \<br/>--is-text \<br/>--config-name=${CONFIG} \<br/>--project=${PROJECT}</span><span id="668d" class="je jf hi ku b fi lk kz l la lb">gcloud beta runtime-config configs variables \<br/>set password ${PASSWORD} \<br/>--is-text \<br/>--config-name=${CONFIG} \<br/>--project=${PROJECT}</span></pre><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lj"><img src="../Images/24a73132b19863d4535c4f5cfecea24f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kIL8p_syGNW_xLSTEPZPSQ.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">云功能:“指标”</figcaption></figure><p id="f9af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">云函数(s函数！？)可与以下设备一起部署:</p><pre class="kf kg kh ki fd kt ku kv kw aw kx bi"><span id="7668" class="je jf hi ku b fi ky kz l la lb">gcloud beta functions deploy metrics \<br/>--local-path=. \<br/>--trigger-http \<br/>--entry-point=metrics \<br/>--project=${PROJECT}</span></pre><blockquote class="ll lm ln"><p id="64e0" class="if ig lo ih b ii ij ik il im in io ip lp ir is it lq iv iw ix lr iz ja jb jc hb bi translated"><strong class="ih hj"> NB </strong>有一个(未|新)记录在案的特性，它允许直接从本地文件系统进行部署，而不像我在这里所做的那样通过一个暂存桶。</p></blockquote><p id="73df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦部署了代码，如果您的粒子设备在线且可访问，您应该能够获得您的云函数(/metrics)端点:</p><pre class="kf kg kh ki fd kt ku kv kw aw kx bi"><span id="7332" class="je jf hi ku b fi ky kz l la lb">curl --silent --request GET <a class="ae jd" href="https://us-central1-dazwilkin-171228-virt-kubelet.cloudfunctions.net/metrics" rel="noopener ugc nofollow" target="_blank">https://us-central1-${PROJECT}.cloudfunctions.net/metrics</a></span></pre><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ls"><img src="../Images/914a6b232e4bef165aa49257668bdab5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NDWOUJhPU822M4kE4-B80Q.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">/指标</figcaption></figure><h2 id="163e" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">集装箱建造商</h2><p id="0905" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">正如最近<a class="ae jd" rel="noopener" href="/google-cloud/triggering-cloud-functions-deployments-97691f9b5416">所展示的</a>，使用<a class="ae jd" href="https://cloud.google.com/container-builder/" rel="noopener ugc nofollow" target="_blank"> Google Container Builder </a>部署云功能是微不足道的。这最好与您的首选源代码库(我主要使用<a class="ae jd" href="https://cloud.google.com/source-repositories/" rel="noopener ugc nofollow" target="_blank">Google Cloud Source Repositories</a>【CSR】，因为我是一个优秀的谷歌人，因为CSR工作得非常好，因为我的代码最接近运行时托管)结合起来，并使用<a class="ae jd" href="https://cloud.google.com/container-builder/docs/running-builds/automate-builds" rel="noopener ugc nofollow" target="_blank">构建触发器</a>来自动化部署流程。</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lt"><img src="../Images/d910a769778362fe315a8969881b22f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-gWGgqjEwrkwSze2RxW1zQ.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">承诺是曲折的！</figcaption></figure><p id="a480" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你希望使用这种方法，请查看我的另一篇<a class="ae jd" rel="noopener" href="/google-cloud/triggering-cloud-functions-deployments-97691f9b5416">帖子</a>了解详情。下面是cloudbuild.yaml的一个模板:</p><pre class="kf kg kh ki fd kt ku kv kw aw kx bi"><span id="d5f8" class="je jf hi ku b fi ky kz l la lb">steps:<br/>- name: gcr.io/cloud-builders/gcloud<br/>  args: [<br/>      'beta',<br/>      'functions',<br/>      'deploy','metrics',<br/>      '--source=<a class="ae jd" href="https://source.developers.google.com/projects/${PROJECT_ID}/repos/metrics/moveable-aliases/master/paths/'" rel="noopener ugc nofollow" target="_blank">https://source.developers.google.com/projects/${PROJECT_ID}/repos/{REPO}/moveable-aliases/master/paths/'</a>,<br/>      '--trigger-http',<br/>      '--entry-point=metrics',<br/>      '--project=${PROJECT_ID}'<br/>  ]</span></pre><h2 id="c13a" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">粒子控制台</h2><p id="ceb9" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">Particle公司的人对他们的解决方案做得非常好。在探索了各种设备和解决方案之后，Particle是最容易理解/使用且功能强大的设备之一。[如果他们中的任何人正在阅读这篇文章，那将很高兴看到一些直接指向<a class="ae jd" href="https://cloud.google.com/solutions/iot/" rel="noopener ugc nofollow" target="_blank">谷歌云物联网</a>的东西；-)]</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lu"><img src="../Images/444e7470970779a5368f2c800204708f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6goxSP0XVsP8oYrqB389hA.png"/></div></div></figure><h2 id="3d43" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">格拉夫纳重访</h2><p id="116c" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">一旦云函数向Prometheus提供数据，并且Grafana配置了Prometheus数据源，您将能够动态地(这非常酷)构建针对粒子度量的查询。</p><p id="16f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建新仪表板:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lv"><img src="../Images/3a8ea29e2040fbe3fc4fbf9f82210732.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5CgVwP8SGYTTg0Sj46LoAg.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">新仪表板</figcaption></figure><p id="4156" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选择“图形”。点击“面板标题”,然后点击“编辑”</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es ks"><img src="../Images/6f26f6ba4e72c6408bfa1118ba4ce052.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2-B6FpyoJ7DfnsHEGGm-TA.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">Grafana:编辑图表</figcaption></figure><p id="d680" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将“数据源”从“默认”更改为“普罗米修斯”(或任何您命名的数据源)。然后开始输入“particle ”,您应该会看到由云函数创建的指标(计数器、计量器和直方图)列表</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lw"><img src="../Images/60e925ae170bcdc6ac1fa3eb96b2a171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xUJepzglrrBzh9kl7uY9CA.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">格拉夫纳-普罗米修斯公司的整合非常出色</figcaption></figure><p id="8190" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们选择“particle_gauge”，然后优化查询，只选择那些标记为Temperature(“t”)的元素。该查询应该类似于:</p><pre class="kf kg kh ki fd kt ku kv kw aw kx bi"><span id="bed8" class="je jf hi ku b fi ky kz l la lb">particle_gauge{variable="t"}</span></pre><p id="d55b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">单击查询右侧的眼睛图标，然后单击“返回仪表板”:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="er es lx"><img src="../Images/d116ea2450854d8ce004bb8e98f98091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1er3JXZmxb5U1O4GXw84VQ.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">格拉夫纳报道粒子变量</figcaption></figure><p id="c2b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想“添加行”和重复的湿度“h”的过程。</p><h2 id="cfcb" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">结论</h2><p id="93a3" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">斜眼……是的，我仍然不确定这是否是一个有效的用例，但不可否认这是一个有趣的解决方案，它清楚地阐明了粒子云、谷歌云功能、普罗米修斯和Grafana等工具的强大功能，可以用很少的工作构建引人注目的集成。</p><p id="b47c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将非常感谢对JavaScript代码的反馈。这些承诺是曲折的，并且获取凭证→登录→获取设备→获取变量→解析和协调的链条有点“深”,但我觉得代码可以简化。</p><h2 id="7ae0" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">Google闭包编译器</h2><p id="6abc" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">所以，我想知道使用<a class="ae jd" href="https://developers.google.com/closure/compiler/" rel="noopener ugc nofollow" target="_blank">谷歌闭包编译器</a>来“优化”我的云函数代码是否有用。您可以使用App Engine托管的编译器(<a class="ae jd" href="https://closure-compiler.appspot.com" rel="noopener ugc nofollow" target="_blank">这里是</a>)亲自尝试一下，粘贴任何JavaScript(甚至是上面的my index.js)，然后查看“简单”和“高级”的结果。</p><p id="7938" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就引出了一个问题，为什么不在云函数部署之前添加一个容器构建器来运行Closure编译器呢？</p><p id="510f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经<a class="ae jd" href="https://github.com/google/closure-compiler-js/issues/89" rel="noopener ugc nofollow" target="_blank">快</a>使用JavaScript实现了，如果我提交FR，我会更新这篇文章。同时，我可能会使用Java实现创建一个构建器。</p><h2 id="2fd8" class="je jf hi bd jg jh ji jj jk jl jm jn jo iq jp jq jr iu js jt ju iy jv jw jx jy bi translated">整理</h2><p id="817e" class="pw-post-body-paragraph if ig hi ih b ii jz ik il im ka io ip iq kb is it iu kc iw ix iy kd ja jb jc hb bi translated">您可以通过删除其部分来轻松删除该集成。</p><p id="4244" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除Prometheus和|或Grafana容器:</p><pre class="kf kg kh ki fd kt ku kv kw aw kx bi"><span id="3dd3" class="je jf hi ku b fi ky kz l la lb">docker container ls --format="{{.ID}}\t\t{{ .Image}}"</span><span id="2dcc" class="je jf hi ku b fi lk kz l la lb">f95b959a4adc  grafana/grafana<br/>6c353c1a70ab  prom/prometheus</span><span id="18c5" class="je jf hi ku b fi lk kz l la lb">docker container stop ...<br/>docker container rm ...</span></pre><p id="1278" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以删除单个云功能:</p><pre class="kf kg kh ki fd kt ku kv kw aw kx bi"><span id="4020" class="je jf hi ku b fi ky kz l la lb">gcloud beta functions delete metrics --project=$PROJECT</span></pre><p id="4253" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以删除运行时配置(及其变量)或只删除变量</p><pre class="kf kg kh ki fd kt ku kv kw aw kx bi"><span id="cec1" class="je jf hi ku b fi ky kz l la lb">gcloud beta runtime-configs delete ${CONFIG} \<br/>--project=${PROJECT}</span><span id="4c6d" class="je jf hi ku b fi lk kz l la lb">gcloud beta runtime-configs unset username \<br/>--config-name=${CONFIG} \<br/>--project=${PROJECT}</span></pre><p id="880a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以删除整个谷歌云平台项目，但要像往常一样小心，因为这是不可撤销的，你将删除项目中的所有内容:</p><pre class="kf kg kh ki fd kt ku kv kw aw kx bi"><span id="8680" class="je jf hi ku b fi ky kz l la lb">gcloud projects delete ${PROJECT} --quiet</span></pre><p id="d730" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅此而已！</p></div></div>    
</body>
</html>