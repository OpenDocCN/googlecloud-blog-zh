<html>
<head>
<title>One weird trick to predict retrieval costs migrating to GCS Archive</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测迁移到GCS归档的检索成本的一个奇怪技巧</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/one-weird-trick-to-predict-retrieval-costs-in-google-cloud-storage-9824aaac1889?source=collection_archive---------0-----------------------#2020-02-12">https://medium.com/google-cloud/one-weird-trick-to-predict-retrieval-costs-in-google-cloud-storage-9824aaac1889?source=collection_archive---------0-----------------------#2020-02-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="974f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">放弃</h1><p id="8c42" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我是一名谷歌人，具体在谷歌云工作。这里陈述的所有观点都是我自己的，而不是谷歌公司的。</p><h1 id="022b" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">附加免责声明</h1><p id="9481" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我马上就要说重点了，但是我真的想把这个讲清楚。在这篇文章中，我将讨论谷歌云定价。<strong class="jf hj"> <em class="kb">我不是谷歌云定价的权威。我可能把我的事实搞混了。事实可能会在我发表后改变，我可能会忘记更新。我可能会对定价规则之间微妙的相互作用感到困惑。我不能保证我在这里说的任何事情都是准确的。因此，请对照<a class="ae kc" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云平台网站</a>上的文档检查您自己的用例及计划，如果有任何不清楚的地方，请通过GCP控制台联系支持人员。</em></strong></p><h1 id="6e19" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">介绍</h1><p id="cc74" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">随着新的归档存储类别的<a class="ae kc" href="https://cloud.google.com/blog/products/storage-data-transfer/archive-storage-class-for-coldest-data-now-available" rel="noopener ugc nofollow" target="_blank">发布(目前为每月每TB 1.23美元！)办公室里的一个热门话题是检索成本。最常见的情况是，这种询问来自已经在使用“更冷”存储层的客户，尤其是Coldline，他们希望使用更冷的存储层。</a></p><figure class="kd ke kf kg fd kh"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="ebbe" class="pw-post-body-paragraph jd je hi jf b jg kk ji jj jk kl jm jn jo km jq jr js kn ju jv jw ko jy jz ka hb bi translated">当我说“冷”时，让我澄清一下我的意思，因为这对任何类型的归档存储的长期成功都很重要。通常，归档存储以某种节省空间和成本的方式存储，但这是以易于访问为代价的。把它想象成在一个未完工的阁楼里保存东西。在那里储存物品“花费”很少(可用的平方英尺)，但是通过在梯子上上下下搬运物品“花费”很大(时间和精力)。</p><p id="f9a7" class="pw-post-body-paragraph jd je hi jf b jg kk ji jj jk kl jm jn jo km jq jr js kn ju jv jw ko jy jz ka hb bi translated">在GCS中，有四种存储类别(可以在给定的存储桶中混合使用，并且不受位置限制)。下面是它们的访问频率:</p><ul class=""><li id="8bc1" class="kp kq hi jf b jg kk jk kl jo kr js ks jw kt ka ku kv kw kx bi translated"><strong class="jf hj">标准</strong>:定期访问。</li><li id="9a01" class="kp kq hi jf b jg ky jk kz jo la js lb jw lc ka ku kv kw kx bi translated"><strong class="jf hj">近线</strong>:每月访问不到一次。</li><li id="e2ed" class="kp kq hi jf b jg ky jk kz jo la js lb jw lc ka ku kv kw kx bi translated"><strong class="jf hj"> Coldline </strong>:每季度访问不到一次。</li><li id="8052" class="kp kq hi jf b jg ky jk kz jo la js lb jw lc ka ku kv kw kx bi translated"><strong class="jf hj">存档</strong>:一年访问不到一次。</li></ul><p id="c0a0" class="pw-post-body-paragraph jd je hi jf b jg kk ji jj jk kl jm jn jo km jq jr js kn ju jv jw ko jy jz ka hb bi translated">注意这些指导方针很重要。关键是，你不应该认为这是“所有的数据都必须这样使用。”这是另一个话题，但是你基本上想要确信大多数数据会以这种方式使用，或者至少有足够多的数据会让你通过转换的盈亏平衡点。</p><p id="a615" class="pw-post-body-paragraph jd je hi jf b jg kk ji jj jk kl jm jn jo km jq jr js kn ju jv jw ko jy jz ka hb bi translated">换句话说，如果你一年去阁楼少于一次，大多数年，你有正确的东西存放在那里。</p><h1 id="7251" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">一个奇怪的把戏</h1><p id="419c" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">好吧，你确定存档适合你。现在你可能会问，我会支付检索成本将现有的GCS数据转移到那里吗？我是这样分解的:</p><blockquote class="ld le lf"><p id="4342" class="jd je kb jf b jg kk ji jj jk kl jm jn lg km jq jr lh kn ju jv li ko jy jz ka hb bi translated">除非<a class="ae kc" href="https://cloud.google.com/storage/docs/lifecycle" rel="noopener ugc nofollow" target="_blank">对象生命周期管理</a>为您移动对象，否则移动<strong class="jf hj">将</strong>收取源存储类的检索费(可能还有提前删除费)。</p></blockquote><p id="9aad" class="pw-post-body-paragraph jd je hi jf b jg kk ji jj jk kl jm jn jo km jq jr js kn ju jv jw ko jy jz ka hb bi translated">具体来说，对象生命周期管理将通过<a class="ae kc" href="https://cloud.google.com/storage/pricing#operations-pricing" rel="noopener ugc nofollow" target="_blank">一个SetStorageClass操作</a>来执行操作。这将按<em class="kb">目的地</em>等级的A级价格<em class="kb"> * </em>计费。但是因为SetStorageClass不是重写，所以检索成本<a class="ae kc" href="https://cloud.google.com/storage/docs/lifecycle#early_deletion_behavior" rel="noopener ugc nofollow" target="_blank">和提前删除成本</a>都不适用(它不会创建新对象)。</p><p id="f312" class="pw-post-body-paragraph jd je hi jf b jg kk ji jj jk kl jm jn jo km jq jr js kn ju jv jw ko jy jz ka hb bi translated">有一点要注意，这只在一个方向有效:<strong class="jf hj">更冷</strong>。任何向更热的存储类别(如Standard)的移动都需要通过复制或重写操作来创建新对象，因此检索(以及可能的早期删除)成本将适用。</p><h1 id="4a08" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated"><strong class="ak">场景</strong></h1><p id="d84d" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hj">使用生命周期管理将数据从标准文件移至归档文件</strong></p><p id="198e" class="pw-post-body-paragraph jd je hi jf b jg kk ji jj jk kl jm jn jo km jq jr js kn ju jv jw ko jy jz ka hb bi translated">没有检索成本。在这种情况下，您需要为每个对象支付一次SetStorageClass(A类)操作的费用，按照目标类(Archive)的费率。</p><p id="a3fe" class="pw-post-body-paragraph jd je hi jf b jg kk ji jj jk kl jm jn jo km jq jr js kn ju jv jw ko jy jz ka hb bi translated"><strong class="jf hj">使用重写API方法将数据从标准文件移至存档文件</strong></p><p id="ac1b" class="pw-post-body-paragraph jd je hi jf b jg kk ji jj jk kl jm jn jo km jq jr js kn ju jv jw ko jy jz ka hb bi translated">没有检索成本。在这种情况下，您将按照目标类(归档)的费率支付一次storage . objects . rewrite(A类)操作的费用。虽然您正在创建一个新的对象，但是Standard没有检索成本，所以操作是这里唯一的成本。</p><p id="87d7" class="pw-post-body-paragraph jd je hi jf b jg kk ji jj jk kl jm jn jo km jq jr js kn ju jv jw ko jy jz ka hb bi translated"><strong class="jf hj">使用生命周期管理将数据从Coldline转移到归档</strong></p><p id="142c" class="pw-post-body-paragraph jd je hi jf b jg kk ji jj jk kl jm jn jo km jq jr js kn ju jv jw ko jy jz ka hb bi translated">没有检索成本。在这种情况下，您需要为每个对象支付一次SetStorageClass(A类)操作的费用，按照目标类(Archive)的费率。由于Lifecycle直接改变了类，而不是创建一个新的对象，所以检索成本被免除了。</p><p id="c788" class="pw-post-body-paragraph jd je hi jf b jg kk ji jj jk kl jm jn jo km jq jr js kn ju jv jw ko jy jz ka hb bi translated"><strong class="jf hj">使用重写API方法将数据从Coldline移至存档</strong></p><p id="3513" class="pw-post-body-paragraph jd je hi jf b jg kk ji jj jk kl jm jn jo km jq jr js kn ju jv jw ko jy jz ka hb bi translated">肯定是检索成本。在这种情况下要小心！你在制造一个新的物体。您将按照目标类(归档)的费率支付一次storage . objects . rewrite(A类)操作，并按照Coldline费率支付检索费。</p></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es lq"><img src="../Images/2524cf830f8e14fe318f1b79b8b96d42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qpMAGAYwVqxHnhlwfr2y6Q.jpeg"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">"所有这些存档的东西都让我想放声歌唱！"</figcaption></figure><p id="94ee" class="pw-post-body-paragraph jd je hi jf b jg kk ji jj jk kl jm jn jo km jq jr js kn ju jv jw ko jy jz ka hb bi translated"><em class="kb">*目前，这仅适用于归档存储类。其他存储类别按照SetStorageClass的源存储类别费率对操作计费。因为这是不协调的，所以我坚持使用本文中的归档案例。</em></p></div></div>    
</body>
</html>