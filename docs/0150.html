<html>
<head>
<title>Running Gitlab CI Runner in GCE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在GCE中运行Gitlab CI Runner</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/running-gitlab-ci-runner-in-gce-b74b5343c044?source=collection_archive---------0-----------------------#2016-09-22">https://medium.com/google-cloud/running-gitlab-ci-runner-in-gce-b74b5343c044?source=collection_archive---------0-----------------------#2016-09-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="18eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本周早些时候，我决定尝试一下Gitlab CI，并开始研究如何建立一个Docker容器集群来处理所有的测试。</p><p id="1104" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">经过大量的反复试验和数小时的挫折(大约20小时)，我终于想出了一个看起来相当可靠的组合。</p><p id="784b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我想把这个组合分享给任何人使用，这样他们就不用花那些令人沮丧的时间(希望如此)在调试<a class="ae jd" href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner" rel="noopener ugc nofollow" target="_blank"> Gitlab Multi Runner </a>、<a class="ae jd" href="https://docs.docker.com/machine/" rel="noopener ugc nofollow" target="_blank"> Docker Machine </a>和<a class="ae jd" href="https://cloud.google.com/compute/" rel="noopener ugc nofollow" target="_blank"> GCE </a>组合的怪异之处了。</p><p id="2a0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的Github repo<a class="ae jd" href="https://github.com/jerryjj/gitlab-runner-gce" rel="noopener ugc nofollow" target="_blank">https://github.com/jerryjj/gitlab-runner-gce</a>中可以找到关于如何设置这个自动伸缩基础设施的完整设置和说明。</p><p id="e359" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简而言之，这个设置将执行以下操作:<br/> 1 .在GCP项目中设置一个NAT-gateway供工人使用<br/> 2。设置一个g1-small实例作为Gitlab Runner <br/> 3。将这个runner注册到您的Gitlab实例<br/> 4。配置Docker机器以启动G1-小型可抢占虚拟机作为工作机。</p><p id="51e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在空闲状态下，这种配置的成本约为。每月20美元。</p><p id="08b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装完成并且集群稳定后，使用它就非常简单了。<br/>在Node.js项目的例子中，你可以写一个这样的文件，并将其命名为”。gitlab-ci-yml”并将其推送到您的存储库</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="9f3f" class="jn jo hi jj b fi jp jq l jr js">image: node:6</span><span id="49ed" class="jn jo hi jj b fi jt jq l jr js">cache:<br/> paths:<br/> — node_modules/</span><span id="2837" class="jn jo hi jj b fi jt jq l jr js">test_all:<br/> stage: test<br/> script:<br/> — npm install<br/> — npm test<br/> tags:<br/> — backend</span></pre><p id="5aec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就这样，你的跑步者集群介入并开始为你工作。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="35dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kb">原载于2016年9月22日</em><a class="ae jd" href="http://totallyon.me/2016/09/22/running-gitlab-ci-runner-in-gce/" rel="noopener ugc nofollow" target="_blank"><em class="kb">total Lyon . me</em></a><em class="kb">。</em></p></div></div>    
</body>
</html>