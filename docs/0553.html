<html>
<head>
<title>Setting up TensorFlow GPU on Google Cloud Instance with Ubuntu 16.04</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Ubuntu 16.04在Google Cloud实例上设置TensorFlow GPU</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/setting-up-tensorflow-gpu-on-google-cloud-instance-with-ubuntu-16-04-53cb6749b527?source=collection_archive---------0-----------------------#2018-04-01">https://medium.com/google-cloud/setting-up-tensorflow-gpu-on-google-cloud-instance-with-ubuntu-16-04-53cb6749b527?source=collection_archive---------0-----------------------#2018-04-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8f93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我最近建立了一个谷歌云实例来训练一些TensorFlow模型。虽然Amazon EC2的ami已经为您配置好了一切，但在Google Cloud上，您需要自己设置一切。我花了几天时间来做这件事，我在网上找到的说明——无论是从<a class="ae jd" href="https://cloud.google.com/compute/docs/gpus/add-gpus#install-gpu-driver" rel="noopener ugc nofollow" target="_blank">谷歌</a>还是从<a class="ae jd" rel="noopener" href="/google-cloud/using-a-gpu-tensorflow-on-google-cloud-platform-1a2458f42b0">其他地方</a>都是针对旧版本的TensorFlow的，所以不能与最新版本一起使用，在我写这篇文章的时候，最新版本是1.7。</p><p id="84da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些指令将适用于1.7版，并且已经过多次测试。我希望它们能帮助人们不必花几天时间在网上搜索来解码各种错误信息。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><p id="ea6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这摘自Google说明，但使用了适用于TensorFlow v1.7版的正确版本的CUDA:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="840c" class="ju jv hi jq b fi jw jx l jy jz">curl -O <a class="ae jd" href="https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1604/x86_64/cuda-repo-ubuntu1604_9.0.176-1_amd64.deb" rel="noopener ugc nofollow" target="_blank">https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1604/x86_64/cuda-repo-ubuntu1604_9.0.176-1_amd64.deb</a><br/>sudo dpkg -i cuda-repo-ubuntu1604_9.0.176-1_amd64.deb<br/>sudo apt-get update<br/>sudo apt-get install cuda-9-0<br/>sudo nvidia-smi -pm 1</span></pre><p id="eef7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，您应该验证所有组件都已安装，并且可以使用:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="a204" class="ju jv hi jq b fi jw jx l jy jz">nvidia-smi</span></pre><p id="4196" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谷歌的说明没有提到安装cudnn，但它似乎是必需的。要下载它，你需要注册<a class="ae jd" href="https://developer.nvidia.com/developer-program" rel="noopener ugc nofollow" target="_blank"> Nvidia的开发者程序</a>，下载它，然后上传到你的实例。我用SCP上传了它，花了一些时间。我用的文件是libcudnn 7 _ 7 . 0 . 4 . 31–1+cuda 9.0 _ amd64 . deb，这是用TensorFlow 1.7的cuda-9.0需要的版本。上传后，您可以使用以下软件进行安装:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="3643" class="ju jv hi jq b fi jw jx l jy jz">sudo dpkg -i libcudnn7_7.0.4.31-1+cuda9.0_amd64.deb</span></pre><p id="5226" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦安装完毕，你需要设置一些路径变量。Google的指令将变量临时添加到path中，因此需要在每次启动实例时运行。这将永久添加它们:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="b100" class="ju jv hi jq b fi jw jx l jy jz">echo 'export CUDA_HOME=/usr/local/cuda' &gt;&gt; ~/.bashrc<br/>echo 'export PATH=$PATH:$CUDA_HOME/bin' &gt;&gt; ~/.bashrc<br/>echo 'export LD_LIBRARY_PATH=/usr/local/cuda/extras/CUPTI/lib64:$LD_LIBRARY_PATH' <!-- -->&gt;&gt; ~/.bashrc</span><span id="8255" class="ju jv hi jq b fi ka jx l jy jz">source ~/.bashrc</span></pre><p id="46bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，您可以安装TensorFlow:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="ef26" class="ju jv hi jq b fi jw jx l jy jz">sudo apt-get install python3-dev python3-pip libcupti-dev<br/>sudo pip3 install tensorflow-gpu</span></pre><p id="3c67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，我使用的是python3和pip3，但是如果您想使用python3，只需从上面的命令中删除“3”即可。完成后，您应该能够正确无误地导入tensorflow。</p><p id="986b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，Google建议了一些设置来优化GPU性能:</p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="38a3" class="ju jv hi jq b fi jw jx l jy jz"># this applies to all GPUs<br/>sudo nvidia-smi -pm 1</span><span id="8886" class="ju jv hi jq b fi ka jx l jy jz"># these only apply to Nvidia Tesla K80s<br/>sudo nvidia-smi -ac 2505,875<br/>sudo nvidia-smi --auto-boost-default=DISABLED</span></pre></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><p id="e088" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你在运行TensorFlow代码时仍然有问题，我<a class="ae jd" href="https://devtalk.nvidia.com/default/topic/936212/tensorflow-cannot-find-cudnn-ubuntu-16-04-cuda7-5-/" rel="noopener ugc nofollow" target="_blank">找到了</a>以下我执行的步骤，虽然我不确定它们是否必要。我这样做只是因为，但是我遇到的问题可以通过正确导出路径来解决，但是我不想设置另一个实例来检查它们是否是必需的:</p><ol class=""><li id="3fbd" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated"><code class="du kk kl km jq b">cd /usr/local/cuda</code></li><li id="bda5" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc kg kh ki kj bi translated"><code class="du kk kl km jq b">sudo ln -s /usr/lib/x86_64-linux-gnu/ lib64</code></li><li id="7885" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc kg kh ki kj bi translated"><code class="du kk kl km jq b">sudo ln -s /usr/include/ include</code></li><li id="fcde" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc kg kh ki kj bi translated"><code class="du kk kl km jq b">sudo ln -s /usr/bin/ bin</code></li><li id="3205" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc kg kh ki kj bi translated"><code class="du kk kl km jq b">sudo ln -s /usr/lib/x86_64-linux-gnu/ nvvm</code></li><li id="9714" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc kg kh ki kj bi translated"><code class="du kk kl km jq b">sudo mkdir -p extras/CUPTI</code></li><li id="8040" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc kg kh ki kj bi translated"><code class="du kk kl km jq b">cd extras/CUPTI</code></li><li id="1c72" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc kg kh ki kj bi translated"><code class="du kk kl km jq b">sudo ln -s /usr/lib/x86_64-linux-gnu/ lib64</code></li><li id="da4b" class="kb kc hi ih b ii kn im ko iq kp iu kq iy kr jc kg kh ki kj bi translated"><code class="du kk kl km jq b">sudo ln -s /usr/include/ include</code></li></ol><p id="98b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里的步骤摘自<a class="ae jd" rel="noopener" href="/google-cloud/using-a-gpu-tensorflow-on-google-cloud-platform-1a2458f42b0">这篇文章</a>，这是我找到的最有用的说明，但对当前版本的TensorFlow无效。</p></div></div>    
</body>
</html>