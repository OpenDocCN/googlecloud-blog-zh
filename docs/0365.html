<html>
<head>
<title>Why Google PubSub? — Streaming financial data thru PubSub to BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么要Google PubSub？—通过PubSub向BigQuery传输财务数据</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/why-google-pubsub-streaming-financial-data-thru-pubsub-to-bigquery-de9bcd02ff46?source=collection_archive---------2-----------------------#2017-08-29">https://medium.com/google-cloud/why-google-pubsub-streaming-financial-data-thru-pubsub-to-bigquery-de9bcd02ff46?source=collection_archive---------2-----------------------#2017-08-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/920fc187860f57f134566ca5cc8e7e7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xUq3xZRbW0_wZMJwhNbXEQ.png"/></div></div></figure><p id="1e92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在现代云架构中，构建和部署应用程序比以往容易得多。此外，应用程序被构建成更小、更独立的构件，更易于开发和维护。然而，除了现代云提供的优势，在现代云中构建和部署应用程序需要考虑的一个重要问题是应用程序的弹性。</p><p id="9947" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">弹性的一个方面，可伸缩性已经在许多云产品中得到考虑；例如，在谷歌云中运行更多的计算引擎可以帮助重新分配进入应用程序的大量流量。然而，弹性的另一个重要方面是应用程序之间的交互，这意味着应用程序相互依赖的程度。一个简单的例子是，计算引擎将数据发送到与处理用户信息的API交互的数据库。它们都严重依赖彼此来使应用程序工作。然而，如果前一句中描述的一个单独的组件不再起作用，整个系统就不能工作，因为它们需要一个又一个组件来使系统起作用。为了帮助实现这方面的弹性，Google Cloud PubSub是一个完美的选择！</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jo"><img src="../Images/920d6006e4fa7732ea0532819856fe48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WVgly3FWxQU6QvTsmgSwkg.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">发布订阅流程图</figcaption></figure><p id="f5a2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在谷歌云平台中，PubSub是一个消息队列服务，允许你在独立的应用程序之间发送和接收消息。PubSub在不使应用程序严重依赖彼此方面起着关键作用；PubSub将应用程序解耦，这意味着应用程序独立执行其任务，但仍然作为部署在云中的系统的一部分一起工作。与前面的场景一样，PubSub不是让应用程序直接相互交互，而是位于数据库和应用程序引擎或其他地方的API之间，数据库通过PubSub发布消息，而订阅者API通过相同的方式接收消息。在这种方式下，即使订阅者发生故障，PubSub也会保存消息，直到它重新联机，并在它重新联机时发送它们，这意味着它们是解耦的。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jx"><img src="../Images/097c488e67cab206dd2051bc5e380bb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aKCeHorp5V9bKX7AIDVssw.png"/></div></div></figure><p id="0b15" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过这个处理PubSub和BigQuery的独立项目，我想分享我使用PubSub和BigQuery的关键概念和步骤。此外，为了进行演示，我创建了一个简单的Python函数，它将google股票价格作为数据流发送到PubSub和BigQuery。所有的作品都可以在这里找到，</p><pre class="jp jq jr js fd jy jz ka kb aw kc bi"><span id="d4a9" class="kd ke hi jz b fi kf kg l kh ki"> <a class="ae kj" href="https://github.com/mchon89/Google_PubSub_BigQuery" rel="noopener ugc nofollow" target="_blank">https://github.com/mchon89/Google_PubSub_BigQuery</a></span></pre><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kk"><img src="../Images/f359ee69322ce8325f71395f94c035e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zM4ZD9oBFY24yRPh4UrMag.png"/></div></div></figure><ol class=""><li id="1cb9" class="kl km hi is b it iu ix iy jb kn jf ko jj kp jn kq kr ks kt bi translated">转到谷歌云控制台，启用API。</li><li id="fc6b" class="kl km hi is b it ku ix kv jb kw jf kx jj ky jn kq kr ks kt bi translated">打开您的Google Cloud Shell并复制存储库。</li></ol><pre class="jp jq jr js fd jy jz ka kb aw kc bi"><span id="9772" class="kd ke hi jz b fi kf kg l kh ki">git clone <a class="ae kj" href="https://github.com/mchon89/Google_PubSub_BigQuery" rel="noopener ugc nofollow" target="_blank">https://github.com/mchon89/Google_PubSub_BigQuery</a></span></pre><p id="243c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.这是最重要的一步。不要忘记！输入以下命令:</p><pre class="jp jq jr js fd jy jz ka kb aw kc bi"><span id="0d01" class="kd ke hi jz b fi kf kg l kh ki">gcloud auth application-default login</span></pre><p id="2d9f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">键入“Y”并转到提供的链接。确保在允许Google Cloud控制台访问帐户后复制并粘贴提供的密钥。如果Google Cloud Shell由于缺乏活动而断开连接，您必须再次经历这个过程。</p><p id="c69a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.转到BigQuery控制台，创建一个名为“demo_stock”的数据集和一个名为“google”的表。这些名称可以更改，但请确保您也更改了python脚本中的名称。输入以下命令:</p><pre class="jp jq jr js fd jy jz ka kb aw kc bi"><span id="3aa6" class="kd ke hi jz b fi kf kg l kh ki">python pubsub_to_bigquery.py --price='put any number here'</span></pre><p id="e83e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">— price是GOOGL股票的初始价格。例如，价格=25。</p><p id="5cb0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.现在，假的谷歌股票价格被生成并发送给BigQuery。现在转到BigQuery控制台。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kz"><img src="../Images/b4212bae77c24a23b0d6a88231727570.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BuHqbexpJEZI8upu9zjlPw.png"/></div></div></figure><p id="becc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">作为预览，由于流缓冲区的原因，您不会看到任何数据流入BigQuery。但是，当运行查询时，您将看到数据。所以，不要担心！</p><p id="ad02" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">6.可以在BigQuery上运行一个简单的查询，例如</p><pre class="jp jq jr js fd jy jz ka kb aw kc bi"><span id="f67f" class="kd ke hi jz b fi kf kg l kh ki">SELECT * FROM demo_stock.google ORDER BY STOCK DESC;</span></pre><p id="417e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">希望你开始掌握Google PubSub的概念；对我来说，理解这个概念和PubSub的功能需要一段时间。想了解更多信息，你可以随时访问https://cloud.google.com/pubsub/docs/。感谢阅读，并随时留下评论。</p><blockquote class="la"><p id="e322" class="lb lc hi bd ld le lf lg lh li lj jn dx translated">“我们从失败中学到的最多，而不是从成功中学到的”</p></blockquote></div></div>    
</body>
</html>