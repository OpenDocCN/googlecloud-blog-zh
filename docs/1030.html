<html>
<head>
<title>Create BigQuery tables with Google Sheets and Apps Script</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Google Sheets和Apps脚本创建BigQuery表</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/https-medium-com-duizendstra-create-bigquery-tables-with-google-sheets-and-apps-script-a0751b43a952?source=collection_archive---------0-----------------------#2019-06-12">https://medium.com/google-cloud/https-medium-com-duizendstra-create-bigquery-tables-with-google-sheets-and-apps-script-a0751b43a952?source=collection_archive---------0-----------------------#2019-06-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a45248cdacc719d59f4b6f89ba3a2f28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XBm3hAKQukrotNE0ULxIyg.jpeg"/></div></div></figure><p id="3a9f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用标准GUI创建BigQuery表可能会很麻烦。本文描述了使用<strong class="is hj"> BigQuery表构建器表</strong>创建BigQuery表的另一种方法。这个Google电子表格自动创建BigQuery表，记录这些表，并支持围绕表模式设计的协作。</p><h1 id="f825" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">图纸的设置和配置</h1><p id="f32d" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">假设对Google云平台、项目、支持API和BigQuery有基本的了解。此表仅适用于启用了BigQuery API的项目。如果你遇到困难，请在下面留下评论，我会帮助你设置表格。</p><p id="77a0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先创建一个<a class="ae kr" href="https://docs.google.com/spreadsheets/d/1mYftiWPLmACPTXv-M4RrfcFeMCQ-HP62tAYbj8bggMA/copy" rel="noopener ugc nofollow" target="_blank"> 2019 BigQuery表构建器表</a>的副本。将出现一个新的菜单项“BigQuery menu”。这可能需要最多30秒。create table菜单选项将激活BigQuery表的创建。第一次运行此操作时，您需要授权将创建表的脚本。</p><p id="0546" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，在config选项卡中添加您想要使用的项目id和数据集</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es ks"><img src="../Images/2e31ae286a0c0692f7e454b58c33202e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*7ufa7-YjzYADtOnpcWOHmg.png"/></div></figure><p id="6d6e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">电子表格中的每个选项卡代表一个表格。对于多个表，创建现有选项卡的副本并用新的替换字段定义。</p><p id="845b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在B列中，选择正确的项目id、数据集和表名。描述字段是可选的，它将被复制到表的描述字段。对于每个字段，填写名称、数据类型和类型以及可选的描述。重复字段使用点符号。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/a5b815acd66d41f07553c63f82d8cf42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KGm20YQrGpehPtckt7k8eA.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">完全填充的表的示例</figcaption></figure><p id="c372" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦建立了表并定义了表，就可以创建表了。为了防止删除现有的表，工作表永远不会覆盖表，如果表已经存在，工作表将抛出一个错误消息。</p><h1 id="5654" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">它是如何开始的</strong></h1><p id="239f" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我创建这个表是为了加快创建BigQuery表的过程。它从一个简单的工作表开始，包含一些标准函数，这些函数产生了JSON模式。可以将该模式复制到GUI中来创建表。这工作得很好，我开始对所有的BigQuery表使用这个表。一个好处是在一个地方记录和创建表格。</p><p id="62b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步是在团队中分享工作表。Google sheets非常适合协作，并为我提供了一种与其他团队成员共享表格设计的方式。关于字段名的争论被移到了评论中，每个人都在使用同一个版本。</p><p id="c6f6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该表的附加值是显而易见的，我开始寻找一些优化。自动创建表，支持记录和重复字段会很好。</p><h1 id="4c41" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">床单的工作原理</h1><p id="3f91" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">当你想到G Suite中的自动化时，你会想到Google Apps脚本。从网站:</p><blockquote class="lc ld le"><p id="2268" class="iq ir lf is b it iu iv iw ix iy iz ja lg jc jd je lh jg jh ji li jk jl jm jn hb bi translated">Apps Script是一个快速的应用程序开发平台，使得创建与G Suite集成的业务应用程序变得快速而简单。</p></blockquote><p id="17a1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我使用apps脚本在生成JSON模式的工作表中创建了一个<a class="ae kr" href="https://developers.google.com/apps-script/guides/sheets/functions" rel="noopener ugc nofollow" target="_blank">自定义函数</a>。一个<a class="ae kr" href="https://developers.google.com/apps-script/guides/menus" rel="noopener ugc nofollow" target="_blank">定制菜单</a>被添加到运行创建表格的函数的表单中。该函数使用Apps脚本中的<a class="ae kr" href="https://developers.google.com/apps-script/guides/services/advanced" rel="noopener ugc nofollow" target="_blank">高级Google服务</a>来调用<a class="ae kr" href="https://developers.google.com/apps-script/advanced/bigquery" rel="noopener ugc nofollow" target="_blank"> BigQuery API。</a></p><p id="0c72" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">自定义菜单是通过onOpen功能添加的。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="126b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该函数在工作表加载时被调用，它会将菜单项添加到菜单栏。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/4bc251de8ba3138118b835725ac923bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*xNsRgGvrBuFVGRSxvtKxuQ.png"/></div></figure><p id="142e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">菜单项调用<em class="lf"> createTable </em>函数。<em class="lf"> createTable </em>函数从工作表中收集数据并调用BigQuery API。根据设计，如果表已经存在，它将失败。这是为了防止用数据替换现有的表。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="e448" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">bqShema函数用于创建BigQuery模式。该函数使用递归在bq模式中创建记录。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="lj lk l"/></div></figure></div></div>    
</body>
</html>