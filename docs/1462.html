<html>
<head>
<title>Google Forms to Datastudio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google Forms to Datastudio</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/google-forms-to-datastudio-74bfdb6ddd71?source=collection_archive---------0-----------------------#2020-06-07">https://medium.com/google-cloud/google-forms-to-datastudio-74bfdb6ddd71?source=collection_archive---------0-----------------------#2020-06-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="554a" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">..或者如何通过“unpivoting”将平行列中的同构数据放到Datastudio上的单个DataSource中。<br/> <strong class="il hj">【链接】下的</strong>代码；如果你懒得滚动:<a class="ae jh" href="https://datastudio.google.com/u/0/reporting/9efbbc78-be8e-4d08-b7e0-7a105114d088/page/j1qNB" rel="noopener ugc nofollow" target="_blank"> Datastudio </a>和<a class="ae jh" href="https://github.com/palladius/unpivoting" rel="noopener ugc nofollow" target="_blank"> GitHub </a></p></blockquote><h1 id="33bd" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">介绍</h1><p id="fb54" class="pw-post-body-paragraph ii ij hi il b im kg io ip iq kh is it ki kj iw ix kk kl ja jb km kn je jf jg hb bi translated">让我们假设你有一个<a class="ae jh" href="https://docs.google.com/forms/d/e/1FAIpQLSc8Z4fFe9AtjilgJF179Kr6rOo-7uV3vTuLtTCuFiFvfkkwSg/viewform?usp=sf_link" rel="noopener ugc nofollow" target="_blank">谷歌表单</a>，有N个问题，在回答空间中是不同种类的。</p><ol class=""><li id="87eb" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg kt ku kv kw bi translated">你觉得冰淇淋怎么样？[1–5]</li><li id="c439" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">你觉得比萨饼怎么样？[1–5]</li><li id="dde5" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">你觉得谷歌的产品怎么样？[1–5]</li><li id="3cfa" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">你支持唐老鸭吗？{是/否/弃权}</li><li id="9c16" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">你喜欢冰淇淋吗？{是/否/弃权}</li><li id="0b20" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">你支持博尔佐纳罗吗？{是/否/弃权}</li></ol><p id="cd39" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">这6个问题是“异质”的，但是如果你把它们分成两组，每组三个，它们就是同质的。这意味着，虽然问题1和5 <em class="ik">感觉</em>相同，但是[1/2/3]和[4/5/6]的问题输出是相似的。这意味着我们可以放入同一个图1，2，3，然后在另一个图中我们可以比较4/5/6，但我们不能放入同一个图[1，5]，除非我们做出一些语义妥协(在1到5的范围内，白色表示是，什么是不是？3是弃权吗？不同的人可能有不同的想法)。</p><h1 id="ecca" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">问题陈述</h1><p id="77f9" class="pw-post-body-paragraph ii ij hi il b im kg io ip iq kh is it ki kj iw ix kk kl ja jb km kn je jf jg hb bi translated">虽然Google Forms提供了许多列(每个答案一个)，但Google Datastudio想要的更少(每个组一个)。我有一种感觉，你可能有两种不同的工具和我一样的问题；如果有，继续读下去。</p><figure class="ld le lf lg fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es lc"><img src="../Images/fe5259a5055391619b8a4270703116dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o8W0lFA7E-OND0CEOtDnvQ.png"/></div></div></figure><p id="4d8d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">本教程将向您展示如何使用Google <strong class="il hj">表单</strong>，Google <strong class="il hj">电子表格</strong>，<a class="ae jh" href="https://developers.google.com/apps-script" rel="noopener ugc nofollow" target="_blank"> <strong class="il hj"> AppsScript </strong> </a>和<strong class="il hj"> Datastudio </strong>将汇总的数据比较成漂亮的图表，首先通过一些<em class="ik">反透视</em>对数据进行按摩。</p><h1 id="8e10" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">关于作者</h1><p id="e65e" class="pw-post-body-paragraph ii ij hi il b im kg io ip iq kh is it ki kj iw ix kk kl ja jb km kn je jf jg hb bi translated">我是一个生活在国外的<strong class="il hj">意大利人</strong>，表格中的问题强烈带有我的国籍偏见。美国人，你可能不同意我对披萨、意大利面和意大利面上的肉丸的一些看法(尽管大约6000万意大利人可能不会同意)。没什么大不了的。</p><p id="19e6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">我也喜欢骑自行车，弹钢琴，和我的两个孩子一起玩。<a class="ae jh" href="http://www.palladius.it" rel="noopener ugc nofollow" target="_blank">更多关于自己的</a>。</p><h1 id="8ea8" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">先决条件</h1><p id="ccd5" class="pw-post-body-paragraph ii ij hi il b im kg io ip iq kh is it ki kj iw ix kk kl ja jb km kn je jf jg hb bi translated">请<strong class="il hj">开始投票</strong> <a class="ae jh" href="https://docs.google.com/forms/d/e/1FAIpQLSc8Z4fFe9AtjilgJF179Kr6rOo-7uV3vTuLtTCuFiFvfkkwSg/viewform?usp=sf_link" rel="noopener ugc nofollow" target="_blank"> <strong class="il hj">这里</strong> </a>。如果你先把数据填好，你就会明白了。如果你不想和我分享你的邮件，请不要投票。</p><p id="3205" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">拥有一个谷歌账户。所有实验都是免费的(感谢谷歌！我可能有偏见)并且我已经尝试打开我创建的工件以确保你能跟随。在这个练习中，我们将使用<a class="ae jh" href="https://docs.google.com/forms/u/0/?tgif=d" rel="noopener ugc nofollow" target="_blank">谷歌表单</a>、<a class="ae jh" href="https://docs.google.com/spreadsheets/u/0/" rel="noopener ugc nofollow" target="_blank">谷歌电子表格</a>(及其<em class="ik">神奇的</em>脚本功能)和<a class="ae jh" href="https://datastudio.google.com/" rel="noopener ugc nofollow" target="_blank">数据工作室</a>。</p><h1 id="0b49" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">创建您的表单</h1><p id="2940" class="pw-post-body-paragraph ii ij hi il b im kg io ip iq kh is it ki kj iw ix kk kl ja jb km kn je jf jg hb bi translated">让我们拿一个<a class="ae jh" href="https://docs.google.com/forms/d/1_FOwUao7juUbXc_cskhLBcjkjyQkXirJSqrJTm2326c/edit" rel="noopener ugc nofollow" target="_blank"> Google表单</a> ( <a class="ae jh" href="https://docs.google.com/forms/d/e/1FAIpQLSc8Z4fFe9AtjilgJF179Kr6rOo-7uV3vTuLtTCuFiFvfkkwSg/viewform" rel="noopener ugc nofollow" target="_blank">视图</a>)并开始填充几个多选网格:</p><figure class="ld le lf lg fd lh er es paragraph-image"><div class="er es lo"><img src="../Images/1c21845817d6e5a522fe7dd4fd160724.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*YVL3ETNJBUpVKEuk"/></div></figure><p id="5ee6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">…变成(在<em class="ik">视图</em>格式中):</p><figure class="ld le lf lg fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es lp"><img src="../Images/37d56d05348a51abd7dfb3ea71266f00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hSkR9IBJZ1sIhw4r"/></div></div></figure><p id="b8d8" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated"><a class="ae jh" href="https://docs.google.com/spreadsheets/d/1KR0UBQr5MkCfDNylDpo8cnj5NoPuZbY1gIIGKIIrcaU/edit#gid=468422675" rel="noopener ugc nofollow" target="_blank"> <strong class="il hj">下面是</strong> </a>电子表格如何对数据进行编码。</p><p id="824f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">注意:您可以随意编辑表单，但是如果您这样做，电子表格将会改变，公式将会中断。</p><p id="6497" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">未来的自我提醒:创建一个足够智能的公式来跟上变化，并从标题中自动推断公式。</p><h1 id="7774" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">将您的投票导入Datastudio</h1><p id="fec6" class="pw-post-body-paragraph ii ij hi il b im kg io ip iq kh is it ki kj iw ix kk kl ja jb km kn je jf jg hb bi translated">如您所见，电子表格中每一票占一行，每一个决定都在一列中(足够合理):</p><figure class="ld le lf lg fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es lq"><img src="../Images/108834847194847a7e0162574ad55aa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YDpbudlSZNijSp46"/></div></div></figure><p id="633d" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated"><em class="ik">(注:黑三角来自谷歌:他们说第二个人(我)改变主意了，revoted。酷！)</em></p><p id="381b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">问题:虽然三个决策有三列，每个投票者一行对Google Forms有意义，但对Datastudio或任何数据可视化工具没有意义，它们宁愿有两列和更多行:</p><p id="a94f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">在<a class="ae jh" href="https://datastudio.google.com/u/0/" rel="noopener ugc nofollow" target="_blank">数据工作室</a>上，导入该选项卡如下所示:</p><figure class="ld le lf lg fd lh er es paragraph-image"><div class="er es lr"><img src="../Images/0be51742cc57fbf9c30b205aeed3c9de.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/0*5xD4GS6vPoLtUeTm"/></div></figure><p id="77d2" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">如果你想有一个图表来比较所有的“意大利式”问题，你需要“反透视表格”，这意味着将它们从每人1行N列变成N行3列(为什么是3行？键、值和某种voter_id，如他们的电子邮件)。</p><h1 id="d3d9" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">问题！</h1><p id="486c" class="pw-post-body-paragraph ii ij hi il b im kg io ip iq kh is it ki kj iw ix kk kl ja jb km kn je jf jg hb bi translated">现在，向Datastudio添加图表来比较所有意大利语问题并不容易。你可以为每个意大利语问题制作一个手工图表(或者做一个，然后剪切和粘贴其他的)，但是当你添加一个问题时，添加另一个图表或者将事情合并在一起是很昂贵的。</p><p id="bf0c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">没有办法正常地在那些字段上添加统计数据。</p><h1 id="a092" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">解除救援！</h1><figure class="ld le lf lg fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es ls"><img src="../Images/7c85ccbaafd641005282ac508e530095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*n9SvcHktozns2SNE"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">里克骑着自行车穿过苏黎士，同时经历了<em class="lx"> anagnorisis </em> : <em class="lx">“尤里卡！必须是</em><strong class="bd jk"><em class="lx"/></strong><em class="lx">！”</em></figcaption></figure><p id="7a9f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated"><a class="ae jh" href="https://www.strava.com/activities/3340930677" rel="noopener ugc nofollow" target="_blank">我在苏黎世山区骑自行车</a>(幸运在covid时代！)思考:一定有解决的办法，而且一定在Stackoverflow上。唯一的问题是:<em class="ik">我如何谷歌它？我基本上有一个数据透视表，但这一次我不需要它了！我需要它的反面。<em class="ik">找到了！我会谷歌一下“取消表格透视”，看看会发生什么。得了吧，一定有人发布了一些解决方案，并称之为unpivot。注意:我100%确定一个解决方案存在并且被记录在案，我只是需要一个人为它想出同样吸引人的名字，否则谷歌搜索不会帮助我。我等了60分钟才知道谷歌unpivot是否会给我带来一些有用的文章。</em></em></p><p id="8d0c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">洗完澡后，我谷歌了一下，马上发现了这个:<a class="ae jh" href="https://stackoverflow.com/questions/24954722/how-do-you-create-a-reverse-pivot-in-google-sheets" rel="noopener ugc nofollow" target="_blank"> Stackoverflow文章</a>Viktor编写了一个漂亮的通用代码来<em class="ik"> unpivot </em>一个通用表格。他还继续演示了一个<a class="ae jh" href="https://docs.google.com/spreadsheets/d/12TBoX2UI_Yu2MA2ZN3p9f-cZsySE4et1slwpgjZbSzw/edit#gid=422214765" rel="noopener ugc nofollow" target="_blank">双开</a>(！)</p><h1 id="b13a" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">在答案电子表格中应用取消透视</h1><ol class=""><li id="0718" class="ko kp hi il b im kg iq kh ki ly kk lz km ma jg kt ku kv kw bi translated">将原来的选项卡从“表单响应1”重命名为“<strong class="il hj">响应1 </strong>”。我讨厌空格，表单填充不会中断，如果这个电子表格将包含其他表单结果，您需要“1”；-)</li><li id="5dab" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">因此，让我们将代码复制到AppScripts中:“工具&gt;脚本编辑器”</li><li id="8900" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">剪切并粘贴<a class="ae jh" href="https://github.com/palladius/unpivoting" rel="noopener ugc nofollow" target="_blank">代码</a>到其中，并添加学分到Victor并保存。</li></ol><figure class="ld le lf lg fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es mb"><img src="../Images/f2cf697eff0c56f378a5b17982bd8a1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uGiGE3DQs7t6N4VZ"/></div></div></figure><ol class=""><li id="4986" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg kt ku kv kw bi translated">在我们继续之前，我们需要对我的床单进行x光检查，因为我们以后会用到它。</li><li id="5db6" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated"><strong class="il hj"> A </strong>:时间戳</li><li id="70ad" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated"><strong class="il hj"> B </strong>:电子邮件地址</li><li id="c47c" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated"><strong class="il hj"> CDEFGHIK </strong> : Italianity[..]“轴心”(答案:是否也许)</li><li id="0007" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated"><strong class="il hj"> LMN </strong>:评级[…]支点(答案:1-5)</li><li id="200a" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated"><strong class="il hj"> O </strong>:附加反馈</li><li id="183b" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">让我们回到电子表格，添加一个新的选项卡，并调用“<strong class="il hj"> Unpivot1 </strong>”来对<em class="ik"> CDEFGHIK </em>中的数据进行unpivot——我们稍后将为LMN创建一个unpivot2。</li><li id="7972" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">移到下一章来填充逆透视。</li></ol><h1 id="b715" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">填充取消透视</h1><p id="2d96" class="pw-post-body-paragraph ii ij hi il b im kg io ip iq kh is it ki kj iw ix kk kl ja jb km kn je jf jg hb bi translated">现在我们有了一天中创造性的和稍微复杂的部分。我们有两个支点(使这个练习更复杂一点)。因此，我们需要某种“键”来映射unicity，以便将数据链接在一起(稍后您会看到)。为了做到这一点，我选择强迫人们给出他们的电子邮件作为一个好的唯一性密钥。如果你想让你的表单匿名，要么你找到另一个唯一的id，要么你编码一个(当然，就像原始的行号！)，或者使用timestamp(但是您可能会有冲突的风险，因为两个人可能会在同一秒内投票—表单粒度是秒)。</p><p id="6463" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">如果我们有一个单一的枢纽，这将是超级容易的，但我想让这个练习不太琐碎，并向你展示我在谷歌电子表格上了解到的矩阵魔术:)</p><p id="54b5" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">看一下表单模式，我们有A-B-O，它们是“普通字段”,我想保留它们作为维度；然后是C-K，表示另一个维度"<em class="ik">Italian yes和no的</em>"，最后是L-N，表示1-5票。希望这个例子足够通用，可以帮助您解决自己的问题。</p><h2 id="97a3" class="mc jj hi bd jk md me mf jo mg mh mi js ki mj mk jw kk ml mm ka km mn mo ke mp bi translated">第一部分。取消第一次多项选择投票(意大利语)。</h2><p id="4fbd" class="pw-post-body-paragraph ii ij hi il b im kg io ip iq kh is it ki kj iw ix kk kl ja jb km kn je jf jg hb bi translated">我们想先取消所有“固定”维度的透视，然后取消“意大利式”透视，再取消“收视率”透视。在列方面，我们将有:</p><ul class=""><li id="8b68" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg mq ku kv kw bi translated"><strong class="il hj"> A' </strong>:时间戳(是A)</li><li id="b9f3" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated"><strong class="il hj">B’</strong>:电子邮件地址(was B)</li><li id="65c4" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated"><strong class="il hj">C’</strong>:附加反馈(was O)</li><li id="7191" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated"><strong class="il hj"> D' </strong>:意大利式钥匙(在C1:K1)</li><li id="1106" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated"><strong class="il hj"> E' </strong>:意大利文值(在C2是:K)</li><li id="9b8f" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated"><strong class="il hj">F’</strong>:ratings key(同上，但在L:N中)</li><li id="7719" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated"><strong class="il hj"> G' </strong> : RatingsValue(" ")</li></ul><p id="b245" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">在一些尝试错误之后，这是放入A1的公式:</p><h2 id="1231" class="mc jj hi bd jk md me mf jo mg mh mi js ki mj mk jw kk ml mm ka km mn mo ke mp bi translated">=unpivot(Responses1！A1:K，2，1，" ItalianityKey "，" ItalianityValue ")</h2><p id="6b0a" class="pw-post-body-paragraph ii ij hi il b im kg io ip iq kh is it ki kj iw ix kk kl ja jb km kn je jf jg hb bi translated">其中“2”代表固定列的数量。</p><p id="4270" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">结果<a class="ae jh" href="https://docs.google.com/spreadsheets/d/1OmzVIVJjQ0Ou1ZsMdNDx4Hp_Qhp3zGSnll6oqWhM3I4/edit#gid=1518562286" rel="noopener ugc nofollow" target="_blank">这里</a>:</p><figure class="ld le lf lg fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es mr"><img src="../Images/4e0a6d118dcbd071d93122c9f35f8825.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*klW_Mwx4KiH7nC_W40oOYQ.png"/></div></div></figure><p id="7f6a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">等等！忘了O的附加反馈！</p><p id="abcf" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">我花了一个多小时才想出一个解决方案，但我学到了更多关于细胞魔法的知识，所以让我与你分享。我们有两个选择:</p><ol class=""><li id="1466" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg kt ku kv kw bi translated">更改unpivot的代码，以允许来自其他列的更多数据(更像是一个弗兰肯斯坦式的不可重用函数)</li><li id="da32" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">向unpivot()提供一个数据重组，将内容放入函数期望的位置(N个固定列+ M个透视列)</li></ol><p id="4626" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">在正常情况下，我会选择(1)证明我也能编码；但是我有一个小宝宝，时间不是我的强项。所以我选择(2)。如果有一种方法可以在B和C之间插入O列(例如，整理列A-B，O，C-K，..).经过大量的谷歌搜索，我找到了它！</p><p id="d04f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated"><strong class="il hj">提示:</strong>你可以用“{}”来合并列和行，用“，”联合列和“；”合并行。尝试这样做:</p><blockquote class="ms"><p id="a286" class="mt mu hi bd mv mw mx my mz na nb jg dx translated">={A1:b3，o1:o3，c1:k3} #简单</p><p id="7356" class="mt mu hi bd mv mw mx my mz na nb jg dx translated">={{ "自定义标题"；A2:b3}，o1:o3，c1:k3} #更难</p></blockquote><p id="34f9" class="pw-post-body-paragraph ii ij hi il b im nc io ip iq nd is it ki ne iw ix kk nf ja jb km ng je jf jg hb bi translated"><strong class="il hj">注意</strong>:当然你可以去掉上面的数字3(A1:B)，但是你需要确保这两列的长度相等，否则你会收到一个错误！</p><p id="d2f1" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">新的复杂公式是这样的:</p><blockquote class="ms"><p id="4bcd" class="mt mu hi bd mv mw mx my mz na nb jg dx translated">=unpivot({Responses1！A1:B，Responses1！O1:O，Responses1！C1:K}，3，1，“ItalianityKey”，“ItalianityValue”)</p></blockquote><p id="2ae3" class="pw-post-body-paragraph ii ij hi il b im nc io ip iq nd is it ki ne iw ix kk nf ja jb km ng je jf jg hb bi translated">这是它看起来的样子:</p><figure class="ld le lf lg fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es nh"><img src="../Images/03bad261687f2dffccbc0f54fd6d9b81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*62a_Eera6DRoY40W"/></div></div></figure><p id="7647" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">如您所见，我们的所有数据都在正确的位置。</p><p id="f92c" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">我无法告诉你我有多自豪，当我得到这个工作！你呢？</p><h2 id="7bb2" class="mc jj hi bd jk md me mf jo mg mh mi js ki mj mk jw kk ml mm ka km mn mo ke mp bi translated">第二部分。取消第二个“支点”(评级)。</h2><p id="65c0" class="pw-post-body-paragraph ii ij hi il b im kg io ip iq kh is it ki kj iw ix kk kl ja jb km kn je jf jg hb bi translated"><strong class="il hj"> <em class="ik"> Wait — wOt？为什么我们需要第二个表</em> </strong> <em class="ik">？很棒的问题！有些答案是肯定/否定的，有些答案是1，2，3，4，5。不同的输出，不同的表格。</em></p><p id="76cf" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">现在，我们已经拥有了第二张表的所有要素，只有一点需要注意。</p><p id="11cb" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">这一次复制所有的关键点是没有意义的，我们只需要枢轴。</p><p id="ebe5" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">不幸的是，unpivot不允许我们有零个键，所以我们将再次使用电子邮件。</p><p id="8abd" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">因此，我们想使用:</p><ul class=""><li id="db82" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg mq ku kv kw bi translated">b(用于电子邮件)</li><li id="0dc3" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">LMN(用于枢轴2)</li></ul><p id="9884" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">如果您遵循了第1部分，这是微不足道的:</p><blockquote class="ms"><p id="45a0" class="mt mu hi bd mv mw mx my mz na nb jg dx translated">=unpivot({Responses1！B1:B，Responses1！L1:N}，1，1，“RatingsKey”，“RatingsValue”)</p></blockquote><p id="cc97" class="pw-post-body-paragraph ii ij hi il b im nc io ip iq nd is it ki ne iw ix kk nf ja jb km ng je jf jg hb bi translated">并将其附加到Unpivot1 (F1)中的第一个空闲单元格:</p><figure class="ld le lf lg fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es ni"><img src="../Images/2ea49fbe8228e69ec1491c920657b8ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hWb4jagLjYBju5Ta"/></div></div></figure><p id="3cca" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">现在，如你所见，两个维度(斜体和评级)的基数是不同的。只有两种方法可以从概念上解决这个问题:</p><ol class=""><li id="1d1f" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg kt ku kv kw bi translated"><strong class="il hj">优雅的</strong>。将透视迁移到数组中，以便anonymous拥有一个ItalianityKey/values和RatingsKey/values数组。使用protobufs进行模式定义(它们支持重复字段)和BigQuery或Cloud Spanner作为数据库，这很容易实现。</li><li id="c5c9" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated"><strong class="il hj">脚踏实地</strong>。分成2或3张桌子。我们可以应用关系完整性规则，并有3个带有单个主键(电子邮件)的表交叉表:</li><li id="31ac" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">T1:固定值(<strong class="il hj">电子邮件</strong>，时间戳，反馈)</li><li id="e937" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">T2:带主键的意大利投票(<strong class="il hj"> Email </strong>，ItalianityKey，ItalianityValue)</li><li id="fe85" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">T3:用主键(<strong class="il hj"> Email </strong>，RatingsKey，RatingsValue)进行评分投票</li></ol><p id="5a8e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">请注意，在您的情况下，主键可能是其他东西，在Google Forms中，它可能是一封电子邮件，但是您可以很容易地匿名化并使用row_id(函数row())。</p><p id="c7c2" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">我将以<strong class="il hj">懒惰</strong>的方式应用选项2(附加T1和T2，因为我们已经有了它)。</p><p id="ca33" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">所以让我们做这些简单的事情:</p><ul class=""><li id="15ad" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg mq ku kv kw bi translated">将Unpivot1重命名为“Unpivot1Italianity”</li><li id="499b" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">创建“取消透视1评级”并粘贴它:</li></ul><p id="3555" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">=unpivot({Responses1！A1:B，Responses1！O1:O，Responses1！L1:N}，<br/> 3，1，“RatingsKey”，“RatingsValue”)</p><p id="0237" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">搞定了。现在我们可以把所有东西都放在Datastudio上。</p><h1 id="f3bc" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">Datastudio！</h1><h1 id="c360" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">连接数据</h1><p id="f91b" class="pw-post-body-paragraph ii ij hi il b im kg io ip iq kh is it ki kj iw ix kk kl ja jb km kn je jf jg hb bi translated">让我们创建一个关于<a class="ae jh" href="https://datastudio.google.com/" rel="noopener ugc nofollow" target="_blank">数据工作室</a>的新报告(新文件..).我的datastudio网址是<a class="ae jh" href="https://datastudio.google.com/u/0/reporting/9efbbc78-be8e-4d08-b7e0-7a105114d088/page/j1qNB" rel="noopener ugc nofollow" target="_blank">这个</a>。</p><p id="7aec" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">然后，让我们开始为报告创建两个数据:</p><ul class=""><li id="4a6e" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg mq ku kv kw bi translated">点击“添加数据”图标</li><li id="90d5" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">选择Google工作表</li></ul><figure class="ld le lf lg fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es nj"><img src="../Images/a817aedfc8833e1473f0cb10d7cf6117.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lrB_UEHML4KFORpw"/></div></div></figure><ul class=""><li id="f8e8" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg mq ku kv kw bi translated">选择您的电子表格，然后更正tab(“unpivot 1 italianity”)并单击<strong class="il hj">添加</strong>。</li><li id="0c5b" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">对“Unpivot1Ratings”进行同样的操作。</li><li id="ea00" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">过一会儿，您会看到一个提议的模式。</li><li id="c492" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">接受改变。</li></ul><h1 id="7cd2" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">添加图表</h1><p id="3aaa" class="pw-post-body-paragraph ii ij hi il b im kg io ip iq kh is it ki kj iw ix kk kl ja jb km kn je jf jg hb bi translated">我们需要一个图表，显示所有的意大利投票比较，我们需要适当的颜色。我们还需要一个计数器，显示已经投了多少票。</p><figure class="ld le lf lg fd lh er es paragraph-image"><div class="er es nk"><img src="../Images/2dfe52bf98c7f133722c96728d76ef9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:338/0*ynv7Ia6oYHCAKVRL"/></div></figure><ul class=""><li id="67cb" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg mq ku kv kw bi translated">创建图表栏</li><li id="3f17" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">连接到“Unpivot1Italianity”数据源。</li><li id="b430" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">用作尺寸“ItalianityKey”和分解尺寸“ItalianityValue”</li><li id="83d8" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">它应该如右图所示。</li></ul><p id="9fcb" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">该图应该如下所示:</p><figure class="ld le lf lg fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es nl"><img src="../Images/f0d0f868f115392c8b39c5a2100b3ae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/0*0H23Qz_j5YEkyfsD"/></div></div></figure><p id="24ce" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">好消息:我们已经完成了文章的主要部分:我们在一个图表中收集了人们对第一个多选(“意大利语”)的所有主题的投票，并且我们可以毫不费力地对第二个多选进行同样的处理。</p><p id="e7b1" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">坏消息:从图形上看很糟糕！</p><h1 id="39f9" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">一些视觉增强</h1><p id="3428" class="pw-post-body-paragraph ii ij hi il b im kg io ip iq kh is it ki kj iw ix kk kl ja jb km kn je jf jg hb bi translated"><strong class="il hj">第一，颜色完全随机</strong>。幸运的是，Datastudio允许我们智能地给值分配颜色(全局地读:<em class="ik"/>)。酷！</p><figure class="ld le lf lg fd lh er es paragraph-image"><div class="er es nm"><img src="../Images/4a14bc950a9ed99b116044eeae6bb347.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/0*rQEZVmuveRZNZafA"/></div></figure><p id="c6c7" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">跟随我的领导:</p><ul class=""><li id="f3d3" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg mq ku kv kw bi translated">选择图表</li><li id="3da2" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">在右边，移动到“风格”标签。</li><li id="db24" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">向下滚动到“颜色依据”-&gt;“尺寸值”。</li><li id="fc27" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">答对了。现在自定义尺寸值。例如，我会制作:</li><li id="f09d" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated"><strong class="il hj">是</strong>:绿色</li><li id="84ec" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated"><strong class="il hj">否</strong>:红色</li><li id="c01d" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated"><strong class="il hj">也许</strong>:灰色。</li><li id="758f" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">你做你想做的。请注意，所有值都在一起，跨越不同的维度。就我而言，既有对意大利的回答(1，2，6)，也有我和我妻子的随机回答，他们显然想要一本意大利护照:)</li></ul><p id="47ce" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">第二，字段不可读。你怎么能责怪他们呢？Google forms产生了这样的值:</p><ol class=""><li id="830f" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg kt ku kv kw bi translated">意大利[帕尔玛意大利三文鱼意大利面]</li><li id="ba26" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">意大利风味[奶油烤饼]</li><li id="89a2" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">意大利风味[碳烤洋葱]</li><li id="dcf8" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">意大利风情[下午4点的卡布奇诺]</li><li id="aff7" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">意大利语[咖啡+牛奶+饼干]</li><li id="b74f" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">意大利式[没有父母的复活节]</li><li id="abb4" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">没有父母的圣诞节</li><li id="21c1" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">意大利面[鸡肉意大利面]</li><li id="9dd7" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">意大利语[比萨饼上的鸡肉]</li></ol><p id="d8b3" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">..和..</p><ol class=""><li id="0776" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg kt ku kv kw bi translated">评分【你觉得阿尔弗雷多意大利面怎么样？]</li><li id="7aff" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">评分【你觉得芝加哥披萨怎么样？]</li><li id="0657" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">评分【你觉得肉丸意面怎么样？]</li></ol><p id="b8e3" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">你看到这里有重复的地方吗？我几乎看不到一些；-)</p><p id="c7fc" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">我们可以在Datastudio或电子表格中解决这个问题。</p><p id="57ba" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">作为一名<strong class="il hj"> Ruby on Rails </strong>开发者(什么？我刚刚被解雇了吗？)，我非常相信<a class="ae jh" href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller" rel="noopener ugc nofollow" target="_blank"> MVC </a>模式，并且相信这里的问题在于模型，而不是视图。所以我们来修复代码吧！我看到两个解决方案(如果你看到第三个更好的方案，请告诉我):</p><ol class=""><li id="2277" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg kt ku kv kw bi translated">使用谷歌电子表格清理标题C1-K1。也许可以使用第二个表来完成。这是最简单的解决方案，但它不会干。没有。</li><li id="f540" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">修补unpivot代码，将“Foo [Bar]”模式识别为单个一次性模式。</li><li id="824b" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">修补unpivot代码，以一种非常特殊的方式识别“Foo [Bar]”模式，使功能更好，让Victor为我们感到骄傲。</li><li id="56af" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">使用Google电子表格创建一个“清理”临时表，并将长名称映射到短名称。然后在逆透视表中使用查找列。</li></ol><p id="b18e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">我认为3非常酷:我想以这样一种方式编码它，如果调用函数的名称是“FooKey”，第一个单元格是“Foo [whatever]”，它将内容更改为“whatever”(删除“Foo [”和“]”部分)，这是我们的用例。在花了40分钟后，我离开了它，因为AppsScript不是解决代码问题的最佳地方(或者可能我的JS foo不如我的Ruby强大)。</p><p id="0427" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">然后我选择了#4，它简单明了，允许逐步调试(唉，它引入了一个我们并不真正需要的临时表)。</p><p id="2a2e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">让我们创建一个名为“headers magic”的选项卡，在A:E:</p><ul class=""><li id="1188" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg mq ku kv kw bi translated">圆柱</li><li id="cf02" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">列名</li><li id="04c6" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">包含方括号</li><li id="5499" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">关键名称</li><li id="b0c9" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">键值</li></ul><p id="0097" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">A2:E2中的这些值:</p><ol class=""><li id="68e3" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg kt ku kv kw bi translated">=row()-1</li><li id="c776" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">=转置({Responses1！A1:Z1})</li><li id="e455" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">=iferror(IF(find("["，B2)&gt;0，TRUE，""，FALSE)</li><li id="8203" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">=split(B2，"[]")</li><li id="e025" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">让这个空着</li></ol><p id="6071" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">..然后复制并粘贴列C/D。</p><p id="89bb" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">您应该获得类似以下的内容:</p><figure class="ld le lf lg fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es nn"><img src="../Images/9238656250e52b285795aaa905bbe9a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*smudG5hFgUMsZPEd"/></div></div></figure><p id="7b5e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">现在我们回到正题。我们需要向Unpivot表中添加几列。</p><ol class=""><li id="2dfe" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg kt ku kv kw bi translated">让我们从“Unpivot1Italianity”开始</li><li id="e774" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">将A1的内容复制到C1中(现在我们有一个空的A/B)。在C1，您应该有=unpivot({Responses1！A1:B，Responses1！O1:O，Responses1！C1:K}，3，1，“ItalianityKey”，“ItalianityValue”)</li><li id="8d27" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">分别调用A1/B1:[<strong class="il hj">key lookup title</strong>，<strong class="il hj"> KeyLookupQuestion </strong>。</li><li id="3bca" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">给A2加上这个公式:= array formula(if error(VLOOKUP(F2:F，HeadersMagic！B2:E，{3，4}，0)，""))</li><li id="2d1a" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg kt ku kv kw bi translated">将相同的概念重复到“Unpivot2Ratings”中。</li></ol><p id="c597" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">让我们简单解释一下第4步:在你的F列的行中查找at，从F2开始；你觉得“意大利式(帕尔玛干酪配三文鱼意大利面)”怎么样？很好。现在在HeadersMagic中搜索B、C、D、E单元格(不是我们不用C)。你在B列的某个地方找到字符串了吗？是的，你有！在B4！很好，现在从数组B4中:E4取出元素3rd和4rd，它们是“Italianity”和“Parmigiano on Salmon Pasta ”,并把它们放在“KeyLookupTitle”和“KeyLookupQuestion”下。如果没有找到任何内容，则添加一个空字符串(" ")。最后，ARRAYFORMULA说:对找到的所有单元格继续这样做(在本例中是数组F2:F，表示F有值的所有单元格)。</p><p id="35f0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">这是两个数据透视表现在的样子。我把这两种新颜色涂成了黄色，为了隐私，我把邮件藏了起来。</p><figure class="ld le lf lg fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es no"><img src="../Images/8d4b2176d9eb614a594b30fc4b22a299.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*v8bbF3ePUNdNI-Jq"/></div></div></figure><figure class="ld le lf lg fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es np"><img src="../Images/c2d6aa8c25ba386bdf481302a720c62e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rsreQclkT4UyZNtE"/></div></div></figure><p id="6bca" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">现在我们只需要返回到<strong class="il hj"> Datastudio </strong>，并“重新解析”数据结构。</p><ul class=""><li id="9e4f" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg mq ku kv kw bi translated">打开数据工作室</li><li id="c593" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">资源&gt;管理数据源</li><li id="bda1" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">打开“取消透视1评级”</li><li id="de2e" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">刷新字段</li></ul><p id="bddc" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">之前:</p><figure class="ld le lf lg fd lh er es paragraph-image"><div class="er es nq"><img src="../Images/4e0d16c647f8246a77577e2960f94ba5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/0*ta6dMV28Doj06Bn_"/></div></figure><p id="b835" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">之后:</p><figure class="ld le lf lg fd lh er es paragraph-image"><div class="er es nr"><img src="../Images/59b344c70ec86946c95e78ca056c3dc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/0*ZrsDmxfI3AjDjXV-"/></div></figure><p id="6001" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">现在在图表中，将“ItalianKey”改为“KeyLookupQuestion ”,结果如下:</p><figure class="ld le lf lg fd lh er es paragraph-image"><div class="er es ns"><img src="../Images/301e341b0c7e82edd8f4596b34dcb462.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/0*dS6KSKYKn2j9x66_"/></div></figure><p id="9f72" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">哇，这么小的细微差别花了比预期更长的时间！现在，让我们添加评分图表。由于它是整数，我们可以用平均值(RatingsValue)来作图:</p><figure class="ld le lf lg fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es nt"><img src="../Images/41ab15109089903e96114311465d09f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WXWXGgC9TH0OHkjJ"/></div></div></figure><h1 id="96be" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">变更管理</h1><p id="dbe6" class="pw-post-body-paragraph ii ij hi il b im kg io ip iq kh is it ki kj iw ix kk kl ja jb km kn je jf jg hb bi translated">哇，这看起来像一个愚蠢的表单可视化的大量工作，对不对？</p><p id="4f63" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">那么，这个演示有什么酷的呢？我们还没看过。</p><p id="fea4" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">假设您想在表单中添加一个问题，比如说:</p><ul class=""><li id="9fbb" class="ko kp hi il b im in iq ir ki kq kk kr km ks jg mq ku kv kw bi translated">对意大利人的另外两个问题(没有太阳的太阳镜，比萨饼，西红柿，马苏里拉金枪鱼)</li><li id="13e6" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">还有三个评分问题</li></ul><p id="30ca" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ki iv iw ix kk iz ja jb km jd je jf jg hb bi translated">[awesome_part]现在，您只需更改表单，只需更改unpivot1a和unpivot1b的两个公式(让它再解析几列)。Datastudio甚至不会注意到这种差异，因为它从具有固定列数的unpivot表中解析数据(我们只会有更多的数据)。[/awesome_part]</p><h1 id="7d22" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">链接</h1><ul class=""><li id="8dc9" class="ko kp hi il b im kg iq kh ki ly kk lz km ma jg mq ku kv kw bi translated">谷歌表单(<a class="ae jh" href="https://docs.google.com/forms/d/e/1FAIpQLSc8Z4fFe9AtjilgJF179Kr6rOo-7uV3vTuLtTCuFiFvfkkwSg/viewform" rel="noopener ugc nofollow" target="_blank"> <strong class="il hj">视图</strong> </a>)</li><li id="9e22" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">表单响应(<a class="ae jh" href="https://docs.google.com/spreadsheets/d/1OmzVIVJjQ0Ou1ZsMdNDx4Hp_Qhp3zGSnll6oqWhM3I4/edit#gid=468422675" rel="noopener ugc nofollow" target="_blank">匿名表单复制</a> ) — <a class="ae jh" href="https://script.google.com/macros/d/1HWJXIFv4bsfFzg0xWf_WsFWf1CuWhcrSR2YSxB4YLC5GBrx9tVfx7cXp/edit?mid=ACjPJvGX9F5n4DxoBJxd6Qa5PnpCF13YCHVl2HUmhBYOEg6LIHY2lyFTycs58kAg0MI3lsmfTdm9liBI6TITe9lWMUAND1WZeUWf8G15EnsbHrNaWKZsa1H4H3YE57enwsLNOiQh2f6WJr8&amp;uiv=2" rel="noopener ugc nofollow" target="_blank">宏代码</a></li><li id="17e4" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated"><a class="ae jh" href="https://datastudio.google.com/reporting/9efbbc78-be8e-4d08-b7e0-7a105114d088/page/j1qNB" rel="noopener ugc nofollow" target="_blank">数据工作室报告</a>(公开)</li><li id="59f4" class="ko kp hi il b im kx iq ky ki kz kk la km lb jg mq ku kv kw bi translated">github上的代码(以防我忘记了什么，我会贴在那里):<a class="ae jh" href="https://github.com/palladius/unpivoting" rel="noopener ugc nofollow" target="_blank">https://github.com/palladius/unpivoting</a></li></ul><h1 id="9176" class="ji jj hi bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">信用</h1><ul class=""><li id="975d" class="ko kp hi il b im kg iq kh ki ly kk lz km ma jg mq ku kv kw bi translated">维克多·塔博瑞为<a class="ae jh" href="https://stackoverflow.com/questions/24954722/how-do-you-create-a-reverse-pivot-in-google-sheets" rel="noopener ugc nofollow" target="_blank">解算公式</a>。非常感谢！</li></ul></div></div>    
</body>
</html>