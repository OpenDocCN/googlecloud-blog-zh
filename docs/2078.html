<html>
<head>
<title>Day #16 with Workflows: Reading in and writing a JSON file to a storage bucket from a workflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">工作流的第16天:从工作流中读入JSON文件并将其写入存储桶</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/day-16-with-workflows-reading-in-and-writing-a-json-file-to-a-storage-bucket-from-a-workflow-48b85c12d225?source=collection_archive---------3-----------------------#2022-01-31">https://medium.com/google-cloud/day-16-with-workflows-reading-in-and-writing-a-json-file-to-a-storage-bucket-from-a-workflow-48b85c12d225?source=collection_archive---------3-----------------------#2022-01-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="42b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://cloud.google.com/workflows" rel="noopener ugc nofollow" target="_blank"> Workflows </a>提供了几个<a class="ae jd" href="https://cloud.google.com/workflows/docs/reference/googleapis" rel="noopener ugc nofollow" target="_blank">连接器</a>，用于与各种Google Cloud APIs和服务进行交互。过去，我曾使用过<a class="ae jd" href="https://cloud.google.com/workflows/docs/reference/googleapis/documentai/Overview" rel="noopener ugc nofollow" target="_blank">文档人工智能连接器</a>来解析费用收据之类的文档，或者使用<a class="ae jd" href="https://cloud.google.com/workflows/docs/reference/googleapis/secretmanager/Overview" rel="noopener ugc nofollow" target="_blank">秘密管理器连接器</a>来存储和访问密码之类的秘密。我今天感兴趣使用的另一个有用的连接器是<a class="ae jd" href="https://cloud.google.com/workflows/docs/reference/googleapis/storage/Overview" rel="noopener ugc nofollow" target="_blank"> Google云存储连接器</a>，用于存储和读取存储在存储桶中的文件。</p><p id="d164" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些连接器是从它们的API发现描述符自动生成的，但是目前有一些限制，例如，阻止下载文件的内容。所以我没有使用连接器，而是查看了云存储的JSON API，看看它提供了什么(<a class="ae jd" href="https://cloud.google.com/workflows/docs/reference/googleapis/storage/v1/objects/insert" rel="noopener ugc nofollow" target="_blank"> insert </a>和<a class="ae jd" href="https://cloud.google.com/storage/docs/json_api/v1/objects/get" rel="noopener ugc nofollow" target="_blank"> get </a>方法)。</p><p id="bffb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想做的是存储一个JSON文档，并读取一个JSON文档。我还没有尝试过其他媒体类型，比如图片或其他二进制文件。总之，下面是如何将JSON文件写入云存储桶:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="b74c" class="jn jo hi jj b fi jp jq l jr js">main:<br/>    params: [input]<br/>    steps:<br/>    - assignment:<br/>        assign:<br/>            - bucket: YOUR_BUCKET_NAME_HERE<br/>    - write_to_gcs:<br/>        call: http.post<br/>        args:<br/>            url: ${"<a class="ae jd" href="https://storage.googleapis.com/upload/storage/v1/b/" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/upload/storage/v1/b/</a>" + bucket + "/o"}<br/>            auth:<br/>                type: OAuth2<br/>            query:<br/>                name: THE_FILE_NAME_HERE<br/>            body:<br/>                name: Guillaume<br/>                age: 99</span></pre><p id="c41d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个文件中，我存储了一个JSON文档，其中包含几个键，这些键是在调用体中定义的。默认情况下，这里假设一个JSON媒体类型，所以在YAML底部定义的主体实际上在结果文件中被写成JSON。哦，当然，不要忘记改变上面例子中的桶和对象的名称。</p><p id="8455" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以这样从桶中读取文件的内容:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="e598" class="jn jo hi jj b fi jp jq l jr js">main:<br/>    params: [input]<br/>    steps:<br/>    - assignment:<br/>        assign:<br/>            - bucket: YOUR_BUCKET_NAME_HERE<br/>            - name: THE_FILE_NAME_HERE<br/>    - read_from_gcs:<br/>        call: http.get<br/>        args:<br/>            url: ${"<a class="ae jd" href="https://storage.googleapis.com/download/storage/v1/b/" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/download/storage/v1/b/</a>" + bucket + "/o/" + name}<br/>            auth:<br/>                type: OAuth2<br/>            query:<br/>                alt: media<br/>        result: data_json_content<br/>    - return_content:<br/>        return: ${data_json_content.body}</span></pre><p id="e1ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这一次我们将GCS URL从“upload”改为“download ”,我们使用alt=media查询参数来指示GCS JSON API我们想要检索文件的内容(不仅仅是它的元数据)。最后，我们返回包含内容的调用体。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="dda6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ka">最初发表于</em><a class="ae jd" href="https://glaforge.appspot.com/article/reading-in-and-writing-a-json-file-to-a-storage-bucket-from-a-workflow" rel="noopener ugc nofollow" target="_blank"><em class="ka">【https://glaforge.appspot.com】</em></a><em class="ka">。</em></p></div></div>    
</body>
</html>