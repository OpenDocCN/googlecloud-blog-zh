<html>
<head>
<title>How to use PhantomJS with Node.js on Google App Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Google App Engine上结合Node.js使用PhantomJS</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/how-to-use-phantomjs-with-node-js-on-google-app-engine-6f7feaea551?source=collection_archive---------1-----------------------#2016-06-02">https://medium.com/google-cloud/how-to-use-phantomjs-with-node-js-on-google-app-engine-6f7feaea551?source=collection_archive---------1-----------------------#2016-06-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="15ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有一些帖子说你不能在GAE(谷歌应用引擎)上使用PhantomJS，但现在这不是真的。本文展示了如何通过Node.js配置使用PhantomJS。</p><h2 id="679d" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">放弃</h2><p id="5331" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">虽然下面的过程在写作时工作得很好，但这并不意味着它会工作很长时间。我甚至不确定这是否值得推荐。请理解风险。</p><h2 id="e8af" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">背景</h2><p id="95af" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">当你用Node.js编码的时候，<a class="ae kd" href="https://www.npmjs.com" rel="noopener ugc nofollow" target="_blank"> npm </a>上有很多包，大部分是用JavaScript写的，一部分是原生代码，还有一部分运行在单独的进程中。PhantomJS是其中之一，它必须在与Node.js不同的进程中运行。PhantomJS具有捕获网站的独特功能，目前还没有与Node.js很好集成的替代产品。</p><p id="c601" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GAE是一个PaaS，通常仅限于运行一个流程。然而，相对较新的<a class="ae kd" href="https://cloud.google.com/appengine/docs/flexible/" rel="noopener ugc nofollow" target="_blank">灵活环境</a>(正式名称为“托管虚拟机”)更加灵活。它只是允许在谷歌计算引擎虚拟机的Docker容器中运行任何东西。</p><h2 id="f47e" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">问题</h2><p id="d08f" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">Node.js有一个很好的PhantomJS包，叫做<a class="ae kd" href="https://www.npmjs.com/package/phantomjs-prebuilt" rel="noopener ugc nofollow" target="_blank">PhantomJS-预构建</a>。如果你看看它的<a class="ae kd" href="https://www.npmjs.com/browse/depended/phantomjs-prebuilt" rel="noopener ugc nofollow" target="_blank">依赖项</a>，你会看到这么多的包依赖于它。现在，这个包在大多数情况下都能很好地工作，但是在文档中有一个重要的注意事项。</p><blockquote class="ke kf kg"><p id="6c15" class="if ig kh ih b ii ij ik il im in io ip ki ir is it kj iv iw ix kk iz ja jb jc hb bi translated">不需要安装Qt、WebKit或任何其他库。然而，它仍然依赖于fontconfig(包Fontconfig或libfontconfig，取决于发行版)。</p></blockquote><p id="8539" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">问题是这个<em class="kh"> fontconfig </em>包没有安装在GAE的Node.js的容器中。</p><h2 id="7192" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">解决办法</h2><p id="ee15" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">一个可能的解决方案是使用<a class="ae kd" href="https://cloud.google.com/appengine/docs/flexible/custom-runtimes/" rel="noopener ugc nofollow" target="_blank">定制运行时</a>并编写自己的docker文件来创建一个容器。</p><p id="3781" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，我想要更简单的东西，并找到了解决方案。您只需要在package.json文件中添加一行。</p><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="aa57" class="jd je hi kq b fi ku kv l kw kx">{<br/>  "scripts": {<br/>    "preinstall": "apt-get update &amp;&amp; apt-get -y <br/>install libfontconfig1"<br/>  },<br/>  "dependencies": {<br/>    "phantomjs-prebuilt": "^2.1.7"<br/>  }<br/>}</span></pre><p id="cd8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，它只显示了package.json文件的一部分。这很管用。</p><h2 id="a422" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">一些最后的想法</h2><p id="d951" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">这里没什么好说的，但是我也不确定这是不是最好的方法。理想情况下，最好有一个与PhantomJS功能相似的纯Node.js包。对于最后一个评论，我要指出的是，您可能需要一些调整，以便<em class="kh">预安装</em>脚本只能在GAE上运行。</p></div></div>    
</body>
</html>