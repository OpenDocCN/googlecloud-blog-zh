<html>
<head>
<title>Running Eclipse HONO and Ditto on Google Cloud (2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在谷歌云上运行Eclipse HONO和Ditto)</h1>
<blockquote>原文：<a href="https://medium.com/google-cloud/running-eclipse-hono-and-ditto-on-google-cloud-2-3e8ad69efeb7?source=collection_archive---------3-----------------------#2022-08-20">https://medium.com/google-cloud/running-eclipse-hono-and-ditto-on-google-cloud-2-3e8ad69efeb7?source=collection_archive---------3-----------------------#2022-08-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="01d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是博客系列的第二部分。在这篇博客中，我将配置Eclipse HONO和Eclipse Ditto，以便两者集成在一起。然后，我将创建一个设备来验证端到端连通性。</p><p id="8152" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将setCloud2EdgeEnv.sh文件下载到Cloud Shell，确保您仍然连接到我们在之前的博客文章中创建的GKE集群。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="d975" class="jn jo hi jj b fi jp jq l jr js">chmod +777 setCloud2EdgeEnv.sh<br/>RELEASE=c2e<br/>NS=cloud2edge<br/>./setCloud2EdgeEnv.sh $RELEASE $NS</span></pre><p id="60b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将为您提供所需的环境变量，复制脚本输出并将其粘贴到云Shell控制台，然后按Enter键执行它们。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="1730" class="jn jo hi jj b fi jp jq l jr js">export AMQP_NETWORK_IP=”xx.xx.xx.xx"<br/>export AMQP_NETWORK_PORT_amqp=”15672"<br/>export AMQP_NETWORK_PORT_amqps=”15671"<br/>export REGISTRY_IP=”35.194.207.149"<br/>export REGISTRY_PORT_http=”28080"<br/>export REGISTRY_PORT_https=”28443"<br/>export AMQP_ADAPTER_IP=”xx.xx.xx.xx"<br/>export AMQP_ADAPTER_PORT_amqp=”5672"<br/>export AMQP_ADAPTER_PORT_amqps=”5671"<br/>export HTTP_ADAPTER_IP=”xx.xx.xx.xx"<br/>export HTTP_ADAPTER_PORT_http=”8080"<br/>export HTTP_ADAPTER_PORT_https=”8443"<br/>export MQTT_ADAPTER_IP=”34.81.137.23"<br/>export MQTT_ADAPTER_PORT_mqtt=”1883"<br/>export MQTT_ADAPTER_PORT_secure-mqtt=”8883"<br/>export DITTO_API_IP=”xx.xx.xx.xx"<br/>export DITTO_API_PORT_http=”8080"<br/># Run this command to populate environment variables<br/># with the NodePorts of Hono’s and Ditto’s API endpoints:<br/># eval “$(./setCloud2EdgeEnv.sh RELEASE_NAME [NAMESPACE])”<br/># with NAMESPACE being the Kubernetes name space that you installed Hono to<br/># if no name space is given, the default name space is used</span></pre><p id="2daf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，<em class="jt">MQTT _ ADAPTER _ PORT _ secure-MQTT</em>的变量名无效，因为它包含一个连字符，请用下划线替换它，以便脚本可以正确执行。</p><h1 id="ec14" class="ju jo hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">在Eclipse HONO设置一个设备</h1><p id="c969" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">Eclipse HONO提供了REST API端点供我们与之交互。为了创建一个连接到Eclipse HONO的设备，首先我们创建一个将托管我们的设备的租户。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="cfae" class="jn jo hi jj b fi jp jq l jr js">export TENANT_NAME=”org.eclipse.ditto"<br/>export DEVICE_ID=”demo-device-001"</span><span id="ce0e" class="jn jo hi jj b fi kw jq l jr js">curl -i -X POST http://${REGISTRY_IP}:${REGISTRY_PORT_http}/v1/tenants/${TENANT_NAME}</span></pre><p id="2542" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这创建了一个名为<em class="jt"> org.eclipse.ditto </em>的新租户。您应该会看到类似的输出。</p><figure class="je jf jg jh fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es kx"><img src="../Images/29ea0b8e476bdf0d05a4665d9cacf444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7jtNSNKHbeON18WhlnopXg.png"/></div></div></figure><p id="01c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在新租户下创建设备</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="0ea1" class="jn jo hi jj b fi jp jq l jr js">curl -u ditto:ditto -i -X POST <a class="ae jd" href="http://${REGISTRY_IP}:${REGISTRY_PORT_HTTP}/v1/devices/${TENANT_NAME}/${TENANT_NAME}:${DEVICE_ID}" rel="noopener ugc nofollow" target="_blank">http://${REGISTRY_IP}:${</a>REGISTRY_PORT_http<a class="ae jd" href="http://${REGISTRY_IP}:${REGISTRY_PORT_HTTP}/v1/devices/${TENANT_NAME}/${TENANT_NAME}:${DEVICE_ID}" rel="noopener ugc nofollow" target="_blank">}/v1/devices/${TENANT_NAME}/${TENANT_NAME}:${DEVICE_ID}</a></span></pre><p id="fbfe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该有一个HTTP 201响应代码，表明设备已成功创建。</p><figure class="je jf jg jh fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lf"><img src="../Images/db9e634368224208c246c3b64805a4c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oIjIJhMZwhPA-IqUd_HmXA.png"/></div></div></figure><p id="e883" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，创建新设备时，在API端点中指定${TENANT_NAME}:${DEVICE_ID}而不仅仅是${DEVICE_ID}来标识设备。</p><p id="7277" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经创建了设备，我们需要为设备分配凭证，这样它就可以实际连接到Eclipse HONO。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="232d" class="jn jo hi jj b fi jp jq l jr js">curl -i -X PUT -H "Content-Type: application/json" --data '[{<br/>"type": "hashed-password",<br/>"auth-id": "demo-device-001-auth",<br/>"secrets": [{"pwd-plain": "my-password"}]}]' http://${REGISTRY_IP}:${REGISTRY_PORT_http}/v1/credentials/${TENANT_NAME}/${TENANT_NAME}:${DEVICE_ID}</span></pre><p id="6107" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，这里我们使用一个名为<em class="jt"> auth-id </em>的新id，其值为<em class="jt"> ${DEVICE_ID}-auth </em>，我们为设备分配一个纯文本密码。</p><p id="894a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">至此，我们已经成功地在<em class="jt">org . eclipse . ditto</em>tenant下创建了一个名为<em class="jt"> demo-device-001 </em>的新设备。</p><p id="d6d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们验证一下我们是否能把设备连接到Eclipse HONO并开始发送遥测数据。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="514d" class="jn jo hi jj b fi jp jq l jr js">curl -X POST -i -u ${DEVICE_ID}-auth@${TENANT_NAME}:my-password -H ‘Content-Type: application/json’ -d ‘{“temp”: 23.07}’ <a class="ae jd" rel="noopener ugc nofollow" target="_blank" href="/${HTTP_ADAPTER_IP}:${HTTP_ADAPTER_PORT_HTTP}/telemetry">http://${HTTP_ADAPTER_IP}:${</a>HTTP_ADAPTER_PORT_http<a class="ae jd" rel="noopener ugc nofollow" target="_blank" href="/${HTTP_ADAPTER_IP}:${HTTP_ADAPTER_PORT_HTTP}/telemetry">}/telemetry</a></span></pre><p id="8148" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该看到一个HTTP 503错误，说明<em class="jt">没有可用的消费者</em>。这是因为尽管我们已经准备好了设备，但是在Eclipse HONO中，没有用户监听传入的遥测数据。</p><figure class="je jf jg jh fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lg"><img src="../Images/7e56283aab2266b9602c21ffaa09ef5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KgpGADo3Q5ST_K11eK32zg.png"/></div></div></figure><p id="b37e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">至此，我们已经成功地创建了一个Eclipse HONO租户，在该租户下创建了一个设备，并让该设备成功地向Eclipse HONO发送了遥测数据。在下一篇博文中，我们将开始配置Eclipse Ditto，以便它接收来自Eclipse HONO的遥测数据。</p><p id="15b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" rel="noopener" href="/google-cloud/running-eclipse-hono-and-ditto-on-google-cloud-3-4a8919460c60">第三部分</a></p></div></div>    
</body>
</html>